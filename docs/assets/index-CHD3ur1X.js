var cr=Object.defineProperty;var dr=(r,t,e)=>t in r?cr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var p=(r,t,e)=>dr(r,typeof t!="symbol"?t+"":t,e);import{aw as ai,ab as U,x as de,y as W,z as q,A as T,P as _,H as O,C as Y,u as m,r as Q,f as oe,I as xe,J as Se,Q as De,a4 as Me,M as X,O as Ce,G as Te,D as _n,L as li,c as Pt,k as hr,ax as ur,ay as fr,at as gr,az as mr}from"./vue-lfwZ6J9M.js";import{r as pr}from"./lodash-UWhP6zzE.js";import{m as ci,o as le,r as He,a as ft,c as Cr,b as yr}from"./mobx-DpHXnjKJ.js";import{g as _r,E as Ne,a as Gt,p as di,m as hi,b as ms,d as ps,e as ze,f as St,h as bt,i as Cs,j as ys,k as Er,u as xr,l as Sr,w as br,n as vr,o as ui,q as wr,r as fi,s as gi,t as Tr,v as Ar,x as Or,y as Ir,z as Lr,A as Pr,B as Rr}from"./element-DVUW_5P2.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();class kr{constructor(){p(this,"el")}async init(t){this.el=t}}const En=2,xn=2,Fr=4,Br=4,Dr=4,Sn=8,mi=32;var ve=(r=>(r[r.path=0]="path",r[r.transformer=1]="transformer",r[r.cursor=2]="cursor",r[r.cursorPosition=3]="cursorPosition",r[r.selection=4]="selection",r[r.rotate=5]="rotate",r[r.indicator=6]="indicator",r[r.range=7]="range",r))(ve||{}),ie=(r=>(r[r.initialed=-1]="initialed",r[r.startCreating=0]="startCreating",r[r.creating=1]="creating",r[r.finished=2]="finished",r[r.editing=3]="editing",r))(ie||{}),x=(r=>(r.elementsStatusChanged="elementsStatusChanged",r.treeNodesChanged="treeNodesChanged",r.treeNodePropsChanged="treeNodePropsChanged",r.elementCreated="elementCreated",r.selectedChanged="selectedChanged",r.targetChanged="targetChanged",r.positionChanged="positionChanged",r.widthChanged="widthChanged",r.heightChanged="heightChanged",r.angleChanged="angleChanged",r.cornersChanged="cornersChanged",r.flipXChanged="flipXChanged",r.leanYAngleChanged="leanYAngleChanged",r.scaleChanged="scaleChanged",r.strokesChanged="strokesChanged",r.fillsChanged="fillsChanged",r.fontStylerChanged="fontStylerChanged",r.fontSizeChanged="fontSizeChanged",r.fontFamilyChanged="fontFamilyChanged",r.fontLineHeightChanged="fontLineHeightChanged",r.fontLineHeightFactorChanged="fontLineHeightFactorChanged",r.fontLineHeightAutoFitChanged="fontLineHeightAutoFitChanged",r.fontLetterSpacingChanged="fontLetterSpacingChanged",r.fontColorChanged="fontColorChanged",r.fontColorOpacityChanged="fontColorOpacityChanged",r.fontStylerMixinChanged="fontStylerMixinChanged",r.fontSizeMixinChanged="fontSizeMixinChanged",r.fontFamilyMixinChanged="fontFamilyMixinChanged",r.fontColorMixinChanged="fontColorMixinChanged",r.fontColorOpacityMixinChanged="fontColorOpacityMixinChanged",r.fontLetterSpacingMixinChanged="fontLetterSpacingMixinChanged",r.textDecorationChanged="textDecorationChanged",r.textDecorationColorChanged="textDecorationColorChanged",r.textDecorationOpacityChanged="textDecorationOpacityChanged",r.textDecorationThicknessChanged="textDecorationThicknessChanged",r.textDecorationMixinChanged="textDecorationMixinChanged",r.textDecorationColorMixinChanged="textDecorationColorMixinChanged",r.textDecorationOpacityMixinChanged="textDecorationOpacityMixinChanged",r.textDecorationThicknessMixinChanged="textDecorationThicknessMixinChanged",r.textAlignChanged="textAlignChanged",r.textVerticalAlignChanged="textVerticalAlignChanged",r.textBaselineChanged="textBaselineChanged",r.paragraphSpacingChanged="paragraphSpacingChanged",r.textCaseChanged="textCaseChanged",r.creatorChanged="creatorChanged",r.ratioLockedChanged="ratioLockedChanged",r.multiSelectedChanged="multiSelectedChanged",r.primarySelectedChanged="primarySelectedChanged",r.layerShiftMoveEnableChanged="layerShiftMoveEnableChanged",r.layerGoDownEnableChanged="layerGoDownEnableChanged",r.statusChanged="statusChanged",r))(x||{}),Qs=(r=>(r[r.START=0]="START",r[r.UPDATE=1]="UPDATE",r[r.END=2]="END",r))(Qs||{}),j=(r=>(r[r.LEFT=0]="LEFT",r[r.RIGHT=1]="RIGHT",r[r.TOP=2]="TOP",r[r.BOTTOM=3]="BOTTOM",r))(j||{});class bn{constructor(t){p(this,"prev",null);p(this,"next",null);p(this,"value");this.value=t}get isHead(){return this.prev===null}get isTail(){return this.next===null}get isEmpty(){return this.value===null}insertAfter(t){const e=this.next;this.next=t,t.prev=this,t.next=e,e&&(e.prev=t)}insertBefore(t){const e=this.prev;this.prev=t,t.next=this,t.prev=e,e&&(e.next=t)}}const Mr="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let mt=(r=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)t+=Mr[e[r]&63];return t};const Ft=new Worker(new URL(""+new URL("MathWorker-CmujXtXM.js",import.meta.url).href,import.meta.url),{type:"module"}),pt=new Map;Ft.onmessage=r=>{const{id:t,result:e}=r.data;let s=pt.get(t);s&&s(e),pt.delete(t),s=null};class h{static multiply(t,e){const s=t.length,n=t[0].length;if(Array.isArray(e[0])){const i=e.length,o=e[0].length;if(n!==i)throw new Error("矩阵 A 的列数必须等于矩阵 B 的行数");const a=new Array(s);for(let l=0;l<s;l++)a[l]=new Array(o).fill(0);for(let l=0;l<s;l++)for(let c=0;c<o;c++)for(let d=0;d<n;d++)a[l][c]+=t[l][d]*e[d][c];return a}else{if(n!==e.length)throw new Error("矩阵 A 的列数必须等于向量的长度");const i=new Array(s).fill(0);for(let o=0;o<s;o++)for(let a=0;a<n;a++)i[o]+=t[o][a]*e[a];return i}}static calcTranslateMatrix(t,e){return[[1,0,t],[0,1,e],[0,0,1]]}static translate(t,e){return!e||!t||e.x===0&&e.y===0?t:{x:t.x+e.x,y:t.y+e.y}}static batchTranslate(t,e){return t.map(s=>this.translate(s,e))}static asyncTranslate(t,e){return new Promise(s=>{const n=`${Date.now()}_${mt(4)}`;Ft.postMessage({funcName:"translate",args:[t,e],id:n}),pt.set(n,i=>{s(i)})})}static asyncBatchTranslate(t,e){return new Promise(s=>{const n=`${Date.now()}_${mt(4)}`;Ft.postMessage({funcName:"batchTranslate",args:[t,e],id:n}),pt.set(n,i=>{s(i)})})}static asyncNamedBatchTranslate(t,e){return new Promise(s=>{const n=`${Date.now()}_${mt(4)}`;Ft.postMessage({funcName:"namedBatchTranslate",args:[t,e],id:n}),pt.set(n,i=>{s(i)})})}static asyncMapNamedBatchTranslate(t,e){return new Promise(s=>{const n=`${Date.now()}_${mt(4)}`;Ft.postMessage({funcName:"mapNamedBatchTranslate",args:[t,e],id:n}),pt.set(n,i=>{s(i)})})}static rotate(t,e){if(e===0)return t;const s=h.calcRotateMatrix(e),n=h.multiply(s,[t.x,t.y,1]);return{x:n[0],y:n[1]}}static batchRotate(t,e){return t.map(s=>this.rotate(s,e))}static calcScaleMatrix(t,e){return[[t,0,0],[0,e,0],[0,0,1]]}static calcTransformMatrix(t,e,s,n={}){e=h.transWithCenter(e,n,t,!0),s=h.transWithCenter(s,n,t,!0);const i=s.x-t.x,o=s.y-t.y,a=e.x-t.x,l=e.y-t.y,c=i===0?1:a/i,d=o===0?1:l/o;return h.calcScaleMatrix(c,d)}static rotateWithCenter(t,e,s){if(e===0||!s)return t;t={x:t.x-s.x,y:t.y-s.y};const n=h.rotate(t,e);return{x:n.x+s.x,y:n.y+s.y}}static batchRotateWithCenter(t,e,s){return t.map(n=>h.rotateWithCenter(n,e,s))}static leanYWithCenter(t,e,s){return h.leanWithCenter(t,0,e,s)}static batchLeanYWithCenter(t,e,s){return t.map(n=>h.leanYWithCenter(n,e,s))}static leanXWithCenter(t,e,s){return h.leanWithCenter(t,e,0,s)}static batchLeanXWithCenter(t,e,s){return t.map(n=>h.leanXWithCenter(n,e,s))}static calcLeanMatrix(t,e){t=t||0,e=e||0;const s=Math.tan(h.angleToRadian(t));return[[1,-Math.tan(h.angleToRadian(e)),0],[s,1,0],[0,0,1]]}static calcRotateMatrix(t){t=t||0;const e=h.angleToRadian(t);return[[Math.cos(e),-Math.sin(e),0],[Math.sin(e),Math.cos(e),0],[0,0,1]]}static leanWithCenter(t,e,s,n){if(e===0&&s===0)return t;const i=h.calcLeanMatrix(e,s),o=h.multiply(i,[t.x-n.x,t.y-n.y,1]);return{x:o[0]+n.x,y:o[1]+n.y}}static batchLeanWithCenter(t,e,s,n){return t.map(i=>h.leanWithCenter(i,e,s,n))}static transWithCenter(t,e,s,n){let{angle:i=0,leanXAngle:o=0,leanYAngle:a=0}=e||{};if(i===0&&o===0&&a===0)return t;n&&(i=-i,o=-o,a=-a);let l;const c=h.calcLeanMatrix(o,a),d=h.calcRotateMatrix(i);n?l=h.multiply(c,d):l=h.multiply(d,c);let u=h.multiply(l,[t.x-s.x,t.y-s.y,1]);return{x:u[0]+s.x,y:u[1]+s.y}}static batchTransWithCenter(t,e,s,n){return t.map(i=>h.transWithCenter(i,e,s,n))}static rotateAndTranslate(t,e,s){return h.translate(h.rotate(t,e),s)}static translateArcPoint(t,e){let{start:s,controller:n,end:i,corner:o,value:a}=t;return[s,n,i,o]=h.batchTranslate([s,n,i,o],e),{start:s,controller:n,end:i,corner:o,value:a}}static translateArcPoints(t,e){return t.map(s=>h.translateArcPoint(s,e))}static batchTranslateArcPoints(t,e){return t.map((s,n)=>h.translateArcPoints(s,e))}static calcSymmetryPoint(t,e,s){const n=s.x-e.x,i=s.y-e.y,o=n*n+i*i;if(o===0)return{...t};const a=t.x-e.x,l=t.y-e.y,d=(a*n+l*i)/o,u=e.x+d*n,f=e.y+d*i,g=2*u-t.x,C=2*f-t.y;return{x:g,y:C}}static calcHorizontalSymmetryPointInRect(t,e){const{x:s,y:n,width:i,height:o}=e,a=(s+s+i)/2,l=(n+n+o)/2;return h.calcSymmetryPoint(t,{x:a,y:l},{x:a,y:n})}static calcVerticalSymmetryPointInRect(t,e){const{x:s,y:n,width:i,height:o}=e,a=(s+s+i)/2,l=(n+n+o)/2;return h.calcSymmetryPoint(t,{x:a,y:l},{x:s,y:l})}static batchCalcSymmetryPoints(t,e,s){return t.map(n=>h.calcSymmetryPoint(n,e,s))}static batchCalcSymmetryPointsMuch(t,e){return t.map(s=>(e.forEach(n=>{s=h.calcSymmetryPoint(s,n[0],n[1])}),s))}static scale(t,e){if(e.sx===1&&e.sy===1)return t;const s=h.calcScaleMatrix(e.sx,e.sy),n=h.multiply(s,[t.x,t.y,1]);return{x:n[0],y:n[1]}}static scales(t,e){return t.map(s=>h.scale(s,e))}static scaleWithCenter(t,e,s){return e.sx===1&&e.sy===1?t:(t={x:t.x-s.x,y:t.y-s.y},t=h.scale(t,e),{x:t.x+s.x,y:t.y+s.y})}static batchScaleWithCenter(t,e,s){return t.map(n=>h.scaleWithCenter(n,e,s))}static angleToRadian(t){return t*(Math.PI/180)}static radianToAngle(t){return t*(180/Math.PI)}static isPointInPolygonByRayCasting(t,e){const s=[t.x,t.y],n=e.map(l=>[l.x,l.y]),[i,o]=s;let a=!1;for(let l=0,c=n.length-1;l<n.length;c=l++){const[d,u]=n[l],[f,g]=n[c];if(u>o!=g>o&&i<(f-d)*(o-u)/(g-u)+d&&(a=!a),u===o&&o===g&&i>=Math.min(d,f)&&i<=Math.max(d,f)&&o>=Math.min(u,g)&&o<=Math.max(u,g))return!0}return a}static isPolygonsOverlap(t,e){const s=t.map(f=>[f.x,f.y]),n=e.map(f=>[f.x,f.y]);function i(f){let g=[];for(let C=0;C<f.length;C++){let y=(C+1)%f.length,E=[f[y][0]-f[C][0],f[y][1]-f[C][1]];g.push(E)}return g}function o(f,g){return f[0]*g[0]+f[1]*g[1]}function a(f){return[-f[1],f[0]]}function l(f,g){let C=o(f,g[0]),y=C;for(let E=1;E<g.length;E++){let b=o(f,g[E]);C=Math.min(C,b),y=Math.max(y,b)}return[C,y]}function c(f,g){return f[0]<=g[1]&&g[0]<=f[1]}let d=i(s),u=i(n);for(let f of d.concat(u)){let g=a(f),C=l(g,s),y=l(g,n);if(!c(C,y))return!1}return!0}static calcPolygonCentroid(t){if(!t||t.length===0)throw new Error("顶点数组不能为空");let e=0,s=0;const n=t.length;for(let i=0;i<n;i++)e+=t[i].x,s+=t[i].y;return e/=n,s/=n,{x:e,y:s}}static calcCenter(t){const e=L.getBoxByPoints(t);return h.calcPolygonCentroid(e)}static calcTargetPoint(t,e,s){const n=h.angleToRadian(s),i=t.x+e*Math.cos(n),o=t.y+e*Math.sin(n);return{x:i,y:o}}static calcAngle(t,e){const s=e.x-t.x,n=e.y-t.y;return Math.atan2(n,s)*(180/Math.PI)}static calcInternalAngle(t){return 180-h.calcTriangleAngle(t[0],t[3],t[2])}static calcLeanYAngle(t,e){return e?t-90:90-t}static calcLeanYAngleByPoints(t,e){return h.calcLeanYAngle(h.calcInternalAngle(t),e)}static calcUnLeanByPoints(t,e,s){if(e===0&&s===0)return t;const n=h.calcCenter(t);return h.batchLeanWithCenter(t,-e,-s,n)}static calcFlipXByPoints(t){const e=h.calcCenter(t);return h.isPointClockwiseOfLine(e,t[0],t[3])}static calcViewAngleByPoints(t){const e=h.calcAngle(t[2],t[1]);return h.constraintAngle(e+90)}static calcActualAngleByPoints(t){const e=h.calcInternalAngle(t),s=h.calcLeanYAngle(e,h.calcFlipXByPoints(t)),n=h.calcViewAngleByPoints(t);return h.constraintAngle(n-s)}static constraintAngle(t){for(;t>180;)t-=360;for(;t<-180;)t+=360;return t}static normalizeAngle(t){return t<0&&(t=t+360),t}static calcSegmentLineCenterCrossPoint(t,e,s,n){const i=h.calcCenter([t,e]),o=h.calcAngle(t,e);return h.calcTargetPoint(i,n,s?o+90:o-90)}static calcProjectionOnSegment(t,e,s){const n=h.calcSegmentProportion(t,e,s),i=e.x+n*(s.x-e.x),o=e.y+n*(s.y-e.y);return{x:i,y:o}}static calcDistancePointToLine(t,e,s){const{x:n,y:i}=h.calcProjectionOnSegment(t,e,s);return Math.sqrt((t.x-n)*(t.x-n)+(t.y-i)*(t.y-i))}static calcSegmentProportion(t,e,s){const n=s.x-e.x,i=s.y-e.y,o=t.x-e.x,a=t.y-e.y,l=n*n+i*i;return(o*n+a*i)/l}static isProjectionOnSegment(t,e,s){const n=h.calcSegmentProportion(t,e,s);return n>=0&&n<=1}static calcLimitPointOnSegment(t,e,s){const n=h.calcSegmentProportion(t,e,s);if(n<0)return e;if(n>1)return s}static calcInnerLimitPointOnSegment(t,e,s,n){const i=h.calcSegmentProportion(t,e,s);if(i<0){const o=h.calcAngle(e,s);return h.calcTargetPoint(e,n,o)}else if(i>1){const o=h.calcAngle(s,e);return h.calcTargetPoint(s,n,o)}return t}static isPointClosestSegment(t,e,s,n){return h.isProjectionOnSegment(t,e,s)?h.calcDistancePointToLine(t,e,s)<n:!1}static isPointClosest(t,e,s){return h.calcDistance(t,e)<=s}static isPointClosestWhichPoint(t,e,s){for(let n=0;n<e.length;n++)if(h.isPointClosest(t,e[n],s))return n}static transformToAcuteAngle(t){return t>90&&(t=180-t),t}static calcDistance(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static isRectangle(t){if(t.length!==4)return!1;const e=[h.calcDistance(t[0],t[1]),h.calcDistance(t[1],t[2]),h.calcDistance(t[2],t[3]),h.calcDistance(t[3],t[0])];return new Set(e).size===2}static isSameSign(t,e){return t*e>=0}static precise(t,e=2){if(typeof t!="number"||typeof e!="number")throw new TypeError("Both arguments must be numbers");if(!isFinite(t))return t;const s=Math.pow(10,e),o=(Math.round(t*s)/s).toString().split(".");for(o.length===1&&o.push("");o[1].length<e;)o[1]+="0";return Number(o.join("."))}static batchPrecise(t,e){return t.map(s=>h.precise(s,e))}static precisePoint(t,e){return{x:h.precise(t.x,e),y:h.precise(t.y,e)}}static batchPrecisePoints(t,e=1){return t.map(s=>h.precisePoint(s,e))}static calcTriangleAngle(t,e,s){let n={x:e.x-t.x,y:e.y-t.y},i={x:s.x-e.x,y:s.y-e.y},o=n.x*i.x+n.y*i.y,a=Math.sqrt(n.x*n.x+n.y*n.y),l=Math.sqrt(i.x*i.x+i.y*i.y),c=o/(a*l),u=Math.acos(c)*(180/Math.PI);return isNaN(u)&&(u=0),u}static calcTriangleAngleWithClockwise(t,e,s){const n=h.calcTriangleAngle(t,e,s);return h.isPointClockwiseOfLine(e,t,s)?n:180-n}static calcTriangleAngle2(t,e,s){return Math.acos((Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))/(Math.pow(s.x-t.x,2)+Math.pow(s.y-t.y,2)))*(180/Math.PI)}static calcTriangleAngle3(t,e,s){return Math.acos((Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2))/(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)))*(180/Math.PI)}static calcVectorC(t,e){const s=t.x+e.x,n=t.y+e.y;return{x:s,y:n}}static calcVector(t,e){const s=e.x-t.x,n=e.y-t.y;return{x:s,y:n}}static translateVector(t,e){const s=t.x-e.x,n=t.y-e.y;return{x:s,y:n}}static calcTriangleSide1By2(t,e){const s=t*h.angleToRadian(t);return e/Math.tan(s)}static calcTriangleSide3By1(t,e){const s=t*h.angleToRadian(t);return e/Math.cos(s)}static calcTriangleSide3By2(t,e){const s=h.angleToRadian(t);return e/Math.sin(s)}static calcTriangleSide1By3(t,e){const s=h.angleToRadian(t);return e*Math.cos(s)}static calcTriangleSide2By3(t,e){const s=h.angleToRadian(t);return e*Math.sin(s)}static sortPointsClockwise(t){let e=h.calcCenter(t);return h.sortPointsClockwiseByCenter(t,e)}static sortPointsClockwiseByCenter(t,e){let s=t.map((i,o)=>{let a=Math.atan2(i.y-e.y,i.x-e.x);return{index:o,angle:a}});s.sort((i,o)=>i.angle-o.angle);let n=[];for(let i=0;i<s.length;i++)n.push(t[s[i].index]);return n}static calcPointToSegmentCenterAngle(t,e,s){const n=h.calcCenter([e,s]);return h.calcAngle(t,n)}static resignValue(t,e){return t>=0?Math.abs(e):-Math.abs(e)}static isPointClockwiseOfLine(t,e,s){return(t.x-e.x)*(s.y-e.y)-(t.y-e.y)*(s.x-e.x)<0}static getScaleFromMatrix(t){return{scaleX:t[0][0],scaleY:t[1][1]}}static calculateAngleBisectorIntersection(t){if(t.length!==4)throw new Error("必须提供四个顶点坐标");const e=h.calcBisectors(t),{width:s,height:n}=h.calcParallelogramVerticalSize(t),i=[];return s<n?(i.push(h.calcIntersectionOfLines(e[0],e[1])),i.push(h.calcIntersectionOfLines(e[2],e[3]))):(i.push(h.calcIntersectionOfLines(e[0],e[3])),i.push(h.calcIntersectionOfLines(e[1],e[2]))),i}static calcIntersectionOfLines(t,e){const s=t.point,n=t.direction,i=e.point,o=e.direction,a=n.x*o.y-n.y*o.x;if(Math.abs(a)<1e-6)return null;const l=i.x-s.x,c=i.y-s.y,d=(l*o.y-c*o.x)/a;return(l*n.y-c*n.x)/a,h.precisePoint({x:s.x+d*n.x,y:s.y+d*n.y},1)}static calcBisectors(t){const[e,s,n,i]=t;return t.map((o,a)=>{let l,c;switch(a){case 0:l={x:s.x-e.x,y:s.y-e.y},c={x:i.x-e.x,y:i.y-e.y};break;case 1:l={x:e.x-s.x,y:e.y-s.y},c={x:n.x-s.x,y:n.y-s.y};break;case 2:l={x:s.x-n.x,y:s.y-n.y},c={x:i.x-n.x,y:i.y-n.y};break;case 3:l={x:n.x-i.x,y:n.y-i.y},c={x:e.x-i.x,y:e.y-i.y};break;default:throw new Error("无效的顶点索引")}const d=Math.hypot(l.x,l.y),u=Math.hypot(c.x,c.y),f={x:l.x/d,y:l.y/d},g={x:c.x/u,y:c.y/u},C={x:f.x+g.x,y:f.y+g.y};return{point:o,direction:C}})}static calcCrossPointsOfParallelLines(t,e){const[s,n,i,o]=e,a={x:n.x-s.x,y:n.y-s.y},l={x:i.x-n.x,y:i.y-n.y},c={x:o.x-i.x,y:o.y-i.y},d={x:s.x-o.x,y:s.y-o.y},u={x:s.x-n.x,y:s.y-n.y},f=h.calcIntersectionOfLines({point:s,direction:a},{point:t,direction:d}),g=h.calcIntersectionOfLines({point:n,direction:l},{point:t,direction:a}),C=h.calcIntersectionOfLines({point:i,direction:c},{point:t,direction:l}),y=h.calcIntersectionOfLines({point:o,direction:d},{point:t,direction:u});return[f,g,C,y]}static calcTriangleArea(t,e,s){const n=h.calcDistance(t,e),i=h.calcDistance(e,s),o=h.calcDistance(s,t),a=(n+i+o)/2;return Math.sqrt(a*(a-n)*(a-i)*(a-o))}static calcParallelogramVerticalIntersectionPoints(t,e,s){const[n,i,o,a]=e;let l=h.calcProjectionOnSegment(t,a,n),c=h.calcProjectionOnSegment(t,n,i),d=h.calcProjectionOnSegment(t,i,o),u=h.calcProjectionOnSegment(t,o,a);return s&&(h.isProjectionOnSegment(l,a,n)||(l=h.calcInnerLimitPointOnSegment(l,a,n,.01)),h.isProjectionOnSegment(c,n,i)||(c=h.calcInnerLimitPointOnSegment(c,n,i,.01)),h.isProjectionOnSegment(d,i,o)||(d=h.calcInnerLimitPointOnSegment(d,i,o,.01)),h.isProjectionOnSegment(u,o,a)||(u=h.calcInnerLimitPointOnSegment(u,o,a,.01))),[l,c,d,u]}static calcParallelogramVerticalSize(t){const[e,s,n,i]=t,o=h.calcDistancePointToLine(e,s,n),a=h.calcDistancePointToLine(e,n,i);return{width:o,height:a}}static calcMirrorPointToLine(t,e,s){const n=h.calcProjectionOnSegment(t,e,s),i=h.calcDistance(t,n),o=h.calcAngle(e,s);return h.calcTargetPoint(n,i*2,o)}static calcRelativePointWithCenter(t,e){return{x:t.x-e.x,y:t.y-e.y}}static batchCalcRelativePointWithCenter(t,e){return t.map(s=>h.calcRelativePointWithCenter(s,e))}static calcAbsolutePointWithCenter(t,e){return{x:t.x+e.x,y:t.y+e.y}}static batchCalcAbsolutePointWithCenter(t,e){return t.map(s=>h.calcAbsolutePointWithCenter(s,e))}static calcParrelLine(t,e){const s=h.calcAngle(t.start,t.end),n=h.calcTargetPoint(e,h.calcDistance(t.start,t.end),s);return{start:e,end:n}}static calcVectorAngle(t,e){const s=Math.sqrt(t.x*t.x+t.y*t.y),n=Math.sqrt(e.x*e.x+e.y*e.y),i={x:t.x/s,y:t.y/s},o=i.x*(e.x/n)+i.y*(e.y/n);return Math.acos(o)}static calcMinParallelogramByPoints(t,e,s){if(t.length===0)return[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];const n=Math.sqrt(e.x*e.x+e.y*e.y),i=Math.sqrt(s.x*s.x+s.y*s.y),o={x:e.x/n,y:e.y/n},a={x:s.x/i,y:s.y/i};return h.calculateParallelogram(t,o,a)}static calculateParallelogram(t,e,s){let n=1/0,i=-1/0,o=1/0,a=-1/0;const l=e.x*s.y-e.y*s.x;if(Math.abs(l)<1e-10)return[];for(const g of t){const C=(g.x*s.y-g.y*s.x)/l,y=(e.x*g.y-e.y*g.x)/l;n=Math.min(n,C),i=Math.max(i,C),o=Math.min(o,y),a=Math.max(a,y)}const c={x:n*e.x+o*s.x,y:n*e.y+o*s.y},d={x:i*e.x+o*s.x,y:i*e.y+o*s.y},u={x:i*e.x+a*s.x,y:i*e.y+a*s.y},f={x:n*e.x+a*s.x,y:n*e.y+a*s.y};return[c,d,u,f]}static calcMinParallelogramByPointsByCenter(t,e,s,n){t=h.batchCalcRelativePointWithCenter(t,n),e=h.calcRelativePointWithCenter(e,n),s=h.calcRelativePointWithCenter(s,n);const i=this.calcMinParallelogramByPoints(t,e,s);return h.batchCalcAbsolutePointWithCenter(i,n)}}var R=pr();class L{static getMinX(t){return Math.min(...t.map(e=>e.x))}static getMinY(t){return Math.min(...t.map(e=>e.y))}static getBoxByPoints(t){let e=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER;return t.forEach(o=>{e=Math.min(e,o.x),s=Math.min(s,o.y),n=Math.max(n,o.x),i=Math.max(i,o.y)}),[{x:e,y:s},{x:n,y:s},{x:n,y:i},{x:e,y:i}]}static getRect(t){let e=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER;return t.forEach(o=>{e=Math.min(e,o.x),s=Math.min(s,o.y),n=Math.max(n,o.x),i=Math.max(i,o.y)}),{x:e,y:s,width:n-e,height:i-s}}static getRandomId(){return`${mt(8)}-${mt(4)}`}static getEventPosition(t,e,s){return s=s||1,{x:(t.clientX-e.x)/s,y:(t.clientY-e.y)/s}}static getBoxByCenter(t,e,s){const{width:n,height:i}=e,o=n/2,a=i/2,{x:l,y:c}=t,d=[{x:l-o,y:c-a},{x:l+o,y:c-a},{x:l+o,y:c+a},{x:l-o,y:c+a}];return s&&d.forEach(u=>{Object.assign(u,h.transWithCenter(u,s,t))}),d}static getBoxByLeftTop(t,e){const{width:s,height:n}=e,{x:i,y:o}=t;return[{x:i,y:o},{x:i+s,y:o},{x:i+s,y:o+n},{x:i,y:o+n}]}static getRectBySize(t){const{width:e,height:s}=t;return[{x:0,y:0},{x:e,y:0},{x:e,y:s},{x:0,y:s}]}static getLBRPoints(t,e){let[s,n,i]=L.getLBRPointIndexes(t,e);return s===n&&(s=L.getPrevIndexOfArray(t.length,s)),n===i&&(i=L.getNextIndexOfArray(t.length,i)),[t[s],t[n],t[i]]}static getLBRPointIndexes(t,e){let s,n,i;return e=e??!1,t.forEach((o,a)=>{e||((s===void 0||o.x<t[s].x)&&(s=a),(i===void 0||o.x>t[i].x)&&(i=a)),(n===void 0||o.y>t[n].y)&&(n=a)}),e&&(s=L.getPrevIndexOfArray(t.length,n),i=L.getNextIndexOfArray(t.length,n)),[s,n,i]}static getPrevIndexOfArray(t,e,s=1){let n;for(;n=e-s,n<0&&(n=t+n),!(n>=0););return n}static getPrevOfArray(t,e,s=1){return t[L.getPrevIndexOfArray(t.length,e,s)]}static getNextIndexOfArray(t,e,s=1){let n;for(;n=e+s,n>=t&&(n=n-t),!(n<t););return n}static getNextOfArray(t,e,s=1){return t[L.getNextIndexOfArray(t.length,e,s)]}static calcRectangleSize(t){const e=h.precise(h.calcDistance(t[0],t[1])),s=h.precise(h.calcDistance(t[0],t[3]));return{width:e,height:s}}static calcLineSize(t){const e=h.precise(Math.abs(t[0].x-t[1].x)),s=h.precise(Math.abs(t[0].y-t[1].y));return{width:e,height:s}}static scalePoint(t,e){return t&&{x:t.x*e,y:t.y*e}}static scalePoints(t,e){return e===1?t:t.map(s=>L.scalePoint(s,e))}static calcScale(t,e,s=0){const n=(t.width-s*2)/e.width,i=(t.height-s*2)/e.height;return Math.min(n,i)}static calcRectangleSizeInRect(t,e,s,n=0){const i=s.width-n*2,o=s.height-n*2;if(t>i||e>o){const a=h.precise(t/e,1),l=h.precise(s.width/s.height,2);a>l?(t=i,e=h.precise(t/a,1)):(e=o,t=h.precise(e*a,1))}return{width:t,height:e}}static calcCenterInnerRectPoints(t,e){const{width:s,height:n}=t,{width:i,height:o}=e;return[{x:i/2-s/2,y:o/2-n/2},{x:i/2+s/2,y:o/2-n/2},{x:i/2+s/2,y:o/2+n/2},{x:i/2-s/2,y:o/2+n/2}]}static scaleRect(t,e){const s={};return["x","y","width","height","left","top","right","bottom"].forEach(n=>{const i=t[n];R.isNumber(i)&&(s[n]=h.precise(i*e))}),s}static sortPointsByY(t){return t.sort((e,s)=>e.y-s.y)}static sortPointsByX(t){return t.sort((e,s)=>e.x-s.x)}static calcRenderRect(t,e){const s=h.calcDistance(t[0],t[1]),n=h.calcDistancePointToLine(t[0],t[2],t[3]);return{x:e.x-s/2,y:e.y-n/2,width:s,height:n}}static isPointInRect(t,e){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}static centerRectConversion(t){const{width:e,height:s}=t;return{x:-e/2,y:-s/2,width:e,height:s}}static packRectangles(t,e,s=0){if(t.length===0)return[];let n=Math.ceil(Math.sqrt(t.length));n>=1&&n--;let i=0;for(;n++,i=t.slice(0,n).reduce((y,E)=>y+E.width,0)+(n-1)*s,n!==t.length;){const g=[];for(let y=0;y<t.length;y+=n){const E=t.slice(y,y+n).reduce((b,F)=>b+F.width,0)+(n-1)*s;g.push(E),y+=n}let C=0;for(let y=0;y<g.length;y++)g[y]<=i&&C++;if(C>=Math.ceil(g.length/2))break}const o=[];let a=0,l=0,c=0;const d=e.x-i/2,u=e.y-t[0].height/2;let f=[];for(let g=0;g<n;g++){const{width:C,height:y}=t[g];f.push({x:d+l+(l===0?0:s)+C/2,y:u+y/2,width:C,height:y}),y>c&&(c=y),l+=C+(l===0?0:s)}if(o.push(f),n<t.length){let g=function(){C=-C,a+=c+s,l=0,c=0,f=[]};a+=c,l=0,c=0,f=[];let C=1,y=u+a,E=-1;for(let b=n;b<t.length;b++){const{width:F,height:N}=t[b];f.push({x:d+l+(l===0?0:s)+F/2,y:0,width:F,height:N}),N>c&&(c=N),l+=F+(l===0?0:s),(b<t.length-1&&l+t[b+1].width+s>i||b===t.length-1)&&(o.push(f),C===1?(y=y-a-s-c,E=o.length-1):y=y+a+s+c,f.forEach((w,v)=>{w.y=y+(C===-1?-c:0)+f[v].height/2}),g())}if(E!==-1){const b=o[E],F=Math.max(...b.map(N=>N.height));b.forEach(N=>{N.y=N.y+(F-N.height)})}}return o.flat()}}class _s{constructor(){p(this,"id");this.id=`${L.getRandomId()}`}run(){return Promise.resolve()}}class Xe extends _s{constructor(e,s){super();p(this,"element");p(this,"canvas");this.element=e,this.canvas=s}destroy(){return this.element=null,this.canvas=null,Promise.resolve()}}var A=(r=>(r.moveable="moveable",r.hand="hand",r.rectangle="rectangle",r.line="line",r.image="image",r.polygon="polygon",r.arbitrary="arbitrary",r.pencil="pencil",r.text="text",r.group="group",r.ellipse="ellipse",r))(A||{}),_e=(r=>(r.cursor="cursor",r.shapes="shapes",r.freedom="freedom",r.text="text",r.group="group",r))(_e||{});class V{static deepPlanObjectAssign(t,...e){return e.forEach(s=>{for(const n in s)s.hasOwnProperty(n)&&(R.isPlainObject(s[n])?(t[n]===void 0&&(t[n]={}),this.deepPlanObjectAssign(t[n],s[n])):t[n]=s[n])}),t}static isAllEqualWith(t,e,s){return t.every(n=>s(n,e))}static jsonClone(t){return R.isPlainObject(t)||R.isArray(t)?JSON.parse(JSON.stringify(t)):(console.warn("jsonClone: 非对象或数组类型",t),R.cloneDeep(t))}static isPlainObjectEqual(t,e){const s=Object.keys(t),n=Object.keys(e);return s.length!==n.length?!1:s.every(i=>t[i]===e[i])}static toBooleanObject(t,e=!0){return t.reduce((s,n)=>(typeof n=="string"?s[n]=e:R.isPlainObject(n)&&Object.assign(s,n),s),{})}static isArrayEqual(t,e){return t.length===e.length&&t.every((s,n)=>s===e[n])}static isSetEqual(t,e){return t.size===e.size&&[...t].every(s=>e.has(s))}static reverseArray(t){return R.reverse(t.map(e=>R.isArray(e)?this.reverseArray(e):e))}static moveArrayElementsAfter(t,e,s){let n=[];for(let o=0;o<t.length;o++)e.includes(t[o])||n.push(t[o]);const i=n.findIndex(o=>o===s);return i!==-1?n.splice(i+1,0,...e):n=[...n,...e],n}static moveArryElementsBefore(t,e,s){let n=[];for(let o=0;o<t.length;o++)e.includes(t[o])||n.push(t[o]);const i=n.findIndex(o=>o===s);return i!==-1?n.splice(i,0,...e):n=[...e,...n],n}static insertToArray(t,e,s,...n){const i=[...t];return s?i.splice(e,0,...n):i.splice(e+1,0,...n),i}}var pe=(r=>(r[r.inside=0]="inside",r[r.middle=1]="middle",r[r.outside=2]="outside",r))(pe||{});const vn=[{type:0,name:"内描边"},{type:1,name:"平分线宽"},{type:2,name:"外描边"}],Nr=[{type:1,name:"平分线宽"}];function Vr(r){switch(r){case A.arbitrary:case A.rectangle:case A.ellipse:case A.image:return vn;case A.line:return Nr;default:return vn}}var ot=(r=>(r.top="top",r.middle="middle",r.bottom="bottom",r))(ot||{}),Pe=(r=>(r.none="none",r.lineThrough="line-through",r.overline="overline",r.underline="underline",r))(Pe||{}),Ye=(r=>(r.normal="normal",r.italic="italic",r.bold="bold",r.boldItalic="bold italic",r))(Ye||{}),We=(r=>(r.none="none",r.uppercase="uppercase",r.lowercase="lowercase",r.capitalize="capitalize",r))(We||{});const Hr=1,Wr="#000000",zr=100,jr="#999999",Gr=15,$r=1,Yr="normal",Zs=16,Ur="华文细黑",Xr="#000000",qr=100,Jr="left",Kr="top",Qr="top",Zr=1,eo=100,pi=1.4,to=!0,so=Zs*pi,no=0,io="none",ro="#000000",oo=100,ao=1,lo=0,co="none",en={type:Hr,width:$r,color:Wr,colorOpacity:zr},tn={color:jr,colorOpacity:Gr},$e={fontStyler:Yr,fontSize:Zs,fontFamily:Ur,fontColor:Xr,fontColorOpacity:qr,fontLineHeight:so,fontLineHeightFactor:pi,fontLineHeightAutoFit:to,textAlign:Jr,textBaseline:Kr,textVerticalAlign:Qr,fontLetterSpacing:no,textDecoration:io,textDecorationColor:ro,textDecorationOpacity:oo,textDecorationThickness:ao,paragraphSpacing:lo,textCase:co},Ee={strokes:[{...en}],fills:[{...tn}],...$e},wn=["fontSize","fontFamily"],Tn=r=>{const t=V.jsonClone(Ee);return[A.line,A.arbitrary].includes(r)&&t.strokes.forEach(e=>{e.width=Zr}),[A.image,A.arbitrary,A.text].includes(r)&&t.fills.forEach(e=>{e.colorOpacity=0}),[A.text].includes(r)&&t.strokes.forEach(e=>{e.width=0}),t},Ci=[{name:"Arial",url:"@/assets/fonts/Arial.ttf"},{name:"Arial bold",url:"@/assets/fonts/Arialbd.ttf"},{name:"Arial bold italic",url:"@/assets/fonts/Arialbi.ttf"},{name:"Arial italic",url:"@/assets/fonts/Ariali.ttf"},{name:"CascadiaCode",url:"@/assets/fonts/CascadiaCode.ttf"},{name:"CascadiaCode italic",url:"@/assets/fonts/CascadiaCodeItalic.ttf"},{name:"CascadiaMono",url:"@/assets/fonts/CascadiaMono.ttf"},{name:"CascadiaMono italic",url:"@/assets/fonts/CascadiaMonoItalic.ttf"},{name:"Comic",url:"@/assets/fonts/Comic.ttf"},{name:"Comic bold",url:"@/assets/fonts/Comicbd.ttf"},{name:"Comic italic",url:"@/assets/fonts/Comici.ttf"},{name:"Comic zero",url:"@/assets/fonts/Comicz.ttf"},{name:"隶书",url:"@/assets/fonts/隶书.ttf"},{name:"楷体",url:"@/assets/fonts/楷体.ttf"},{name:"幼圆",url:"@/assets/fonts/幼圆.ttf"},{name:"华文彩云",url:"@/assets/fonts/华文彩云.ttf"},{name:"华文隶书",url:"@/assets/fonts/华文隶书.ttf"},{name:"华文行楷",url:"@/assets/fonts/华文行楷.ttf"},{name:"华文细黑",url:"@/assets/fonts/华文细黑.ttf"},{name:"华文琥珀",url:"@/assets/fonts/华文琥珀.ttf"},{name:"华文楷体",url:"@/assets/fonts/华文楷体.ttf"},{name:"华文新魏",url:"@/assets/fonts/华文新魏.ttf"},{name:"华文宋体",url:"@/assets/fonts/华文宋体.ttf"},{name:"华文仿宋",url:"@/assets/fonts/华文仿宋.ttf"},{name:"华文中宋",url:"@/assets/fonts/华文中宋.ttf"}],ho=R.range(12,121,2).map(r=>({name:r.toString(),value:r})),uo=R.range(12,121,2).map(r=>({name:r.toString(),value:r})),fo=R.range(0,101,1).map(r=>({name:r.toString(),value:r})),go=R.range(0,101,4).map(r=>({name:r.toString(),value:r})),mo=R.range(1,2.1,.1).map(r=>(r=Math.round(r*10)/10,{name:r.toString(),value:r}));class Ns{static hashToRgba(t,e){if(!/^#([0-9A-F]{3}){1,2}$/i.test(t))throw new Error("Invalid color format");let s=t.slice(1);s.length===3&&(s=s.split("").map(a=>a+a).join(""));const n=parseInt(s.substring(0,2),16),i=parseInt(s.substring(2,4),16),o=parseInt(s.substring(4,6),16);return`rgba(${n}, ${i}, ${o}, ${e})`}static getRandomColor(){const t="0123456789ABCDEF";let e="#";for(let s=0;s<6;s++)e+=t[Math.floor(Math.random()*16)];return e}}class Ae{static joinFillColor(t){return t.color?`${Ns.hashToRgba(t.color,t.colorOpacity/100)}`:""}static joinStrokeColor(t){return t.color?`${Ns.hashToRgba(t.color,t.colorOpacity/100)}`:""}static joinFont(t){return`${t.fontSize}px ${t.fontFamily}`}}class Ue{static calcIOPoint(t,e,s,n,i){const o=s/2,a=h.calcTriangleSide3By2(o,n);let l=h.calcAngle(t,e);l<0&&(l+=360);let c=o+l;return h.calcTargetPoint(t,a,i?c:c+180)}static getPolygonVertices(t,e,s){const n=h.sortPointsClockwise(t);return n.map((i,o)=>{const a=L.getPrevOfArray(n,o),l=L.getNextOfArray(n,o),c=h.calcTriangleAngle(a,i,l);return Ue.calcIOPoint(i,l,c,e,s)})}static getPolygonInnerVertices(t,e){return Ue.getPolygonVertices(t,e,!0)}static getPolygonOuterVertices(t,e){return Ue.getPolygonVertices(t,e,!1)}static calcBentLineOuterVertices(t,e){const s=[];return s.push(...Ue.calcBentLineClockWisePoints(t,e,!0)),s.push(...Ue.calcBentLineClockWisePoints(t.reverse(),e,!0)),s}static calcBentLineClockWisePoints(t,e,s){const n=[];for(let i=0;i<t.length-1;i++){const o=t[i],a=t[i+1];let l=h.calcAngle(o,a);s?l=l+90:l=l-90,n.push(h.calcTargetPoint(o,e,l)),i===t.length-2&&n.push(h.calcTargetPoint(a,e,l))}return n}}class Qe{static getArbitraryInnerVertices(t,e,s){return Qe.getArbitraryVertices(t,e,!0,s)}static getArbitraryOuterVertices(t,e,s){return Qe.getArbitraryVertices(t,e,!1,s)}static getArbitraryVertices(t,e,s,n){return t.length===1?t:t.length===2?Ue.calcBentLineClockWisePoints(t,e,s):t.map((i,o)=>{const a=L.getPrevOfArray(t,o),l=L.getNextOfArray(t,o),c=h.isPointClockwiseOfLine(l,a,i);let d=h.calcTriangleAngle(a,i,l);c?d=180-d:d=180+d;const{isFold:u=!0}=n;if(!u&&[0,t.length-1].includes(o)){let f;return o===0?f=h.calcAngle(i,l)+(s?90:-90):f=h.calcAngle(i,a)+(s?-90:90),h.calcTargetPoint(i,e,f)}else return Ue.calcIOPoint(i,l,d,e,s)})}}class Vs{static isMultiLine(t){return t.indexOf(`
`)!==-1}static replaceAZero(t){return t.replaceAll(" "," ")}}class yi{static measureText(t,e){const{fontSize:s,fontFamily:n,textBaseline:i,textAlign:o}=e,a=t.split(`
`);let l=0,c=0,d=document.createElement("canvas"),u=d.getContext("2d");u.font=`${s}px ${n}`,i&&(u.textBaseline=i),o&&(u.textAlign=o),a.forEach(g=>{g=g||" ",g=Vs.replaceAZero(g);const C=u.measureText(g),{width:y,fontBoundingBoxAscent:E,fontBoundingBoxDescent:b}=C;y>l&&(l=y),c+=E+b});const f={width:l,height:c};return u=null,d=null,f}static measureTextWithSpan(t,e){const{fontSize:s,fontFamily:n,textBaseline:i,textAlign:o,fontLineHeight:a}=e,l=t.split(`
`);let c=0,d=0;const u=document.createElement("span");document.body.appendChild(u),u.style.visibility="hidden",u.style.fontSize=`${s}px`,u.style.fontFamily=n,u.style.display="inline-block",a&&(u.style.lineHeight=`${a}px`),i&&(u.style.verticalAlign=i),o&&(u.style.textAlign=o),l.forEach(g=>{g=g||" ",g=Vs.replaceAZero(g),u.textContent=g;const C=u.offsetWidth;C>c&&(c=C),d+=u.offsetHeight});const f={width:c,height:d};return document.body.removeChild(u),f}static isFontEqualForMeasureText(t,e){return t=R.pick(t,wn),e=R.pick(e,wn),V.isPlainObjectEqual(t,e)}}class ce{static isDeleterKey(t){return t===8||t===46}static isArrowLeft(t){return t===37}static isArrowRight(t){return t===39}static isArrowUp(t){return t===38}static isArrowDown(t){return t===40}static isCtrl(t){return t===17}static isA(t){return t===65}static isC(t){return t===67}static isV(t){return t===86}static isZ(t){return t===90}static isY(t){return t===89}static isX(t){return t===88}static isEnter(t){return t===13}static isLowerCaseLetter(t){return t.length===1&&/[a-z]/.test(t)}static isUpperCaseLetter(t){return t.length===1&&/[A-Z]/.test(t)}static isEnglishLetter(t){return t.length===1&&/[a-zA-Z]/.test(t)}static isSpace(t){return t.length===1&&(t.charCodeAt(0)===32||t.charCodeAt(0)===160||t.charCodeAt(0)===12288)}}function An(r,t,e){r.forEach((s,n)=>{t.save();const i=G.transFontWithScale(s.fontStyle);let{fontColor:o,fontColorOpacity:a,fontSize:l,fontFamily:c,fontStyler:d}=i;t.fillStyle=Ae.joinFillColor({color:o,colorOpacity:a}),t.font=`${d!==Ye.normal?d:""} ${l}px ${c}`,e&&e(s,n),t.restore()})}function po(r,t,e,s,n){const{renderContent:i,fontStyle:o}=r,{width:a}=e;let l=0;if(t!==0&&ce.isEnglishLetter(i)){const c=s[t-1],{renderContent:d,fontStyle:u,renderWidth:f}=c;if(ce.isEnglishLetter(d)&&yi.isFontEqualForMeasureText(o,u)){const{width:g}=n.measureText(d+i),C=f+a;g<C&&(l=g-C)}}return l}function Co(r,t,e,s,n,i){const{content:o}=r;let a=o;switch(n){case We.uppercase:a=o.toUpperCase();break;case We.lowercase:a=o.toLowerCase();break;case We.capitalize:{if(ce.isEnglishLetter(o)){let l=!1,c;if(t===0)if(s!==0){const d=i.lines[s-1];d.isTailBreak||(c=d.nodes[d.nodes.length-1])}else a=o.toUpperCase(),l=!0;else c=e.nodes[t-1];l||(c&&!ce.isEnglishLetter(c.content)?a=o.toUpperCase():ce.isUpperCaseLetter(o)||(a=o.toLowerCase()))}break}}return a}function On(r,t){const{renderX:e,renderY:s,width:n,fontBoundingBoxDescent:i,fontStyle:{textDecoration:o,textDecorationThickness:a,textDecorationColor:l,textDecorationOpacity:c}}=t;if(o!==Pe.none&&a!==0){r.save(),r.lineWidth=a*G.scale,r.strokeStyle=Ae.joinFillColor({color:l,colorOpacity:c});const d=e,u=d+n;switch(o){case Pe.underline:{const f=s+i+a/2;r.beginPath(),r.moveTo(d,f),r.lineTo(u,f),r.stroke();break}case Pe.lineThrough:{const f=s+(i+a)/2;r.beginPath(),r.moveTo(d,f),r.lineTo(u,f),r.stroke();break}case Pe.overline:{const f=s-a/2;r.beginPath(),r.moveTo(d,f),r.lineTo(u,f),r.stroke();break}}r.restore()}}const B=class B{static async cacheStringImages(t){await Promise.all(t.map(e=>B.cacheStringImage(e)))}static async cacheStringImage(t){return new Promise((e,s)=>{const n=new Image;n.src=t,n.onload=()=>{B.ImageCaches.set(t,n),e()},n.onerror=()=>{s()}})}static convertPointsByStrokeType(t,e,s,n){if(!s)return t;const{flipX:i=!1,flipY:o=!1}=n,a=s/2;switch(e){case pe.inside:return i!==o?Qe.getArbitraryOuterVertices(t,a,n):Qe.getArbitraryInnerVertices(t,a,n);case pe.middle:return t;case pe.outside:return i!==o?Qe.getArbitraryInnerVertices(t,a,n):Qe.getArbitraryOuterVertices(t,a,n)}}static async drawImgLike(t,e,s,n={}){return new Promise((i,o)=>{if(e instanceof ImageData&&(e=B.getCanvasByImageData(e).toDataURL()),typeof e=="string"){if(B.ImageCaches.has(e)){B.drawRotateImage(t,B.ImageCaches.get(e),s,n),i();return}const a=new Image;a.src=e,a.onload=()=>{B.ImageCaches.set(e,a),B.drawRotateImage(t,a,s,n),i()},a.onerror=()=>{o()}}else(e instanceof HTMLCanvasElement||e instanceof HTMLImageElement)&&B.drawRotateImage(t,e,s,n),i()})}static getTransformValues(t){let{angle:e=0,flipX:s=!1,leanY:n,actualAngle:i}=t;typeof i=="number"&&(e=i);let o=h.angleToRadian(e),a=1,l=1;return s&&(a=-1,o=-o,n=-n),{radian:o,scaleX:a,scaleY:l,leanY:n}}static transformCtx(t,e,s){const{x:n,y:i,width:o,height:a}=e,{radian:l,scaleX:c,scaleY:d,leanY:u}=s;t.translate(n+o/2,i+a/2),t.scale(c,d),t.rotate(l),t.transform(1,0,u,1,0,0)}static calcOffsetByRect(t){const{x:e,y:s,width:n,height:i}=t;return{x:-e-n/2,y:-s-i/2}}static transPointsOfBox(t,e){const s=B.calcOffsetByRect(e);return h.batchTranslate(t,s)}static translateArcPoints(t,e){const s=B.calcOffsetByRect(e);return h.translateArcPoints(t,s)}static drawClipArcPoints(t,e,s){e=B.transArcParamsWithScale(e)[0],e=B.translateArcPoints(e,s),t.beginPath(),B.drawBazierPoints(e,t),t.closePath(),t.clip()}static drawRotateImage(t,e,s,n={}){const{width:i,height:o,desX:a,desY:l,desWidth:c,desHeight:d}=s,u=t.getContext("2d");u.save(),B.transformCtx(u,s,this.getTransformValues(n)),n.clipArcPoints&&B.drawClipArcPoints(u,n.clipArcPoints,s),R.every([a,l,c,d],R.isNumber)?u.drawImage(e,a-c/2,l,c,d):u.drawImage(e,-i/2,-o/2,i,o),u.restore()}static drawRotateImageData(t,e,s,n={}){const i=B.getCanvasByImageData(e);B.drawRotateImage(t,i,s,n)}static drawRectInRenderRect(t,e,s,n={}){const{width:i,height:o,desX:a,desY:l,desWidth:c,desHeight:d}=e,u=t.getContext("2d");u.save(),B.transformCtx(u,e,this.getTransformValues(n)),u.fillStyle=Ae.joinFillColor(s),R.every([a,l,c,d],R.isNumber)?u.fillRect(a,l,c,d):u.fillRect(-i/2,-o/2,i,o),u.restore()}static drawLineInRenderRect(t,e,s,n={}){const{desX:i,desY:o,desWidth:a}=e,l=t.getContext("2d");l.save(),B.transformCtx(l,e,this.getTransformValues(n)),l.strokeStyle=Ae.joinStrokeColor(s),l.lineWidth=s.width,R.every([i,o,a],R.isNumber)&&(l.beginPath(),l.moveTo(i,o),l.lineTo(i+a,o),l.stroke()),l.restore()}static drawRotateText(t,e,s,n,i,o={}){const{fontColor:a,fontFamily:l,fontSize:c,textAlign:d,textBaseline:u,fontLineHeight:f,fontColorOpacity:g,textVerticalAlign:C,paragraphSpacing:y,fontStyler:E,textCase:b}=i,{flipX:F}=o,N=t.getContext("2d");N.save(),B.transformCtx(N,n,this.getTransformValues(o)),s=B.transPointsOfBox(s,n),N.font=`${E!==Ye.normal?E:""} ${c}px ${l}`,N.textBaseline=u,N.fillStyle=Ae.joinFillColor({color:a,colorOpacity:g});let w=s[0].y;const{x:v}=s[0],{x:P}=s[1],D=F?-v:v,M=Math.abs(P-v),J=Math.abs(s[3].y-s[0].y),K=e.lines.filter(Le=>Le.isTailBreak).length;let ge=f*e.lines.length+(K-1)*y;C==="middle"?w=s[0].y+(J-ge)/2:C==="bottom"&&(w=s[0].y+(J-ge));const{alphabeticBaseline:Ie,fontBoundingBoxAscent:Ze,fontBoundingBoxDescent:st}=N.measureText("a"),ht=st-Ze;e.lines.forEach((Le,ut)=>{let et=0,ke=D;Object.assign(Le,{x:D,y:w,width:M,height:f,renderWidth:0,renderHeight:f,renderY:w});const{nodes:nt,isTailBreak:Ls}=Le;if(nt.length!==0){const Xt=w-Ie+(f-ht)/2;An(nt,N,(Ve,At)=>{const{fontStyle:{fontLetterSpacing:qt}}=Ve,Ot=Co(Ve,At,Le,ut,b,e);Ve.renderContent=Ot;const It=N.measureText(Ot),{width:Jt,fontBoundingBoxDescent:Lt,fontBoundingBoxAscent:Cn,alphabeticBaseline:ar}=It,Ps=po(Ve,At,It,nt,N),lr=qt*B.scale,Rs=Jt+lr,Kt=ke+Ps,yn=Xt+ar;Object.assign(Ve,{x:Kt,y:w,width:Rs,height:f,indentX:Ps,renderX:Kt,renderY:yn,renderWidth:Jt,renderHeight:Lt-Cn,fontBoundingBoxDescent:Lt,fontBoundingBoxAscent:Cn,baseline:Xt}),ke=Kt+Rs,et+=Rs+Ps,At===Le.nodes.length-1&&(Le.renderWidth=et),d==="left"&&(N.fillText(Ot,Kt,yn),On(N,Ve))}),d==="right"?ke=D+M-et:d==="center"&&(ke=D+M/2-et/2),d!=="left"&&(Le.renderX=ke,An(nt,N,Ve=>{const{renderY:At,width:qt,renderWidth:Ot,indentX:It,renderContent:Jt}=Ve,Lt=ke+It+qt-Ot;Object.assign(Ve,{x:ke,renderX:Lt}),N.fillText(Jt,Lt,At),On(N,Ve),ke+=qt+It}))}Le.height=f,w+=f,Ls&&(w+=y)}),N.restore()}static drawRotateTextWithScale(t,e,s,n,i,o={}){s=L.scalePoints(s,B.scale),i=B.transFontWithScale(i),B.drawRotateText(t,e,s,n,i,o)}static drawCommonRotateText(t,e,s,n,i,o={}){const{angle:a=0}=o,l=t.getContext("2d");l.save(),l.translate(s.x,s.y),l.rotate(h.angleToRadian(a)),l.font=Ae.joinFont(n),l.fillStyle=Ae.joinFillColor(i),l.textAlign=n.textAlign,l.textBaseline=n.textBaseline,l.fillText(e,0,0),l.restore()}static measureText(t,e,s){t.save(),t.font=Ae.joinFont(s),t.textAlign=s.textAlign,t.textBaseline=s.textBaseline;const n=t.measureText(e);return t.restore(),n}static drawCommonRotateTextWithScale(t,e,s,n,i,o={}){s=L.scalePoint(s,B.scale),B.drawCommonRotateText(t,e,s,n,i,o)}static transStrokeWithScale(t){return B.scale===1?t:{...t,width:t.width*B.scale}}static transFontWithScale(t){return B.scale===1?t:{...t,fontSize:t.fontSize*B.scale,fontLineHeight:t.fontLineHeight*B.scale,paragraphSpacing:t.paragraphSpacing*B.scale}}static transArcParamsWithScale(t,e){return B.scale===1?[t,e]:(t=B.scaleArcPoints(t),e&&(e={...e,width:e.width*B.scale}),[t,e])}static transEllipseModelWithScale(t){return B.scale===1?t:{...t,rx:t.rx*B.scale,ry:t.ry*B.scale}}static drawPathWithScale(t,e,s,n,i={}){e=L.scalePoints(e,B.scale),n=B.transStrokeWithScale(n),s.colorOpacity&&B.drawInnerPathFill(t,e,s,n,i),n.width&&n.colorOpacity&&B.drawPathStroke(t,e,n,i)}static drawInnerPathFill(t,e,s,n,i={}){const{calcVertices:o=!0}=i;let a;o?a=Qe.getArbitraryInnerVertices(e,n.width/2,i):a=e,B.drawPathFill(t,a,s)}static drawInnerPathFillWithScale(t,e,s,n,i={}){e=L.scalePoints(e,B.scale),n=B.transStrokeWithScale(n),s.colorOpacity&&B.drawInnerPathFill(t,e,s,n,i)}static scaleArcPoints(t){return B.scale===1||(t=t.map(e=>{const{start:s,controller:n,end:i,value:o,corner:a}=e,[l,c,d,u]=L.scalePoints([s,n,i,a],B.scale);return{start:l,controller:c,end:d,corner:u,value:o*B.scale}})),t}static drawInnerArcPathFillWithScale(t,e,s,n,i={}){s=B.scaleArcPoints(s),n.colorOpacity&&B.drawArcPathFill(t,s,e,n,i)}static drawPathStrokeWidthScale(t,e,s,n={}){e=L.scalePoints(e,B.scale),s=B.transStrokeWithScale(s),B.drawPathStroke(t,e,s,n)}static drawArcPathStrokeWidthScale(t,e,s,n,i={}){[e,n]=B.transArcParamsWithScale(e,n),B.drawArcPathStroke(t,e,s,n,i)}static drawPathStroke(t,e,s,n={}){const{isFold:i=!0,miterLimit:o}=n,a=t.getContext("2d");a.save(),o&&(a.miterLimit=o),a.strokeStyle=Ae.joinStrokeColor(s),a.beginPath(),e.forEach((l,c)=>{c===0?a.moveTo(l.x,l.y):a.lineTo(l.x,l.y)}),i&&a.closePath(),s.width&&(a.lineWidth=s.width,a.stroke()),a.restore()}static calcStartOfArcPoints(t){let e=0,s;const[n,i,o]=t,a=t.map(d=>d.controller),{width:l,height:c}=h.calcParallelogramVerticalSize(a);return l>=c?(s=h.calcCenter([n.end,i.start]),e=1):(s=h.calcCenter([i.end,o.start]),e=2),{point:s,index:e}}static arcToBezierPoints(t,e){let{point:s,index:n}=B.calcStartOfArcPoints(t),i=0,o=t[n];for(;o;){const{start:a,controller:l,end:c,corner:d,value:u}=o;if(i===0&&e.moveTo(s.x,s.y),u){const f=h.calcDistance(a,d);e.arcTo(l.x,l.y,c.x,c.y,f)}else e.lineTo(l.x,l.y);if(o=L.getNextOfArray(t,n,1),n++,n>=t.length&&(n=0),i++,i>=t.length)break}}static drawBazierPoints(t,e){t.forEach((s,n)=>{const{start:i,controller:o,end:a,value:l}=s;n===0?e.moveTo(i.x,i.y):e.lineTo(i.x,i.y),l?e.arcTo(o.x,o.y,a.x,a.y,l):e.lineTo(o.x,o.y)})}static drawArcPathStroke(t,e,s,n,i={}){const{isFold:o=!0}=i,a=t.getContext("2d");a.save(),B.transformCtx(a,s,B.getTransformValues(i)),a.miterLimit=0,a.lineCap="round",a.strokeStyle=Ae.joinStrokeColor(n),a.beginPath(),e=B.translateArcPoints(e,s),B.drawBazierPoints(e,a),o&&a.closePath(),n.width&&(a.lineWidth=n.width,a.stroke()),a.restore()}static drawPathFill(t,e,s){const n=t.getContext("2d");n.save(),n.fillStyle=Ae.joinFillColor(s),n.beginPath(),e.forEach((i,o)=>{o===0?n.moveTo(i.x,i.y):n.lineTo(i.x,i.y)}),n.closePath(),n.fill(),n.restore()}static drawArcPathFill(t,e,s,n,i={}){const o=t.getContext("2d");o.save(),B.transformCtx(o,s,B.getTransformValues(i)),o.fillStyle=Ae.joinFillColor(n),o.beginPath(),e=B.translateArcPoints(e,s),B.drawBazierPoints(e,o),o.closePath(),o.fill(),o.restore()}static transformEllipse(t,e,s,n,i){return n&&i&&(B.transformCtx(t,n,B.getTransformValues(i)),e=B.transPointsOfBox([e],n)[0]),s=B.transEllipseModelWithScale(s),{point:e,model:s}}static drawEllipseFill(t,e,s,n,i,o){const a=t.getContext("2d");a.save();const{point:{x:l,y:c},model:{rx:d,ry:u}}=B.transformEllipse(a,e,s,i,o);a.fillStyle=Ae.joinFillColor(n),a.beginPath(),a.ellipse(l,c,d,u,0,0,Math.PI*2),a.closePath(),a.fill(),a.restore()}static drawEllipseStroke(t,e,s,n,i,o){const a=t.getContext("2d");a.save();const{point:{x:l,y:c},model:{rx:d,ry:u}}=B.transformEllipse(a,e,s,i,o);a.lineWidth=n.width,a.strokeStyle=Ae.joinStrokeColor(n),a.beginPath(),a.ellipse(l,c,d,u,0,0,Math.PI*2),a.closePath(),a.stroke(),a.restore()}static drawEllipseStrokeWithScale(t,e,s,n,i,o){const a=L.scalePoints([e],B.scale);n=B.transStrokeWithScale(n),B.drawEllipseStroke(t,a[0],s,n,i,o)}static drawEllipseFillWithScale(t,e,s,n,i,o){const a=L.scalePoints([e],B.scale);B.drawEllipseFill(t,a[0],s,n,i,o)}static drawLine(t,e,s){const n=t.getContext("2d");n.save(),n.beginPath(),n.lineWidth=s.width,n.strokeStyle=Ae.joinStrokeColor(s),e.forEach((i,o)=>{o===0?n.moveTo(i.x,i.y):n.lineTo(i.x,i.y)}),n.closePath(),n.stroke(),n.restore()}static drawLineWidthScale(t,e,s){e=L.scalePoints(e,B.scale),s=B.transStrokeWithScale(s),B.drawLine(t,e,s)}static getImageDataFromBlob(t){return new Promise((e,s)=>{const n=new Image;n.onload=()=>{const i=document.createElement("canvas");i.width=n.width,i.height=n.height;const o=i.getContext("2d");o.drawImage(n,0,0);const a=o.getImageData(0,0,n.width,n.height);e(a)},n.onerror=s,n.src=URL.createObjectURL(t)})}static getImageDataFromImage(t){return new Promise((e,s)=>{const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const i=n.getContext("2d");i?(i.drawImage(t,0,0),e(i.getImageData(0,0,t.width,t.height))):s(new Error("Failed to get 2d context from canvas"))})}static getCanvasByImageData(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");return s&&s.putImageData(t,0,0),e}static getDataUrlFromImage(t){return new Promise((e,s)=>{const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const i=n.getContext("2d");i?(i.drawImage(t,0,0),e(n.toDataURL())):s(new Error("Failed to get 2d context from canvas"))})}static getRadiusRectanglePaths(t,e,s,n){const i=e/2,o=s/2;n=n||{x:i,y:o};const{x:a,y:l}=n,[c,d,u,f]=t,g={x:a-i,y:l-o},C={x:a+i,y:l-o},y={x:a+i,y:l+o},E={x:a-i,y:l+o},b=[];return b.push({start:{x:a-i,y:l-o+c},controller:g,end:{x:a-i+c,y:l-o},value:c}),b.push({start:{x:a+i-d,y:l-o},controller:C,end:{x:a+i,y:l-o+d},value:d}),b.push({start:{x:a+i,y:l+o-u},controller:y,end:{x:a+i-u,y:l+o},value:u}),b.push({start:{x:a-f,y:l+o},controller:E,end:{x:a-i,y:l+o-f},value:f}),b}};p(B,"ImageCaches",new Map),p(B,"scale",1);let G=B;class re{}p(re,"stageParams");class Oe{static calcElementRenderRect(t){const{rotateBoxCoords:e,center:s}=t;return Oe.calcRenderRect(e,s,re.stageParams.scale)}static calcRenderRect(t,e,s){let n=L.calcRenderRect(t,e);return n=L.scaleRect(n,s),n}static convertCoordInRect(t,e,s){const{angles:n,centerCoord:i,flipX:o}=e;t=h.transWithCenter(t,n,i,!0);let a=k.calcStageRelativePoint(t);a=L.scalePoint(a,re.stageParams.scale);let[l]=G.transPointsOfBox([a],s);return o&&(l=h.calcHorizontalSymmetryPointInRect(l,L.centerRectConversion(s))),l}}const yo="data:image/svg+xml,%3csvg%20t='1742220316555'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='19653'%20width='200'%20height='200'%3e%3cpath%20d='M506.016%200c20%200%2036%2016%2036%2036v952c0%2020-16%2036-36%2036s-36-16-36-36V36c0-20%2016-36%2036-36z'%20p-id='19654'%20fill='%23e74b1f'%3e%3c/path%3e%3c/svg%3e";class Es{static drawArcRect(t,e){const{arcCoords:s,arcFillCoords:n,model:{styles:i},angle:o,flipX:a,leanY:l,actualAngle:c}=t,d={angle:o,flipX:a,leanY:l,actualAngle:c},u=k.batchCalcStageRelativeArcPoints(s),f=k.calcStageRelativeArcPoints(n),g=Oe.calcElementRenderRect(t);i.fills.forEach(C=>{G.drawInnerArcPathFillWithScale(e,g,f,C,d)}),u.forEach((C,y)=>{G.drawArcPathStrokeWidthScale(e,C,g,i.strokes[y],d)})}static drawTextCursor(t,e,s){const{angle:n,flipX:i,leanY:o,actualAngle:a}=t;if(!s)return;const l=Oe.calcElementRenderRect(t),{x:c,y:d,width:u,height:f}=s,g={angle:n,flipX:i,leanY:o,actualAngle:a};G.drawImgLike(e,yo,{...l,desX:c,desY:d,desWidth:u,desHeight:f},{...g})}}class _o extends Xe{async run(){!this.canvas||!this.element||Es.drawArcRect(this.element,this.canvas)}}const Eo={subs:!1,deepSubs:!1},sn={angle:0,leanYAngle:0,internalAngle:90,actualAngle:0,viewAngle:0},os={corners:[0,0,0,0]},xo={view:!0,leanY:!0,actual:!0,internal:!0},So={size:!0,position:!0,points:!0,rotation:!0,angles:!0,originals:!0,outline:!0,strokes:!0,corners:!0};var Mt=(r=>(r.before="before",r.after="after",r.inner="inner",r.none="none",r))(Mt||{});const Bt="#0c8ce9",bo=100,vo="#0c8ce9",wo=2.5,To=1,Ao="#0c8ce9",Oo=100,Io="#ffffff",Lo=100,Po=1,as=6,ls=12,Ro=12,ko=20,Fo="#0c8ce9",Bo=100,Do="#ffffff",Mo=100,No=12,Vo="Arial",Ho="center",Wo="middle",zo="#0c8ce9",jo=1,Go=85,$o="#0c8ce9",Yo=25,Uo=as+Math.sqrt(Math.pow(ls/2,2)),In={strokes:[{type:pe.middle,width:To,color:Bt,colorOpacity:bo}],fills:[{color:vo,colorOpacity:wo}]},Nt={strokes:[{type:pe.middle,width:Po,color:Ao,colorOpacity:Oo}],fills:[{color:Io,colorOpacity:Lo}]},Hs={fontSize:No,fontFamily:Vo,textAlign:Ho,textBaseline:Wo},Xo={color:Fo,colorOpacity:Bo},qo={color:Do,colorOpacity:Mo},Ln=Hs,Pn=20,es=3;class _i{constructor(t){p(this,"id");p(this,"isActive");p(this,"host");this.host=t,this.id=L.getRandomId(),this.isActive=!1}get angle(){return 0}get scale(){return 1/re.stageParams.scale}isCoordHitting(t){return!1}}class nn extends _i{constructor(e,s){super(e);p(this,"width");p(this,"height");p(this,"x");p(this,"y");p(this,"points");const{points:n=[],x:i=0,y:o=0,width:a=0,height:l=0}=s||{};this.points=n,this.x=i,this.y=o,this.width=a,this.height=l}isContainsCoord(e){return h.isPointInPolygonByRayCasting(e,this.points)}isCoordHitting(e){return this.isContainsCoord(e)}}class $t extends nn{constructor(){super(...arguments);p(this,"width",ls);p(this,"height",ls)}get angle(){return this.host.viewAngle-90}refresh(){if(!this.host.rotationEnable)return;const{x:e,y:s}=k.calcElementRotatePoint(this.host);this.x=e,this.y=s,this.points=L.getBoxByCenter({x:e,y:s},{width:this.width/re.stageParams.scale,height:this.height/re.stageParams.scale}).map(n=>h.rotateWithCenter(n,this.host.viewAngle,{x:e,y:s}))}isContainsCoord(e){return this.host.rotationEnable?h.isPointInPolygonByRayCasting(e,this.points):!1}}var ct=(r=>(r[r.rect=0]="rect",r[r.circle=1]="circle",r))(ct||{});class _t extends nn{get angle(){return h.calcAngle(this.host.centerCoord,{x:this.x,y:this.y})+90}}class Jo extends _i{constructor(e,s){super(e);p(this,"start");p(this,"end");p(this,"index");const{start:n,end:i,index:o}=s||{};n&&(this.start=n),i&&(this.end=i),R.isNumber(o)&&(this.index=o)}get angle(){return h.calcAngle(this.start,this.end)}isClosest(e){return h.isPointClosestSegment(e,this.start,this.end,Fr/re.stageParams.scale)}isCoordHitting(e){return this.isClosest(e)}}class Ht extends Jo{}const Ko=[.25,.5,1,2,3,4,5];var ts=(r=>(r[r.vertices=0]="vertices",r[r.border=1]="border",r))(ts||{}),Fe=(r=>(r[r.vertices=0]="vertices",r[r.border=1]="border",r[r.hand=2]="hand",r[r.cross=3]="cross",r[r.move=4]="move",r[r.rotation=5]="rotation",r))(Fe||{});const Qo=100,Zo=20;class Ei extends $t{get angle(){return h.calcAngle(this.host.centerCoord,{x:this.x,y:this.y})+45}}const je={[A.moveable]:"icon-verbise-arrow-cursor-2--mouse-select-cursor",[A.hand]:"icon-verbise-hand",[A.rectangle]:"icon-verbise-Rectangle",[A.line]:"icon-verbise-line",[A.polygon]:"icon-verbise-polygon",[A.image]:"icon-verbise-Image",[A.arbitrary]:"icon-verbise-pen",[A.pencil]:"icon-verbise-pencil",[A.ellipse]:"icon-verbise-eclipse",[A.text]:"icon-verbise-text",[A.group]:"icon-verbise-group"},tt={type:A.moveable,name:"移动",category:_e.cursor,icon:je.moveable,shortcut:"ctrl+m"},Ws={type:A.hand,name:"手型",category:_e.cursor,icon:je.hand,shortcut:"ctrl+h"},rn={type:A.rectangle,name:"矩形",category:_e.shapes,icon:je.rectangle},ea={type:A.line,name:"直线",category:_e.shapes,icon:je.line},ta={type:A.polygon,name:"多边形",category:_e.shapes,icon:je.polygon},sa={type:A.image,name:"图片",category:_e.shapes,icon:je.image},on={type:A.arbitrary,name:"线条",category:_e.freedom,icon:je.arbitrary},na={type:A.pencil,name:"画笔",category:_e.freedom,icon:je.pencil},ia={type:A.ellipse,name:"椭圆",category:_e.shapes,icon:je.ellipse},xi={type:A.text,name:"文本",category:_e.text,icon:je.text},ra={type:A.group,name:"组合",category:_e.group,icon:je.group},Si=[tt,Ws],bi=[rn,ea,ia,ta,sa],vi=[on,na],oa=[tt,...Si,rn,...bi,on,...vi,xi,ra];class Et{static getCreatorByType(t){return oa.find(e=>e.type===t)}static isElement(t){return[A.image,A.text,A.arbitrary,A.rectangle,A.ellipse,A.polygon,A.line,A.text,A.pencil].includes(t)}}let vt=class{constructor(t,e,s){p(this,"model");p(this,"rotation");p(this,"shield");p(this,"node");p(this,"undoRedo");p(this,"_originalTransformerCoords",[]);p(this,"_originalCoords",[]);p(this,"_originalRotateCoords",[]);p(this,"_originalBoxCoords",[]);p(this,"_originalRotateBoxCoords",[]);p(this,"_originalRotateOutlineCoords",[]);p(this,"_originalStrokeCoords",[]);p(this,"_originalUnLeanCoords",[]);p(this,"_originalUnLeanBoxCoords",[]);p(this,"_originalUnLeanStrokeCoords",[]);p(this,"_originalMaxBoxCoords",[]);p(this,"_originalMaxOutlineBoxCoords",[]);p(this,"_originalTransformMatrix",[]);p(this,"_originalTransformMoveCoord");p(this,"_originalCenterCoord");p(this,"_originalAngle",0);p(this,"_originalSize",{});p(this,"_originalCorners",[]);p(this,"_originalData");p(this,"_transformMatrix",[]);p(this,"_transformLockCoord");p(this,"_transformLockIndex");p(this,"_unLeanCoords",[]);p(this,"_unLeanBoxCoords",[]);p(this,"_maxBoxCoords",[]);p(this,"_rotateCoords",[]);p(this,"_rotateBoxCoords",[]);p(this,"_maxOutlineBoxCoords",[]);p(this,"_rotateOutlineCoords",[]);p(this,"_strokeCoords",[]);p(this,"_unLeanStrokeCoords",[]);p(this,"_rect",{});p(this,"_transformers",[]);p(this,"_borderTransformers",[]);p(this,"_transformType");p(this,"_rotateControllers",[]);p(this,"_minParallelogramVerticalSize");p(this,"_minLeanSize");p(this,"_flipX",!1);p(this,"_innermostStrokeCoordIndex",0);p(this,"_isRangeElement",!1);p(this,"_status",ie.initialed);p(this,"_isSelected",!1);p(this,"_isDetachedSelected",!1);p(this,"isVisible",!0);p(this,"_isEditing",!1);p(this,"isLocked",!1);p(this,"isMoving",!1);p(this,"isTransforming",!1);p(this,"isRotating",!1);p(this,"isRotatingTarget",!1);p(this,"isDragging",!1);p(this,"isCornerMoving",!1);p(this,"isProvisional",!1);p(this,"isTarget",!1);p(this,"isInRange",!1);p(this,"isOnStage",!1);this.model=t,this.rotation=new $t(this),this.shield=e,this._isRangeElement=s??!1,this.refreshFlipX(),ci(this,{_status:le,isDragging:le,isRotating:le,isTransforming:le,isRotatingTarget:le,isProvisional:le,isOnStage:le,_isEditing:le,isMoving:le,_isSelected:le,_isDetachedSelected:le,isVisible:le,isLocked:le,isTarget:le,isInRange:le,isCornerMoving:le})}get isRangeElement(){return this._isRangeElement}get id(){return this.model.id}get isElement(){return Et.isElement(this.model.type)}get isGroup(){return this.model.type===A.group}get group(){return this.isGroupSubject?this.shield.store.getElementById(this.model.groupId):null}get ancestorGroup(){if(!this.isGroupSubject)return null;let t=this.group;for(;t&&t.isGroupSubject;)t=t.group;return t}get ancestorGroups(){if(!this.isGroupSubject)return[];const t=[];let e=this.group;if(e)for(t.push(e);e&&e.isGroupSubject;)e=e.group,t.push(e);return t}get isGroupSubject(){return this.model.groupId!==void 0}get strokeCoords(){return this._strokeCoords}get unLeanStrokeCoords(){return this._unLeanStrokeCoords}get innermostStrokeCoordIndex(){return this._innermostStrokeCoordIndex}get innermostStrokeCoords(){return this._strokeCoords[this.innermostStrokeCoordIndex]}get flipX(){return this.flipXEnable?!this.isTransforming||this._isEditing?this._flipX:(this.refreshFlipX(),this._flipX):!1}get flipY(){return!1}get flip(){return{flipX:this.flipX,flipY:this.flipY}}get flipXEnable(){return!0}get flipYEnable(){return!0}get positionInputEnable(){return this.status===ie.finished}get widthInputEnable(){return this.status===ie.finished}get heightInputEnable(){return this.status===ie.finished}get angleInputEnable(){return this.status===ie.finished}get rotationEnable(){return!0}get verticesRotationEnable(){return!0}get coordTransformEnable(){return!1}get boxVerticesTransformEnable(){return this.status===ie.finished}get borderTransformEnable(){return this.status===ie.finished}get transformersEnable(){return!0}get fillEnable(){return!0}get fillInputEnable(){return this.status===ie.finished}get strokeEnable(){return!0}get strokeInputEnable(){return this.status===ie.finished}get ratioLockedEnable(){return this.status===ie.finished}get editingEnable(){return!0}get tfRefreshAfterEdChanged(){return!1}get shouldRatioLockResize(){return this.ratioLockedEnable&&(this.isRatioLocked||this.shield.event.isShift)}get originalCoords(){return this._originalCoords}get originalBoxCoords(){return this._originalBoxCoords}get width(){return this.model.width}get height(){return this.model.height}get minParallelogramVerticalSize(){return this._minParallelogramVerticalSize}get minLeanSize(){return this._minLeanSize}get angle(){return this.getAngle()}get corners(){return this.model.corners}get center(){return k.calcStageRelativePoint(this.centerCoord)}get centerCoord(){return this.calcCenterCoord()}get position(){return{x:this.model.x,y:this.model.y}}get strokes(){return this.model.styles.strokes}get fills(){return this.model.styles.fills}get textAlign(){return this.model.styles.textAlign}get textVerticalAlign(){return this.model.styles.textVerticalAlign}get textAlignInputEnable(){return!1}get textVerticalAlignInputEnable(){return!1}get textBaseline(){return this.model.styles.textBaseline}get fontEnable(){return!1}get fontInputEnable(){return!1}get fontLineHeightInputEnable(){return!1}get fontLineHeightFactorInputEnable(){return!1}get fontLetterSpacingInputEnable(){return!1}get paragraphSpacingInputEnable(){return!1}get textCaseInputEnable(){return!1}get fontStyler(){return this.model.styles.fontStyler}get fontSize(){return this.model.styles.fontSize}get fontFamily(){return this.model.styles.fontFamily}get fontLineHeight(){return this.model.styles.fontLineHeight}get fontLineHeightFactor(){return this.model.styles.fontLineHeightFactor}get fontLineHeightAutoFit(){return this.model.styles.fontLineHeightAutoFit}get fontLetterSpacing(){return this.model.styles.fontLetterSpacing}get fontColor(){return this.model.styles.fontColor}get fontColorOpacity(){return this.model.styles.fontColorOpacity}get textDecoration(){return this.model.styles.textDecoration}get textDecorationColor(){return this.model.styles.textDecorationColor}get textDecorationOpacity(){return this.model.styles.textDecorationOpacity}get textDecorationThickness(){return this.model.styles.textDecorationThickness}get textDecorationMixin(){return!1}get textDecorationColorMixin(){return!1}get textDecorationOpacityMixin(){return!1}get textDecorationThicknessMixin(){return!1}get fontStylerMixin(){return!1}get fontSizeMixin(){return!1}get fontFamilyMixin(){return!1}get fontColorMixin(){return!1}get fontColorOpacityMixin(){return!1}get fontLetterSpacingMixin(){return!1}get paragraphSpacing(){return this.model.styles.paragraphSpacing}get textCase(){return this.model.styles.textCase}get status(){return this._status}set status(t){this._setStatus(t)}get isSelected(){return this._isSelected}set isSelected(t){this._setIsSelected(t)}get isDetachedSelected(){return this._isDetachedSelected}set isDetachedSelected(t){this._isDetachedSelected=t,this.isSelected=t}get isEditing(){return this._isEditing}set isEditing(t){this._setIsEditing(t)}get isRatioLocked(){return this.model.isRatioLocked}_setStatus(t){this._status=t,this.emitPropChanged(x.statusChanged,[this._status])}_setIsSelected(t){this._isSelected=t,t||(this._isDetachedSelected=!1)}_setIsEditing(t){this._isEditing=t}get maxBoxCoords(){return this._maxBoxCoords}get maxOutlineBoxCoords(){return this._maxOutlineBoxCoords}get rotateCoords(){return this._rotateCoords}get rotateBoxCoords(){return this._rotateBoxCoords}get rotateOutlineCoords(){return this._rotateOutlineCoords}get unLeanCoords(){return this._unLeanCoords}get unLeanBoxCoords(){return this._unLeanBoxCoords}get transformers(){return this._transformers}get borderTransformers(){return this._borderTransformers}get transformerType(){return ct.rect}get rect(){return this._rect}get activeCoordIndex(){return-1}get alignCoords(){return this._rotateCoords}get alignOutlineCoords(){return this._rotateOutlineCoords}get visualStrokeWidth(){return Math.max(...this.strokes.map(t=>t.width*re.stageParams.scale))}get visualFontSize(){return this.fontSize*re.stageParams.scale}get originalAngle(){return this._originalAngle}set originalAngle(t){this._originalAngle=t}get transformMatrix(){return this._transformMatrix}get transformLockIndex(){return this._transformLockIndex}get transformLockCoord(){return this._transformLockCoord}get originalTransformMoveCoord(){return this._originalTransformMoveCoord}get transformType(){return this._transformType}get viewAngle(){return this.model.viewAngle}get internalAngle(){return this.model.internalAngle}get leanYAngle(){return this.model.leanYAngle}get angles(){return{angle:this.model.angle,leanYAngle:this.model.leanYAngle,internalAngle:this.model.internalAngle,actualAngle:this.model.actualAngle,viewAngle:this.model.viewAngle}}get leanY(){return-Math.tan(h.angleToRadian(this.model.leanYAngle))}get actualAngle(){return this.model.actualAngle}get viewAngleCalcEnable(){return!0}get leanYAngleCalcEnable(){return!0}get leanYAngleInputEnable(){return this.status===ie.finished}get cornersInputEnable(){return!1}get cornersEnable(){return!1}get rotateControllers(){return this._rotateControllers}get controllers(){const t=[];return this.rotationEnable&&(this.shield.configure.rotationIconEnable&&t.push(this.rotation),t.push(...this._rotateControllers)),(this.coordTransformEnable||this.boxVerticesTransformEnable)&&t.push(...this._transformers),this.borderTransformEnable&&t.push(...this._borderTransformers),t}get isTopmost(){if(this.isGroupSubject&&this.group){const t=this.group.model.subIds;return t.findIndex(e=>e===this.model.id)===t.length-1}return this.node.next===null}get isBottommost(){var t,e;return this.isGroupSubject&&this.group?this.group.model.subIds.findIndex(n=>n===this.model.id)===0:this.isGroup?((e=(t=this.firstDeeoSub)==null?void 0:t.node)==null?void 0:e.prev)===null:this.node.prev===null}get isInMultiSelected(){const{selectedElementIds:t}=this.shield.store;return t.has(this.model.id)&&t.size>1}get shouldPropChangedEmit(){const t=this.isInMultiSelected;return!t||t&&!this.isGroupSubject}get strokeEffective(){return this.strokes.some(t=>t.width>0)}get fillEffective(){return this.fills.some(t=>!t.colorOpacity)}get isValid(){return!0}async undo(){this.undoRedo.tailUndoCommand&&await this.undoRedo.undo()}async redo(){this.undoRedo.tailRedoCommand&&await this.undoRedo.redo()}onPositionChanged(){this.emitPropChanged(x.positionChanged,[this.position])}onWidthChanged(){this.emitPropChanged(x.widthChanged,[this.width])}onHeightChanged(){this.emitPropChanged(x.heightChanged,[this.height])}onLayerChanged(){}onTranslateBefore(){this.refreshOriginals()}onTranslateAfter(){this.refreshOriginals()}onTranslating(){this.emitPropChanged(x.positionChanged,[this.position])}onRotateBefore(){this.refreshOriginals()}onRotateAfter(){this.refreshOriginals()}onRotating(){this.emitPropChanged(x.angleChanged,[this.angle])}onTransformBefore(){this.refreshOriginals()}onTransformAfter(){this.refreshOriginals()}onTransforming(){this.emitPropChanged(x.positionChanged,[this.position]),this.emitPropChanged(x.widthChanged,[this.width]),this.emitPropChanged(x.heightChanged,[this.height]),this.emitPropChanged(x.angleChanged,[this.angle]),this.emitPropChanged(x.flipXChanged,[this._flipX])}onFlipXChanged(){this.emitPropChanged(x.flipXChanged,[this._flipX]),this.emitPropChanged(x.angleChanged,[this.angle]),this.emitPropChanged(x.leanYAngleChanged,[this.leanYAngle])}onFlipYChanged(){this.emitPropChanged(x.flipXChanged,[this._flipX]),this.emitPropChanged(x.angleChanged,[this.angle]),this.emitPropChanged(x.leanYAngleChanged,[this.leanYAngle])}onAngleChanged(){this.emitPropChanged(x.angleChanged,[this.angle])}onLeanyAngleChanged(){this.emitPropChanged(x.leanYAngleChanged,[this.leanYAngle])}onCornerChanging(){this.emitPropChanged(x.cornersChanged,[this.corners])}onCornerChanged(){this.emitPropChanged(x.cornersChanged,[this.corners])}onStrokeTypeChanged(){this.emitPropChanged(x.strokesChanged,[this.strokes])}onStrokeWidthChanged(){this.emitPropChanged(x.strokesChanged,[this.strokes])}onStrokeColorChanged(){this.emitPropChanged(x.strokesChanged,[this.strokes])}onStrokeColorOpacityChanged(){this.emitPropChanged(x.strokesChanged,[this.strokes])}onStrokeAdded(){this.emitPropChanged(x.strokesChanged,[this.strokes])}onStrokeRemoved(){this.emitPropChanged(x.strokesChanged,[this.strokes])}onFillColorChanged(){this.emitPropChanged(x.fillsChanged,[this.fills])}onFillColorOpacityChanged(){this.emitPropChanged(x.fillsChanged,[this.fills])}onFillAdded(){this.emitPropChanged(x.fillsChanged,[this.fills])}onFillRemoved(){this.emitPropChanged(x.fillsChanged,[this.fills])}onTextAlignChanged(){this.emitPropChanged(x.textAlignChanged,[this.textAlign])}onTextVerticalAlignChanged(){this.emitPropChanged(x.textVerticalAlignChanged,[this.textVerticalAlign])}onTextBaselineChanged(){this.emitPropChanged(x.textBaselineChanged,[this.textBaseline])}onFontStylerChanged(){this.emitPropChanged(x.fontStylerChanged,[this.fontStyler])}onFontSizeChanged(){this.emitPropChanged(x.fontSizeChanged,[this.fontSize])}onFontFamilyChanged(){this.emitPropChanged(x.fontFamilyChanged,[this.fontFamily])}onFontLineHeightChanged(){this.emitPropChanged(x.fontLineHeightChanged,[this.fontLineHeight])}onFontLineHeightFactorChanged(){this.emitPropChanged(x.fontLineHeightFactorChanged,[this.fontLineHeightFactor])}onFontLineHeightAutoFitChanged(){this.emitPropChanged(x.fontLineHeightAutoFitChanged,[this.fontLineHeightAutoFit])}onFontLetterSpacingChanged(){this.emitPropChanged(x.fontLetterSpacingChanged,[this.fontLetterSpacing])}onFontColorChanged(){this.emitPropChanged(x.fontColorChanged,[this.fontColor])}onFontColorOpacityChanged(){this.emitPropChanged(x.fontColorOpacityChanged,[this.fontColorOpacity])}onTextDecorationChanged(){this.emitPropChanged(x.textDecorationChanged,[this.textDecoration])}onTextDecorationColorChanged(){this.emitPropChanged(x.textDecorationColorChanged,[this.textDecorationColor])}onTextDecorationOpacityChanged(){this.emitPropChanged(x.textDecorationOpacityChanged,[this.textDecorationOpacity])}onTextDecorationThicknessChanged(){this.emitPropChanged(x.textDecorationThicknessChanged,[this.textDecorationThickness])}onParagraphSpacingChanged(){this.emitPropChanged(x.paragraphSpacingChanged,[this.paragraphSpacing])}onTextCaseChanged(){this.emitPropChanged(x.textCaseChanged,[this.textCase])}onRatioLockedChanged(){this.emitPropChanged(x.ratioLockedChanged,[this.isRatioLocked])}onStageChanged(){}getAngle(){return this.model.angle}emitPropChanged(t,e){this.shouldPropChangedEmit&&this.shield.store.filterEmit(t,this,...e)}async emitUndo(){await this.shield.execUndo()}async emitRedo(){await this.shield.execRedo()}convertPointsByStrokeType(t,e){return G.convertPointsByStrokeType(t,e.type,e.width,{...this.flip,isFold:this.model.isFold})}calcRotateBoxCoords(){return this.model.boxCoords.map(t=>h.rotateWithCenter(t,this.model.angle,this.centerCoord))}calcMaxBoxCoords(){return L.getBoxByPoints(this._rotateCoords)}calcMaxOutlineBoxCoords(){return L.getBoxByPoints(this._rotateOutlineCoords.flat())}calcRotateCoords(){return this.model.coords.map(t=>h.rotateWithCenter(t,this.model.angle,this.centerCoord))}calcRotateOutlineCoords(){return this.model.styles.strokes.map(t=>k.calcOutlinePoints(this._rotateCoords,t.type,t.width,{...this.flip,isFold:this.model.isFold}))}calcCenterCoord(){return h.calcCenter(this.model.boxCoords)}getController4BoxCoords(t,e){return e=e||as,e/=re.stageParams.scale,L.getBoxByCenter(t,{width:e,height:e},{angle:this.model.actualAngle,leanYAngle:this.model.leanYAngle})}calcTransformersByCoords(t){return t.map((e,s)=>{const{x:n,y:i}=e,o=this.getController4BoxCoords(e);let a=this._transformers[s];return a?(a.points=o,a.x=n,a.y=i):a=new _t(this,{points:o,x:n,y:i}),a})}calcBoxVerticesTransformers(){return this.calcTransformersByCoords(this._rotateBoxCoords)}calcCoordTransformers(){return this.calcTransformersByCoords(this._rotateCoords)}calcTransformers(){return this.coordTransformEnable?this.calcCoordTransformers():this.boxVerticesTransformEnable?this.calcBoxVerticesTransformers():[]}calcRotateControllers(){const t=this.centerCoord;return this._rotateBoxCoords.map((e,s)=>{const n=h.calcAngle(t,e),{x:i,y:o}=h.calcTargetPoint(e,Uo/re.stageParams.scale,n),a=this.getController4BoxCoords({x:i,y:o},ls);let l=this._rotateControllers[s];return l?(l.points=a,l.x=i,l.y=o):l=new Ei(this,{x:i,y:o,points:a}),l})}calcBorderTransformers(){return this._rotateBoxCoords.map((e,s)=>{const n=L.getNextOfArray(this._rotateBoxCoords,s);let i=this._borderTransformers[s];return i?(i.start=e,i.end=n):i=new Ht(this,{start:e,end:n,index:s}),i})}calcUnLeanCoords(){return h.calcUnLeanByPoints(this.model.coords,0,this.model.leanYAngle)}calcUnLeanBoxCoords(){return h.calcUnLeanByPoints(this.model.boxCoords,0,this.model.leanYAngle)}calcStrokeCoords(){return this.model.styles.strokes.map(t=>this.convertPointsByStrokeType(this._rotateCoords,t))}calcInnermostStrokeCoordIndex(){let t=0,e=0;return this._strokeCoords.forEach((s,n)=>{const{width:i,type:o}=this.model.styles.strokes[n];o===pe.middle&&e<i/2&&(e=i/2,t=n),o===pe.inside&&e<i&&(e=i,t=n)}),t}calcUnLeanStrokeCoords(){return this.model.styles.strokes.map(t=>this.convertPointsByStrokeType(this._unLeanCoords,t))}calcInternalAngle(){return this._isRangeElement?90:h.calcInternalAngle(this.model.boxCoords)}calcLeanYAngle(){return!this.leanYAngleCalcEnable||this._isRangeElement?0:h.calcLeanYAngle(this.model.internalAngle,this.flipX)}calcViewAngle(){return this.viewAngleCalcEnable?h.calcViewAngleByPoints(this._rotateBoxCoords):this.model.angle}calcActualAngle(){return h.constraintAngle(this.model.viewAngle-this.model.leanYAngle)}calcPrimitiveSize(){return L.calcRectangleSize(h.batchLeanWithCenter(this.model.boxCoords,-this.model.leanXAngle,-this.model.leanYAngle,this.centerCoord))}refreshAngles(t){t=t||xo,t.view&&(this.model.viewAngle=this.calcViewAngle()),t.internal&&(this.model.internalAngle=this.calcInternalAngle()),t.leanY&&(this.model.leanYAngle=this.calcLeanYAngle()),t.actual&&(this.model.actualAngle=this.calcActualAngle())}refreshRotation(){this.rotationEnable&&(this.shield.configure.rotationIconEnable&&this.rotation.refresh(),this._rotateControllers=this.calcRotateControllers())}refreshPoints(){this._rotateCoords=this.calcRotateCoords(),this._rotateBoxCoords=this.calcRotateBoxCoords(),this._unLeanCoords=this.calcUnLeanCoords(),this._unLeanBoxCoords=this.calcUnLeanBoxCoords(),this._maxBoxCoords=this.calcMaxBoxCoords(),this.refreshTransformers()}isContainsCoord(t){return R.some(this._rotateOutlineCoords,e=>h.isPointInPolygonByRayCasting(t,e))}isPolygonOverlap(t){return R.some(this._rotateOutlineCoords,e=>h.isPolygonsOverlap(e,t))}isModelPolygonOverlap(t){return R.some(this._rotateOutlineCoords,e=>h.isPolygonsOverlap(e,t))}refreshOriginalElementProps(){this.refreshOriginalCoords(),this.refreshOriginalStrokes(),this._originalSize={width:this.model.width,height:this.model.height},this._originalCorners=V.jsonClone(this.model.corners),this._originalTransformMatrix=[]}refreshOriginalCoords(){this._originalCoords=V.jsonClone(this.model.coords),this._originalBoxCoords=V.jsonClone(this.model.boxCoords),this._originalRotateCoords=V.jsonClone(this._rotateCoords),this._originalRotateBoxCoords=V.jsonClone(this._rotateBoxCoords),this._originalUnLeanCoords=V.jsonClone(this._unLeanCoords),this._originalUnLeanBoxCoords=V.jsonClone(this._unLeanBoxCoords),this._originalCenterCoord=V.jsonClone(this.centerCoord),this._originalRotateOutlineCoords=V.jsonClone(this._rotateOutlineCoords),this._originalMaxOutlineBoxCoords=V.jsonClone(this._maxOutlineBoxCoords),this._originalMaxBoxCoords=V.jsonClone(this._maxBoxCoords)}refreshOriginalStrokes(){this._originalStrokeCoords=V.jsonClone(this._strokeCoords),this._originalUnLeanStrokeCoords=V.jsonClone(this._unLeanStrokeCoords)}refreshOriginalTransformerCoords(){this._originalTransformerCoords=this._transformers.map(t=>{const{x:e,y:s}=t;return{x:e,y:s}})}refreshOriginals(){this.refreshOriginalTransformerCoords(),this.refreshOriginalElementProps(),!this.isRangeElement&&this.refreshOriginalAngle()}refreshSize(){const{width:t,height:e}=k.calcSize(this.model);if(this.model.width=h.precise(t,1),this.model.height=h.precise(e,1),this._rotateBoxCoords&&this._rotateBoxCoords.length){const{width:s,height:n}=h.calcParallelogramVerticalSize(this._rotateBoxCoords);this._minParallelogramVerticalSize=Math.min(s,n),this._minLeanSize=Math.min(this.model.width,n)}}refreshPosition(){Object.assign(this.model,this.calcCenterCoord())}refreshTransformers(){this._transformers=this.calcTransformers(),this.borderTransformEnable&&(this._borderTransformers=this.calcBorderTransformers())}flipAngle(){let t;this.model.angle>0?t=this.model.angle-180:t=this.model.angle+180,this.model.angle=h.constraintAngle(t)}batchCalcTransformPointsByCenter(t,e,s,n){return this.calcTransformPointsByCenter(t,e,s,n,this.angles)}calcTransformPointsByCenter(t,e,s,n,i){const o=k.calcMatrixPoint(n,e,s,i);return t.map(a=>(a=k.calcMatrixPoint(a,e,s,i),h.rotateWithCenter(a,-i.angle,o)))}_refreshOnTransformChanged(){this.refresh(V.toBooleanObject(["points","rotation","position","size","angles","outline","strokes","corners"]),{angles:V.toBooleanObject(["view","actual"])})}transform(t){this.getActiveController()instanceof _t?(this.transformByVertices(t),this._transformType=ts.vertices):this.getActiveController()instanceof Ht&&(this.transformByBorder(t),this._transformType=ts.border),this._refreshOnTransformChanged()}transformBy(t){const{lockCoord:e,lockIndex:s,transformType:n,originalMovingCoord:i,offset:o,groupAngle:a,groupLeanYAngle:l}=t,c={angle:a,leanYAngle:l},d=this.getTransformMatrix(e,i,o,c,!1);n===ts.border&&this._transBorderMatrix(d,s,!1),this._doTransformBy(d,e,c,i),this._refreshOnTransformChanged()}_doTransformBy(t,e,s,n){const i=k.calcMatrixPoints(this._originalRotateCoords,t,e,s),o=k.calcMatrixPoints(this._originalRotateBoxCoords,t,e,s);this._doTransformByPoints(i,o,e,t,n)}_doTransformByPoints(t,e,s,n,i){this.model.internalAngle=h.calcInternalAngle(e),this.model.leanYAngle=h.calcLeanYAngle(this.model.internalAngle,h.calcFlipXByPoints(e)),this.model.angle=h.constraintAngle(h.calcActualAngleByPoints(e)),this.model.coords=h.batchPrecisePoints(k.calcCoordsByTransPoints(t,this.angles,s),1),this.model.boxCoords=h.batchPrecisePoints(k.calcCoordsByTransPoints(e,this.angles,s),1),i&&n&&this._tryFlipAngle(s,i,n)}transformByVertices(t){!this.coordTransformEnable&&!this.boxVerticesTransformEnable||this.doVerticesTransform(t)}doVerticesTransform(t){const e=this._transformers.findIndex(s=>s.isActive);if(e!==-1){const s=L.getPrevIndexOfArray(this._transformers.length,e,2),n=this._originalTransformerCoords[s],i=this._originalTransformerCoords[e];this._originalTransformMoveCoord=i,this.transformByLockPoint(n,i,t,e)}}transformByLockPoint(t,e,s,n){const i=this.getTransformMatrix(t,e,s,this.angles);this._transformMatrix=i,this._transformLockCoord=t,this._transformLockIndex=n,this.model.coords=h.batchPrecisePoints(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,i,t,this._originalCenterCoord),1),this.model.boxCoords=h.batchPrecisePoints(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,i,t,this._originalCenterCoord),1),this._tryFlipAngle(t,e,i)}getTransformMatrix(t,e,s,n,i){typeof i>"u"&&(i=!0);const o={x:e.x+s.x,y:e.y+s.y},a=h.calcTransformMatrix(t,o,e,n);return i&&this.shouldRatioLockResize&&(a[1][1]=h.resignValue(a[1][1],a[0][0])),a}_tryFlipAngle(t,e,s){this._originalTransformMatrix.length||(this._originalTransformMatrix=h.calcTransformMatrix(t,e,e,this.angles));const n=this._doFlipAngle(s,this._originalTransformMatrix);return n&&(this._originalTransformMatrix=V.jsonClone(s)),n}_doFlipAngle(t,e){e[0][0];const s=e[1][1];t[0][0];const n=t[1][1];return h.isSameSign(n,s)?!1:(this.flipAngle(),!0)}transformByBorder(t){this.borderTransformEnable&&this.doBorderTransform(t)}getBorderTransformLockCoord(t){const e=L.getPrevIndexOfArray(this._borderTransformers.length,t,2),s=L.getNextIndexOfArray(this._borderTransformers.length,t,3);return h.calcCenter([this._originalTransformerCoords[e],this._originalTransformerCoords[s]])}_transBorderMatrix(t,e,s){typeof s>"u"&&(s=!0);const n=s&&this.shouldRatioLockResize;return e===0||e===2?t[0][0]=n?h.resignValue(t[0][0],t[1][1]):1:(e===1||e===3)&&(t[1][1]=n?h.resignValue(t[1][1],t[0][0]):1),[1,3].includes(e)&&t[1][1]<0&&(t[1][1]=Math.abs(t[1][1])),[0,2].includes(e)&&t[0][0]<0&&(t[0][0]=Math.abs(t[0][0])),t}doBorderTransform(t){const e=this._borderTransformers.findIndex(s=>s.isActive);if(e!==-1){const s=this.getBorderTransformLockCoord(e),n=this._originalTransformerCoords[e];this._originalTransformMoveCoord=n;const i={x:n.x+t.x,y:n.y+t.y},o=h.calcTransformMatrix(s,i,n,this.angles);this._transBorderMatrix(o,e),this._transformMatrix=o,this._transformLockCoord=s,this._transformLockIndex=e,this.model.coords=h.batchPrecisePoints(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,o,s,this._originalCenterCoord),1),this.model.boxCoords=h.batchPrecisePoints(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,o,s,this._originalCenterCoord),1),this._tryFlipAngle(s,n,o)}}translateBy(t){this.model.coords=h.batchTranslate(this._originalCoords,t),this.model.boxCoords=h.batchTranslate(this._originalBoxCoords,t),this._rotateCoords=h.batchTranslate(this._originalRotateCoords,t),this._rotateBoxCoords=h.batchTranslate(this._originalRotateBoxCoords,t),this._unLeanCoords=h.batchTranslate(this._originalUnLeanCoords,t),this._unLeanBoxCoords=h.batchTranslate(this._originalUnLeanBoxCoords,t),this._unLeanStrokeCoords=this._originalUnLeanStrokeCoords.map(n=>h.batchTranslate(n,t)),this._strokeCoords=this._originalStrokeCoords.map(n=>h.batchTranslate(n,t)),this._maxBoxCoords=h.batchTranslate(this._originalMaxBoxCoords,t),this._maxOutlineBoxCoords=h.batchTranslate(this._originalMaxOutlineBoxCoords,t),this._rotateOutlineCoords=this._originalRotateOutlineCoords.map(n=>h.batchTranslate(n,t));const{x:e,y:s}=k.calcPosition({type:this.model.type,coords:this.model.coords});this.model.x=e,this.model.y=s,this.refreshCorners(),this.refreshRotation(),this.refreshTransformers()}refresh(t,e){t=t||So,t!=null&&t.points&&this.refreshPoints(),t!=null&&t.size&&this.refreshSize(),t!=null&&t.position&&this.refreshPosition(),t!=null&&t.angles&&this.refreshAngles(e==null?void 0:e.angles),t!=null&&t.rotation&&this.refreshRotation(),t!=null&&t.corners&&this.refreshCorners(),t!=null&&t.strokes&&this.refreshStrokePoints(),t!=null&&t.outline&&this.refreshOutlinePoints(),t!=null&&t.originals&&this.refreshOriginals()}refreshOutlinePoints(){this._rotateOutlineCoords=this.calcRotateOutlineCoords(),this._maxOutlineBoxCoords=this.calcMaxOutlineBoxCoords()}refreshFlipX(){var t;(t=this.model.boxCoords)!=null&&t.length&&(this._flipX=h.calcFlipXByPoints(this.model.boxCoords))}setWidth(t){const e=h.calcScaleMatrix(t/this._originalSize.width,1);return e[1][1]=this.shouldRatioLockResize?h.resignValue(e[1][1],e[0][0]):1,this._setWH(e),e}setHeight(t){const e=h.calcScaleMatrix(1,t/this._originalSize.height);return e[0][0]=this.shouldRatioLockResize?h.resignValue(e[0][0],e[1][1]):1,this._setWH(e),e}scaleBy(t,e,s,n){const i=h.calcScaleMatrix(e,s);n?this._doTransformBy(i,t,n):(this.model.coords=h.batchPrecisePoints(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,i,t,this._originalCenterCoord),1),this.model.boxCoords=h.batchPrecisePoints(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,i,t,this._originalCenterCoord),1)),this.refresh()}_setWH(t){this._transformMatrix=t,this._transformLockCoord=this._originalCenterCoord,this.model.coords=h.batchPrecisePoints(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,t,this._originalCenterCoord,this._originalCenterCoord),1),this.model.boxCoords=h.batchPrecisePoints(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,t,this._originalCenterCoord,this._originalCenterCoord),1),this.refresh()}setPosition(t,e,s){this.model.x=t,this.model.y=e,this.model.coords=h.batchPrecisePoints(h.batchTranslate(this.model.coords,s),1),this.model.boxCoords=h.batchPrecisePoints(h.batchTranslate(this.model.boxCoords,s),1),this.refresh()}_refreshOnAngleChanged(t){t?this.refresh(V.toBooleanObject(["points","rotation","position","angles","outline","strokes","corners"])):this.refresh(null,{angles:V.toBooleanObject(["view","actual"])})}_updateAngle(t){this.model.angle=t}setAngle(t){this._updateAngle(t),this._refreshOnAngleChanged(!1)}updateAngle(t){this._updateAngle(t),this._refreshOnAngleChanged(!0)}_refreshOnLeanYChanged(){this.refresh(null,{angles:V.toBooleanObject(["view","actual","internal"])})}setLeanYAngle(t){t=R.clamp(t,-89,89);const e=this.calcUnLeanCoords(),s=this.centerCoord;this.model.coords=h.batchPrecisePoints(h.batchLeanYWithCenter(e,t,s),1);const n=this.calcUnLeanBoxCoords();this.model.boxCoords=h.batchPrecisePoints(h.batchLeanYWithCenter(n,t,s),1),this.model.leanYAngle=t,this._refreshOnLeanYChanged()}leanYBy(t,e,s,n){let i=h.batchTransWithCenter(this._rotateCoords,{angle:s,leanYAngle:e},n,!0),o=h.batchTransWithCenter(this._rotateBoxCoords,{angle:s,leanYAngle:e},n,!0);i=h.batchTransWithCenter(i,{angle:s,leanYAngle:t},n),o=h.batchTransWithCenter(o,{angle:s,leanYAngle:t},n),this._doTransformByPoints(i,o,n),this._refreshOnLeanYChanged()}refreshCorners(){}refreshStrokePoints(){this._strokeCoords=this.calcStrokeCoords(),this._unLeanStrokeCoords=this.calcUnLeanStrokeCoords(),this._innermostStrokeCoordIndex=this.calcInnermostStrokeCoordIndex()}_updateCorners(t,e){let s=V.jsonClone(this.model.corners);R.isNumber(e)?s[e]=t:s.fill(t),s=k.fixCornersBasedOnMinSize(s,this._minParallelogramVerticalSize),this.model.corners=s}setCorners(t,e){this._updateCorners(t,e),this.refresh(V.toBooleanObject(["corners","strokes","originals"]))}updateCorners(t,e){this._updateCorners(t,e),this.refresh(V.toBooleanObject(["corners","strokes"]))}setStrokeType(t,e){this.model.styles.strokes[e].type=t,this.refresh(V.toBooleanObject(["strokes","outline","originals"]))}setStrokeColor(t,e){this.model.styles.strokes[e].color=t}setStrokeColorOpacity(t,e){this.model.styles.strokes[e].colorOpacity=R.clamp(t,0,100)}setStrokeWidth(t,e){switch(this.model.styles.strokes[e].type){case pe.middle:t=R.clamp(t,0,this._minLeanSize);break;case pe.inside:t=R.clamp(t,0,this._minLeanSize/2);break;case pe.outside:t=R.clamp(t,0,this._minLeanSize*2);break}t=h.precise(t,1),this.model.styles.strokes[e].width=t,this.refresh(V.toBooleanObject(["strokes","outline","originals"]))}addStroke(t){this.model.styles.strokes.splice(t+1,0,{...en}),this.refresh(V.toBooleanObject(["strokes","outline","originals"]))}removeStroke(t){this.model.styles.strokes.splice(t,1),this.refresh(V.toBooleanObject(["strokes","outline","originals"]))}setFillColor(t,e){this.model.styles.fills[e].color=t}setFillColorOpacity(t,e){this.model.styles.fills[e].colorOpacity=R.clamp(t,0,100)}addFill(t){this.model.styles.fills.splice(t+1,0,{...tn})}removeFill(t){this.model.styles.fills.splice(t,1)}setFontStyler(t){this.model.styles.fontStyler=t}setFontSize(t){this.model.styles.fontSize=t,this._updateLineHeightByFactor()}setFontFamily(t){this.model.styles.fontFamily=t}_updateLineHeightByFactor(){const{fontSize:t,fontLineHeightFactor:e,fontLineHeightAutoFit:s}=this.model.styles;s&&(this.model.styles.fontLineHeight=h.precise(t*e,0))}setFontLineHeight(t){this.model.styles.fontLineHeight=t,this.model.styles.fontLineHeightFactor=h.precise(t/this.model.styles.fontSize,2)}setFontLineHeightFactor(t){this.model.styles.fontLineHeightFactor=t,this._updateLineHeightByFactor()}setFontLineHeightAutoFit(t){this.model.styles.fontLineHeightAutoFit=t,this._updateLineHeightByFactor()}setFontLetterSpacing(t){this.model.styles.fontLetterSpacing=t}setFontColor(t){this.model.styles.fontColor=t}setFontColorOpacity(t){this.model.styles.fontColorOpacity=R.clamp(t,0,100)}setTextAlign(t){this.model.styles.textAlign=t}setTextVerticalAlign(t){this.model.styles.textVerticalAlign=t}setTextBaseline(t){this.model.styles.textBaseline=t}setTextDecoration(t){this.model.styles.textDecoration=t}setTextDecorationColor(t){this.model.styles.textDecorationColor=t}setTextDecorationOpacity(t){this.model.styles.textDecorationOpacity=R.clamp(t,0,100)}setTextDecorationThickness(t){this.model.styles.textDecorationThickness=t}setParagraphSpacing(t){this.model.styles.paragraphSpacing=t}setTextCase(t){this.model.styles.textCase=t}setRatioLocked(t){this.model.isRatioLocked=t,t?this.model.ratio=this.model.width/this.model.height:this.model.ratio=null}_flipBy(t,e,s){const n=this.calcUnLeanBoxCoords(),i=this.calcUnLeanCoords(),o=h.batchCalcSymmetryPoints(n,t,e),a=h.batchCalcSymmetryPoints(i,t,e);s();const l=h.calcCenter(o);this.model.boxCoords=h.batchPrecisePoints(h.batchLeanYWithCenter(o,this.model.leanYAngle,l),1),this.model.coords=h.batchPrecisePoints(h.batchLeanYWithCenter(a,this.model.leanYAngle,l),1)}_refreshOnFlipChanged(){this.refreshFlipX(),this.refresh(V.toBooleanObject(["points","rotation","size","angles","outline","strokes","corners","originals",{position:this.isGroupSubject}]),{angles:V.toBooleanObject(["view","actual"])})}flipXBy(t,e){this._flipBy(t,e,()=>{this.model.angle=-this.model.angle,this.model.leanYAngle=-this.model.leanYAngle}),this._refreshOnFlipChanged()}_getFlipXLinePoints(){const t=this.calcUnLeanBoxCoords(),[e,s]=t,n={x:(e.x+s.x)/2,y:(e.y+s.y)/2};return[this.centerCoord,n]}_getFlipYLinePoints(){const t=this.calcUnLeanBoxCoords(),e=t[0],s=t[3],n={x:(e.x+s.x)/2,y:(e.y+s.y)/2};return[this.centerCoord,n]}setFlipX(){const t=this._getFlipXLinePoints();return this.flipXBy(t[0],t[1]),this._refreshOnFlipChanged(),t}flipYBy(t,e){const s=this.calcUnLeanBoxCoords(),n=this.calcUnLeanCoords();let i=h.batchCalcSymmetryPoints(s,t,e),o=h.batchCalcSymmetryPoints(n,t,e);const a=h.calcCenter(i),l={x:(i[0].x+i[1].x)/2,y:(i[0].y+i[1].y)/2},c={x:(i[0].x+i[3].x)/2,y:(i[0].y+i[3].y)/2};i=h.batchCalcSymmetryPointsMuch(i,[[a,l],[a,c]]),o=h.batchCalcSymmetryPointsMuch(o,[[a,l],[a,c]]),this.model.angle=h.constraintAngle(180-this.model.angle),this.model.leanYAngle=-this.model.leanYAngle,this.model.boxCoords=h.batchPrecisePoints(h.batchLeanYWithCenter(i,this.model.leanYAngle,a),1),this.model.coords=h.batchPrecisePoints(h.batchLeanYWithCenter(o,this.model.leanYAngle,a),1),this._refreshOnFlipChanged()}setFlipY(){const t=this._getFlipYLinePoints();return this.flipYBy(t[0],t[1]),this._refreshOnFlipChanged(),t}rotateBy(t,e,s){const n=h.rotateWithCenter(this._originalCenterCoord,t,e),i={x:n.x-this._originalCenterCoord.x,y:n.y-this._originalCenterCoord.y},o=this._originalCoords.map(l=>h.translate(l,i)),a=this._originalBoxCoords.map(l=>h.translate(l,i));this.model.coords=h.batchPrecisePoints(o,1),this.model.boxCoords=h.batchPrecisePoints(a,1),this.model.angle=h.constraintAngle(h.normalizeAngle(this._originalAngle)+h.normalizeAngle(t)%360),this._refreshOnAngleChanged(s)}getActiveController(){return this.controllers.find(t=>t.isActive)}setControllersActive(t,e){t.forEach(s=>s.isActive=e)}getControllerByCoord(t){return this.controllers.find(e=>e.isCoordHitting(t))}refreshOriginalAngle(){this._originalAngle=this.model.angle}async toJson(){return JSON.parse(JSON.stringify({...this.model,...this.flip}))}fromJson(t){this.model=JSON.parse(JSON.stringify(t))}_toOriginalCommonJson(){const{id:t,_originalCoords:e,_originalBoxCoords:s,_originalCenterCoord:{x:n,y:i}}=this;return{id:t,coords:e,boxCoords:s,x:n,y:i}}async toOriginalTranslateJson(){const t=this._toOriginalCommonJson();return JSON.parse(JSON.stringify(t))}async toTranslateJson(){return JSON.parse(JSON.stringify(R.pick(this.model,[...ss])))}async toOriginalRotateJson(){const t=this._toOriginalCommonJson();return t.angle=this._originalAngle,JSON.parse(JSON.stringify(t))}async toRotateJson(){return JSON.parse(JSON.stringify(R.pick(this.model,[...ss,"angle"])))}async toOriginalTransformJson(){const t=this._toOriginalCommonJson();return t.width=this._originalSize.width,t.height=this._originalSize.height,t.angle=this._originalAngle,JSON.parse(JSON.stringify(t))}async toTransformJson(){return JSON.parse(JSON.stringify(R.pick(this.model,[...ss,"width","height","angle"])))}async toOriginalCornerJson(){const{id:t,_originalCorners:e}=this;return JSON.parse(JSON.stringify({id:t,corners:e}))}async toCornerJson(){return JSON.parse(JSON.stringify(R.pick(this.model,["id","corners"])))}async toStrokesJson(){return JSON.parse(JSON.stringify(R.pick(this.model,["id","styles.strokes"])))}async toFillsJson(){return JSON.parse(JSON.stringify(R.pick(this.model,["id","styles.fills"])))}async toGroupJson(){const t=JSON.parse(JSON.stringify(R.pick(this.model,["id","groupId"])));return R.isUndefined(t.groupId)&&(t.groupId=void 0),t}async toFontStyleJson(){return JSON.parse(JSON.stringify(R.pick(this.model,["id","styles.fontStyler","styles.fontSize","styles.fontFamily","styles.fontColor","styles.fontColorOpacity","styles.textAlign","styles.textVerticalAlign","styles.textBaseline","styles.fontLineHeight","styles.fontLineHeightFactor","styles.fontLineHeightAutoFit","styles.fontLetterSpacing","styles.textDecoration","styles.textDecorationColor","styles.textDecorationOpacity","styles.textDecorationThickness","styles.paragraphSpacing","styles.textCase"])))}async toElementJson(){return{}}};class cs extends nn{}class an extends vt{constructor(){super(...arguments);p(this,"_cornerControllers",[]);p(this,"_cornerCoords",[]);p(this,"_originalCornerCoords",[]);p(this,"_originalAllCornerEqual",!1);p(this,"_arcCoords",[]);p(this,"_arcFillCoords",[]);p(this,"_originalArcCoords",[]);p(this,"_originalArcFillCoords",[])}get cornersInputEnable(){return this.status===ie.finished}get cornersEnable(){return!0}get cornerControllers(){return this._cornerControllers}get normalizeCorners(){return this._normalizeCorners()}get cornerCoords(){return this._cornerCoords}get visualCorners(){return this.normalizeCorners.map(e=>this._getCorner(e))}get editingEnable(){return!1}get controllers(){const e=super.controllers;return this.cornersEnable&&e.push(...this.cornerControllers),e}get isAllCornerEqual(){return R.uniq(this.model.corners).length===1}get arcCoords(){return this._arcCoords}get arcFillCoords(){return this._arcFillCoords}calcArcCoords(){return this.model.styles.strokes.map(e=>this._getArcVerticalCoords(e))}calcArcFillCoords(){const e=this.innermostStrokeCoordIndex;let s=this.model.styles.strokes[e],{width:n,type:i}=s;switch(i){case pe.inside:{n=n*2;break}case pe.middle:{n=n;break}case pe.outside:{n=0;break}}return s={...s,type:pe.inside,width:n},this._getArcVerticalCoords(s)}_getArcBoxCoords(e){const{type:s,width:n}=e;let i=this.calcUnLeanBoxCoords();const{width:o,height:a}=L.calcRectangleSize(i);let l=1,c=1;switch(s){case pe.outside:{l=(o+n)/o,c=(a+n)/a;break}case pe.inside:{l=(o-n)/o,c=(a-n)/a;break}}return[pe.inside,pe.outside].includes(s)&&(i=h.batchScaleWithCenter(i,{sx:l,sy:c},this.centerCoord)),i}_getArcCorner(e,s){let n=this.normalizeCorners;const{type:i,width:o}=s,{width:a,height:l}=h.calcParallelogramVerticalSize(e),c=Math.min(a,l);return n=n.map(d=>{if(d===0)return d;switch(i){case pe.inside:return R.clamp(d-o/2,0,c/2);case pe.outside:return R.clamp(d+o/2,0,c/2);default:return d}}),n}_getVerticalIntersection(e,s){return{coords:h.calcParallelogramVerticalIntersectionPoints(e,s,!0),indexes:[[0,1],[1,2],[2,3],[3,0]]}}_getCrossPointsOfParallelLines(e,s){return{coords:h.calcCrossPointsOfParallelLines(e,s),indexes:[[3,0],[0,1],[1,2],[2,3]]}}_getArcVerticalCoords(e){let s=this.calcUnLeanBoxCoords();s=this._getArcBoxCoords(e);const n=this._getArcCorner(s,e),i=[];return R.range(4).forEach(o=>{const a=s[o],l=n[o],c=this.calcUnLeanCornerCoordBy(a,o,l);let d=s[o],u,f;if(!l)u=s[o],f=s[o];else{const{coords:g,indexes:C}=this._getVerticalIntersection(c,s);u=g[C[o][0]],f=g[C[o][1]],u||(u=s[o]),f||(f=s[o])}i.push({start:u,controller:d,end:f,value:l,corner:c})}),i}calcUnLeanCornerCoord(e,s){const n=s?this.normalizeCorners[e]:this.visualCorners[e],i=h.leanWithCenter(this.model.boxCoords[e],this.model.leanXAngle,-this.model.leanYAngle,this.centerCoord);return this.calcUnLeanCornerCoordBy(i,e,n)}calcUnLeanCornerCoordBy(e,s,n){if(n===0)return e;let i,o;return[0,3].includes(s)?i=this.flipX?-n:n:i=this.flipX?n:-n,[0,1].includes(s)?o=n:o=-n,h.translate(e,{x:i,y:o})}calcCornerCoord(e,s){const n=this._rotateBoxCoords[e],i=this.visualCorners[e];let o=this.calcUnLeanCornerCoord(e,s);o=h.transWithCenter(o,this.angles,this.centerCoord);const{coords:a,indexes:l}=this._getCrossPointsOfParallelLines(o,this._rotateBoxCoords);let c=a[l[e][0]],d=a[l[e][1]];if(!c||!d)return n;let u=h.calcTriangleAngleWithClockwise(c,n,d);const f=this.flipX;f&&(u=180-u);const g=h.calcAngle(n,d)+(f?-u/2:u/2),C=this._getCornerTargetCoord(e,this._rotateBoxCoords),y=h.calcDistance(n,C)*2,E=i/this.minParallelogramVerticalSize,b=y*E;return h.calcTargetPoint(n,b,g)}refreshCornersController(e){if(this._cornerCoords.length===0)return;const{x:s,y:n}=this._cornerCoords[e],i=this.getController4BoxCoords(this._cornerCoords[e]);this._cornerControllers[e]?(this._cornerControllers[e].x=s,this._cornerControllers[e].y=n,this._cornerControllers[e].points=i):this._cornerControllers[e]=new cs(this,{x:s,y:n,points:i})}refreshCornerCoords(e){!this._rotateBoxCoords||!this._rotateBoxCoords.length||(this._cornerCoords[e]=this.calcCornerCoord(e))}refreshCornersCoords(e){e=e||[0,1,2,3],e.forEach(s=>{this.refreshCornerCoords(s)})}refreshCornersControllers(e){e=e||[0,1,2,3],e.forEach(s=>{this.refreshCornersController(s)})}_refreshCorners(){this.status===ie.finished&&(this.refreshCornersCoords(),this.refreshCornersControllers())}refreshCorners(){super.refreshCorners(),this.isInMultiSelected||this._refreshCorners()}refreshStrokePoints(){super.refreshStrokePoints(),this._arcCoords=this.calcArcCoords(),this._arcFillCoords=this.calcArcFillCoords()}_getCorner(e){return this.isCornerMoving?e:e===0?this.minParallelogramVerticalSize/2*.2:e}refreshOriginalElementProps(){super.refreshOriginalElementProps(),this._originalCornerCoords=V.jsonClone(this._cornerCoords),this._originalAllCornerEqual=this.isAllCornerEqual}refreshOriginalStrokes(){super.refreshOriginalStrokes(),this._originalArcCoords=V.jsonClone(this._arcCoords),this._originalArcFillCoords=V.jsonClone(this._arcFillCoords)}_getCornerTargetCoord(e,s){let n,[i,o]=h.calculateAngleBisectorIntersection(s);const{width:a,height:l}=h.calcParallelogramVerticalSize(s);return a<=l?[0,1].includes(e)?n=i:n=o:[0,3].includes(e)?n=i:n=o,n}updateCornerByOffset(e){const s=this.getActiveController();if(s instanceof cs){const n=this.cornerControllers.indexOf(s);if(n!==-1){const i=this._getCornerTargetCoord(n,this._rotateBoxCoords),o=this._originalCornerCoords[n],a={x:e.x+o.x,y:e.y+o.y},l=this._rotateBoxCoords[n],c=h.calcProjectionOnSegment(a,i,l);let d=h.calcSegmentProportion(c,i,l);d=R.clamp(d,0,1),d=1-d;let u=d*(this.minParallelogramVerticalSize/2);this._originalAllCornerEqual?this.updateCorners(u):this.updateCorners(u,n)}}}_normalizeCorners(){const e=[...this.model.corners];return R.every(e,s=>s===0)?e:k.fixCornersBasedOnMinSize(e,this.minParallelogramVerticalSize)}_translateArc(e){this._arcCoords=h.batchTranslateArcPoints(this._originalArcCoords,e),this._arcFillCoords=h.translateArcPoints(this._originalArcFillCoords,e)}translateBy(e){this._translateArc(e),super.translateBy(e)}_setIsSelected(e){super._setIsSelected(e),e&&this._refreshCorners()}}class aa extends vt{constructor(){super(...arguments);p(this,"_outerCoords",[]);p(this,"_originalOuterCoords",[])}get editingEnable(){return!1}get flipXEnable(){return!1}get flipYEnable(){return!1}get coordTransformEnable(){return!0}get boxVerticesTransformEnable(){return!1}get heightInputEnable(){return!1}get rotationEnable(){return!1}get borderTransformEnable(){return!1}get fillEnable(){return!1}get fillInputEnable(){return!1}get ratioLockedEnable(){return!1}get viewAngleCalcEnable(){return!1}get leanYAngleCalcEnable(){return!1}get leanYAngleInputEnable(){return!1}get startRotateCoord(){return this._rotateCoords[0]}get endRotateCoord(){return this._rotateCoords[1]}get outerCoords(){return this._outerCoords}get transformerType(){return ct.circle}get alignOutlineCoords(){return this._outerCoords}refreshBentOutline(){this._outerCoords=this.calcOuterCoords(),this._maxOutlineBoxCoords=L.getBoxByPoints(this._outerCoords.flat())}refreshPoints(){super.refreshPoints(),this.refreshBentOutline()}calcOuterCoords(){return this.model.styles.strokes.map(e=>Ue.calcBentLineOuterVertices(this._rotateCoords,e.width/2))}refreshOutlinePoints(){super.refreshOutlinePoints(),this.refreshBentOutline()}getAngle(){return this.startRotateCoord&&this.endRotateCoord?k.fixAngle(h.calcAngle(this.startRotateCoord,this.endRotateCoord)+90):0}isContainsCoord(e){return R.some(this.model.styles.strokes,s=>h.isPointClosestSegment(e,this.startRotateCoord,this.endRotateCoord,Br+s.width/2/re.stageParams.scale))}isPolygonOverlap(e){return R.some(this._outerCoords,s=>h.isPolygonsOverlap(s,e))}isModelPolygonOverlap(e){return R.some(this._outerCoords,s=>h.isPolygonsOverlap(s,e))}doVerticesTransform(e){const s=this._transformers.findIndex(n=>n.isActive);if(s!==-1){const n=this._originalTransformerCoords[L.getNextIndexOfArray(2,s,1)],i=this._originalTransformerCoords[s];this.transformByLockPoint(n,i,e,s)}}setWidth(e){const s=h.calcTargetPoint(this.startRotateCoord,e,this.angle-90);return this.model.coords=[this.startRotateCoord,s],this.model.boxCoords=L.getBoxByPoints(this.model.coords),this.model.width=e,this.model.angle=0,[[]]}__updateAngle(e){const s=h.calcTargetPoint(this.startRotateCoord,this.model.width,e-90);this.model.coords=[this.startRotateCoord,s],this.model.boxCoords=L.getBoxByPoints(this.model.coords)}setAngle(e){this.__updateAngle(e),super.setAngle(0)}updateAngle(e){this.__updateAngle(e),super.updateAngle(0)}translateBy(e){this._outerCoords=this._originalOuterCoords.map(s=>h.batchTranslate(s,e)),super.translateBy(e)}refreshOriginalStrokes(){super.refreshOriginalStrokes(),this._originalOuterCoords=V.jsonClone(this._outerCoords)}}class la extends Xe{async run(){if(!this.canvas||!this.element)return;const{strokeCoords:t,model:{styles:e}}=this.element;k.batchCalcStageRelativePoints(t).forEach((n,i)=>{G.drawPathWithScale(this.canvas,n,e.fills[0],e.strokes[i])})}}class Rn extends an{get fillEnable(){return!1}get fillInputEnable(){return!1}async toJson(){const t=await super.toJson(),e=this.model.data;if(e instanceof HTMLImageElement){const s=await G.getDataUrlFromImage(e);t.data=s}else t.data=e;return t}}class ca extends Xe{async run(){if(!this.canvas||!this.element)return;const{arcCoords:t,arcFillCoords:e,model:{styles:s},angle:n,flipX:i,leanY:o,actualAngle:a}=this.element,l=k.batchCalcStageRelativeArcPoints(t),c=k.calcStageRelativeArcPoints(e),d={angle:n,flipX:i,leanY:o,actualAngle:a},u=Oe.calcElementRenderRect(this.element);G.drawImgLike(this.canvas,this.element.model.data,u,{...d,clipArcPoints:c}),l.forEach((f,g)=>{G.drawArcPathStrokeWidthScale(this.canvas,f,u,s.strokes[g],d)})}}class da extends Xe{async run(){if(!this.canvas||!this.element)return;let{innermostStrokeCoordIndex:t,strokeCoords:e,model:{styles:s,isFold:n,coords:i},isOnStage:o}=this.element;if((i==null?void 0:i.length)===0||!o)return;const a=k.batchCalcStageRelativePoints(e);n&&s.fills.forEach(l=>{G.drawInnerPathFillWithScale(this.canvas,a[t],l,s.strokes[t])}),a.forEach((l,c)=>{G.drawPathStrokeWidthScale(this.canvas,l,s.strokes[c],{isFold:n,miterLimit:eo})})}}class zs extends vt{constructor(e,s){super(e,s);p(this,"tailCoordIndex");p(this,"editingCoordIndex");p(this,"_outerWorldPaths",[]);p(this,"_originalOuterWorldPaths",[]);this.tailCoordIndex=-1}get transformerType(){return ct.circle}get coordTransformEnable(){return this.status!==ie.finished}get activeCoordIndex(){return[ie.startCreating,ie.creating,ie.initialed].includes(this.status)?this.model.coords.length>this.tailCoordIndex+1?this.tailCoordIndex+1:this.tailCoordIndex:-1}get outerWorldPaths(){return this._outerWorldPaths}get tfRefreshAfterEdChanged(){return!0}get isValid(){return this.model.coords.length>=2}_setStatus(e){super._setStatus(e),e===ie.finished&&(this.tailCoordIndex=-1)}calcOuterWorldPaths(){return this._strokeCoords.map((e,s)=>k.calcArbitraryBorderRegions(e,this.model.styles.strokes[s],this.model.isFold))}refreshOutlinePoints(){this._outerWorldPaths=this.calcOuterWorldPaths(),super.refreshOutlinePoints()}refreshOriginalStrokes(){super.refreshOriginalStrokes(),this._originalOuterWorldPaths=V.jsonClone(this._outerWorldPaths)}isContainsCoord(e){let s;return this.visualStrokeWidth<Sn?s=this._strokeCoords.map(n=>k.calcArbitraryBorderRegions(n,{width:Sn/re.stageParams.scale},this.model.isFold)):s=this._outerWorldPaths,R.some(s,n=>R.some(n,i=>h.isPointInPolygonByRayCasting(e,i)))}isPolygonOverlap(e){return R.some(this._outerWorldPaths,s=>R.some(s,n=>h.isPolygonsOverlap(n,e)))}isModelPolygonOverlap(e){return R.some(this._outerWorldPaths,s=>R.some(s,n=>h.isPolygonsOverlap(n,e)))}calcRotateOutlineCoords(){return this._outerWorldPaths.flat()}activeEditingCoord(e){this.editingCoordIndex=e}deActiveEditingCoord(){this.editingCoordIndex=-1}setControllersActive(e,s){super.setControllersActive(e,s),e.forEach(n=>{if(n instanceof _t){const i=this._transformers.findIndex(o=>o.id===n.id);if(i===-1)return;s?this.activeEditingCoord(i):this.deActiveEditingCoord()}})}doVerticesTransform(e){this.status===ie.editing?this.doEditingTransform(e):super.doVerticesTransform(e)}doEditingTransform(e){if(this.editingCoordIndex!==-1){const s=V.jsonClone(this._originalRotateCoords);s[this.editingCoordIndex]={x:s[this.editingCoordIndex].x+e.x,y:s[this.editingCoordIndex].y+e.y};const n=this._originalRotateBoxCoords[0];this.model.coords=h.batchPrecisePoints(k.calcCoordsByTransPoints(s,this.angles,n),1);let i=h.batchPrecisePoints(h.batchLeanWithCenter(L.getBoxByPoints(h.calcUnLeanByPoints(this.model.coords,0,this.model.leanYAngle)),0,this.model.leanYAngle,this.calcCenterCoord()),1);this._flipX&&(i=h.batchCalcSymmetryPoints(i,h.calcPolygonCentroid([i[0],i[1]]),h.calcPolygonCentroid([i[2],i[3]]))),this.model.boxCoords=i}}_translateOuterCoords(e){this._outerWorldPaths=this._originalOuterWorldPaths.map((s,n)=>s.map(i=>i.map(o=>h.translate(o,e))))}translateBy(e){this._translateOuterCoords(e),super.translateBy(e)}async toJson(){const e=await super.toJson();return this.status===ie.creating&&(e.coords=this.model.coords.slice(0,this.tailCoordIndex+1)),e}async toElementJson(){return{...await super.toElementJson(),tailCoordIndex:this.tailCoordIndex,editingCoordIndex:this.editingCoordIndex}}}class ln extends vt{get subs(){return this.getSubs()}get deepSubs(){return this.getDeepSubs()}get subIds(){return this.model.subIds}get deepSubIds(){return this.getDeepSubIds()}get firstSub(){return this.shield.store.getElementById(this.subIds[0])}get firstDeeoSub(){let t=this.firstSub;for(;t&&t.isGroup;)t=t.firstSub;return t}get strokeEnable(){return!1}get strokeInputEnable(){return!1}get fillEnable(){return!1}get fillInputEnable(){return!1}get editingEnable(){return!1}get alignOutlineCoords(){return[L.getBoxByPoints(this.subs.map(t=>t.alignOutlineCoords.flat()).flat())]}addSub(t){this.model.subIds.push(t.id)}removeSub(t){const e=this.model.subIds.indexOf(t.id);e!==-1&&this.model.subIds.splice(e,1)}removeSubById(t){const e=this.model.subIds.indexOf(t);e!==-1&&this.model.subIds.splice(e,1)}hasSub(t){var e;return(e=this.model.subIds)==null?void 0:e.includes(t.id)}hasSubById(t){var e;return(e=this.model.subIds)==null?void 0:e.includes(t)}getSubs(){return this.shield.store.getOrderedElementsByIds(this.model.subIds)}getDeepSubs(){const t=this.getDeepSubIds();return this.shield.store.getOrderedElementsByIds(t)}getDeepSubIds(){const t=[];return this._getDeepSubIds(t,this.getSubs()),t}_getDeepSubIds(t,e){return e.forEach(s=>{s.isGroup&&this._getDeepSubIds(t,s.subs),t.push(s.id)}),t}getSubElementsByType(t){return this.getSubs().filter(e=>e.isElement&&e.model.type===t)}getAllSubElements(){return this.getSubs().filter(t=>t.isElement)}getAllSubElementGroups(){return this.getSubs().filter(t=>t.isGroup)}clearSubs(){this.model.subIds=[]}isContainsCoord(t){return this.deepSubs.some(e=>e.isContainsCoord(t))}isPolygonOverlap(t){return this.deepSubs.some(e=>e.isPolygonOverlap(t))}isModelPolygonOverlap(t){return this.deepSubs.some(e=>e.isModelPolygonOverlap(t))}_setIsSelected(t){super._setIsSelected(t),this.deepSubs.forEach(e=>{e.isSelected=t})}calcRotateOutlineCoords(){return[this._rotateCoords]}hitSubs(t,e){const s=this.getSubs();for(let n=s.length-1;n>=0;n--){const i=s[n];i.isContainsCoord(t)&&(e.push(i),i.isGroup&&i.hitSubs(t,e))}return e}hitTopASub(t){return this.hitSubs(t,[]).shift()}_doRefreshBySubs(t){const e=t.map(y=>y.rotateBoxCoords).flat(),s=this._originalCenterCoord,n={start:s,end:{x:(this._originalRotateBoxCoords[0].x+this._originalRotateBoxCoords[1].x)/2,y:(this._originalRotateBoxCoords[0].y+this._originalRotateBoxCoords[1].y)/2}},i={start:s,end:{x:(this._originalRotateBoxCoords[1].x+this._originalRotateBoxCoords[2].x)/2,y:(this._originalRotateBoxCoords[1].y+this._originalRotateBoxCoords[2].y)/2}},o=h.calcMinParallelogramByPointsByCenter(e,i.end,n.end,s),a=h.calcPolygonCentroid(o),l=h.calcParrelLine(n,a),c=h.calcParrelLine(i,a),d=o.find(y=>!h.isPointClockwiseOfLine(y,l.start,l.end)&&!h.isPointClockwiseOfLine(y,c.start,c.end)),u=o.find(y=>h.isPointClockwiseOfLine(y,l.start,l.end)&&!h.isPointClockwiseOfLine(y,c.start,c.end)),f=o.find(y=>h.isPointClockwiseOfLine(y,l.start,l.end)&&h.isPointClockwiseOfLine(y,c.start,c.end)),g=o.find(y=>!h.isPointClockwiseOfLine(y,l.start,l.end)&&h.isPointClockwiseOfLine(y,c.start,c.end)),C=[d,u,f,g];this.model.boxCoords=h.batchPrecisePoints(h.batchRotateWithCenter(C,-this.model.angle,a)),this.model.coords=V.jsonClone(this.model.boxCoords),this.model.x=a.x,this.model.y=a.y,this.refresh(V.toBooleanObject(["points","rotation","size"]))}refreshBySubs(){this._doRefreshBySubs(this.deepSubs)}refreshBySubsWithout(t){this._doRefreshBySubs(this.deepSubs.filter(e=>!t.includes(e.id)))}async toSubUpdatedJson(){return JSON.parse(JSON.stringify(R.pick(this.model,[...ss,"width","height","subIds"])))}}var ds=(r=>(r[r.START=0]="START",r[r.END=1]="END",r))(ds||{}),ae=(r=>(r.NONE="none",r.INPUT="input",r.DELETE_SELECTION="delete_selection",r.DELETE_PREV="delete_prev",r.INSERT_NEWLINE="insert_newline",r.SELECT_ALL="select_all",r.COPY_SELECTION="copy_selection",r.CUT_SELECTION="cut_selection",r.PASTE_TEXT="paste_text",r.UNDO="undo",r.REDO="redo",r.MOVE_CURSOR="move_cursor",r.MOVE_SELECTION="move_selection",r))(ae||{}),Ct=(r=>(r.PRESS_DOWN="press_down",r.PRESS_MOVE="press_move",r.PRESS_UP="press_up",r))(Ct||{}),ne=(r=>(r.FONT_SIZE="font_size",r.FONT_FAMILY="font_family",r.FONT_STYLER="font_styler",r.FONT_COLOR="font_color",r.FONT_COLOR_OPACITY="font_color_opacity",r.FONT_ALIGN="font_align",r.FONT_LINE_HEIGHT="font_line_height",r.FONT_LINE_HEIGHT_FACTOR="font_line_height_factor",r.FONT_LINE_HEIGHT_AUTO_FIT="font_line_height_auto_fit",r.FONT_LETTER_SPACING="font_letter_spacing",r.FONT_PARAGRAPH_SPACING="font_paragraph_spacing",r.FONT_TEXT_CASE="font_text_case",r.FONT_TEXT_ALIGN="font_text_align",r.FONT_TEXT_VERTICAL_ALIGN="font_text_vertical_align",r.FONT_TEXT_DECORATION="font_text_decoration",r.FONT_TEXT_DECORATION_COLOR="font_text_decoration_color",r.FONT_TEXT_DECORATION_OPACITY="font_text_decoration_opacity",r.FONT_TEXT_DECORATION_THICKNESS="font_text_decoration_thickness",r.FONT_TEXT_BASELINE="font_text_baseline",r))(ne||{});function gt(r,t,e){const{id:s,x:n,y:i,height:o,width:a}=r;return{nodeId:s,pos:t,lineNumber:e,x:n+(t===j.RIGHT?a:0),y:i,width:mi,height:o}}function Dt(r,t){const{x:e,y:s,height:n}=r;return{lineNumber:t,x:e,y:s,width:mi,height:n}}function kn(r,t){const{nodes:e}=r,s=e[e.length-1];return s?gt(s,j.RIGHT,t):Dt(r,t)}class I{static createTextNode(t,e){return{id:L.getRandomId(),content:t,fontStyle:e}}static createTextLines(t,e){const s=[];return t.split(`
`).forEach(n=>{const i=n.split("").map(o=>I.createTextNode(o,{...e}));s.push({nodes:i,isTailBreak:!0,fontStyle:{...e}})}),s}static createTextData(t,e){return e=R.pick(e,["fontFamily","fontStyler","fontSize","fontColor","fontColorOpacity","fontLetterSpacing","textDecoration","textDecorationColor","textDecorationOpacity","textDecorationThickness"]),{lines:this.createTextLines(t,e)}}static getTextCursorAtPosition(t,e,s){const n={},{lines:i}=t;let o,a=-1;for(let l=0;l<i.length;l++){const c=i[l];if(L.isPointInRect(c,e)){o=c,a=l;break}}if(o){n.lineNumber=a;for(let l=0;l<o.nodes.length;l++){let c=o.nodes[l];if(L.isPointInRect(c,e)){let d=j.LEFT;e.x>=c.x+c.width/2?d=j.RIGHT:l>0&&(c=o.nodes[l-1],d=j.RIGHT),Object.assign(n,gt(c,d,a));break}}n.nodeId||(s==="right"||s==="center"&&e.x<=o.renderX?Object.assign(n,this.getCursorOfLineStart(o,a)):Object.assign(n,kn(o,a)))}else a=i.length-1,n.lineNumber=a,Object.assign(n,kn(i[a],a));return n}static getCursorOfLineEnd(t,e){const{nodes:s}=t;let n;if(s.length>0){const i=s[s.length-1];n=gt(i,j.RIGHT,e)}else n=Dt(t,e);return n.lineNumber=e,n}static getCursorOfLineStart(t,e){let s;return t.nodes.length===0?s=Dt(t,e):s=gt(t.nodes[0],j.LEFT,e),s.lineNumber=e,s}static getCursorOfLineHead(t,e){const s=Dt(t,e);return s.lineNumber=e,s}static getCursorOfNode(t,e,s){const n=gt(t,e,s);return n.lineNumber=s,n}static getLineByNodeId(t,e){const{lines:s}=t;return s.findIndex(n=>n.nodes.some(i=>i.id===e))}static getUpdatedCursorPropsOfLine(t,e,s,n){if(!t)return;const{nodeId:i}=s;let o;return i&&(o=t.nodes.find(a=>a.id===i)),o?gt(o,n,e):Dt(t,e)}static getUpdatedCursorProps(t,e){let{pos:s,nodeId:n,lineNumber:i}=e;if(n&&(i=I.getLineByNodeId(t,n)),i!==-1)return I.getUpdatedCursorPropsOfLine(t.lines[i],i,e,s)}static isTextSelectionAvailable(t){if(!t)return!1;const{startCursor:e,endCursor:s}=t;if(!e||!s)return!1;const{lineNumber:n,nodeId:i,pos:o}=e,{lineNumber:a,nodeId:l,pos:c}=s;return n!==a||i!==l||o!==c}static getTextNodeById(t,e){const{lines:s}=t;for(let n=0;n<s.length;n++){const o=s[n].nodes.find(a=>a.id===e);if(o)return o}}static getTextNodeIndex(t,e){const{lines:s}=t;for(let n=0;n<s.length;n++){const i=s[n],o=I.getTextNodeIndexOfLine(i,e);if(o!==-1)return o}return-1}static getTextNodeIndexOfLine(t,e){return t.nodes.findIndex(s=>s.id===e)}static sortCursors(t,e){return[...e].sort((n,i)=>n.lineNumber!==i.lineNumber?n.lineNumber-i.lineNumber:n.nodeId!==i.nodeId?I.getTextNodeIndex(t,n.nodeId)-I.getTextNodeIndex(t,i.nodeId):n.pos-i.pos)}static isCursorAtSamePosition(t,e,s){if(I.isCursorEqual(t,e))return!0;if(!t&&e||!e&&t)return!1;if(s){const{nodeId:n,lineNumber:i,pos:o}=t,{nodeId:a,lineNumber:l,pos:c}=e;if(i===l){const d=I.getTextNodeIndexOfLine(s.lines[i],n),u=I.getTextNodeIndexOfLine(s.lines[l],a);if(d!==-1&&u!==-1&&(d+1===u&&o===j.RIGHT&&c===j.LEFT||d-1===u&&o===j.LEFT&&c===j.RIGHT))return!0}}return!1}static isCursorEqual(t,e){return!!t&&!!e&&t.lineNumber===e.lineNumber&&t.nodeId===e.nodeId&&t.pos===e.pos}static isSelectionEqualWithStart(t,e,s){return!!t&&!!e&&!!t.startCursor&&!!e.startCursor&&I.isCursorAtSamePosition(t.startCursor,e.startCursor,s)}static getTextFromTextData(t){return t.lines.map(e=>e.nodes.map(s=>s.content).join("")).join(`
`)}static newFontStyleSet(){return{fontFamilies:new Set,fontStylers:new Set,fontSizes:new Set,fontColors:new Set,fontColorOpacities:new Set,fontLetterSpacings:new Set,textDecorations:new Set,textDecorationColors:new Set,textDecorationOpacities:new Set,textDecorationThicknesses:new Set}}static cacheStyleSet(t,e){t&&(R.isString(t.fontFamily)&&e.fontFamilies.add(t.fontFamily),R.isString(t.fontStyler)&&e.fontStylers.add(t.fontStyler),R.isNumber(t.fontSize)&&e.fontSizes.add(t.fontSize),R.isString(t.fontColor)&&e.fontColors.add(t.fontColor),R.isNumber(t.fontColorOpacity)&&e.fontColorOpacities.add(t.fontColorOpacity),R.isNumber(t.fontLetterSpacing)&&e.fontLetterSpacings.add(t.fontLetterSpacing),R.isString(t.textDecoration)&&e.textDecorations.add(t.textDecoration),R.isString(t.textDecorationColor)&&e.textDecorationColors.add(t.textDecorationColor),R.isNumber(t.textDecorationOpacity)&&e.textDecorationOpacities.add(t.textDecorationOpacity),R.isNumber(t.textDecorationThickness)&&e.textDecorationThicknesses.add(t.textDecorationThickness))}static cacheStyleSetOfNode(t,e){const{fontStyle:s}=t;I.cacheStyleSet(s,e)}static getStyleSetOfNode(t){const e=I.newFontStyleSet();return I.cacheStyleSetOfNode(t,e),e}static getStyleSetOfNodes(t){const e=I.newFontStyleSet();for(let s=0;s<t.length;s++)I.cacheStyleSetOfNode(t[s],e);return e}static getStyleSetOfTextData(t,e){const s=I.newFontStyleSet();return t.lines.forEach(n=>{n.nodes.forEach(i=>{(!e||e&&i.selected)&&I.cacheStyleSetOfNode(i,s)})}),s}static getReferByCursor(t,e){const{lineNumber:s,nodeId:n,pos:i}=t,o=e.lines[s];if(!n)return o;const a=o.nodes.findIndex(l=>l.id===n);if(a!==-1){const l=o.nodes[a];return a===0||i===j.RIGHT?l:o.nodes[a-1]}return o}static getReferFontStyleByCursor(t,e){const s=I.getReferByCursor(t,e);if(s)return s.fontStyle}static getStyleSetByCursor(t,e){const s=I.getReferFontStyleByCursor(t,e),n=I.newFontStyleSet();return I.cacheStyleSet(s,n),n}static markTextUnselected(t){t.lines.forEach(e=>{e.nodes.forEach(s=>{s.selected=!1}),e.selected=!1})}static setLineSelectedIfy(t){R.every(t.nodes,e=>e.selected)&&(t.selected=!0)}static setNodeSelected(t,e,s){if(e<=s)for(let n=e;n<=s;n++)t.nodes[n].selected=!0;else for(let n=e;n>=s;n--)t.nodes[n].selected=!0}static rightSelectOfLine(t,e,s){let n=-1;if(e){if(n=t.nodes.findIndex(i=>i.id===e),s===j.RIGHT){if(n===t.nodes.length-1)return;n++}}else n=0;I.setNodeSelected(t,n,t.nodes.length-1)}static leftSelectOfLine(t,e,s){let n=-1;if(e){if(n=t.nodes.findIndex(i=>i.id===e),s===j.LEFT){if(n===0)return;n--}}else n=0;I.setNodeSelected(t,0,n)}static partialSelectOfLine(t,e,s,n,i){let o=-1;e?o=t.nodes.findIndex(l=>l.id===e):o=0;let a=t.nodes.findIndex(l=>l.id===n);o<a?(s===j.RIGHT&&o++,i===j.LEFT&&a--):o>a&&(s===j.LEFT&&o--,i===j.RIGHT&&a++),I.setNodeSelected(t,o,a)}static markTextSelected(t,e){const{lines:s}=t;let{startCursor:n,endCursor:i}=e;const{lineNumber:o,nodeId:a,pos:l}=n,{lineNumber:c,nodeId:d,pos:u}=i;if(o===c)I.partialSelectOfLine(s[o],a,l,d,u),I.setLineSelectedIfy(s[o]);else if(o<c)for(let f=o;f<=c;f++){const g=s[f];g.nodes.length===0?g.selected=!0:(f===o?I.rightSelectOfLine(g,a,l):f===c?I.leftSelectOfLine(g,d,u):I.setNodeSelected(g,0,g.nodes.length-1),I.setLineSelectedIfy(g))}else for(let f=o;f>=c;f--){const g=s[f];g.nodes.length===0?g.selected=!0:(f===o?I.leftSelectOfLine(g,a,l):f===c?I.rightSelectOfLine(g,d,u):I.setNodeSelected(g,0,g.nodes.length-1),I.setLineSelectedIfy(g))}}static margeNodesOfLine(t,e,s){const n=t.lines[s],i=t.lines[e];n.nodes=n.nodes.filter(o=>!o.selected),i.nodes=i.nodes.filter(o=>!o.selected),i.nodes.push(...n.nodes),t.lines.splice(s,1)}static deleteSelectedNodesOfLine(t){t.nodes=t.nodes.filter(e=>!e.selected)}static getTailNodeOfLine(t,e){if(0<=e&&e<t.lines.length){const s=t.lines[e];return s.nodes[s.nodes.length-1]}return null}static getTailNodeOfLineIfNotBreak(t,e){if(0<=e&&e<t.lines.length){const s=t.lines[e];return s.isTailBreak?null:s.nodes[s.nodes.length-1]}return null}static getAnchorNodeByCursor(t,e){const{lineNumber:s,nodeId:n,pos:i}=e;let o,a=s,l=!1;if(n){const c=t.lines[s],d=c.nodes.findIndex(u=>u.id===n);o=c.nodes[d],i===j.LEFT&&(d>0?o=c.nodes[d-1]:l=!0)}else l=!0;return{textNode:o,lineNumber:a,isHead:l}}static getClosestNodeCursorOfLine(t,e,s){if(e.lineNumber===s)return e;if(t.nodes.length>0){let n;for(let i=0;i<t.nodes.length;i++){const o=t.nodes[i];o.x+o.width<=e.x&&(n=o)}if(n)return I.getCursorOfNode(n,j.RIGHT,s)}return I.getCursorOfLineStart(t,s)}static getClosestNodeCursor(t,e,s){const{lines:n}=t,{lineNumber:i}=e;if(s===j.TOP){if(i>0)return I.getClosestNodeCursorOfLine(n[i-1],e,i-1)}else if(i<n.length-1)return I.getClosestNodeCursorOfLine(n[i+1],e,i+1);return e}static getFontStyleOfModel(t){return R.pick(t.styles,["fontSize","fontFamily","fontColor","fontColorOpacity","fontLetterSpacing"])}static getStyleByNodeIfy(t,e,s){return e&&e.fontStyle?V.jsonClone(e.fontStyle):s&&s.fontStyle?V.jsonClone(s.fontStyle):I.getFontStyleOfModel(t)}static getStyleOfLineEnd(t,e){const{nodes:s,fontStyle:n}=e;return s.length?I.getStyleByNodeIfy(t,s[s.length-1]):n?V.jsonClone(n):I.getFontStyleOfModel(t)}static pickSelectedContent(t){const{lines:e}=t,s=[];for(let n=0;n<e.length;n++){const i=e[n];if(i.selected)s.push({...i,isFull:!0});else{const o=i.nodes.filter(a=>a.selected);o.length>0&&s.push({nodes:o,isFull:!1})}}return s}static isTextNode(t){return["id","content","fontStyle"].every(e=>e in t)}static isTextLine(t){return["nodes"].every(e=>e in t)}static cloneTextNode(t){const{content:e,fontStyle:s}=t;return{id:L.getRandomId(),content:e,fontStyle:V.jsonClone(s)}}static batchCloneTextNodes(t){return t.map(I.cloneTextNode)}static cloneTextLine(t){const{nodes:e,isTailBreak:s,isFull:n,fontStyle:i}=t;return{nodes:I.batchCloneTextNodes(e),isTailBreak:s,isFull:n,fontStyle:V.jsonClone(i)}}static batchCloneTextLine(t){return t.map(I.cloneTextLine)}static parseTextLines(t){let e=[];try{const s=JSON.parse(t);Array.isArray(s)&&s.every(n=>I.isTextLine(n))&&(e=I.batchCloneTextLine(s))}catch(s){s&&console.warn(s)}return e}static reflowTextLines(t,e,s){const n=I.restoreTextLines(t);return I.calcReflowTextLines(n,e,s)}static restoreTextLines(t){if(t.length===0)return[];let e=[{nodes:[],width:0}];for(let s=0;s<t.length;s++){const n=t[s],{nodes:i,isTailBreak:o,fontStyle:a}=n,l=e[e.length-1];l.nodes.push(...i),l.isTailBreak=o,o&&(l.fontStyle=a),l.width+=i.reduce((c,d)=>c+d.width+d.indentX,0),o&&s<t.length-1&&e.push({nodes:[],width:0})}return e}static calcReflowTextLines(t,e,s){if(t.length===0)return[];const n=[];let i={nodes:[]},o=0;for(let a=0;a<t.length;a++){const l=t[a],{nodes:c,isTailBreak:d,fontStyle:u={}}=l;if(c.length===0){n.push({nodes:[],isTailBreak:d,fontStyle:u});continue}for(let f=0;f<c.length;f++){const g=c[f],C=(g.width+g.indentX)/s;o+C<=e?(i.nodes.push(g),o+=C):i.nodes.length===0?(n.push({nodes:[g]}),i.nodes=[],o=0):(n.push({...V.jsonClone(i),fontStyle:{...u}}),i.nodes=[g],o=C)}i.nodes.length>0&&n.push({...V.jsonClone(i),fontStyle:{...u}}),d&&(n[n.length-1].isTailBreak=d),i.nodes=[],o=0}return n}static calcMaxLineWidth(t,e){if(t.length===0)return 0;let s=0;for(let n=0;n<t.length;n++){const i=t[n],{renderWidth:o}=i;s=Math.max(s,o/e)}return s}static calcMaxLineWidthByNodes(t,e){if(t.length===0)return 0;let s=0;for(let n=0;n<t.length;n++){const i=t[n],{nodes:o}=i;s=Math.max(s,o.reduce((a,l)=>a+l.width+l.indentX,0)/e)}return s}static calcTextRenderHeight(t,e){if(t.length===0)return 0;if(t.length===1)return t[0].height/e;const s=t[0].y;return(t[t.length-1].y+t[t.length-1].height-s)/e}static shouldRelationUndoCommand(t){return[ne.FONT_FAMILY,ne.FONT_SIZE,ne.FONT_COLOR,ne.FONT_COLOR_OPACITY,ne.FONT_LETTER_SPACING,ne.FONT_STYLER,ne.FONT_TEXT_CASE,ne.FONT_TEXT_DECORATION,ne.FONT_TEXT_DECORATION_COLOR,ne.FONT_TEXT_DECORATION_OPACITY,ne.FONT_TEXT_DECORATION_THICKNESS,ne.FONT_LINE_HEIGHT,ne.FONT_LINE_HEIGHT_FACTOR,ne.FONT_LINE_HEIGHT_AUTO_FIT,ne.FONT_TEXT_ALIGN,ne.FONT_TEXT_VERTICAL_ALIGN,ne.FONT_PARAGRAPH_SPACING].includes(t)}}class js{static copyValueToClipboard(t){let e=document.createElement("input");document.body.appendChild(e),e.value=t,e.select(),document.execCommand("copy"),document.body.removeChild(e),e=null}static getContentByInnerHtml(t){let e=document.createElement("div");e.innerHTML=t;const s=e.textContent;return e.remove(),e=null,s}static async readValueFromClipboard(){return new Promise(t=>{navigator.clipboard.readText().then(e=>{t(e)})})}static async writeValueToClipboard(t){return navigator.clipboard.writeText(t)}static isFocusOnInput(){var t,e;return((t=document.activeElement)==null?void 0:t.tagName)==="INPUT"||((e=document.activeElement)==null?void 0:e.tagName)==="TEXTAREA"}}var $=(r=>(r.Creating="Creating",r.StartCreating="StartCreating",r.Added="Added",r.Updated="Updated",r.Removed="Removed",r.Moved="Moved",r.GroupUpdated="GroupUpdated",r))($||{}),Z=(r=>(r.ElementsAdded="elements_added",r.ElementsRemoved="elements_removed",r.ElementsUpdated="elements_updated",r.ElementsRearranged="elements_rearranged",r.ElementsMoved="elements_moved",r.ElementsCreating="elements_creating",r.ElementsStartCreating="elements_start_creating",r.ElementsCreatorChanged="elements_creator_changed",r.GroupAdded="group_added",r.GroupRemoved="group_removed",r.DetachedElementsRemoved="detached_elements_removed",r.ElementsSelected="elements_selected",r))(Z||{}),Vt=(r=>(r.TextUpdated="text_updated",r.CursorSelectionUpdated="cursor_selection_updated",r))(Vt||{});class ha extends _s{constructor(e){super();p(this,"func");this.func=e}async run(){await this.func()}async destroy(){}}class Gs extends ha{}class ua{static wait(t){return new Promise(e=>{setTimeout(()=>{e()},t)})}}class Wt{constructor(){p(this,"running");p(this,"queue");p(this,"stopped");this.running=!1,this.queue=[],this.stopped=!1}async add(t){this.stopped||(this.queue.push(t),this.running||(this.running=!0,await this.run()))}async run(){if(this.stopped)return;if(this.queue.length===0){this.running=!1;return}let t=this.queue.shift();if(t)try{await t.run()}catch{}finally{t.destroy&&await t.destroy(),t=null}this.queue.length>0?requestAnimationFrame(()=>{this.run()}):this.running=!1}async wait(){for(;this.running;)await ua.wait(10)}async destroy(){await this.wait(),this.stopped=!0,this.queue=null,this.running=!1}}class fa extends Wt{}class wi{constructor(){p(this,"undoStack",[]);p(this,"redoStack",[]);p(this,"renderQueue",new Wt)}get tailUndoCommand(){return this.undoStack[this.undoStack.length-1]}get tailRedoCommand(){return this.redoStack[this.redoStack.length-1]}add(t){this.undoStack.push(t),this.redoStack=[]}clear(){this.undoStack=[],this.redoStack=[]}async undo(){let t=!1;return await new Promise(e=>{this.renderQueue.add(new Gs(async()=>{if(this.undoStack.length!==0){const s=this.undoStack.pop();this.redoStack.push(s),await s.undo(),t=!0}else t=!1;e()}))}),t}async redo(){let t=!1;return await new Promise(e=>{this.renderQueue.add(new Gs(async()=>{if(this.redoStack.length!==0){const s=this.redoStack.pop();this.undoStack.push(s),await s.redo(),t=!0}else t=!1;e()}))}),t}pop(t){return t?this.redoStack.pop():this.undoStack.pop()}}class ga{constructor(t,e,s,n){p(this,"payload");p(this,"element");p(this,"id");p(this,"relationId");this.payload=e,this.element=s,this.id=t,this.relationId=n}async undo(){throw new Error("Method not implemented.")}async redo(){throw new Error("Method not implemented.")}}class ks extends ga{async _batchUpdateElementFromDatas(t,e){const{textData:s,textCursor:n,textSelection:i}=t;e===Vt.TextUpdated&&(this.element.model.data=s),this.element.updateTextCursors(n,i)}async undo(){const{uData:t,type:e}=this.payload;t&&await this._batchUpdateElementFromDatas(t,e)}async redo(){const{rData:t,type:e}=this.payload;t&&await this._batchUpdateElementFromDatas(t,e)}}class Ke extends an{constructor(e,s){super(e,s);p(this,"_textCursor");p(this,"_textSelection");p(this,"_cursorVisibleStatus");p(this,"_cursorVisibleTimer");p(this,"_prevMarkCursor");p(this,"_prevInputCursor");p(this,"_textUpdateId");p(this,"_prevTextLinesReflowed",!1);p(this,"_undoCommandObject");p(this,"_editorOperation",ae.NONE);p(this,"_selectionMoveId");p(this,"_isSelectionMoved",!1);p(this,"_fontStyler");p(this,"_fontSize");p(this,"_fontFamily");p(this,"_fontColor");p(this,"_fontColorOpacity");p(this,"_fontLetterSpacing");p(this,"_fontStylerMixin",!1);p(this,"_fontSizeMixin",!1);p(this,"_fontFamilyMixin",!1);p(this,"_fontColorMixin",!1);p(this,"_fontColorOpacityMixin",!1);p(this,"_fontLetterSpacingMixin",!1);p(this,"_textDecoration",Pe.none);p(this,"_textDecorationMixin",!1);p(this,"_textDecorationColor");p(this,"_textDecorationOpacity");p(this,"_textDecorationThickness");p(this,"_textDecorationColorMixin",!1);p(this,"_textDecorationOpacityMixin",!1);p(this,"_textDecorationThicknessMixin",!1);this.undoRedo=new wi}get fontEnable(){return!0}get fontInputEnable(){return!0}get fontLineHeightInputEnable(){return this.status===ie.finished}get fontLineHeightFactorInputEnable(){return!0}get fontLetterSpacingInputEnable(){return!0}get paragraphSpacingInputEnable(){return!0}get textCaseInputEnable(){return!0}get textAlignInputEnable(){return!0}get textVerticalAlignInputEnable(){return!0}get editingEnable(){return!0}get textCursor(){return this._textCursor}get textSelection(){return this._textSelection}get isSelectionAvailable(){return I.isTextSelectionAvailable(this._textSelection)}get isCursorVisible(){return!!this._textCursor&&!this.isSelectionAvailable&&this._cursorVisibleStatus}get transformersEnable(){return this.status===ie.finished}get cornersInputEnable(){return this.status===ie.finished}get cornersEnable(){return this.status===ie.finished}get text(){return I.getTextFromTextData(this.model.data)}get fontStyler(){return this._fontStyler}get fontSize(){return this._fontSize}get fontFamily(){return this._fontFamily}get fontColor(){return this._fontColor}get fontColorOpacity(){return this._fontColorOpacity}get fontLetterSpacing(){return this._fontLetterSpacing}get fontStylerMixin(){return this._fontStylerMixin}get fontSizeMixin(){return this._fontSizeMixin}get fontFamilyMixin(){return this._fontFamilyMixin}get fontColorMixin(){return this._fontColorMixin}get fontColorOpacityMixin(){return this._fontColorOpacityMixin}get fontLetterSpacingMixin(){return this._fontLetterSpacingMixin}get textHeight(){return this._calcTextRenderHeight()}get textDecoration(){return this._textDecoration}get textDecorationMixin(){return this._textDecorationMixin}get textDecorationColor(){return this._textDecorationColor}get textDecorationOpacity(){return this._textDecorationOpacity}get textDecorationThickness(){return this._textDecorationThickness}get textDecorationColorMixin(){return this._textDecorationColorMixin}get textDecorationOpacityMixin(){return this._textDecorationOpacityMixin}get textDecorationThicknessMixin(){return this._textDecorationThicknessMixin}get paragraphSize(){return this.model.data.lines.filter(e=>e.isTailBreak).length}get alignCoords(){return L.getBoxByPoints([...super.alignCoords,...this._getTextRotateRenderCoords()])}get alignOutlineCoords(){return[L.getBoxByPoints([...super.alignOutlineCoords.flat(),...this._getTextRotateRenderCoords()])]}_setIsEditing(e){super._setIsEditing(e),this._textCursor=null,this._textSelection=null,this._cursorVisibleStatus=!1,this._undoCommandObject=null,this._editorOperation=ae.NONE,this._textUpdateId=null,this._prevInputCursor=null,this._prevTextLinesReflowed=!1,this._selectionMoveId=null,this._isSelectionMoved=!1,this._toggleCursorVisibleTimer(e),e?this._selectAll():this.undoRedo.clear(),this._markSelection(),this._checkFontStyleChangedByCursor()}_setIsSelected(e){super._setIsSelected(e),e&&this._updateFontStyleByTextData(!1,!1,!0)}_toggleCursorVisibleTimer(e){e?this._startCursorVisibleTimer():this._clearCursorVisibleTimer()}_startCursorVisibleTimer(){this._cursorVisibleTimer||(this._cursorVisibleTimer=setInterval(()=>{this._cursorVisibleStatus=!this._cursorVisibleStatus},400))}_clearCursorVisibleTimer(){this._cursorVisibleTimer&&(clearInterval(this._cursorVisibleTimer),this._cursorVisibleTimer=null)}_updateCursor(e){if(!e)return;const s=I.getUpdatedCursorProps(this.model.data,e);s&&Object.assign(e,s)}onStageChanged(){super.onStageChanged(),this.refreshTextCursors()}onFontFamilyChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onFontFamilyChanged()}onFontStylerChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onFontStylerChanged()}onFontSizeChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onFontSizeChanged()}onFontColorChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onFontColorChanged()}onFontColorOpacityChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onFontColorOpacityChanged()}onTextDecorationChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onTextDecorationChanged()}onTextDecorationColorChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onTextDecorationColorChanged()}onTextDecorationOpacityChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onTextDecorationOpacityChanged()}onTextDecorationThicknessChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onTextDecorationThicknessChanged()}refreshTextCursorAtPosition(e,s){var a;this._isSelectionMoved=s||!1,s||(this._undoCommandObject=this._getTextEditorCommandObject({dataExclude:!0}),this._selectionMoveId=null);const n=Oe.calcElementRenderRect(this),i=Oe.convertCoordInRect(e,this,n),o=I.getTextCursorAtPosition(this.model.data,i,this.textAlign);o&&(s?(I.isCursorAtSamePosition(this._textSelection.startCursor,o,this.model.data)?this._textSelection.endCursor=null:this._textSelection.endCursor=o,this._cursorVisibleStatus=!1,this._editorOperation=ae.MOVE_SELECTION,this._selectionMoveId||(this._selectionMoveId=L.getRandomId(),this._undoCommandObject=this._getTextEditorCommandObject({dataExclude:!0}))):(this._textCursor=o,this._textSelection={startCursor:o,endCursor:null},this._editorOperation=ae.MOVE_CURSOR),this._cursorVisibleStatus=!0,this._clearCursorVisibleTimer(),this._startCursorVisibleTimer(),this._prevMarkCursor=((a=this._textSelection)==null?void 0:a.endCursor)||this._textCursor),this._markSelection(),this._checkFontStyleChangedByCursor(),this._prevInputCursor=null,this._addCursorUpdateCommand()}refreshTextCursors(){var e;this.isEditing&&(this._updateCursor(this._textCursor),this._updateCursor((e=this._textSelection)==null?void 0:e.endCursor))}updateTextCursors(e,s){this._textCursor=e,this._textSelection=s}async updateText(e,s){if(this._isSelectionMoved)return;const n=V.jsonClone(this.model.data),{keyCode:i,ctrlKey:o,shiftKey:a,metaKey:l,altKey:c,updateId:d}=s;let u=!1,f=!1,g=!1;if(ce.isArrowLeft(i))this._moveCursorTo(j.LEFT,s);else if(ce.isArrowRight(i))this._moveCursorTo(j.RIGHT,s);else if(ce.isArrowUp(i))this._moveCursorTo(j.TOP,s);else if(ce.isArrowDown(i))this._moveCursorTo(j.BOTTOM,s);else if(ce.isA(i)&&o)this._selectAll();else if(ce.isC(i)&&o)this._copySelection(n);else{if(f=!0,ce.isDeleterKey(i))u=this._deleteAtCursor(n,!0);else if(ce.isEnter(i))u=this._insertNewLine(n);else if(ce.isX(i)&&o)u=this._cutSelection(n);else if(ce.isV(i)&&o)u=this._pasteText(e,n,s);else if(ce.isZ(i)&&o){const C=this.undoRedo.tailUndoCommand;if(C){const{relationId:y}=C;y&&await this.emitUndo(),await this.undo(),this._editorOperation=ae.UNDO,[ae.MOVE_CURSOR,ae.MOVE_SELECTION].includes(C.payload.operation)||(f=!0)}}else if(ce.isY(i)&&o){const C=this.undoRedo.tailRedoCommand;if(C){const{relationId:y}=C;y&&await this.emitRedo(),await this.redo(),this._editorOperation=ae.REDO,[ae.MOVE_CURSOR,ae.MOVE_SELECTION].includes(C.payload.operation)||(f=!0)}}else!l&&!c&&!o?(u=this._updateInput(n,e,s),u&&(this._editorOperation=ae.INPUT)):(f=!1,g=!0);u&&(this.model.data=n)}return g||(this._markSelection(),this._checkFontStyleChangedByCursor()),this._textUpdateId=d,{changed:u,reflow:f}}_insertNewLine(e){this._undoCommandObject=this._getTextEditorCommandObject(),this.isSelectionAvailable&&this._deleteAtCursor(e);const{lineNumber:s,nodeId:n,pos:i}=this._textCursor,o=s+1,a=e.lines[s],{isTailBreak:l}=a;let c=0;if(n&&(c=a.nodes.findIndex(d=>d.id===n),i===j.RIGHT&&c++),c<=a.nodes.length-1){const d=a.nodes[c],u=I.getStyleByNodeIfy(this.model,d,a),f=a.nodes.slice(c);Object.assign(a,{nodes:a.nodes.slice(0,c),isTailBreak:!0}),l?e.lines.splice(o,0,{nodes:f,isTailBreak:!0,fontStyle:u}):e.lines[o].nodes.splice(0,0,...f)}else e.lines.splice(o,0,{nodes:[],isTailBreak:!0,fontStyle:I.getStyleOfLineEnd(this.model,a)});return this._textCursor=I.getCursorOfLineStart(e.lines[o],o),this._textSelection={startCursor:this._textCursor,endCursor:null},this._prevMarkCursor=this._textCursor,this._prevInputCursor=null,this._editorOperation=ae.INSERT_NEWLINE,!0}_pasteText(e,s,n){if(e.length===0)return!1;this._undoCommandObject=this._getTextEditorCommandObject(),this.isSelectionAvailable&&this._deleteAtCursor(s),this._prevInputCursor=this._textCursor;const i=I.parseTextLines(e);if(i&&i.length>0)this._insertTextLines(s,i);else if(!Vs.isMultiLine(e))this._insertText(s,e,n);else{const o=this._getFontStyleAtInputCursor(),a=I.createTextLines(e,o);this._insertTextLines(s,a)}return this._editorOperation=ae.PASTE_TEXT,!0}_doSelectionCopy(e){const s=I.pickSelectedContent(e);js.copyValueToClipboard(JSON.stringify(s))}_copySelection(e){this.isSelectionAvailable&&(this._doSelectionCopy(e),this._editorOperation=ae.COPY_SELECTION)}_cutSelection(e){return this.isSelectionAvailable?(this._undoCommandObject=this._getTextEditorCommandObject(),this._doSelectionCopy(e),this._deleteAtCursor(e),this._editorOperation=ae.CUT_SELECTION,!0):!1}_updateInput(e,s,n){this._prevInputCursor||(this._undoCommandObject=this._getTextEditorCommandObject()),this.isSelectionAvailable&&this._deleteAtCursor(e);const{updateId:i,compositionType:o}=n;return(!this._prevInputCursor||o===Qs.END||this._textUpdateId!==i)&&(this._prevInputCursor=this._textCursor),this._textUpdateId===i&&(this._textCursor=this._prevInputCursor,this._deleteNodesByUpdateId(e,i)),this._insertText(e,s,n),this._prevMarkCursor=this._textCursor,!0}_deleteNodesByUpdateId(e,s){e.lines=e.lines.map(n=>(n.nodes.length>0&&(n.nodes=n.nodes.filter(o=>o.updateId!==s)),n))}_insertTextLines(e,s){if(s.length===0)return;let{textNode:n,lineNumber:i,isHead:o}=I.getAnchorNodeByCursor(e,this._prevInputCursor);const a=e.lines[i];let l=0;o||(l=a.nodes.findIndex(g=>g.id===n.id),l=l+1);let c=[];c=a.nodes.slice(l),c=I.batchCloneTextNodes(c),a.nodes=a.nodes.slice(0,l);const d=s[0],u=d.isFull,f=s[s.length-1].isFull;if(a.nodes.length===0?(e.lines.splice(i,1,d),d.isTailBreak=!0):u?(i++,e.lines.splice(i,0,d)):a.nodes.push(...d.nodes),delete e.lines[i].isFull,this._textCursor=I.getCursorOfLineEnd(e.lines[i],i),i++,s.length>1){const g=s.slice(1,s.length);e.lines.splice(i,0,...g);for(const C of g)delete C.isFull;i+=g.length,this._textCursor=I.getCursorOfLineEnd(e.lines[i-1],i-1)}c.length>0&&(f?e.lines.splice(i,0,{nodes:c,isTailBreak:!0}):e.lines[i-1].nodes.push(...c))}_getFontStyleAtInputCursor(){const{textNode:e,lineNumber:s}=I.getAnchorNodeByCursor(this.model.data,this._prevInputCursor),n=this.model.data.lines[s];return I.getStyleByNodeIfy(this.model,e,n)}_insertText(e,s,n){if(R.isEmpty(s))return;const{textNode:i,lineNumber:o,isHead:a}=I.getAnchorNodeByCursor(e,this._prevInputCursor),l=this._getFontStyleAtInputCursor(),c=s.split("").map(u=>{const f=I.createTextNode(u,l);return n&&n.updateId&&(f.updateId=n.updateId),f});let d=0;a||(d=e.lines[o].nodes.findIndex(u=>u.id===i.id),d=d+1),e.lines[o].nodes.splice(d,0,...c),this._textCursor=I.getCursorOfNode(c[c.length-1],j.RIGHT,o)}_selectAll(){this._undoCommandObject=this._getTextEditorCommandObject({dataExclude:!0});const e=this.model.data,s=I.getCursorOfLineHead(e.lines[0],0),n=I.getCursorOfLineEnd(e.lines[e.lines.length-1],e.lines.length-1);this._textSelection={startCursor:s,endCursor:n},this._textCursor=s,this._editorOperation=ae.SELECT_ALL,this._addCursorUpdateCommand()}_markSelection(){I.markTextUnselected(this.model.data),this.isSelectionAvailable&&I.markTextSelected(this.model.data,this._textSelection)}_checkFontStyleChangedByCursor(){let e;this.isSelectionAvailable?e=I.getStyleSetOfTextData(this.model.data,!0):this._textCursor&&(e=I.getStyleSetByCursor(this._textCursor,this.model.data)),e&&this._checkFontStyleChanged(e)}_updateFontStyleByTextData(e,s=!0,n){const i=I.getStyleSetOfTextData(this.model.data,e);this._checkFontStyleChanged(i,s,n)}_checkFontStyleChanged(e,s=!0,n){const i=nt=>nt.size>1,{fontStylers:o,fontSizes:a,fontFamilies:l,fontColors:c,fontColorOpacities:d,fontLetterSpacings:u,textDecorations:f,textDecorationColors:g,textDecorationOpacities:C,textDecorationThicknesses:y}=e,E=i(o),b=i(a),F=i(l),N=i(c),w=i(d),v=i(u),P=i(f),D=i(g),M=i(C),J=i(y),K=E?null:o.values().next().value,ge=b?null:a.values().next().value,Ie=F?null:l.values().next().value,Ze=N?null:c.values().next().value,st=w?null:d.values().next().value,ht=v?null:u.values().next().value,Le=P?null:f.values().next().value,ut=D?null:g.values().next().value,et=M?null:C.values().next().value,ke=J?null:y.values().next().value;n&&(this._fontStylerMixin=E,this._fontSizeMixin=b,this._fontFamilyMixin=F,this._fontColorMixin=N,this._fontColorOpacityMixin=w,this._fontLetterSpacingMixin=v,this._textDecorationMixin=P,this._textDecorationColorMixin=D,this._textDecorationOpacityMixin=M,this._textDecorationThicknessMixin=J,this._fontStyler=K,this._fontSize=ge,this._fontFamily=Ie,this._fontColor=Ze,this._fontColorOpacity=st,this._fontLetterSpacing=ht,this._textDecoration=Le,this._textDecorationColor=ut,this._textDecorationOpacity=et,this._textDecorationThickness=ke),s&&(this.emitPropChanged(x.fontStylerChanged,[K]),this.emitPropChanged(x.fontSizeChanged,[ge]),this.emitPropChanged(x.fontFamilyChanged,[Ie]),this.emitPropChanged(x.fontColorChanged,[Ze]),this.emitPropChanged(x.fontColorOpacityChanged,[st]),this.emitPropChanged(x.fontLetterSpacingChanged,[ht]),this.emitPropChanged(x.fontStylerMixinChanged,[E]),this.emitPropChanged(x.fontSizeMixinChanged,[b]),this.emitPropChanged(x.fontFamilyMixinChanged,[F]),this.emitPropChanged(x.fontColorMixinChanged,[N]),this.emitPropChanged(x.fontColorOpacityMixinChanged,[w]),this.emitPropChanged(x.fontLetterSpacingMixinChanged,[v]),this.emitPropChanged(x.textDecorationChanged,[Le]),this.emitPropChanged(x.textDecorationColorChanged,[ut]),this.emitPropChanged(x.textDecorationOpacityChanged,[et]),this.emitPropChanged(x.textDecorationThicknessChanged,[ke]),this.emitPropChanged(x.textDecorationMixinChanged,[P]),this.emitPropChanged(x.textDecorationColorMixinChanged,[D]),this.emitPropChanged(x.textDecorationOpacityMixinChanged,[M]),this.emitPropChanged(x.textDecorationThicknessMixinChanged,[J]))}_moveCursorTo(e,s){var E;if(!this._textCursor)return;this._undoCommandObject=this._getTextEditorCommandObject({dataExclude:!0});const n=this.model.data,{shiftKey:i}=s;let o=this._textCursor;if(this.isSelectionAvailable){if(!i){const[b,F]=I.sortCursors(n,[this._textSelection.startCursor,this._textSelection.endCursor]);switch(e){case j.LEFT:case j.TOP:this._textCursor=b;break;case j.RIGHT:case j.BOTTOM:this._textCursor=F;break}this._textSelection=null,I.markTextUnselected(n),this._editorOperation=ae.MOVE_CURSOR;return}o=this._textSelection.endCursor}let{nodeId:a,lineNumber:l,pos:c}=o;const d=n.lines[l],u=l-1,f=l+1,g=n.lines[u],C=n.lines[f];let y;if(e===j.TOP)l===0?y=I.getCursorOfLineStart(d,l):u>=0&&(y=I.getClosestNodeCursorOfLine(g,this._prevMarkCursor,u));else if(e===j.BOTTOM)l===n.lines.length-1?y=I.getCursorOfLineEnd(d,l):f<n.lines.length&&(y=I.getClosestNodeCursorOfLine(C,this._prevMarkCursor,f));else if(d.nodes.length){let b=-1;switch(a?b=d.nodes.findIndex(F=>F.id===a):(b=0,c=j.LEFT),e){case j.LEFT:c===j.RIGHT?y=I.getCursorOfNode(d.nodes[b],j.LEFT,l):b>0?y=I.getCursorOfNode(d.nodes[b-1],j.LEFT,l):u>=0&&(g.isTailBreak||g.nodes.length===0?y=I.getCursorOfLineEnd(g,u):y=I.getCursorOfNode(g.nodes[g.nodes.length-1],j.LEFT,u));break;case j.RIGHT:(b===d.nodes.length-1||b===d.nodes.length-2&&c===j.RIGHT)&&!d.isTailBreak?y=I.getCursorOfLineStart(C,f):c===j.LEFT?y=I.getCursorOfNode(d.nodes[b],j.RIGHT,l):b<d.nodes.length-1?y=I.getCursorOfNode(d.nodes[b+1],j.RIGHT,l):f<=n.lines.length-1&&(y=I.getCursorOfLineStart(C,f));break}}else switch(e){case j.LEFT:u>=0&&(y=I.getCursorOfLineEnd(g,u));break;case j.RIGHT:f<=n.lines.length-1&&(y=I.getCursorOfLineStart(C,f));break}y&&(i?(this._textSelection={startCursor:this._textCursor,endCursor:y},this._editorOperation=ae.MOVE_SELECTION):(this._textCursor=y,this._textSelection=null,this._editorOperation=ae.MOVE_CURSOR),[j.TOP,j.BOTTOM].includes(e)||(this._prevMarkCursor=((E=this._textSelection)==null?void 0:E.endCursor)||this._textCursor)),this._prevInputCursor=null,this._addCursorUpdateCommand()}_getTextEditorCommandObject(e){return{textData:e!=null&&e.dataExclude?null:V.jsonClone(this.model.data),textCursor:V.jsonClone(this._textCursor),textSelection:V.jsonClone(this._textSelection)}}_deleteAtCursor(e,s){s&&(this._undoCommandObject=this._getTextEditorCommandObject());let n=!0;if(this.isSelectionAvailable){const[i,o]=I.sortCursors(e,[this._textSelection.startCursor,this._textSelection.endCursor]),{nodeId:a,lineNumber:l,pos:c}=i;let d=i;const u=e.lines[l],f=u.nodes.findIndex(y=>y.id===a);c===j.LEFT&&(f===0?d=I.getCursorOfLineHead(u,l):d=I.getCursorOfNode(u.nodes[f-1],j.RIGHT,l)),this._textCursor=d;let{lineNumber:g}=o;const C=g-l-1;C>0?(e.lines.splice(l+1,C),g-=C,I.margeNodesOfLine(e,l,g)):l===g?I.deleteSelectedNodesOfLine(e.lines[l]):I.margeNodesOfLine(e,l,g),this._editorOperation=ae.DELETE_SELECTION}else{const{nodeId:i,lineNumber:o,pos:a}=this._textCursor,l=o-1;if(i){const c=e.lines[o],d=c.nodes.findIndex(u=>u.id===i);if(a===j.LEFT)if(d===0)if(o!==0){const u=e.lines[l],f=u.nodes.length;if(u.nodes.push(...c.nodes),e.lines.splice(o,1),f>0){const g=u.nodes[f-1];this._textCursor=I.getCursorOfNode(g,j.RIGHT,l)}else this._textCursor=I.getCursorOfLineStart(u,l)}else n=!1,this._undoCommandObject=null;else c.nodes.splice(d-1,1),this._textCursor=I.getCursorOfNode(c.nodes[d-1],j.LEFT,o);else c.nodes.splice(d,1),d===0?this._textCursor=I.getCursorOfLineStart(c,o):this._textCursor=I.getCursorOfNode(c.nodes[d-1],j.RIGHT,o)}else e.lines.length===1?(e.lines[0].nodes=[],this._textCursor=I.getCursorOfLineStart(e.lines[0],0)):(e.lines.splice(this._textCursor.lineNumber,1),o!==0&&(this._textCursor=I.getCursorOfLineEnd(e.lines[l],l)));n&&(this._editorOperation=ae.DELETE_PREV)}return this._textSelection={startCursor:this._textCursor,endCursor:null},this._prevMarkCursor=this._textCursor,this._prevInputCursor=null,n}reflowText(e){return this._prevTextLinesReflowed=this._doReflowTextLines(!this._prevTextLinesReflowed||e),this._prevTextLinesReflowed}_doReflowTextLines(e=!1){const s=this.model.data,n=re.stageParams.scale,i=I.restoreTextLines(s.lines),a=I.calcMaxLineWidth(i,n)>=this.width||e;if(a){const l=I.calcReflowTextLines(i,this.width,n);s.lines=l}return a}_calcTextRenderWidth(){return Math.ceil(I.calcMaxLineWidth(this.model.data.lines,re.stageParams.scale))}_calcTextRenderHeight(){return Math.ceil(I.calcTextRenderHeight(this.model.data.lines,re.stageParams.scale))}refreshTextSizeCoords(){const e=this._calcTextRenderWidth(),s=this._calcTextRenderHeight();this.model.width=e,this.model.height=s,this.model.coords=L.getBoxByLeftTop(this.model.coords[0],{width:e,height:s}),this.model.boxCoords=L.getBoxByLeftTop(this.model.boxCoords[0],{width:e,height:s})}onTransforming(){super.onTransforming(),this.reflowText()}onEditorPressChange(e){switch(e){case Ct.PRESS_UP:{this._selectionMoveId=null,this._isSelectionMoved=!1;break}}}setFontFamily(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setFontFamily(e),s.lines.forEach(i=>{(i.selected||!n)&&(i.fontStyle=Object.assign({},i.fontStyle||{},{fontFamily:e})),i.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.fontFamily=e)})})}setFontStyler(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setFontStyler(e),s.lines.forEach(i=>{(i.selected||!n)&&(i.fontStyle=Object.assign({},i.fontStyle||{},{fontStyler:e})),i.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.fontStyler=e)})})}setFontSize(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setFontSize(e),s.lines.forEach(i=>{(i.selected||!n)&&(i.fontStyle=Object.assign({},i.fontStyle||{},{fontSize:e})),i.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.fontSize=e)})})}setFontColor(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setFontColor(e),s.lines.forEach(i=>{(i.selected||!n)&&(i.fontStyle=Object.assign({},i.fontStyle||{},{fontColor:e})),i.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.fontColor=e)})})}setFontColorOpacity(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setFontColorOpacity(e),s.lines.forEach(i=>{(i.selected||!n)&&(i.fontStyle=Object.assign({},i.fontStyle||{},{fontColorOpacity:e})),i.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.fontColorOpacity=e)})})}setFontLetterSpacing(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setFontLetterSpacing(e),s.lines.forEach(i=>{(i.selected||!n)&&(i.fontStyle=Object.assign({},i.fontStyle||{},{fontLetterSpacing:e})),i.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.fontLetterSpacing=e)})})}setTextDecoration(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setTextDecoration(e),s.lines.forEach(i=>{(i.selected||!n)&&(i.fontStyle=Object.assign({},i.fontStyle||{},{textDecoration:e})),i.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.textDecoration=e)})})}setTextDecorationColor(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setTextDecorationColor(e),s.lines.forEach(i=>{(i.selected||!n)&&(i.fontStyle=Object.assign({},i.fontStyle||{},{textDecorationColor:e})),i.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.textDecorationColor=e)})})}setTextDecorationOpacity(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setTextDecorationOpacity(e),s.lines.forEach(i=>{(i.selected||!n)&&(i.fontStyle=Object.assign({},i.fontStyle||{},{textDecorationOpacity:e})),i.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.textDecorationOpacity=e)})})}setTextDecorationThickness(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setTextDecorationThickness(e),s.lines.forEach(i=>{(i.selected||!n)&&(i.fontStyle=Object.assign({},i.fontStyle||{},{textDecorationThickness:e})),i.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.textDecorationThickness=e)})})}refreshOriginalElementProps(){super.refreshOriginalElementProps(),this._originalData=V.jsonClone(this.model.data)}async toOriginalTransformJson(){const e=await super.toOriginalTransformJson();return e.data=this._originalData,e}async toTransformJson(){const e=await super.toTransformJson();return e.data=V.jsonClone(this.model.data),e}async toFontStyleJson(){const e=await super.toFontStyleJson();return e.data=V.jsonClone(this.model.data),e}onTextReflowed(e){e&&this._addUpdateCommand()}_addUpdateCommand(){let e=!1;const s=this.undoRedo.tailUndoCommand;if(s){const{payload:{operation:n}}=s;e=this._editorOperation===ae.DELETE_PREV&&n===ae.DELETE_PREV||this._editorOperation===ae.INPUT&&n===ae.INPUT}if(e)s.payload.rData=this._getTextEditorCommandObject();else{const n=new ks(L.getRandomId(),{type:Vt.TextUpdated,operation:this._editorOperation,updateId:this._textUpdateId,uData:this._undoCommandObject,rData:this._getTextEditorCommandObject()},this);this.undoRedo.add(n)}}_addCursorUpdateCommand(){let e=!1;const s=this.undoRedo.tailUndoCommand;if(s){const{payload:{operation:n,uData:{textCursor:i,textSelection:o}}}=s;e=this._editorOperation===ae.MOVE_CURSOR&&n===ae.MOVE_CURSOR&&I.isCursorAtSamePosition(this._textCursor,i,this.model.data)||this._editorOperation===ae.MOVE_SELECTION&&n===ae.MOVE_SELECTION&&I.isSelectionEqualWithStart(this._textSelection,o,this.model.data)}if(e)s.payload.rData=this._getTextEditorCommandObject({dataExclude:!0});else{const n=new ks(L.getRandomId(),{type:Vt.CursorSelectionUpdated,operation:this._editorOperation,updateId:this._textUpdateId,uData:this._undoCommandObject,rData:this._getTextEditorCommandObject({dataExclude:!0})},this);this.undoRedo.add(n)}}_isTextNodesContainsCoord(e){const s=this.model.data;if(s.lines.length===0)return!1;const n=Oe.convertCoordInRect(e,this,Oe.calcElementRenderRect(this));return s.lines.some(i=>i.nodes.some(o=>!ce.isSpace(o.content)&&L.isPointInRect(o,n)))}_isTextContainsCoord(e){const s=this._getTextRotateRenderCoords();return h.isPointInPolygonByRayCasting(e,s)}_getTextRenderCoords(){const e=this._calcTextRenderHeight();return this._getTextCoordsByHeight(e)}_getTextCoordsByHeight(e){let{x:s,y:n,width:i,height:o}=this.model;switch(s=s-i/2,n=n-o/2,this.textVerticalAlign){case"middle":n+=(o-e)/2;break;case"bottom":n+=o-e;break}return L.getBoxByLeftTop({x:s,y:n},{width:i,height:e})}_getTextRotateRenderCoords(){const e=this._getTextRenderCoords();return h.batchTransWithCenter(e,this.angles,this.centerCoord)}_isTextPolygnOverlap(e){const s=this._getTextRotateRenderCoords();return h.isPolygonsOverlap(s,e)}isContainsCoord(e){return this.isSelected||this.strokeEffective?super.isContainsCoord(e)||this._isTextContainsCoord(e)||this._isTextNodesContainsCoord(e):this._isTextNodesContainsCoord(e)}isPolygonOverlap(e){return this.isSelected||this.strokeEffective?super.isPolygonOverlap(e)||this._isTextPolygnOverlap(e):this._isTextPolygnOverlap(e)}isModelPolygonOverlap(e){return super.isModelPolygonOverlap(e)||h.isPolygonsOverlap(this._getTextRotateRenderCoords(),e)}refreshUndoCommandObject(){this._undoCommandObject=this._getTextEditorCommandObject()}relationUndoCommand(e){const s=new ks(L.getRandomId(),{type:Vt.CursorSelectionUpdated,operation:this._editorOperation,updateId:this._textUpdateId,uData:this._undoCommandObject},this,e);this.undoRedo.add(s)}}class ma extends Xe{async run(){if(!this.canvas||!this.element)return;const{innermostStrokeCoordIndex:t,unLeanStrokeCoords:e,model:{styles:s,styles:{strokes:n}},center:i,angle:o,flipX:a,leanY:l,actualAngle:c,shield:d}=this.element,u={angle:o,flipX:a,leanY:l,actualAngle:c},f=k.batchCalcStageRelativePoints(e),g=f[t],C=Oe.calcRenderRect(g,i,re.stageParams.scale);s.fills.forEach(y=>{G.drawEllipseFillWithScale(this.canvas,i,{rx:C.width/2/re.stageParams.scale,ry:C.height/2/re.stageParams.scale},y,C,u)}),f.forEach((y,E)=>{const b=Oe.calcRenderRect(y,i,re.stageParams.scale);G.drawEllipseStrokeWithScale(this.canvas,i,{rx:b.width/2/re.stageParams.scale,ry:b.height/2/re.stageParams.scale},n[E],b,u)})}}class pa extends vt{get editingEnable(){return!1}}class zt{static createImageFromImageData(t){const e=G.getCanvasByImageData(t),s=new Image;return s.src=e.toDataURL(),s}static waitForImageLoad(t){return new Promise((e,s)=>{t.onload=()=>{e(t)},t.onerror=()=>{s(new Error("Image load failed"))}})}static async createImageFromUrl(t){const e=new Image;return e.src=t,await this.waitForImageLoad(e),e}static async convertImages(t){return Promise.all(t.map(async e=>{if(e instanceof ImageData){const s=e.colorSpace;e=zt.createImageFromImageData(e),e.colorSpace=s,await zt.waitForImageLoad(e)}return e}))}}class Ca extends Xe{async run(){if(!this.canvas||!this.element)return;Es.drawArcRect(this.element,this.canvas);const{model:{styles:t,data:e},angle:s,flipX:n,leanY:i,actualAngle:o,unLeanBoxCoords:a}=this.element,l={angle:s,flipX:n,leanY:i,actualAngle:o},c=k.calcStageRelativePoints(a),d=Oe.calcElementRenderRect(this.element);G.drawRotateTextWithScale(this.canvas,e,c,d,{...t},l)}}var me=(r=>(r.isSelected="isSelected",r.isDetachedSelected="isDetachedSelected",r.isVisible="isVisible",r.isLocked="isLocked",r.isEditing="isEditing",r.isMoving="isMoving",r.isTransforming="isTransforming",r.isRotating="isRotating",r.isRotatingTarget="isRotatingTarget",r.isDragging="isDragging",r.isProvisional="isProvisional",r.isTarget="isTarget",r.isInRange="isInRange",r.isOnStage="isOnStage",r.status="status",r.isRatioLocked="isRatioLocked",r))(me||{}),it=(r=>(r[r.added=0]="added",r[r.removed=1]="removed",r))(it||{});const ss=["id","coords","boxCoords","x","y","type"];class k{static createElementTask(t,e){let s;switch(t.model.type){case A.rectangle:s=new _o(t,e);break;case A.image:{s=new ca(t,e);break}case A.line:{s=new la(t,e);break}case A.ellipse:{s=new ma(t,e);break}case A.arbitrary:{s=new da(t,e);break}case A.text:{s=new Ca(t,e);break}}return s}static calcStageRelativePoints(t){return t.map(e=>k.calcStageRelativePoint(e))}static batchCalcStageRelativePoints(t){return t.map(e=>k.calcStageRelativePoints(e))}static calcStageRelativePoint(t){const{rect:{width:e,height:s},scale:n,worldCoord:{x:i,y:o}}=re.stageParams;return{x:t.x+e/2/n-i,y:t.y+s/2/n-o}}static calcWorldCoords(t){return t.map(e=>k.calcWorldCoord(e))}static calcWorldCoord(t){const{rect:{width:e,height:s},scale:n,worldCoord:{x:i,y:o}}=re.stageParams;return{x:t.x-e/2/n+i,y:t.y-s/2/n+o}}static calcCreatorPoints(t,e){switch(e){case A.rectangle:case A.image:case A.arbitrary:case A.text:case A.ellipse:case A.group:return L.getBoxByPoints(t);default:return t}}static createElement(t,e){const{type:s}=t;switch(s){case A.rectangle:return new an(t,e);case A.line:return new aa(t,e);case A.ellipse:return new pa(t,e);case A.image:return new Rn(t,e);case A.arbitrary:return new zs(t,e);case A.text:return new Ke(t,e);case A.group:return new ln(t,e);case A.image:return new Rn(t,e);default:return new vt(t,e)}}static getTopAElementByCoord(t,e){for(let s=t.length-1;s>=0;s--){const n=t[s];if(n.isContainsCoord(e))return n}}static calcElementRotatePoint(t){const{centerCoord:e,rotation:{angle:s,scale:n},model:{height:i}}=t;return h.calcTargetPoint(e,i/2+Ro*n,s)}static calcPosition(t){switch(t.type){case A.rectangle:case A.image:case A.line:case A.ellipse:case A.arbitrary:case A.text:case A.group:return h.calcCenter(t.coords)}}static calcSize(t){const{coords:e,boxCoords:s,type:n}=t;switch(n){case A.rectangle:case A.text:case A.group:case A.image:case A.ellipse:case A.arbitrary:return L.calcRectangleSize(s);case A.line:return{width:h.precise(h.calcDistance(e[0],e[1]),2),height:0}}}static fixAngle(t){return t>180&&(t=t-360),t}static calcOutlinePoints(t,e,s,n){if(s&&e!==pe.inside){let i=s/2;e===pe.outside&&(i=s);const{flipX:o,flipY:a}=n;return o!==a?Qe.getArbitraryInnerVertices(t,i,n):Qe.getArbitraryOuterVertices(t,i,n)}return t}static calcNoFoldArbitraryBorderRegions(t,e){const{width:s}=e,n=[];return t.forEach((i,o)=>{if(o<t.length-1){const a=t[o+1];if(n.push(Ue.calcBentLineOuterVertices([i,a],s/2)),o!==0){const l=t[o-1];n.push(k.calc3PArbitraryBorderRegions(l,i,a,e))}}}),n}static calcFoldArbitraryBorderRegions(t,e){const{width:s}=e,n=[];return t.forEach((i,o)=>{const a=L.getPrevOfArray(t,o),l=L.getNextOfArray(t,o);n.push(Ue.calcBentLineOuterVertices([i,l],s/2)),n.push(k.calc3PArbitraryBorderRegions(a,i,l,e))}),n}static calcArbitraryBorderRegions(t,e,s){return s?k.calcFoldArbitraryBorderRegions(t,e):k.calcNoFoldArbitraryBorderRegions(t,e)}static calc3PArbitraryBorderRegions(t,e,s,n){const{width:i}=n,o=h.isPointClockwiseOfLine(s,t,e),l=(180-h.calcTriangleAngle(t,e,s))/2,c=h.calcAngle(t,e),d=h.calcTriangleSide3By2(l,i/2),u=h.calcTargetPoint(e,d,c+(o?-l:l)),f=[];return f.push(e),f.push(h.calcTargetPoint(e,i/2,c-90)),f.push(u),f.push(h.calcTargetPoint(e,i/2,h.calcAngle(s,e)+90)),f}static calcCoordsByTransPoints(t,e,s){const n=h.calcCenter(t.map(o=>h.transWithCenter(o,e,s,!0))),i=h.transWithCenter(n,e,s);return t.map(o=>h.rotateWithCenter(o,-e.angle,i))}static calcCoordsByRotatePoints(t,e,s){let n=h.calcCenter(t.map(o=>h.rotateWithCenter(o,-e,s)));const i=h.rotateWithCenter(n,e,s);return t.map(o=>h.rotateWithCenter(o,-e,i))}static normalizeMatrixPoint(t,e,s,n){t=h.transWithCenter(t,n,s,!0);const[i,o]=h.multiply(e,[t.x-s.x,t.y-s.y,1]);return{x:i+s.x,y:o+s.y}}static calcMatrixPoint(t,e,s,n){const i=k.normalizeMatrixPoint(t,e,s,n);return h.transWithCenter(i,n,s)}static calcMatrixPoints(t,e,s,n){return t.map(i=>k.calcMatrixPoint(i,e,s,n))}static isSameAncestorGroup(t){return k.getAncestorGroup(t)!==null}static getAncestorGroup(t){if(t.length===0)return null;const e=k.getNonHomologousElements(t);return e.length>1?null:e[0]}static getNonHomologousElements(t){const e=new Set,s=new Set(t.map(n=>n.id));return t.forEach(n=>{if(!n.isGroupSubject)e.add(n.id);else{let i=!1;const o=n.ancestorGroups;for(let a=o.length-1;a>=0;a--){const l=o[a];if(l&&s.has(l.id)){e.add(l.id),i=!0;break}}i||e.add(n.id)}}),t.filter(n=>e.has(n.id))}static isDetachedElementAncestorUnNotSelected(t){return t.isDetachedSelected&&t.isGroupSubject&&!t.group.isSelected}static getAncestorIdsByDetachedElements(t){const e=new Set;return t.forEach(s=>{s.isDetachedSelected&&s.isGroupSubject&&s.ancestorGroups.forEach(n=>{e.has(n.id)||e.add(n.id)})}),Array.from(e)}static flatElementsWithDeepSubs(t){return t.map(e=>e.isGroup?[...e.deepSubs,e]:e).flat()}static createEmptyGroupObject(){return{...k.createEmptyObject(),type:A.group}}static createEmptyObject(){return{id:`${L.getRandomId()}`,subIds:[],coords:[],boxCoords:[],width:0,height:0,styles:{strokes:[]},x:0,y:0,...sn,...os}}static fixCornersBasedOnMinSize(t,e){return R.range(4).forEach(s=>{t[s]!==0&&(t[s]=R.clamp(t[s],0,e/2))}),t}static convertElementsJson(t){const e=t,s=new Map,n=[];return e.forEach(i=>{s.set(i.id,i),n.push(L.getRandomId())}),e.forEach((i,o)=>{k.reBindGroup(i,s,`${n[o]}`),k.divateCoords(i,40)}),e}static reBindGroup(t,e,s){const{subIds:n,groupId:i,id:o}=t;if(t.id=s,e.set(s,t),e.delete(o),n&&n.forEach(a=>{const l=e.get(a);l&&(l.groupId=s)}),i){const a=e.get(i);if(a){const l=a.subIds.indexOf(o);if(l===-1)return;a.subIds.splice(l,1,s)}}}static divateCoords(t,e){const{coords:s,boxCoords:n}=t;return t.x+=e,t.y+=e,t.coords=h.batchTranslate(s,{x:e,y:e}),t.boxCoords=h.batchTranslate(n,{x:e,y:e}),t}static async convertElementModel(t){const{type:e,data:s}=t;switch(e){case A.image:t.data=await zt.createImageFromUrl(s)}return t}static calcStageRelativeArcPoint(t){let{start:e,end:s,controller:n,corner:i,value:o}=t;return[e,s,n,i]=k.calcStageRelativePoints([e,s,n,i]),{start:e,end:s,controller:n,corner:i,value:o}}static calcStageRelativeArcPoints(t){return t.map(e=>k.calcStageRelativeArcPoint(e))}static batchCalcStageRelativeArcPoints(t){return t.map(e=>k.calcStageRelativeArcPoints(e))}static getElementOnPoint(t,e){for(let s=e.length-1;s>=0;s--){const n=e[s];if(n.isContainsCoord(t))return n}}static calcOuterLayerElements(t){const e=k.calcOuterLayerElementIds(t.map(s=>s.model));return t.filter(s=>e.has(s.model.id))}static calcOuterLayerElementIds(t){const e=new Map;t.forEach(n=>{e.set(n.id,n)});const s=new Set;return t.forEach(n=>{let{groupId:i,id:o}=n;if(i)if(e.has(i)){let a=e.get(i);for(;a.groupId;)if(i=a.groupId,e.has(i))a=e.get(i);else{s.add(a.id);break}}else s.add(o);else s.add(o)}),s}}var Qt={exports:{}},Fn;function ya(){if(Fn)return Qt.exports;Fn=1;var r=typeof Reflect=="object"?Reflect:null,t=r&&typeof r.apply=="function"?r.apply:function(v,P,D){return Function.prototype.apply.call(v,P,D)},e;r&&typeof r.ownKeys=="function"?e=r.ownKeys:Object.getOwnPropertySymbols?e=function(v){return Object.getOwnPropertyNames(v).concat(Object.getOwnPropertySymbols(v))}:e=function(v){return Object.getOwnPropertyNames(v)};function s(w){console&&console.warn&&console.warn(w)}var n=Number.isNaN||function(v){return v!==v};function i(){i.init.call(this)}Qt.exports=i,Qt.exports.once=b,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var o=10;function a(w){if(typeof w!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof w)}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(w){if(typeof w!="number"||w<0||n(w))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+w+".");o=w}}),i.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(v){if(typeof v!="number"||v<0||n(v))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+v+".");return this._maxListeners=v,this};function l(w){return w._maxListeners===void 0?i.defaultMaxListeners:w._maxListeners}i.prototype.getMaxListeners=function(){return l(this)},i.prototype.emit=function(v){for(var P=[],D=1;D<arguments.length;D++)P.push(arguments[D]);var M=v==="error",J=this._events;if(J!==void 0)M=M&&J.error===void 0;else if(!M)return!1;if(M){var K;if(P.length>0&&(K=P[0]),K instanceof Error)throw K;var ge=new Error("Unhandled error."+(K?" ("+K.message+")":""));throw ge.context=K,ge}var Ie=J[v];if(Ie===void 0)return!1;if(typeof Ie=="function")t(Ie,this,P);else for(var Ze=Ie.length,st=C(Ie,Ze),D=0;D<Ze;++D)t(st[D],this,P);return!0};function c(w,v,P,D){var M,J,K;if(a(P),J=w._events,J===void 0?(J=w._events=Object.create(null),w._eventsCount=0):(J.newListener!==void 0&&(w.emit("newListener",v,P.listener?P.listener:P),J=w._events),K=J[v]),K===void 0)K=J[v]=P,++w._eventsCount;else if(typeof K=="function"?K=J[v]=D?[P,K]:[K,P]:D?K.unshift(P):K.push(P),M=l(w),M>0&&K.length>M&&!K.warned){K.warned=!0;var ge=new Error("Possible EventEmitter memory leak detected. "+K.length+" "+String(v)+" listeners added. Use emitter.setMaxListeners() to increase limit");ge.name="MaxListenersExceededWarning",ge.emitter=w,ge.type=v,ge.count=K.length,s(ge)}return w}i.prototype.addListener=function(v,P){return c(this,v,P,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(v,P){return c(this,v,P,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(w,v,P){var D={fired:!1,wrapFn:void 0,target:w,type:v,listener:P},M=d.bind(D);return M.listener=P,D.wrapFn=M,M}i.prototype.once=function(v,P){return a(P),this.on(v,u(this,v,P)),this},i.prototype.prependOnceListener=function(v,P){return a(P),this.prependListener(v,u(this,v,P)),this},i.prototype.removeListener=function(v,P){var D,M,J,K,ge;if(a(P),M=this._events,M===void 0)return this;if(D=M[v],D===void 0)return this;if(D===P||D.listener===P)--this._eventsCount===0?this._events=Object.create(null):(delete M[v],M.removeListener&&this.emit("removeListener",v,D.listener||P));else if(typeof D!="function"){for(J=-1,K=D.length-1;K>=0;K--)if(D[K]===P||D[K].listener===P){ge=D[K].listener,J=K;break}if(J<0)return this;J===0?D.shift():y(D,J),D.length===1&&(M[v]=D[0]),M.removeListener!==void 0&&this.emit("removeListener",v,ge||P)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(v){var P,D,M;if(D=this._events,D===void 0)return this;if(D.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):D[v]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete D[v]),this;if(arguments.length===0){var J=Object.keys(D),K;for(M=0;M<J.length;++M)K=J[M],K!=="removeListener"&&this.removeAllListeners(K);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(P=D[v],typeof P=="function")this.removeListener(v,P);else if(P!==void 0)for(M=P.length-1;M>=0;M--)this.removeListener(v,P[M]);return this};function f(w,v,P){var D=w._events;if(D===void 0)return[];var M=D[v];return M===void 0?[]:typeof M=="function"?P?[M.listener||M]:[M]:P?E(M):C(M,M.length)}i.prototype.listeners=function(v){return f(this,v,!0)},i.prototype.rawListeners=function(v){return f(this,v,!1)},i.listenerCount=function(w,v){return typeof w.listenerCount=="function"?w.listenerCount(v):g.call(w,v)},i.prototype.listenerCount=g;function g(w){var v=this._events;if(v!==void 0){var P=v[w];if(typeof P=="function")return 1;if(P!==void 0)return P.length}return 0}i.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};function C(w,v){for(var P=new Array(v),D=0;D<v;++D)P[D]=w[D];return P}function y(w,v){for(;v+1<w.length;v++)w[v]=w[v+1];w.pop()}function E(w){for(var v=new Array(w.length),P=0;P<v.length;++P)v[P]=w[P].listener||w[P];return v}function b(w,v){return new Promise(function(P,D){function M(K){w.removeListener(v,J),D(K)}function J(){typeof w.removeListener=="function"&&w.removeListener("error",M),P([].slice.call(arguments))}N(w,v,J,{once:!0}),v!=="error"&&F(w,M,{once:!0})})}function F(w,v,P){typeof w.on=="function"&&N(w,"error",v,P)}function N(w,v,P,D){if(typeof w.on=="function")D.once?w.once(v,P):w.on(v,P);else if(typeof w.addEventListener=="function")w.addEventListener(v,function M(J){D.once&&w.removeEventListener(v,M),P(J)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof w)}return Qt.exports}var cn=ya();class _a extends cn.EventEmitter{constructor(e){super();p(this,"nodes");p(this,"_head");p(this,"_tail");p(this,"_eqFunc",(e,s)=>e===s);this.nodes=new Set,this._head=null,this._tail=null,this._eqFunc=e}get head(){return this._head}get tail(){return this._tail}get length(){return this.nodes.size}insert(e){this._tail?this.insertAfter(e,this._tail):(this._tail=e,this.nodes.add(e)),this._head||(this._head=e)}prepend(e){this._head?this.insertBefore(e,this._head):(this._head=e,this.nodes.add(e)),this._tail||(this._tail=e)}remove(e,s){this.nodes.delete(e);const n=e.prev,i=e.next;n&&(n.next=i),i&&(i.prev=n),e.prev=null,e.next=null,this._eqFunc(e,this._tail)&&(this._tail=n),this._eqFunc(e,this._head)&&(this._head=i)}removeBy(e,s){let n=[];return Array.from(this.nodes).forEach(i=>{e(i)&&(this.remove(i,s),n.push(i))}),n}insertBefore(e,s){s&&(s.insertBefore(e),this.nodes.add(e),e.isHead&&(this._head=e))}insertAfter(e,s){s&&(s.insertAfter(e),this.nodes.add(e),e.isTail&&(this._tail=e))}forEach(e){this.forEachBreak(e,()=>!1)}forEachBreak(e,s){let n=0,i=this._head;for(;i;){if(s&&s(i,n))return;e(i,n),i=i.next,n++}}forEachRevert(e){this.forEachBreakRevert(e,()=>!1)}forEachBreakRevert(e,s){let n=this.length-1,i=this._tail;for(;i;){if(s&&s(i,n))return;e(i,n),i=i.prev,n--}}getIndex(e){let s=-1,n=this._head;for(;n;){if(s++,this._eqFunc(n,e))return s;n=n.next}return s}filter(e){const s=[];return this.forEach(n=>{e(n)&&s.push(n)}),s}}const Bn=(r,t)=>r.value&&t.value&&r.value.id===t.value.id;class Dn extends _a{constructor(){super(Bn)}_addElementObserve(t){Object.keys(me).forEach(e=>{He(()=>t.value[e],()=>{this.emit(e,t.value,t.value[e])})})}insert(t,e=!0){ft(()=>{this._addElementObserve(t),super.insert(t),e&&this.emit(it.added,t)})}insertBefore(t,e,s=!0){ft(()=>{this._addElementObserve(t),super.insertBefore(t,e),s&&this.emit(it.added,t)})}insertAfter(t,e,s=!0){ft(()=>{this._addElementObserve(t),super.insertAfter(t,e),s&&this.emit(it.added,t)})}prepend(t,e=!0){ft(()=>{this._addElementObserve(t),super.prepend(t),e&&this.emit(it.added,t)})}remove(t,e=!0){ft(()=>{super.remove(t),e&&this.emit(it.removed,t)})}removeBy(t,e=!0){let s=[];return ft(()=>{s=super.removeBy(t,e)}),s}static isConsecutive(t){if(t.length<2)return!0;let e=t[0],s=1;for(;e.next&&Bn(e.next,t[s]);)if(e=e.next,s++,s===t.length)break;return s===t.length}}class Ea{constructor(t){p(this,"shield");p(this,"currentCreatingElementId");p(this,"_elementList",new Dn);p(this,"_elementsMap",new Map);p(this,"_elementSerialNumberMap",new Map([[A.group,0],[A.arbitrary,0],[A.rectangle,0],[A.text,0],[A.image,0],[A.line,0],[A.polygon,0],[A.ellipse,0],[A.pencil,0]]));p(this,"_provisionalElements",[]);p(this,"_selectedElements",[]);p(this,"_detachedSelectedElements",[]);p(this,"_targetElements",[]);p(this,"_rangeElements",[]);p(this,"_visibleElements",[]);p(this,"_stageElements",[]);p(this,"_editingElements",[]);p(this,"_rotatingTargetElements",[]);p(this,"_provisionalElementIds",le.set(new Set));p(this,"_selectedElementIds",le.set(new Set));p(this,"_detachedSelectedElementIds",le.set(new Set));p(this,"_targetElementIds",le.set(new Set));p(this,"_visibleElementIds",le.set(new Set));p(this,"_rangeElementIds",le.set(new Set));p(this,"_stageElementIds",le.set(new Set));p(this,"_editingElementIds",le.set(new Set));p(this,"_rotatingTargetElementIds",le.set(new Set));p(this,"_treeNodes",[]);p(this,"_treeNodesMap",new Map);p(this,"_rotatingCenter");p(this,"_rotatingCenterCoord");p(this,"_rotatingOriginalAngle");p(this,"_isMultiSelected",!1);p(this,"_nonHomologousElements",[]);p(this,"_selectedAncestorElement");p(this,"_primarySelectedElement");this.shield=t,this._reactionElementAdded(),this._reactionElementRemoved(),this._reactionElementsPropsChanged(),this._reactionElementsSelectionChanged(),this.throttleRefreshTreeNodes=R.throttle(this.throttleRefreshTreeNodes.bind(this),100,{leading:!1,trailing:!0})}get groupSerialNumber(){return this._elementSerialNumberMap.get(A.group)}get rectSerialNumber(){return this._elementSerialNumberMap.get(A.rectangle)}get textSerialNumber(){return this._elementSerialNumberMap.get(A.text)}get imageSerialNumber(){return this._elementSerialNumberMap.get(A.image)}get lineSerialNumber(){return this._elementSerialNumberMap.get(A.line)}get ellipseSerialNumber(){return this._elementSerialNumberMap.get(A.ellipse)}get polygonSerialNumber(){return this._elementSerialNumberMap.get(A.polygon)}get arbitrarySerialNumber(){return this._elementSerialNumberMap.get(A.arbitrary)}get pencilSerialNumber(){return this._elementSerialNumberMap.get(A.pencil)}get selectedElementIds(){return this._selectedElementIds}get creatingElements(){const t=this._elementsMap.get(this.currentCreatingElementId);return t?[t]:[]}get isProvisionalEmpty(){return this._provisionalElementIds.size===0}get provisionalElements(){return this._provisionalElements}get selectedElements(){return this._selectedElements}get detachedSelectedElements(){return this._detachedSelectedElements}get targetElements(){return this._targetElements}get stageElements(){return this._stageElements}get rangeElements(){return this._rangeElements}get visibleElements(){return this._visibleElements}get selectedAncestorElement(){return this._selectedAncestorElement}get primarySelectedElement(){return this._primarySelectedElement}get rotatingTargetElements(){return this._rotatingTargetElements}get editingElements(){return this._editingElements}get treeNodes(){return this._treeNodes}get isSelectedEmpty(){return this._selectedElementIds.size===0}get isVisibleEmpty(){return this._visibleElementIds.size===0}get isEmpty(){return this._elementList.length===0}get isEditingEmpty(){return this._editingElementIds.size===0}get isTargetEmpty(){return this._targetElementIds.size===0}get isRangeEmpty(){return this._rangeElementIds.size===0}get isStageEmpty(){return this._stageElementIds.size===0}get isRotatingTargetEmpty(){return this._rotatingTargetElementIds.size===0}get isEditingTextEmpty(){if(this.isEditingEmpty)return!0;for(let t of this._editingElementIds){const e=this._elementsMap.get(t);if(e&&e.model.type===A.text)return!1}return!0}get nonHomologousElements(){return this._nonHomologousElements}get isMultiSelected(){return this._isMultiSelected}_increaseElementSerialNumber(t){let e=this._elementSerialNumberMap.get(t);return e++,this._elementSerialNumberMap.set(t,e),e}_getElementName(t){return`${Et.getCreatorByType(t).name} ${this._increaseElementSerialNumber(t)}`}_reactionElementAdded(){this._elementList.on(it.added,t=>{const e=t.value;Object.keys(me).forEach(s=>{this._reactionElementPropsChanged(me[s],e,e[s])}),this.throttleRefreshTreeNodes()})}_reactionElementRemoved(){this._elementList.on(it.removed,t=>{const{id:e}=t.value;this._elementsMap.delete(e),this._selectedElementIds.delete(e),this._detachedSelectedElementIds.delete(e),this._targetElementIds.delete(e),this._provisionalElementIds.delete(e),this._rotatingTargetElementIds.delete(e),this._editingElementIds.delete(e),this._rangeElementIds.delete(e),this._visibleElementIds.delete(e),this._stageElementIds.delete(e),this.throttleRefreshTreeNodes()})}_reactionElementsPropsChanged(){Object.keys(me).forEach(t=>{this._elementList.on(t,(e,s)=>{this._reactionElementPropsChanged(t,e,s)})})}_reactionElementsSelectionChanged(){He(()=>Array.from(this._selectedElementIds),()=>{this._reactionSelectedElementsChanged(),this.shield.selection.refresh()}),He(()=>Array.from(this._detachedSelectedElementIds),()=>{this._reactionDetachedSelectedElementsChanged(),this.shield.selection.refresh()}),He(()=>Array.from(this._targetElementIds),()=>this._reactionTargetElementsChanged()),He(()=>Array.from(this._provisionalElementIds),()=>this._reactionProvisionalElementsChanged()),He(()=>Array.from(this._rotatingTargetElementIds),()=>this._reactionRotatingTargetElementsChanged()),He(()=>Array.from(this._editingElementIds),()=>this._reactionEditingElementsChanged()),He(()=>Array.from(this._rangeElementIds),()=>this._reactRangeElementsChanged()),He(()=>Array.from(this._visibleElementIds),()=>this._reactionVisibleElementsChanged()),He(()=>Array.from(this._stageElementIds),()=>this._reactionStageElementsChanged())}_reactionSelectedElementsChanged(){this._selectedElements=this._filterList(this._selectedElementIds),this._nonHomologousElements=k.getNonHomologousElements(this._selectedElements),this._isMultiSelected=this._nonHomologousElements.length>1,this._selectedAncestorElement=k.getAncestorGroup(this._selectedElements),this._primarySelectedElement=this._selectedAncestorElement,this.shield.emit(x.selectedChanged,this._selectedElements),this.shield.emit(x.multiSelectedChanged,this._isMultiSelected),this.shield.emit(x.primarySelectedChanged,this._primarySelectedElement),this.emitElementsLayerChanged()}_shouldLayerChange(t,e,s=!0){return t.some(n=>(n=n,n.length&&Dn.isConsecutive(n.map(i=>i.node))?!n[s?n.length-1:0][e]:n.some(i=>!i[e])))}emitElementsLayerChanged(){let t=!1,e=!1;if(this._selectedElements.length){const s=this._divideElementsByGroup(this.selectedElements,!0);t=this._shouldLayerChange(s,"isTopmost",!0),e=this._shouldLayerChange(s,"isBottommost",!1)}this.shield.emit(x.layerShiftMoveEnableChanged,t),this.shield.emit(x.layerGoDownEnableChanged,e)}_reactionDetachedSelectedElementsChanged(){this._detachedSelectedElements=this._filterList(this._detachedSelectedElementIds)}_reactionTargetElementsChanged(){this._targetElements=this._filterList(this._targetElementIds),this.shield.emit(x.targetChanged,this._targetElements)}_reactionStageElementsChanged(){this._stageElements=this._filterList(this._stageElementIds)}_reactionVisibleElementsChanged(){this._visibleElements=this._filterList(this._visibleElementIds)}_reactRangeElementsChanged(){this._rangeElements=this._filterList(this._rangeElementIds)}_reactionEditingElementsChanged(){this._editingElements=this._filterList(this._editingElementIds)}_reactionRotatingTargetElementsChanged(){this._rotatingTargetElements=this._filterList(this._rotatingTargetElementIds)}_reactionProvisionalElementsChanged(){this._provisionalElements=this._filterList(this._provisionalElementIds)}reactionElements(){this._reactionStageElementsChanged(),this._reactionVisibleElementsChanged(),this._reactionSelectedElementsChanged()}_filterList(t){return this._elementList.filter(e=>t.has(e.value.id)).map(e=>e.value)}_setAddDelete(t,e,s){s?t.add(e):t.delete(e)}_reactionElementPropsChanged(t,e,s){const{id:n}=e;switch(t){case me.isSelected:{this._setAddDelete(this._selectedElementIds,n,s);break}case me.isDetachedSelected:{this._setAddDelete(this._detachedSelectedElementIds,n,s);break}case me.isProvisional:{this._setAddDelete(this._provisionalElementIds,n,s);break}case me.isTarget:{this._setAddDelete(this._targetElementIds,n,s);break}case me.isRotatingTarget:{this._setAddDelete(this._rotatingTargetElementIds,n,s);break}case me.isEditing:{this._setAddDelete(this._editingElementIds,n,s);break}case me.isInRange:{this._setAddDelete(this._rangeElementIds,n,s);break}case me.isVisible:{this._setAddDelete(this._visibleElementIds,n,s);break}case me.isOnStage:{this._setAddDelete(this._stageElementIds,n,s);break}}[me.isSelected,me.isDetachedSelected,me.isVisible,me.isOnStage,me.isTarget,me.isRotatingTarget,me.isProvisional,me.isEditing,me.isInRange].includes(t)&&this._treeNodesMap.get(n)&&this.shield.emit(x.treeNodePropsChanged,n,{[t]:s})}filterEmit(t,e,...s){var n;e&&(e.id===((n=this.primarySelectedElement)==null?void 0:n.id)||e.id===this.currentCreatingElementId)&&this.shield.emit(t,e,...s)}throttleRefreshTreeNodes(){this._treeNodesMap.clear(),this._treeNodes=this._toTreeNodes(),this.shield.emit(x.treeNodesChanged,this._treeNodes)}_getElementTreeNodeProps(t){return R.pick(t,["isSelected","isDetachedSelected","isVisible","isOnStage","isTarget","isRotatingTarget","isProvisional","isEditing","isGroup","isInRange","isGroupSubject"])}_toTreeNodes(){const t=[];return this._elementList.forEach(e=>{const s=e.value,{isGroupSubject:n,isGroup:i,model:{id:o,name:a,groupId:l,type:c}}=s;if(!n){const d={id:o,groupId:l,type:c,label:a,children:[],...this._getElementTreeNodeProps(s)};if(t.unshift(d),this._treeNodesMap.set(o,d),i){const u=this._findGroupSubs(e,[]);d.children=u}}}),t}_findSubTreeNodesForward(t,e,s){const{value:{isGroup:n,model:{subIds:i,id:o}}}=t;if(n){let a=t.prev;for(;a;){const l=a.value,{isGroup:c,model:{id:d,groupId:u,name:f,type:g}}=l;if(i.includes(d)&&u===o){const C={id:d,groupId:o,type:g,label:f,children:[],...this._getElementTreeNodeProps(l)};e.push(C),this._treeNodesMap.set(d,C),c&&this._findGroupSubs(a,C.children),s.add(d)}if(V.isSetEqual(s,new Set(i)))break;a=a.prev}}return e}_findSubTreeNodesBackward(t,e,s){const{value:{isGroup:n,model:{subIds:i,id:o}}}=t;if(n){let a=t.next;for(;a;){const l=a.value,{isGroup:c,model:{id:d,groupId:u,name:f,type:g}}=l;if(i.includes(d)&&u===o){const C={id:d,groupId:o,type:g,label:f,children:[],...this._getElementTreeNodeProps(l)};e.push(C),this._treeNodesMap.set(d,C),c&&this._findGroupSubs(a,C.children)}if(s.add(d),V.isSetEqual(s,new Set(i)))break;a=a.next}}return e}_findGroupSubs(t,e){const{value:{isGroup:s,model:{subIds:n,id:i}}}=t;if(s){const o=new Set;this._findSubTreeNodesForward(t,e,o),V.isSetEqual(o,new Set(n))||(console.warn(`组件树结构异常,组合子组件可能在组合顺序之后，当前组合id:${i}, 共找到子组件:${o.values().toArray().join(",")}`),this._findSubTreeNodesBackward(t,e,o),console.warn(`组合子组件查找完毕，当前组合id:${i}, 共找到子组件:${o.values().toArray().join(",")}`))}return e}_shouldElementUpdate(t){return!t.isGroupSubject||t.isGroupSubject&&!t.group.isSelected}async setElementsPosition(t,e){t.forEach(s=>{if(this.hasElement(s.id)&&this._shouldElementUpdate(s)){const{x:n,y:i}=s.model,{x:o,y:a}=e;if(n===o&&i===a)return;const l={x:o-n,y:a-i};s.setPosition(o,a,l),s.isGroup&&s.deepSubs.forEach(c=>{c.setPosition(c.model.x+l.x,c.model.y+l.y,l)})}})}async setElementsWidth(t,e){t.forEach(s=>{if(this.hasElement(s.id)&&this._shouldElementUpdate(s)){if(s.width===e)return;const n=s.setWidth(e);s.isGroup&&this.scaleSubs(s,n)}})}async setElementsHeight(t,e){t.forEach(s=>{if(this.hasElement(s.id)&&this._shouldElementUpdate(s)){if(s.height===e)return;const n=s.setHeight(e);s.isGroup&&this.scaleSubs(s,n)}})}scaleSubs(t,e){const{centerCoord:s,angle:n,leanYAngle:i}=t,{scaleX:o,scaleY:a}=h.getScaleFromMatrix(e);t.deepSubs.forEach(l=>{l.scaleBy(s,o,a,{angle:n,leanYAngle:i})})}async setElementsAngle(t,e){t.forEach(s=>{if(this.hasElement(s.id)&&this._shouldElementUpdate(s)){if(s.angle===e)return;this.rotateElements([s],e,s.angle,s.centerCoord),s.onRotateAfter(),s.isGroup&&s.deepSubs.forEach(n=>n.onRotateAfter())}})}async setElementsRotate(t,e){t.forEach(s=>{if(this.hasElement(s.id)&&this._shouldElementUpdate(s)){if(!e)return;this.rotateElements([s],s.angle+e,s.angle,s.centerCoord),s.onRotateAfter(),s.isGroup&&s.deepSubs.forEach(n=>n.onRotateAfter())}})}async setElementsFlipX(t){let e,s;if(this._isMultiSelected){const n=L.getBoxByPoints(t.map(i=>i.rotateBoxCoords).flat());e={x:(n[0].x+n[1].x)/2,y:n[0].y},s={x:e.x,y:n[3].y}}t.forEach(n=>{this.hasElement(n.id)&&this._shouldElementUpdate(n)&&(this._isMultiSelected?n.flipXBy(e,s):[e,s]=n.setFlipX(),n.isGroup&&n.deepSubs.forEach(i=>{i.flipXBy(e,s)}))})}async setElementsFlipY(t){let e,s;if(this._isMultiSelected){const n=L.getBoxByPoints(t.map(i=>i.rotateBoxCoords).flat());e={x:n[0].x,y:(n[0].y+n[3].y)/2},s={x:n[1].x,y:e.y}}t.forEach(n=>{this.hasElement(n.id)&&this._shouldElementUpdate(n)&&(this._isMultiSelected?n.flipYBy(e,s):[e,s]=n.setFlipY(),n.isGroup&&n.deepSubs.forEach(i=>{i.flipYBy(e,s)}))})}async setElementsCorners(t,e,s){t.forEach(n=>{if(this.hasElement(n.id)&&this._shouldElementUpdate(n)){if(R.isEqual(n.corners,[e,e,e,e]))return;n.setCorners(e,s)}})}async setElementsLeanYAngle(t,e){t.forEach(s=>{if(this.hasElement(s.id)&&this._shouldElementUpdate(s)){if(s.leanYAngle===e)return;const n=s.leanYAngle;if(e=h.precise(e,1),s.setLeanYAngle(e),s.isGroup){const i=s.centerCoord;s.deepSubs.forEach(o=>{o.leanYBy(e,n,s.angle,i)})}}})}async setElementsStrokeType(t,e,s){t.forEach(n=>{if(this.hasElement(n.id)){if(n.model.styles.strokes[s].type===e)return;n.setStrokeType(e,s)}})}async setElementsStrokeWidth(t,e,s){t.forEach(n=>{if(this.hasElement(n.id)){if(n.model.styles.strokes[s].width===e)return;n.setStrokeWidth(e,s)}})}async setElementsStrokeColor(t,e,s){t.forEach(n=>{if(this.hasElement(n.id)){if(n.model.styles.strokes[s].color===e)return;n.setStrokeColor(e,s)}})}async setElementsStrokeColorOpacity(t,e,s){t.forEach(n=>{if(this.hasElement(n.id)){if(n.model.styles.strokes[s].colorOpacity===e)return;n.setStrokeColorOpacity(e,s)}})}async addElementsStroke(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.addStroke(e)})}async removeElementsStroke(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.removeStroke(e)})}async setElementsFillColor(t,e,s){t.forEach(n=>{if(this.hasElement(n.id)){if(n.model.styles.fills[s].color===e)return;n.setFillColor(e,s)}})}async setElementsFillColorOpacity(t,e,s){t.forEach(n=>{if(this.hasElement(n.id)){if(n.model.styles.fills[s].colorOpacity===e)return;n.setFillColorOpacity(e,s)}})}async addElementsFill(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.addFill(e)})}async removeElementsFill(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.removeFill(e)})}async setElementsTextAlign(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.textAlign===e)return;s.setTextAlign(e)}})}async setElementsTextVerticalAlign(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.textVerticalAlign===e)return;s.setTextVerticalAlign(e)}})}async setElementsTextBaseline(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.textBaseline===e)return;s.setTextBaseline(e)}})}async setElementsFontStyler(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setFontStyler(e)})}async setElementsFontSize(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setFontSize(e)})}async setElementsFontFamily(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setFontFamily(e)})}async setElementsFontLineHeight(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.fontLineHeight===e)return;s.setFontLineHeight(e)}})}async setElementsFontLineHeightFactor(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.fontLineHeightFactor===e)return;s.setFontLineHeightFactor(e)}})}async setElementsFontLineHeightAutoFit(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.fontLineHeightAutoFit===e)return;s.setFontLineHeightAutoFit(e)}})}async setElementsFontColor(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setFontColor(e)})}async setElementsFontColorOpacity(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setFontColorOpacity(e)})}async setElementsFontLetterSpacing(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setFontLetterSpacing(e)})}async setElementsTextDecoration(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setTextDecoration(e)})}async setElementsTextDecorationColor(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setTextDecorationColor(e)})}async setElementsTextDecorationOpacity(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setTextDecorationOpacity(e)})}async setElementsTextDecorationThickness(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setTextDecorationThickness(e)})}async setElementsRatioLocked(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.isRatioLocked===e)return;s.setRatioLocked(e)}})}hasElement(t){return this._elementsMap.has(t)}getElementById(t){return this._elementsMap.get(t)}getElementsByIds(t){return t.map(e=>this.getElementById(e)).filter(e=>e!==void 0)}getOrderedElementsByIds(t){const e=[];return t.length&&this._elementList.forEachBreak(s=>{if(t.includes(s.value.id)&&e.push(s.value),e.length===t.length)return!0}),e}getOrderedElementIds(t){const e=[];return t.length&&this._elementList.forEachBreak(s=>{if(t.includes(s.value.id)&&e.push(s.value.id),e.length===t.length)return!0}),e}getIndexById(t){return this.hasElement(t)&&this._elementList.forEachBreak((e,s)=>{if(e.value.id===t)return s},e=>{if(e.value.id===t)return!0}),-1}addElement(t,e,s){const n=new bn(t);return t.node=n,e?this._elementList.insertAfter(n,e.node):s?this._elementList.prepend(n):this._elementList.insert(n),this._elementsMap.set(t.id,t),t}insertBeforeElement(t,e,s){const n=new bn(t);return t.node=n,e?this._elementList.insertBefore(n,e.node):s?this._elementList.insert(n):this._elementList.prepend(n),this._elementsMap.set(t.id,t),t}_createElementByModel(t){const e=k.createElement(t,this.shield);return Object.assign(e,{status:ie.finished,isOnStage:!0,isSelected:!0}),e}insertAfterElementByModel(t,e,s){const n=this._createElementByModel(t);return this.addElement(n,e,s),n.refresh(),n}insertBeforeElementByModel(t,e,s){const n=this._createElementByModel(t);return this.insertBeforeElement(n,e,s),n.refresh(),n}removeElementById(t){if(this.hasElement(t)){let e=this._elementsMap.get(t);return this._elementList.removeBy(s=>s.value.id===t),this._elementsMap.delete(t),e=null,e}}removeElementsByIds(t){return t.map(e=>this.removeElementById(e)).filter(e=>e!==void 0)}removeElement(t){return this.removeElementById(t.id)}removeElements(t){return t.map(e=>this.removeElementById(e.id)).filter(e=>e!==void 0)}updateElementById(t,e){if(this.hasElement(t)){const s=this._elementsMap.get(t);return Object.assign(s,e),s}}updateElements(t,e){return t.forEach(s=>this.updateElementById(s.id,e)),t}updateElementModel(t,e){if(this.hasElement(t)){const s=this._elementsMap.get(t),n=s.model.id;return V.deepPlanObjectAssign(s.model,e,{id:n}),s}}updateElementsModel(t,e){t.forEach(s=>{this.updateElementModel(s.id,e)})}createElementModel(t,e,s,n){n=R.isBoolean(n)?n:!0;const i=k.calcSize({coords:e,boxCoords:L.getBoxByPoints(e),type:t}),o=k.calcPosition({type:t,coords:e});return{...k.createEmptyObject(),type:t,coords:e,boxCoords:L.getBoxByPoints(e),data:s,width:i.width,height:i.height,name:`${Et.getCreatorByType(t).name} ${n?this._increaseElementSerialNumber(t):this._elementSerialNumberMap.get(t)}`,styles:Tn(t),isRatioLocked:!1,...o,...sn,...os}}setElementProvisionalCreatingById(t){this.updateElementById(t,{status:ie.creating,isOnStage:!1,isProvisional:!0,isSelected:!0})}_createProvisionalElement(t){const e=k.createElement(t,this.shield);return this.currentCreatingElementId=e.id,this.updateElementById(e.id,{status:ie.startCreating}),this.addElement(e),e}creatingElement(t){let e;const{category:s,type:n}=this.shield.currentCreator;switch(s){case _e.shapes:{const i=this.createElementModel(n,k.calcCreatorPoints(t,n),null,!R.isString(this.currentCreatingElementId));this.currentCreatingElementId?(delete i.id,e=this.updateElementModel(this.currentCreatingElementId,i),e.model.boxCoords=L.getBoxByPoints(e.model.coords),this.setElementProvisionalCreatingById(e.id)):e=this._createProvisionalElement(i)}}return this.selectElement(e),e.refresh(),e}creatingArbitraryElement(t,e){let s,n;return this.currentCreatingElementId?(s=this.getElementById(this.currentCreatingElementId),n=s.model,e?h.isPointClosest(t,n.coords[0],Dr/re.stageParams.scale)?s.tailCoordIndex>0&&(n.isFold=!0):(n.coords.splice(n.coords.length-1,1,t),s.tailCoordIndex=n.coords.length-1):n.coords.length-s.tailCoordIndex<=1?n.coords.push(t):n.coords=[...n.coords.slice(0,s.tailCoordIndex+1),t],s.model.boxCoords=L.getBoxByPoints(s.model.coords),this.setElementProvisionalCreatingById(s.id)):(n=this.createElementModel(A.arbitrary,[t]),n.isFold=!1,s=this._createProvisionalElement(n),s.tailCoordIndex=0),this.selectElement(s),s.refresh(V.toBooleanObject(["size","points","position"])),s}_finishArbitraryElement(t){const e=t.tailCoordIndex;t.tailCoordIndex=-1,t.model.coords.length>2&&(t.model.coords=t.model.coords.slice(0,e+1))}finishCreatingElement(){if(this.currentCreatingElementId){let t=this.getElementById(this.currentCreatingElementId);if(t){this.currentCreatingElementId=null;const{model:{type:e}}=t;switch(e){case A.arbitrary:{this._finishArbitraryElement(t);break}}return this.updateElementById(t.id,{status:ie.finished}),t.model.boxCoords=L.getBoxByPoints(t.model.coords),t.refresh(),t}}}findElements(t){const e=[];return this._elementList.forEach(s=>{t(s.value)&&e.push(s.value)}),e}updateElementsTransform(t,e){t.forEach(s=>{s.transform(e),s.isGroup&&this._shouldElementUpdate(s)&&s.deepSubs.forEach(n=>{const{transformLockCoord:i,transformLockIndex:o,originalTransformMoveCoord:a,transformType:l,model:{angle:c,leanYAngle:d}}=s;n.transformBy({lockCoord:i,lockIndex:o,originalMovingCoord:a,offset:e,groupAngle:c,groupLeanYAngle:d,transformType:l})})})}updateElementsCorner(t,e){t.forEach(s=>{s.updateCornerByOffset(e)})}updateElementsCoordsByOffset(t,e){t.forEach(s=>{s.translateBy(e),!s.isOnStage&&this._updateElementStageStatusIfy(s)})}forEach(t){this._elementList.forEach((e,s)=>{t(e.value,s)})}refreshElementsOriginals(t,e){this._refreshElementsByFunc(t,s=>s.refreshOriginals(),e)}refreshElementsOriginalAngles(t,e){this._refreshElementsByFunc(t,s=>s.refreshOriginalAngle(),e)}_refreshElementsByFunc(t,e,s){s=Object.assign({},Eo,s||{});let n=new Set;function i(o){n.has(o.id)||(n.add(o.id),e(o))}t.forEach(o=>{i(o),o.isGroup&&(s.deepSubs?o.deepSubs.forEach(i):s.subs&&o.subs.forEach(i))}),n.clear(),n=null}_updateElementStageStatusIfy(t){const e=t.id===this.currentCreatingElementId?!1:t.isModelPolygonOverlap(this.shield.stageWordRectCoords);this.updateElementById(t.id,{isOnStage:e})}refreshStageElements(){this._elementList.forEach(({value:t})=>{this._updateElementStageStatusIfy(t),t.refresh(V.toBooleanObject(["points","rotation","originals","outline","strokes"]))})}refreshElements(t){t.forEach(e=>{e.refresh()})}isSelectedContainsTarget(){return this.isTargetEmpty?!1:R.every(Array.from(this._targetElementIds),t=>this._selectedElementIds.has(t))}refreshRotatingStates(t){this.refreshElementsRotationStates(this.rotatingTargetElements,t)}refreshElementsRotationStates(t,e){const{center:s,centerCoord:n,angle:i}=this.calcRotatingStatesByElements(e,t);this._rotatingCenter=s,this._rotatingCenterCoord=n,this._rotatingOriginalAngle=i}calcRotatingStatesByElements(t,e){const s=h.calcCenter(e.map(o=>o.centerCoord).flat()),n=k.calcStageRelativePoint(s),i=h.precise(h.calcAngle(n,t));return{center:n,centerCoord:s,angle:i}}clearRotatingStates(){this._rotatingCenter=null,this._rotatingCenterCoord=null,this._rotatingOriginalAngle=null}updateElementsRotation(t,e){const s=h.precise(h.calcAngle(this._rotatingCenter,e));this.rotateElements(t,s,this._rotatingOriginalAngle,this._rotatingCenterCoord,!0)}rotateElements(t,e,s,n,i=!1){t.forEach(o=>{const a=o.originalAngle;o.model.type!==A.line&&(e=h.constraintAngle(a+e-s),e=h.precise(e,1)),i?o.updateAngle(e):o.setAngle(e),!o.isOnStage&&this._updateElementStageStatusIfy(o),o.isGroup&&o.deepSubs.forEach(l=>{l.rotateBy(e-a,n,i),!l.isOnStage&&this._updateElementStageStatusIfy(l)})})}async createImageElementModel(t,e,s){const{colorSpace:n}=e,{width:i,height:o}=t,a=L.getBoxByCenter(s||re.stageParams.worldCoord,{width:i,height:o}),l=h.calcCenter(a);return{...k.createEmptyObject(),coords:a,boxCoords:L.getBoxByPoints(a),type:A.image,data:t,name:this._getElementName(A.image),width:i,height:o,length:0,styles:Tn(A.image),colorSpace:n,naturalWidth:i,naturalHeight:o,isRatioLocked:!0,...l,...os}}async _insertImage(t,e){let s=t.colorSpace;const n=await this.createImageElementModel(t,{colorSpace:s},e);return this.insertAfterElementByModel(n)}async insertImageElements(t){const e=[];t=await zt.convertImages(t);const s=L.packRectangles(t.map(n=>({width:n.width,height:n.height})),re.stageParams.worldCoord,Zo);return await new Promise(n=>{let i=new fa;t.forEach((o,a)=>{i.add(new Gs(async()=>{const l=await this._insertImage(o,s[a]);e.push(l),a===t.length-1&&(n(null),await i.destroy(),i=null)}))})}),e}insertTextElement(t,e,s){const n=I.createTextData(t,e),i=this.createElementModel(A.text,s,n);return this.insertAfterElementByModel(i)}deleteSelects(){this.selectedElements.forEach(t=>{this.removeElementById(t.id)})}selectElement(t){this.updateElementById(t.id,{isSelected:!0})}deSelectElement(t){this.updateElementById(t.id,{isSelected:!1})}selectElements(t){t.forEach(e=>{this.selectElement(e)})}deSelectElements(t){t.forEach(e=>{this.deSelectElement(e)})}toggleSelectElement(t){t.isSelected?this.deSelectElement(t):this.selectElement(t)}toggleSelectElements(t){t.forEach(e=>{this.toggleSelectElement(e)})}selectAll(){this._elementList.forEachRevert(t=>{t.value.isGroupSubject||this.selectElement(t.value)})}deSelectAll(){this._elementList.forEach(t=>{t.value.isGroupSubject||this.deSelectElement(t.value)})}cancelTargetElements(){this.targetElements.forEach(t=>{this.updateElementById(t.id,{isTarget:!1})})}beginEditingElements(t){this._setElementsEditing(t,!0)}endEditingElements(t){this._setElementsEditing(t,!1)}getFinishedSelectedElements(t){return this.selectedElements.filter(e=>e.status===ie.finished&&(t?!e.isGroupSubject:!0))}getSelectedElements(t){return this.selectedElements.filter(e=>t?!e.isGroupSubject:!0)}_setElementsEditing(t,e){t.forEach(s=>{s.editingEnable&&e!==s.isEditing&&(this.updateElementById(s.id,{isEditing:e,status:e?ie.editing:ie.finished}),s.tfRefreshAfterEdChanged&&s.refresh())})}isSelectedEqCreating(){const t=new Set(this.selectedElements.map(s=>s.id)),e=new Set(this.creatingElements.map(s=>s.id));return R.isEqual(t,e)}_bindElementsGroup(t){t.subs.forEach(e=>{this.updateElementModel(e.id,{groupId:t.id})})}_unbindElementsGroup(t){this.updateElementsModel(t.getSubs(),{groupId:void 0}),this.updateElementModel(t.id,{subIds:[]})}_createElementGroupObject(t){const e=t.map(l=>l.id),s=L.getBoxByPoints(t.map(l=>l.rotateCoords).flat()),{width:n,height:i,x:o,y:a}=L.getRect(s);return{...k.createEmptyGroupObject(),name:this._getElementName(A.group),subIds:e,coords:s,boxCoords:L.getBoxByPoints(s),width:n,height:i,x:o+n/2,y:a+i/2}}removeElementGroup(t){this.hasElement(t.id)&&(this._unbindElementsGroup(t),this.deSelectElement(t),this.removeElementById(t.id))}_insertNewGroup(t,e){this._bindElementsGroup(t),this.addElement(t,e),this.updateElementById(t.id,{status:ie.finished,isOnStage:!0}),t.refresh()}_calcEffectedElementsOfMoved(t,e){const s=(e==null?void 0:e.ancestorGroups)||[],n=new Set(t.map(E=>E.id)),i=new Set,o=new Set,a=new Set,l=new Set,c=[],d=[];t.forEach(E=>{if(E.isGroupSubject){const b=E.model.groupId;n.has(b)||(i.add(b),l.add(E.id))}else l.add(E.id);c.push({type:$.Moved,data:[E]})});const u=this.getOrderedElementsByIds(Array.from(i));function f(E){const b=E.model.subIds;return b.every(F=>n.has(F)||b.every(N=>o.has(N)))&&E.id!==(e==null?void 0:e.id)&&(s==null?void 0:s.findIndex(F=>F.id===E.id))===-1}u.forEach(E=>{f(E)?o.add(E.id):a.add(E.id);let b=E.group;for(;b;)f(b)?o.add(b.id):a.add(b.id),b=b.group});const g=this.getOrderedElementsByIds(Array.from(o));g.forEach(E=>{d.push({type:$.Removed,data:[E]})});const C=this.getOrderedElementsByIds(Array.from([...a,...(s==null?void 0:s.map(E=>E.id).flat())||[]]));return C.forEach(E=>{d.push({type:$.GroupUpdated,data:[E]})}),{actionParams:[...d,...c],removedGroups:g,updatedGroups:C,outerLayerIdSet:l,elementIdSet:n,updatedGroupIdSet:a,removedGroupIdSet:o}}_processEffectedElementGroups({removedGroups:t,updatedGroups:e,excludeElementIdSet:s,excludeGroupIdSet:n}){t==null||t.forEach(i=>{this.removeElement(i)}),e==null||e.forEach(i=>{const o=i.model.subIds.filter(a=>!(s!=null&&s.has(a))&&!(n!=null&&n.has(a)));this.updateElementModel(i.id,{subIds:o}),i.refreshBySubs(),i.refreshOriginals()})}async createElementGroup(t,e,s){if(t.length<1)return;const n=this.sortElements(t),i=n[n.length-1],o=i.group;let a=-1;a=o==null?void 0:o.model.subIds.indexOf(i.id);const{actionParams:l,removedGroups:c,updatedGroups:d,outerLayerIdSet:u,elementIdSet:f,removedGroupIdSet:g}=this._calcEffectedElementsOfMoved(n,o),C=this.getOrderedElementsByIds(Array.from(u));await e(l);const y=new ln(this._createElementGroupObject(C),this.shield);if(this._removeNodesByElements(n.slice(0,n.length-1)).forEach(F=>{this._elementList.insertBefore(F,i.node,!1),u.has(F.value.id)&&this.updateElementModel(F.value.id,{groupId:y.id})}),o){const F=[...o.model.subIds];F.splice(a,1,y.id),this.updateElementModel(o.id,{subIds:F}),y.model.groupId=o.id}this._insertNewGroup(y,i);const b={type:$.Added,data:[y]};await e([b]),l.push(b),this._processEffectedElementGroups({removedGroups:c,updatedGroups:d,excludeElementIdSet:f,excludeGroupIdSet:g}),await s(l)}cancelGroups(t){t.forEach(e=>{this.removeElementGroup(e)})}getSelectedElementGroups(){return this.selectedElements.filter(t=>t.model.type===A.group)}getSelectedAncestorElementGroups(){return k.getNonHomologousElements(this.getSelectedElementGroups())}sortElements(t){const e=t.map(s=>s.id);return this.getElementsByIds(e)}async copySelectElements(){return Promise.all(this.selectedElements.map(async t=>await t.toJson()))}async pasteElements(t,e,s){var b;const n=k.calcOuterLayerElementIds(t);let i=this.selectedElements[this.selectedElements.length-1],o=!n.has((i==null?void 0:i.id)||""),a=null,l,c,d=[],u=-1;i&&(i.isGroup&&o?(l=i.id,d=i.model.subIds,a=this._elementsMap.get(d[d.length-1])):(a=i,a.isGroupSubject&&(l=a.model.groupId,d=((b=this._elementsMap.get(l))==null?void 0:b.model.subIds)||[],u=d.indexOf(a.id))));const f=[],g=[],C=k.convertElementsJson(t),y=new Set;C.forEach(F=>{F.type===A.group&&y.add(F.id)});let E=[];for(const F of C){await k.convertElementModel(F),F.name=this._getElementName(F.type),y.has(F.groupId)||(F.groupId=l,E.push(F.id));const N=this.insertAfterElementByModel(F,a);f.push({type:$.Added,data:[N]}),g.push(N),a=N}return l&&(f.push({type:$.GroupUpdated,data:[this.getElementById(l)]}),c=this.getElementById(l)),await e(f),c&&(u>-1?d.splice(u+1,0,...E):d.push(...E),this.updateElementModel(l,{subIds:d}),c.refreshBySubs(),c.refreshOriginals()),await s(f),g}moveElementAfter(t,e,s){const{node:n}=t;this._elementList.remove(n,!1),e?this._elementList.insertAfter(n,e.node,!1):s?this._elementList.prepend(n,!1):this._elementList.insert(n,!1)}moveElementBefore(t,e,s){const{node:n}=t;this._elementList.remove(n,!1),e?this._elementList.insertBefore(n,e.node,!1):s?this._elementList.insert(n,!1):this._elementList.prepend(n,!1)}_removeNodesByElements(t){const e=[];return t.forEach(s=>{const[n]=this._elementList.removeBy(i=>i.value.id===s.id,!1);e.push(n)}),e}_getGroupFirstDeepSubNode(t){var e;return t.value.isGroup?(e=this._elementsMap.get(t.value.deepSubIds[0]))==null?void 0:e.node:t}_doElementsGoDownIfy(t,e=!1){var l;const s=t.map(c=>c.id),n=t[0].group;t=k.flatElementsWithDeepSubs(t);const i=t[0].node;let o=i.prev;if(!o)return;let a=[];if(e){let c;const d=n.subIds;if(d[0]===i.value.id){for(let f=0;f<d.length;f++)if(!s.includes(d[f])){c=d[f];break}}else{const f=d.findIndex(g=>g===i.value.id);c=d[f-1]}c&&(o=(l=this._elementsMap.get(c))==null?void 0:l.node,a=V.moveArryElementsBefore(d,s,c),o&&o.value.isGroup&&(o=this._getGroupFirstDeepSubNode(o)))}else o!=null&&o.value.isGroup&&(o=this._getGroupFirstDeepSubNode(o));this._moveElememntsBeforeTarget(t,o),e&&this.updateElementModel(n.id,{subIds:a})}_moveElememntsBeforeTarget(t,e){const s=this._removeNodesByElements(t);e?s.forEach(n=>{this._elementList.insertBefore(n,e,!1)}):s.reverse().forEach(n=>{this._elementList.prepend(n,!1)})}async _doElementsLayerChange(t,e,s,n){const i=this._divideElementsByGroup(t),o=[];if(await Promise.all(i.map(a=>new Promise(async l=>{if(R.isArray(a)){const c=a[0].group;if(a.length===c.model.subIds.length)return l();const d=[{type:$.Moved,data:a},{type:$.GroupUpdated,data:[c]}];await s(d),e(a,!0),await n(d)}else o.push(a);l()}))),o.length){const a=[{type:$.Moved,data:o}];await s(a),e(o,!1),await n(a)}}async setElementsGoDown(t,e,s){t.length!==0&&(await this._doElementsLayerChange(t,(n,i)=>this._doElementsGoDownIfy(n,i),e,s),this.reactionElements(),this.emitElementsLayerChanged(),this.throttleRefreshTreeNodes())}_getTailOfDividedGroupElements(t){if(t.length){const e=t[t.length-1];return R.isArray(e)?e[e.length-1]:e}}_divideElementsByGroup(t,e=!1){const s=[],n=[];return t.forEach(i=>{if(i.isGroupSubject){const o=this._getTailOfDividedGroupElements(s);o&&o.model.groupId===i.model.groupId?s[s.length-1]=[...s[s.length-1],i]:s.push([i])}else e?n.push(i):s.push(i)}),e?[...s,n]:s}_moveElementsAfterTarget(t,e){const s=this._removeNodesByElements(t);e?s.forEach(n=>{this._elementList.insertAfter(n,e,!1),e=n}):s.forEach(n=>{this._elementList.insert(n,!1)})}_doElementsShiftMoveIfy(t,e=!1){var l;const s=t.map(c=>c.id),n=t[0].group;t=k.flatElementsWithDeepSubs(t);const i=t[t.length-1].node;let o=i.next,a=[];if(e){let c;const d=n.subIds;if(d[d.length-1]===i.value.id){for(let f=d.length-1;f>=0;f--)if(s.findIndex(C=>C===d[f])===-1){c=d[f];break}}else{const f=d.findIndex(g=>g===i.value.id);c=d[f+1]}if(c&&(o=(l=this._elementsMap.get(c))==null?void 0:l.node,a=V.moveArrayElementsAfter(d,s,c),o&&o.value===n)){console.log(`组合内部子组件向上移动排序时，目标节点是当前组合，表示数据出现异常，终止节点移动, 组合id: ${n.id}, 需要向上移动的子组件集合: ${t.map(f=>f.id).join(", ")}`);return}}else o!=null&&o.value.isGroupSubject&&(o=o.value.ancestorGroup.node);o&&(this._moveElementsAfterTarget(t,o),e&&this.updateElementModel(n.id,{subIds:a}))}async setElementsShiftMove(t,e,s){t.length!==0&&(await this._doElementsLayerChange(t,(n,i)=>this._doElementsShiftMoveIfy(n,i),e,s),this.reactionElements(),this.emitElementsLayerChanged(),this.throttleRefreshTreeNodes())}async setElementsParagraphSpacing(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setParagraphSpacing(e)})}async setElementsTextCase(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setTextCase(e)})}toggleElementsTarget(t,e){t.forEach(s=>{this.hasElement(s)&&this.updateElementById(s,{isTarget:e})})}setElementsDetachedSelectedByIds(t,e){e&&(this._selectedElementIds.forEach(s=>{this.hasElement(s)&&!t.includes(s)&&!this._detachedSelectedElementIds.has(s)&&this.updateElementById(s,{isSelected:!1})}),this._detachedSelectedElementIds.forEach(s=>{this.hasElement(s)&&!t.includes(s)&&this.updateElementById(s,{isDetachedSelected:!1})})),t.forEach(s=>{this.hasElement(s)&&this.updateElementById(s,{isDetachedSelected:e})})}setElementsDetachedSelected(t,e){const s=t.map(n=>n.id);this.setElementsDetachedSelectedByIds(s,e)}_setElementsMixinDetachedSelected(t){t.forEach(e=>{if(this.hasElement(e)){const s=this.getElementById(e),{isSelected:n,isGroup:i,isGroupSubject:o}=s;if(n&&o&&s.group.isSelected)return;!n&&i&&s.deepSubs.forEach(a=>{this.updateElementById(a.id,{isSelected:!1})}),this.updateElementById(e,{isDetachedSelected:!n})}})}toggleElementsDetachedSelected(t){this.shield.event.isCtrl?this._setElementsMixinDetachedSelected(t):this.setElementsDetachedSelectedByIds(t,!0)}findRemovedElemements(t){const e=new Set(t.map(l=>l.id)),s=new Set,n=new Map;t.forEach(l=>{if(k.isDetachedElementAncestorUnNotSelected(l)){let c=l.group;for(;c&&!c.isSelected;){const{id:d}=c;c.model.subIds.every(u=>e.has(u))?e.add(d):s.add(d),n.set(d,c),c=c.group}}}),this.getOrderedElementIds(Array.from(s)).filter(l=>{n.get(l).model.subIds.every(d=>e.has(d))&&(e.add(l),s.delete(l))});const o=this.getOrderedElementsByIds(Array.from(s));return{list:this.getOrderedElementsByIds(Array.from(e)),ancestors:o}}getAncestorsByDetachedElements(t){const e=k.getAncestorIdsByDetachedElements(t);return this.getOrderedElementsByIds(Array.from(e))}getOuterLayerElements(t){const e=k.calcOuterLayerElements(t);return this.sortElements(e)}async _doMoveElementsTo(t,e,s,n,i){var v;const o=this.getOrderedElementsByIds(t);let a=this.getElementById(e),l,c,d=[];a.isGroupSubject&&(l=a.model.groupId,d=((v=this._elementsMap.get(l))==null?void 0:v.model.subIds)||[],c=this._elementsMap.get(l));const u=[];let{updatedGroups:f,removedGroups:g,actionParams:C,outerLayerIdSet:y,elementIdSet:E,removedGroupIdSet:b,updatedGroupIdSet:F}=this._calcEffectedElementsOfMoved(o,c);u.push(...C),c&&!F.has(c.id)&&u.push({type:$.GroupUpdated,data:[c]}),await n(u);const N=this._removeNodesByElements(o);let w=a.node;if(N.forEach(P=>{const{id:D,model:{groupId:M}}=P.value;switch(s){case Mt.after:this._elementList.insertBefore(P,w,!1);break;case Mt.before:this._elementList.insertAfter(P,w,!1);break}M&&M===a.model.groupId&&(c=this._elementsMap.get(M),d=c.model.subIds),y.has(D)&&this.updateElementModel(D,{groupId:l}),w=P}),c){const P=this.getOrderedElementIds(Array.from(y));let D=d.filter(J=>!E.has(J)&&!b.has(J));const M=D.findIndex(J=>J===a.id);D=V.insertToArray(D,M,s===Mt.after,...P),this.updateElementModel(c.id,{subIds:D}),c.refreshBySubs(),c.refreshOriginals()}f=f.filter(P=>P.id!==l),this._processEffectedElementGroups({updatedGroups:f,removedGroups:g,excludeElementIdSet:E,excludeGroupIdSet:b}),await i(u)}async moveElementsTo(t,e,s,n,i){t.length===0||!e||(await this._doMoveElementsTo(t,e,s,n,i),this.reactionElements(),this.emitElementsLayerChanged(),this.throttleRefreshTreeNodes())}clearCreatingElements(){this.removeElements(this.creatingElements),this.currentCreatingElementId=null}}class dn extends _s{constructor(e){super();p(this,"tasks");p(this,"running");this.tasks=e}isEmpty(){return this.tasks.length===0}add(e){this.running||e&&this.tasks.push(e)}addAll(e){e.forEach(s=>{this.add(s)})}prepend(e){this.running||e&&this.tasks.unshift(e)}async run(){for(this.running=!0;this.tasks.length>0;){let e=this.tasks.shift();if(e)try{await e.run()}catch{}finally{e.destroy&&await e.destroy(),e=null}}this.running=!1}}class rt extends _s{constructor(e,s){super();p(this,"model");p(this,"canvas");this.model=e,this.canvas=s}destroy(){return this.model=null,this.id=null,this.canvas=null,Promise.resolve()}}class xa extends rt{async run(){var s,n;if(!this.canvas||!this.model)return;const{width:t}=In.strokes[0];let{points:e}=this.model;e=k.calcStageRelativePoints(e),[ve.selection,ve.path].includes(this.model.type),G.drawPathWithScale(this.canvas,e,{},{...In.strokes[0],width:t/G.scale},{isFold:typeof((s=this.model.element)==null?void 0:s.isFold)>"u"?!0:(n=this.model.element)==null?void 0:n.isFold})}}class Mn extends rt{async run(){var t;this.canvas&&((t=this.canvas.getContext("2d"))==null||t.clearRect(0,0,this.canvas.width,this.canvas.height))}}class Sa extends rt{async run(){if(!this.canvas||!this.model)return;const{width:t}=Nt.strokes[0];let{point:e,leanYAngle:s,actualAngle:n}=this.model;e=k.calcStageRelativePoint(e),G.drawPathWithScale(this.canvas,L.getBoxByCenter(e,{width:as/G.scale,height:as/G.scale},{angle:n,leanYAngle:s}),Nt.fills[0],{...Nt.strokes[0],width:t/G.scale},{calcVertices:!1})}}class hn{constructor(t){p(this,"drawer");p(this,"renderQueue");this.drawer=t,this.renderQueue=new Wt}async renderCargo(t){await this.renderQueue.add(t)}get canvas(){return this.drawer.node}clear(){throw new Error("Method not implemented.")}async redraw(t){throw new Error("Method not implemented.")}}const Ti="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1735111770421'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1464'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M510.9%2064.7c-108.7%200-214%2040.4-295%20111.8L107.3%2068v299.4h299.4L295.4%20256.1c60.3-51.3%20134.9-80.6%20215.5-80.6%20184.8%200%20335.2%20150.3%20335.2%20335.2S695.7%20845.8%20510.9%20845.8%20175.7%20695.4%20175.7%20510.6H64.9c0%20245.8%20200.1%20445.9%20445.9%20445.9s445.9-200.1%20445.9-445.9-200-445.9-445.8-445.9z'%20fill='%231296db'%20p-id='1465'%3e%3c/path%3e%3c/svg%3e";class ba extends rt{get svg(){return Ti}async run(){if(!this.canvas||!this.model)return;let{point:t,width:e,height:s}=this.model;t=k.calcStageRelativePoint(t),await G.drawImgLike(this.canvas,this.svg,{x:(t.x-e/G.scale/2)*G.scale,y:(t.y-s/G.scale/2)*G.scale,width:e,height:s},{angle:this.model.angle})}}const Nn=4,va=4;class wa extends rt{async run(){if(!this.canvas||!this.model)return;let{text:t,point:e,angle:s}=this.model,{width:n,fontBoundingBoxDescent:i,fontBoundingBoxAscent:o}=G.measureText(this.canvas.getContext("2d"),t,Hs),a=i+o+Nn*2;n+=Nn*2,n/=G.scale,a/=G.scale,e=k.calcStageRelativePoint(e);const l=L.getBoxByCenter(e,{width:n,height:a}),c=Oe.calcRenderRect(l,e,G.scale),d=G.getRadiusRectanglePaths(R.range(0,4).map(f=>va/G.scale),n,a,e),u={angle:s};G.drawInnerArcPathFillWithScale(this.canvas,c,d,Xo,u),G.drawCommonRotateTextWithScale(this.canvas,t,h.translate(e,{x:0,y:1}),Hs,qo,u)}}class Ta extends rt{async run(){if(!this.canvas||!this.model)return;let{text:t,point:e}=this.model;e&&(e=k.calcStageRelativePoint(e),await G.drawCommonRotateTextWithScale(this.canvas,t,e,Ln,Ln.fills[0]))}}class Zt extends rt{async run(){if(!this.canvas||!this.model)return;let{point:t}=this.model;if(!t)return;let{radius:e}=this.model;const s={...Nt.strokes[0]};s.width/=G.scale;const n={...Nt.fills[0]};e/=G.scale,t=k.calcStageRelativePoint(t),G.drawEllipseFillWithScale(this.canvas,t,{rx:e,ry:e},n),G.drawEllipseStrokeWithScale(this.canvas,t,{rx:e,ry:e},s)}}class Aa extends Xe{async run(){!this.canvas||!this.element||Es.drawTextCursor(this.element,this.canvas,this.element.textCursor)}}class Oa extends Xe{async run(){if(!this.canvas||!this.element)return;const{textSelection:t,isSelectionAvailable:e,angle:s,flipX:n,leanY:i,actualAngle:o}=this.element;if(!e)return;const a={angle:s,flipX:n,leanY:i,actualAngle:o},{startCursor:l,endCursor:c}=t,{lineNumber:d}=l,{lineNumber:u}=c,f=Oe.calcElementRenderRect(this.element);if(d===u)this._drawLineSelection(l,c,f,a);else{const{lines:g}=this.element.model.data;if(d<u)for(let C=d;C<=u;C++){const y=g[C];y.nodes.length===0?this._draweEmptyLine(y,f,a):C===d?this._drawPartialLine(y,l,j.RIGHT,f,a):C===u?this._drawPartialLine(y,c,j.LEFT,f,a):this._drawFullLine(y,f,a)}else for(let C=d;C>=u;C--){const y=g[C];y.nodes.length===0?this._draweEmptyLine(y,f,a):C===d?this._drawPartialLine(y,l,j.LEFT,f,a):C===u?this._drawPartialLine(y,c,j.RIGHT,f,a):this._drawFullLine(y,f,a)}}}_draweEmptyLine(t,e,s){const{x:n,y:i,height:o}=t,a={x:n,y:i,height:o,renderRect:e},l={x:n+4*G.scale,y:i,height:o,renderRect:e};this._drawLineSelection(a,l,e,s)}_drawFullLine(t,e,s){const n=t.nodes[0];this._drawPartialLine(t,{...R.pick(n,["x","y","height"]),renderRect:e},j.RIGHT,e,s)}_drawPartialLine(t,e,s,n,i){if(s===j.LEFT){const o=t.nodes[0];this._drawLineSelection({...R.pick(o,["x","y","height"])},e,n,i)}else if(s===j.RIGHT){const o=t.nodes[t.nodes.length-1];this._drawLineSelection(e,{x:o.x+o.width,...R.pick(o,["y","height"])},n,i)}}_drawLineSelection(t,e,s,n){const i=Math.min(t.x,e.x),o=t.y,a=Math.abs(t.x-e.x),l=t.height;G.drawRectInRenderRect(this.canvas,{...s,desX:i,desY:o,desWidth:a,desHeight:l},{color:$o,colorOpacity:Yo},n)}}class Vn extends Xe{constructor(e,s,n){super(e,s);p(this,"cursorType");this.cursorType=n}async run(){if(!this.canvas||!this.element)return;const{textSelection:e}=this.element,s=e[this.cursorType===ds.START?"startCursor":"endCursor"];Es.drawTextCursor(this.element,this.canvas,s)}}class Ia extends Xe{async run(){if(!this.canvas||!this.element)return;const{angle:t,flipX:e,leanY:s,actualAngle:n,model:{data:i}}=this.element,o={angle:t,flipX:e,leanY:s,actualAngle:n},a=Oe.calcElementRenderRect(this.element);i.lines.forEach(l=>{this._drawUnderline(l,a,o)})}_drawUnderline(t,e,s){const{nodes:n=[]}=t;if(n.length){const{x:i,baseline:o}=n[0],{x:a,width:l}=n[n.length-1];G.drawLineInRenderRect(this.canvas,{...e,desX:i,desY:o,desWidth:a+l-i},{color:zo,colorOpacity:Go,width:jo},s)}}}var ee=(r=>(r[r.NONE=0]="NONE",r[r.MOVING=1]="MOVING",r[r.MOVE_READY=2]="MOVE_READY",r[r.ROTATING=3]="ROTATING",r[r.TRANSFORMING=4]="TRANSFORMING",r[r.CORNER_MOVING=5]="CORNER_MOVING",r))(ee||{});class La extends hn{constructor(){super(...arguments);p(this,"_lastCursorRendered",!1);p(this,"_lastSelectionRendered",!1)}async redraw(){let e=new dn([]),s=!1,n=[];const{store:{nonHomologousElements:i},configure:{rotationIconEnable:o},selection:{rangeElement:a},cursor:l,isDrawerActive:c,isTextEditing:d,elementsStatus:u}=this.drawer.shield;if(u!==ee.MOVING){n=this.createMaskSelectionTasks(),e.addAll(n),n.length&&(this._lastSelectionRendered=!0);const g=this.createMaskTransformerTasks();g.length&&e.addAll(g);const C=this.createControllerTasks();C.length&&e.addAll(C);let y=null;if(i.length===1){const E=i[0];E.rotationEnable&&E.status===ie.finished&&(y=E.rotation),E.isValid&&e.add(this.createMaskIndicatorTask(E))}else i.length>1&&a.subs.length>0&&(y=a.rotation);y&&o&&e.add(this.createMaskRotateTask(y))}const f=l.getTask();f&&(e.add(f),this._lastCursorRendered=!0,s=!0),c&&(e.add(this.createMaskCursorPositionTask()),e.add(this.createMaskArbitraryCursorTask())),d&&(e.add(this.createTextElementCursorTask()),e.add(this.createTextElementSelectionTask()),e.addAll(this.createTextElementSelectionCursorTasks())),e.addAll(this.createTextElementsHighlightUndelineTasks()),e.add(this.createRangeElementCenterIndicatorTask()),e.isEmpty()?(this._lastCursorRendered||this._lastSelectionRendered)&&!n.length&&!s?(e.add(new Mn(null,this.canvas)),await this.renderCargo(e),this._lastCursorRendered=!1,this._lastSelectionRendered=!1):e=null:(e.prepend(this.createMaskClearTask()),await this.renderCargo(e))}createMaskCursorPositionTask(){const{cursor:{worldValue:e}}=this.drawer.shield;if(!e)return;const s={point:{x:e.x+20/re.stageParams.scale,y:e.y+20/re.stageParams.scale},type:ve.cursorPosition,text:`${h.precise(e.x,1)},${h.precise(e.y,1)}`};return new Ta(s,this.canvas)}createMaskSelectionTasks(){const{selection:e}=this.drawer.shield,s=[];return[...e.getModels(),e.selectionModel].forEach(i=>{var o;if(((o=i==null?void 0:i.points)==null?void 0:o.length)>0){const a=new xa(i,this.canvas);s.push(a)}}),s}createMaskClearTask(){return new Mn(null,this.canvas)}createMaskTransformerTasks(){const{selection:{transformerModels:e}}=this.drawer.shield;return e.map(s=>{switch(s.element.transformerType){case ct.circle:return new Zt(s,this.canvas);case ct.rect:return new Sa(s,this.canvas);default:return null}}).filter(s=>!!s)}createControllerTasks(){const{store:{primarySelectedElement:e},selection:{rangeElement:s}}=this.drawer.shield,n=e||s;if(n){const{controllers:i=[]}=n;return i.map(o=>{if(!(o instanceof $t)&&!(o instanceof _t)&&!(o instanceof Ht)){const a={point:{x:o.x,y:o.y},type:ve.transformer,radius:es};return new Zt(a,this.canvas)}return null}).filter(o=>!!o)}return[]}createMaskRotateTask(e){const s={point:{x:e.x,y:e.y},type:ve.rotate,...R.pick(e,["points","angle","width","height"])};return new ba(s,this.canvas)}createMaskIndicatorTask(e){let s,n;switch(e.model.type){case A.line:{[s,n]=[...e.rotateCoords].sort((a,l)=>a.x-l.x);break}default:{if(e.model.angle%90===0&&e.model.leanYAngle===0){const{maxBoxCoords:a}=e;s=a[3],n=a[2]}else{const[a,l,c]=L.getLBRPoints(e.rotateBoxCoords,!0);let d=h.transformToAcuteAngle(h.calcAngle(l,a)+180),u=h.transformToAcuteAngle(h.calcAngle(l,c)+180);[s,n]=[d<u?a:c,l].sort((g,C)=>g.x-C.x)}break}}const i=h.calcAngle(s,n),o={point:h.calcSegmentLineCenterCrossPoint(s,n,!0,ko/re.stageParams.scale),angle:i,type:ve.indicator,text:`${e.width} x ${e.height}`};return new wa(o,this.canvas)}createMaskArbitraryCursorTask(){const{currentCreator:e,cursor:s}=this.drawer.shield;if(e.category===_e.freedom){const n={point:s.value,type:ve.cursor,radius:es};return new Zt(n,this.canvas)}}_getEditingTextElement(){const{isEditingEmpty:e,editingElements:s}=this.drawer.shield.store;if(e)return null;const n=s[0];return n instanceof Ke?n:null}createTextElementCursorTask(){const e=this._getEditingTextElement();return e&&e.isCursorVisible?new Aa(e,this.canvas):null}createTextElementSelectionCursorTasks(){const e=this._getEditingTextElement();return e?e.isSelectionAvailable?[new Vn(e,this.canvas,ds.START),new Vn(e,this.canvas,ds.END)]:[]:[]}createTextElementSelectionTask(){const e=this._getEditingTextElement();return e&&e.isSelectionAvailable?new Oa(e,this.canvas):null}createTextElementsHighlightUndelineTasks(){const e=[];return this.drawer.shield.store.targetElements.forEach(s=>{!s.isSelected&&!s.isEditing&&s instanceof Ke&&e.push(new Ia(s,this.canvas))}),e}createRangeElementCenterIndicatorTask(){if(![ee.MOVING,ee.ROTATING,ee.TRANSFORMING].includes(this.drawer.shield.elementsStatus))return null;const e=this.drawer.shield.selection.rangeElement;if(!e)return null;const{centerCoord:{x:s,y:n}}=e,i={point:{x:s,y:n},type:ve.transformer,radius:es};return new Zt(i,this.canvas)}}class xs extends cn.EventEmitter{constructor(e){super();p(this,"node");p(this,"renderer");p(this,"shield");this.shield=e}initNode(){return this.node=document.createElement("canvas"),this.initStyle(),this.node}initStyle(){this.node.style.position="absolute",this.node.style.top="0",this.node.style.left="0"}updateSize(e){this.node instanceof HTMLCanvasElement?(this.node.width=e.width,this.node.height=e.height):(this.node.style.width=`${e.width}px`,this.node.style.height=`${e.height}px`)}clear(){var e;this.node instanceof HTMLCanvasElement?(e=this.node.getContext("2d"))==null||e.clearRect(0,0,this.node.width,this.node.height):this.node.innerHTML=""}async redraw(e){await this.renderer.redraw(e)}}class Pa extends xs{constructor(t){super(t),this.renderer=new La(this)}initNode(){return super.initNode(),this.node.id="mask",this.node.style.pointerEvents="none",this.node}}class Ai extends Xe{async run(){var t;this.canvas&&((t=this.canvas.getContext("2d"))==null||t.clearRect(0,0,this.canvas.width,this.canvas.height))}}class Ra extends hn{constructor(){super(...arguments);p(this,"_latestElementRendered");p(this,"_latestClearRendered")}async redraw(){let e=new dn([]);const{creatingElements:s}=this.drawer.shield.store;s.length>0&&(s.forEach(n=>{const i=k.createElementTask(n,this.canvas);i&&e.add(i)}),this._latestElementRendered=!0),this._latestClearRendered=e.isEmpty()&&this._latestElementRendered,!e.isEmpty()||this._latestClearRendered?(e.prepend(new Ai(null,this.canvas)),await this.renderCargo(e),this._latestClearRendered&&(this._latestClearRendered=!1)):e=null}}class ka extends xs{constructor(t){super(t),this.renderer=new Ra(this)}initNode(){return super.initNode(),this.node.id="provisional",this.node.style.pointerEvents="none",this.node}}class Fa{constructor(t){p(this,"shield");p(this,"rangeElement");p(this,"_selectionModel");p(this,"_transformerModels",[]);p(this,"_rangeCoords",null);this.shield=t,this.rangeElement=new ln({...k.createEmptyGroupObject()},this.shield,!0),this.rangeElement.status=ie.finished}get isEmpty(){const{isSelectedEmpty:t,isTargetEmpty:e,isRangeEmpty:s}=this.shield.store;return t&&e&&s}get isRange(){return this._rangeCoords!==null&&this._rangeCoords.length>0}get selectionModel(){return this._selectionModel}get transformerModels(){return this._transformerModels}get center(){return null}get internalAngle(){return 0}setRange(t){this._rangeCoords=t,this.refreshRangeElements(this._rangeCoords)}_getElementMaskModelProps(t,e){const{rotateCoords:s,rotateBoxCoords:n,model:{angle:i,isFold:o}}=t;return{points:e?n:s,angle:i,element:{isFold:o}}}_getElementsMaskModels(t,e){const s=[];return t.forEach(n=>{n&&s.push({type:e,...this._getElementMaskModelProps(n)})}),s}_getRangeElementsMaskModels(){return this._getElementsMaskModels(this.shield.store.rangeElements,ve.path)}_getTargetElementsMaskModels(){return this._getElementsMaskModels(this.shield.store.targetElements,ve.path)}_getSelectedElementsMaskModels(){const{store:t}=this.shield;return this._getElementsMaskModels([t.primarySelectedElement||t.creatingElements[0]],ve.path)}getModels(){const t=[];return this.isRange&&t.push(...this._getRangeElementsMaskModels()),t.push(...this._getTargetElementsMaskModels()),t.push(...this._getSelectedElementsMaskModels()),this.isRange&&t.push({points:this._rangeCoords,type:ve.range}),t}calcSelectionModel(){if(this.shield.store.isSelectedEmpty)return;const t=this.shield.store.primarySelectedElement||this.rangeElement;if(t&&t.boxVerticesTransformEnable&&t.model.coords.length>0)return{type:ve.selection,points:t.rotateBoxCoords,angle:t.model.angle}}calcTransformerModels(){if(this.shield.store.isSelectedEmpty)return[];const{primarySelectedElement:t,creatingElements:e}=this.shield.store,s=t||e[0]||this.rangeElement;if(s&&s.transformersEnable&&s.model.coords.length>0){const{transformerType:n,angle:i,leanYAngle:o,actualAngle:a,transformers:l,coordTransformEnable:c,boxVerticesTransformEnable:d,flipX:u,flipY:f}=s;if(c||d)return this.calcTransformerModelsByPoints(l,{angle:i,leanYAngle:o,actualAngle:a,flipX:u,flipY:f},c?n:ct.rect)}return[]}calcTransformerModelsByPoints(t,e,s){return t.map(n=>({point:n,type:ve.transformer,element:{transformerType:s},radius:es,...e}))}clearSelects(){const{store:t}=this.shield;t.deSelectElements(t.selectedElements)}hitTargetElements(t){const{store:e}=this.shield,s=this.getElementOnCoord(t);e.stageElements.forEach(n=>{e.updateElementById(n.id,{isTarget:(s==null?void 0:s.id)===n.id})})}selectTargets(){this.shield.store.updateElements(this.shield.store.targetElements,{isSelected:!0,isTarget:!1})}refreshRangeElements(t){if(t&&t.length){const{store:e}=this.shield;e.stageElements.forEach(s=>{e.updateElementById(s.id,{isInRange:s.isPolygonOverlap(t)})})}}selectRange(){if(this.isRange){const{store:t}=this.shield;t.updateElements(t.rangeElements,{isSelected:!0,isInRange:!1})}}getElementOnCoord(t){const{store:e}=this.shield,s=e.stageElements.filter(n=>n.isDetachedSelected);return k.getElementOnPoint(t,s)||k.getElementOnPoint(t,e.selectedElements)||k.getElementOnPoint(t,e.stageElements)}refreshSelectionModel(){this._selectionModel=this.calcSelectionModel()}refreshTransformerModels(){this._transformerModels=this.calcTransformerModels()}refreshRangeElement(){const t=this.shield.store.selectedElements;if(t.length===0)Object.assign(this.rangeElement.model,k.createEmptyGroupObject());else{if(!this.rangeElement.isRotating&&!this.rangeElement.isTransforming){const e=L.getBoxByPoints(t.map(s=>s.rotateBoxCoords).flat());Object.assign(this.rangeElement.model,{coords:e,boxCoords:V.jsonClone(e),...L.getRect(e),subIds:t.map(s=>s.id),...sn})}this.rangeElement.isTransforming?this.rangeElement.refresh(V.toBooleanObject(["points","size","rotation","angles","outline","strokes"])):this.rangeElement.refresh()}}refresh(){this.refreshRangeElement(),this.refreshSelectionModel(),this.refreshTransformerModels()}tryActiveController(t){if(this.shield.store.isSelectedEmpty)return;const e=this.shield.store.primarySelectedElement||this.rangeElement;if(e){const s=e.getControllerByCoord(t);if(e.setControllersActive(e.controllers.filter(n=>n.id!==(s==null?void 0:s.id)),!1),s)return e.setControllersActive([s],!0),s}}getActiveController(){if(this.shield.store.isSelectedEmpty)return;const t=this.shield.store.primarySelectedElement||this.rangeElement;if(t)return t.getActiveController()}}const Oi="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1735892982581'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='15410'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M552.224%20179.712v664.576l68.704-68.704a36.576%2036.576%200%200%201%2051.712%2051.712l-130.24%20130.208a36.48%2036.48%200%200%201-26.72%2011.648h-0.064-0.032c-9.024%200-17.28-3.264-23.648-8.704l0.064%200.032a36.48%2036.48%200%200%201-4.576-3.872l-129.28-129.312a36.576%2036.576%200%200%201%2051.712-51.712l69.216%2069.216V179.232l-69.216%2069.216a36.576%2036.576%200%200%201-51.712-51.712l129.28-129.28c1.472-1.472%202.976-2.752%204.576-3.904a36.48%2036.48%200%200%201%2050.4%202.944l0.032%200.032%20130.24%20130.208a36.576%2036.576%200%200%201-51.712%2051.712l-68.704-68.704z'%20p-id='15411'%20fill='%232c2c2c'%3e%3c/path%3e%3c/svg%3e",Ba="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1735887761508'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='7589'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M641.264941%20791.853176l42.586353%2042.586353L512%201006.351059l-171.911529-171.91153%2042.586353-42.586353L481.882353%20891.060706v-227.20753h60.235294v227.20753l99.147294-99.20753zM481.882353%20132.939294v227.20753h60.235294V132.939294l99.147294%2099.147294%2042.586353-42.586353L512%2017.648941%20340.088471%20189.500235l42.586353%2042.586353L481.882353%20132.939294zM0%20481.882353v60.235294h1024V481.882353H0z'%20fill='%232c2c2c'%20p-id='7590'%3e%3c/path%3e%3c/svg%3e",Ii="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1737787540457'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1497'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M870.4%20204.8c-18.6368%200-36.1472%205.0176-51.2%2013.7728l0-64.9728c0-56.4736-45.9264-102.4-102.4-102.4-21.0944%200-40.6528%206.4-56.9856%2017.3568-14.0288-39.8848-52.0192-68.5568-96.6144-68.5568s-82.6368%2028.672-96.6144%2068.5568c-16.2816-10.9568-35.8912-17.3568-56.9856-17.3568-56.4736%200-102.4%2045.9264-102.4%20102.4l0%20377.4976-68.9152-119.4496c-13.3632-24.32-35.1744-41.6256-61.3888-48.7936-25.5488-6.9632-52.1216-3.2768-74.8544%2010.3424-46.4384%2027.8528-64.1536%2090.8288-39.424%20140.3904%201.536%203.1232%2034.2016%2070.0416%20136.192%20273.92%2048.0256%2096%20100.7104%20164.6592%20156.6208%20203.9808%2043.8784%2030.8736%2074.1888%2032.4608%2079.8208%2032.4608l256%200c43.5712%200%2084.0704-14.1824%20120.4224-42.0864%2034.1504-26.2656%2063.7952-64.256%2088.064-112.8448%2047.8208-95.6416%2073.1136-227.9424%2073.1136-382.6688l0-179.2c0-56.4736-45.9264-102.4-102.4-102.4zM921.6%20486.4c0%20146.7904-23.3984%20271.1552-67.6864%20359.7312-28.8768%2057.7536-80.5888%20126.6688-162.7136%20126.6688l-255.488%200c-1.9968-0.1536-23.552-2.56-56.064-26.88-32.4096-24.2688-82.176-75.3664-135.0656-181.248-103.7824-207.5648-135.68-272.9472-135.9872-273.5616-0.0512-0.1024-0.0512-0.1536-0.1024-0.2048-12.8512-25.7536-3.7376-59.4944%2019.9168-73.6768%2010.6496-6.4%2023.0912-8.0896%2035.072-4.864%2012.7488%203.4816%2023.4496%2012.0832%2030.0544%2024.1664%200.1024%200.1536%200.2048%200.3584%200.3072%200.512l79.9232%20138.496c16.3328%2029.8496%2034.7136%2042.3936%2054.6304%2037.3248%2019.968-5.0688%2030.0544-25.0368%2030.0544-59.2384l0-400.0256c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20332.8c0%2014.1312%2011.4688%2025.6%2025.6%2025.6s25.6-11.4688%2025.6-25.6l0-384c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20384c0%2014.1312%2011.4688%2025.6%2025.6%2025.6s25.6-11.4688%2025.6-25.6l0-332.8c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20384c0%2014.1312%2011.4688%2025.6%2025.6%2025.6s25.6-11.4688%2025.6-25.6l0-230.4c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20179.2z'%20fill='%23000000'%20p-id='1498'%3e%3c/path%3e%3c/svg%3e",Li="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1736172747971'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='4849'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M512%200a36.571429%2036.571429%200%200%201%2036.571429%2036.571429v950.857142a36.571429%2036.571429%200%200%201-73.142858%200V36.571429A36.571429%2036.571429%200%200%201%20512%200z'%20fill='%23000000'%20p-id='4850'%3e%3c/path%3e%3cpath%20d='M0%20509.074286a36.571429%2036.571429%200%200%201%2036.571429-36.571429h950.857142a36.571429%2036.571429%200%200%201%200%2073.142857H36.571429a36.571429%2036.571429%200%200%201-36.571429-36.571428z'%20fill='%23000000'%20p-id='4851'%3e%3c/path%3e%3c/svg%3e",Da="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1737790480190'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='8613'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M550.034286%20633.904762v154.331428l58.392381-56.661333%2050.95619%2052.46781-144.505905%20140.288-147.065904-140.01981%2050.419809-52.979809%2058.684953%2055.832381-0.024381-153.283048h73.142857z%20m234.008381-269.287619l140.288%20144.505905-140.01981%20147.065904-52.979809-50.419809%2055.832381-58.684953H633.904762v-73.142857h154.331428l-56.661333-58.368%2052.46781-50.95619z%20m-544.231619%200l52.467809%2050.95619-56.685714%2058.368H390.095238v73.142857H236.690286l55.832381%2058.684953-52.955429%2050.419809-140.019809-147.065904%20140.263619-144.505905zM514.876952%2099.669333l144.505905%20140.288-50.95619%2052.46781-58.368-56.661333L550.034286%20390.095238h-73.142857V236.81219l-58.660572%2055.832381-50.419809-52.979809%20147.065904-140.01981z'%20p-id='8614'%3e%3c/path%3e%3c/svg%3e",Ma="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1740288855242'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='38476'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M679.338667%20849.152a4.266667%204.266667%200%200%200%206.656%200l161.792-202.24a4.266667%204.266667%200%200%200-3.328-6.912H736v-32a320%20320%200%200%200-320-320H384V179.541333a4.266667%204.266667%200%200%200-6.912-3.328l-202.24%20161.792a4.266667%204.266667%200%200%200%200%206.656l202.24%20161.792A4.266667%204.266667%200%200%200%20384%20503.125333V394.666667h32a213.333333%20213.333333%200%200%201%20213.333333%20213.333333V640h-108.458666a4.266667%204.266667%200%200%200-3.328%206.912l161.792%20202.24z'%20fill='%23000000'%20p-id='38477'%3e%3c/path%3e%3cpath%20d='M685.994667%20849.152l-13.312-10.666667%2013.312%2010.666667z%20m-6.656%200l13.312-10.666667-13.312%2010.666667z%20m168.448-202.24l-13.312-10.666667%2013.312%2010.666667zM736%20640v17.066667h-17.066667V640h17.066667zM384%20288v17.066667h-17.066667v-17.066667H384z%20m-6.912-111.786667l10.666667%2013.312-10.666667-13.312z%20m-202.24%20161.792l10.666667%2013.312-10.666667-13.312z%20m0%206.656l-10.666667%2013.312%2010.666667-13.312z%20m202.24%20161.792l10.666667-13.312-10.666667%2013.312zM384%20394.666667h-17.066667v-17.066667H384v17.066667zM629.333333%20640h17.066667v17.066667h-17.066667V640z%20m-111.786666%206.912l-13.312%2010.666667%2013.312-10.666667z%20m181.76%20212.906667a21.333333%2021.333333%200%200%201-33.28%200l26.624-21.333334a12.8%2012.8%200%200%200-19.968%200l26.624%2021.333334z%20m161.792-202.24l-161.792%20202.24-26.624-21.333334%20161.792-202.24%2026.624%2021.333334z%20m-16.64-34.645334a21.333333%2021.333333%200%200%201%2016.64%2034.645334l-26.624-21.333334a12.8%2012.8%200%200%200%209.984%2020.821334v-34.133334z%20m-108.458667%200h108.458667v34.133334H736v-34.133334z%20m-17.066667%2017.066667v-32h34.133334V640h-34.133334z%20m0-32a302.933333%20302.933333%200%200%200-302.933333-302.933333v-34.133334a337.066667%20337.066667%200%200%201%20337.066667%20337.066667h-34.133334z%20m-302.933333-302.933333H384v-34.133334h32v34.133334zM401.066667%20179.541333V288h-34.133334V179.541333h34.133334z%20m-34.645334-16.64a21.333333%2021.333333%200%200%201%2034.645334%2016.64h-34.133334a12.8%2012.8%200%200%200%2020.778667%209.984l-21.333333-26.624zM164.181333%20324.693333l202.24-161.792%2021.333334%2026.624-202.24%20161.792-21.333334-26.624z%20m0%2033.28a21.333333%2021.333333%200%200%201%200-33.28l21.333334%2026.624a12.8%2012.8%200%200%200%200-19.968l-21.333334%2026.624z%20m202.24%20161.792L164.181333%20357.973333l21.333334-26.624%20202.24%20161.792-21.333334%2026.624z%20m34.645334-16.64a21.333333%2021.333333%200%200%201-34.645334%2016.64l21.333334-26.624a12.8%2012.8%200%200%200-20.821334%209.984h34.133334z%20m0-108.458666v108.458666h-34.133334V394.666667h34.133334z%20m-17.066667-17.066667h32v34.133333H384v-34.133333z%20m32%200a230.4%20230.4%200%200%201%20230.4%20230.4h-34.133333a196.266667%20196.266667%200%200%200-196.266667-196.266667v-34.133333z%20m230.4%20230.4V640h-34.133333v-32h34.133333z%20m-125.525333%2014.933333h108.458666v34.133334h-108.458666v-34.133334z%20m-16.64%2034.645334a21.333333%2021.333333%200%200%201%2016.64-34.645334v34.133334a12.8%2012.8%200%200%200%209.984-20.778667l-26.624%2021.333333z%20m161.792%20202.24l-161.792-202.24%2026.624-21.333334%20161.792%20202.24-26.624%2021.333334z'%20fill='%23FFFFFF'%20p-id='38478'%3e%3c/path%3e%3c/svg%3e";class Rt extends rt{constructor(e,s,n){super(e,s);p(this,"type",Fe.vertices);this.type=n}get img(){switch(this.type){case Fe.vertices:return Oi;case Fe.border:return Ba;case Fe.hand:return Ii;case Fe.cross:return Li;case Fe.move:return Da;case Fe.rotation:return Ma}}async run(){if(!this.canvas||!this.model)return;let{point:{x:e,y:s},width:n,height:i}=this.model;await G.drawImgLike(this.canvas,this.img,{x:(e-n/G.scale/2)*G.scale,y:(s-i/G.scale/2)*G.scale,width:n,height:i},{angle:this.model.angle})}}class Na{constructor(t){p(this,"value");p(this,"shield");this.shield=t,this.value=null}get worldValue(){return this.value?k.calcWorldCoord(this.value):null}clear(){this.value=null}transform(t){return re.stageParams.rect?(this.value=L.getEventPosition(t,re.stageParams.rect,re.stageParams.scale),this.value.x=Math.round(this.value.x),this.value.y=Math.round(this.value.y),this.value):{x:0,y:0}}setStyle(t){this.shield.node.style.cursor=t}updateStyle(t){this.shield.selection.getActiveController()||this.shield.isDrawerActive||this.shield.isTextCreating?this.setStyle("none"):this.shield.isHandActive?this.setStyle("grab"):this.shield.isTextEditing&&this.shield.store.editingElements.some(e=>e.isContainsCoord(this.worldValue))?this.setStyle("text"):this.setStyle("default")}getTask(){if(this.shield.isDrawerActive||this.shield.isTextCreating)return this.createMaskDrawingCursorTask();if(this.shield.isMoveableActive){const t=this.shield.selection.getActiveController();if(t instanceof Ei)return this.createMaskRotationControllerCursorTask(t);if(t instanceof $t||t instanceof cs)return this.createMaskRotationCursorTask(t);if(t instanceof _t)return this.createMaskTransformerCursorTask(t);if(t instanceof Ht)return this.createMaskBorderTransformerCursorTask(t)}}createMaskDrawingCursorTask(){if(this.value)return new Rt(this._createTransformerCursorModel(),this.shield.mask.node,Fe.cross)}createMaskRotationCursorTask(t){if(this.value)return new Rt(this._createTransformerCursorModel({angle:t.angle}),this.shield.mask.node,Fe.move)}createMaskRotationControllerCursorTask(t){if(this.value)return new Rt(this._createTransformerCursorModel({angle:t.angle}),this.shield.mask.node,Fe.rotation)}createMaskBorderTransformerCursorTask(t){if(this.value)return new Rt(this._createTransformerCursorModel(t),this.shield.mask.node,Fe.border)}createMaskTransformerCursorTask(t){if(this.value)return new Rt(this._createTransformerCursorModel(t),this.shield.mask.node,Fe.vertices)}_createTransformerCursorModel(t){return{point:this.value,type:ve.cursor,width:Pn,height:Pn,angle:(t==null?void 0:t.angle)||0}}}class ye{static stopPP(t){t.stopPropagation(),t.preventDefault()}}var Pi=function(){if(typeof Map<"u")return Map;function r(t,e){var s=-1;return t.some(function(n,i){return n[0]===e?(s=i,!0):!1}),s}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(e){var s=r(this.__entries__,e),n=this.__entries__[s];return n&&n[1]},t.prototype.set=function(e,s){var n=r(this.__entries__,e);~n?this.__entries__[n][1]=s:this.__entries__.push([e,s])},t.prototype.delete=function(e){var s=this.__entries__,n=r(s,e);~n&&s.splice(n,1)},t.prototype.has=function(e){return!!~r(this.__entries__,e)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,s){s===void 0&&(s=null);for(var n=0,i=this.__entries__;n<i.length;n++){var o=i[n];e.call(s,o[1],o[0])}},t}()}(),$s=typeof window<"u"&&typeof document<"u"&&window.document===document,hs=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),Va=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(hs):function(r){return setTimeout(function(){return r(Date.now())},1e3/60)}}(),Ha=2;function Wa(r,t){var e=!1,s=!1,n=0;function i(){e&&(e=!1,r()),s&&a()}function o(){Va(i)}function a(){var l=Date.now();if(e){if(l-n<Ha)return;s=!0}else e=!0,s=!1,setTimeout(o,t);n=l}return a}var za=20,ja=["top","right","bottom","left","width","height","size","weight"],Ga=typeof MutationObserver<"u",$a=function(){function r(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=Wa(this.refresh.bind(this),za)}return r.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},r.prototype.removeObserver=function(t){var e=this.observers_,s=e.indexOf(t);~s&&e.splice(s,1),!e.length&&this.connected_&&this.disconnect_()},r.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},r.prototype.updateObservers_=function(){var t=this.observers_.filter(function(e){return e.gatherActive(),e.hasActive()});return t.forEach(function(e){return e.broadcastActive()}),t.length>0},r.prototype.connect_=function(){!$s||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),Ga?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},r.prototype.disconnect_=function(){!$s||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},r.prototype.onTransitionEnd_=function(t){var e=t.propertyName,s=e===void 0?"":e,n=ja.some(function(i){return!!~s.indexOf(i)});n&&this.refresh()},r.getInstance=function(){return this.instance_||(this.instance_=new r),this.instance_},r.instance_=null,r}(),Ri=function(r,t){for(var e=0,s=Object.keys(t);e<s.length;e++){var n=s[e];Object.defineProperty(r,n,{value:t[n],enumerable:!1,writable:!1,configurable:!0})}return r},xt=function(r){var t=r&&r.ownerDocument&&r.ownerDocument.defaultView;return t||hs},ki=Ss(0,0,0,0);function us(r){return parseFloat(r)||0}function Hn(r){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return t.reduce(function(s,n){var i=r["border-"+n+"-width"];return s+us(i)},0)}function Ya(r){for(var t=["top","right","bottom","left"],e={},s=0,n=t;s<n.length;s++){var i=n[s],o=r["padding-"+i];e[i]=us(o)}return e}function Ua(r){var t=r.getBBox();return Ss(0,0,t.width,t.height)}function Xa(r){var t=r.clientWidth,e=r.clientHeight;if(!t&&!e)return ki;var s=xt(r).getComputedStyle(r),n=Ya(s),i=n.left+n.right,o=n.top+n.bottom,a=us(s.width),l=us(s.height);if(s.boxSizing==="border-box"&&(Math.round(a+i)!==t&&(a-=Hn(s,"left","right")+i),Math.round(l+o)!==e&&(l-=Hn(s,"top","bottom")+o)),!Ja(r)){var c=Math.round(a+i)-t,d=Math.round(l+o)-e;Math.abs(c)!==1&&(a-=c),Math.abs(d)!==1&&(l-=d)}return Ss(n.left,n.top,a,l)}var qa=function(){return typeof SVGGraphicsElement<"u"?function(r){return r instanceof xt(r).SVGGraphicsElement}:function(r){return r instanceof xt(r).SVGElement&&typeof r.getBBox=="function"}}();function Ja(r){return r===xt(r).document.documentElement}function Ka(r){return $s?qa(r)?Ua(r):Xa(r):ki}function Qa(r){var t=r.x,e=r.y,s=r.width,n=r.height,i=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,o=Object.create(i.prototype);return Ri(o,{x:t,y:e,width:s,height:n,top:e,right:t+s,bottom:n+e,left:t}),o}function Ss(r,t,e,s){return{x:r,y:t,width:e,height:s}}var Za=function(){function r(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=Ss(0,0,0,0),this.target=t}return r.prototype.isActive=function(){var t=Ka(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},r.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},r}(),el=function(){function r(t,e){var s=Qa(e);Ri(this,{target:t,contentRect:s})}return r}(),tl=function(){function r(t,e,s){if(this.activeObservations_=[],this.observations_=new Pi,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=e,this.callbackCtx_=s}return r.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof xt(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new Za(t)),this.controller_.addObserver(this),this.controller_.refresh())}},r.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof xt(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},r.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},r.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(e){e.isActive()&&t.activeObservations_.push(e)})},r.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map(function(s){return new el(s.target,s.broadcastRect())});this.callback_.call(t,e,t),this.clearActive()}},r.prototype.clearActive=function(){this.activeObservations_.splice(0)},r.prototype.hasActive=function(){return this.activeObservations_.length>0},r}(),Fi=typeof WeakMap<"u"?new WeakMap:new Pi,Bi=function(){function r(t){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var e=$a.getInstance(),s=new tl(t,e,this);Fi.set(this,s)}return r}();["observe","unobserve","disconnect"].forEach(function(r){Bi.prototype[r]=function(){var t;return(t=Fi.get(this))[r].apply(t,arguments)}});var sl=function(){return typeof hs.ResizeObserver<"u"?hs.ResizeObserver:Bi}();const nl=typeof window>"u",il=function(r){for(const t of r){const e=t.target.__resizeListeners__||[];e.length&&e.forEach(s=>{s(t)})}};class rl{static addListener(t,e){nl||t&&(t.__resizeListeners__||(t.__resizeListeners__=[],t.__ro__=new sl(il),t.__ro__.observe(t)),t.__resizeListeners__.push(e))}static removeListener(t,e){!t||!t.__resizeListeners__||(t.__resizeListeners__.splice(t.__resizeListeners__.indexOf(e),1),t.__resizeListeners__.length||t.__ro__.disconnect())}}var Ge={},Wn;function ol(){if(Wn)return Ge;Wn=1,Object.defineProperty(Ge,"__esModule",{value:!0});for(var r=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),t={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},e={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:r?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},s={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},n=1;n<20;n++)s["f"+n]=111+n;function i(f,g,C){g&&!("byKey"in g)&&(C=g,g=null),Array.isArray(f)||(f=[f]);var y=f.map(function(F){return l(F,g)}),E=function(N){return y.some(function(w){return c(w,N)})},b=C==null?E:E(C);return b}function o(f,g){return i(f,g)}function a(f,g){return i(f,{byKey:!0},g)}function l(f,g){var C=g&&g.byKey,y={};f=f.replace("++","+add");var E=f.split("+"),b=E.length;for(var F in t)y[t[F]]=!1;var N=!0,w=!1,v=void 0;try{for(var P=E[Symbol.iterator](),D;!(N=(D=P.next()).done);N=!0){var M=D.value,J=M.endsWith("?")&&M.length>1;J&&(M=M.slice(0,-1));var K=u(M),ge=t[K];if(M.length>1&&!ge&&!e[M]&&!s[K])throw new TypeError('Unknown modifier: "'+M+'"');(b===1||!ge)&&(C?y.key=K:y.which=d(M)),ge&&(y[ge]=J?null:!0)}}catch(Ie){w=!0,v=Ie}finally{try{!N&&P.return&&P.return()}finally{if(w)throw v}}return y}function c(f,g){for(var C in f){var y=f[C],E=void 0;if(y!=null&&(C==="key"&&g.key!=null?E=g.key.toLowerCase():C==="which"?E=y===91&&g.which===93?91:g.which:E=g[C],!(E==null&&y===!1)&&E!==y))return!1}return!0}function d(f){f=u(f);var g=s[f]||f.toUpperCase().charCodeAt(0);return g}function u(f){return f=f.toLowerCase(),f=e[f]||f,f}return Ge.default=i,Ge.isHotkey=i,Ge.isCodeHotkey=o,Ge.isKeyHotkey=a,Ge.parseHotkey=l,Ge.compareHotkey=c,Ge.toKeyCode=d,Ge.toKeyName=u,Ge}var al=ol();const be=_r(al);class yt{static getImageDataFromClipboard(t){return new Promise((e,s)=>{var a;const n=(a=t.clipboardData)==null?void 0:a.items;if(!n)return console.warn("No clipboard data"),s();const i=Array.from(n).filter(l=>l.type.startsWith("image/"));if(!i.length)return console.warn("No image in clipboard"),s();const o=Promise.all(i.map(l=>{const c=l.getAsFile();if(!c){console.warn("No blob in clipboard"),s();return}return G.getImageDataFromBlob(c)}));e(o)})}static getImageDataFromFileTransfer(t){return new Promise((e,s)=>{var i;const n=(i=t.dataTransfer)==null?void 0:i.files;if(!n)return console.warn("No files in drag event"),s();yt.parseImageFiles(Array.from(n),e,s)})}static getImageDataFromFiles(t){return new Promise((e,s)=>yt.parseImageFiles(t,e,s))}static parseImageFiles(t,e,s){const n=Array.from(t).filter(o=>o.type.startsWith("image/"));if(!n.length)return console.warn("No image in files"),s();const i=Promise.all(n.map(o=>G.getImageDataFromBlob(o)));e(i)}}class ll extends cn.EventEmitter{constructor(e){super();p(this,"shield");p(this,"_isCtrl");p(this,"_isCtrlWheel");p(this,"_isShift");p(this,"_isCtrlEvent");p(this,"_isCtrlPlusEvent");p(this,"_isCtrlReduceEvent");p(this,"_isCtrl0Event");p(this,"_isCtrlAEvent");p(this,"_isCtrlMEvent");p(this,"_isCtrlHEvent");p(this,"_isCtrlGEvent");p(this,"_isCtrlCEvent");p(this,"_isCtrlZEvent");p(this,"_isCtrlYEvent");p(this,"_isCtrlShiftGEvent");p(this,"_isShiftEvent");p(this,"_isShift1Event");p(this,"_isDeleteEvent");p(this,"_isEscEvent");this.shield=e}get isCtrl(){return this._isCtrl}get isOnlyCtrl(){return this._isCtrl&&!this._isShift}get isCtrlWheel(){return this._isCtrlWheel}get isShift(){return this._isShift}get isOnlyShift(){return this._isShift&&!this._isCtrl}init(){this._isCtrl=!1,this._isCtrlWheel=!1,this._isCtrlEvent=be("ctrl"),this._isCtrlPlusEvent=be("ctrl+="),this._isCtrlReduceEvent=be("ctrl+-"),this._isCtrl0Event=be("ctrl+0"),this._isShiftEvent=be("shift"),this._isShift1Event=be("shift+1"),this._isDeleteEvent=be("backspace"),this._isCtrlAEvent=be("ctrl+a"),this._isCtrlMEvent=be("ctrl+m"),this._isCtrlHEvent=be("ctrl+h"),this._isCtrlGEvent=be("ctrl+g"),this._isCtrlCEvent=be("ctrl+c"),this._isCtrlZEvent=be("ctrl+z"),this._isCtrlYEvent=be("ctrl+y"),this._isCtrlShiftGEvent=be("ctrl+shift+g"),this._isEscEvent=be("esc"),this.initEvents()}async initEvents(){Promise.all([this.initRenderResizeEvent(),this.initMouseEvents()])}_isInputEvent(e){return e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement}async initRenderResizeEvent(){rl.addListener(this.shield.renderEl,e=>{this.emit("resize",e)})}async _createImages(e){if(e&&e.length)return new Promise(s=>{this.emit("pasteImages",e,async()=>{s()})})}async initMouseEvents(){this.shield.node.addEventListener("mousemove",e=>{this.emit("cursorMove",e)}),this.shield.node.addEventListener("mouseleave",e=>{this.emit("cursorLeave",e)}),this.shield.node.addEventListener("mousedown",e=>{this.emit("pressDown",e)}),this.shield.node.addEventListener("mouseup",e=>{this.emit("pressUp",e)}),this.shield.node.addEventListener("dblclick",e=>{this.emit("dblClick",e)}),this.shield.node.addEventListener("wheel",e=>{ye.stopPP(e),this._isCtrlWheel=this._isCtrl,this._isCtrlWheel?this.emit("wheelScale",-e.deltaY/2e3,e):this.emit("wheelMove",{x:e.deltaX,y:e.deltaY},e)}),this.shield.node.addEventListener("dragover",e=>{ye.stopPP(e)}),this.shield.node.addEventListener("drop",e=>{ye.stopPP(e),yt.getImageDataFromFileTransfer(e).then(s=>{this._createImages(s)}).catch(s=>{s&&console.warn(s)})}),document.addEventListener("keydown",e=>{this._isCtrl=this._isCtrlEvent(e),this._isInputEvent(e)||(this._isCtrlPlusEvent(e)&&(ye.stopPP(e),this.emit("scaleIncrease")),this._isCtrlReduceEvent(e)&&(ye.stopPP(e),this.emit("scaleReduce")),this._isCtrl0Event(e)&&(ye.stopPP(e),this.emit("scale100")),this._isShift1Event(e)?(ye.stopPP(e),this.emit("scaleAutoFit")):this._isShiftEvent(e)?this._isShift=!0:this._isShift=!1,this._isDeleteEvent(e)&&(ye.stopPP(e),this.emit("deleteSelects")),this._isCtrlAEvent(e)&&(ye.stopPP(e),this.emit("selectAll")),this._isCtrlMEvent(e)&&(ye.stopPP(e),this.emit("selectMoveableCreator")),this._isCtrlHEvent(e)&&(ye.stopPP(e),this.emit("selectHandCreator")),this._isCtrlGEvent(e)&&(ye.stopPP(e),this.emit("groupAdd")),this._isCtrlCEvent(e)&&(ye.stopPP(e),this.emit("selectCopy",e)),this._isCtrlZEvent(e)&&(ye.stopPP(e),this.emit("undo")),this._isCtrlYEvent(e)&&(ye.stopPP(e),this.emit("redo")),this._isCtrlShiftGEvent(e)&&(ye.stopPP(e),this.emit("groupRemove")),this._isEscEvent(e)&&(ye.stopPP(e),this.emit("cancel")))}),document.addEventListener("keyup",e=>{this._isCtrl=e.ctrlKey,this._isShift=e.shiftKey}),document.addEventListener("paste",e=>{this._isInputEvent(e)||yt.getImageDataFromClipboard(e).then(s=>{this._createImages(s)}).catch(s=>{s&&console.warn(s);try{const n=JSON.parse(e.clipboardData.getData("text/plain"));n&&this.emit("pasteElements",n)}catch(n){n&&console.warn(n)}})})}async onImagesUpload(e){if(e.length){const s=await yt.getImageDataFromFiles(e);await this._createImages(s)}}}class cl extends hn{constructor(){super(...arguments);p(this,"_lastestStageElementsSize",0)}async redraw(e){const{stageElements:s}=this.drawer.store;if(e||s.length!==this._lastestStageElementsSize){this._lastestStageElementsSize=s.length;const n=new dn([]);n.add(new Ai(null,this.canvas)),s.forEach(i=>{const o=k.createElementTask(i,this.canvas);o&&n.add(o)}),await this.renderCargo(n)}}}const zn={rotationIconEnable:!0};class dl{constructor(){p(this,"_configs",zn);this.config(zn),Cr({enforceActions:"never"})}get rotationIconEnable(){return this._configs.rotationIconEnable}config(t){Object.assign(this._configs,t)}}class hl{constructor(t){p(this,"shield");this.shield=t}_getElementsCoordsRect(t){return L.getRect(t.map(e=>this._getElementAlignCoords(e)).flat())}_calcElementsAllWidth(t){let e=0;return t.forEach(s=>{const n=L.getRect(this._getElementAlignCoords(s));e+=n.width}),e}_calcElementsAllHeight(t){let e=0;return t.forEach(s=>{const n=L.getRect(this._getElementAlignCoords(s));e+=n.height}),e}_sortElementsByX(t){return R.sortBy(t,e=>L.getRect(this._getElementAlignCoords(e)).x)}_sortElementsByXW(t){return R.sortBy(t,e=>{const{x:s,width:n}=L.getRect(this._getElementAlignCoords(e));return s+n})}_sortElementsByY(t){return R.sortBy(t,e=>L.getRect(this._getElementAlignCoords(e)).y)}_sortElementsByYH(t){return R.sortBy(t,e=>{const{y:s,height:n}=L.getRect(this._getElementAlignCoords(e));return s+n})}_getElementAlignCoords(t){return this.shield.event.isShift?t.alignOutlineCoords.flat():t.alignCoords}_setElementPositionByOffset(t,e,s){const n={x:e,y:s};t.setPosition(t.model.x+e,t.model.y+s,n),t.isGroup&&!t.isGroupSubject&&t.deepSubs.forEach(i=>{i.setPosition(i.model.x+e,i.model.y+s,n)})}setElementsAlignLeft(t){t=k.getNonHomologousElements(t);const{x:e}=this._getElementsCoordsRect(t);t.forEach(s=>{const{x:n}=L.getRect(this._getElementAlignCoords(s)),i=e-n;i!==0&&this._setElementPositionByOffset(s,i,0)})}setElementsAlignRight(t){t=k.getNonHomologousElements(t);const{x:e,width:s}=this._getElementsCoordsRect(t);t.forEach(n=>{const{x:i,width:o}=L.getRect(this._getElementAlignCoords(n)),a=e+s-i-o;a!==0&&this._setElementPositionByOffset(n,a,0)})}setElementsAlignTop(t){t=k.getNonHomologousElements(t);const{y:e}=this._getElementsCoordsRect(t);t.forEach(s=>{const{y:n}=L.getRect(this._getElementAlignCoords(s)),i=e-n;i!==0&&this._setElementPositionByOffset(s,0,i)})}setElementsAlignBottom(t){t=k.getNonHomologousElements(t);const{y:e,height:s}=this._getElementsCoordsRect(t);t.forEach(n=>{const{y:i,height:o}=L.getRect(this._getElementAlignCoords(n)),a=e+s-i-o;a!==0&&this._setElementPositionByOffset(n,0,a)})}setElementsAlignCenter(t){t=k.getNonHomologousElements(t);const{x:e,width:s}=this._getElementsCoordsRect(t);t.forEach(n=>{const{x:i,width:o}=L.getRect(this._getElementAlignCoords(n)),a=e+s/2-(i+o/2);a!==0&&this._setElementPositionByOffset(n,a,0)})}setElementsAlignMiddle(t){t=k.getNonHomologousElements(t);const{y:e,height:s}=this._getElementsCoordsRect(t);t.forEach(n=>{const{y:i,height:o}=L.getRect(this._getElementAlignCoords(n)),a=e+s/2-(i+o/2);a!==0&&this._setElementPositionByOffset(n,0,a)})}setElementsAverageVertical(t){t=k.getNonHomologousElements(t),t=this._sortElementsByY(t);const{y:e,height:s}=this._getElementsCoordsRect(t),n=L.getRect(this._getElementAlignCoords(t[0]));let i=e+n.height;const o=this._calcElementsAllHeight(t),a=(s-o)/(t.length-1);t=this._sortElementsByYH(t.slice(1)),t.forEach((l,c)=>{if(c!==t.length-1){const{y:d,height:u}=L.getRect(this._getElementAlignCoords(l)),f=i+a-d;f!==0&&this._setElementPositionByOffset(l,0,f),i=d+f+u}})}setElementsAverageHorizontal(t){t=k.getNonHomologousElements(t),t=this._sortElementsByX(t);const{x:e,width:s}=this._getElementsCoordsRect(t),n=L.getRect(this._getElementAlignCoords(t[0]));let i=e+n.width;const o=this._calcElementsAllWidth(t),a=(s-o)/(t.length-1);t=this._sortElementsByXW(t.slice(1)),t.forEach((l,c)=>{if(c!==t.length-1){const{x:d,width:u}=L.getRect(this._getElementAlignCoords(l)),f=i+a-d;f!==0&&this._setElementPositionByOffset(l,f,0),i=d+f+u}})}}const jn=100,Gn=20;class ul extends xs{constructor(){super(...arguments);p(this,"textEditor");p(this,"textCursorEditor");p(this,"_textEditorPosition");p(this,"_textEditorUpdateId");p(this,"_prevTextCursorKeycode",-1);p(this,"_prevTextCursorCtrlKey",!1);p(this,"_prevTextCursorShiftKey",!1)}initNode(){return this.node=document.createElement("div"),this.node.id="html-drawer",this.initStyle(),this._initStyleSheet(),this.node}updateSize(e){const{width:s,height:n}=e,i=re.stageParams.scale;Object.assign(this.node.style,{width:`${s/i}px`,height:`${n/i}px`,transform:`scale(${i})`})}createTextInput(e){if(this.textEditor)return this.textEditor;const s=this._createInputElement(e);return this._addInputEvents(s),this.node.appendChild(s),setTimeout(()=>{s.setSelectionRange(0,0),s.focus()},0),this.textEditor=s,s}createTextCursorInput(){if(!this.textCursorEditor){const e=document.createElement("textarea");e.id="text-cursor-editor",this._addCursorInputEvents(e),this.node.appendChild(e),this.textCursorEditor=e}return this._resetTextCursorInput(),this.textCursorEditor}_resetTextCursorInput(){this.textCursorEditor&&(this.textCursorEditor.value="",this._textEditorUpdateId=L.getRandomId())}focusTextCursorInput(){this.textCursorEditor&&this.textCursorEditor.focus()}_initStyleSheet(){const e=document.createElement("style");e.innerHTML=`
        #html-drawer {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            transform-origin: top left;
        }
        #html-drawer textarea {
            position: absolute;
            top: 0;
            left: 0;
            min-width: 0;
            min-height: 0;
            overflow: visible;
            padding: 0;
            margin: 0;
            border: none;
            outline: none;
            resize: none;
            word-break: break-word;
            white-space: pre;
            pointer-events: auto;
            background: transparent;
            caret-color: #000;
            color: #000;
            font-variant-ligatures: discretionary-ligatures;
        }
        #html-drawer textarea::-webkit-scrollbar {
            display: none;
        }
        #html-drawer textarea {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        #text-cursor-editor {
          position: absolute;
          top: 0;
          left: 0;
          width: 0;
          height: 0;
          caret-color: transparent;
        }
    `,document.head.appendChild(e)}_updateInputStyleWhileInputing(){let{width:e,height:s}=yi.measureTextWithSpan(this.textEditor.value,$e);e=Math.max(e,jn),s=Math.max(s,Gn,Math.ceil(this.textEditor.value.split(`
`).length*$e.fontLineHeight)),Object.assign(this.textEditor.style,{minWidth:`${e}px`,minHeight:`${s}px`})}_addInputEvents(e){e.addEventListener("blur",()=>{this.textEditor.value&&this.emit("textInput",this.textEditor.value,$e,{width:e.offsetWidth,height:e.offsetHeight},this._textEditorPosition),this.textEditor.remove(),this.textEditor=null}),e.addEventListener("keydown",s=>{s.key==="Enter"&&this._updateInputStyleWhileInputing()}),e.addEventListener("input",()=>{this._updateInputStyleWhileInputing()}),e.addEventListener("paste",s=>{try{ye.stopPP(s);const n=s.clipboardData.getData("text/plain");document.execCommand("insertText",!1,n.replaceAll("	"," ".repeat(4)))}catch(n){console.error(n)}})}_emitTextCursorUpdate(){this.emit("textUpdate",this.textCursorEditor.value,{keyCode:this._prevTextCursorKeycode,ctrlKey:this._prevTextCursorCtrlKey,shiftKey:this._prevTextCursorShiftKey,updateId:this._textEditorUpdateId})}_addCursorInputEvents(e){e.addEventListener("keydown",s=>{const{keyCode:n,ctrlKey:i,shiftKey:o}=s;this._prevTextCursorKeycode=n,this._prevTextCursorCtrlKey=i,this._prevTextCursorShiftKey=o,(ce.isDeleterKey(n)||ce.isArrowLeft(n)||ce.isArrowRight(n)||ce.isArrowUp(n)||ce.isArrowDown(n)||ce.isEnter(n)||i&&ce.isA(n)||i&&ce.isX(n)||i&&ce.isC(n)||i&&ce.isZ(n)||i&&ce.isY(n))&&(ye.stopPP(s),this._resetTextCursorInput(),this._emitTextCursorUpdate(),requestAnimationFrame(()=>{this.focusTextCursorInput()}))}),e.addEventListener("paste",s=>{ye.stopPP(s);const n=s.clipboardData.getData("text/plain");this.textCursorEditor.value=n.replaceAll("	"," ".repeat(4)),this._prevTextCursorKeycode=86,this._emitTextCursorUpdate(),this._resetTextCursorInput(),requestAnimationFrame(()=>{this.focusTextCursorInput()})}),e.addEventListener("input",()=>{this._emitTextCursorUpdate()}),e.addEventListener("compositionstart",()=>{this._resetTextCursorInput()}),e.addEventListener("compositionend",()=>{this.emit("textUpdate","",{compositionType:Qs.END}),requestAnimationFrame(()=>{this.focusTextCursorInput()})})}_createInputElement(e){this._textEditorPosition=e;const s=1/re.stageParams.scale,n=document.createElement("textarea");return Object.assign(n.style,{top:`${e.y}px`,left:`${e.x}px`,minWidth:`${jn}px`,minHeight:`${Gn}px`,boxShadow:`0 -${s}px 0 0 ${Bt}, -${s}px 0 0 0 ${Bt}, ${s}px 0 0 0 ${Bt}, 0 ${s}px 0 0 ${Bt}`,fontSize:`${$e.fontSize}px`,fontFamily:$e.fontFamily,lineHeight:`${$e.fontLineHeight}px`,color:Ns.hashToRgba($e.fontColor,$e.fontColorOpacity),verticalAlign:$e.textBaseline,textAlign:$e.textAlign}),n}}class fl{constructor(t,e,s,n){p(this,"id");p(this,"payload");p(this,"store");p(this,"relationId");this.id=t,this.payload=e,this.store=s,this.relationId=n}async undo(){throw new Error("Method not implemented.")}async redo(){throw new Error("Method not implemented.")}}class gl extends fl{async _restore(t,e){const{type:s,uDataList:n,rDataList:i,prevSelectedIds:o,selectedIds:a}=t;switch(s){case Z.ElementsSelected:{const l=e?a:o;this.store.setElementsDetachedSelectedByIds(l,!0);break}default:{const l=e?i:n;if(!l)return;const{addedIds:c,updatedIds:d}=await H.restoreDataList(l,e,this.store);this.store.setElementsDetachedSelectedByIds([...c,...d],!0),l.length&&(this.store.reactionElements(),this.store.emitElementsLayerChanged());break}}}async undo(){await this._restore(this.payload,!1)}async redo(){await this._restore(this.payload,!0)}}class H{static async updateElementFromData(t,e){const{model:s}=t,n=e.updateElementModel(s.id,V.jsonClone(s));return n&&(n.refreshFlipX(),n.refresh()),n}static async batchUpdateElementFromDatas(t,e){t.forEach(s=>{H.updateElementFromData(s,e)})}static async rearrange(t,e){t.forEach(s=>{const{model:n,prevId:i}=s,o=e.getElementById(n.id),a=i?e.getElementById(i):void 0;o&&e.moveElementAfter(o,a,!0)})}static async restoreElementFromData(t,e){let s;const{model:n,prevId:i}=t;let o;return i&&(o=e.getElementById(i)),s=e.insertAfterElementByModel(V.jsonClone(n),o,!i),s}static createRearrangeModel(t){var e,s,n,i;return{prevId:(s=(e=t.node.prev)==null?void 0:e.value)==null?void 0:s.id,nextId:(i=(n=t.node.next)==null?void 0:n.value)==null?void 0:i.id}}static async wrapElementJson(t,e){return{props:await t.toElementJson(),...e}}static async createByActionParams(t,e,s,n){const i=await H.createDataListByActionParams(t);n&&await n();const o=await H.createDataListByActionParams(t);return H.createElementsChangedCommand({store:s,payload:{uDataList:i,rDataList:o,type:e}})}static async createDataList(t,e,s){const{dataTransfer:n,objectTransfer:i,eachOperatingFunction:o}=s;return await Promise.all(t.map(async a=>(o&&await o(a),H.wrapElementJson(a,{model:await n(a),type:e,...i?await i(a):{}}))))}static async batchCreateDataList(t,e,s,n){const{elementsOperatingFunction:i,eachUDataListOperatingFunction:o,eachRDataListOperatingFunction:a}=n||{},l=e[0],c=e[1]||l,d=s[0],u=s[1]||d,f=await H.createDataList(t,d,{dataTransfer:l,eachOperatingFunction:o});i&&await i();const g=await H.createDataList(t,u,{dataTransfer:c,eachOperatingFunction:a});return[f,g]}static createElementsChangedCommand({store:t,payload:e,id:s}){return new gl(s||L.getRandomId(),e,t)}static async getAncestorsUpdateJson(t){return await H.createDataList(t,$.GroupUpdated,{dataTransfer:async e=>await e.toSubUpdatedJson()})}static async getRearrangeDataList(t){return await H.createDataList(t,$.Moved,{dataTransfer:async e=>await e.toGroupJson(),objectTransfer:async e=>H.createRearrangeModel(e)})}static async getElementsRemovedDataList(t){return await H.createDataList(t,$.Removed,{dataTransfer:async e=>await e.toJson(),objectTransfer:async e=>H.createRearrangeModel(e)})}static async getElementsAddedDataList(t,e=$.Added){return await H.createDataList(t,e,{dataTransfer:async s=>await s.toJson(),objectTransfer:async s=>H.createRearrangeModel(s)})}static async createRearrangeDataList(t){const e=[];return await Promise.all(t.map(s=>new Promise(async n=>{const{type:i,data:o}=s;switch(i){case $.Moved:{const a=k.flatElementsWithDeepSubs(o);e.push(...await H.getRearrangeDataList(a));break}case $.GroupUpdated:{e.push(...await H.getAncestorsUpdateJson(o));break}}n()}))),e}static async updateCreatingElementStatus(t,e={},s){s.setElementProvisionalCreatingById(t),R.isEmpty(e)||s.updateElementById(t,e)}static async restoreDataList(t,e,s){const n=new Set,i=new Set,o=new Set;return await Promise.all(t.map(a=>new Promise(async l=>{const{model:c,type:d,props:u={}}=a,{id:f}=c;let g=!1,C=!1,y=!1;switch(d){case $.Added:{e?(await H.restoreElementFromData(a,s),g=!0):(s.removeElementById(f),y=!0);break}case $.Updated:case $.GroupUpdated:{await H.updateElementFromData(a,s),C=!0;break}case $.Removed:{e?(s.removeElementById(f),y=!0):(await H.restoreElementFromData(a,s),g=!0);break}case $.Moved:{await H.rearrange([a],s),s.updateElementModel(f,c),C=!0;break}case $.Creating:{await H.updateElementFromData(a,s),await H.updateCreatingElementStatus(f,u,s),s.currentCreatingElementId=f,C=!0;break}case $.StartCreating:{e?(await H.restoreElementFromData(a,s),await H.updateCreatingElementStatus(f,u,s),s.currentCreatingElementId=f,g=!0):(s.removeElementById(f),s.currentCreatingElementId=null,y=!0);break}}g?o.add(f):C?n.add(f):y&&i.add(f),l()}))),{updatedIds:n,removedIds:i,addedIds:o}}static async createDataListByActionParams(t){const e=[];return await Promise.all(t.map(async s=>{const{data:n,type:i}=s;switch(i){case $.Moved:{e.push(...await H.getRearrangeDataList(n));break}case $.Removed:{e.push(...await H.getElementsRemovedDataList(n));break}case $.GroupUpdated:{e.push(...await H.getAncestorsUpdateJson(n));break}case $.Added:case $.Creating:case $.StartCreating:{e.push(...await H.getElementsAddedDataList(n,i));break}}})),e}}class ml extends xs{constructor(){super();p(this,"currentCreator",Ws);p(this,"prevCreatorType");p(this,"cursor");p(this,"mask");p(this,"provisional");p(this,"html");p(this,"configure");p(this,"store");p(this,"selection");p(this,"event");p(this,"align");p(this,"undoRedo");p(this,"stageScale",1);p(this,"stageWorldCoord",{x:0,y:0});p(this,"stageRect");p(this,"renderEl");p(this,"elementsStatus",ee.NONE);p(this,"_cursorMoveQueue",new Wt);p(this,"_redrawQueue",new Wt);p(this,"_shouldRedraw",!1);p(this,"_latestMousedownTimestamp",0);p(this,"_shouldSelectTopAWhilePressUp",!0);p(this,"_tailCreatorCommandId");p(this,"_pressDownPosition");p(this,"_pressDownStageWorldCoord");p(this,"_pressUpPosition");p(this,"_pressUpStageWorldCoord");p(this,"_pressMovePosition");p(this,"_pressMoveStageWorldCoord");p(this,"_isPressDown",!1);p(this,"_isStageMoving",!1);p(this,"_originalStageWorldCoord");p(this,"_originalEditingUDataList");this.configure=new dl,this.event=new ll(this),this.store=new Ea(this),this.cursor=new Na(this),this.provisional=new ka(this),this.html=new ul(this),this.selection=new Fa(this),this.align=new hl(this),this.mask=new Pa(this),this.undoRedo=new wi,this.renderer=new cl(this),ci(this,{stageParams:yr,stageRect:le,stageWorldCoord:le,stageScale:le,elementsStatus:le}),He(()=>this.stageParams,()=>{re.stageParams=this.stageParams}),He(()=>this.elementsStatus,()=>{this.emit(x.elementsStatusChanged,this.elementsStatus)}),this._requestAnimationRedraw(),window.shield=this}get stageRectPoints(){return L.getRectBySize(this.stageRect)}get stageWordRectCoords(){return L.getBoxByCenter(this.stageWorldCoord,{width:this.stageRect.width/this.stageScale,height:this.stageRect.height/this.stageScale})}get isElementsBusy(){return[ee.ROTATING,ee.MOVING,ee.TRANSFORMING,ee.CORNER_MOVING].includes(this.elementsStatus)||this.isTextCreating||this.isTextEditing||this.isArbitraryDrawing||this.isArbitraryEditing}get isStageMoving(){return this._isStageMoving}get isDrawerActive(){var e;return[_e.shapes,_e.freedom].includes((e=this.currentCreator)==null?void 0:e.category)}get isTextCreating(){var e;return[_e.text].includes((e=this.currentCreator)==null?void 0:e.category)}get isTextEditing(){return!this.store.isEditingEmpty&&this.store.editingElements[0].model.type===A.text}get isHandActive(){var e;return((e=this.currentCreator)==null?void 0:e.type)===A.hand}get isMoveableActive(){var e;return((e=this.currentCreator)==null?void 0:e.type)===A.moveable}get isArbitraryDrawing(){var e;return((e=this.currentCreator)==null?void 0:e.type)===A.arbitrary}get isArbitraryEditing(){return!this.store.isEditingEmpty&&this.store.editingElements[0].model.type===A.arbitrary}get stageParams(){return{rect:this.stageRect,worldCoord:this.stageWorldCoord,scale:this.stageScale}}get movingOffset(){return{x:Math.floor(this._pressMoveStageWorldCoord.x-this._pressDownStageWorldCoord.x),y:Math.floor(this._pressMoveStageWorldCoord.y-this._pressDownStageWorldCoord.y)}}async _addRedrawTask(e){return new Promise(s=>{this._redrawQueue.add({run:async()=>{await Promise.all([this.selection.refresh(),this.redraw(e),this.mask.redraw(),this.provisional.redraw()]),s()}})})}async _requestAnimationRedraw(){requestAnimationFrame(async()=>{await this._addRedrawTask(this._shouldRedraw),this._shouldRedraw=!1,!this.store.isEditingTextEmpty&&!js.isFocusOnInput()&&this.html.focusTextCursorInput(),await this._requestAnimationRedraw()})}async _addCommandByDataList({payload:e,id:s}){const n=H.createElementsChangedCommand({id:s,store:this.store,payload:e});this.undoRedo.add(n)}async _addTranslateCommand(e,s){e=this._flatWithAncestors(e);const[n,i]=await H.batchCreateDataList(e,[o=>o.toTranslateJson()],[$.Updated],{eachRDataListOperatingFunction:s});await this._addCommandByDataList({payload:{uDataList:n,rDataList:i,type:Z.ElementsUpdated}})}async executeMethod(e,...s){await e(...s),this._shouldRedraw=!0}async _setElementsPosition(e,s){await this._addTranslateCommand(e,async()=>{await this.store.setElementsPosition(e,s),this._refreshAncesorsByDetachedElements(e)}),e.forEach(n=>{n.onPositionChanged(),this._refreshAncestorsTransformed(n)})}async setElementsPosition(e,s){await this.executeMethod(async()=>await this._setElementsPosition(e,s))}async _addTransformCommand(e,s){e=this._flatWithAncestors(e);const[n,i]=await H.batchCreateDataList(e,[o=>o.toTransformJson()],[$.Updated],{elementsOperatingFunction:async()=>{await s(),await this._reflowTextIfy(e,!0)}});await this._addCommandByDataList({payload:{uDataList:n,rDataList:i,type:Z.ElementsUpdated}})}async _setElementsWidth(e,s){await this._addTransformCommand(e,async()=>{await this.store.setElementsWidth(e,s),this._refreshAncesorsByDetachedElements(e),e.forEach(n=>{n.onWidthChanged(),this._refreshAncestorsTransformed(n)})})}async setElementsWidth(e,s){await this.executeMethod(async()=>await this._setElementsWidth(e,s))}async _setElementsHeight(e,s){await this._addTransformCommand(e,async()=>{await this.store.setElementsHeight(e,s),this._refreshAncesorsByDetachedElements(e),e.forEach(n=>{n.onHeightChanged(),this._refreshAncestorsTransformed(n)})})}async setElementsHeight(e,s){await this.executeMethod(async()=>await this._setElementsHeight(e,s))}async _setElementsLeanYAngle(e,s){await this._addTransformCommand(e,async()=>{await this.store.setElementsLeanYAngle(e,s),this._refreshAncesorsByDetachedElements(e),e.forEach(n=>{n.onLeanyAngleChanged(),this._refreshAncestorsTransformed(n)})})}async setElementsLeanYAngle(e,s){await this.executeMethod(async()=>await this._setElementsLeanYAngle(e,s))}async _setElementsAngle(e,s){await this._addTransformCommand(e,async()=>{await this.store.setElementsAngle(e,s),this._refreshAncesorsByDetachedElements(e),e.forEach(n=>{n.onAngleChanged(),this._refreshAncestorsTransformed(n)})})}async setElementsAngle(e,s){await this.executeMethod(async()=>await this._setElementsAngle(e,s))}async _setElementsCorners(e,s,n){const[i,o]=await H.batchCreateDataList(e,[a=>a.toCornerJson()],[$.Updated],{elementsOperatingFunction:async()=>{await this.store.setElementsCorners(e,s,n)}});await this._addCommandByDataList({payload:{uDataList:i,rDataList:o,type:Z.ElementsUpdated}}),e.forEach(a=>a.onCornerChanged())}async setElementsCorners(e,s,n){await this.executeMethod(async()=>await this._setElementsCorners(e,s,n))}async _addStrokeCommand(e,s){const[n,i]=await H.batchCreateDataList(e,[o=>o.toStrokesJson()],[$.Updated],{eachRDataListOperatingFunction:s});await this._addCommandByDataList({payload:{uDataList:n,rDataList:i,type:Z.ElementsUpdated}})}async _setElementsStrokeType(e,s,n){await this._addStrokeCommand(e,async()=>{await this.store.setElementsStrokeType(e,s,n)}),e.forEach(i=>i.onStrokeTypeChanged())}async setElementsStrokeType(e,s,n){await this.executeMethod(async()=>await this._setElementsStrokeType(e,s,n))}async _setElementsStrokeWidth(e,s,n){await this._addStrokeCommand(e,async()=>{await this.store.setElementsStrokeWidth(e,s,n)}),e.forEach(i=>i.onStrokeWidthChanged())}async setElementsStrokeWidth(e,s,n){await this.executeMethod(async()=>await this._setElementsStrokeWidth(e,s,n))}async _setElementsStrokeColor(e,s,n){await this._addStrokeCommand(e,async()=>{await this.store.setElementsStrokeColor(e,s,n)}),e.forEach(i=>i.onStrokeColorChanged())}async setElementsStrokeColor(e,s,n){await this.executeMethod(async()=>await this._setElementsStrokeColor(e,s,n))}async _setElementsStrokeColorOpacity(e,s,n){await this._addStrokeCommand(e,async()=>{await this.store.setElementsStrokeColorOpacity(e,s,n)}),e.forEach(i=>i.onStrokeColorOpacityChanged())}async setElementsStrokeColorOpacity(e,s,n){await this.executeMethod(async()=>await this._setElementsStrokeColorOpacity(e,s,n))}async _addElementsStroke(e,s){await this._addStrokeCommand(e,async()=>{await this.store.addElementsStroke(e,s)}),e.forEach(n=>n.onStrokeAdded())}async addElementsStroke(e,s){await this.executeMethod(async()=>await this._addElementsStroke(e,s))}async _removeElementsStroke(e,s){await this._addStrokeCommand(e,async()=>{await this.store.removeElementsStroke(e,s)}),e.forEach(n=>n.onStrokeRemoved())}async removeElementsStroke(e,s){await this.executeMethod(async()=>await this._removeElementsStroke(e,s))}async _addFillCommand(e,s){const[n,i]=await H.batchCreateDataList(e,[o=>o.toFillsJson()],[$.Updated],{elementsOperatingFunction:s});await this._addCommandByDataList({payload:{uDataList:n,rDataList:i,type:Z.ElementsUpdated}})}async _setElementsFillColor(e,s,n){await this._addFillCommand(e,async()=>{await this.store.setElementsFillColor(e,s,n)}),e.forEach(i=>i.onFillColorChanged())}async setElementsFillColor(e,s,n){await this.executeMethod(async()=>await this._setElementsFillColor(e,s,n))}async _setElementsFillColorOpacity(e,s,n){await this._addFillCommand(e,async()=>{await this.store.setElementsFillColorOpacity(e,s,n)}),e.forEach(i=>i.onFillColorOpacityChanged())}async setElementsFillColorOpacity(e,s,n){await this.executeMethod(async()=>await this._setElementsFillColorOpacity(e,s,n))}async _addElementsFill(e,s){await this._addFillCommand(e,async()=>{await this.store.addElementsFill(e,s)}),e.forEach(n=>n.onFillAdded())}async addElementsFill(e,s){await this.executeMethod(async()=>await this._addElementsFill(e,s))}async _removeElementsFill(e,s){await this._addFillCommand(e,async()=>{await this.store.removeElementsFill(e,s)}),e.forEach(n=>n.onFillRemoved())}async removeElementsFill(e,s){await this.executeMethod(async()=>await this._removeElementsFill(e,s))}async _addFontStyleCommand(e,s,n){const i=I.shouldRelationUndoCommand(n),o=L.getRandomId(),[a,l]=await H.batchCreateDataList(e,[c=>c.toFontStyleJson()],[$.Updated],{elementsOperatingFunction:s,eachUDataListOperatingFunction:async c=>{i&&c.isEditing&&c instanceof Ke&&c.refreshUndoCommandObject()},eachRDataListOperatingFunction:async c=>{i&&c.isEditing&&c instanceof Ke&&c.relationUndoCommand(o)}});await this._addCommandByDataList({id:o,payload:{uDataList:a,rDataList:l,type:Z.ElementsUpdated}})}async _reflowTextIfy(e,s,n){const i=[];return await Promise.all(e.map(async o=>{o instanceof Ke&&o.reflowText(s||n)&&i.push(o)})),i.length>0&&(await this._addRedrawTask(!0),i.forEach(o=>o.onTextReflowed(n)),await Promise.all(e.map(async o=>o instanceof Ke&&o.refreshTextCursors())),await this._addRedrawTask(!0)),i}async _setElementsTextAlign(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsTextAlign(e,s),await this._addRedrawTask(!0),await this._reflowTextIfy(e,!0),e.forEach(n=>n.onTextAlignChanged())},ne.FONT_TEXT_ALIGN)}async setElementsTextAlign(e,s){await this.executeMethod(async()=>await this._setElementsTextAlign(e,s))}async _setElementsTextVerticalAlign(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsTextVerticalAlign(e,s),await this._addRedrawTask(!0),await this._reflowTextIfy(e,!0),e.forEach(n=>n.onTextVerticalAlignChanged())},ne.FONT_TEXT_VERTICAL_ALIGN)}async setElementsTextVerticalAlign(e,s){await this.executeMethod(async()=>await this._setElementsTextVerticalAlign(e,s))}async _setElementsTextBaseline(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsTextBaseline(e,s)},ne.FONT_TEXT_BASELINE),e.forEach(n=>n.onTextBaselineChanged())}async setElementsTextBaseline(e,s){await this.executeMethod(async()=>await this._setElementsTextBaseline(e,s))}async _setElementsFontStyler(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsFontStyler(e,s),await this._addRedrawTask(!0),await this._reflowTextIfy(e,!0),e.forEach(n=>n.onFontStylerChanged())},ne.FONT_STYLER)}async setElementsFontStyler(e,s){await this.executeMethod(async()=>await this._setElementsFontStyler(e,s))}async _setElementsFontSize(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsFontSize(e,s),await this._addRedrawTask(!0),await this._reflowTextIfy(e,!0),e.forEach(n=>{n.onFontSizeChanged(),!n.isSelectionAvailable&&n.fontLineHeightAutoFit&&n.onFontLineHeightChanged()})},ne.FONT_SIZE)}async setElementsFontSize(e,s){await this.executeMethod(async()=>await this._setElementsFontSize(e,s))}async _setElementsFontFamily(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsFontFamily(e,s),await this._addRedrawTask(!0),await this._reflowTextIfy(e,!0),e.forEach(n=>n.onFontFamilyChanged())},ne.FONT_FAMILY)}async setElementsFontFamily(e,s){await this.executeMethod(async()=>await this._setElementsFontFamily(e,s))}async _setElementsFontLineHeight(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsFontLineHeight(e,s)},ne.FONT_LINE_HEIGHT),e.forEach(n=>{n.onFontLineHeightChanged(),n.onFontLineHeightFactorChanged()})}async setElementsFontLineHeight(e,s){await this.executeMethod(async()=>await this._setElementsFontLineHeight(e,s))}async _setElementsFontLineHeightFactor(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsFontLineHeightFactor(e,s)},ne.FONT_LINE_HEIGHT_FACTOR),e.forEach(n=>{n.onFontLineHeightFactorChanged(),n.onFontLineHeightChanged()})}async setElementsFontLineHeightFactor(e,s){await this.executeMethod(async()=>await this._setElementsFontLineHeightFactor(e,s))}async _setElementsFontLineHeightAutoFit(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsFontLineHeightAutoFit(e,s)},ne.FONT_LINE_HEIGHT_AUTO_FIT),e.forEach(n=>{n.onFontLineHeightAutoFitChanged(),n.onFontLineHeightChanged()})}async setElementsFontLineHeightAutoFit(e,s){await this.executeMethod(async()=>await this._setElementsFontLineHeightAutoFit(e,s))}async _setElementsFontColor(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsFontColor(e,s)},ne.FONT_COLOR),e.forEach(n=>n.onFontColorChanged())}async setElementsFontColor(e,s){await this.executeMethod(async()=>await this._setElementsFontColor(e,s))}async _setElementsFontColorOpacity(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsFontColorOpacity(e,s)},ne.FONT_COLOR_OPACITY),e.forEach(n=>n.onFontColorOpacityChanged())}async setElementsFontColorOpacity(e,s){await this.executeMethod(async()=>await this._setElementsFontColorOpacity(e,s))}async _setElementsFontLetterSpacing(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsFontLetterSpacing(e,s),await this._addRedrawTask(!0),await this._reflowTextIfy(e,!0),e.forEach(n=>n.onFontLetterSpacingChanged())},ne.FONT_LETTER_SPACING)}async setElementsFontLetterSpacing(e,s){await this.executeMethod(async()=>await this._setElementsFontLetterSpacing(e,s))}async _setElementsTextDecoration(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsTextDecoration(e,s)},ne.FONT_TEXT_DECORATION),e.forEach(n=>n.onTextDecorationChanged())}async setElementsTextDecoration(e,s){await this.executeMethod(async()=>await this._setElementsTextDecoration(e,s))}async _setElementsTextDecorationColor(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsTextDecorationColor(e,s)},ne.FONT_TEXT_DECORATION_COLOR),e.forEach(n=>n.onTextDecorationColorChanged())}async setElementsTextDecorationColor(e,s){await this.executeMethod(async()=>await this._setElementsTextDecorationColor(e,s))}async _setElementsTextDecorationOpacity(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsTextDecorationOpacity(e,s)},ne.FONT_TEXT_DECORATION_OPACITY),e.forEach(n=>n.onTextDecorationOpacityChanged())}async setElementsTextDecorationOpacity(e,s){await this.executeMethod(async()=>await this._setElementsTextDecorationOpacity(e,s))}async _setElementsTextDecorationThickness(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsTextDecorationThickness(e,s)},ne.FONT_TEXT_DECORATION_THICKNESS),e.forEach(n=>n.onTextDecorationThicknessChanged())}async setElementsTextDecorationThickness(e,s){await this.executeMethod(async()=>await this._setElementsTextDecorationThickness(e,s))}async _setElementsParagraphSpacing(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsParagraphSpacing(e,s)},ne.FONT_PARAGRAPH_SPACING),e.forEach(n=>n.onParagraphSpacingChanged())}async setElementsParagraphSpacing(e,s){await this.executeMethod(async()=>await this._setElementsParagraphSpacing(e,s))}async _setElementsTextCase(e,s){await this._addFontStyleCommand(e,async()=>{await this.store.setElementsTextCase(e,s),await this._addRedrawTask(!0),await this._reflowTextIfy(e,!0),e.forEach(n=>n.onTextCaseChanged())},ne.FONT_TEXT_CASE)}async setElementsTextCase(e,s){await this.executeMethod(async()=>await this._setElementsTextCase(e,s))}async _setElementsRatioLocked(e,s){await this.store.setElementsRatioLocked(e,s),e.forEach(n=>n.onRatioLockedChanged())}async setElementsRatioLocked(e,s){await this.executeMethod(async()=>await this._setElementsRatioLocked(e,s))}async _setElementsRotate(e,s){await this._addTransformCommand(e,async()=>{await this.store.setElementsRotate(e,s),this._refreshAncesorsByDetachedElements(e),e.forEach(n=>{n.onAngleChanged(),this._refreshAncestorsTransformed(n)})})}async setElementsRotate(e,s){await this.executeMethod(async()=>await this._setElementsRotate(e,s))}async _setElementsFlipX(e){await this._addTransformCommand(e,async()=>{await this.store.setElementsFlipX(e),this._refreshAncesorsByDetachedElements(e),e.forEach(s=>{s.onFlipXChanged(),this._refreshAncestorsTransformed(s)})})}async setElementsFlipX(e){await this.executeMethod(async()=>await this._setElementsFlipX(e))}async _setElementsFlipY(e){await this._addTransformCommand(e,async()=>{await this.store.setElementsFlipY(e),this._refreshAncesorsByDetachedElements(e),e.forEach(s=>{s.onFlipYChanged(),this._refreshAncestorsTransformed(s)})})}async setElementsFlipY(e){await this.executeMethod(async()=>await this._setElementsFlipY(e))}async init(e){this.renderEl=e,await Promise.all([this.initNode(),this.event.init()]),this._addEventListeners()}_addCursorQueueTask(e){this._cursorMoveQueue.add({run:e})}_addEventListeners(){this.event.on("resize",this._refreshSize.bind(this)),this.event.on("cursorMove",e=>this._addCursorQueueTask(()=>this._handleCursorMove(e))),this.event.on("pressDown",e=>this._addCursorQueueTask(()=>this._handlePressDown(e))),this.event.on("pressUp",e=>this._addCursorQueueTask(()=>this._handlePressUp(e))),this.event.on("cursorLeave",this._handleCursorLeave.bind(this)),this.event.on("dblClick",this._handleDblClick.bind(this)),this.event.on("wheelScale",this._handleWheelScale.bind(this)),this.event.on("wheelMove",this._handleWheelMove.bind(this)),this.event.on("scaleReduce",this._handleScaleReduce.bind(this)),this.event.on("scaleIncrease",this._handleScaleIncrease.bind(this)),this.event.on("scaleAutoFit",this._handleScaleAutoFit.bind(this)),this.event.on("scale100",this._handleScale100.bind(this)),this.event.on("pasteImages",this._handleImagesPasted.bind(this)),this.event.on("deleteSelects",this._handleSelectsDelete.bind(this)),this.event.on("selectAll",this.selectAll.bind(this)),this.event.on("selectCopy",this._handleSelectCopy.bind(this)),this.event.on("pasteElements",this._handlePasteElements.bind(this)),this.event.on("cancel",this._handleCancel.bind(this)),this.event.on("selectMoveableCreator",()=>this.setCreator(tt,!0)),this.event.on("selectHandCreator",()=>this.setCreator(Ws,!0)),this.event.on("groupAdd",this._handleGroupAdd.bind(this)),this.event.on("groupRemove",this._handleGroupCancel.bind(this)),this.event.on("undo",this.execUndo.bind(this)),this.event.on("redo",this.execRedo.bind(this)),this.html.on("textInput",this._handleTextInput.bind(this)),this.html.on("textUpdate",this._handleTextUpdate.bind(this))}initNode(){super.initNode();const e=this.mask.initNode(),s=this.provisional.initNode(),n=this.html.initNode();return this.renderEl.insertBefore(e,this.renderEl.firstChild),this.renderEl.insertBefore(n,this.mask.node),this.renderEl.insertBefore(s,this.html.node),this.node.id="shield",this.renderEl.insertBefore(this.node,this.provisional.node),this.node}async _doElementsOperating(){switch(this.elementsStatus){case ee.ROTATING:{this._rotateElements();break}case ee.MOVING:{this._dragElements();break}case ee.TRANSFORMING:{this._transformElements();break}case ee.CORNER_MOVING:{this._movingElementsCorner();break}}}_processAncestorsByElements(e,s){this.store.getAncestorsByDetachedElements(e).forEach(s)}_refreshAncesorGroupsOriginals(e){this._processAncestorsByElements(e,s=>s.refreshOriginals())}_refreshAncesorsByDetachedElements(e){this._processAncestorsByElements(e,s=>s.refreshBySubs())}async _updateStatusWhileElementsOperating(){(this.elementsStatus===ee.MOVE_READY||![ee.ROTATING,ee.TRANSFORMING,ee.CORNER_MOVING].includes(this.elementsStatus)&&this.store.isSelectedContainsTarget()&&this.store.isEditingEmpty)&&(this.elementsStatus!==ee.MOVING&&this._refreshAncesorGroupsOriginals(this.store.detachedSelectedElements),this.elementsStatus=ee.MOVING)}async _handleCursorMove(e){this.cursor.transform(e),this.cursor.updateStyle(e),this.isMoveableActive&&!this.isElementsBusy&&this.selection.hitTargetElements(this.cursor.worldValue),this._isPressDown?(this.calcPressMove(e),this.isTextEditing?this._tryRetrieveTextCursor(Ct.PRESS_MOVE,!0):this.isArbitraryDrawing?this._updateArbitraryTailOnMovement(e):this.isDrawerActive?this._creatingElementOnMovement(e):this.isMoveableActive?this.store.isSelectedEmpty?this._updateRange():this.checkCursorPressMovedALittle(e)&&(await this._updateStatusWhileElementsOperating(),await this._doElementsOperating()):this.isHandActive&&(this._isStageMoving=!0,this._dragStage(e))):this.isMoveableActive&&this.selection.tryActiveController(this.cursor.worldValue),this.isElementsBusy&&this.store.cancelTargetElements()}triggetEditingElementsStageChanged(){requestAnimationFrame(()=>{this.store.editingElements.forEach(e=>e.onStageChanged())})}_dragStage(e){this.executeMethod(()=>{this._refreshStageWorldCoord(e),this.store.refreshStageElements(),this.triggetEditingElementsStageChanged()})}_dragElements(){this.executeMethod(()=>{const{selectedElements:e}=this.store;this.store.updateElementsCoordsByOffset(e,this.movingOffset),this._refreshAncesorsByDetachedElements(e),e.forEach(s=>{s.isDragging=!0,s.onTranslating()})})}_movingElementsCorner(){this.executeMethod(()=>{const{selectedElements:e}=this.store;this.store.updateElementsCorner(e,this.movingOffset),e.forEach(s=>{s.isCornerMoving=!0,s.onCornerChanging()})})}_transformElements(){this.executeMethod(()=>{const{selectedElements:e}=this.store;this.store.isMultiSelected?(this.selection.rangeElement.isTransforming=!0,this.store.updateElementsTransform([this.selection.rangeElement],this.movingOffset)):this.store.updateElementsTransform(e,this.movingOffset),this._refreshAncesorsByDetachedElements(e),e.forEach(s=>{s.isTransforming=!0,s.onTransforming()})})}_rotateElements(){this.executeMethod(()=>{const{selectedElements:e,nonHomologousElements:s}=this.store;this.store.isMultiSelected?(this.selection.rangeElement.isRotating=!0,this.store.updateElementsRotation([this.selection.rangeElement],this._pressMovePosition)):this.store.updateElementsRotation(s,this._pressMovePosition),this._refreshAncesorsByDetachedElements(e),e.forEach(n=>{n.isRotating=!0,n.onRotating()})})}_updateRange(){const e=L.getBoxByPoints([this._pressDownStageWorldCoord,this._pressMoveStageWorldCoord]);this.selection.setRange(e)}async _handleCursorLeave(){this.cursor.clear(),this.cursor.setStyle("default")}_preProcessRotationStates(e){this.store.updateElementById(e.host.id,{isRotatingTarget:!0}),this.store.isMultiSelected?this.store.refreshElementsRotationStates([this.selection.rangeElement],this._pressDownPosition):this.store.refreshRotatingStates(this._pressDownPosition)}_doSelect(e){const s=this.selection.getElementOnCoord(this.cursor.worldValue),n=this.store.isSelectedContainsTarget();e.ctrlKey?s&&this.store.toggleSelectElement(s):n||(this._clearSelects(),s&&(this.store.selectElement(s),this.elementsStatus=ee.MOVE_READY))}_trySelect(e){this._addSelectedChangedCommand(async()=>await this._doSelect(e))}async _handlePressDown(e){if(this._latestMousedownTimestamp=window.performance.now(),this._isPressDown=!0,this.calcPressDown(e),this.isTextEditing)this._isCursorOnEditingElement()?this._tryRetrieveTextCursor(Ct.PRESS_DOWN,!1):(await this._commitEidting(),this._shouldSelectTopAWhilePressUp=!1);else if(this.isTextCreating)this.html.createTextInput(this.cursor.value);else if(this.isDrawerActive&&!this.store.isSelectedEqCreating())this._clearSelects();else if(this.isMoveableActive){const s=this.selection.tryActiveController(this.cursor.worldValue);if(s){const n=[...this.store.selectedElements,this.selection.rangeElement];this.store.refreshElementsOriginalAngles(n,{deepSubs:!0}),this.store.refreshElementsOriginals(n,{deepSubs:!0})}s instanceof $t?(this._preProcessRotationStates(s),this.elementsStatus=ee.ROTATING):s instanceof _t||s instanceof Ht?this.elementsStatus=ee.TRANSFORMING:s instanceof cs?this.elementsStatus=ee.CORNER_MOVING:this._trySelect(e),[ee.MOVING,ee.ROTATING,ee.TRANSFORMING].includes(this.elementsStatus)&&this._refreshAncesorGroupsOriginals(this.store.detachedSelectedElements)}else this.isHandActive&&(this._originalStageWorldCoord=V.jsonClone(this.stageWorldCoord))}_isCursorOnEditingElement(){const e=this.selection.getElementOnCoord(this.cursor.worldValue);return this.store.editingElements.includes(e)}_tryRetrieveTextCursor(e,s){const{selectedElements:n}=this.store,i=this.selection.getElementOnCoord(this.cursor.worldValue);i&&i instanceof Ke&&n[0]===i&&(e!==Ct.PRESS_UP&&(i.refreshTextCursorAtPosition(this.cursor.worldValue,s),this._retreiveTextCursorInput(i)),i.onEditorPressChange(e))}async _addCreatorChangedCommand(){const e=await H.createByActionParams([],Z.ElementsCreatorChanged,this.store);Object.assign(e.payload,{prevCreatorType:this.prevCreatorType,creatorType:this.currentCreator.type}),this.undoRedo.add(e),this._tailCreatorCommandId=e.id}async _addSelectedChangedCommand(e){const s=new Set(this.store.selectedElementIds);e&&await e();const n=new Set(this.store.selectedElementIds);if(!V.isSetEqual(s,n)){const i=await H.createByActionParams([],Z.ElementsSelected,this.store);Object.assign(i.payload,{prevSelectedIds:s,selectedIds:n}),this.undoRedo.add(i)}}async _handleArbitraryPressUp(){let e=this.store.creatingElements[0],s=[],n=[];e&&s.push(...await H.createDataListByActionParams([{type:$.Creating,data:[e]}])),e=this.store.creatingArbitraryElement(this.cursor.worldValue,!0),e.tailCoordIndex===0?(s.push({type:$.StartCreating,model:{id:e.id}}),n.push(...await H.createDataListByActionParams([{type:$.StartCreating,data:[e]}])),await this._addCommandByDataList({id:e.id,payload:{uDataList:s,rDataList:n,type:Z.ElementsStartCreating}})):(n.push(...await H.createDataListByActionParams([{type:$.Creating,data:[e]}])),await this._addCommandByDataList({id:e.id,payload:{uDataList:s,rDataList:n,type:Z.ElementsCreating}})),e!=null&&e.model.isFold&&this.commitArbitraryDrawing()}_clearSelects(){this.selection.clearSelects(),this.selection.setRange([])}async _endElementsOperating(){switch(this.elementsStatus){case ee.MOVING:{await this._endElementsDrag();break}case ee.ROTATING:{await this._endElementsRotate();break}case ee.TRANSFORMING:{await this._endElementsTransform();break}case ee.CORNER_MOVING:{await this._endMovingElementsCorner();break}}}_clearElementsStatus(){[ee.ROTATING,ee.TRANSFORMING,ee.CORNER_MOVING,ee.MOVING].includes(this.elementsStatus)&&this.store.isEditingEmpty&&(this.elementsStatus=ee.NONE)}_trySelectTopA(){this._shouldSelectTopAWhilePressUp&&this._addSelectedChangedCommand(async()=>await this._selectTopAElement(this.store.selectedElements)),this._shouldSelectTopAWhilePressUp=!0}async _handlePressUp(e){this._isPressDown=!1,this.calcPressUp(e),this.isTextEditing?this._tryRetrieveTextCursor(Ct.PRESS_UP,!1):this.isArbitraryDrawing?(this._isPressDown=!0,await this._handleArbitraryPressUp()):this.isDrawerActive?this.store.finishCreatingElement():this.isMoveableActive?this.store.isSelectedEmpty?this._trySelectRange():this.checkCursorPressUpALittle(e)?(await this._endElementsOperating(),this._clearElementsStatus()):!e.ctrlKey&&!e.shiftKey&&this._trySelectTopA():this.isHandActive&&this._processHandCreatorMove(e),this.isArbitraryDrawing||await this._afterElementCreated()}async _trySelectRange(){this._addSelectedChangedCommand(async()=>{this.selection.selectRange(),this.selection.setRange(null)})}_retreiveTextCursorInput(e){!e||!(e instanceof Ke)||(this.html.createTextCursorInput(),requestAnimationFrame(()=>{this.html.focusTextCursorInput()}))}async _refreshOrignalEditingDataList(e){this._originalEditingUDataList=await H.createDataList(this.store.editingElements,$.Updated,{dataTransfer:async s=>await s.toOriginalTransformJson()}),e instanceof zs&&this._originalEditingUDataList.push(...await H.createDataList(e.ancestorGroups,$.Updated,{dataTransfer:async s=>await s.toOriginalTransformJson()}))}async _onEditingElementOnStart(e){this._refreshOrignalEditingDataList(e),e instanceof Ke&&this._retreiveTextCursorInput(e)}async _tryEditElement(e){this.store.beginEditingElements([e]),this._onEditingElementOnStart(e)}async _handleDblClick(e){if(this.isMoveableActive){let s=this._getTopAElemnt(this.store.stageElements);s!=null&&s.isGroup&&(s=this._getTopAElemnt(s.deepSubs.filter(n=>!n.isGroup))),s&&(this.store.setElementsDetachedSelected([s],!0),s.editingEnable&&this._tryEditElement(s))}}async _afterElementCreated(){await Promise.all([this._addRedrawTask(!0),this._commitElementCreated()])}_flatWithAncestors(e){const s=k.getAncestorIdsByDetachedElements(e),n=new Set(s);return e.forEach(i=>{n.add(i.id)}),this.store.getOrderedElementsByIds(Array.from(n))}_refreshAncestorsTransformed(e){e.isGroupSubject&&e.isDetachedSelected&&e.ancestorGroups.forEach(s=>{s.onTransformAfter()})}async _addOriginalTranslateCommand(e){e=this._flatWithAncestors(e);const[s,n]=await H.batchCreateDataList(e,[i=>i.toOriginalTranslateJson(),i=>i.toTranslateJson()],[$.Updated]);await this._addCommandByDataList({payload:{uDataList:s,rDataList:n,type:Z.ElementsUpdated}})}async _endElementsDrag(){const{selectedElements:e}=this.store;await this._addOriginalTranslateCommand(e),e.forEach(s=>{s.isDragging=!1,s.onTranslateAfter(),this._refreshAncestorsTransformed(s)}),this.store.isMultiSelected&&(this.selection.rangeElement.isDragging=!1)}async _addOrignalRotateCommand(e){e=this._flatWithAncestors(e);const[s,n]=await H.batchCreateDataList(e,[i=>i.toOriginalRotateJson(),i=>i.toRotateJson()],[$.Updated]);await this._addCommandByDataList({payload:{uDataList:s,rDataList:n,type:Z.ElementsUpdated}})}async _endElementsRotate(){const{selectedElements:e}=this.store;await this._addOrignalRotateCommand(e),e.forEach(s=>{s.isRotatingTarget=!1,s.isRotating=!1,s.onRotateAfter(),this._refreshAncestorsTransformed(s)}),this.store.isMultiSelected&&(this.selection.rangeElement.isRotating=!1),this.store.clearRotatingStates()}async _addOriginalTransformCommand(e){e=this._flatWithAncestors(e);const[s,n]=await H.batchCreateDataList(e,[i=>i.toOriginalCornerJson(),i=>i.toCornerJson()],[$.Updated]);await this._addCommandByDataList({payload:{uDataList:s,rDataList:n,type:Z.ElementsUpdated}})}async _endElementsTransform(){const{selectedElements:e,isEditingEmpty:s}=this.store;s&&(await this._addOriginalTransformCommand(e),e.forEach(n=>{n.isTransforming=!1,n.onTransformAfter(),this._refreshAncestorsTransformed(n)}),this.store.isMultiSelected&&(this.selection.rangeElement.isTransforming=!1))}async _endMovingElementsCorner(){const[e,s]=await H.batchCreateDataList(this.store.selectedElements,[n=>n.toOriginalCornerJson(),n=>n.toCornerJson()],[$.Updated]);await this._addCommandByDataList({payload:{uDataList:e,rDataList:s,type:Z.ElementsUpdated}}),this.store.selectedElements.forEach(n=>{n.isCornerMoving=!1,n.refreshOriginals(),n.onCornerChanged()})}_getTopAElemnt(e){const s=e.filter(n=>n.isDetachedSelected);return k.getTopAElementByCoord(s.length?s:e,this.cursor.worldValue)}_doSelectElement(e){this.store.deSelectElements(this.store.selectedElements.filter(s=>e&&e.isGroup?s.ancestorGroup!==e:s!==e)),e&&this.store.selectElement(e)}_selectTopAElement(e){const s=this._getTopAElemnt(e);this._doSelectElement(s)}_processHandCreatorMove(e){this._refreshStageWorldCoord(e),this.store.refreshStageElements(),this._isStageMoving=!1}_deleteTailCreatorCommand(){const e=this.undoRedo.tailUndoCommand;e&&e.id===this._tailCreatorCommandId&&(this.undoRedo.pop(),this._tailCreatorCommandId=null)}async _addAddedCommand(e){const s=[{type:$.Added,data:e}],n=await H.createByActionParams(s,Z.ElementsAdded,this.store);this.undoRedo.add(n)}async _tryAddAddedCommand(e){this._deleteTailCreatorCommand(),await this._addAddedCommand(e)}_emitElementsCreated(e){this.setCreator(tt,!1),this.emit(x.elementCreated,e)}async _commitElementCreated(){const e=this.store.provisionalElements;e.length&&(this.store.updateElements(e,{isProvisional:!1,isOnStage:!0}),this._emitElementsCreated(e),await this._tryAddAddedCommand(e))}calcPressDown(e){this._pressDownPosition=this.cursor.transform(e),this._pressDownStageWorldCoord=k.calcWorldCoord(this._pressDownPosition)}calcPressUp(e){this._pressUpPosition=this.cursor.transform(e),this._pressUpStageWorldCoord=k.calcWorldCoord(this._pressUpPosition)}calcPressMove(e){this._pressMovePosition=this.cursor.transform(e),this._pressMoveStageWorldCoord=k.calcWorldCoord(this._pressMovePosition)}checkCursorPressMovedALittle(e){return Math.abs(this._pressMoveStageWorldCoord.x-this._pressDownStageWorldCoord.x)>=En||Math.abs(this._pressMoveStageWorldCoord.y-this._pressDownStageWorldCoord.y)>=xn}checkCursorPressUpALittle(e){return Math.abs(this._pressUpStageWorldCoord.x-this._pressDownStageWorldCoord.x)>=En||Math.abs(this._pressUpStageWorldCoord.y-this._pressDownStageWorldCoord.y)>=xn}async _refreshSize(){this.executeMethod(()=>{const e=this.renderEl.getBoundingClientRect();this.stageRect=e,this._updateCanvasSize(e),this.store.refreshStageElements(),this.triggetEditingElementsStageChanged()})}_updateCanvasSize(e){this.mask.updateSize(e),this.provisional.updateSize(e),this.html.updateSize(e),this.updateSize(e)}async setCreator(e,s){var n,i;e.type!==((n=this.currentCreator)==null?void 0:n.type)&&(this.currentCreator=e,s&&await this._addCreatorChangedCommand(),this.prevCreatorType=(i=this.currentCreator)==null?void 0:i.type,this.cursor.updateStyle(),this.emit(x.creatorChanged,this.currentCreator))}_creatingElementOnMovement(e){if(this.checkCursorPressMovedALittle(e))return this.store.creatingElement([this._pressDownStageWorldCoord,this._pressMoveStageWorldCoord])}_updateArbitraryTailOnMovement(e){const s=this.store.creatingElements[0];if(s&&s.tailCoordIndex>=0&&this.checkCursorPressMovedALittle(e))return this.store.creatingArbitraryElement(this._pressMoveStageWorldCoord,!1)}_refreshStageWorldCoord(e){if(!this._originalStageWorldCoord)return;const s=L.getEventPosition(e,this.stageRect,this.stageScale);this.stageWorldCoord={x:this._originalStageWorldCoord.x-(s.x-this._pressDownPosition.x),y:this._originalStageWorldCoord.y-(s.y-this._pressDownPosition.y)}}_checkScale(e){let s=R.clamp(this.stageScale+e,.02,5);return s=h.precise(s,2),this.stageScale===.02&&e>0&&(s=.1),s}async setScale(e){await this.executeMethod(()=>{this.stageScale=e,G.scale=e,this.html.updateSize(this.renderEl.getBoundingClientRect()),this.emit(x.scaleChanged,e),this.store.refreshStageElements(),this.triggetEditingElementsStageChanged()})}_handleWheelScale(e,s){const n=L.getEventPosition(s,this.stageRect,this.stageScale),i=k.calcWorldCoord(n),o=this._checkScale(e),a=(s.clientX-this.stageRect.left)/o,l=(s.clientY-this.stageRect.top)/o,c=i.x-a,d=i.y-l,u=c+this.stageRect.width/2/o,f=d+this.stageRect.height/2/o;this.stageWorldCoord={x:u,y:f},this.setScale(o)}_handleWheelMove(e){this.executeMethod(()=>{this.stageWorldCoord.x+=e.x/2/this.stageScale,this.stageWorldCoord.y+=e.y/2/this.stageScale,this.store.refreshStageElements(),this.store.editingElements.forEach(s=>s.onStageChanged())})}calcScaleAutoFitValueByBox(e){const{width:s,height:n}=L.calcRectangleSize(e);return this.calcScaleAutoFitValueBySize(s,n)}calcScaleAutoFitValueBySize(e,s){let n=h.precise(L.calcScale(this.stageRect,{width:e,height:s},Qo*this.stageScale),2);return n=R.clamp(n,.02,1),n}calcScaleAutoFitValue(){return this.calcElementsAutoFitValue(this.store.visibleElements)}calcElementsAutoFitValue(e){const s=L.getBoxByPoints(e.map(n=>n.maxOutlineBoxCoords).flat());return this.calcScaleAutoFitValueByBox(s)}setScaleAutoFit(){if(this.store.isVisibleEmpty)this.stageWorldCoord={x:0,y:0},this.setScale(1);else{const e=h.calcCenter(this.store.visibleElements.map(s=>s.rotateOutlineCoords.flat()).flat());this.stageWorldCoord=e,this.store.refreshStageElements(),this.setScale(this.calcScaleAutoFitValue())}}setScaleReduce(){const e=this._checkScale(-.05);this.setScale(e)}setScaleIncrease(){const e=this._checkScale(.05);this.setScale(e)}setScale100(){this.setScale(1)}_handleScaleReduce(){this.setScaleReduce()}_handleScaleIncrease(){this.setScaleIncrease()}_handleScaleAutoFit(){this.setScaleAutoFit()}_handleScale100(){this.setScale100()}async _handleImagesPasted(e,s){this._clearSelects();const n=await this.store.insertImageElements(e),i=this.calcElementsAutoFitValue(n);this.stageScale>i&&await this.setScale(i),await this._tryAddAddedCommand(n),s&&s()}async uploadImages(e){e.length&&await this.event.onImagesUpload(e)}async _handleSelectsDelete(){if(this.store.isSelectedEmpty)return;const{list:e,ancestors:s}=this.store.findRemovedElemements(this.store.selectedElements),n=[];e.forEach(l=>{n.push({type:$.Removed,data:[l]})}),s.forEach(l=>{n.push({type:$.GroupUpdated,data:[l]})});const i=await H.createDataListByActionParams(n),o=new Set(e.map(l=>l.id));s.forEach(l=>{this.store.updateElementModel(l.id,{subIds:l.model.subIds.filter(c=>!o.has(c))}),l.refreshBySubsWithout(Array.from(o)),l.refreshOriginals()});const a=await H.createDataListByActionParams(n);await this._addCommandByDataList({payload:{uDataList:i,rDataList:a,type:Z.ElementsRemoved}}),this.store.removeElements(e)}selectAll(){this._addSelectedChangedCommand(async()=>await this.store.selectAll())}async _handleSelectCopy(){const e=await this.store.copySelectElements(),s=JSON.stringify(e);js.copyValueToClipboard(s)}async _handlePasteElements(e){let s=[],n=[];const i=await this.store.pasteElements(e,async o=>{s.push(...await H.createDataListByActionParams(o))},async o=>{n.push(...await H.createDataListByActionParams(o))});await this._addCommandByDataList({payload:{uDataList:s.reverse(),rDataList:n,type:Z.ElementsAdded}}),this.store.setElementsDetachedSelected(i,!0)}_handleCancel(){this.isArbitraryDrawing?this.commitArbitraryDrawing():this.isArbitraryEditing&&this.commitEditingDrawing()}async _handleGroupAdd(){if(this.isElementsBusy||this.store.isSelectedEmpty)return;let e=[],s=[],n=null;await this.store.createElementGroup(this.store.selectedElements,async i=>{e.push(...await H.createDataListByActionParams(i))},async i=>{var a;s.push(...await H.createDataListByActionParams(i));const o=i[i.length-1];(a=o==null?void 0:o.data)!=null&&a.length&&(n=o.data[0])}),n&&(this._clearSelects(),this.store.setElementsDetachedSelected([n],!0)),await this._addCommandByDataList({payload:{uDataList:e,rDataList:s,type:Z.GroupAdded}})}async _handleGroupCancel(){if(this.isElementsBusy)return;const e=this.store.getSelectedAncestorElementGroups();if(e.length===0)return;const s=[];e.forEach(o=>{s.push({type:$.Removed,data:[o]}),o.subs.forEach(a=>{s.push({type:$.Moved,data:[a]})})});const n=await H.createDataListByActionParams(s);this.store.cancelGroups(e);const i=await H.createDataListByActionParams(s);await this._addCommandByDataList({payload:{uDataList:n,rDataList:i,type:Z.GroupRemoved}}),e.forEach(o=>{this.store.selectElements(o.subs)})}async _doUndoRedo(e){let s=e?this.undoRedo.tailRedoCommand:this.undoRedo.tailUndoCommand;if(s)if(s.payload.type!==Z.ElementsUpdated&&this.store.deSelectAll(),s.payload.type===Z.ElementsCreatorChanged)this.setCreator(Et.getCreatorByType(e?s.payload.creatorType:s.payload.prevCreatorType||tt.type),!1),this._tailCreatorCommandId=s.id,this.undoRedo.pop(e);else{if(e?await this.undoRedo.redo():await this.undoRedo.undo(),e&&s.payload.type===Z.ElementsCreating&&this.undoRedo.tailRedoCommand&&this.undoRedo.tailRedoCommand.payload.type===Z.ElementsAdded&&(this.store.clearCreatingElements(),await this.undoRedo.redo(),this.setCreator(tt,!1),s=this.undoRedo.tailRedoCommand),!e&&s.payload.type===Z.ElementsAdded&&this.undoRedo.tailUndoCommand&&this.undoRedo.tailUndoCommand.payload.type===Z.ElementsCreating){await H.restoreDataList(s.payload.rDataList,!0,this.store);const i=this.undoRedo.tailUndoCommand.payload.rDataList;await H.restoreDataList(i,!0,this.store),this.setCreator(Et.getCreatorByType(i[0].model.type),!1),s=this.undoRedo.tailUndoCommand}this.emit(x.primarySelectedChanged,this.store.primarySelectedElement),s&&[Z.ElementsRearranged,Z.ElementsRemoved,Z.ElementsAdded,Z.GroupAdded,Z.GroupRemoved,Z.DetachedElementsRemoved,Z.ElementsMoved,Z.ElementsCreating,Z.ElementsStartCreating].includes(s.payload.type)&&(this.store.refreshStageElements(),this.store.throttleRefreshTreeNodes()),await this._addRedrawTask(!0);const n=[Z.ElementsCreating];e&&n.push(Z.ElementsStartCreating),this._isPressDown=s&&n.includes(s.payload.type)}}async execUndo(){await this._doUndoRedo(!1)}async execRedo(){await this._doUndoRedo(!0)}async _handleTextInput(e,s,n,i){this._clearSelects();const o=k.calcWorldCoord(i),a=await this.store.insertTextElement(e,s,L.getBoxByLeftTop(o,n));window.performance.now()-this._latestMousedownTimestamp<=50&&(this._shouldSelectTopAWhilePressUp=!1),await this._addRedrawTask(!0),a.refreshTextSizeCoords(),a.refresh(),await this._tryAddAddedCommand([a]),this._emitElementsCreated([a])}async _handleTextUpdate(e,s){if(this.isTextEditing){const n=this.store.selectedElements[0],i=await n.updateText(e,s);if(!i)return;const{changed:o,reflow:a}=i;await this._addRedrawTask(!0),a&&await this._reflowTextIfy([n],!0,o)}}_processOnAlignChanged(e){e.forEach(s=>{s.onPositionChanged(),this._refreshAncestorsTransformed(s)})}async setElementsAlignLeft(e){await this.executeMethod(async()=>{await this._addTranslateCommand(e,async()=>{await this.align.setElementsAlignLeft(e),this._refreshAncesorsByDetachedElements(e)}),this._processOnAlignChanged(e)})}async setElementsAlignRight(e){this.executeMethod(async()=>{await this._addTranslateCommand(e,async()=>{await this.align.setElementsAlignRight(e),this._refreshAncesorsByDetachedElements(e)}),this._processOnAlignChanged(e)})}async setElementsAlignTop(e){this.executeMethod(async()=>{await this._addTranslateCommand(e,async()=>{await this.align.setElementsAlignTop(e),this._refreshAncesorsByDetachedElements(e)}),this._processOnAlignChanged(e)})}async setElementsAlignBottom(e){this.executeMethod(async()=>{await this._addTranslateCommand(e,async()=>{await this.align.setElementsAlignBottom(e),this._refreshAncesorsByDetachedElements(e)}),this._processOnAlignChanged(e)})}async setElementsAlignCenter(e){this.executeMethod(async()=>{await this._addTranslateCommand(e,async()=>{await this.align.setElementsAlignCenter(e),this._refreshAncesorsByDetachedElements(e)}),this._processOnAlignChanged(e)})}async setElementsAlignMiddle(e){this.executeMethod(async()=>{await this._addTranslateCommand(e,async()=>{await this.align.setElementsAlignMiddle(e),this._refreshAncesorsByDetachedElements(e)}),this._processOnAlignChanged(e)})}async setElementsAverageVertical(e){await this.executeMethod(async()=>{await this._addTranslateCommand(e,async()=>{await this.align.setElementsAverageVertical(e),this._refreshAncesorsByDetachedElements(e)}),this._processOnAlignChanged(e)})}async setElementsAverageHorizontal(e){await this.executeMethod(async()=>{await this._addTranslateCommand(e,async()=>{await this.align.setElementsAverageHorizontal(e),this._refreshAncesorsByDetachedElements(e)}),this._processOnAlignChanged(e)})}async commitArbitraryDrawing(){if(this.isArbitraryDrawing){this._isPressDown=!1;let e=!0;const s=this.store.creatingElements[0];s&&(s.model.coords.length>=2?(this.store.finishCreatingElement(),await this._afterElementCreated(),e=!1):this.store.clearCreatingElements()),e&&this._emitElementsCreated(null)}}async _addCommandAfterEditing(e){const s=await H.createDataList(e,$.Updated,{dataTransfer:async n=>await n.toJson()});await Promise.all(e.map(async n=>{n instanceof zs&&s.push(...await H.createDataList(n.ancestorGroups,$.GroupUpdated,{dataTransfer:async i=>await i.toJson(),eachOperatingFunction:async i=>{i.refreshBySubs(),i.refreshOriginals()}}))})),await this._addCommandByDataList({payload:{uDataList:this._originalEditingUDataList,rDataList:s,type:Z.ElementsUpdated}}),this._originalEditingUDataList=null}async _commitEidting(){this._addCommandAfterEditing(this.store.editingElements),this.store.endEditingElements(this.store.editingElements),this.elementsStatus=ee.NONE}async commitEditingDrawing(){this.isArbitraryEditing&&await this._commitEidting()}async _setElementsGoDown(e){const s=[],n=[];await this.store.setElementsGoDown(e,async i=>{s.push(...await H.createRearrangeDataList(i))},async i=>{n.push(...await H.createRearrangeDataList(i))}),await this._addCommandByDataList({payload:{uDataList:s,rDataList:n,type:Z.ElementsRearranged}}),e.forEach(i=>i.onLayerChanged())}async setElementsGoDown(e){await this.executeMethod(async()=>await this._setElementsGoDown(e))}async _setElementsShiftMove(e){const s=[],n=[];await this.store.setElementsShiftMove(e,async i=>{s.push(...await H.createRearrangeDataList(i))},async i=>{n.push(...await H.createRearrangeDataList(i))}),await this._addCommandByDataList({payload:{uDataList:s,rDataList:n,type:Z.ElementsRearranged}}),e.forEach(i=>i.onLayerChanged())}async setElementsShiftMove(e){await this.executeMethod(async()=>await this._setElementsShiftMove(e))}toggleElementsTarget(e,s){this.store.toggleElementsTarget(e,s)}toggleElementsDetachedSelected(e){this._addSelectedChangedCommand(async()=>await this.store.toggleElementsDetachedSelected(e))}setElementsDetachedSelectedByIds(e,s){this._addSelectedChangedCommand(async()=>await this.store.setElementsDetachedSelectedByIds(e,s))}setElementsDetachedSelected(e,s){this._addSelectedChangedCommand(async()=>await this.store.setElementsDetachedSelected(e,s))}async moveElementsTo(e,s,n){const i=[],o=[];await this.store.moveElementsTo(e,s,n,async a=>{i.push(...await H.createDataListByActionParams(a))},async a=>{o.push(...await H.createDataListByActionParams(a))}),await this._addCommandByDataList({payload:{uDataList:i,rDataList:o,type:Z.ElementsMoved}})}}const z=new ml,pl=new kr;z.configure.config({rotationIconEnable:!1});const Cl=200,yl={leading:!0,trailing:!0},se={position:{x:0,y:0},width:0,height:0,angle:0,corners:[...os.corners],flipX:!1,leanYAngle:0,scale:1,strokes:[{...en}],fills:[{...tn}],fontStyler:Ee.fontStyler,fontSize:Ee.fontSize,fontFamily:Ee.fontFamily,fontLineHeight:Ee.fontLineHeight,fontLineHeightFactor:Ee.fontLineHeightFactor,fontLineHeightAutoFit:Ee.fontLineHeightAutoFit,fontLetterSpacing:Ee.fontLetterSpacing,fontColor:Ee.fontColor,fontColorOpacity:Ee.fontColorOpacity,fontStylerMixin:!1,fontSizeMixin:!1,fontFamilyMixin:!1,fontColorMixin:!1,fontColorOpacityMixin:!1,fontLetterSpacingMixin:!1,textAlign:Ee.textAlign,textVerticalAlign:Ee.textVerticalAlign,textBaseline:Ee.textBaseline,textDecoration:Ee.textDecoration,textDecorationColor:Ee.textDecorationColor,textDecorationOpacity:Ee.textDecorationOpacity,textDecorationThickness:Ee.textDecorationThickness,textDecorationMixin:!1,textDecorationColorMixin:!1,textDecorationOpacityMixin:!1,textDecorationThicknessMixin:!1,paragraphSpacing:Ee.paragraphSpacing,textCase:Ee.textCase,isRatioLocked:!1,fillEnable:!1,strokeEnable:!1,fontEnable:!1,cornersEnable:!1,ratioLockedEnable:!1,fillInputEnable:!1,strokeInputEnable:!1,fontInputEnable:!1,fontLineHeightInputEnable:!1,fontLineHeightFactorInputEnable:!1,fontLetterSpacingInputEnable:!1,cornersInputEnable:!1,widthInputEnable:!1,heightInputEnable:!1,angleInputEnable:!1,leanYAngleInputEnable:!1,positionInputEnable:!1,paragraphSpacingInputEnable:!1,textCaseInputEnable:!1,textAlignInputEnable:!1,textVerticalAlignInputEnable:!1,status:ie.initialed},he=ai("stage",{state:()=>({currentCreator:tt,currentCursorCreator:tt,currentShapeCreator:rn,currentTextCreator:xi,currentArbitraryCreator:on,treeNodes:[],treeNodesMap:new Map,selectedElements:[],targetElements:[],isMultiSelected:!1,primarySelectedElement:null,layerShiftMoveEnable:!1,layerGoDownEnable:!1,elementsStatus:ee.NONE,...V.jsonClone(se)}),getters:{inputDisabled(){return!this.primarySelectedElement},alignEnable(){var r;return((r=this.selectedElements)==null?void 0:r.length)>=2},rotateEnable(){var r;return((r=this.selectedElements)==null?void 0:r.length)>=1},averageEnable(){var r;return((r=this.selectedElements)==null?void 0:r.length)>=3},arbitraryVisible(){var r;return((r=this.currentCreator)==null?void 0:r.type)===A.arbitrary},shouldUIPassThrough(){return[ee.MOVING,ee.ROTATING,ee.TRANSFORMING,ee.CORNER_MOVING].includes(this.elementsStatus)}},actions:{async init(r){await pl.init(r.containerEl),await z.init(r.shieldEl),this.setCreator(tt,!1),[[x.elementCreated,this.onElementCreated],[x.selectedChanged,this.onSelectedChanged],[x.targetChanged,this.onTargetChanged],[x.multiSelectedChanged,this.onMultiSelectedChanged],[x.primarySelectedChanged,this.onPrimarySelectedChanged],[x.treeNodesChanged,this.onTreeNodesChanged],[x.treeNodePropsChanged,this.onTreeNodePropsChanged],[x.elementsStatusChanged,this.onElementsStatusChanged]].forEach(([t,e])=>{z.on(t,e.bind(this))}),[[x.positionChanged,this.onPositionChanged],[x.widthChanged,this.onWidthChanged],[x.heightChanged,this.onHeightChanged],[x.angleChanged,this.onAngleChanged],[x.cornersChanged,this.onCornersChanged],[x.flipXChanged,this.onFlipXChanged],[x.leanYAngleChanged,this.onLeanYAngleChanged],[x.scaleChanged,this.onScaleChanged],[x.strokesChanged,this.onStrokesChanged],[x.fillsChanged,this.onFillsChanged],[x.statusChanged,this.onStatusChanged],[x.fontStylerChanged,this.onFontStylerChanged],[x.fontSizeChanged,this.onFontSizeChanged],[x.fontFamilyChanged,this.onFontFamilyChanged],[x.fontLineHeightChanged,this.onFontLineHeightChanged],[x.fontLineHeightFactorChanged,this.onFontLineHeightFactorChanged],[x.fontLineHeightAutoFitChanged,this.onFontLineHeightAutoFitChanged],[x.fontLetterSpacingChanged,this.onFontLetterSpacingChanged],[x.fontColorChanged,this.onFontColorChanged],[x.fontColorOpacityChanged,this.onFontColorOpacityChanged],[x.fontStylerMixinChanged,this.onFontStylerMixinChanged],[x.fontSizeMixinChanged,this.onFontSizeMixinChanged],[x.fontFamilyMixinChanged,this.onFontFamilyMixinChanged],[x.fontColorMixinChanged,this.onFontColorMixinChanged],[x.fontColorOpacityMixinChanged,this.onFontColorOpacityMixinChanged],[x.fontLetterSpacingMixinChanged,this.onFontLetterSpacingMixinChanged],[x.textDecorationChanged,this.onTextDecorationChanged],[x.textDecorationColorChanged,this.onTextDecorationColorChanged],[x.textDecorationOpacityChanged,this.onTextDecorationOpacityChanged],[x.textDecorationThicknessChanged,this.onTextDecorationThicknessChanged],[x.textDecorationMixinChanged,this.onTextDecorationMixinChanged],[x.textDecorationColorMixinChanged,this.onTextDecorationColorMixinChanged],[x.textDecorationOpacityMixinChanged,this.onTextDecorationOpacityMixinChanged],[x.textDecorationThicknessMixinChanged,this.onTextDecorationThicknessMixinChanged],[x.textAlignChanged,this.onTextAlignChanged],[x.textVerticalAlignChanged,this.onTextVerticalAlignChanged],[x.textBaselineChanged,this.onTextBaselineChanged],[x.ratioLockedChanged,this.onRatioLockedChanged],[x.creatorChanged,this.onCreatorChanged],[x.layerShiftMoveEnableChanged,this.onLayerShiftMoveEnableChanged],[x.layerGoDownEnableChanged,this.onLayerGoDownEnableChanged],[x.paragraphSpacingChanged,this.onParagraphSpacingChanged],[x.textCaseChanged,this.onTextCaseChanged]].forEach(([t,e])=>{z.on(t,R.throttle(e.bind(this),Cl,yl))})},async setCreator(r,t){await z.setCreator(r,t)},onCreatorChanged(r){this.currentCreator=r,r.category===_e.cursor&&(this.currentCursorCreator=r),r.category===_e.shapes&&(this.currentShapeCreator=r),r.category===_e.freedom&&(this.currentArbitraryCreator=r)},onMultiSelectedChanged(r){this.isMultiSelected=r},onPrimarySelectedChanged(r){this.primarySelectedElement=r,this.onElementChanged(r)},_recusiveAddNode(r){var t;this.treeNodesMap.set(r.id,r),(t=r.children)!=null&&t.length&&r.children.forEach(e=>{this._recusiveAddNode(e)})},onTreeNodesChanged(r){this.treeNodes=r,this.treeNodesMap.clear(),r.forEach(t=>{this._recusiveAddNode(t)})},onTreeNodePropsChanged(r,t){const e=this.treeNodesMap.get(r);e&&Object.assign(e,t)},onElementsStatusChanged(r){this.elementsStatus=r},onElementCreated(r){this.onElementChanged(!r||r.length===0?null:r[0])},onSelectedChanged(r){this.selectedElements=r},onElementChanged(r){if(!r){Object.assign(this,V.jsonClone(se));return}const{status:t,position:e,width:s,height:n,angle:i,corners:o,flipX:a,leanYAngle:l,strokes:c,fills:d,fontStyler:u,fontSize:f,fontFamily:g,fontColor:C,fontColorOpacity:y,fontStylerMixin:E,fontSizeMixin:b,fontFamilyMixin:F,fontColorMixin:N,fontColorOpacityMixin:w,fontLetterSpacingMixin:v,fontLineHeight:P,fontLineHeightFactor:D,fontLineHeightAutoFit:M,fontLetterSpacing:J,textAlign:K,textVerticalAlign:ge,textBaseline:Ie,isRatioLocked:Ze,textDecoration:st,textDecorationColor:ht,textDecorationOpacity:Le,textDecorationThickness:ut,textDecorationMixin:et,textDecorationColorMixin:ke,textDecorationOpacityMixin:nt,textDecorationThicknessMixin:Ls,paragraphSpacing:Xt,textCase:Ve}=r;this.onStatusChanged(r,t),this.onPositionChanged(r,e),this.onWidthChanged(r,s),this.onHeightChanged(r,n),this.onAngleChanged(r,i),this.onCornersChanged(r,o),this.onFlipXChanged(r,a),this.onLeanYAngleChanged(r,l),this.onStrokesChanged(r,c),this.onFillsChanged(r,d),this.onFontStylerChanged(r,u),this.onFontSizeChanged(r,f),this.onFontFamilyChanged(r,g),this.onFontLineHeightChanged(r,P),this.onFontLineHeightFactorChanged(r,D),this.onFontLineHeightAutoFitChanged(r,M),this.onFontLetterSpacingChanged(r,J),this.onFontColorChanged(r,C),this.onFontColorOpacityChanged(r,y),this.onFontStylerMixinChanged(r,E),this.onFontSizeMixinChanged(r,b),this.onFontFamilyMixinChanged(r,F),this.onFontColorMixinChanged(r,N),this.onFontColorOpacityMixinChanged(r,w),this.onFontLetterSpacingMixinChanged(r,v),this.onTextAlignChanged(r,K),this.onTextVerticalAlignChanged(r,ge),this.onTextBaselineChanged(r,Ie),this.onRatioLockedChanged(r,Ze),this.onTextDecorationChanged(r,st),this.onTextDecorationColorChanged(r,ht),this.onTextDecorationOpacityChanged(r,Le),this.onTextDecorationThicknessChanged(r,ut),this.onTextDecorationMixinChanged(r,et),this.onTextDecorationColorMixinChanged(r,ke),this.onTextDecorationOpacityMixinChanged(r,nt),this.onTextDecorationThicknessMixinChanged(r,Ls),this.onParagraphSpacingChanged(r,Xt),this.onTextCaseChanged(r,Ve)},onTargetChanged(r){this.targetElements=r,this.targetElementIds=r.map(t=>t.id)},onStatusChanged(r,t){this.status=t;const{fillEnable:e,strokeEnable:s,fontEnable:n,cornersEnable:i,ratioLockedEnable:o,widthInputEnable:a,heightInputEnable:l,fillInputEnable:c,strokeInputEnable:d,fontInputEnable:u,fontLineHeightInputEnable:f,fontLineHeightFactorInputEnable:g,fontLetterSpacingInputEnable:C,cornersInputEnable:y,angleInputEnable:E,leanYAngleInputEnable:b,positionInputEnable:F,paragraphSpacingInputEnable:N,textCaseInputEnable:w,textAlignInputEnable:v,textVerticalAlignInputEnable:P}=r;this.fillEnable=e,this.strokeEnable=s,this.fontEnable=n,this.cornersEnable=i,this.ratioLockedEnable=o,this.widthInputEnable=a,this.heightInputEnable=l,this.fillInputEnable=c,this.strokeInputEnable=d,this.fontInputEnable=u,this.fontLineHeightInputEnable=f,this.fontLineHeightFactorInputEnable=g,this.fontLetterSpacingInputEnable=C,this.angleInputEnable=E,this.leanYAngleInputEnable=b,this.cornersInputEnable=y,this.positionInputEnable=F,this.paragraphSpacingInputEnable=N,this.textCaseInputEnable=w,this.textAlignInputEnable=v,this.textVerticalAlignInputEnable=P},onPositionChanged(r,t){t&&(this.position={x:t.x,y:t.y})},onWidthChanged(r,t){this.width=t},onHeightChanged(r,t){this.height=t},onAngleChanged(r,t){this.angle=t},onCornersChanged(r,t){this.corners=[...t]},onFlipXChanged(r,t){this.flipX=t},onLeanYAngleChanged(r,t){this.leanYAngle=t},onScaleChanged(r){this.scale=r},onStrokesChanged(r,t=[]){this.strokes=V.jsonClone(t)},onFillsChanged(r,t=[]){this.fills=V.jsonClone(t)},onFontStylerChanged(r,t){this.fontStyler=t},onFontSizeChanged(r,t){this.fontSize=t},onFontFamilyChanged(r,t){this.fontFamily=t},onFontLineHeightChanged(r,t){this.fontLineHeight=t},onFontLineHeightFactorChanged(r,t){this.fontLineHeightFactor=t},onFontLineHeightAutoFitChanged(r,t){this.fontLineHeightAutoFit=t},onFontLetterSpacingChanged(r,t){this.fontLetterSpacing=t},onFontColorChanged(r,t){this.fontColor=t},onFontColorOpacityChanged(r,t){this.fontColorOpacity=t},onFontStylerMixinChanged(r,t){this.fontStylerMixin=t},onFontSizeMixinChanged(r,t){this.fontSizeMixin=t},onFontFamilyMixinChanged(r,t){this.fontFamilyMixin=t},onFontColorMixinChanged(r,t){this.fontColorMixin=t},onFontColorOpacityMixinChanged(r,t){this.fontColorOpacityMixin=t},onFontLetterSpacingMixinChanged(r,t){this.fontLetterSpacingMixin=t},onTextAlignChanged(r,t){this.textAlign=t},onTextVerticalAlignChanged(r,t){this.textVerticalAlign=t},onTextBaselineChanged(r,t){this.textBaseline=t},onTextDecorationChanged(r,t){this.textDecoration=t},onTextDecorationColorChanged(r,t){this.textDecorationColor=t},onTextDecorationOpacityChanged(r,t){this.textDecorationOpacity=t},onTextDecorationThicknessChanged(r,t){this.textDecorationThickness=t},onTextDecorationMixinChanged(r,t){this.textDecorationMixin=t},onTextDecorationColorMixinChanged(r,t){this.textDecorationColorMixin=t},onTextDecorationOpacityMixinChanged(r,t){this.textDecorationOpacityMixin=t},onTextDecorationThicknessMixinChanged(r,t){this.textDecorationThicknessMixin=t},onRatioLockedChanged(r,t){this.isRatioLocked=t},onParagraphSpacingChanged(r,t){this.paragraphSpacing=t},onTextCaseChanged(r,t){this.textCase=t},onLayerShiftMoveEnableChanged(r){this.layerShiftMoveEnable=r},onLayerGoDownEnableChanged(r){this.layerGoDownEnable=r},setElementsPosition(r){z.setElementsPosition(U(this.selectedElements),r)},setElementsWidth(r){z.setElementsWidth(U(this.selectedElements),r)},setElementsHeight(r){z.setElementsHeight(U(this.selectedElements),r)},setElementsAngle(r){z.setElementsAngle(U(this.selectedElements),r)},setElementsCorners(r,t){z.setElementsCorners(U(this.selectedElements),r,t)},setElementsLeanYAngle(r){z.setElementsLeanYAngle(U(this.selectedElements),r)},setElementsStrokeType(r,t){z.setElementsStrokeType(U(this.selectedElements),r,t)},setElementsStrokeWidth(r,t){z.setElementsStrokeWidth(U(this.selectedElements),r,t)},setElementsStrokeColor(r,t){z.setElementsStrokeColor(U(this.selectedElements),r,t)},setElementsStrokeColorOpacity(r,t){z.setElementsStrokeColorOpacity(U(this.selectedElements),r,t)},addElementsStroke(r){z.addElementsStroke(U(this.selectedElements),r)},removeElementsStroke(r){z.removeElementsStroke(U(this.selectedElements),r)},setElementsFillColor(r,t){z.setElementsFillColor(U(this.selectedElements),r,t)},setElementsFillColorOpacity(r,t){z.setElementsFillColorOpacity(U(this.selectedElements),r,t)},addElementsFill(r){z.addElementsFill(U(this.selectedElements),r)},removeElementsFill(r){z.removeElementsFill(U(this.selectedElements),r)},setElementsTextAlign(r){z.setElementsTextAlign(U(this.selectedElements),r)},setElementsTextVerticalAlign(r){z.setElementsTextVerticalAlign(U(this.selectedElements),r)},setElementsTextBaseline(r){z.setElementsTextBaseline(U(this.selectedElements),r)},setElementsFontStyler(r){z.setElementsFontStyler(U(this.selectedElements),r)},setElementsFontSize(r){z.setElementsFontSize(U(this.selectedElements),r)},setElementsFontFamily(r){z.setElementsFontFamily(U(this.selectedElements),r)},setElementsFontLineHeight(r){z.setElementsFontLineHeight(U(this.selectedElements),r)},setElementsFontLineHeightFactor(r){z.setElementsFontLineHeightFactor(U(this.selectedElements),r)},setElementsFontLineHeightAutoFit(r){z.setElementsFontLineHeightAutoFit(U(this.selectedElements),r)},setElementsFontColor(r){z.setElementsFontColor(U(this.selectedElements),r)},setElementsFontColorOpacity(r){z.setElementsFontColorOpacity(U(this.selectedElements),r)},setElementsFontLetterSpacing(r){z.setElementsFontLetterSpacing(U(this.selectedElements),r)},setElementsTextDecoration(r){z.setElementsTextDecoration(U(this.selectedElements),r)},setElementsTextDecorationColor(r){z.setElementsTextDecorationColor(U(this.selectedElements),r)},setElementsTextDecorationOpacity(r){z.setElementsTextDecorationOpacity(U(this.selectedElements),r)},setElementsTextDecorationThickness(r){z.setElementsTextDecorationThickness(U(this.selectedElements),r)},setScale(r){z.setScale(r)},setScaleAutoFit(){z.setScaleAutoFit()},setScaleIncrease(){z.setScaleIncrease()},setScaleReduce(){z.setScaleReduce()},setRatioLocked(r){z.setElementsRatioLocked(U(this.selectedElements),r)},setElementsAlignLeft(){this.alignEnable&&z.setElementsAlignLeft(U(this.selectedElements))},setElementsAlignCenter(){this.alignEnable&&z.setElementsAlignCenter(U(this.selectedElements))},setElementsAlignRight(){this.alignEnable&&z.setElementsAlignRight(U(this.selectedElements))},setElementsAlignTop(){this.alignEnable&&z.setElementsAlignTop(U(this.selectedElements))},setElementsAlignMiddle(){this.alignEnable&&z.setElementsAlignMiddle(U(this.selectedElements))},setElementsAlignBottom(){this.alignEnable&&z.setElementsAlignBottom(U(this.selectedElements))},setElementsAverageVertical(){this.averageEnable&&z.setElementsAverageVertical(U(this.selectedElements))},setElementsAverageHorizontal(){this.averageEnable&&z.setElementsAverageHorizontal(U(this.selectedElements))},setElementsGoDown(){this.layerGoDownEnable&&z.setElementsGoDown(U(this.selectedElements))},setElementsShiftMove(){this.layerShiftMoveEnable&&z.setElementsShiftMove(U(this.selectedElements))},setElementsRotate(r){this.rotateEnable&&z.setElementsRotate(U(this.selectedElements),r)},uploadImages(r){r.length&&z.uploadImages(r)},commitArbitraryDrawing(){z.commitArbitraryDrawing()},setElementsParagraphSpacing(r){z.setElementsParagraphSpacing(U(this.selectedElements),r)},setElementsTextCase(r){z.setElementsTextCase(U(this.selectedElements),r)},setElementsFlipX(){z.setElementsFlipX(U(this.selectedElements))},setElementsFlipY(){z.setElementsFlipY(U(this.selectedElements))},toggleElementsTarget(r,t){z.toggleElementsTarget(U(r),t)},toggleElementsDetachedSelected(r){z.toggleElementsDetachedSelected(U(r))},setElementsDetachedSelectedByIds(r,t){z.setElementsDetachedSelectedByIds(U(r),t)},moveElementsTo(r,t,e){z.moveElementsTo(U(r),t,e)}}}),_l={class:Y(["layer-props right-props"])},El={class:"layer-props__row"},xl=de({__name:"LayerProps",setup(r){const t=he();return(e,s)=>{const n=Ne,i=Gt;return W(),q("div",_l,[s[0]||(s[0]=T("div",{class:"layer-props__title"},[T("span",{class:"layer-props__title-text"},"层级")],-1)),T("div",El,[_(i,{effect:"dark",content:"下移"},{default:O(()=>[_(n,{class:Y(["iconfont","icon-verbise-layer-go-down",{disabled:!m(t).layerGoDownEnable}]),onClick:m(t).setElementsGoDown},null,8,["class","onClick"])]),_:1}),_(i,{effect:"dark",content:"上移"},{default:O(()=>[_(n,{class:Y(["iconfont","icon-verbise-layer-shift-move",{disabled:!m(t).layerShiftMoveEnable}]),onClick:m(t).setElementsShiftMove},null,8,["class","onClick"])]),_:1})])])}}}),fe=(r,t)=>{const e=r.__vccOpts||r;for(const[s,n]of t)e[s]=n;return e},Sl=fe(xl,[["__scopeId","data-v-9ce2eae1"]]),bl={class:"stroke-props right-props"},vl={class:"stroke-props__title"},wl={class:"stroke-props__row color"},Tl={class:"stroke-props__row-item"},Al={class:"stroke-props__row-item",style:{width:"106px"}},Ol={class:"stroke-props__row"},Il={class:"stroke-props__row-item"},Ll={class:"stroke-props__row-item",style:{width:"106px"}},Pl=de({__name:"StrokeProps",setup(r){const t=Q(),e=he(),s=Q([...se.strokes]);oe(()=>e.strokes,o=>{s.value=o});const n=Q([]);oe(()=>{var o;return(o=e.primarySelectedElement)==null?void 0:o.model.type},o=>{n.value=Vr(o)});const i=()=>{e.strokeInputEnable&&t.value.show()};return(o,a)=>{const l=Ne,c=ms,d=ps,u=ze,f=St,g=bt;return xe((W(),q("div",bl,[T("div",vl,[a[1]||(a[1]=T("span",{class:"stroke-props__title-text"},"描边",-1)),_(l,null,{default:O(()=>[_(m(di),{onClick:a[0]||(a[0]=C=>m(e).addElementsStroke(s.value.length-1))})]),_:1})]),(W(!0),q(De,null,Me(s.value,(C,y)=>{var E;return W(),q("div",{key:y},[T("div",wl,[T("div",Tl,[_(c,{modelValue:C.color,"onUpdate:modelValue":b=>C.color=b,onChange:b=>m(e).setElementsStrokeColor(b,y),ref_for:!0,ref_key:"colorPickerRef",ref:t,disabled:m(e).inputDisabled||!m(e).strokeInputEnable},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),_(d,{type:"info",onClick:i},{default:O(()=>[X(Ce(C.color),1)]),_:2},1024)]),T("div",Al,[_(u,{modelValue:C.colorOpacity,"onUpdate:modelValue":b=>C.colorOpacity=b,placeholder:"输入数字",type:"number",min:"0",max:"100",precision:"0",onChange:b=>m(e).setElementsStrokeColorOpacity(Number(b),y),disabled:m(e).inputDisabled||!m(e).strokeInputEnable},{prepend:O(()=>a[2]||(a[2]=[X("透明")])),append:O(()=>a[3]||(a[3]=[X("%")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"])]),_(l,null,{default:O(()=>[xe(_(m(hi),{onClick:b=>m(e).removeElementsStroke(y)},null,8,["onClick"]),[[Se,s.value.length>1]])]),_:2},1024)]),T("div",Ol,[T("div",Il,[_(g,{modelValue:C.type,"onUpdate:modelValue":b=>C.type=b,placeholder:"描边类型",size:"small",onChange:b=>m(e).setElementsStrokeType(b,y),disabled:m(e).inputDisabled||!m(e).strokeInputEnable},{default:O(()=>[(W(!0),q(De,null,Me(n.value,b=>(W(),Te(f,{key:b.type,label:b.name,value:b.type},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"])]),T("div",Ll,[_(u,{modelValue:C.width,"onUpdate:modelValue":b=>C.width=b,placeholder:"输入数字",type:"number",precision:"1",min:((E=m(e).primarySelectedElement)==null?void 0:E.model.type)===m(A).line?1:0,onChange:b=>m(e).setElementsStrokeWidth(Number(b),y),disabled:m(e).inputDisabled||!m(e).strokeInputEnable},{prepend:O(()=>a[4]||(a[4]=[X("宽度")])),append:O(()=>a[5]||(a[5]=[X("px")])),_:2},1032,["modelValue","onUpdate:modelValue","min","onChange","disabled"])])])])}),128))],512)),[[Se,m(e).strokeEnable]])}}}),Rl=fe(Pl,[["__scopeId","data-v-f3aaa8ff"]]),kl={class:"fill-props right-props"},Fl={class:"fill-props__title"},Bl={class:"fill-props__row color"},Dl={class:"fill-props__row-item"},Ml={class:"fill-props__row-item",style:{width:"106px"}},Nl=de({__name:"FillProps",setup(r){const t=Q(),e=he(),s=Q([...se.fills]);oe(()=>e.fills,i=>{s.value=i});const n=()=>{e.fillInputEnable&&t.value.show()};return(i,o)=>{const a=Ne,l=ms,c=ps,d=ze;return xe((W(),q("div",kl,[T("div",Fl,[o[1]||(o[1]=T("span",{class:"fill-props__title-text"},"填充",-1)),_(a,null,{default:O(()=>[_(m(di),{onClick:o[0]||(o[0]=u=>m(e).addElementsFill(s.value.length-1))})]),_:1})]),(W(!0),q(De,null,Me(s.value,(u,f)=>(W(),q("div",{key:f},[T("div",Bl,[T("div",Dl,[_(l,{modelValue:u.color,"onUpdate:modelValue":g=>u.color=g,onChange:g=>m(e).setElementsFillColor(g,f),ref_for:!0,ref_key:"colorPickerRef",ref:t,disabled:m(e).inputDisabled||!m(e).fillInputEnable},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),_(c,{type:"info",onClick:n},{default:O(()=>[X(Ce(u.color),1)]),_:2},1024)]),T("div",Ml,[_(d,{modelValue:u.colorOpacity,"onUpdate:modelValue":g=>u.colorOpacity=g,placeholder:"输入数字",type:"number",min:"0",max:"100",precision:"0",onChange:g=>m(e).setElementsFillColorOpacity(Number(g),f),disabled:m(e).inputDisabled||!m(e).fillInputEnable},{prepend:O(()=>o[2]||(o[2]=[X("透明")])),append:O(()=>o[3]||(o[3]=[X("%")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"])]),_(a,null,{default:O(()=>[xe(_(m(hi),{onClick:g=>m(e).removeElementsFill(f)},null,8,["onClick"]),[[Se,s.value.length>1]])]),_:2},1024)])]))),128))],512)),[[Se,m(e).fillEnable]])}}}),Vl=fe(Nl,[["__scopeId","data-v-0c1de375"]]),Hl={class:Y(["font-props right-props"])},Wl={class:"font-props__row"},zl={class:"fill-props__row-item"},jl={class:"fill-props__row-item",style:{width:"106px"}},Gl={class:"font-props__row color"},$l={class:"font-props__row-item"},Yl={class:"font-props__row-item",style:{width:"106px"}},Ul=de({__name:"FontTextDecorationProps",setup(r){const t=he(),e=Q(),s=Q(se.textDecoration),n=Q(se.textDecorationThickness),i=Q(se.textDecorationThicknessMixin),o=Q(se.textDecorationColor),a=Q(se.textDecorationOpacity),l=Q(se.textDecorationColorMixin),c=Q(se.textDecorationOpacityMixin);oe(()=>t.textDecoration,u=>{s.value=u}),oe(()=>t.textDecorationThickness,u=>{n.value=u}),oe(()=>t.textDecorationThicknessMixin,u=>{i.value=u}),oe(()=>t.textDecorationColor,u=>{o.value=u}),oe(()=>t.textDecorationColorMixin,u=>{l.value=u}),oe(()=>t.textDecorationOpacity,u=>{a.value=u}),oe(()=>t.textDecorationOpacityMixin,u=>{c.value=u});const d=()=>{t.fontInputEnable&&e.value.show()};return(u,f)=>{const g=Cs,C=ys,y=ze,E=ms,b=ps;return xe((W(),q("div",Hl,[f[14]||(f[14]=T("div",{class:"font-props__title"},[T("span",{class:"font-props__title-text text-2"},"文本装饰")],-1)),T("div",Wl,[T("div",zl,[_(C,null,{default:O(()=>[_(g,{type:s.value===m(Pe).none?"success":"default",disabled:m(t).inputDisabled||!m(t).fontInputEnable,class:Y(["iconfont","icon-verbise-decoration-none"]),title:"无装饰",onClick:f[0]||(f[0]=F=>m(t).setElementsTextDecoration(m(Pe).none))},null,8,["type","disabled"]),_(g,{type:s.value===m(Pe).underline?"success":"default",disabled:m(t).inputDisabled||!m(t).fontInputEnable,class:Y(["iconfont","icon-verbise-decoration-underline"]),title:"下划线",onClick:f[1]||(f[1]=F=>m(t).setElementsTextDecoration(m(Pe).underline))},null,8,["type","disabled"]),_(g,{type:s.value===m(Pe).overline?"success":"default",disabled:m(t).inputDisabled||!m(t).fontInputEnable,class:Y(["iconfont","icon-verbise-decoration-overline"]),title:"上划线",onClick:f[2]||(f[2]=F=>m(t).setElementsTextDecoration(m(Pe).overline))},null,8,["type","disabled"]),_(g,{type:s.value===m(Pe).lineThrough?"success":"default",disabled:m(t).inputDisabled||!m(t).fontInputEnable,class:Y(["iconfont","icon-verbise-decoration-line-through"]),title:"删除线",onClick:f[3]||(f[3]=F=>m(t).setElementsTextDecoration(m(Pe).lineThrough))},null,8,["type","disabled"])]),_:1})]),T("div",jl,[_(y,{modelValue:n.value,"onUpdate:modelValue":f[4]||(f[4]=F=>n.value=F),disabled:m(t).inputDisabled||!m(t).fontInputEnable,size:"small",placeholder:`${i.value?"混合线宽":`${n.value}px`}`,type:"number",min:1,max:100,precision:0,onChange:f[5]||(f[5]=F=>m(t).setElementsTextDecorationThickness(Number(F)))},{prepend:O(()=>f[10]||(f[10]=[X("线宽")])),append:O(()=>f[11]||(f[11]=[X("px")])),_:1},8,["modelValue","disabled","placeholder"])])]),T("div",Gl,[T("div",$l,[_(E,{modelValue:o.value,"onUpdate:modelValue":f[6]||(f[6]=F=>o.value=F),onChange:f[7]||(f[7]=F=>m(t).setElementsTextDecorationColor(F)),ref_key:"colorPickerRef",ref:e,disabled:m(t).inputDisabled||!m(t).fontInputEnable},null,8,["modelValue","disabled"]),_(b,{type:"info",onClick:d},{default:O(()=>[X(Ce(`${l.value?"混合颜色":o.value}`),1)]),_:1})]),T("div",Yl,[_(y,{modelValue:a.value,"onUpdate:modelValue":f[8]||(f[8]=F=>a.value=F),placeholder:`${c.value?"混合透明度":a.value}`,type:"number",min:"0",max:"100",precision:0,onChange:f[9]||(f[9]=F=>m(t).setElementsTextDecorationOpacity(Number(F))),disabled:m(t).inputDisabled||!m(t).fontInputEnable},{prepend:O(()=>f[12]||(f[12]=[X("透明")])),append:O(()=>f[13]||(f[13]=[X("%")])),_:1},8,["modelValue","placeholder","disabled"])])])],512)),[[Se,m(t).fontEnable]])}}}),Xl=fe(Ul,[["__scopeId","data-v-1c9eb4d2"]]),ql={class:Y(["font-props right-props"])},Jl={class:"font-props__row"},Kl={class:"fill-props__row-item"},Ql={class:"fill-props__row-item"},Zl=de({__name:"FontAlignProps",setup(r){const t=he(),e=Q(se.textAlign),s=Q(se.textVerticalAlign);return oe(()=>t.textAlign,n=>{e.value=n}),oe(()=>t.textVerticalAlign,n=>{s.value=n}),(n,i)=>{const o=Cs,a=ys;return xe((W(),q("div",ql,[i[6]||(i[6]=T("div",{class:"font-props__title"},[T("span",{class:"font-props__title-text text-2"},"文本对齐")],-1)),T("div",Jl,[T("div",Kl,[_(a,null,{default:O(()=>[_(o,{type:e.value==="left"?"success":"default",disabled:m(t).inputDisabled||!m(t).textAlignInputEnable,class:Y(["iconfont","icon-verbise-text-align-left"]),onClick:i[0]||(i[0]=l=>m(t).setElementsTextAlign("left"))},null,8,["type","disabled"]),_(o,{type:e.value==="center"?"success":"default",disabled:m(t).inputDisabled||!m(t).textAlignInputEnable,class:Y(["iconfont","icon-verbise-text-align-center"]),onClick:i[1]||(i[1]=l=>m(t).setElementsTextAlign("center"))},null,8,["type","disabled"]),_(o,{type:e.value==="right"?"success":"default",disabled:m(t).inputDisabled||!m(t).textAlignInputEnable,class:Y(["iconfont","icon-verbise-text-align-right"]),onClick:i[2]||(i[2]=l=>m(t).setElementsTextAlign("right"))},null,8,["type","disabled"])]),_:1})]),T("div",Ql,[_(a,null,{default:O(()=>[_(o,{type:s.value===m(ot).top?"success":"default",disabled:m(t).inputDisabled||!m(t).textVerticalAlignInputEnable,class:Y(["iconfont","icon-verbise-vertical-align-top"]),onClick:i[3]||(i[3]=l=>m(t).setElementsTextVerticalAlign(m(ot).top))},null,8,["type","disabled"]),_(o,{type:s.value===m(ot).middle?"success":"default",disabled:m(t).inputDisabled||!m(t).textVerticalAlignInputEnable,class:Y(["iconfont","icon-verbise-vertical-align-middle"]),onClick:i[4]||(i[4]=l=>m(t).setElementsTextVerticalAlign(m(ot).middle))},null,8,["type","disabled"]),_(o,{type:s.value===m(ot).bottom?"success":"default",disabled:m(t).inputDisabled||!m(t).textVerticalAlignInputEnable,class:Y(["iconfont","icon-verbise-vertical-align-bottom"]),onClick:i[5]||(i[5]=l=>m(t).setElementsTextVerticalAlign(m(ot).bottom))},null,8,["type","disabled"])]),_:1})])])],512)),[[Se,m(t).fontEnable]])}}}),ec=fe(Zl,[["__scopeId","data-v-6f288b99"]]),tc={class:"font-props right-props"},sc={class:"font-props__row"},nc={class:"font-props__row-item"},ic=de({__name:"FontParagraphSpacingProps",setup(r){const t=he(),e=Q(se.paragraphSpacing);return oe(()=>t.paragraphSpacing,s=>{e.value=s}),(s,n)=>{const i=St,o=ze,a=bt;return xe((W(),q("div",tc,[n[6]||(n[6]=T("div",{class:"font-props__title"},[T("span",{class:"font-props__title-text text-2"},"段落间距")],-1)),T("div",sc,[T("div",nc,[_(a,{modelValue:e.value,"onUpdate:modelValue":n[2]||(n[2]=l=>e.value=l),placeholder:"",size:"small",onChange:n[3]||(n[3]=l=>m(t).setElementsParagraphSpacing(l)),disabled:m(t).inputDisabled||!m(t).paragraphSpacingInputEnable},{header:O(()=>[_(o,{modelValue:e.value,"onUpdate:modelValue":n[0]||(n[0]=l=>e.value=l),disabled:m(t).inputDisabled||!m(t).paragraphSpacingInputEnable,size:"small",placeholder:"",type:"number",min:0,max:100,precision:0,onChange:n[1]||(n[1]=l=>m(t).setElementsParagraphSpacing(Number(l)))},{prepend:O(()=>n[4]||(n[4]=[X("自定义")])),append:O(()=>n[5]||(n[5]=[X("px")])),_:1},8,["modelValue","disabled"])]),default:O(()=>[(W(!0),q(De,null,Me(m(go),l=>(W(),Te(i,{key:l.name,label:`${l.value}px`,value:l.value},{default:O(()=>[X(Ce(l.value)+"px ",1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])])],512)),[[Se,m(t).fontEnable]])}}}),rc=fe(ic,[["__scopeId","data-v-48bef6db"]]),oc={class:"font-props right-props"},ac={class:"font-props__row"},lc={class:"font-props__row-item"},cc=de({__name:"FontLetterSpacingProps",setup(r){const t=he(),e=Q(se.fontLetterSpacing),s=Q(se.fontLetterSpacingMixin);return oe(()=>t.fontLetterSpacing,n=>{e.value=n}),oe(()=>t.fontLetterSpacingMixin,n=>{s.value=n}),(n,i)=>{const o=St,a=ze,l=bt;return xe((W(),q("div",oc,[i[6]||(i[6]=T("div",{class:"font-props__title"},[T("span",{class:"font-props__title-text text-2"},"字间距")],-1)),T("div",ac,[T("div",lc,[_(l,{modelValue:e.value,"onUpdate:modelValue":i[2]||(i[2]=c=>e.value=c),placeholder:`${m(t).fontLetterSpacingMixin?"混合字间距":`${e.value}px`}`,size:"small",onChange:i[3]||(i[3]=c=>m(t).setElementsFontLetterSpacing(c)),disabled:m(t).inputDisabled||!m(t).fontLetterSpacingInputEnable},{header:O(()=>[_(a,{modelValue:e.value,"onUpdate:modelValue":i[0]||(i[0]=c=>e.value=c),disabled:m(t).inputDisabled||!m(t).fontLetterSpacingInputEnable,size:"small",placeholder:`${m(t).fontLetterSpacingMixin?"混合字间距":`${e.value}px`}`,type:"number",min:1,max:100,precision:0,onChange:i[1]||(i[1]=c=>m(t).setElementsFontLetterSpacing(Number(c)))},{prepend:O(()=>i[4]||(i[4]=[X("自定义")])),append:O(()=>i[5]||(i[5]=[X("px")])),_:1},8,["modelValue","disabled","placeholder"])]),default:O(()=>[(W(!0),q(De,null,Me(m(fo),c=>(W(),Te(o,{key:c.name,label:`${c.value}px`,value:c.value},{default:O(()=>[X(Ce(c.value)+"px ",1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","disabled"])])])],512)),[[Se,m(t).fontEnable]])}}}),dc=fe(cc,[["__scopeId","data-v-ae55509c"]]),hc={class:"font-props right-props"},uc={class:"font-props__title"},fc={class:"font-props__row"},gc={class:"font-props__row-item"},mc={class:"font-props__row"},pc={class:"font-props__row-item"},Cc=de({__name:"FontLineHeightProps",setup(r){const t=he(),e=Q(se.fontLineHeight),s=Q(se.fontLineHeightFactor),n=Q(se.fontLineHeightAutoFit),i=Q(se.fontLineHeightFactorInputEnable);return oe(()=>t.fontLineHeight,o=>{e.value=o}),oe(()=>t.fontLineHeightFactor,o=>{s.value=o}),oe(()=>t.fontLineHeightAutoFit,o=>{n.value=o}),oe(()=>t.fontLineHeightFactorInputEnable,o=>{i.value=o}),(o,a)=>{const l=Er,c=Gt,d=St,u=ze,f=bt;return xe((W(),q("div",hc,[T("div",uc,[a[10]||(a[10]=T("span",{class:"font-props__title-text text-2"},"行高",-1)),_(c,{class:"item",effect:"dark",content:`点击${m(t).fontLineHeightAutoFit?"关闭":"开启"}按字号自动适应行高功能，当前行高${m(t).fontLineHeight}px`,placement:"top"},{default:O(()=>[_(l,{modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=g=>n.value=g),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"自适应行高","inactive-text":"自定义行高",onChange:a[1]||(a[1]=g=>m(t).setElementsFontLineHeightAutoFit(g))},null,8,["modelValue"])]),_:1},8,["content"])]),xe(T("div",fc,[T("div",gc,[_(f,{modelValue:s.value,"onUpdate:modelValue":a[4]||(a[4]=g=>s.value=g),size:"small",onChange:a[5]||(a[5]=g=>m(t).setElementsFontLineHeightFactor(g)),disabled:m(t).inputDisabled||!m(t).fontLineHeightFactorInputEnable},{header:O(()=>[_(u,{modelValue:s.value,"onUpdate:modelValue":a[2]||(a[2]=g=>s.value=g),disabled:m(t).inputDisabled||!m(t).fontLineHeightFactorInputEnable,size:"small",type:"number",step:.1,min:0,max:2,precision:1,onChange:a[3]||(a[3]=g=>m(t).setElementsFontLineHeightFactor(Number(g)))},{prepend:O(()=>a[11]||(a[11]=[X("自定义")])),append:O(()=>a[12]||(a[12]=[X("x字号")])),_:1},8,["modelValue","disabled"])]),default:O(()=>[(W(!0),q(De,null,Me(m(mo),g=>(W(),Te(d,{key:g.name,label:`${g.value}x字号`,value:g.value},{default:O(()=>[X(Ce(g.value)+"x字号 ",1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])],512),[[Se,n.value]]),xe(T("div",mc,[T("div",pc,[_(f,{modelValue:e.value,"onUpdate:modelValue":a[8]||(a[8]=g=>e.value=g),size:"small",onChange:a[9]||(a[9]=g=>m(t).setElementsFontLineHeight(g)),disabled:m(t).inputDisabled||!m(t).fontLineHeightInputEnable},{header:O(()=>[_(u,{modelValue:e.value,"onUpdate:modelValue":a[6]||(a[6]=g=>e.value=g),disabled:m(t).inputDisabled||!m(t).fontLineHeightInputEnable,size:"small",placeholder:"请输入行高",type:"number",min:m(Zs),max:100,precision:1,onChange:a[7]||(a[7]=g=>m(t).setElementsFontLineHeight(Number(g)))},{prepend:O(()=>a[13]||(a[13]=[X("自定义")])),append:O(()=>a[14]||(a[14]=[X("px")])),_:1},8,["modelValue","disabled","min"])]),default:O(()=>[(W(!0),q(De,null,Me(m(uo),g=>(W(),Te(d,{key:g.name,label:`${g.value}px`,value:g.value},{default:O(()=>[X(Ce(g.value)+"px ",1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])],512),[[Se,!n.value]])],512)),[[Se,m(t).fontEnable]])}}}),yc=fe(Cc,[["__scopeId","data-v-8509e7ad"]]),_c={class:"font-props right-props"},Ec={class:"font-props__row"},xc={class:"font-props__row-item"},Sc=de({__name:"FontSizeProps",setup(r){const t=he(),e=Q(se.fontSize),s=Q(se.fontSizeMixin);return oe(()=>t.fontSize,n=>{e.value=n}),oe(()=>t.fontSizeMixin,n=>{s.value=n}),(n,i)=>{const o=St,a=ze,l=bt;return xe((W(),q("div",_c,[i[6]||(i[6]=T("div",{class:"font-props__title"},[T("span",{class:"font-props__title-text text-2"},"字号")],-1)),T("div",Ec,[T("div",xc,[_(l,{modelValue:e.value,"onUpdate:modelValue":i[2]||(i[2]=c=>e.value=c),placeholder:`${s.value?"混合字号":`${e.value}px`}`,size:"small",onChange:i[3]||(i[3]=c=>m(t).setElementsFontSize(c)),disabled:m(t).inputDisabled||!m(t).fontInputEnable},{header:O(()=>[_(a,{modelValue:e.value,"onUpdate:modelValue":i[0]||(i[0]=c=>e.value=c),disabled:m(t).inputDisabled||!m(t).fontInputEnable,size:"small",placeholder:`${s.value?"混合字号":`${e.value}px`}`,type:"number",min:1,max:100,precision:0,onChange:i[1]||(i[1]=c=>m(t).setElementsFontSize(Number(c)))},{prepend:O(()=>i[4]||(i[4]=[X("自定义")])),append:O(()=>i[5]||(i[5]=[X("px")])),_:1},8,["modelValue","disabled","placeholder"])]),default:O(()=>[(W(!0),q(De,null,Me(m(ho),c=>(W(),Te(o,{key:c.name,label:`${c.value}px`,value:c.value},{default:O(()=>[X(Ce(c.value)+"px ",1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","disabled"])])])],512)),[[Se,m(t).fontEnable]])}}}),bc=fe(Sc,[["__scopeId","data-v-97a266f6"]]),vc={class:"font-props right-props"},wc={class:"font-props__row color"},Tc={class:"font-props__row-item"},Ac={class:"font-props__row-item",style:{width:"106px"}},Oc=de({__name:"FontColorProps",setup(r){const t=Q(),e=he(),s=Q(se.fontColor),n=Q(se.fontColorOpacity),i=Q(se.fontColorMixin),o=Q(se.fontColorOpacityMixin);oe(()=>e.fontColor,l=>{s.value=l}),oe(()=>e.fontColorOpacity,l=>{n.value=l}),oe(()=>e.fontColorMixin,l=>{i.value=l}),oe(()=>e.fontColorOpacityMixin,l=>{o.value=l});const a=()=>{e.fontInputEnable&&t.value.show()};return(l,c)=>{const d=ms,u=ps,f=ze;return xe((W(),q("div",vc,[c[6]||(c[6]=T("div",{class:"font-props__title"},[T("span",{class:"font-props__title-text text-2"},"文字颜色")],-1)),T("div",wc,[T("div",Tc,[_(d,{modelValue:s.value,"onUpdate:modelValue":c[0]||(c[0]=g=>s.value=g),onChange:c[1]||(c[1]=g=>m(e).setElementsFontColor(g)),ref_key:"colorPickerRef",ref:t,disabled:m(e).inputDisabled||!m(e).fontInputEnable},null,8,["modelValue","disabled"]),_(u,{type:"info",onClick:a},{default:O(()=>[X(Ce(`${i.value?"混合颜色":s.value}`),1)]),_:1})]),T("div",Ac,[_(f,{modelValue:n.value,"onUpdate:modelValue":c[2]||(c[2]=g=>n.value=g),placeholder:`${o.value?"混合透明度":n.value}`,type:"number",min:"0",max:"100",precision:"0",onChange:c[3]||(c[3]=g=>m(e).setElementsFontColorOpacity(Number(g))),disabled:m(e).inputDisabled||!m(e).fontInputEnable},{prepend:O(()=>c[4]||(c[4]=[X("透明")])),append:O(()=>c[5]||(c[5]=[X("%")])),_:1},8,["modelValue","placeholder","disabled"])])])],512)),[[Se,m(e).fontEnable]])}}}),Ic=fe(Oc,[["__scopeId","data-v-f6524c58"]]),Lc={class:Y(["font-props right-props"])},Pc={class:"font-props__row"},Rc={class:"fill-props__row-item large"},kc=de({__name:"FontTextCaseProps",setup(r){const t=he(),e=Q(se.textCase);return oe(()=>t.textCase,s=>{e.value=s}),(s,n)=>{const i=Cs,o=ys;return xe((W(),q("div",Lc,[n[4]||(n[4]=T("div",{class:"font-props__title"},[T("span",{class:"font-props__title-text text-2"},"字母大小写")],-1)),T("div",Pc,[T("div",Rc,[_(o,null,{default:O(()=>[_(i,{type:e.value===m(We).none?"success":"default",disabled:m(t).inputDisabled||!m(t).textCaseInputEnable,class:Y(["iconfont","icon-verbise-point-hyphen"]),onClick:n[0]||(n[0]=a=>m(t).setElementsTextCase(m(We).none))},null,8,["type","disabled"]),_(i,{type:e.value===m(We).uppercase?"success":"default",disabled:m(t).inputDisabled||!m(t).textCaseInputEnable,class:Y(["iconfont","icon-verbise-uppercase"]),onClick:n[1]||(n[1]=a=>m(t).setElementsTextCase(m(We).uppercase))},null,8,["type","disabled"]),_(i,{type:e.value===m(We).lowercase?"success":"default",disabled:m(t).inputDisabled||!m(t).textCaseInputEnable,class:Y(["iconfont","icon-verbise-lowercase"]),onClick:n[2]||(n[2]=a=>m(t).setElementsTextCase(m(We).lowercase))},null,8,["type","disabled"]),_(i,{type:e.value===m(We).capitalize?"success":"default",disabled:m(t).inputDisabled||!m(t).textCaseInputEnable,class:Y(["iconfont","icon-verbise-upper-lower"]),onClick:n[3]||(n[3]=a=>m(t).setElementsTextCase(m(We).capitalize))},null,8,["type","disabled"])]),_:1})])])],512)),[[Se,m(t).fontEnable]])}}}),Fc=fe(kc,[["__scopeId","data-v-54c8abbf"]]),Bc={class:Y(["font-props right-props"])},Dc={class:"font-props__row"},Mc={class:"fill-props__row-item large"},Nc=de({__name:"FontStylerProps",setup(r){const t=he(),e=Q(se.fontStyler);return oe(()=>t.fontStyler,s=>{e.value=s}),(s,n)=>{const i=Cs,o=ys;return xe((W(),q("div",Bc,[n[4]||(n[4]=T("div",{class:"font-props__title"},[T("span",{class:"font-props__title-text text-2"},"字体样式")],-1)),T("div",Dc,[T("div",Mc,[_(o,null,{default:O(()=>[_(i,{type:e.value===m(Ye).normal?"success":"default",disabled:m(t).inputDisabled||!m(t).fontInputEnable,class:Y(["iconfont","icon-verbise-point-hyphen"]),onClick:n[0]||(n[0]=a=>m(t).setElementsFontStyler(m(Ye).normal))},null,8,["type","disabled"]),_(i,{type:e.value===m(Ye).bold?"success":"default",disabled:m(t).inputDisabled||!m(t).fontInputEnable,class:Y(["iconfont","icon-verbise-bold"]),onClick:n[1]||(n[1]=a=>m(t).setElementsFontStyler(m(Ye).bold))},null,8,["type","disabled"]),_(i,{type:e.value===m(Ye).italic?"success":"default",disabled:m(t).inputDisabled||!m(t).fontInputEnable,class:Y(["iconfont","icon-verbise-italic"]),onClick:n[2]||(n[2]=a=>m(t).setElementsFontStyler(m(Ye).italic))},null,8,["type","disabled"]),_(i,{type:e.value===m(Ye).boldItalic?"success":"default",disabled:m(t).inputDisabled||!m(t).fontInputEnable,class:Y(["iconfont","icon-verbise-italic-bold"]),onClick:n[3]||(n[3]=a=>m(t).setElementsFontStyler(m(Ye).boldItalic))},null,8,["type","disabled"])]),_:1})])])],512)),[[Se,m(t).fontEnable]])}}}),Vc=fe(Nc,[["__scopeId","data-v-f2925fe6"]]),Hc={class:"font-props right-props"},Wc={class:"font-props__row"},zc={class:"font-props__row-item",style:{width:"212px"}},jc=de({__name:"FontFamilyProps",setup(r){const t=he(),e=Q(se.fontFamily),s=Q(se.fontFamilyMixin);return oe(()=>t.fontFamily,n=>{e.value=n}),oe(()=>t.fontFamilyMixin,n=>{s.value=n}),(n,i)=>{const o=St,a=bt;return xe((W(),q("div",Hc,[i[2]||(i[2]=T("div",{class:"font-props__title"},[T("span",{class:"font-props__title-text"},"字体")],-1)),T("div",Wc,[T("div",zc,[_(a,{modelValue:e.value,"onUpdate:modelValue":i[0]||(i[0]=l=>e.value=l),placeholder:`${s.value?"混合字体":e.value}`,size:"small",onChange:i[1]||(i[1]=l=>m(t).setElementsFontFamily(l)),disabled:m(t).inputDisabled||!m(t).fontInputEnable},{label:O(({label:l,value:c})=>[T("span",{style:_n({fontFamily:c})},Ce(l),5)]),default:O(()=>[(W(!0),q(De,null,Me(m(Ci),l=>(W(),Te(o,{key:l.name,label:l.name,value:l.name,style:_n({fontFamily:l.name})},null,8,["label","value","style"]))),128))]),_:1},8,["modelValue","placeholder","disabled"])])])],512)),[[Se,m(t).fontEnable]])}}}),Gc=fe(jc,[["__scopeId","data-v-3295ff4a"]]),$c={class:"corners-props right-props"},Yc={class:"corners-props__row"},Uc={class:"corners-props__row-item large"},Xc={class:"corners-props__row"},qc={class:"corners-props__row"},Jc=de({__name:"CornerProps",setup(r){const t=he(),e=Q([...se.corners]),s=Q(0),n=Q(!1);oe(()=>t.corners,o=>{e.value=o;const a=R.uniq(e.value);a.length===1?(n.value=!0,s.value=a[0]):(n.value=!1,s.value=0)});function i(o){switch(o){case 0:return"左上";case 1:return"右上";case 2:return"右下";case 3:return"左下"}}return(o,a)=>{var c;const l=ze;return xe((W(),q("div",$c,[a[6]||(a[6]=T("div",{class:"corners-props__title"},[T("span",{class:"corners-props__title-text"},"圆角")],-1)),T("div",Yc,[T("div",Uc,[_(l,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=d=>s.value=d),placeholder:"输入数字",disabled:m(t).inputDisabled||!m(t).cornersInputEnable||!n.value,type:"number",min:"0",max:((c=m(t).primarySelectedElement)==null?void 0:c.minParallelogramVerticalSize)/2,precision:"1",onChange:a[1]||(a[1]=d=>m(t).setElementsCorners(Number(d)))},{prepend:O(()=>a[2]||(a[2]=[X("整体")])),append:O(()=>a[3]||(a[3]=[X("px")])),_:1},8,["modelValue","disabled","max"])])]),T("div",Xc,[(W(!0),q(De,null,Me(e.value.slice(0,2),(d,u)=>{var f;return W(),q("div",{class:"corners-props__row-item large",key:u},[_(l,{modelValue:e.value[u],"onUpdate:modelValue":g=>e.value[u]=g,placeholder:"输入数字",disabled:m(t).inputDisabled||!m(t).cornersInputEnable,type:"number",min:"0",max:((f=m(t).primarySelectedElement)==null?void 0:f.minParallelogramVerticalSize)/2,precision:"1",onChange:g=>m(t).setElementsCorners(Number(g),u)},{prepend:O(()=>[X(Ce(i(u)),1)]),append:O(()=>a[4]||(a[4]=[X("px")])),_:2},1032,["modelValue","onUpdate:modelValue","disabled","max","onChange"])])}),128))]),T("div",qc,[(W(!0),q(De,null,Me(e.value.slice(2,4),(d,u)=>{var f;return W(),q("div",{class:"corners-props__row-item large",key:u},[_(l,{modelValue:e.value[u+2],"onUpdate:modelValue":g=>e.value[u+2]=g,placeholder:"输入数字",disabled:m(t).inputDisabled||!m(t).cornersInputEnable,type:"number",min:"0",max:((f=m(t).primarySelectedElement)==null?void 0:f.minParallelogramVerticalSize)/2,precision:"1",onChange:g=>m(t).setElementsCorners(Number(g),u+2)},{prepend:O(()=>[X(Ce(i(u+2)),1)]),append:O(()=>a[5]||(a[5]=[X("px")])),_:2},1032,["modelValue","onUpdate:modelValue","disabled","max","onChange"])])}),128))])],512)),[[Se,m(t).cornersEnable]])}}}),Kc={class:Y(["rotate-props right-props"])},Qc={class:"rotate-props__row"},Zc=de({__name:"RotateFlipProps",setup(r){const t=he();return(e,s)=>{const n=Ne,i=Gt;return W(),q("div",Kc,[s[4]||(s[4]=T("div",{class:"rotate-props__title"},[T("span",{class:"rotate-props__title-text text-2"},"快捷操作")],-1)),T("div",Qc,[_(i,{effect:"dark",content:"逆时针旋转90度"},{default:O(()=>[_(n,{class:Y(["iconfont","icon-verbise-rotate-left",{disabled:!m(t).rotateEnable}]),onClick:s[0]||(s[0]=o=>m(t).setElementsRotate(-90))},null,8,["class"])]),_:1}),_(i,{effect:"dark",content:"顺时针旋转90度"},{default:O(()=>[_(n,{class:Y(["iconfont","icon-verbise-rotate-right",{disabled:!m(t).rotateEnable}]),onClick:s[1]||(s[1]=o=>m(t).setElementsRotate(90)),title:"顺时针旋转90度"},null,8,["class"])]),_:1}),_(i,{effect:"dark",content:"水平翻转"},{default:O(()=>[_(n,{class:Y(["iconfont","icon-verbise-rotateY",{disabled:!m(t).rotateEnable}]),onClick:s[2]||(s[2]=o=>m(t).setElementsFlipX()),title:"水平翻转"},null,8,["class"])]),_:1}),_(i,{effect:"dark",content:"垂直翻转"},{default:O(()=>[_(n,{class:Y(["iconfont","icon-verbise-rotateX",{disabled:!m(t).rotateEnable}]),onClick:s[3]||(s[3]=o=>m(t).setElementsFlipY()),title:"垂直翻转"},null,8,["class"])]),_:1})])])}}}),ed=fe(Zc,[["__scopeId","data-v-5c394d2f"]]),td={class:"angle-props right-props"},sd={class:"angle-props__title"},nd={class:"angle-props__row"},id={class:"angle-props__row-item large"},rd={class:"angle-props__row-item large"},od=de({__name:"AngleProps",setup(r){const t=he(),e=Q(se.angle),s=Q(se.leanYAngle);oe(()=>t.angle,o=>{e.value=h.precise(o,1)}),oe(()=>t.leanYAngle,o=>{s.value=h.precise(o,1)});function n(o){let a=Number(o);a>180&&(a=180-a),a<-180&&(a=-180-a),t.setElementsAngle(a)}function i(o){if(!t.leanYAngleInputEnable)return;let a=Number(o);a=R.clamp(a,-89,89),t.setElementsLeanYAngle(a)}return(o,a)=>{const l=Ne,c=ze;return W(),q("div",td,[T("div",sd,[a[2]||(a[2]=T("span",{class:"angle-props__title-text"},"角度",-1)),xe(_(l,{class:Y(["iconfont","icon-verbise-flip-horizontal"])},null,512),[[Se,m(t).flipX]])]),T("div",nd,[T("div",id,[_(c,{modelValue:e.value,"onUpdate:modelValue":a[0]||(a[0]=d=>e.value=d),placeholder:"输入数字",disabled:m(t).inputDisabled||!m(t).angleInputEnable,type:"number",min:"-180",max:"180",precision:"1",onChange:n},{prepend:O(()=>a[3]||(a[3]=[X("整体")])),append:O(()=>a[4]||(a[4]=[X("度")])),_:1},8,["modelValue","disabled"])]),T("div",rd,[_(c,{modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=d=>s.value=d),placeholder:"输入数字",disabled:m(t).inputDisabled||!m(t).leanYAngleInputEnable,type:"number",min:"-89",max:"89",precision:"1",onChange:i},{prepend:O(()=>a[5]||(a[5]=[X("Y轴")])),append:O(()=>a[6]||(a[6]=[X("度")])),_:1},8,["modelValue","disabled"])])])])}}}),ad={class:"size-props right-props"},ld={class:"size-props__row"},cd={class:"size-props__row-item large"},dd={class:"angle-props__row-item large"},hd=de({__name:"SizeProps",setup(r){const t=he(),e=Q(se.width),s=Q(se.height);return oe(()=>t.width,n=>{e.value=h.precise(n,1)}),oe(()=>t.height,n=>{s.value=h.precise(n,1)}),(n,i)=>{const o=ze,a=Ne;return W(),q("div",ad,[i[10]||(i[10]=T("div",{class:"size-props__title"},[T("span",{class:"size-props__title-text"},"尺寸")],-1)),T("div",ld,[T("div",cd,[_(o,{modelValue:e.value,"onUpdate:modelValue":i[0]||(i[0]=l=>e.value=l),placeholder:"输入数字",disabled:m(t).inputDisabled||!m(t).widthInputEnable,min:"2",type:"number",precision:"1",onChange:i[1]||(i[1]=l=>m(t).setElementsWidth(Number(l)))},{prepend:O(()=>i[6]||(i[6]=[X("宽")])),append:O(()=>i[7]||(i[7]=[X("px")])),_:1},8,["modelValue","disabled"])]),T("div",dd,[_(o,{modelValue:s.value,"onUpdate:modelValue":i[2]||(i[2]=l=>s.value=l),placeholder:"输入数字",disabled:m(t).inputDisabled||!m(t).heightInputEnable,min:"2",type:"number",precision:"1",onChange:i[3]||(i[3]=l=>m(t).setElementsHeight(Number(l)))},{prepend:O(()=>i[8]||(i[8]=[X("高")])),append:O(()=>i[9]||(i[9]=[X("px")])),_:1},8,["modelValue","disabled"])]),m(t).ratioLockedEnable?(W(),Te(a,{key:0},{default:O(()=>[m(t).isRatioLocked?(W(),Te(m(Sr),{key:1,onClick:i[5]||(i[5]=l=>m(t).setRatioLocked(!1)),title:"解除宽高比锁定"})):(W(),Te(m(xr),{key:0,onClick:i[4]||(i[4]=l=>m(t).setRatioLocked(!0)),title:"锁定宽高比"}))]),_:1})):li("",!0)])])}}}),ud=fe(hd,[["__scopeId","data-v-9e731bf3"]]),fd={class:"position-props right-props"},gd={class:"position-props__row"},md={class:"angle-props__row-item large"},pd={class:"angle-props__row-item large"},Cd=de({__name:"PositionProps",setup(r){const t=he(),e=Q(se.position.x),s=Q(se.position.y);return oe(()=>t.position,n=>{n&&(e.value=h.precise(n.x),s.value=h.precise(n.y))}),(n,i)=>{const o=ze;return W(),q("div",fd,[i[8]||(i[8]=T("div",{class:"position-props__title"},"坐标",-1)),T("div",gd,[T("div",md,[_(o,{modelValue:e.value,"onUpdate:modelValue":i[0]||(i[0]=a=>e.value=a),placeholder:"输入数字",disabled:m(t).inputDisabled||!m(t).positionInputEnable,type:"number",precision:"1",onChange:i[1]||(i[1]=a=>m(t).setElementsPosition({x:Number(a),y:s.value}))},{prepend:O(()=>i[4]||(i[4]=[X("横")])),append:O(()=>i[5]||(i[5]=[X("px")])),_:1},8,["modelValue","disabled"])]),T("div",pd,[_(o,{modelValue:s.value,"onUpdate:modelValue":i[2]||(i[2]=a=>s.value=a),placeholder:"输入数字",disabled:m(t).inputDisabled||!m(t).positionInputEnable,type:"number",precision:"1",onChange:i[3]||(i[3]=a=>m(t).setElementsPosition({x:e.value,y:Number(a)}))},{prepend:O(()=>i[6]||(i[6]=[X("纵")])),append:O(()=>i[7]||(i[7]=[X("px")])),_:1},8,["modelValue","disabled"])])])])}}}),yd={class:Y(["align-props right-props"])},_d={class:"align-props__title"},Ed={class:"align-props__row"},xd=de({__name:"AlignProps",setup(r){const t=he();return(e,s)=>{const n=Ne,i=Gt;return W(),q("div",yd,[T("div",_d,[s[0]||(s[0]=T("span",{class:"align-props__title-text"},"对齐",-1)),_(n,{title:"按住shift支持组件外轮廓对齐操作"},{default:O(()=>[_(m(br))]),_:1})]),T("div",Ed,[_(i,{effect:"dark",content:"左对齐"},{default:O(()=>[_(n,{class:Y(["iconfont","icon-verbise-align-left",{disabled:!m(t).alignEnable}]),onClick:m(t).setElementsAlignLeft},null,8,["class","onClick"])]),_:1}),_(i,{effect:"dark",content:"水平居中"},{default:O(()=>[_(n,{class:Y(["iconfont","icon-verbise-align-horizontal-center",{disabled:!m(t).alignEnable}]),onClick:m(t).setElementsAlignCenter},null,8,["class","onClick"])]),_:1}),_(i,{effect:"dark",content:"右对齐"},{default:O(()=>[_(n,{class:Y(["iconfont","icon-verbise-align-right",{disabled:!m(t).alignEnable}]),onClick:m(t).setElementsAlignRight},null,8,["class","onClick"])]),_:1}),_(i,{effect:"dark",content:"顶部对齐"},{default:O(()=>[_(n,{class:Y(["iconfont","icon-verbise-align-top",{disabled:!m(t).alignEnable}]),onClick:m(t).setElementsAlignTop},null,8,["class","onClick"])]),_:1}),_(i,{effect:"dark",content:"垂直居中"},{default:O(()=>[_(n,{class:Y(["iconfont","icon-verbise-align-vertical-center",{disabled:!m(t).alignEnable}]),onClick:m(t).setElementsAlignMiddle},null,8,["class","onClick"])]),_:1}),_(i,{effect:"dark",content:"底部对齐"},{default:O(()=>[_(n,{class:Y(["iconfont","icon-verbise-align-bottom",{disabled:!m(t).alignEnable}]),onClick:m(t).setElementsAlignBottom},null,8,["class","onClick"])]),_:1}),_(i,{effect:"dark",content:"水平平均"},{default:O(()=>[_(n,{class:Y(["iconfont","icon-verbise-average-h",{disabled:!m(t).averageEnable}]),onClick:m(t).setElementsAverageHorizontal},null,8,["class","onClick"])]),_:1}),_(i,{effect:"dark",content:"垂直平均"},{default:O(()=>[_(n,{class:Y(["iconfont","icon-verbise-average-v",{disabled:!m(t).averageEnable}]),onClick:m(t).setElementsAverageVertical},null,8,["class","onClick"])]),_:1})])])}}}),Sd=fe(xd,[["__scopeId","data-v-fa958ea0"]]),bd={class:"scale-setting"},vd={class:"scale-setting__item factor"},wd={class:"el-dropdown-link"},Td=de({__name:"ScaleSetting",setup(r){const t=he();return(e,s)=>{const n=Ne,i=ui,o=wr,a=fi,l=gi;return W(),q("div",bd,[T("div",vd,[_(l,{trigger:"click","popper-class":"scale-setting__dropdown","hide-on-click":!1},{dropdown:O(()=>[_(a,null,{default:O(()=>[_(i,{onClick:m(t).setScaleAutoFit},{default:O(()=>s[0]||(s[0]=[T("span",null,"自适应缩放",-1),T("span",null,"shift + 1",-1)])),_:1},8,["onClick"]),_(i,{onClick:m(t).setScaleReduce},{default:O(()=>s[1]||(s[1]=[T("span",null,"缩小",-1),T("span",null,"ctrl + -",-1)])),_:1},8,["onClick"]),_(i,{onClick:m(t).setScaleIncrease},{default:O(()=>s[2]||(s[2]=[T("span",null,"放大",-1),T("span",null,"ctrl + +",-1)])),_:1},8,["onClick"]),_(o,null,{default:O(()=>s[3]||(s[3]=[X("预置缩放")])),_:1}),(W(!0),q(De,null,Me(m(Ko),c=>(W(),Te(i,{key:c,onClick:d=>m(t).setScale(c)},{default:O(()=>[T("span",null,"缩放"+Ce(m(h).precise(c*100,0)+"%"),1),T("span",null,Ce(c===1?"ctrl + 0":""),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:O(()=>[T("span",wd,[X(Ce(m(h).precise(m(t).scale*100,0)+"%")+" ",1),_(n,{class:"el-icon--right"},{default:O(()=>[_(m(vr))]),_:1})])]),_:1})])])}}}),Ad=fe(Td,[["__scopeId","data-v-d9667cac"]]),Od={},Id={class:"props-right-panel"};function Ld(r,t){const e=Ad,s=Sd,n=Cd,i=ud,o=od,a=ed,l=Jc,c=Gc,d=Vc,u=Tr,f=Fc,g=Ar,C=Ic,y=bc,E=yc,b=dc,F=rc,N=ec,w=Xl,v=Vl,P=Rl,D=Sl;return W(),q("div",Id,[_(e),_(s),_(n),_(i),_(o),_(a),_(l),_(c),_(g,{gutter:0},{default:O(()=>[_(u,{span:12},{default:O(()=>[_(d)]),_:1}),_(u,{span:12},{default:O(()=>[_(f)]),_:1})]),_:1}),_(C),_(g,{gutter:0},{default:O(()=>[_(u,{span:11},{default:O(()=>[_(y)]),_:1}),_(u,{span:13},{default:O(()=>[_(E)]),_:1})]),_:1}),_(g,{gutter:0},{default:O(()=>[_(u,{span:11},{default:O(()=>[_(b)]),_:1}),_(u,{span:13},{default:O(()=>[_(F)]),_:1})]),_:1}),_(N),_(w),_(v),_(P),_(D)])}const Pd=fe(Od,[["render",Ld],["__scopeId","data-v-b713b2a2"]]),Rd={},kd={class:"right-bar"};function Fd(r,t){const e=Pd;return W(),q("div",kd,[_(e)])}const Bd=fe(Rd,[["render",Fd],["__scopeId","data-v-0da4b64b"]]),Dd={class:"creator-menu__item"},Md={class:"text"},Nd={class:"icon"},Vd={key:0,class:"shortcut"},Hd=de({__name:"CreatorDropDownItem",props:{creator:{}},setup(r){return(t,e)=>{const s=Ne;return W(),q("div",Dd,[T("div",Md,Ce(t.creator.name),1),T("div",Nd,[_(s,{class:Y(["iconfont",t.creator.icon])},null,8,["class"])]),t.creator.shortcut?(W(),q("div",Vd,Ce(t.creator.shortcut),1)):li("",!0)])}}}),Wd={class:"tool-dropdown"},zd=de({__name:"CreatorDropdown",props:{creators:Array,currentCreator:Object,select:Function},setup(r){const t=he(),e=Q([]),s=R.debounce(async()=>{t.uploadImages(e.value),e.value=[]},500),n=i=>(e.value.push(i),s(),!1);return(i,o)=>{const a=Ne,l=Hd,c=Or,d=ui,u=fi,f=gi;return W(),Te(f,null,{dropdown:O(()=>[_(u,null,{default:O(()=>[(W(!0),q(De,null,Me(r.creators,g=>(W(),Te(d,{key:g.type,class:Y([{selected:g.type===r.currentCreator.type}]),onClick:C=>r.select(g)},{default:O(()=>[g.type===m(A).image?(W(),Te(c,{key:0,action:"",multiple:"",accept:"image/*","before-upload":n},{default:O(()=>[_(l,{creator:g},null,8,["creator"])]),_:2},1024)):(W(),Te(l,{key:1,creator:g},null,8,["creator"]))]),_:2},1032,["class","onClick"]))),128))]),_:1})]),default:O(()=>[T("div",Wd,[_(a,{class:"icon-verbise-arrow_down iconfont"})])]),_:1})}}}),jd=fe(zd,[["__scopeId","data-v-b9bef481"]]),Gd={class:"create-bar"},$d=de({__name:"CreatorBar",emits:["select"],setup(r,{emit:t}){const e=t,s=he(),n=Pt(()=>s.currentCreator),i=Pt(()=>s.currentCursorCreator),o=Pt(()=>s.currentShapeCreator),a=Pt(()=>s.currentArbitraryCreator),l=Pt(()=>s.currentTextCreator),c=d=>{e("select",d)};return(d,u)=>{const f=Ne,g=jd;return W(),q("div",Gd,[T("div",{class:Y(["tool-item",{selected:i.value.category===n.value.category}]),onClick:u[0]||(u[0]=C=>c(i.value))},[_(f,{class:Y(["iconfont",i.value.icon])},null,8,["class"])],2),_(g,{creators:m(Si),"current-creator":n.value,select:c},null,8,["creators","current-creator"]),T("div",{class:Y(["tool-item",{selected:o.value.category===n.value.category}]),onClick:u[1]||(u[1]=C=>c(o.value))},[_(f,{class:Y(["iconfont",o.value.icon])},null,8,["class"])],2),_(g,{creators:m(bi),"current-creator":n.value,select:c},null,8,["creators","current-creator"]),T("div",{class:Y(["tool-item",{selected:a.value.category===n.value.category}]),onClick:u[2]||(u[2]=C=>c(a.value))},[_(f,{class:Y(["iconfont",a.value.icon])},null,8,["class"])],2),_(g,{creators:m(vi),"current-creator":n.value,select:c},null,8,["creators","current-creator"]),T("div",{class:Y(["tool-item",{selected:l.value.category===n.value.category}]),onClick:u[3]||(u[3]=C=>c(l.value))},[_(f,{class:Y(["iconfont",l.value.icon])},null,8,["class"])],2)])}}}),Yd={class:"arbitrary-bar"},Ud={class:"tool-item"},Xd=de({__name:"ArbitraryBar",setup(r){const t=he();return(e,s)=>{const n=Ne;return xe((W(),q("div",Yd,[T("div",Ud,[_(n,{onClick:m(t).commitArbitraryDrawing},{default:O(()=>[_(m(Ir))]),_:1},8,["onClick"])])],512)),[[Se,m(t).arbitraryVisible]])}}}),qd=fe(Xd,[["__scopeId","data-v-dc2ef5a8"]]),Jd={class:"stage-shield"},Kd=de({__name:"shield",setup(r,{expose:t}){let e;return t({init:async()=>new Promise(n=>{e=n,e()})}),(n,i)=>(W(),q("div",Jd))}}),Qd=de({__name:"container",setup(r){const t=he(),e=Q(null),s=Q(),n=i=>{const{type:o}=i;o!==A.image&&t.setCreator(i,!0)};return hr(async()=>{s.value&&await s.value.init(),await t.init({containerEl:e.value,shieldEl:s.value.$el})}),(i,o)=>{const a=qd,l=$d;return W(),q("div",{class:"stage-container",ref_key:"stageRef",ref:e},[_(Kd,{ref_key:"stageShieldRef",ref:s},null,512),_(a),_(l,{onSelect:n})],512)}}}),Zd=fe(Qd,[["__scopeId","data-v-e1cd2e3c"]]),eh=["onMouseenter","onMouseleave"],th={class:"node-content"},sh=de({__name:"ElementsTree",setup(r){const t=he(),e=Q();function s(c){t.toggleElementsTarget([c],!0)}function n(c){t.toggleElementsTarget([c],!1)}function i(c){t.toggleElementsDetachedSelected([c.id])}const o=(c,d)=>{t.setElementsDetachedSelectedByIds([c.data.id],!0)},a=(c,d,u,f)=>{t.moveElementsTo([c.data.id],d.data.id,Mt[u])},l=(c,d,u)=>u!=="inner";return(c,d)=>{const u=Ne,f=Gt,g=Pr;return W(),Te(g,{style:{"max-width":"600px"},"allow-drop":l,data:m(t).treeNodes,draggable:"","default-expand-all":"","node-key":"id",ref_key:"treeRef",ref:e,"auto-expand-parent":"","expand-on-click-node":!1,onNodeClick:i,onNodeDragStart:o,onNodeDrop:a},{default:O(({data:{id:C,label:y,isSelected:E,isDetachedSelected:b,isTarget:F,isGroup:N,type:w}})=>[T("span",{onMouseenter:v=>s(C),onMouseleave:v=>n(C),class:Y(["tree-node",{selected:E,detached:b,target:F,group:N}])},[_(u,{class:Y(["iconfont",m(je)[w]])},null,8,["class"]),T("div",th,[T("span",null,Ce(y),1),_(f,{effect:"dark",content:"节点详情",placement:"right"},{content:O(()=>{var v;return[T("div",null,[T("p",null,"节点ID: "+Ce(C),1),T("p",null,"节点类型: "+Ce(((v=m(Et).getCreatorByType(w))==null?void 0:v.name)||w),1)])]}),default:O(()=>[_(u,null,{default:O(()=>[_(m(Lr))]),_:1})]),_:2},1024)])],42,eh)]),_:1},8,["data"])}}}),nh=fe(sh,[["__scopeId","data-v-fae3624b"]]),ih={class:"props-left-panel"},rh={class:"title"},oh={class:"tree"},ah=de({__name:"LeftProps",setup(r){const t=he();return(e,s)=>{const n=nh;return W(),q("div",ih,[T("div",rh,[T("span",null,"组件序列("+Ce(m(t).selectedElements.length)+" / "+Ce(Array.from(m(t).treeNodesMap.keys()).length)+")",1)]),T("div",oh,[_(n)])])}}}),lh=fe(ah,[["__scopeId","data-v-7edcc3f6"]]),ch={},dh={class:"left-bar"};function hh(r,t){const e=lh;return W(),q("div",dh,[_(e)])}const uh=fe(ch,[["render",hh],["__scopeId","data-v-9ea4acfe"]]);function Di(r,t){return function(){return r.apply(t,arguments)}}const{toString:fh}=Object.prototype,{getPrototypeOf:un}=Object,bs=(r=>t=>{const e=fh.call(t);return r[e]||(r[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),qe=r=>(r=r.toLowerCase(),t=>bs(t)===r),vs=r=>t=>typeof t===r,{isArray:wt}=Array,jt=vs("undefined");function gh(r){return r!==null&&!jt(r)&&r.constructor!==null&&!jt(r.constructor)&&Be(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const Mi=qe("ArrayBuffer");function mh(r){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(r):t=r&&r.buffer&&Mi(r.buffer),t}const ph=vs("string"),Be=vs("function"),Ni=vs("number"),ws=r=>r!==null&&typeof r=="object",Ch=r=>r===!0||r===!1,ns=r=>{if(bs(r)!=="object")return!1;const t=un(r);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},yh=qe("Date"),_h=qe("File"),Eh=qe("Blob"),xh=qe("FileList"),Sh=r=>ws(r)&&Be(r.pipe),bh=r=>{let t;return r&&(typeof FormData=="function"&&r instanceof FormData||Be(r.append)&&((t=bs(r))==="formdata"||t==="object"&&Be(r.toString)&&r.toString()==="[object FormData]"))},vh=qe("URLSearchParams"),[wh,Th,Ah,Oh]=["ReadableStream","Request","Response","Headers"].map(qe),Ih=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Yt(r,t,{allOwnKeys:e=!1}={}){if(r===null||typeof r>"u")return;let s,n;if(typeof r!="object"&&(r=[r]),wt(r))for(s=0,n=r.length;s<n;s++)t.call(null,r[s],s,r);else{const i=e?Object.getOwnPropertyNames(r):Object.keys(r),o=i.length;let a;for(s=0;s<o;s++)a=i[s],t.call(null,r[a],a,r)}}function Vi(r,t){t=t.toLowerCase();const e=Object.keys(r);let s=e.length,n;for(;s-- >0;)if(n=e[s],t===n.toLowerCase())return n;return null}const at=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Hi=r=>!jt(r)&&r!==at;function Ys(){const{caseless:r}=Hi(this)&&this||{},t={},e=(s,n)=>{const i=r&&Vi(t,n)||n;ns(t[i])&&ns(s)?t[i]=Ys(t[i],s):ns(s)?t[i]=Ys({},s):wt(s)?t[i]=s.slice():t[i]=s};for(let s=0,n=arguments.length;s<n;s++)arguments[s]&&Yt(arguments[s],e);return t}const Lh=(r,t,e,{allOwnKeys:s}={})=>(Yt(t,(n,i)=>{e&&Be(n)?r[i]=Di(n,e):r[i]=n},{allOwnKeys:s}),r),Ph=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),Rh=(r,t,e,s)=>{r.prototype=Object.create(t.prototype,s),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:t.prototype}),e&&Object.assign(r.prototype,e)},kh=(r,t,e,s)=>{let n,i,o;const a={};if(t=t||{},r==null)return t;do{for(n=Object.getOwnPropertyNames(r),i=n.length;i-- >0;)o=n[i],(!s||s(o,r,t))&&!a[o]&&(t[o]=r[o],a[o]=!0);r=e!==!1&&un(r)}while(r&&(!e||e(r,t))&&r!==Object.prototype);return t},Fh=(r,t,e)=>{r=String(r),(e===void 0||e>r.length)&&(e=r.length),e-=t.length;const s=r.indexOf(t,e);return s!==-1&&s===e},Bh=r=>{if(!r)return null;if(wt(r))return r;let t=r.length;if(!Ni(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=r[t];return e},Dh=(r=>t=>r&&t instanceof r)(typeof Uint8Array<"u"&&un(Uint8Array)),Mh=(r,t)=>{const s=(r&&r[Symbol.iterator]).call(r);let n;for(;(n=s.next())&&!n.done;){const i=n.value;t.call(r,i[0],i[1])}},Nh=(r,t)=>{let e;const s=[];for(;(e=r.exec(t))!==null;)s.push(e);return s},Vh=qe("HTMLFormElement"),Hh=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,s,n){return s.toUpperCase()+n}),$n=(({hasOwnProperty:r})=>(t,e)=>r.call(t,e))(Object.prototype),Wh=qe("RegExp"),Wi=(r,t)=>{const e=Object.getOwnPropertyDescriptors(r),s={};Yt(e,(n,i)=>{let o;(o=t(n,i,r))!==!1&&(s[i]=o||n)}),Object.defineProperties(r,s)},zh=r=>{Wi(r,(t,e)=>{if(Be(r)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const s=r[e];if(Be(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},jh=(r,t)=>{const e={},s=n=>{n.forEach(i=>{e[i]=!0})};return wt(r)?s(r):s(String(r).split(t)),e},Gh=()=>{},$h=(r,t)=>r!=null&&Number.isFinite(r=+r)?r:t,Fs="abcdefghijklmnopqrstuvwxyz",Yn="0123456789",zi={DIGIT:Yn,ALPHA:Fs,ALPHA_DIGIT:Fs+Fs.toUpperCase()+Yn},Yh=(r=16,t=zi.ALPHA_DIGIT)=>{let e="";const{length:s}=t;for(;r--;)e+=t[Math.random()*s|0];return e};function Uh(r){return!!(r&&Be(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const Xh=r=>{const t=new Array(10),e=(s,n)=>{if(ws(s)){if(t.indexOf(s)>=0)return;if(!("toJSON"in s)){t[n]=s;const i=wt(s)?[]:{};return Yt(s,(o,a)=>{const l=e(o,n+1);!jt(l)&&(i[a]=l)}),t[n]=void 0,i}}return s};return e(r,0)},qh=qe("AsyncFunction"),Jh=r=>r&&(ws(r)||Be(r))&&Be(r.then)&&Be(r.catch),ji=((r,t)=>r?setImmediate:t?((e,s)=>(at.addEventListener("message",({source:n,data:i})=>{n===at&&i===e&&s.length&&s.shift()()},!1),n=>{s.push(n),at.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",Be(at.postMessage)),Kh=typeof queueMicrotask<"u"?queueMicrotask.bind(at):typeof process<"u"&&process.nextTick||ji,S={isArray:wt,isArrayBuffer:Mi,isBuffer:gh,isFormData:bh,isArrayBufferView:mh,isString:ph,isNumber:Ni,isBoolean:Ch,isObject:ws,isPlainObject:ns,isReadableStream:wh,isRequest:Th,isResponse:Ah,isHeaders:Oh,isUndefined:jt,isDate:yh,isFile:_h,isBlob:Eh,isRegExp:Wh,isFunction:Be,isStream:Sh,isURLSearchParams:vh,isTypedArray:Dh,isFileList:xh,forEach:Yt,merge:Ys,extend:Lh,trim:Ih,stripBOM:Ph,inherits:Rh,toFlatObject:kh,kindOf:bs,kindOfTest:qe,endsWith:Fh,toArray:Bh,forEachEntry:Mh,matchAll:Nh,isHTMLForm:Vh,hasOwnProperty:$n,hasOwnProp:$n,reduceDescriptors:Wi,freezeMethods:zh,toObjectSet:jh,toCamelCase:Hh,noop:Gh,toFiniteNumber:$h,findKey:Vi,global:at,isContextDefined:Hi,ALPHABET:zi,generateString:Yh,isSpecCompliantForm:Uh,toJSONObject:Xh,isAsyncFn:qh,isThenable:Jh,setImmediate:ji,asap:Kh};function te(r,t,e,s,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),s&&(this.request=s),n&&(this.response=n,this.status=n.status?n.status:null)}S.inherits(te,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:S.toJSONObject(this.config),code:this.code,status:this.status}}});const Gi=te.prototype,$i={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{$i[r]={value:r}});Object.defineProperties(te,$i);Object.defineProperty(Gi,"isAxiosError",{value:!0});te.from=(r,t,e,s,n,i)=>{const o=Object.create(Gi);return S.toFlatObject(r,o,function(l){return l!==Error.prototype},a=>a!=="isAxiosError"),te.call(o,r.message,t,e,s,n),o.cause=r,o.name=r.name,i&&Object.assign(o,i),o};const Qh=null;function Us(r){return S.isPlainObject(r)||S.isArray(r)}function Yi(r){return S.endsWith(r,"[]")?r.slice(0,-2):r}function Un(r,t,e){return r?r.concat(t).map(function(n,i){return n=Yi(n),!e&&i?"["+n+"]":n}).join(e?".":""):t}function Zh(r){return S.isArray(r)&&!r.some(Us)}const eu=S.toFlatObject(S,{},null,function(t){return/^is[A-Z]/.test(t)});function Ts(r,t,e){if(!S.isObject(r))throw new TypeError("target must be an object");t=t||new FormData,e=S.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,E){return!S.isUndefined(E[y])});const s=e.metaTokens,n=e.visitor||d,i=e.dots,o=e.indexes,l=(e.Blob||typeof Blob<"u"&&Blob)&&S.isSpecCompliantForm(t);if(!S.isFunction(n))throw new TypeError("visitor must be a function");function c(C){if(C===null)return"";if(S.isDate(C))return C.toISOString();if(!l&&S.isBlob(C))throw new te("Blob is not supported. Use a Buffer instead.");return S.isArrayBuffer(C)||S.isTypedArray(C)?l&&typeof Blob=="function"?new Blob([C]):Buffer.from(C):C}function d(C,y,E){let b=C;if(C&&!E&&typeof C=="object"){if(S.endsWith(y,"{}"))y=s?y:y.slice(0,-2),C=JSON.stringify(C);else if(S.isArray(C)&&Zh(C)||(S.isFileList(C)||S.endsWith(y,"[]"))&&(b=S.toArray(C)))return y=Yi(y),b.forEach(function(N,w){!(S.isUndefined(N)||N===null)&&t.append(o===!0?Un([y],w,i):o===null?y:y+"[]",c(N))}),!1}return Us(C)?!0:(t.append(Un(E,y,i),c(C)),!1)}const u=[],f=Object.assign(eu,{defaultVisitor:d,convertValue:c,isVisitable:Us});function g(C,y){if(!S.isUndefined(C)){if(u.indexOf(C)!==-1)throw Error("Circular reference detected in "+y.join("."));u.push(C),S.forEach(C,function(b,F){(!(S.isUndefined(b)||b===null)&&n.call(t,b,S.isString(F)?F.trim():F,y,f))===!0&&g(b,y?y.concat(F):[F])}),u.pop()}}if(!S.isObject(r))throw new TypeError("data must be an object");return g(r),t}function Xn(r){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function fn(r,t){this._pairs=[],r&&Ts(r,this,t)}const Ui=fn.prototype;Ui.append=function(t,e){this._pairs.push([t,e])};Ui.toString=function(t){const e=t?function(s){return t.call(this,s,Xn)}:Xn;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};function tu(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Xi(r,t,e){if(!t)return r;const s=e&&e.encode||tu;S.isFunction(e)&&(e={serialize:e});const n=e&&e.serialize;let i;if(n?i=n(t,e):i=S.isURLSearchParams(t)?t.toString():new fn(t,e).toString(s),i){const o=r.indexOf("#");o!==-1&&(r=r.slice(0,o)),r+=(r.indexOf("?")===-1?"?":"&")+i}return r}class qn{constructor(){this.handlers=[]}use(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){S.forEach(this.handlers,function(s){s!==null&&t(s)})}}const qi={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},su=typeof URLSearchParams<"u"?URLSearchParams:fn,nu=typeof FormData<"u"?FormData:null,iu=typeof Blob<"u"?Blob:null,ru={isBrowser:!0,classes:{URLSearchParams:su,FormData:nu,Blob:iu},protocols:["http","https","file","blob","url","data"]},gn=typeof window<"u"&&typeof document<"u",Xs=typeof navigator=="object"&&navigator||void 0,ou=gn&&(!Xs||["ReactNative","NativeScript","NS"].indexOf(Xs.product)<0),au=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",lu=gn&&window.location.href||"http://localhost",cu=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:gn,hasStandardBrowserEnv:ou,hasStandardBrowserWebWorkerEnv:au,navigator:Xs,origin:lu},Symbol.toStringTag,{value:"Module"})),we={...cu,...ru};function du(r,t){return Ts(r,new we.classes.URLSearchParams,Object.assign({visitor:function(e,s,n,i){return we.isNode&&S.isBuffer(e)?(this.append(s,e.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},t))}function hu(r){return S.matchAll(/\w+|\[(\w*)]/g,r).map(t=>t[0]==="[]"?"":t[1]||t[0])}function uu(r){const t={},e=Object.keys(r);let s;const n=e.length;let i;for(s=0;s<n;s++)i=e[s],t[i]=r[i];return t}function Ji(r){function t(e,s,n,i){let o=e[i++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),l=i>=e.length;return o=!o&&S.isArray(n)?n.length:o,l?(S.hasOwnProp(n,o)?n[o]=[n[o],s]:n[o]=s,!a):((!n[o]||!S.isObject(n[o]))&&(n[o]=[]),t(e,s,n[o],i)&&S.isArray(n[o])&&(n[o]=uu(n[o])),!a)}if(S.isFormData(r)&&S.isFunction(r.entries)){const e={};return S.forEachEntry(r,(s,n)=>{t(hu(s),n,e,0)}),e}return null}function fu(r,t,e){if(S.isString(r))try{return(t||JSON.parse)(r),S.trim(r)}catch(s){if(s.name!=="SyntaxError")throw s}return(0,JSON.stringify)(r)}const Ut={transitional:qi,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const s=e.getContentType()||"",n=s.indexOf("application/json")>-1,i=S.isObject(t);if(i&&S.isHTMLForm(t)&&(t=new FormData(t)),S.isFormData(t))return n?JSON.stringify(Ji(t)):t;if(S.isArrayBuffer(t)||S.isBuffer(t)||S.isStream(t)||S.isFile(t)||S.isBlob(t)||S.isReadableStream(t))return t;if(S.isArrayBufferView(t))return t.buffer;if(S.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(i){if(s.indexOf("application/x-www-form-urlencoded")>-1)return du(t,this.formSerializer).toString();if((a=S.isFileList(t))||s.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return Ts(a?{"files[]":t}:t,l&&new l,this.formSerializer)}}return i||n?(e.setContentType("application/json",!1),fu(t)):t}],transformResponse:[function(t){const e=this.transitional||Ut.transitional,s=e&&e.forcedJSONParsing,n=this.responseType==="json";if(S.isResponse(t)||S.isReadableStream(t))return t;if(t&&S.isString(t)&&(s&&!this.responseType||n)){const o=!(e&&e.silentJSONParsing)&&n;try{return JSON.parse(t)}catch(a){if(o)throw a.name==="SyntaxError"?te.from(a,te.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:we.classes.FormData,Blob:we.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};S.forEach(["delete","get","head","post","put","patch"],r=>{Ut.headers[r]={}});const gu=S.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),mu=r=>{const t={};let e,s,n;return r&&r.split(`
`).forEach(function(o){n=o.indexOf(":"),e=o.substring(0,n).trim().toLowerCase(),s=o.substring(n+1).trim(),!(!e||t[e]&&gu[e])&&(e==="set-cookie"?t[e]?t[e].push(s):t[e]=[s]:t[e]=t[e]?t[e]+", "+s:s)}),t},Jn=Symbol("internals");function kt(r){return r&&String(r).trim().toLowerCase()}function is(r){return r===!1||r==null?r:S.isArray(r)?r.map(is):String(r)}function pu(r){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=e.exec(r);)t[s[1]]=s[2];return t}const Cu=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Bs(r,t,e,s,n){if(S.isFunction(s))return s.call(this,t,e);if(n&&(t=e),!!S.isString(t)){if(S.isString(s))return t.indexOf(s)!==-1;if(S.isRegExp(s))return s.test(t)}}function yu(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,s)=>e.toUpperCase()+s)}function _u(r,t){const e=S.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(r,s+e,{value:function(n,i,o){return this[s].call(this,t,n,i,o)},configurable:!0})})}class Re{constructor(t){t&&this.set(t)}set(t,e,s){const n=this;function i(a,l,c){const d=kt(l);if(!d)throw new Error("header name must be a non-empty string");const u=S.findKey(n,d);(!u||n[u]===void 0||c===!0||c===void 0&&n[u]!==!1)&&(n[u||l]=is(a))}const o=(a,l)=>S.forEach(a,(c,d)=>i(c,d,l));if(S.isPlainObject(t)||t instanceof this.constructor)o(t,e);else if(S.isString(t)&&(t=t.trim())&&!Cu(t))o(mu(t),e);else if(S.isHeaders(t))for(const[a,l]of t.entries())i(l,a,s);else t!=null&&i(e,t,s);return this}get(t,e){if(t=kt(t),t){const s=S.findKey(this,t);if(s){const n=this[s];if(!e)return n;if(e===!0)return pu(n);if(S.isFunction(e))return e.call(this,n,s);if(S.isRegExp(e))return e.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=kt(t),t){const s=S.findKey(this,t);return!!(s&&this[s]!==void 0&&(!e||Bs(this,this[s],s,e)))}return!1}delete(t,e){const s=this;let n=!1;function i(o){if(o=kt(o),o){const a=S.findKey(s,o);a&&(!e||Bs(s,s[a],a,e))&&(delete s[a],n=!0)}}return S.isArray(t)?t.forEach(i):i(t),n}clear(t){const e=Object.keys(this);let s=e.length,n=!1;for(;s--;){const i=e[s];(!t||Bs(this,this[i],i,t,!0))&&(delete this[i],n=!0)}return n}normalize(t){const e=this,s={};return S.forEach(this,(n,i)=>{const o=S.findKey(s,i);if(o){e[o]=is(n),delete e[i];return}const a=t?yu(i):String(i).trim();a!==i&&delete e[i],e[a]=is(n),s[a]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return S.forEach(this,(s,n)=>{s!=null&&s!==!1&&(e[n]=t&&S.isArray(s)?s.join(", "):s)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const s=new this(t);return e.forEach(n=>s.set(n)),s}static accessor(t){const s=(this[Jn]=this[Jn]={accessors:{}}).accessors,n=this.prototype;function i(o){const a=kt(o);s[a]||(_u(n,o),s[a]=!0)}return S.isArray(t)?t.forEach(i):i(t),this}}Re.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);S.reduceDescriptors(Re.prototype,({value:r},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(s){this[e]=s}}});S.freezeMethods(Re);function Ds(r,t){const e=this||Ut,s=t||e,n=Re.from(s.headers);let i=s.data;return S.forEach(r,function(a){i=a.call(e,i,n.normalize(),t?t.status:void 0)}),n.normalize(),i}function Ki(r){return!!(r&&r.__CANCEL__)}function Tt(r,t,e){te.call(this,r??"canceled",te.ERR_CANCELED,t,e),this.name="CanceledError"}S.inherits(Tt,te,{__CANCEL__:!0});function Qi(r,t,e){const s=e.config.validateStatus;!e.status||!s||s(e.status)?r(e):t(new te("Request failed with status code "+e.status,[te.ERR_BAD_REQUEST,te.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function Eu(r){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return t&&t[1]||""}function xu(r,t){r=r||10;const e=new Array(r),s=new Array(r);let n=0,i=0,o;return t=t!==void 0?t:1e3,function(l){const c=Date.now(),d=s[i];o||(o=c),e[n]=l,s[n]=c;let u=i,f=0;for(;u!==n;)f+=e[u++],u=u%r;if(n=(n+1)%r,n===i&&(i=(i+1)%r),c-o<t)return;const g=d&&c-d;return g?Math.round(f*1e3/g):void 0}}function Su(r,t){let e=0,s=1e3/t,n,i;const o=(c,d=Date.now())=>{e=d,n=null,i&&(clearTimeout(i),i=null),r.apply(null,c)};return[(...c)=>{const d=Date.now(),u=d-e;u>=s?o(c,d):(n=c,i||(i=setTimeout(()=>{i=null,o(n)},s-u)))},()=>n&&o(n)]}const fs=(r,t,e=3)=>{let s=0;const n=xu(50,250);return Su(i=>{const o=i.loaded,a=i.lengthComputable?i.total:void 0,l=o-s,c=n(l),d=o<=a;s=o;const u={loaded:o,total:a,progress:a?o/a:void 0,bytes:l,rate:c||void 0,estimated:c&&a&&d?(a-o)/c:void 0,event:i,lengthComputable:a!=null,[t?"download":"upload"]:!0};r(u)},e)},Kn=(r,t)=>{const e=r!=null;return[s=>t[0]({lengthComputable:e,total:r,loaded:s}),t[1]]},Qn=r=>(...t)=>S.asap(()=>r(...t)),bu=we.hasStandardBrowserEnv?((r,t)=>e=>(e=new URL(e,we.origin),r.protocol===e.protocol&&r.host===e.host&&(t||r.port===e.port)))(new URL(we.origin),we.navigator&&/(msie|trident)/i.test(we.navigator.userAgent)):()=>!0,vu=we.hasStandardBrowserEnv?{write(r,t,e,s,n,i){const o=[r+"="+encodeURIComponent(t)];S.isNumber(e)&&o.push("expires="+new Date(e).toGMTString()),S.isString(s)&&o.push("path="+s),S.isString(n)&&o.push("domain="+n),i===!0&&o.push("secure"),document.cookie=o.join("; ")},read(r){const t=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function wu(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function Tu(r,t){return t?r.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):r}function Zi(r,t){return r&&!wu(t)?Tu(r,t):t}const Zn=r=>r instanceof Re?{...r}:r;function dt(r,t){t=t||{};const e={};function s(c,d,u,f){return S.isPlainObject(c)&&S.isPlainObject(d)?S.merge.call({caseless:f},c,d):S.isPlainObject(d)?S.merge({},d):S.isArray(d)?d.slice():d}function n(c,d,u,f){if(S.isUndefined(d)){if(!S.isUndefined(c))return s(void 0,c,u,f)}else return s(c,d,u,f)}function i(c,d){if(!S.isUndefined(d))return s(void 0,d)}function o(c,d){if(S.isUndefined(d)){if(!S.isUndefined(c))return s(void 0,c)}else return s(void 0,d)}function a(c,d,u){if(u in t)return s(c,d);if(u in r)return s(void 0,c)}const l={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(c,d,u)=>n(Zn(c),Zn(d),u,!0)};return S.forEach(Object.keys(Object.assign({},r,t)),function(d){const u=l[d]||n,f=u(r[d],t[d],d);S.isUndefined(f)&&u!==a||(e[d]=f)}),e}const er=r=>{const t=dt({},r);let{data:e,withXSRFToken:s,xsrfHeaderName:n,xsrfCookieName:i,headers:o,auth:a}=t;t.headers=o=Re.from(o),t.url=Xi(Zi(t.baseURL,t.url),r.params,r.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let l;if(S.isFormData(e)){if(we.hasStandardBrowserEnv||we.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((l=o.getContentType())!==!1){const[c,...d]=l?l.split(";").map(u=>u.trim()).filter(Boolean):[];o.setContentType([c||"multipart/form-data",...d].join("; "))}}if(we.hasStandardBrowserEnv&&(s&&S.isFunction(s)&&(s=s(t)),s||s!==!1&&bu(t.url))){const c=n&&i&&vu.read(i);c&&o.set(n,c)}return t},Au=typeof XMLHttpRequest<"u",Ou=Au&&function(r){return new Promise(function(e,s){const n=er(r);let i=n.data;const o=Re.from(n.headers).normalize();let{responseType:a,onUploadProgress:l,onDownloadProgress:c}=n,d,u,f,g,C;function y(){g&&g(),C&&C(),n.cancelToken&&n.cancelToken.unsubscribe(d),n.signal&&n.signal.removeEventListener("abort",d)}let E=new XMLHttpRequest;E.open(n.method.toUpperCase(),n.url,!0),E.timeout=n.timeout;function b(){if(!E)return;const N=Re.from("getAllResponseHeaders"in E&&E.getAllResponseHeaders()),v={data:!a||a==="text"||a==="json"?E.responseText:E.response,status:E.status,statusText:E.statusText,headers:N,config:r,request:E};Qi(function(D){e(D),y()},function(D){s(D),y()},v),E=null}"onloadend"in E?E.onloadend=b:E.onreadystatechange=function(){!E||E.readyState!==4||E.status===0&&!(E.responseURL&&E.responseURL.indexOf("file:")===0)||setTimeout(b)},E.onabort=function(){E&&(s(new te("Request aborted",te.ECONNABORTED,r,E)),E=null)},E.onerror=function(){s(new te("Network Error",te.ERR_NETWORK,r,E)),E=null},E.ontimeout=function(){let w=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const v=n.transitional||qi;n.timeoutErrorMessage&&(w=n.timeoutErrorMessage),s(new te(w,v.clarifyTimeoutError?te.ETIMEDOUT:te.ECONNABORTED,r,E)),E=null},i===void 0&&o.setContentType(null),"setRequestHeader"in E&&S.forEach(o.toJSON(),function(w,v){E.setRequestHeader(v,w)}),S.isUndefined(n.withCredentials)||(E.withCredentials=!!n.withCredentials),a&&a!=="json"&&(E.responseType=n.responseType),c&&([f,C]=fs(c,!0),E.addEventListener("progress",f)),l&&E.upload&&([u,g]=fs(l),E.upload.addEventListener("progress",u),E.upload.addEventListener("loadend",g)),(n.cancelToken||n.signal)&&(d=N=>{E&&(s(!N||N.type?new Tt(null,r,E):N),E.abort(),E=null)},n.cancelToken&&n.cancelToken.subscribe(d),n.signal&&(n.signal.aborted?d():n.signal.addEventListener("abort",d)));const F=Eu(n.url);if(F&&we.protocols.indexOf(F)===-1){s(new te("Unsupported protocol "+F+":",te.ERR_BAD_REQUEST,r));return}E.send(i||null)})},Iu=(r,t)=>{const{length:e}=r=r?r.filter(Boolean):[];if(t||e){let s=new AbortController,n;const i=function(c){if(!n){n=!0,a();const d=c instanceof Error?c:this.reason;s.abort(d instanceof te?d:new Tt(d instanceof Error?d.message:d))}};let o=t&&setTimeout(()=>{o=null,i(new te(`timeout ${t} of ms exceeded`,te.ETIMEDOUT))},t);const a=()=>{r&&(o&&clearTimeout(o),o=null,r.forEach(c=>{c.unsubscribe?c.unsubscribe(i):c.removeEventListener("abort",i)}),r=null)};r.forEach(c=>c.addEventListener("abort",i));const{signal:l}=s;return l.unsubscribe=()=>S.asap(a),l}},Lu=function*(r,t){let e=r.byteLength;if(e<t){yield r;return}let s=0,n;for(;s<e;)n=s+t,yield r.slice(s,n),s=n},Pu=async function*(r,t){for await(const e of Ru(r))yield*Lu(e,t)},Ru=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const t=r.getReader();try{for(;;){const{done:e,value:s}=await t.read();if(e)break;yield s}}finally{await t.cancel()}},ei=(r,t,e,s)=>{const n=Pu(r,t);let i=0,o,a=l=>{o||(o=!0,s&&s(l))};return new ReadableStream({async pull(l){try{const{done:c,value:d}=await n.next();if(c){a(),l.close();return}let u=d.byteLength;if(e){let f=i+=u;e(f)}l.enqueue(new Uint8Array(d))}catch(c){throw a(c),c}},cancel(l){return a(l),n.return()}},{highWaterMark:2})},As=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",tr=As&&typeof ReadableStream=="function",ku=As&&(typeof TextEncoder=="function"?(r=>t=>r.encode(t))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),sr=(r,...t)=>{try{return!!r(...t)}catch{return!1}},Fu=tr&&sr(()=>{let r=!1;const t=new Request(we.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!t}),ti=64*1024,qs=tr&&sr(()=>S.isReadableStream(new Response("").body)),gs={stream:qs&&(r=>r.body)};As&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!gs[t]&&(gs[t]=S.isFunction(r[t])?e=>e[t]():(e,s)=>{throw new te(`Response type '${t}' is not supported`,te.ERR_NOT_SUPPORT,s)})})})(new Response);const Bu=async r=>{if(r==null)return 0;if(S.isBlob(r))return r.size;if(S.isSpecCompliantForm(r))return(await new Request(we.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(S.isArrayBufferView(r)||S.isArrayBuffer(r))return r.byteLength;if(S.isURLSearchParams(r)&&(r=r+""),S.isString(r))return(await ku(r)).byteLength},Du=async(r,t)=>{const e=S.toFiniteNumber(r.getContentLength());return e??Bu(t)},Mu=As&&(async r=>{let{url:t,method:e,data:s,signal:n,cancelToken:i,timeout:o,onDownloadProgress:a,onUploadProgress:l,responseType:c,headers:d,withCredentials:u="same-origin",fetchOptions:f}=er(r);c=c?(c+"").toLowerCase():"text";let g=Iu([n,i&&i.toAbortSignal()],o),C;const y=g&&g.unsubscribe&&(()=>{g.unsubscribe()});let E;try{if(l&&Fu&&e!=="get"&&e!=="head"&&(E=await Du(d,s))!==0){let v=new Request(t,{method:"POST",body:s,duplex:"half"}),P;if(S.isFormData(s)&&(P=v.headers.get("content-type"))&&d.setContentType(P),v.body){const[D,M]=Kn(E,fs(Qn(l)));s=ei(v.body,ti,D,M)}}S.isString(u)||(u=u?"include":"omit");const b="credentials"in Request.prototype;C=new Request(t,{...f,signal:g,method:e.toUpperCase(),headers:d.normalize().toJSON(),body:s,duplex:"half",credentials:b?u:void 0});let F=await fetch(C);const N=qs&&(c==="stream"||c==="response");if(qs&&(a||N&&y)){const v={};["status","statusText","headers"].forEach(J=>{v[J]=F[J]});const P=S.toFiniteNumber(F.headers.get("content-length")),[D,M]=a&&Kn(P,fs(Qn(a),!0))||[];F=new Response(ei(F.body,ti,D,()=>{M&&M(),y&&y()}),v)}c=c||"text";let w=await gs[S.findKey(gs,c)||"text"](F,r);return!N&&y&&y(),await new Promise((v,P)=>{Qi(v,P,{data:w,headers:Re.from(F.headers),status:F.status,statusText:F.statusText,config:r,request:C})})}catch(b){throw y&&y(),b&&b.name==="TypeError"&&/fetch/i.test(b.message)?Object.assign(new te("Network Error",te.ERR_NETWORK,r,C),{cause:b.cause||b}):te.from(b,b&&b.code,r,C)}}),Js={http:Qh,xhr:Ou,fetch:Mu};S.forEach(Js,(r,t)=>{if(r){try{Object.defineProperty(r,"name",{value:t})}catch{}Object.defineProperty(r,"adapterName",{value:t})}});const si=r=>`- ${r}`,Nu=r=>S.isFunction(r)||r===null||r===!1,nr={getAdapter:r=>{r=S.isArray(r)?r:[r];const{length:t}=r;let e,s;const n={};for(let i=0;i<t;i++){e=r[i];let o;if(s=e,!Nu(e)&&(s=Js[(o=String(e)).toLowerCase()],s===void 0))throw new te(`Unknown adapter '${o}'`);if(s)break;n[o||"#"+i]=s}if(!s){const i=Object.entries(n).map(([a,l])=>`adapter ${a} `+(l===!1?"is not supported by the environment":"is not available in the build"));let o=t?i.length>1?`since :
`+i.map(si).join(`
`):" "+si(i[0]):"as no adapter specified";throw new te("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return s},adapters:Js};function Ms(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Tt(null,r)}function ni(r){return Ms(r),r.headers=Re.from(r.headers),r.data=Ds.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),nr.getAdapter(r.adapter||Ut.adapter)(r).then(function(s){return Ms(r),s.data=Ds.call(r,r.transformResponse,s),s.headers=Re.from(s.headers),s},function(s){return Ki(s)||(Ms(r),s&&s.response&&(s.response.data=Ds.call(r,r.transformResponse,s.response),s.response.headers=Re.from(s.response.headers))),Promise.reject(s)})}const ir="1.7.9",Os={};["object","boolean","number","function","string","symbol"].forEach((r,t)=>{Os[r]=function(s){return typeof s===r||"a"+(t<1?"n ":" ")+r}});const ii={};Os.transitional=function(t,e,s){function n(i,o){return"[Axios v"+ir+"] Transitional option '"+i+"'"+o+(s?". "+s:"")}return(i,o,a)=>{if(t===!1)throw new te(n(o," has been removed"+(e?" in "+e:"")),te.ERR_DEPRECATED);return e&&!ii[o]&&(ii[o]=!0,console.warn(n(o," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(i,o,a):!0}};Os.spelling=function(t){return(e,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function Vu(r,t,e){if(typeof r!="object")throw new te("options must be an object",te.ERR_BAD_OPTION_VALUE);const s=Object.keys(r);let n=s.length;for(;n-- >0;){const i=s[n],o=t[i];if(o){const a=r[i],l=a===void 0||o(a,i,r);if(l!==!0)throw new te("option "+i+" must be "+l,te.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new te("Unknown option "+i,te.ERR_BAD_OPTION)}}const rs={assertOptions:Vu,validators:Os},Je=rs.validators;class lt{constructor(t){this.defaults=t,this.interceptors={request:new qn,response:new qn}}async request(t,e){try{return await this._request(t,e)}catch(s){if(s instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const i=n.stack?n.stack.replace(/^.+\n/,""):"";try{s.stack?i&&!String(s.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+i):s.stack=i}catch{}}throw s}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=dt(this.defaults,e);const{transitional:s,paramsSerializer:n,headers:i}=e;s!==void 0&&rs.assertOptions(s,{silentJSONParsing:Je.transitional(Je.boolean),forcedJSONParsing:Je.transitional(Je.boolean),clarifyTimeoutError:Je.transitional(Je.boolean)},!1),n!=null&&(S.isFunction(n)?e.paramsSerializer={serialize:n}:rs.assertOptions(n,{encode:Je.function,serialize:Je.function},!0)),rs.assertOptions(e,{baseUrl:Je.spelling("baseURL"),withXsrfToken:Je.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let o=i&&S.merge(i.common,i[e.method]);i&&S.forEach(["delete","get","head","post","put","patch","common"],C=>{delete i[C]}),e.headers=Re.concat(o,i);const a=[];let l=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(e)===!1||(l=l&&y.synchronous,a.unshift(y.fulfilled,y.rejected))});const c=[];this.interceptors.response.forEach(function(y){c.push(y.fulfilled,y.rejected)});let d,u=0,f;if(!l){const C=[ni.bind(this),void 0];for(C.unshift.apply(C,a),C.push.apply(C,c),f=C.length,d=Promise.resolve(e);u<f;)d=d.then(C[u++],C[u++]);return d}f=a.length;let g=e;for(u=0;u<f;){const C=a[u++],y=a[u++];try{g=C(g)}catch(E){y.call(this,E);break}}try{d=ni.call(this,g)}catch(C){return Promise.reject(C)}for(u=0,f=c.length;u<f;)d=d.then(c[u++],c[u++]);return d}getUri(t){t=dt(this.defaults,t);const e=Zi(t.baseURL,t.url);return Xi(e,t.params,t.paramsSerializer)}}S.forEach(["delete","get","head","options"],function(t){lt.prototype[t]=function(e,s){return this.request(dt(s||{},{method:t,url:e,data:(s||{}).data}))}});S.forEach(["post","put","patch"],function(t){function e(s){return function(i,o,a){return this.request(dt(a||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}lt.prototype[t]=e(),lt.prototype[t+"Form"]=e(!0)});class mn{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(i){e=i});const s=this;this.promise.then(n=>{if(!s._listeners)return;let i=s._listeners.length;for(;i-- >0;)s._listeners[i](n);s._listeners=null}),this.promise.then=n=>{let i;const o=new Promise(a=>{s.subscribe(a),i=a}).then(n);return o.cancel=function(){s.unsubscribe(i)},o},t(function(i,o,a){s.reason||(s.reason=new Tt(i,o,a),e(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=s=>{t.abort(s)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new mn(function(n){t=n}),cancel:t}}}function Hu(r){return function(e){return r.apply(null,e)}}function Wu(r){return S.isObject(r)&&r.isAxiosError===!0}const Ks={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ks).forEach(([r,t])=>{Ks[t]=r});function rr(r){const t=new lt(r),e=Di(lt.prototype.request,t);return S.extend(e,lt.prototype,t,{allOwnKeys:!0}),S.extend(e,t,null,{allOwnKeys:!0}),e.create=function(n){return rr(dt(r,n))},e}const ue=rr(Ut);ue.Axios=lt;ue.CanceledError=Tt;ue.CancelToken=mn;ue.isCancel=Ki;ue.VERSION=ir;ue.toFormData=Ts;ue.AxiosError=te;ue.Cancel=ue.CanceledError;ue.all=function(t){return Promise.all(t)};ue.spread=Hu;ue.isAxiosError=Wu;ue.mergeConfig=dt;ue.AxiosHeaders=Re;ue.formToJSON=r=>Ji(S.isHTMLForm(r)?new FormData(r):r);ue.getAdapter=nr.getAdapter;ue.HttpStatusCode=Ks;ue.default=ue;const zu=ai("app",{state:()=>({name:"app",locale:"zh",version:"1.0.0",user:{},token:"",config:{},menu:{},isMobile:!1,isLandscape:!1,isFullScreen:!1,isShowSidebar:!0,isShowHeader:!0,isShowFooter:!0}),actions:{async init(){const r=await Promise.all([this.getLocale(),this.getUserInfo(),this.getVersion(),this.getConfig()]),[t,e,s,n]=r;this.locale=t.data,this.user=e.data,this.version=s.data,this.config=n.data},async getLocale(){return"zh"},async getUserInfo(){return await ue.get("/api/user")},async getVersion(){return await ue.get("/api/version")},async getConfig(){return await ue.get("/api/config")},async getUploadToken(){return await ue.get("/api/upload/token")},async getUploadUrl(){return await ue.get("/api/upload/url")},async getUploadFileInfo(r){return await ue.get("/api/upload/file",r)},async getUploadFileList(r){return await ue.get("/api/upload/list",r)}}}),ju={class:"left"},Gu={class:"stage"},$u={class:"right"},Yu=de({__name:"App",setup(r){const{locale:t}=ur(),e=zu(),s=he(),{init:n,locale:i}=e;return n().then(()=>{t.value=i}),(o,a)=>{const l=uh,c=Zd,d=Bd;return W(),q("div",{class:Y([{penetrate:m(s).shouldUIPassThrough}])},[T("div",ju,[_(l)]),T("div",Gu,[_(c)]),T("div",$u,[_(d)])],2)}}}),Uu=fe(Yu,[["__scopeId","data-v-a34f9be8"]]),Xu="modulepreload",qu=function(r,t){return new URL(r,t).href},ri={},oi=function(t,e,s){let n=Promise.resolve();if(e&&e.length>0){const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(e.map(c=>{if(c=qu(c,s),c in ri)return;ri[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(!!s)for(let C=o.length-1;C>=0;C--){const y=o[C];if(y.href===c&&(!d||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${u}`))return;const g=document.createElement("link");if(g.rel=d?"stylesheet":Xu,d||(g.as="script"),g.crossOrigin="",g.href=c,l&&g.setAttribute("nonce",l),document.head.appendChild(g),d)return new Promise((C,y)=>{g.addEventListener("load",C),g.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return n.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return t().catch(i)})},or=fr({legacy:!1,locale:"zh",messages:{}});async function Ju(){const r=Object.assign({"/src/locales/en.json":()=>oi(()=>import("./en-BIHI7g3E.js"),[],import.meta.url),"/src/locales/zh.json":()=>oi(()=>import("./zh-DkCPf_Nl.js"),[],import.meta.url)});for(const t in r){const e=t.match(/\/([A-Za-z0-9-_]+)\.json$/)[1];r[t]().then(s=>{or.global.setLocaleMessage(e,s.default)})}}Ju();class pn{static async loadFont(t,e){e=e.replace("@",".");const s=new FontFace(t,`url(${e})`);await s.load(),document.fonts.add(s)}static async batchLoadFonts(t){await Promise.all(t.map(e=>pn.loadFont(e.name,e.url)))}}pn.batchLoadFonts(Ci);G.cacheStringImages([Ti,Oi,Li,Ii]);const Is=gr(Uu),Ku=mr();Is.use(Rr,{size:"small"});Is.use(Ku);Is.use(or);Is.mount("#app");
