var di=Object.defineProperty;var hi=(i,t,e)=>t in i?di(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var g=(i,t,e)=>hi(i,typeof t!="symbol"?t+"":t,e);import{x as ie,y as N,z as $,A as T,O as ge,P as x,C as K,L as Ft,aw as Kn,ab as X,r as q,G as fe,H as P,Q as ve,a4 as Oe,u as p,c as bt,I as Le,J as Re,k as ui,f as Z,M as z,D as cn,ax as fi,ay as gi,at as mi,az as pi}from"./vue-lfwZ6J9M.js";import{E as De,g as Ci,a as yi,b as Qn,d as Zn,e as er,f as _i,p as tr,m as sr,h as ss,i as ns,j as ke,k as mt,l as pt,n as Ws,o as js,q as Ei,r as xi,u as Si,s as vi,w as bi,t as wi,v as Ti,x as Ai,y as Pi,z as Oi}from"./element-BO459wjv.js";import{r as Li}from"./lodash-DMDLySbZ.js";import{m as nr,o as ne,r as We,a as lt,c as Ri,b as ki}from"./mobx-DpHXnjKJ.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const Ii={class:"creator-menu__item"},Fi={class:"text"},Bi={class:"icon"},Mi={key:0,class:"shortcut"},Di=ie({__name:"CreatorDropDownItem",props:{creator:{}},setup(i){return(t,e)=>{const s=De;return N(),$("div",Ii,[T("div",Fi,ge(t.creator.name),1),T("div",Bi,[x(s,{class:K(["iconfont",t.creator.icon])},null,8,["class"])]),t.creator.shortcut?(N(),$("div",Mi,ge(t.creator.shortcut),1)):Ft("",!0)])}}});class Ni{constructor(){g(this,"el")}async init(t){this.el=t}}const dn=2,hn=2,Vi=4,Hi=4,zi=4,un=8,rr=32;var Ce=(i=>(i[i.path=0]="path",i[i.transformer=1]="transformer",i[i.cursor=2]="cursor",i[i.cursorPosition=3]="cursorPosition",i[i.selection=4]="selection",i[i.rotate=5]="rotate",i[i.indicator=6]="indicator",i[i.range=7]="range",i))(Ce||{}),Q=(i=>(i[i.initialed=-1]="initialed",i[i.startCreating=0]="startCreating",i[i.creating=1]="creating",i[i.finished=2]="finished",i[i.editing=3]="editing",i))(Q||{}),E=(i=>(i.elementCreated="elementCreated",i.selectedChanged="selectedChanged",i.targetChanged="targetChanged",i.positionChanged="positionChanged",i.widthChanged="widthChanged",i.heightChanged="heightChanged",i.angleChanged="angleChanged",i.cornersChanged="cornersChanged",i.flipXChanged="flipXChanged",i.leanYAngleChanged="leanYAngleChanged",i.scaleChanged="scaleChanged",i.strokesChanged="strokesChanged",i.fillsChanged="fillsChanged",i.fontStylerChanged="fontStylerChanged",i.fontSizeChanged="fontSizeChanged",i.fontFamilyChanged="fontFamilyChanged",i.fontLineHeightChanged="fontLineHeightChanged",i.fontLineHeightFactorChanged="fontLineHeightFactorChanged",i.fontLineHeightAutoFitChanged="fontLineHeightAutoFitChanged",i.fontLetterSpacingChanged="fontLetterSpacingChanged",i.fontColorChanged="fontColorChanged",i.fontColorOpacityChanged="fontColorOpacityChanged",i.fontStylerMixinChanged="fontStylerMixinChanged",i.fontSizeMixinChanged="fontSizeMixinChanged",i.fontFamilyMixinChanged="fontFamilyMixinChanged",i.fontColorMixinChanged="fontColorMixinChanged",i.fontColorOpacityMixinChanged="fontColorOpacityMixinChanged",i.fontLetterSpacingMixinChanged="fontLetterSpacingMixinChanged",i.textDecorationChanged="textDecorationChanged",i.textDecorationColorChanged="textDecorationColorChanged",i.textDecorationOpacityChanged="textDecorationOpacityChanged",i.textDecorationThicknessChanged="textDecorationThicknessChanged",i.textDecorationMixinChanged="textDecorationMixinChanged",i.textDecorationColorMixinChanged="textDecorationColorMixinChanged",i.textDecorationOpacityMixinChanged="textDecorationOpacityMixinChanged",i.textDecorationThicknessMixinChanged="textDecorationThicknessMixinChanged",i.textAlignChanged="textAlignChanged",i.textVerticalAlignChanged="textVerticalAlignChanged",i.textBaselineChanged="textBaselineChanged",i.paragraphSpacingChanged="paragraphSpacingChanged",i.creatorChanged="creatorChanged",i.ratioLockedChanged="ratioLockedChanged",i.multiSelectedChanged="multiSelectedChanged",i.primarySelectedChanged="primarySelectedChanged",i.layerShiftMoveEnableChanged="layerShiftMoveEnableChanged",i.layerGoDownEnableChanged="layerGoDownEnableChanged",i.statusChanged="statusChanged",i))(E||{}),Gs=(i=>(i[i.START=0]="START",i[i.UPDATE=1]="UPDATE",i[i.END=2]="END",i))(Gs||{}),V=(i=>(i[i.LEFT=0]="LEFT",i[i.RIGHT=1]="RIGHT",i[i.TOP=2]="TOP",i[i.BOTTOM=3]="BOTTOM",i))(V||{});class fn{constructor(t){g(this,"prev",null);g(this,"next",null);g(this,"value");this.value=t}get isHead(){return this.prev===null}get isTail(){return this.next===null}get isEmpty(){return this.value===null}insertAfter(t){const e=this.next;this.next=t,t.prev=this,t.next=e,e&&(e.prev=t)}insertBefore(t){const e=this.prev;this.prev=t,t.next=this,t.prev=e,e&&(e.next=t)}}const Wi="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Xe=(i=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(i|=0));for(;i--;)t+=Wi[e[i]&63];return t};const At=new Worker(new URL(""+new URL("MathWorker-CmujXtXM.js",import.meta.url).href,import.meta.url),{type:"module"}),dt=new Map;At.onmessage=i=>{const{id:t,result:e}=i.data;let s=dt.get(t);s&&s(e),dt.delete(t),s=null};class d{static multiply(t,e){const s=t.length,n=t[0].length;if(Array.isArray(e[0])){const r=e.length,o=e[0].length;if(n!==r)throw new Error("矩阵 A 的列数必须等于矩阵 B 的行数");const a=new Array(s);for(let l=0;l<s;l++)a[l]=new Array(o).fill(0);for(let l=0;l<s;l++)for(let c=0;c<o;c++)for(let h=0;h<n;h++)a[l][c]+=t[l][h]*e[h][c];return a}else{if(n!==e.length)throw new Error("矩阵 A 的列数必须等于向量的长度");const r=new Array(s).fill(0);for(let o=0;o<s;o++)for(let a=0;a<n;a++)r[o]+=t[o][a]*e[a];return r}}static calcTranslateMatrix(t,e){return[[1,0,t],[0,1,e],[0,0,1]]}static translate(t,e){return!e||e.x===0&&e.y===0?t:{x:t.x+e.x,y:t.y+e.y}}static batchTranslate(t,e){return t.map(s=>this.translate(s,e))}static asyncTranslate(t,e){return new Promise(s=>{const n=`${Date.now()}_${Xe(4)}`;At.postMessage({funcName:"translate",args:[t,e],id:n}),dt.set(n,r=>{s(r)})})}static asyncBatchTranslate(t,e){return new Promise(s=>{const n=`${Date.now()}_${Xe(4)}`;At.postMessage({funcName:"batchTranslate",args:[t,e],id:n}),dt.set(n,r=>{s(r)})})}static asyncNamedBatchTranslate(t,e){return new Promise(s=>{const n=`${Date.now()}_${Xe(4)}`;At.postMessage({funcName:"namedBatchTranslate",args:[t,e],id:n}),dt.set(n,r=>{s(r)})})}static asyncMapNamedBatchTranslate(t,e){return new Promise(s=>{const n=`${Date.now()}_${Xe(4)}`;At.postMessage({funcName:"mapNamedBatchTranslate",args:[t,e],id:n}),dt.set(n,r=>{s(r)})})}static rotate(t,e){if(e===0)return t;const s=d.calcRotateMatrix(e),n=d.multiply(s,[t.x,t.y,1]);return{x:n[0],y:n[1]}}static batchRotate(t,e){return t.map(s=>this.rotate(s,e))}static calcScaleMatrix(t,e){return[[t,0,0],[0,e,0],[0,0,1]]}static calcTransformMatrix(t,e,s,n={}){e=d.transWithCenter(e,n,t,!0),s=d.transWithCenter(s,n,t,!0);const r=s.x-t.x,o=s.y-t.y,a=e.x-t.x,l=e.y-t.y,c=r===0?1:a/r,h=o===0?1:l/o;return d.calcScaleMatrix(c,h)}static rotateWithCenter(t,e,s){if(e===0||!s)return t;t={x:t.x-s.x,y:t.y-s.y};const n=d.rotate(t,e);return{x:n.x+s.x,y:n.y+s.y}}static batchRotateWithCenter(t,e,s){return t.map(n=>d.rotateWithCenter(n,e,s))}static leanYWithCenter(t,e,s){return d.leanWithCenter(t,0,e,s)}static batchLeanYWithCenter(t,e,s){return t.map(n=>d.leanYWithCenter(n,e,s))}static leanXWithCenter(t,e,s){return d.leanWithCenter(t,e,0,s)}static batchLeanXWithCenter(t,e,s){return t.map(n=>d.leanXWithCenter(n,e,s))}static calcLeanMatrix(t,e){t=t||0,e=e||0;const s=Math.tan(d.angleToRadian(t));return[[1,-Math.tan(d.angleToRadian(e)),0],[s,1,0],[0,0,1]]}static calcRotateMatrix(t){t=t||0;const e=d.angleToRadian(t);return[[Math.cos(e),-Math.sin(e),0],[Math.sin(e),Math.cos(e),0],[0,0,1]]}static leanWithCenter(t,e,s,n){if(e===0&&s===0)return t;const r=d.calcLeanMatrix(e,s),o=d.multiply(r,[t.x-n.x,t.y-n.y,1]);return{x:o[0]+n.x,y:o[1]+n.y}}static batchLeanWithCenter(t,e,s,n){return t.map(r=>d.leanWithCenter(r,e,s,n))}static transWithCenter(t,e,s,n){let{angle:r=0,leanXAngle:o=0,leanYAngle:a=0}=e||{};if(r===0&&o===0&&a===0)return t;n&&(r=-r,o=-o,a=-a);let l;const c=d.calcLeanMatrix(o,a),h=d.calcRotateMatrix(r);n?l=d.multiply(c,h):l=d.multiply(h,c);let u=d.multiply(l,[t.x-s.x,t.y-s.y,1]);return{x:u[0]+s.x,y:u[1]+s.y}}static batchTransWithCenter(t,e,s,n){return t.map(r=>d.transWithCenter(r,e,s,n))}static rotateAndTranslate(t,e,s){return d.translate(d.rotate(t,e),s)}static translateArcPoint(t,e){let{start:s,controller:n,end:r,corner:o,value:a}=t;return[s,n,r,o]=d.batchTranslate([s,n,r,o],e),{start:s,controller:n,end:r,corner:o,value:a}}static translateArcPoints(t,e){return t.map(s=>d.translateArcPoint(s,e))}static batchTranslateArcPoints(t,e){return t.map((s,n)=>d.translateArcPoints(s,e))}static calcSymmetryPoint(t,e,s){const n=s.x-e.x,r=s.y-e.y,o=n*n+r*r;if(o===0)return{...t};const a=t.x-e.x,l=t.y-e.y,h=(a*n+l*r)/o,u=e.x+h*n,f=e.y+h*r,m=2*u-t.x,C=2*f-t.y;return{x:m,y:C}}static calcHorizontalSymmetryPointInRect(t,e){const{x:s,y:n,width:r,height:o}=e,a=(s+s+r)/2,l=(n+n+o)/2;return d.calcSymmetryPoint(t,{x:a,y:l},{x:a,y:n})}static calcVerticalSymmetryPointInRect(t,e){const{x:s,y:n,width:r,height:o}=e,a=(s+s+r)/2,l=(n+n+o)/2;return d.calcSymmetryPoint(t,{x:a,y:l},{x:s,y:l})}static batchCalcSymmetryPoints(t,e,s){return t.map(n=>d.calcSymmetryPoint(n,e,s))}static scale(t,e){if(e.sx===1&&e.sy===1)return t;const s=d.calcScaleMatrix(e.sx,e.sy),n=d.multiply(s,[t.x,t.y,1]);return{x:n[0],y:n[1]}}static scales(t,e){return t.map(s=>d.scale(s,e))}static scaleWithCenter(t,e,s){return e.sx===1&&e.sy===1?t:(t={x:t.x-s.x,y:t.y-s.y},t=d.scale(t,e),{x:t.x+s.x,y:t.y+s.y})}static batchScaleWithCenter(t,e,s){return t.map(n=>d.scaleWithCenter(n,e,s))}static angleToRadian(t){return t*(Math.PI/180)}static radianToAngle(t){return t*(180/Math.PI)}static isPointInPolygonByRayCasting(t,e){const s=[t.x,t.y],n=e.map(l=>[l.x,l.y]),[r,o]=s;let a=!1;for(let l=0,c=n.length-1;l<n.length;c=l++){const[h,u]=n[l],[f,m]=n[c];if(u>o!=m>o&&r<(f-h)*(o-u)/(m-u)+h&&(a=!a),u===o&&o===m&&r>=Math.min(h,f)&&r<=Math.max(h,f)&&o>=Math.min(u,m)&&o<=Math.max(u,m))return!0}return a}static isPolygonsOverlap(t,e){const s=t.map(f=>[f.x,f.y]),n=e.map(f=>[f.x,f.y]);function r(f){let m=[];for(let C=0;C<f.length;C++){let y=(C+1)%f.length,w=[f[y][0]-f[C][0],f[y][1]-f[C][1]];m.push(w)}return m}function o(f,m){return f[0]*m[0]+f[1]*m[1]}function a(f){return[-f[1],f[0]]}function l(f,m){let C=o(f,m[0]),y=C;for(let w=1;w<m.length;w++){let L=o(f,m[w]);C=Math.min(C,L),y=Math.max(y,L)}return[C,y]}function c(f,m){return f[0]<=m[1]&&m[0]<=f[1]}let h=r(s),u=r(n);for(let f of h.concat(u)){let m=a(f),C=l(m,s),y=l(m,n);if(!c(C,y))return!1}return!0}static calcPolygonCentroid(t){if(!t||t.length===0)throw new Error("顶点数组不能为空");let e=0,s=0;const n=t.length;for(let r=0;r<n;r++)e+=t[r].x,s+=t[r].y;return e/=n,s/=n,{x:e,y:s}}static calcCenter(t){const e=O.getBoxByPoints(t);return d.calcPolygonCentroid(e)}static calcTargetPoint(t,e,s){const n=d.angleToRadian(s),r=t.x+e*Math.cos(n),o=t.y+e*Math.sin(n);return{x:r,y:o}}static calcAngle(t,e){const s=e.x-t.x,n=e.y-t.y;return Math.atan2(n,s)*(180/Math.PI)}static calcInternalAngle(t){return 180-d.calcTriangleAngle(t[0],t[3],t[2])}static calcLeanYAngle(t,e){return e?t-90:90-t}static calcLeanYAngleByPoints(t,e){return d.calcLeanYAngle(d.calcInternalAngle(t),e)}static calcUnLeanByPoints(t,e,s){if(e===0&&s===0)return t;const n=d.calcCenter(t);return d.batchLeanWithCenter(t,-e,-s,n)}static calcFlipXByPoints(t){const e=d.calcCenter(t);return d.isPointClockwiseOfLine(e,t[0],t[3])}static calcViewAngleByPoints(t){const e=d.calcAngle(t[2],t[1]);return d.mirrorAngle(e+90)}static calcActualAngleByPoints(t){const e=d.calcInternalAngle(t),s=d.calcLeanYAngle(e,d.calcFlipXByPoints(t)),n=d.calcViewAngleByPoints(t);return d.mirrorAngle(n-s)}static mirrorAngle(t){for(;t>180;)t-=360;for(;t<-180;)t+=360;return t}static normalizeAngle(t){return t<0&&(t=t+360),t}static calcSegmentLineCenterCrossPoint(t,e,s,n){const r=d.calcCenter([t,e]),o=d.calcAngle(t,e);return d.calcTargetPoint(r,n,s?o+90:o-90)}static calcProjectionOnSegment(t,e,s){const n=d.calcSegmentProportion(t,e,s),r=e.x+n*(s.x-e.x),o=e.y+n*(s.y-e.y);return{x:r,y:o}}static calcDistancePointToLine(t,e,s){const{x:n,y:r}=d.calcProjectionOnSegment(t,e,s);return Math.sqrt((t.x-n)*(t.x-n)+(t.y-r)*(t.y-r))}static calcSegmentProportion(t,e,s){const n=s.x-e.x,r=s.y-e.y,o=t.x-e.x,a=t.y-e.y,l=n*n+r*r;return(o*n+a*r)/l}static isProjectionOnSegment(t,e,s){const n=d.calcSegmentProportion(t,e,s);return n>=0&&n<=1}static calcLimitPointOnSegment(t,e,s){const n=d.calcSegmentProportion(t,e,s);if(n<0)return e;if(n>1)return s}static calcInnerLimitPointOnSegment(t,e,s,n){const r=d.calcSegmentProportion(t,e,s);if(r<0){const o=d.calcAngle(e,s);return d.calcTargetPoint(e,n,o)}else if(r>1){const o=d.calcAngle(s,e);return d.calcTargetPoint(s,n,o)}return t}static isPointClosestSegment(t,e,s,n){return d.isProjectionOnSegment(t,e,s)?d.calcDistancePointToLine(t,e,s)<n:!1}static isPointClosest(t,e,s){return d.calcDistance(t,e)<=s}static isPointClosestWhichPoint(t,e,s){for(let n=0;n<e.length;n++)if(d.isPointClosest(t,e[n],s))return n}static transformToAcuteAngle(t){return t>90&&(t=180-t),t}static calcDistance(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static isRectangle(t){if(t.length!==4)return!1;const e=[d.calcDistance(t[0],t[1]),d.calcDistance(t[1],t[2]),d.calcDistance(t[2],t[3]),d.calcDistance(t[3],t[0])];return new Set(e).size===2}static isSameSign(t,e){return t*e>=0}static precise(t,e=2){if(typeof t!="number"||typeof e!="number")throw new TypeError("Both arguments must be numbers");if(!isFinite(t))return t;const s=Math.pow(10,e),o=(Math.round(t*s)/s).toString().split(".");for(o.length===1&&o.push("");o[1].length<e;)o[1]+="0";return Number(o.join("."))}static batchPrecise(t,e){return t.map(s=>d.precise(s,e))}static precisePoint(t,e){return{x:d.precise(t.x,e),y:d.precise(t.y,e)}}static batchPrecisePoint(t,e){return t.map(s=>d.precisePoint(s,e))}static calcTriangleAngle(t,e,s){let n={x:e.x-t.x,y:e.y-t.y},r={x:s.x-e.x,y:s.y-e.y},o=n.x*r.x+n.y*r.y,a=Math.sqrt(n.x*n.x+n.y*n.y),l=Math.sqrt(r.x*r.x+r.y*r.y),c=o/(a*l),u=Math.acos(c)*(180/Math.PI);return isNaN(u)&&(u=0),u}static calcTriangleAngleWithClockwise(t,e,s){const n=d.calcTriangleAngle(t,e,s);return d.isPointClockwiseOfLine(e,t,s)?n:180-n}static calcTriangleAngle2(t,e,s){return Math.acos((Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))/(Math.pow(s.x-t.x,2)+Math.pow(s.y-t.y,2)))*(180/Math.PI)}static calcTriangleAngle3(t,e,s){return Math.acos((Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2))/(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)))*(180/Math.PI)}static calcVectorC(t,e){const s=t.x+e.x,n=t.y+e.y;return{x:s,y:n}}static calcVector(t,e){const s=e.x-t.x,n=e.y-t.y;return{x:s,y:n}}static translateVector(t,e){const s=t.x-e.x,n=t.y-e.y;return{x:s,y:n}}static calcTriangleSide1By2(t,e){const s=t*d.angleToRadian(t);return e/Math.tan(s)}static calcTriangleSide3By1(t,e){const s=t*d.angleToRadian(t);return e/Math.cos(s)}static calcTriangleSide3By2(t,e){const s=d.angleToRadian(t);return e/Math.sin(s)}static calcTriangleSide1By3(t,e){const s=d.angleToRadian(t);return e*Math.cos(s)}static calcTriangleSide2By3(t,e){const s=d.angleToRadian(t);return e*Math.sin(s)}static sortPointsClockwise(t){let e=d.calcCenter(t);return d.sortPointsClockwiseByCenter(t,e)}static sortPointsClockwiseByCenter(t,e){let s=t.map((r,o)=>{let a=Math.atan2(r.y-e.y,r.x-e.x);return{index:o,angle:a}});s.sort((r,o)=>r.angle-o.angle);let n=[];for(let r=0;r<s.length;r++)n.push(t[s[r].index]);return n}static calcPointToSegmentCenterAngle(t,e,s){const n=d.calcCenter([e,s]);return d.calcAngle(t,n)}static resignValue(t,e){return t>=0?Math.abs(e):-Math.abs(e)}static isPointClockwiseOfLine(t,e,s){return(t.x-e.x)*(s.y-e.y)-(t.y-e.y)*(s.x-e.x)<0}static getScaleFromMatrix(t){return{scaleX:t[0][0],scaleY:t[1][1]}}static calculateAngleBisectorIntersection(t){if(t.length!==4)throw new Error("必须提供四个顶点坐标");const e=d.calcBisectors(t),{width:s,height:n}=d.calcParallelogramVerticalSize(t),r=[];return s<n?(r.push(d.calcIntersectionOfLines(e[0],e[1])),r.push(d.calcIntersectionOfLines(e[2],e[3]))):(r.push(d.calcIntersectionOfLines(e[0],e[3])),r.push(d.calcIntersectionOfLines(e[1],e[2]))),r}static calcIntersectionOfLines(t,e){const s=t.point,n=t.direction,r=e.point,o=e.direction,a=n.x*o.y-n.y*o.x;if(Math.abs(a)<1e-6)return null;const l=r.x-s.x,c=r.y-s.y,h=(l*o.y-c*o.x)/a;return(l*n.y-c*n.x)/a,d.precisePoint({x:s.x+h*n.x,y:s.y+h*n.y},1)}static calcBisectors(t){const[e,s,n,r]=t;return t.map((o,a)=>{let l,c;switch(a){case 0:l={x:s.x-e.x,y:s.y-e.y},c={x:r.x-e.x,y:r.y-e.y};break;case 1:l={x:e.x-s.x,y:e.y-s.y},c={x:n.x-s.x,y:n.y-s.y};break;case 2:l={x:s.x-n.x,y:s.y-n.y},c={x:r.x-n.x,y:r.y-n.y};break;case 3:l={x:n.x-r.x,y:n.y-r.y},c={x:e.x-r.x,y:e.y-r.y};break;default:throw new Error("无效的顶点索引")}const h=Math.hypot(l.x,l.y),u=Math.hypot(c.x,c.y),f={x:l.x/h,y:l.y/h},m={x:c.x/u,y:c.y/u},C={x:f.x+m.x,y:f.y+m.y};return{point:o,direction:C}})}static calcCrossPointsOfParallelLines(t,e){const[s,n,r,o]=e,a={x:n.x-s.x,y:n.y-s.y},l={x:r.x-n.x,y:r.y-n.y},c={x:o.x-r.x,y:o.y-r.y},h={x:s.x-o.x,y:s.y-o.y},u={x:s.x-n.x,y:s.y-n.y},f=d.calcIntersectionOfLines({point:s,direction:a},{point:t,direction:h}),m=d.calcIntersectionOfLines({point:n,direction:l},{point:t,direction:a}),C=d.calcIntersectionOfLines({point:r,direction:c},{point:t,direction:l}),y=d.calcIntersectionOfLines({point:o,direction:h},{point:t,direction:u});return[f,m,C,y]}static calcTriangleArea(t,e,s){const n=d.calcDistance(t,e),r=d.calcDistance(e,s),o=d.calcDistance(s,t),a=(n+r+o)/2;return Math.sqrt(a*(a-n)*(a-r)*(a-o))}static calcParallelogramVerticalIntersectionPoints(t,e,s){const[n,r,o,a]=e;let l=d.calcProjectionOnSegment(t,a,n),c=d.calcProjectionOnSegment(t,n,r),h=d.calcProjectionOnSegment(t,r,o),u=d.calcProjectionOnSegment(t,o,a);return s&&(d.isProjectionOnSegment(l,a,n)||(l=d.calcInnerLimitPointOnSegment(l,a,n,.01)),d.isProjectionOnSegment(c,n,r)||(c=d.calcInnerLimitPointOnSegment(c,n,r,.01)),d.isProjectionOnSegment(h,r,o)||(h=d.calcInnerLimitPointOnSegment(h,r,o,.01)),d.isProjectionOnSegment(u,o,a)||(u=d.calcInnerLimitPointOnSegment(u,o,a,.01))),[l,c,h,u]}static calcParallelogramVerticalSize(t){const[e,s,n,r]=t,o=d.calcDistancePointToLine(e,s,n),a=d.calcDistancePointToLine(e,n,r);return{width:o,height:a}}static calcMirrorPointToLine(t,e,s){const n=d.calcProjectionOnSegment(t,e,s),r=d.calcDistance(t,n),o=d.calcAngle(e,s);return d.calcTargetPoint(n,r*2,o)}}var k=Li();class O{static getMinX(t){return Math.min(...t.map(e=>e.x))}static getMinY(t){return Math.min(...t.map(e=>e.y))}static getBoxByPoints(t){let e=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;return t.forEach(o=>{e=Math.min(e,o.x),s=Math.min(s,o.y),n=Math.max(n,o.x),r=Math.max(r,o.y)}),[{x:e,y:s},{x:n,y:s},{x:n,y:r},{x:e,y:r}]}static getRect(t){let e=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;return t.forEach(o=>{e=Math.min(e,o.x),s=Math.min(s,o.y),n=Math.max(n,o.x),r=Math.max(r,o.y)}),{x:e,y:s,width:n-e,height:r-s}}static getDateId(){return+new Date}static getRandomId(){return Xe(8)}static getEventPosition(t,e,s){return s=s||1,{x:(t.clientX-e.x)/s,y:(t.clientY-e.y)/s}}static getBoxByCenter(t,e,s){const{width:n,height:r}=e,o=n/2,a=r/2,{x:l,y:c}=t,h=[{x:l-o,y:c-a},{x:l+o,y:c-a},{x:l+o,y:c+a},{x:l-o,y:c+a}];return s&&h.forEach(u=>{Object.assign(u,d.transWithCenter(u,s,t))}),h}static getBoxByLeftTop(t,e){const{width:s,height:n}=e,{x:r,y:o}=t;return[{x:r,y:o},{x:r+s,y:o},{x:r+s,y:o+n},{x:r,y:o+n}]}static getRectBySize(t){const{width:e,height:s}=t;return[{x:0,y:0},{x:e,y:0},{x:e,y:s},{x:0,y:s}]}static getLBRPoints(t,e){let[s,n,r]=O.getLBRPointIndexes(t,e);return s===n&&(s=O.getPrevIndexOfArray(t.length,s)),n===r&&(r=O.getNextIndexOfArray(t.length,r)),[t[s],t[n],t[r]]}static getLBRPointIndexes(t,e){let s,n,r;return e=e??!1,t.forEach((o,a)=>{e||((s===void 0||o.x<t[s].x)&&(s=a),(r===void 0||o.x>t[r].x)&&(r=a)),(n===void 0||o.y>t[n].y)&&(n=a)}),e&&(s=O.getPrevIndexOfArray(t.length,n),r=O.getNextIndexOfArray(t.length,n)),[s,n,r]}static getPrevIndexOfArray(t,e,s=1){let n;for(;n=e-s,n<0&&(n=t+n),!(n>=0););return n}static getPrevOfArray(t,e,s=1){return t[O.getPrevIndexOfArray(t.length,e,s)]}static getNextIndexOfArray(t,e,s=1){let n;for(;n=e+s,n>=t&&(n=n-t),!(n<t););return n}static getNextOfArray(t,e,s=1){return t[O.getNextIndexOfArray(t.length,e,s)]}static calcRectangleSize(t){const e=d.precise(d.calcDistance(t[0],t[1])),s=d.precise(d.calcDistance(t[0],t[3]));return{width:e,height:s}}static calcLineSize(t){const e=d.precise(Math.abs(t[0].x-t[1].x)),s=d.precise(Math.abs(t[0].y-t[1].y));return{width:e,height:s}}static scalePoint(t,e){return{x:t.x*e,y:t.y*e}}static scalePoints(t,e){return e===1?t:t.map(s=>O.scalePoint(s,e))}static calcScale(t,e,s=0){const n=(t.width-s*2)/e.width,r=(t.height-s*2)/e.height;return Math.min(n,r)}static calcRectangleSizeInRect(t,e,s,n=0){const r=s.width-n*2,o=s.height-n*2;if(t>r||e>o){const a=d.precise(t/e,1),l=d.precise(s.width/s.height,2);a>l?(t=r,e=d.precise(t/a,1)):(e=o,t=d.precise(e*a,1))}return{width:t,height:e}}static calcCenterInnerRectPoints(t,e){const{width:s,height:n}=t,{width:r,height:o}=e;return[{x:r/2-s/2,y:o/2-n/2},{x:r/2+s/2,y:o/2-n/2},{x:r/2+s/2,y:o/2+n/2},{x:r/2-s/2,y:o/2+n/2}]}static scaleRect(t,e){const s={};return["x","y","width","height","left","top","right","bottom"].forEach(n=>{const r=t[n];k.isNumber(r)&&(s[n]=d.precise(r*e))}),s}static sortPointsByY(t){return t.sort((e,s)=>e.y-s.y)}static sortPointsByX(t){return t.sort((e,s)=>e.x-s.x)}static calcRenderRect(t,e){const s=d.calcDistance(t[0],t[1]),n=d.calcDistancePointToLine(t[0],t[2],t[3]);return{x:e.x-s/2,y:e.y-n/2,width:s,height:n}}static isPointInRect(t,e){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}static centerRectConversion(t){const{width:e,height:s}=t;return{x:-e/2,y:-s/2,width:e,height:s}}}class rs{constructor(){g(this,"id");this.id=`${O.getDateId()}`}run(){return Promise.resolve()}}class Ne extends rs{constructor(e,s){super();g(this,"element");g(this,"canvas");this.element=e,this.canvas=s}destroy(){return this.element=null,this.canvas=null,Promise.resolve()}}var I=(i=>(i.moveable="moveable",i.hand="hand",i.rectangle="rectangle",i.line="line",i.image="image",i.polygon="polygon",i.arbitrary="arbitrary",i.pencil="pencil",i.text="text",i.group="group",i.ellipse="ellipse",i))(I||{}),he=(i=>(i.cursor="cursor",i.shapes="shapes",i.freedom="freedom",i.text="text",i))(he||{});class W{static deepPlanObjectAssign(t,...e){return e.forEach(s=>{for(const n in s)s.hasOwnProperty(n)&&(k.isPlainObject(s[n])?(t[n]===void 0&&(t[n]={}),this.deepPlanObjectAssign(t[n],s[n])):t[n]=s[n])}),t}static isAllEqualWith(t,e,s){return t.every(n=>s(n,e))}static jsonClone(t){return k.isPlainObject(t)||k.isArray(t)?JSON.parse(JSON.stringify(t)):(console.warn("jsonClone: 非对象或数组类型",t),k.cloneDeep(t))}static isPlainObjectEqual(t,e){const s=Object.keys(t),n=Object.keys(e);return s.length!==n.length?!1:s.every(r=>t[r]===e[r])}}var ae=(i=>(i[i.inside=0]="inside",i[i.middle=1]="middle",i[i.outside=2]="outside",i))(ae||{});const gn=[{type:0,name:"内描边"},{type:1,name:"平分线宽"},{type:2,name:"外描边"}],ji=[{type:1,name:"平分线宽"}];function Gi(i){switch(i){case I.arbitrary:case I.rectangle:case I.ellipse:case I.image:return gn;case I.line:return ji;default:return gn}}var Qe=(i=>(i.top="top",i.middle="middle",i.bottom="bottom",i))(Qe||{}),Ee=(i=>(i.none="none",i.lineThrough="line-through",i.overline="overline",i.underline="underline",i))(Ee||{}),Be=(i=>(i.normal="normal",i.italic="italic",i.bold="bold",i.boldItalic="bold italic",i))(Be||{});const $i=1,Yi="#000000",Xi=100,qi="#999999",Ui=15,Ji=1,ir="normal",is=16,or="Arial",ar="#000000",lr=100,cr="left",Ki="top",dr="top",Qi=1,Zi=100,$s=1.4,hr=!0,ur=is*$s,fr=0,gr="none",mr="#000000",pr=100,Cr=1,yr=0,os={type:$i,width:Ji,color:Yi,colorOpacity:Xi},as={color:qi,colorOpacity:Ui},Fe={fontStyler:ir,fontSize:is,fontFamily:or,fontColor:ar,fontColorOpacity:lr,fontLineHeight:ur,fontLineHeightFactor:$s,fontLineHeightAutoFit:hr,textAlign:cr,textBaseline:Ki,textVerticalAlign:dr,fontLetterSpacing:fr,textDecoration:gr,textDecorationColor:mr,textDecorationOpacity:pr,textDecorationThickness:Cr,paragraphSpacing:yr},ue={strokes:[{...os}],fills:[{...as}],...Fe},mn=["fontSize","fontFamily"],pn=i=>{const t=W.jsonClone(ue);return[I.line,I.arbitrary].includes(i)&&t.strokes.forEach(e=>{e.width=Qi}),[I.image,I.arbitrary,I.text].includes(i)&&t.fills.forEach(e=>{e.colorOpacity=0}),[I.text].includes(i)&&t.strokes.forEach(e=>{e.width=0}),t},_r=[{name:"Arial",url:"@/assets/fonts/Arial.ttf"},{name:"Arial bold",url:"@/assets/fonts/Arialbd.ttf"},{name:"Arial bold italic",url:"@/assets/fonts/Arialbi.ttf"},{name:"Arial italic",url:"@/assets/fonts/Ariali.ttf"},{name:"CascadiaCode",url:"@/assets/fonts/CascadiaCode.ttf"},{name:"CascadiaCode italic",url:"@/assets/fonts/CascadiaCodeItalic.ttf"},{name:"CascadiaMono",url:"@/assets/fonts/CascadiaMono.ttf"},{name:"CascadiaMono italic",url:"@/assets/fonts/CascadiaMonoItalic.ttf"},{name:"Comic",url:"@/assets/fonts/Comic.ttf"},{name:"Comic bold",url:"@/assets/fonts/Comicbd.ttf"},{name:"Comic italic",url:"@/assets/fonts/Comici.ttf"},{name:"Comic zero",url:"@/assets/fonts/Comicz.ttf"},{name:"隶书",url:"@/assets/fonts/隶书.ttf"},{name:"楷体",url:"@/assets/fonts/楷体.ttf"},{name:"幼圆",url:"@/assets/fonts/幼圆.ttf"},{name:"华文彩云",url:"@/assets/fonts/华文彩云.ttf"},{name:"华文隶书",url:"@/assets/fonts/华文隶书.ttf"},{name:"华文行楷",url:"@/assets/fonts/华文行楷.ttf"},{name:"华文细黑",url:"@/assets/fonts/华文细黑.ttf"},{name:"华文琥珀",url:"@/assets/fonts/华文琥珀.ttf"},{name:"华文楷体",url:"@/assets/fonts/华文楷体.ttf"},{name:"华文新魏",url:"@/assets/fonts/华文新魏.ttf"},{name:"华文宋体",url:"@/assets/fonts/华文宋体.ttf"},{name:"华文仿宋",url:"@/assets/fonts/华文仿宋.ttf"},{name:"华文中宋",url:"@/assets/fonts/华文中宋.ttf"}],eo=k.range(12,121,2).map(i=>({name:i.toString(),value:i})),to=k.range(12,121,2).map(i=>({name:i.toString(),value:i})),so=k.range(0,101,1).map(i=>({name:i.toString(),value:i})),no=k.range(0,101,4).map(i=>({name:i.toString(),value:i})),ro=k.range(1,2.1,.1).map(i=>(i=Math.round(i*10)/10,{name:i.toString(),value:i}));class Os{static hashToRgba(t,e){if(!/^#([0-9A-F]{3}){1,2}$/i.test(t))throw new Error("Invalid color format");let s=t.slice(1);s.length===3&&(s=s.split("").map(a=>a+a).join(""));const n=parseInt(s.substring(0,2),16),r=parseInt(s.substring(2,4),16),o=parseInt(s.substring(4,6),16);return`rgba(${n}, ${r}, ${o}, ${e})`}static getRandomColor(){const t="0123456789ABCDEF";let e="#";for(let s=0;s<6;s++)e+=t[Math.floor(Math.random()*16)];return e}}class _e{static joinFillColor(t){return t.color?`${Os.hashToRgba(t.color,t.colorOpacity/100)}`:""}static joinStrokeColor(t){return t.color?`${Os.hashToRgba(t.color,t.colorOpacity/100)}`:""}static joinFont(t){return`${t.fontSize}px ${t.fontFamily}`}}class Me{static calcIOPoint(t,e,s,n,r){const o=s/2,a=d.calcTriangleSide3By2(o,n);let l=d.calcAngle(t,e);l<0&&(l+=360);let c=o+l;return d.calcTargetPoint(t,a,r?c:c+180)}static getPolygonVertices(t,e,s){const n=d.sortPointsClockwise(t);return n.map((r,o)=>{const a=O.getPrevOfArray(n,o),l=O.getNextOfArray(n,o),c=d.calcTriangleAngle(a,r,l);return Me.calcIOPoint(r,l,c,e,s)})}static getPolygonInnerVertices(t,e){return Me.getPolygonVertices(t,e,!0)}static getPolygonOuterVertices(t,e){return Me.getPolygonVertices(t,e,!1)}static calcBentLineOuterVertices(t,e){const s=[];return s.push(...Me.calcBentLineClockWisePoints(t,e,!0)),s.push(...Me.calcBentLineClockWisePoints(t.reverse(),e,!0)),s}static calcBentLineClockWisePoints(t,e,s){const n=[];for(let r=0;r<t.length-1;r++){const o=t[r],a=t[r+1];let l=d.calcAngle(o,a);s?l=l+90:l=l-90,n.push(d.calcTargetPoint(o,e,l)),r===t.length-2&&n.push(d.calcTargetPoint(a,e,l))}return n}}class je{static getArbitraryInnerVertices(t,e,s){return je.getArbitraryVertices(t,e,!0,s)}static getArbitraryOuterVertices(t,e,s){return je.getArbitraryVertices(t,e,!1,s)}static getArbitraryVertices(t,e,s,n){return t.length===1?t:t.length===2?Me.calcBentLineClockWisePoints(t,e,s):t.map((r,o)=>{const a=O.getPrevOfArray(t,o),l=O.getNextOfArray(t,o),c=d.isPointClockwiseOfLine(l,a,r);let h=d.calcTriangleAngle(a,r,l);c?h=180-h:h=180+h;const{isFold:u=!0}=n;if(!u&&[0,t.length-1].includes(o)){let f;return o===0?f=d.calcAngle(r,l)+(s?90:-90):f=d.calcAngle(r,a)+(s?-90:90),d.calcTargetPoint(r,e,f)}else return Me.calcIOPoint(r,l,h,e,s)})}}class Ls{static isMultiLine(t){return t.indexOf(`
`)!==-1}static replaceAZero(t){return t.replaceAll(" "," ")}}class Er{static measureText(t,e){const{fontSize:s,fontFamily:n,textBaseline:r,textAlign:o}=e,a=t.split(`
`);let l=0,c=0,h=document.createElement("canvas"),u=h.getContext("2d");u.font=`${s}px ${n}`,r&&(u.textBaseline=r),o&&(u.textAlign=o),a.forEach(m=>{m=m||" ",m=Ls.replaceAZero(m);const C=u.measureText(m),{width:y,fontBoundingBoxAscent:w,fontBoundingBoxDescent:L}=C;y>l&&(l=y),c+=w+L});const f={width:l,height:c};return u=null,h=null,f}static measureTextWithSpan(t,e){const{fontSize:s,fontFamily:n,textBaseline:r,textAlign:o,fontLineHeight:a}=e,l=t.split(`
`);let c=0,h=0;const u=document.createElement("span");document.body.appendChild(u),u.style.visibility="hidden",u.style.fontSize=`${s}px`,u.style.fontFamily=n,u.style.display="inline-block",a&&(u.style.lineHeight=`${a}px`),r&&(u.style.verticalAlign=r),o&&(u.style.textAlign=o),l.forEach(m=>{m=m||" ",m=Ls.replaceAZero(m),u.textContent=m;const C=u.offsetWidth;C>c&&(c=C),h+=u.offsetHeight});const f={width:c,height:h};return document.body.removeChild(u),f}static isFontEqualForMeasureText(t,e){return t=k.pick(t,mn),e=k.pick(e,mn),W.isPlainObjectEqual(t,e)}}class te{static isDeleterKey(t){return t===8||t===46}static isArrowLeft(t){return t===37}static isArrowRight(t){return t===39}static isArrowUp(t){return t===38}static isArrowDown(t){return t===40}static isCtrl(t){return t===17}static isA(t){return t===65}static isC(t){return t===67}static isV(t){return t===86}static isZ(t){return t===90}static isY(t){return t===89}static isX(t){return t===88}static isEnter(t){return t===13}static isLowerCaseLetter(t){return t.length===1&&/[a-z]/.test(t)}static isEnglishLetter(t){return t.length===1&&/[a-zA-Z]/.test(t)}static isSpace(t){return t.length===1&&(t.charCodeAt(0)===32||t.charCodeAt(0)===160||t.charCodeAt(0)===12288)}}function Cn(i,t,e){i.forEach((s,n)=>{t.save();const r=Y.transFontWithScale(s.fontStyle);let{fontColor:o,fontColorOpacity:a,fontSize:l,fontFamily:c,fontStyler:h}=r;t.fillStyle=_e.joinFillColor({color:o,colorOpacity:a}),t.font=`${h!==Be.normal?h:""} ${l}px ${c}`,e&&e(s,n),t.restore()})}function io(i,t,e,s,n){const{content:r,fontStyle:o}=i,{width:a}=e;let l=0;if(t!==0&&te.isEnglishLetter(r)){const c=s[t-1],{content:h,fontStyle:u,renderWidth:f}=c;if(te.isEnglishLetter(h)&&Er.isFontEqualForMeasureText(o,u)){const{width:m}=n.measureText(h+r),C=f+a;m<C&&(l=m-C)}}return l}function yn(i,t){const{renderX:e,renderY:s,width:n,fontBoundingBoxDescent:r,fontStyle:{textDecoration:o,textDecorationThickness:a,textDecorationColor:l,textDecorationOpacity:c}}=t;if(o!==Ee.none&&a!==0){i.save(),i.lineWidth=a*Y.scale,i.strokeStyle=_e.joinFillColor({color:l,colorOpacity:c});const h=e,u=h+n;switch(o){case Ee.underline:{const f=s+r+a/2;i.beginPath(),i.moveTo(h,f),i.lineTo(u,f),i.stroke();break}case Ee.lineThrough:{const f=s+(r+a)/2;i.beginPath(),i.moveTo(h,f),i.lineTo(u,f),i.stroke();break}case Ee.overline:{const f=s-a/2;i.beginPath(),i.moveTo(h,f),i.lineTo(u,f),i.stroke();break}}i.restore()}}const R=class R{static convertPointsByStrokeType(t,e,s,n){if(!s)return t;const{flipX:r=!1,flipY:o=!1}=n,a=s/2;switch(e){case ae.inside:return r!==o?je.getArbitraryOuterVertices(t,a,n):je.getArbitraryInnerVertices(t,a,n);case ae.middle:return t;case ae.outside:return r!==o?je.getArbitraryInnerVertices(t,a,n):je.getArbitraryOuterVertices(t,a,n)}}static async drawImgLike(t,e,s,n={}){return new Promise((r,o)=>{if(e instanceof ImageData&&(e=R.getCanvasByImageData(e).toDataURL()),typeof e=="string"){if(R.ImageCaches.has(e)){R.drawRotateImage(t,R.ImageCaches.get(e),s,n),r();return}const a=new Image;a.src=e,a.onload=()=>{R.ImageCaches.set(e,a),R.drawRotateImage(t,a,s,n),r()},a.onerror=()=>{o()}}else(e instanceof HTMLCanvasElement||e instanceof HTMLImageElement)&&R.drawRotateImage(t,e,s,n),r()})}static getTransformValues(t){let{angle:e=0,flipX:s=!1,leanY:n,actualAngle:r}=t;typeof r=="number"&&(e=r);let o=d.angleToRadian(e),a=1,l=1;return s&&(a=-1,o=-o,n=-n),{radian:o,scaleX:a,scaleY:l,leanY:n}}static transformCtx(t,e,s){const{x:n,y:r,width:o,height:a}=e,{radian:l,scaleX:c,scaleY:h,leanY:u}=s;t.translate(n+o/2,r+a/2),t.scale(c,h),t.rotate(l),t.transform(1,0,u,1,0,0)}static calcOffsetByRect(t){return{x:-(t.x+t.width/2),y:-(t.y+t.height/2)}}static transPointsOfBox(t,e){const s=R.calcOffsetByRect(e);return t.map(n=>d.translate(n,s))}static translateArcPoints(t,e){const s=R.calcOffsetByRect(e);return d.translateArcPoints(t,s)}static drawClipArcPoints(t,e,s){e=R.transArcParamsWithScale(e)[0],e=R.translateArcPoints(e,s),t.beginPath(),R.drawBazierPoints(e,t),t.closePath(),t.clip()}static drawRotateImage(t,e,s,n={}){const{width:r,height:o,desX:a,desY:l,desWidth:c,desHeight:h}=s,u=t.getContext("2d");u.save(),R.transformCtx(u,s,this.getTransformValues(n)),n.clipArcPoints&&R.drawClipArcPoints(u,n.clipArcPoints,s),k.every([a,l,c,h],k.isNumber)?u.drawImage(e,a-c/2,l,c,h):u.drawImage(e,-r/2,-o/2,r,o),u.restore()}static drawRotateImageData(t,e,s,n={}){const r=R.getCanvasByImageData(e);R.drawRotateImage(t,r,s,n)}static drawRectInRenderRect(t,e,s,n={}){const{width:r,height:o,desX:a,desY:l,desWidth:c,desHeight:h}=e,u=t.getContext("2d");u.save(),R.transformCtx(u,e,this.getTransformValues(n)),u.fillStyle=_e.joinFillColor(s),k.every([a,l,c,h],k.isNumber)?u.fillRect(a,l,c,h):u.fillRect(-r/2,-o/2,r,o),u.restore()}static drawLineInRenderRect(t,e,s,n={}){const{desX:r,desY:o,desWidth:a}=e,l=t.getContext("2d");l.save(),R.transformCtx(l,e,this.getTransformValues(n)),l.strokeStyle=_e.joinStrokeColor(s),l.lineWidth=s.width,k.every([r,o,a],k.isNumber)&&(l.beginPath(),l.moveTo(r,o),l.lineTo(r+a,o),l.stroke()),l.restore()}static drawRotateText(t,e,s,n,r,o={}){const{fontColor:a,fontFamily:l,fontSize:c,textAlign:h,textBaseline:u,fontLineHeight:f,fontColorOpacity:m,textVerticalAlign:C,paragraphSpacing:y,fontStyler:w}=r,{flipX:L}=o,B=t.getContext("2d");B.save(),R.transformCtx(B,n,this.getTransformValues(o)),s=R.transPointsOfBox(s,n),B.font=`${w!==Be.normal?w:""} ${c}px ${l}`,B.textBaseline=u,B.fillStyle=_e.joinFillColor({color:a,colorOpacity:m});let j=s[0].y;const{x:b}=s[0],{x:S}=s[1],A=L?-b:b,M=Math.abs(S-b),D=Math.abs(s[3].y-s[0].y),J=e.lines.filter(be=>be.isTailBreak).length;let G=f*e.lines.length+(J-1)*y;C==="middle"?j=s[0].y+(D-G)/2:C==="bottom"&&(j=s[0].y+(D-G));const{alphabeticBaseline:oe,fontBoundingBoxAscent:ye,fontBoundingBoxDescent:Ge}=B.measureText("a"),qe=Ge-ye;e.lines.forEach(be=>{let $e=0,we=A;Object.assign(be,{x:A,y:j,width:M,height:f,renderHeight:f,renderY:j});const{nodes:Ye,isTailBreak:it}=be;if(Ye.length!==0){const ot=j-oe+(f-qe)/2;Cn(Ye,B,(He,at)=>{const{content:xt,fontStyle:{fontLetterSpacing:ys}}=He,St=B.measureText(xt),{width:Nt,fontBoundingBoxDescent:vt,fontBoundingBoxAscent:an,alphabeticBaseline:li}=St,_s=io(He,at,St,Ye,B),ci=ys*R.scale,Es=Nt+ci,Vt=we+_s,ln=ot+li;Object.assign(He,{x:Vt,y:j,width:Es,height:f,indentX:_s,renderX:Vt,renderY:ln,renderWidth:Nt,renderHeight:vt-an,fontBoundingBoxDescent:vt,fontBoundingBoxAscent:an,baseline:ot}),we=Vt+Es,$e+=Es+_s,at===be.nodes.length-1&&(be.renderWidth=$e),h==="left"&&(B.fillText(xt,Vt,ln),yn(B,He))}),h==="right"?we=A+M-$e:h==="center"&&(we=A+M/2-$e/2),h!=="left"&&(be.renderX=we,Cn(Ye,B,He=>{const{renderY:at,width:xt,renderWidth:ys,indentX:St,content:Nt}=He,vt=we+St+xt-ys;Object.assign(He,{x:we,renderX:vt}),B.fillText(Nt,vt,at),yn(B,He),we+=xt+St}))}be.height=f,j+=f,it&&(j+=y)}),B.restore()}static drawRotateTextWithScale(t,e,s,n,r,o={}){s=R.transPointsWidthScale(s),r=R.transFontWithScale(r),R.drawRotateText(t,e,s,n,r,o)}static drawCommonRotateText(t,e,s,n,r,o={}){const{angle:a=0}=o,l=t.getContext("2d");l.save(),l.translate(s.x,s.y),l.rotate(d.angleToRadian(a)),l.font=_e.joinFont(n),l.fillStyle=_e.joinFillColor(r),l.textAlign=n.textAlign,l.textBaseline=n.textBaseline,l.fillText(e,0,0),l.restore()}static drawCommonRotateTextWithScale(t,e,s,n,r,o={}){R.scale!==1&&(s={x:s.x*R.scale,y:s.y*R.scale}),R.drawCommonRotateText(t,e,s,n,r,o)}static transPointsWidthScale(t){return R.scale===1?t:O.scalePoints(t,R.scale)}static transStrokeWithScale(t){return R.scale===1?t:{...t,width:t.width*R.scale}}static transFontWithScale(t){return R.scale===1?t:{...t,fontSize:t.fontSize*R.scale,fontLineHeight:t.fontLineHeight*R.scale,paragraphSpacing:t.paragraphSpacing*R.scale}}static transArcParamsWithScale(t,e){return R.scale===1?[t,e]:(t=R.scaleArcPoints(t),e&&(e={...e,width:e.width*R.scale}),[t,e])}static transEllipseModelWithScale(t){return R.scale===1?t:{...t,rx:t.rx*R.scale,ry:t.ry*R.scale}}static drawPathWithScale(t,e,s,n,r={}){e=R.transPointsWidthScale(e),n=R.transStrokeWithScale(n),s.colorOpacity&&R.drawInnerPathFill(t,e,s,n,r),n.width&&n.colorOpacity&&R.drawPathStroke(t,e,n,r)}static drawInnerPathFill(t,e,s,n,r={}){const{calcVertices:o=!0}=r;let a;o?a=je.getArbitraryInnerVertices(e,n.width/2,r):a=e,R.drawPathFill(t,a,s)}static drawInnerPathFillWithScale(t,e,s,n,r={}){e=R.transPointsWidthScale(e),n=R.transStrokeWithScale(n),s.colorOpacity&&R.drawInnerPathFill(t,e,s,n,r)}static scaleArcPoints(t){return R.scale===1||(t=t.map(e=>{const{start:s,controller:n,end:r,value:o,corner:a}=e,[l,c,h,u]=O.scalePoints([s,n,r,a],R.scale);return{start:l,controller:c,end:h,corner:u,value:o*R.scale}})),t}static drawInnerArcPathFillWithScale(t,e,s,n,r={}){s=R.scaleArcPoints(s),n.colorOpacity&&R.drawArcPathFill(t,s,e,n,r)}static drawPathStrokeWidthScale(t,e,s,n={}){e=R.transPointsWidthScale(e),s=R.transStrokeWithScale(s),R.drawPathStroke(t,e,s,n)}static drawArcPathStrokeWidthScale(t,e,s,n,r={}){[e,n]=R.transArcParamsWithScale(e,n),R.drawArcPathStroke(t,e,s,n,r)}static drawPathStroke(t,e,s,n={}){const{isFold:r=!0,miterLimit:o}=n,a=t.getContext("2d");a.save(),o&&(a.miterLimit=o),a.strokeStyle=_e.joinStrokeColor(s),a.beginPath(),e.forEach((l,c)=>{c===0?a.moveTo(l.x,l.y):a.lineTo(l.x,l.y)}),r&&a.closePath(),s.width&&(a.lineWidth=s.width,a.stroke()),a.restore()}static calcStartOfArcPoints(t){let e=0,s;const[n,r,o]=t,a=t.map(h=>h.controller),{width:l,height:c}=d.calcParallelogramVerticalSize(a);return l>=c?(s=d.calcCenter([n.end,r.start]),e=1):(s=d.calcCenter([r.end,o.start]),e=2),{point:s,index:e}}static arcToBezierPoints(t,e){let{point:s,index:n}=R.calcStartOfArcPoints(t),r=0,o=t[n];for(;o;){const{start:a,controller:l,end:c,corner:h,value:u}=o;if(r===0&&e.moveTo(s.x,s.y),u){const f=d.calcDistance(a,h);e.arcTo(l.x,l.y,c.x,c.y,f)}else e.lineTo(l.x,l.y);if(o=O.getNextOfArray(t,n,1),n++,n>=t.length&&(n=0),r++,r>=t.length)break}}static drawBazierPoints(t,e){t.forEach((s,n)=>{const{start:r,controller:o,end:a,value:l}=s;n===0?e.moveTo(r.x,r.y):e.lineTo(r.x,r.y),l?e.arcTo(o.x,o.y,a.x,a.y,l):e.lineTo(o.x,o.y)})}static drawArcPathStroke(t,e,s,n,r={}){const{isFold:o=!0}=r,a=t.getContext("2d");a.save(),R.transformCtx(a,s,R.getTransformValues(r)),a.miterLimit=0,a.lineCap="round",a.strokeStyle=_e.joinStrokeColor(n),a.beginPath(),e=R.translateArcPoints(e,s),R.drawBazierPoints(e,a),o&&a.closePath(),n.width&&(a.lineWidth=n.width,a.stroke()),a.restore()}static drawPathFill(t,e,s){const n=t.getContext("2d");n.save(),n.fillStyle=_e.joinFillColor(s),n.beginPath(),e.forEach((r,o)=>{o===0?n.moveTo(r.x,r.y):n.lineTo(r.x,r.y)}),n.closePath(),n.fill(),n.restore()}static drawArcPathFill(t,e,s,n,r={}){const o=t.getContext("2d");o.save(),R.transformCtx(o,s,R.getTransformValues(r)),o.fillStyle=_e.joinFillColor(n),o.beginPath(),e=R.translateArcPoints(e,s),R.drawBazierPoints(e,o),o.closePath(),o.fill(),o.restore()}static transformEllipse(t,e,s,n,r){return n&&r&&(R.transformCtx(t,n,R.getTransformValues(r)),e=R.transPointsOfBox([e],n)[0]),s=R.transEllipseModelWithScale(s),{point:e,model:s}}static drawEllipseFill(t,e,s,n,r,o){const a=t.getContext("2d");a.save();const{point:{x:l,y:c},model:{rx:h,ry:u}}=R.transformEllipse(a,e,s,r,o);a.fillStyle=_e.joinFillColor(n),a.beginPath(),a.ellipse(l,c,h,u,0,0,Math.PI*2),a.closePath(),a.fill(),a.restore()}static drawEllipseStroke(t,e,s,n,r,o){const a=t.getContext("2d");a.save();const{point:{x:l,y:c},model:{rx:h,ry:u}}=R.transformEllipse(a,e,s,r,o);a.lineWidth=n.width,a.strokeStyle=_e.joinStrokeColor(n),a.beginPath(),a.ellipse(l,c,h,u,0,0,Math.PI*2),a.closePath(),a.stroke(),a.restore()}static drawEllipseStrokeWithScale(t,e,s,n,r,o){const a=R.transPointsWidthScale([e]);n=R.transStrokeWithScale(n),R.drawEllipseStroke(t,a[0],s,n,r,o)}static drawEllipseFillWithScale(t,e,s,n,r,o){const a=R.transPointsWidthScale([e]);R.drawEllipseFill(t,a[0],s,n,r,o)}static drawLine(t,e,s){const n=t.getContext("2d");n.save(),n.beginPath(),n.lineWidth=s.width,n.strokeStyle=_e.joinStrokeColor(s),e.forEach((r,o)=>{o===0?n.moveTo(r.x,r.y):n.lineTo(r.x,r.y)}),n.closePath(),n.stroke(),n.restore()}static drawLineWidthScale(t,e,s){e=R.transPointsWidthScale(e),s=R.transStrokeWithScale(s),R.drawLine(t,e,s)}static getImageDataFromBlob(t){return new Promise((e,s)=>{const n=new Image;n.onload=()=>{const r=document.createElement("canvas");r.width=n.width,r.height=n.height;const o=r.getContext("2d");o.drawImage(n,0,0);const a=o.getImageData(0,0,n.width,n.height);e(a)},n.onerror=s,n.src=URL.createObjectURL(t)})}static getImageDataFromImage(t){return new Promise((e,s)=>{const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const r=n.getContext("2d");r?(r.drawImage(t,0,0),e(r.getImageData(0,0,t.width,t.height))):s(new Error("Failed to get 2d context from canvas"))})}static getCanvasByImageData(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");return s&&s.putImageData(t,0,0),e}static getDataUrlFromImage(t){return new Promise((e,s)=>{const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const r=n.getContext("2d");r?(r.drawImage(t,0,0),e(n.toDataURL())):s(new Error("Failed to get 2d context from canvas"))})}};g(R,"ImageCaches",new Map),g(R,"scale",1);let Y=R;class xe{static calcElementRenderRect(t){const{rotateBoxCoords:e,center:s}=t;return xe.calcRenderRect(e,s,t.shield.stageScale)}static calcRenderRect(t,e,s){let n=O.calcRenderRect(t,e);return n=O.scaleRect(n,s),n}static convertCoordInRect(t,e,s){const{angles:n,centerCoord:r,flipX:o,shield:{stageScale:a}}=e;t=d.transWithCenter(t,n,r,!0);let l=F.calcStageRelativePoint(t);l=O.scalePoint(l,a);let[c]=Y.transPointsOfBox([l],s);return o&&(c=d.calcHorizontalSymmetryPointInRect(c,O.centerRectConversion(s))),c}}const oo="data:image/svg+xml,%3csvg%20t='1742220316555'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='19653'%20width='200'%20height='200'%3e%3cpath%20d='M506.016%200c20%200%2036%2016%2036%2036v952c0%2020-16%2036-36%2036s-36-16-36-36V36c0-20%2016-36%2036-36z'%20p-id='19654'%20fill='%23e74b1f'%3e%3c/path%3e%3c/svg%3e";class ls{static drawArcRect(t,e){const{arcCoords:s,arcFillCoords:n,model:{styles:r},angle:o,flipX:a,leanY:l,actualAngle:c}=t,h={angle:o,flipX:a,leanY:l,actualAngle:c},u=F.batchCalcStageRelativeArcPoints(s),f=F.calcStageRelativeArcPoints(n),m=xe.calcElementRenderRect(t);r.fills.forEach(C=>{Y.drawInnerArcPathFillWithScale(e,m,f,C,h)}),u.forEach((C,y)=>{Y.drawArcPathStrokeWidthScale(e,C,m,r.strokes[y],h)})}static drawTextCursor(t,e,s){const{angle:n,flipX:r,leanY:o,actualAngle:a}=t;if(!s)return;const l=xe.calcElementRenderRect(t),{x:c,y:h,width:u,height:f}=s,m={angle:n,flipX:r,leanY:o,actualAngle:a};Y.drawImgLike(e,oo,{...l,desX:c,desY:h,desWidth:u,desHeight:f},{...m})}}class ao extends Ne{async run(){!this.canvas||!this.element||ls.drawArcRect(this.element,this.canvas)}}const lo={subs:!1,deepSubs:!1},Ys={angle:0,leanYAngle:0,internalAngle:90,actualAngle:0,viewAngle:0},Rt={corners:[0,0,0,0]},co={view:!0,leanY:!0,actual:!0,internal:!0},ho={size:!0,position:!0,points:!0,rotation:!0,angles:!0,originals:!0,outline:!0,strokes:!0,corners:!0},Pt="#0c8ce9",uo=100,fo="#0c8ce9",go=2.5,mo=1,po="#0c8ce9",Co=100,yo="#ffffff",_o=100,Eo=1,$t=6,Yt=12,xo=12,So=12,vo="#0c8ce9",bo=100,wo=12,To="Arial",Ao="center",Po="middle",Oo="#0c8ce9",Lo=1,Ro=85,ko="#0c8ce9",Io=25,Fo=$t+Math.sqrt(Math.pow(Yt/2,2)),_n={strokes:[{type:ae.middle,width:mo,color:Pt,colorOpacity:uo}],fills:[{color:fo,colorOpacity:go}]},Lt={strokes:[{type:ae.middle,width:Eo,color:po,colorOpacity:Co}],fills:[{color:yo,colorOpacity:_o}]},Rs={fontSize:wo,fontFamily:To,fills:[{color:vo,colorOpacity:bo}],textAlign:Ao,textBaseline:Po},En=Rs,xn=20,ks=3;class xr{constructor(t){g(this,"id");g(this,"isActive");g(this,"host");this.host=t,this.id=O.getRandomId(),this.isActive=!1}get angle(){return 0}get scale(){return 1/this.host.shield.stageScale}isCoordHitting(t){return!1}}class Xs extends xr{constructor(e,s){super(e);g(this,"width");g(this,"height");g(this,"x");g(this,"y");g(this,"points");const{points:n=[],x:r=0,y:o=0,width:a=0,height:l=0}=s||{};this.points=n,this.x=r,this.y=o,this.width=a,this.height=l}isContainsCoord(e){return d.isPointInPolygonByRayCasting(e,this.points)}isCoordHitting(e){return this.isContainsCoord(e)}}class Bt extends Xs{constructor(){super(...arguments);g(this,"width",Yt);g(this,"height",Yt)}get angle(){return this.host.viewAngle-90}refresh(){if(!this.host.rotationEnable)return;const e=this.host.shield.stageScale,{x:s,y:n}=F.calcElementRotatePoint(this.host);this.x=s,this.y=n,this.points=O.getBoxByCenter({x:s,y:n},{width:this.width/e,height:this.height/e}).map(r=>d.rotateWithCenter(r,this.host.viewAngle,{x:s,y:n}))}isContainsCoord(e){return this.host.rotationEnable?d.isPointInPolygonByRayCasting(e,this.points):!1}}var nt=(i=>(i[i.rect=0]="rect",i[i.circle=1]="circle",i))(nt||{});class ft extends Xs{get angle(){return d.calcAngle(this.host.centerCoord,{x:this.x,y:this.y})+90}}class Bo extends xr{constructor(e,s){super(e);g(this,"start");g(this,"end");g(this,"index");const{start:n,end:r,index:o}=s||{};n&&(this.start=n),r&&(this.end=r),k.isNumber(o)&&(this.index=o)}get angle(){return d.calcAngle(this.start,this.end)}isClosest(e){return d.isPointClosestSegment(e,this.start,this.end,Vi/this.host.shield.stageScale)}isCoordHitting(e){return this.isClosest(e)}}class kt extends Bo{}const Mo=[.25,.5,1,2,3,4,5];var zt=(i=>(i[i.vertices=0]="vertices",i[i.border=1]="border",i))(zt||{}),Ae=(i=>(i[i.vertices=0]="vertices",i[i.border=1]="border",i[i.hand=2]="hand",i[i.cross=3]="cross",i[i.move=4]="move",i[i.rotation=5]="rotation",i))(Ae||{});const Do=100;class Sr extends Bt{get angle(){return d.calcAngle(this.host.centerCoord,{x:this.x,y:this.y})+45}}const Je={type:I.moveable,name:"移动",category:he.cursor,icon:"icon-verbise-arrow-cursor-2--mouse-select-cursor",shortcut:"ctrl+m"},Is={type:I.hand,name:"手型",category:he.cursor,icon:"icon-verbise-hand",shortcut:"ctrl+h"},qs={type:I.rectangle,name:"矩形",category:he.shapes,icon:"icon-verbise-Rectangle"},No={type:I.line,name:"直线",category:he.shapes,icon:"icon-verbise-line"},Vo={type:I.polygon,name:"多边形",category:he.shapes,icon:"icon-verbise-polygon"},Ho={type:I.image,name:"图片",category:he.shapes,icon:"icon-verbise-Image"},Us={type:I.arbitrary,name:"线条",category:he.freedom,icon:"icon-verbise-pen"},zo={type:I.pencil,name:"画笔",category:he.freedom,icon:"icon-verbise-pencil"},Wo={type:I.ellipse,name:"椭圆",category:he.shapes,icon:"icon-verbise-eclipse"},vr={type:I.text,name:"文本",category:he.text,icon:"icon-verbise-text"},br=[Je,Is],wr=[qs,No,Wo,Vo,Ho],Tr=[Us,zo],jo=[Je,...br,qs,...wr,Us,...Tr,vr];class Ar{static getCreatorByType(t){return jo.find(e=>e.type===t)}static isElement(t){return[I.image,I.text,I.arbitrary,I.rectangle,I.ellipse,I.polygon,I.line,I.text,I.pencil].includes(t)}}const xs=["id","coords","boxCoords","x","y"];let Ct=class{constructor(t,e,s){g(this,"model");g(this,"rotation");g(this,"shield");g(this,"node");g(this,"_originalTransformerCoords",[]);g(this,"_originalCoords",[]);g(this,"_originalRotateCoords",[]);g(this,"_originalBoxCoords",[]);g(this,"_originalRotateBoxCoords",[]);g(this,"_originalRotateOutlineCoords",[]);g(this,"_originalStrokeCoords",[]);g(this,"_originalUnLeanCoords",[]);g(this,"_originalUnLeanBoxCoords",[]);g(this,"_originalUnLeanStrokeCoords",[]);g(this,"_originalMaxBoxCoords",[]);g(this,"_originalMaxOutlineBoxCoords",[]);g(this,"_originalTransformMatrix",[]);g(this,"_originalTransformMoveCoord");g(this,"_originalCenterCoord");g(this,"_originalAngle",0);g(this,"_originalSize",{});g(this,"_originalCorners",[]);g(this,"_originalData");g(this,"_transformMatrix",[]);g(this,"_transformLockCoord");g(this,"_transformLockIndex");g(this,"_unLeanCoords",[]);g(this,"_unLeanBoxCoords",[]);g(this,"_maxBoxCoords",[]);g(this,"_rotateCoords",[]);g(this,"_rotateBoxCoords",[]);g(this,"_maxOutlineBoxCoords",[]);g(this,"_rotateOutlineCoords",[]);g(this,"_strokeCoords",[]);g(this,"_unLeanStrokeCoords",[]);g(this,"_rect",{});g(this,"_transformers",[]);g(this,"_borderTransformers",[]);g(this,"_transformType");g(this,"_rotateControllers",[]);g(this,"_minParallelogramVerticalSize");g(this,"_minLeanSize");g(this,"_flipX",!1);g(this,"_innermostStrokeCoordIndex",0);g(this,"_isRangeElement",!1);g(this,"_status",Q.initialed);g(this,"_isSelected",!1);g(this,"_isVisible",!0);g(this,"_isEditing",!1);g(this,"_isLocked",!1);g(this,"_isMoving",!1);g(this,"_isTransforming",!1);g(this,"_isRotating",!1);g(this,"_isRotatingTarget",!1);g(this,"_isDragging",!1);g(this,"_isCornerMoving",!1);g(this,"_isProvisional",!1);g(this,"_isTarget",!1);g(this,"_isInRange",!1);g(this,"_isOnStage",!1);this.model=t,this.rotation=new Bt(this),this.shield=e,this._isRangeElement=s??!1,this.refreshFlipX(),nr(this,{_status:ne,_isDragging:ne,_isRotating:ne,_isTransforming:ne,_isRotatingTarget:ne,_isProvisional:ne,_isOnStage:ne,_isEditing:ne,_isMoving:ne,_isSelected:ne,_isVisible:ne,_isLocked:ne,_isTarget:ne,_isInRange:ne,_isCornerMoving:ne})}get isRangeElement(){return this._isRangeElement}get id(){return this.model.id}get isElement(){return Ar.isElement(this.model.type)}get isGroup(){return this.model.type===I.group}get group(){return this.isGroupSubject?this.shield.store.getElementById(this.model.groupId):null}get ancestorGroup(){if(!this.isGroupSubject)return null;let t=this.group;for(;t&&t.isGroupSubject;)t=t.group;return t}get isGroupSubject(){return this.model.groupId!==void 0}get strokeCoords(){return this._strokeCoords}get unLeanStrokeCoords(){return this._unLeanStrokeCoords}get innermostStrokeCoordIndex(){return this._innermostStrokeCoordIndex}get innermostStrokeCoords(){return this._strokeCoords[this.innermostStrokeCoordIndex]}get flipX(){return this.flipXEnable?!this._isTransforming||this._isEditing?this._flipX:(this.refreshFlipX(),this._flipX):!1}get flipY(){return!1}get flip(){return{flipX:this.flipX,flipY:this.flipY}}get flipXEnable(){return!0}get flipYEnable(){return!0}get positionInputEnable(){return this.status===Q.finished}get widthInputEnable(){return this.status===Q.finished}get heightInputEnable(){return this.status===Q.finished}get angleInputEnable(){return this.status===Q.finished}get rotationEnable(){return!0}get verticesRotationEnable(){return!0}get coordTransformEnable(){return!1}get boxVerticesTransformEnable(){return this.status===Q.finished}get borderTransformEnable(){return this.status===Q.finished}get transformersEnable(){return!0}get fillEnable(){return!0}get fillInputEnable(){return this.status===Q.finished}get strokeEnable(){return!0}get strokeInputEnable(){return this.status===Q.finished}get ratioLockedEnable(){return this.status===Q.finished}get editingEnable(){return!0}get tfRefreshAfterEdChanged(){return!1}get shouldRatioLockResize(){return this.ratioLockedEnable&&(this.isRatioLocked||this.shield.event.isShift)}get originalCoords(){return this._originalCoords}get originalBoxCoords(){return this._originalBoxCoords}get width(){return this.model.width}get height(){return this.model.height}get minParallelogramVerticalSize(){return this._minParallelogramVerticalSize}get minLeanSize(){return this._minLeanSize}get angle(){return this.getAngle()}get corners(){return this.model.corners}get center(){return F.calcStageRelativePoint(this.centerCoord)}get centerCoord(){return this.calcCenterCoord()}get position(){return{x:this.model.x,y:this.model.y}}get strokes(){return this.model.styles.strokes}get fills(){return this.model.styles.fills}get textAlign(){return this.model.styles.textAlign}get textVerticalAlign(){return this.model.styles.textVerticalAlign}get textBaseline(){return this.model.styles.textBaseline}get fontEnable(){return!1}get fontInputEnable(){return!1}get fontLineHeightInputEnable(){return!1}get fontLineHeightFactorInputEnable(){return!1}get fontLetterSpacingInputEnable(){return!1}get paragraphSpacingInputEnable(){return!1}get fontStyler(){return this.model.styles.fontStyler}get fontSize(){return this.model.styles.fontSize}get fontFamily(){return this.model.styles.fontFamily}get fontLineHeight(){return this.model.styles.fontLineHeight}get fontLineHeightFactor(){return this.model.styles.fontLineHeightFactor}get fontLineHeightAutoFit(){return this.model.styles.fontLineHeightAutoFit}get fontLetterSpacing(){return this.model.styles.fontLetterSpacing}get fontColor(){return this.model.styles.fontColor}get fontColorOpacity(){return this.model.styles.fontColorOpacity}get textDecoration(){return this.model.styles.textDecoration}get textDecorationColor(){return this.model.styles.textDecorationColor}get textDecorationOpacity(){return this.model.styles.textDecorationOpacity}get textDecorationThickness(){return this.model.styles.textDecorationThickness}get textDecorationMixin(){return!1}get textDecorationColorMixin(){return!1}get textDecorationOpacityMixin(){return!1}get textDecorationThicknessMixin(){return!1}get fontStylerMixin(){return!1}get fontSizeMixin(){return!1}get fontFamilyMixin(){return!1}get fontColorMixin(){return!1}get fontColorOpacityMixin(){return!1}get fontLetterSpacingMixin(){return!1}get paragraphSpacing(){return this.model.styles.paragraphSpacing}get status(){return this._status}set status(t){this._setStatus(t)}get isSelected(){return this._isSelected}set isSelected(t){this._setIsSelected(t)}get isVisible(){return this._isVisible}set isVisible(t){this._setIsVisible(t)}get isEditing(){return this._isEditing}set isEditing(t){this._setIsEditing(t)}get isLocked(){return this._isLocked}set isLocked(t){this._setIsLocked(t)}get isMoving(){return this._isMoving}set isMoving(t){this._setIsMoving(t)}get isTransforming(){return this._isTransforming}set isTransforming(t){this._setIsTransforming(t)}get isRotating(){return this._isRotating}set isRotating(t){this._setIsRotating(t)}get isRotatingTarget(){return this._isRotatingTarget}set isRotatingTarget(t){this._setIsRotatingTarget(t)}get isDragging(){return this._isDragging}set isDragging(t){this._setIsDragging(t)}get isCornerMoving(){return this._isCornerMoving}set isCornerMoving(t){this._setIsCornerMoving(t)}get isProvisional(){return this._isProvisional}set isProvisional(t){this._setIsRendered(t)}get isTarget(){return this._isTarget}set isTarget(t){this._setIsTarget(t)}get isInRange(){return this._isInRange}set isInRange(t){this._setIsInRange(t)}get isOnStage(){return this._isOnStage}set isOnStage(t){this._setIsOnStage(t)}get isRatioLocked(){return this.model.isRatioLocked}_setStatus(t){this._status=t,this.emitPropChanged(E.statusChanged,[this._status])}_setIsSelected(t){this._isSelected=t}_setIsVisible(t){this._isVisible=t}_setIsEditing(t){this._isEditing=t}_setIsLocked(t){this._isLocked=t}_setIsMoving(t){this._isMoving=t}_setIsTransforming(t){this._isTransforming=t}_setIsRotating(t){this._isRotating=t}_setIsRotatingTarget(t){this._isRotatingTarget=t}_setIsDragging(t){this._isDragging=t}_setIsRendered(t){this._isProvisional=t}_setIsTarget(t){this._isTarget=t}_setIsOnStage(t){this._isOnStage=t}_setIsInRange(t){this._isInRange=t}_setIsCornerMoving(t){this._isCornerMoving=t}get maxBoxCoords(){return this._maxBoxCoords}get maxOutlineBoxCoords(){return this._maxOutlineBoxCoords}get rotateCoords(){return this._rotateCoords}get rotateBoxCoords(){return this._rotateBoxCoords}get rotateOutlineCoords(){return this._rotateOutlineCoords}get unLeanCoords(){return this._unLeanCoords}get unLeanBoxCoords(){return this._unLeanBoxCoords}get transformers(){return this._transformers}get borderTransformers(){return this._borderTransformers}get transformerType(){return nt.rect}get rect(){return this._rect}get activeCoordIndex(){return-1}get alignCoords(){return this._rotateCoords}get alignOutlineCoords(){return this._rotateOutlineCoords}get visualStrokeWidth(){return Math.max(...this.strokes.map(t=>t.width*this.shield.stageScale))}get visualFontSize(){return this.fontSize*this.shield.stageScale}get originalAngle(){return this._originalAngle}set originalAngle(t){this._originalAngle=t}get transformMatrix(){return this._transformMatrix}get transformLockIndex(){return this._transformLockIndex}get transformLockCoord(){return this._transformLockCoord}get originalTransformMoveCoord(){return this._originalTransformMoveCoord}get transformType(){return this._transformType}get viewAngle(){return this.model.viewAngle}get internalAngle(){return this.model.internalAngle}get leanYAngle(){return this.model.leanYAngle}get angles(){return{angle:this.model.angle,leanYAngle:this.model.leanYAngle,internalAngle:this.model.internalAngle,actualAngle:this.model.actualAngle,viewAngle:this.model.viewAngle}}get leanY(){return-Math.tan(d.angleToRadian(this.model.leanYAngle))}get actualAngle(){return this.model.actualAngle}get viewAngleCalcEnable(){return!0}get leanYAngleCalcEnable(){return!0}get leanYAngleInputEnable(){return this.status===Q.finished}get cornersInputEnable(){return!1}get cornersEnable(){return!1}get rotateControllers(){return this._rotateControllers}get controllers(){const t=[];return this.rotationEnable&&(this.shield.configure.rotationIconEnable&&t.push(this.rotation),t.push(...this._rotateControllers)),(this.coordTransformEnable||this.boxVerticesTransformEnable)&&t.push(...this._transformers),this.borderTransformEnable&&t.push(...this._borderTransformers),t}get isTopmost(){return this.node.next===null}get isBottommost(){return this.node.prev===null}get isInMultiSelected(){const{selectedElementIds:t}=this.shield.store;return t.has(this.model.id)&&t.size>1}get shouldPropChangedEmit(){const t=this.isInMultiSelected;return!t||t&&!this.isGroupSubject}get strokeEffective(){return this.strokes.some(t=>t.width>0)}get fillEffective(){return this.fills.some(t=>!t.colorOpacity)}onPositionChanged(){this.refresh(),this.emitPropChanged(E.positionChanged,[this.position])}onWidthChanged(){this.refresh(),this.emitPropChanged(E.widthChanged,[this.width])}onHeightChanged(){this.refresh(),this.emitPropChanged(E.heightChanged,[this.height])}onLayerChanged(){}onTranslateBefore(){this.refreshOriginalProps()}onTranslateAfter(){this.refreshOriginalProps()}onTranslating(){const{x:t,y:e}=F.calcPosition({type:this.model.type,coords:this.model.coords});this.model.x=t,this.model.y=e,this.refreshCorners(),this.refreshRotation(),this.refreshTransformers(),this.emitPropChanged(E.positionChanged,[this.position])}onRotateBefore(){this.refreshOriginalProps()}onRotateAfter(){this.refreshOriginalProps()}onRotating(){this.refresh({points:!0,rotation:!0,position:!0,angles:!0,outline:!0,strokes:!0,corners:!0}),this.emitPropChanged(E.angleChanged,[this.angle])}onTransformBefore(){this.refreshOriginalProps()}onTransformAfter(){this.refreshOriginalProps()}onTransforming(){this.refresh({points:!0,rotation:!0,size:!0,position:!0,angles:!0,outline:!0,strokes:!0,corners:!0},{angles:{view:!0,actual:!0}}),this.emitPropChanged(E.positionChanged,[this.position]),this.emitPropChanged(E.widthChanged,[this.width]),this.emitPropChanged(E.heightChanged,[this.height]),this.emitPropChanged(E.angleChanged,[this.angle]),this.emitPropChanged(E.flipXChanged,[this._flipX])}onAngleChanged(){this.refresh(null,{angles:{view:!0,actual:!0}}),this.emitPropChanged(E.angleChanged,[this.angle])}onLeanyAngleChanged(){this.refresh(null,{angles:{view:!0,actual:!0,internal:!0}}),this.emitPropChanged(E.leanYAngleChanged,[this.leanYAngle])}onCornerChanging(){this.refresh({corners:!0,strokes:!0}),this.emitPropChanged(E.cornersChanged,[this.corners])}onCornerChanged(){this.refresh({corners:!0,strokes:!0,originals:!0}),this.emitPropChanged(E.cornersChanged,[this.corners])}onStrokeTypeChanged(){this.refresh({strokes:!0,outline:!0,originals:!0}),this.emitPropChanged(E.strokesChanged,[this.strokes])}onStrokeWidthChanged(){this.refresh({strokes:!0,outline:!0,originals:!0}),this.emitPropChanged(E.strokesChanged,[this.strokes])}onStrokeColorChanged(){this.emitPropChanged(E.strokesChanged,[this.strokes])}onStrokeColorOpacityChanged(){this.emitPropChanged(E.strokesChanged,[this.strokes])}onStrokeAdded(){this.refresh({strokes:!0,outline:!0,originals:!0}),this.emitPropChanged(E.strokesChanged,[this.strokes])}onStrokeRemoved(){this.refresh({strokes:!0,outline:!0,originals:!0}),this.emitPropChanged(E.strokesChanged,[this.strokes])}onFillColorChanged(){this.emitPropChanged(E.fillsChanged,[this.fills])}onFillColorOpacityChanged(){this.emitPropChanged(E.fillsChanged,[this.fills])}onFillAdded(){this.emitPropChanged(E.fillsChanged,[this.fills])}onFillRemoved(){this.emitPropChanged(E.fillsChanged,[this.fills])}onTextAlignChanged(){this.emitPropChanged(E.textAlignChanged,[this.textAlign])}onTextVerticalAlignChanged(){this.emitPropChanged(E.textVerticalAlignChanged,[this.textVerticalAlign])}onTextBaselineChanged(){this.emitPropChanged(E.textBaselineChanged,[this.textBaseline])}onFontStylerChanged(){this.emitPropChanged(E.fontStylerChanged,[this.fontStyler])}onFontSizeChanged(){this.emitPropChanged(E.fontSizeChanged,[this.fontSize])}onFontFamilyChanged(){this.emitPropChanged(E.fontFamilyChanged,[this.fontFamily])}onFontLineHeightChanged(){this.emitPropChanged(E.fontLineHeightChanged,[this.fontLineHeight])}onFontLineHeightFactorChanged(){this.emitPropChanged(E.fontLineHeightFactorChanged,[this.fontLineHeightFactor])}onFontLineHeightAutoFitChanged(){this.emitPropChanged(E.fontLineHeightAutoFitChanged,[this.fontLineHeightAutoFit])}onFontLetterSpacingChanged(){this.emitPropChanged(E.fontLetterSpacingChanged,[this.fontLetterSpacing])}onFontColorChanged(){this.emitPropChanged(E.fontColorChanged,[this.fontColor])}onFontColorOpacityChanged(){this.emitPropChanged(E.fontColorOpacityChanged,[this.fontColorOpacity])}onTextDecorationChanged(){this.emitPropChanged(E.textDecorationChanged,[this.textDecoration])}onTextDecorationColorChanged(){this.emitPropChanged(E.textDecorationColorChanged,[this.textDecorationColor])}onTextDecorationOpacityChanged(){this.emitPropChanged(E.textDecorationOpacityChanged,[this.textDecorationOpacity])}onTextDecorationThicknessChanged(){this.emitPropChanged(E.textDecorationThicknessChanged,[this.textDecorationThickness])}onParagraphSpacingChanged(){this.emitPropChanged(E.paragraphSpacingChanged,[this.paragraphSpacing])}onRatioLockedChanged(){this.emitPropChanged(E.ratioLockedChanged,[this.isRatioLocked])}onStageChanged(){}getAngle(){return this.model.angle}emitPropChanged(t,e){this.shouldPropChangedEmit&&this.shield.store.filterEmit(t,this,...e)}convertPointsByStrokeType(t,e){return Y.convertPointsByStrokeType(t,e.type,e.width,{...this.flip,isFold:this.model.isFold})}calcRotateBoxCoords(){return this.model.boxCoords.map(t=>d.rotateWithCenter(t,this.model.angle,this.centerCoord))}calcMaxBoxCoords(){return O.getBoxByPoints(this._rotateCoords)}calcMaxOutlineBoxCoords(){return O.getBoxByPoints(this._rotateOutlineCoords.flat())}calcRotateCoords(){return this.model.coords.map(t=>d.rotateWithCenter(t,this.model.angle,this.centerCoord))}calcRotateOutlineCoords(){return this.model.styles.strokes.map(t=>F.calcOutlinePoints(this._rotateCoords,t.type,t.width,{...this.flip,isFold:this.model.isFold}))}calcCenterCoord(){return d.calcCenter(this.model.boxCoords)}getController4BoxCoords(t,e){return e=e||$t,O.getBoxByCenter(t,{width:e/this.shield.stageScale,height:e/this.shield.stageScale},{angle:this.model.actualAngle,leanYAngle:this.model.leanYAngle})}calcTransformersByCoords(t){return t.map((e,s)=>{const{x:n,y:r}=e,o=this.getController4BoxCoords(e);let a=this._transformers[s];return a?(a.points=o,a.x=n,a.y=r):a=new ft(this,{points:o,x:n,y:r}),a})}calcBoxVerticesTransformers(){return this.calcTransformersByCoords(this._rotateBoxCoords)}calcCoordTransformers(){return this.calcTransformersByCoords(this._rotateCoords)}calcTransformers(){return this.coordTransformEnable?this.calcCoordTransformers():this.boxVerticesTransformEnable?this.calcBoxVerticesTransformers():[]}calcRotateControllers(){const t=this.centerCoord;return this._rotateBoxCoords.map((e,s)=>{const n=d.calcAngle(t,e),{x:r,y:o}=d.calcTargetPoint(e,Fo/this.shield.stageScale,n),a=this.getController4BoxCoords({x:r,y:o},Yt);let l=this._rotateControllers[s];return l?(l.points=a,l.x=r,l.y=o):l=new Sr(this,{x:r,y:o,points:a}),l})}calcBorderTransformers(){return this._rotateBoxCoords.map((e,s)=>{const n=O.getNextOfArray(this._rotateBoxCoords,s);let r=this._borderTransformers[s];return r?(r.start=e,r.end=n):r=new kt(this,{start:e,end:n,index:s}),r})}calcUnLeanCoords(){return d.calcUnLeanByPoints(this.model.coords,0,this.model.leanYAngle)}calcUnLeanBoxCoords(){return d.calcUnLeanByPoints(this.model.boxCoords,0,this.model.leanYAngle)}calcStrokeCoords(){return this.model.styles.strokes.map(t=>this.convertPointsByStrokeType(this._rotateCoords,t))}calcInnermostStrokeCoordIndex(){let t=0,e=0;return this._strokeCoords.forEach((s,n)=>{const{width:r,type:o}=this.model.styles.strokes[n];o===ae.middle&&e<r/2&&(e=r/2,t=n),o===ae.inside&&e<r&&(e=r,t=n)}),t}calcUnLeanStrokeCoords(){return this.model.styles.strokes.map(t=>this.convertPointsByStrokeType(this._unLeanCoords,t))}calcInternalAngle(){return this._isRangeElement?90:d.calcInternalAngle(this.model.boxCoords)}calcLeanYAngle(){return!this.leanYAngleCalcEnable||this._isRangeElement?0:d.calcLeanYAngle(this.model.internalAngle,this.flipX)}calcViewAngle(){return this.viewAngleCalcEnable?d.calcViewAngleByPoints(this._rotateBoxCoords):this.model.angle}calcActualAngle(){return d.mirrorAngle(this.model.viewAngle-this.model.leanYAngle)}calcPrimitiveSize(){return O.calcRectangleSize(d.batchLeanWithCenter(this.model.boxCoords,-this.model.leanXAngle,-this.model.leanYAngle,this.centerCoord))}refreshAngles(t){t=t||co,t.view&&(this.model.viewAngle=this.calcViewAngle()),t.internal&&(this.model.internalAngle=this.calcInternalAngle()),t.leanY&&(this.model.leanYAngle=this.calcLeanYAngle()),t.actual&&(this.model.actualAngle=this.calcActualAngle())}refreshRotation(){this.rotationEnable&&(this.shield.configure.rotationIconEnable&&this.rotation.refresh(),this._rotateControllers=this.calcRotateControllers())}refreshPoints(){this._rotateCoords=this.calcRotateCoords(),this._rotateBoxCoords=this.calcRotateBoxCoords(),this._unLeanCoords=this.calcUnLeanCoords(),this._unLeanBoxCoords=this.calcUnLeanBoxCoords(),this._maxBoxCoords=this.calcMaxBoxCoords(),this.refreshTransformers()}isContainsCoord(t){return k.some(this._rotateOutlineCoords,e=>d.isPointInPolygonByRayCasting(t,e))}isPolygonOverlap(t){return k.some(this._rotateOutlineCoords,e=>d.isPolygonsOverlap(e,t))}isModelPolygonOverlap(t){return k.some(this._rotateOutlineCoords,e=>d.isPolygonsOverlap(e,t))}refreshOriginalElementProps(){this.refreshOriginalCoords(),this.refreshOriginalStrokes(),this._originalSize={width:this.model.width,height:this.model.height},this._originalCorners=W.jsonClone(this.model.corners),this._originalTransformMatrix=[]}refreshOriginalCoords(){this._originalCoords=W.jsonClone(this.model.coords),this._originalBoxCoords=W.jsonClone(this.model.boxCoords),this._originalRotateCoords=W.jsonClone(this._rotateCoords),this._originalRotateBoxCoords=W.jsonClone(this._rotateBoxCoords),this._originalUnLeanCoords=W.jsonClone(this._unLeanCoords),this._originalUnLeanBoxCoords=W.jsonClone(this._unLeanBoxCoords),this._originalCenterCoord=W.jsonClone(this.centerCoord),this._originalRotateOutlineCoords=W.jsonClone(this._rotateOutlineCoords),this._originalMaxOutlineBoxCoords=W.jsonClone(this._maxOutlineBoxCoords),this._originalMaxBoxCoords=W.jsonClone(this._maxBoxCoords)}refreshOriginalStrokes(){this._originalStrokeCoords=W.jsonClone(this._strokeCoords),this._originalUnLeanStrokeCoords=W.jsonClone(this._unLeanStrokeCoords)}refreshOriginalTransformerCoords(){this._originalTransformerCoords=this._transformers.map(t=>{const{x:e,y:s}=t;return{x:e,y:s}})}refreshOriginalProps(){this.refreshOriginalTransformerCoords(),this.refreshOriginalElementProps(),!this.isRangeElement&&this.refreshOriginalAngle()}refreshSize(){const{width:t,height:e}=F.calcSize(this.model);if(this.model.width=d.precise(t,1),this.model.height=d.precise(e,1),this._rotateBoxCoords&&this._rotateBoxCoords.length){const{width:s,height:n}=d.calcParallelogramVerticalSize(this._rotateBoxCoords);this._minParallelogramVerticalSize=Math.min(s,n),this._minLeanSize=Math.min(this.model.width,n)}}refreshPosition(){Object.assign(this.model,this.calcCenterCoord())}refreshTransformers(){this._transformers=this.calcTransformers(),this.borderTransformEnable&&(this._borderTransformers=this.calcBorderTransformers())}flipAngle(){let t;this.model.angle>0?t=this.model.angle-180:t=this.model.angle+180,this.model.angle=d.mirrorAngle(t)}batchCalcTransformPointsByCenter(t,e,s,n){return this.calcTransformPointsByCenter(t,e,s,n,this.angles)}calcTransformPointsByCenter(t,e,s,n,r){const o=F.calcMatrixPoint(n,e,s,r);return t.map(a=>(a=F.calcMatrixPoint(a,e,s,r),d.rotateWithCenter(a,-r.angle,o)))}transform(t){this.getActiveController()instanceof ft?(this.transformByVertices(t),this._transformType=zt.vertices):this.getActiveController()instanceof kt&&(this.transformByBorder(t),this._transformType=zt.border)}transformBy(t){const{lockCoord:e,lockIndex:s,transformType:n,originalMovingCoord:r,offset:o,groupAngle:a,groupLeanYAngle:l}=t,c={angle:a,leanYAngle:l},h=this.getTransformMatrix(e,r,o,c,!1);n===zt.border&&this._transBorderMatrix(h,s,!1),this._doTransformBy(h,e,c,r)}_doTransformBy(t,e,s,n){const r=F.calcMatrixPoints(this._originalRotateCoords,t,e,s),o=F.calcMatrixPoints(this._originalRotateBoxCoords,t,e,s);this._doTransformByPoints(r,o,e,t,n)}_doTransformByPoints(t,e,s,n,r){this.model.internalAngle=d.calcInternalAngle(e),this.model.leanYAngle=d.calcLeanYAngle(this.model.internalAngle,d.calcFlipXByPoints(e)),this.model.angle=d.mirrorAngle(d.calcActualAngleByPoints(e)),this.model.coords=d.batchPrecisePoint(F.calcCoordsByTransPoints(t,this.angles,s),1),this.model.boxCoords=d.batchPrecisePoint(F.calcCoordsByTransPoints(e,this.angles,s),1),r&&n&&this._tryFlipAngle(s,r,n)}transformByVertices(t){!this.coordTransformEnable&&!this.boxVerticesTransformEnable||this.doVerticesTransform(t)}doVerticesTransform(t){const e=this._transformers.findIndex(s=>s.isActive);if(e!==-1){const s=O.getPrevIndexOfArray(this._transformers.length,e,2),n=this._originalTransformerCoords[s],r=this._originalTransformerCoords[e];this._originalTransformMoveCoord=r,this.transformByLockPoint(n,r,t,e)}}transformByLockPoint(t,e,s,n){const r=this.getTransformMatrix(t,e,s,this.angles);this._transformMatrix=r,this._transformLockCoord=t,this._transformLockIndex=n,this.model.coords=d.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,r,t,this._originalCenterCoord),1),this.model.boxCoords=d.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,r,t,this._originalCenterCoord),1),this._tryFlipAngle(t,e,r)}getTransformMatrix(t,e,s,n,r){typeof r>"u"&&(r=!0);const o={x:e.x+s.x,y:e.y+s.y},a=d.calcTransformMatrix(t,o,e,n);return r&&this.shouldRatioLockResize&&(a[1][1]=d.resignValue(a[1][1],a[0][0])),a}_tryFlipAngle(t,e,s){this._originalTransformMatrix.length||(this._originalTransformMatrix=d.calcTransformMatrix(t,e,e,this.angles));const n=this._doFlipAngle(s,this._originalTransformMatrix);return n&&(this._originalTransformMatrix=W.jsonClone(s)),n}_doFlipAngle(t,e){e[0][0];const s=e[1][1];t[0][0];const n=t[1][1];return d.isSameSign(n,s)?!1:(this.flipAngle(),!0)}transformByBorder(t){this.borderTransformEnable&&this.doBorderTransform(t)}getBorderTransformLockCoord(t){const e=O.getPrevIndexOfArray(this._borderTransformers.length,t,2),s=O.getNextIndexOfArray(this._borderTransformers.length,t,3);return d.calcCenter([this._originalTransformerCoords[e],this._originalTransformerCoords[s]])}_transBorderMatrix(t,e,s){typeof s>"u"&&(s=!0);const n=s&&this.shouldRatioLockResize;return e===0||e===2?t[0][0]=n?d.resignValue(t[0][0],t[1][1]):1:(e===1||e===3)&&(t[1][1]=n?d.resignValue(t[1][1],t[0][0]):1),[1,3].includes(e)&&t[1][1]<0&&(t[1][1]=Math.abs(t[1][1])),[0,2].includes(e)&&t[0][0]<0&&(t[0][0]=Math.abs(t[0][0])),t}doBorderTransform(t){const e=this._borderTransformers.findIndex(s=>s.isActive);if(e!==-1){const s=this.getBorderTransformLockCoord(e),n=this._originalTransformerCoords[e],r={x:n.x+t.x,y:n.y+t.y},o=d.calcTransformMatrix(s,r,n,this.angles);this._transBorderMatrix(o,e),this._transformMatrix=o,this._transformLockCoord=s,this._transformLockIndex=e,this.model.coords=d.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,o,s,this._originalCenterCoord),1),this.model.boxCoords=d.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,o,s,this._originalCenterCoord),1),this._tryFlipAngle(s,n,o)}}translateBy(t){this.model.coords=d.batchTranslate(this._originalCoords,t),this.model.boxCoords=d.batchTranslate(this._originalBoxCoords,t),this._rotateCoords=d.batchTranslate(this._originalRotateCoords,t),this._rotateBoxCoords=d.batchTranslate(this._originalRotateBoxCoords,t),this._unLeanCoords=d.batchTranslate(this._originalUnLeanCoords,t),this._unLeanBoxCoords=d.batchTranslate(this._originalUnLeanBoxCoords,t),this._unLeanStrokeCoords=this._originalUnLeanStrokeCoords.map(e=>d.batchTranslate(e,t)),this._strokeCoords=this._originalStrokeCoords.map(e=>d.batchTranslate(e,t)),this._maxBoxCoords=d.batchTranslate(this._originalMaxBoxCoords,t),this._maxOutlineBoxCoords=d.batchTranslate(this._originalMaxOutlineBoxCoords,t),this._rotateOutlineCoords=this._originalRotateOutlineCoords.map(e=>d.batchTranslate(e,t))}refresh(t,e){t=t||ho,t!=null&&t.points&&this.refreshPoints(),t!=null&&t.size&&this.refreshSize(),t!=null&&t.position&&this.refreshPosition(),t!=null&&t.angles&&this.refreshAngles(e==null?void 0:e.angles),t!=null&&t.rotation&&this.refreshRotation(),t!=null&&t.corners&&this.refreshCorners(),t!=null&&t.strokes&&this.refreshStrokePoints(),t!=null&&t.outline&&this.refreshOutlinePoints(),t!=null&&t.originals&&this.refreshOriginalProps()}refreshOutlinePoints(){this._rotateOutlineCoords=this.calcRotateOutlineCoords(),this._maxOutlineBoxCoords=this.calcMaxOutlineBoxCoords()}refreshFlipX(){var t;(t=this.model.boxCoords)!=null&&t.length&&(this._flipX=d.calcFlipXByPoints(this.model.boxCoords))}setWidth(t){const e=d.calcScaleMatrix(t/this._originalSize.width,1);return e[1][1]=this.shouldRatioLockResize?d.resignValue(e[1][1],e[0][0]):1,this._setWH(e),e}setHeight(t){const e=d.calcScaleMatrix(1,t/this._originalSize.height);return e[0][0]=this.shouldRatioLockResize?d.resignValue(e[0][0],e[1][1]):1,this._setWH(e),e}scaleBy(t,e,s,n){const r=d.calcScaleMatrix(e,s);n?this._doTransformBy(r,t,n):(this.model.coords=d.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,r,t,this._originalCenterCoord),1),this.model.boxCoords=d.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,r,t,this._originalCenterCoord),1)),this.refresh({points:!0,size:!0,position:!0,rotation:!0,originals:!0,outline:!0,strokes:!0,corners:!0})}_setWH(t){this._transformMatrix=t,this._transformLockCoord=this._originalCenterCoord,this.model.coords=d.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,t,this._originalCenterCoord,this._originalCenterCoord),1),this.model.boxCoords=d.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,t,this._originalCenterCoord,this._originalCenterCoord),1)}setPosition(t,e,s){this.model.x=t,this.model.y=e,this.model.coords=d.batchPrecisePoint(d.batchTranslate(this.model.coords,s),1),this.model.boxCoords=d.batchPrecisePoint(d.batchTranslate(this.model.boxCoords,s),1)}setAngle(t){this.model.angle=t}setLeanYAngle(t){t=k.clamp(t,-89,89);const e=this.calcUnLeanCoords(),s=this.centerCoord;this.model.coords=d.batchPrecisePoint(d.batchLeanYWithCenter(e,t,s),1);const n=this.calcUnLeanBoxCoords();this.model.boxCoords=d.batchPrecisePoint(d.batchLeanYWithCenter(n,t,s),1),this.model.leanYAngle=t}leanYBy(t,e,s,n){let r=d.batchTransWithCenter(this._rotateCoords,{angle:s,leanYAngle:e},n,!0),o=d.batchTransWithCenter(this._rotateBoxCoords,{angle:s,leanYAngle:e},n,!0);r=d.batchTransWithCenter(r,{angle:s,leanYAngle:t},n),o=d.batchTransWithCenter(o,{angle:s,leanYAngle:t},n),this._doTransformByPoints(r,o,n)}refreshCorners(){}refreshStrokePoints(){this._strokeCoords=this.calcStrokeCoords(),this._unLeanStrokeCoords=this.calcUnLeanStrokeCoords(),this._innermostStrokeCoordIndex=this.calcInnermostStrokeCoordIndex()}setCorners(t,e){let s=W.jsonClone(this.model.corners);k.isNumber(e)?s[e]=t:s.fill(t),s=F.fixCornersBasedOnMinSize(s,this._minParallelogramVerticalSize),this.model.corners=s}setStrokeType(t,e){this.model.styles.strokes[e].type=t}setStrokeColor(t,e){this.model.styles.strokes[e].color=t}setStrokeColorOpacity(t,e){this.model.styles.strokes[e].colorOpacity=k.clamp(t,0,100)}setStrokeWidth(t,e){switch(this.model.styles.strokes[e].type){case ae.middle:t=k.clamp(t,0,this._minLeanSize);break;case ae.inside:t=k.clamp(t,0,this._minLeanSize/2);break;case ae.outside:t=k.clamp(t,0,this._minLeanSize*2);break}t=d.precise(t,1),this.model.styles.strokes[e].width=t}addStroke(t){this.model.styles.strokes.splice(t+1,0,{...os})}removeStroke(t){this.model.styles.strokes.splice(t,1)}setFillColor(t,e){this.model.styles.fills[e].color=t}setFillColorOpacity(t,e){this.model.styles.fills[e].colorOpacity=k.clamp(t,0,100)}addFill(t){this.model.styles.fills.splice(t+1,0,{...as})}removeFill(t){this.model.styles.fills.splice(t,1)}setFontStyler(t){this.model.styles.fontStyler=t}setFontSize(t){this.model.styles.fontSize=t,this._updateLineHeightByFactor()}setFontFamily(t){this.model.styles.fontFamily=t}_updateLineHeightByFactor(){const{fontSize:t,fontLineHeightFactor:e,fontLineHeightAutoFit:s}=this.model.styles;s&&(this.model.styles.fontLineHeight=d.precise(t*e,0))}setFontLineHeight(t){this.model.styles.fontLineHeight=t,this.model.styles.fontLineHeightFactor=d.precise(t/this.model.styles.fontSize,2)}setFontLineHeightFactor(t){this.model.styles.fontLineHeightFactor=t,this._updateLineHeightByFactor()}setFontLineHeightAutoFit(t){this.model.styles.fontLineHeightAutoFit=t,this._updateLineHeightByFactor()}setFontLetterSpacing(t){this.model.styles.fontLetterSpacing=t}setFontColor(t){this.model.styles.fontColor=t}setFontColorOpacity(t){this.model.styles.fontColorOpacity=k.clamp(t,0,100)}setTextAlign(t){this.model.styles.textAlign=t}setTextVerticalAlign(t){this.model.styles.textVerticalAlign=t}setTextBaseline(t){this.model.styles.textBaseline=t}setTextDecoration(t){this.model.styles.textDecoration=t}setTextDecorationColor(t){this.model.styles.textDecorationColor=t}setTextDecorationOpacity(t){this.model.styles.textDecorationOpacity=k.clamp(t,0,100)}setTextDecorationThickness(t){this.model.styles.textDecorationThickness=t}setParagraphSpacing(t){this.model.styles.paragraphSpacing=t}setRatioLocked(t){this.model.isRatioLocked=t,t?this.model.ratio=this.model.width/this.model.height:this.model.ratio=null}rotateBy(t,e){const s=d.rotateWithCenter(this._originalCenterCoord,t,e),n={x:s.x-this._originalCenterCoord.x,y:s.y-this._originalCenterCoord.y},r=this._originalCoords.map(a=>d.translate(a,n)),o=this._originalBoxCoords.map(a=>d.translate(a,n));this.model.coords=d.batchPrecisePoint(r,1),this.model.boxCoords=d.batchPrecisePoint(o,1),this.model.angle=d.mirrorAngle(d.normalizeAngle(this._originalAngle)+d.normalizeAngle(t)%360)}getActiveController(){return this.controllers.find(t=>t.isActive)}setControllersActive(t,e){t.forEach(s=>s.isActive=e)}getControllerByCoord(t){return this.controllers.find(e=>e.isCoordHitting(t))}refreshOriginalAngle(){this._originalAngle=this.model.angle}async toJson(){return JSON.parse(JSON.stringify({...this.model,...this.flip}))}fromJson(t){this.model=JSON.parse(JSON.stringify(t))}_toOriginalCommonJson(){const{id:t,_originalCoords:e,_originalBoxCoords:s,_originalCenterCoord:{x:n,y:r}}=this;return{id:t,coords:e,boxCoords:s,x:n,y:r}}async toOriginalTranslateJson(){const t=this._toOriginalCommonJson();return JSON.parse(JSON.stringify(t))}async toTranslateJson(){return JSON.parse(JSON.stringify(k.pick(this.model,[...xs])))}async toOriginalRotateJson(){const t=this._toOriginalCommonJson();return t.angle=this._originalAngle,JSON.parse(JSON.stringify(t))}async toRotateJson(){return JSON.parse(JSON.stringify(k.pick(this.model,[...xs,"angle"])))}async toOriginalTransformJson(){const t=this._toOriginalCommonJson();return t.width=this._originalSize.width,t.height=this._originalSize.height,t.angle=this._originalAngle,JSON.parse(JSON.stringify(t))}async toTransformJson(){return JSON.parse(JSON.stringify(k.pick(this.model,[...xs,"width","height","angle"])))}async toOriginalCornerJson(){const{id:t,_originalCorners:e}=this;return JSON.parse(JSON.stringify({id:t,corners:e}))}async toCornerJson(){return JSON.parse(JSON.stringify(k.pick(this.model,["id","corners"])))}async toStrokesJson(){return JSON.parse(JSON.stringify(k.pick(this.model,["id","styles.strokes"])))}async toFillsJson(){return JSON.parse(JSON.stringify(k.pick(this.model,["id","styles.fills"])))}async toGroupJson(){return JSON.parse(JSON.stringify(k.pick(this.model,["id","groupId"])))}async toFontStyleJson(){return JSON.parse(JSON.stringify(k.pick(this.model,["id","styles.fontStyler","styles.fontSize","styles.fontFamily","styles.fontColor","styles.fontColorOpacity","styles.textAlign","styles.textVerticalAlign","styles.textBaseline","styles.fontLineHeight","styles.fontLineHeightFactor","styles.fontLineHeightAutoFit","styles.fontLetterSpacing","styles.textDecoration","styles.textDecorationColor","styles.textDecorationOpacity","styles.textDecorationThickness","styles.paragraphSpacing"])))}};class Xt extends Xs{}class Js extends Ct{constructor(){super(...arguments);g(this,"_cornerControllers",[]);g(this,"_cornerCoords",[]);g(this,"_originalCornerCoords",[]);g(this,"_originalAllCornerEqual",!1);g(this,"_arcCoords",[]);g(this,"_arcFillCoords",[]);g(this,"_originalArcCoords",[]);g(this,"_originalArcFillCoords",[])}get cornersInputEnable(){return this.status===Q.finished}get cornersEnable(){return!0}get cornerControllers(){return this._cornerControllers}get normalizeCorners(){return this._normalizeCorners()}get cornerCoords(){return this._cornerCoords}get visualCorners(){return this.normalizeCorners.map(e=>this._getCorner(e))}get editingEnable(){return!1}get controllers(){const e=super.controllers;return this.cornersEnable&&e.push(...this.cornerControllers),e}get isAllCornerEqual(){return k.uniq(this.model.corners).length===1}get arcCoords(){return this._arcCoords}get arcFillCoords(){return this._arcFillCoords}calcArcCoords(){return this.model.styles.strokes.map(e=>this._getArcVerticalCoords(e))}calcArcFillCoords(){const e=this.innermostStrokeCoordIndex;let s=this.model.styles.strokes[e],{width:n,type:r}=s;switch(r){case ae.inside:{n=n*2;break}case ae.middle:{n=n;break}case ae.outside:{n=0;break}}return s={...s,type:ae.inside,width:n},this._getArcVerticalCoords(s)}_getArcBoxCoords(e){const{type:s,width:n}=e;let r=this.calcUnLeanBoxCoords();const{width:o,height:a}=O.calcRectangleSize(r);let l=1,c=1;switch(s){case ae.outside:{l=(o+n)/o,c=(a+n)/a;break}case ae.inside:{l=(o-n)/o,c=(a-n)/a;break}}return[ae.inside,ae.outside].includes(s)&&(r=d.batchScaleWithCenter(r,{sx:l,sy:c},this.centerCoord)),r}_getArcCorner(e,s){let n=this.normalizeCorners;const{type:r,width:o}=s,{width:a,height:l}=d.calcParallelogramVerticalSize(e),c=Math.min(a,l);return n=n.map(h=>{if(h===0)return h;switch(r){case ae.inside:return k.clamp(h-o/2,0,c/2);case ae.outside:return k.clamp(h+o/2,0,c/2);default:return h}}),n}_getVerticalIntersection(e,s){return{coords:d.calcParallelogramVerticalIntersectionPoints(e,s,!0),indexes:[[0,1],[1,2],[2,3],[3,0]]}}_getCrossPointsOfParallelLines(e,s){return{coords:d.calcCrossPointsOfParallelLines(e,s),indexes:[[3,0],[0,1],[1,2],[2,3]]}}_getArcVerticalCoords(e){let s=this.calcUnLeanBoxCoords();s=this._getArcBoxCoords(e);const n=this._getArcCorner(s,e),r=[];return k.range(4).forEach(o=>{const a=s[o],l=n[o],c=this.calcUnLeanCornerCoordBy(a,o,l);let h=s[o],u,f;if(!l)u=s[o],f=s[o];else{const{coords:m,indexes:C}=this._getVerticalIntersection(c,s);u=m[C[o][0]],f=m[C[o][1]],u||(u=s[o]),f||(f=s[o])}r.push({start:u,controller:h,end:f,value:l,corner:c})}),r}calcUnLeanCornerCoord(e,s){const n=s?this.normalizeCorners[e]:this.visualCorners[e],r=d.leanWithCenter(this.model.boxCoords[e],this.model.leanXAngle,-this.model.leanYAngle,this.centerCoord);return this.calcUnLeanCornerCoordBy(r,e,n)}calcUnLeanCornerCoordBy(e,s,n){if(n===0)return e;let r,o;return[0,3].includes(s)?r=this.flipX?-n:n:r=this.flipX?n:-n,[0,1].includes(s)?o=n:o=-n,d.translate(e,{x:r,y:o})}calcCornerCoord(e,s){const n=this._rotateBoxCoords[e],r=this.visualCorners[e];let o=this.calcUnLeanCornerCoord(e,s);o=d.transWithCenter(o,this.angles,this.centerCoord);const{coords:a,indexes:l}=this._getCrossPointsOfParallelLines(o,this._rotateBoxCoords);let c=a[l[e][0]],h=a[l[e][1]];if(!c||!h)return n;let u=d.calcTriangleAngleWithClockwise(c,n,h);const f=this.flipX;f&&(u=180-u);const m=d.calcAngle(n,h)+(f?-u/2:u/2),C=this._getCornerTargetCoord(e,this._rotateBoxCoords),y=d.calcDistance(n,C)*2,w=r/this.minParallelogramVerticalSize,L=y*w;return d.calcTargetPoint(n,L,m)}refreshCornersController(e){if(this._cornerCoords.length===0)return;const{x:s,y:n}=this._cornerCoords[e],r=this.getController4BoxCoords(this._cornerCoords[e]);this._cornerControllers[e]?(this._cornerControllers[e].x=s,this._cornerControllers[e].y=n,this._cornerControllers[e].points=r):this._cornerControllers[e]=new Xt(this,{x:s,y:n,points:r})}refreshCornerCoords(e){!this._rotateBoxCoords||!this._rotateBoxCoords.length||(this._cornerCoords[e]=this.calcCornerCoord(e))}refreshCornersCoords(e){e=e||[0,1,2,3],e.forEach(s=>{this.refreshCornerCoords(s)})}refreshCornersControllers(e){e=e||[0,1,2,3],e.forEach(s=>{this.refreshCornersController(s)})}_refreshCorners(){this.status===Q.finished&&(this.refreshCornersCoords(),this.refreshCornersControllers())}refreshCorners(){super.refreshCorners(),this.isInMultiSelected||this._refreshCorners()}refreshStrokePoints(){super.refreshStrokePoints(),this._arcCoords=this.calcArcCoords(),this._arcFillCoords=this.calcArcFillCoords()}_getCorner(e){return this._isCornerMoving?e:e===0?this.minParallelogramVerticalSize/2*.2:e}refreshOriginalElementProps(){super.refreshOriginalElementProps(),this._originalCornerCoords=W.jsonClone(this._cornerCoords),this._originalAllCornerEqual=this.isAllCornerEqual}refreshOriginalStrokes(){super.refreshOriginalStrokes(),this._originalArcCoords=W.jsonClone(this._arcCoords),this._originalArcFillCoords=W.jsonClone(this._arcFillCoords)}_getCornerTargetCoord(e,s){let n,[r,o]=d.calculateAngleBisectorIntersection(s);const{width:a,height:l}=d.calcParallelogramVerticalSize(s);return a<=l?[0,1].includes(e)?n=r:n=o:[0,3].includes(e)?n=r:n=o,n}updateCornerByOffset(e){const s=this.getActiveController();if(s instanceof Xt){const n=this.cornerControllers.indexOf(s);if(n!==-1){const r=this._getCornerTargetCoord(n,this._rotateBoxCoords),o=this._originalCornerCoords[n],a={x:e.x+o.x,y:e.y+o.y},l=this._rotateBoxCoords[n],c=d.calcProjectionOnSegment(a,r,l);let h=d.calcSegmentProportion(c,r,l);h=k.clamp(h,0,1),h=1-h;let u=h*(this.minParallelogramVerticalSize/2);this._originalAllCornerEqual?this.setCorners(u):this.setCorners(u,n)}}}_normalizeCorners(){const e=[...this.model.corners];return k.every(e,s=>s===0)?e:F.fixCornersBasedOnMinSize(e,this.minParallelogramVerticalSize)}_translateArc(e){this._arcCoords=d.batchTranslateArcPoints(this._originalArcCoords,e),this._arcFillCoords=d.translateArcPoints(this._originalArcFillCoords,e)}translateBy(e){this._translateArc(e),super.translateBy(e)}_setIsSelected(e){super._setIsSelected(e),e&&this._refreshCorners()}}class Go extends Ct{constructor(){super(...arguments);g(this,"_outerCoords",[]);g(this,"_originalOuterCoords",[])}get editingEnable(){return!1}get flipXEnable(){return!1}get flipYEnable(){return!1}get coordTransformEnable(){return!0}get boxVerticesTransformEnable(){return!1}get heightInputEnable(){return!1}get rotationEnable(){return!1}get borderTransformEnable(){return!1}get fillEnable(){return!1}get fillInputEnable(){return!1}get ratioLockedEnable(){return!1}get viewAngleCalcEnable(){return!1}get leanYAngleCalcEnable(){return!1}get leanYAngleInputEnable(){return!1}get startRotateCoord(){return this._rotateCoords[0]}get endRotateCoord(){return this._rotateCoords[1]}get outerCoords(){return this._outerCoords}get transformerType(){return nt.circle}get alignOutlineCoords(){return this._outerCoords}refreshBentOutline(){this._outerCoords=this.calcOuterCoords(),this._maxOutlineBoxCoords=O.getBoxByPoints(this._outerCoords.flat())}refreshPoints(){super.refreshPoints(),this.refreshBentOutline()}calcOuterCoords(){return this.model.styles.strokes.map(e=>Me.calcBentLineOuterVertices(this._rotateCoords,e.width/2))}refreshOutlinePoints(){super.refreshOutlinePoints(),this.refreshBentOutline()}getAngle(){return this.startRotateCoord&&this.endRotateCoord?F.fixAngle(d.calcAngle(this.startRotateCoord,this.endRotateCoord)+90):0}isContainsCoord(e){return k.some(this.model.styles.strokes,s=>d.isPointClosestSegment(e,this.startRotateCoord,this.endRotateCoord,Hi+s.width/2/this.shield.stageScale))}isPolygonOverlap(e){return k.some(this._outerCoords,s=>d.isPolygonsOverlap(s,e))}isModelPolygonOverlap(e){return k.some(this._outerCoords,s=>d.isPolygonsOverlap(s,e))}doVerticesTransform(e){const s=this._transformers.findIndex(n=>n.isActive);if(s!==-1){const n=this._originalTransformerCoords[O.getNextIndexOfArray(2,s,1)],r=this._originalTransformerCoords[s];this.transformByLockPoint(n,r,e,s)}}setWidth(e){const s=d.calcTargetPoint(this.startRotateCoord,e,this.angle-90);return this.model.coords=[this.startRotateCoord,s],this.model.boxCoords=O.getBoxByPoints(this.model.coords),this.model.width=e,this.model.angle=0,[[]]}setAngle(e){const s=d.calcTargetPoint(this.startRotateCoord,this.model.width,e-90);this.model.coords=[this.startRotateCoord,s],this.model.boxCoords=O.getBoxByPoints(this.model.coords),this.model.angle=0}translateBy(e){this._outerCoords=this._originalOuterCoords.map(s=>d.batchTranslate(s,e)),super.translateBy(e)}refreshOriginalStrokes(){super.refreshOriginalStrokes(),this._originalOuterCoords=W.jsonClone(this._outerCoords)}}class $o extends Ne{async run(){if(!this.canvas||!this.element)return;const{strokeCoords:t,model:{styles:e}}=this.element;F.batchCalcStageRelativePoints(t).forEach((n,r)=>{Y.drawPathWithScale(this.canvas,n,e.fills[0],e.strokes[r])})}}class Sn extends Js{get fillEnable(){return!1}get fillInputEnable(){return!1}async toJson(){const t=await super.toJson(),e=this.model.data;if(e instanceof HTMLImageElement){const s=await Y.getDataUrlFromImage(e);t.data=s}else t.data=e;return t}}class Yo extends Ne{async run(){if(!this.canvas||!this.element)return;const{arcCoords:t,arcFillCoords:e,model:{styles:s},angle:n,flipX:r,leanY:o,actualAngle:a}=this.element,l=F.batchCalcStageRelativeArcPoints(t),c=F.calcStageRelativeArcPoints(e),h={angle:n,flipX:r,leanY:o,actualAngle:a},u=xe.calcElementRenderRect(this.element);Y.drawImgLike(this.canvas,this.element.model.data,u,{...h,clipArcPoints:c}),l.forEach((f,m)=>{Y.drawArcPathStrokeWidthScale(this.canvas,f,u,s.strokes[m],h)})}}class Xo extends Ne{async run(){if(!this.canvas||!this.element)return;let{innermostStrokeCoordIndex:t,strokeCoords:e,model:{styles:s,isFold:n}}=this.element;const r=F.batchCalcStageRelativePoints(e);n&&s.fills.forEach(o=>{Y.drawInnerPathFillWithScale(this.canvas,r[t],o,s.strokes[t])}),r.forEach((o,a)=>{Y.drawPathStrokeWidthScale(this.canvas,o,s.strokes[a],{isFold:n,miterLimit:Zi})})}}class qo extends Ct{constructor(e,s){super(e,s);g(this,"tailCoordIndex");g(this,"editingCoordIndex");g(this,"_outerWorldPaths",[]);g(this,"_originalOuterWorldPaths",[]);this.tailCoordIndex=-1}get transformerType(){return nt.circle}get coordTransformEnable(){return this.status!==Q.finished}get activeCoordIndex(){return[Q.startCreating,Q.creating,Q.initialed].includes(this.status)?this.model.coords.length>this.tailCoordIndex+1?this.tailCoordIndex+1:this.tailCoordIndex:-1}get outerWorldPaths(){return this._outerWorldPaths}get tfRefreshAfterEdChanged(){return!0}_setStatus(e){super._setStatus(e),e===Q.finished&&(this.tailCoordIndex=-1)}calcOuterWorldPaths(){return this._strokeCoords.map((e,s)=>F.calcArbitraryBorderRegions(e,this.model.styles.strokes[s],this.model.isFold))}refreshOutlinePoints(){this._outerWorldPaths=this.calcOuterWorldPaths(),super.refreshOutlinePoints()}refreshOriginalStrokes(){super.refreshOriginalStrokes(),this._originalOuterWorldPaths=W.jsonClone(this._outerWorldPaths)}isContainsCoord(e){let s;return this.visualStrokeWidth<un?s=this._strokeCoords.map(n=>F.calcArbitraryBorderRegions(n,{width:un/this.shield.stageScale},this.model.isFold)):s=this._outerWorldPaths,k.some(s,n=>k.some(n,r=>d.isPointInPolygonByRayCasting(e,r)))}isPolygonOverlap(e){return k.some(this._outerWorldPaths,s=>k.some(s,n=>d.isPolygonsOverlap(n,e)))}isModelPolygonOverlap(e){return k.some(this._outerWorldPaths,s=>k.some(s,n=>d.isPolygonsOverlap(n,e)))}calcRotateOutlineCoords(){return this._outerWorldPaths.flat()}activeEditingCoord(e){this.editingCoordIndex=e}deActiveEditingCoord(){this.editingCoordIndex=-1}setControllersActive(e,s){super.setControllersActive(e,s),e.forEach(n=>{if(n instanceof ft){const r=this._transformers.findIndex(o=>o.id===n.id);if(r===-1)return;s?this.activeEditingCoord(r):this.deActiveEditingCoord()}})}doVerticesTransform(e){this.status===Q.editing?this.doEditingTransform(e):super.doVerticesTransform(e)}doEditingTransform(e){if(this.editingCoordIndex!==-1){const s=W.jsonClone(this._originalRotateCoords);s[this.editingCoordIndex]={x:s[this.editingCoordIndex].x+e.x,y:s[this.editingCoordIndex].y+e.y};const n=this._originalRotateBoxCoords[0];this.model.coords=d.batchPrecisePoint(F.calcCoordsByTransPoints(s,this.angles,n),1);let r=d.batchPrecisePoint(d.batchLeanWithCenter(O.getBoxByPoints(d.calcUnLeanByPoints(this.model.coords,0,this.model.leanYAngle)),0,this.model.leanYAngle,this.calcCenterCoord()),1);this._flipX&&(r=d.batchCalcSymmetryPoints(r,d.calcPolygonCentroid([r[0],r[1]]),d.calcPolygonCentroid([r[2],r[3]]))),this.model.boxCoords=r}}_translateOuterCoords(e){this._outerWorldPaths=this._originalOuterWorldPaths.map((s,n)=>s.map(r=>r.map(o=>d.translate(o,e))))}translateBy(e){this._translateOuterCoords(e),super.translateBy(e)}}class Ks extends Ct{get subs(){return this.getSubs()}get deepSubs(){return this.getDeepSubs()}get strokeEnable(){return!1}get strokeInputEnable(){return!1}get fillEnable(){return!1}get fillInputEnable(){return!1}get editingEnable(){return!1}get alignOutlineCoords(){return[O.getBoxByPoints(this.subs.map(t=>t.alignOutlineCoords.flat()).flat())]}addSub(t){this.model.subIds.push(t.id)}removeSub(t){const e=this.model.subIds.indexOf(t.id);e!==-1&&this.model.subIds.splice(e,1)}removeSubById(t){const e=this.model.subIds.indexOf(t);e!==-1&&this.model.subIds.splice(e,1)}hasSub(t){var e;return(e=this.model.subIds)==null?void 0:e.includes(t.id)}hasSubById(t){var e;return(e=this.model.subIds)==null?void 0:e.includes(t)}getSubs(){return this.shield.store.getElementsByIds(this.model.subIds)}getDeepSubs(){const t=[];return this._getDeepSubs(t,this.getSubs()),t}_getDeepSubs(t,e){return e.forEach(s=>{t.push(s),s.isGroup&&this._getDeepSubs(t,s.subs)}),t}getSubElementsByType(t){return this.getSubs().filter(e=>e.isElement&&e.model.type===t)}getAllSubElements(){return this.getSubs().filter(t=>t.isElement)}getAllSubElementGroups(){return this.getSubs().filter(t=>t.isGroup)}clearSubs(){this.model.subIds=[]}isContainsCoord(t){return this.deepSubs.some(e=>e.isContainsCoord(t))}isPolygonOverlap(t){return this.deepSubs.some(e=>e.isPolygonOverlap(t))}isModelPolygonOverlap(t){return this.deepSubs.some(e=>e.isModelPolygonOverlap(t))}_setIsSelected(t){super._setIsSelected(t),this.deepSubs.forEach(e=>{e.isSelected=t})}calcRotateOutlineCoords(){return[this._rotateCoords]}}var qt=(i=>(i[i.START=0]="START",i[i.END=1]="END",i))(qt||{}),ee=(i=>(i.NONE="none",i.INPUT="input",i.DELETE_SELECTION="delete_selection",i.DELETE_PREV="delete_prev",i.INSERT_NEWLINE="insert_newline",i.SELECT_ALL="select_all",i.COPY_SELECTION="copy_selection",i.CUT_SELECTION="cut_selection",i.PASTE_TEXT="paste_text",i.UNDO="undo",i.REDO="redo",i.MOVE_CURSOR="move_cursor",i.MOVE_SELECTION="move_selection",i))(ee||{}),ht=(i=>(i.PRESS_DOWN="press_down",i.PRESS_MOVE="press_move",i.PRESS_UP="press_up",i))(ht||{});function ct(i,t,e){const{id:s,x:n,y:r,height:o,width:a}=i;return{nodeId:s,pos:t,lineNumber:e,x:n+(t===V.RIGHT?a:0),y:r,width:rr,height:o}}function Ot(i,t){const{x:e,y:s,height:n}=i;return{lineNumber:t,x:e,y:s,width:rr,height:n}}function vn(i,t){const{nodes:e}=i,s=e[e.length-1];return s?ct(s,V.RIGHT,t):Ot(i,t)}class v{static createTextNode(t,e){return{id:Xe(),content:t,fontStyle:e}}static createTextLines(t,e){const s=[];return t.split(`
`).forEach(n=>{const r=n.split("").map(o=>v.createTextNode(o,{...e}));s.push({nodes:r,isTailBreak:!0,fontStyle:{...e}})}),s}static createTextData(t,e){return e=k.pick(e,["fontFamily","fontStyler","fontSize","fontColor","fontColorOpacity","fontLetterSpacing","textDecoration","textDecorationColor","textDecorationOpacity","textDecorationThickness"]),{lines:this.createTextLines(t,e)}}static getTextCursorAtPosition(t,e,s){const n={},{lines:r}=t;let o,a=-1;for(let l=0;l<r.length;l++){const c=r[l];if(O.isPointInRect(c,e)){o=c,a=l;break}}if(o){n.lineNumber=a;for(let l=0;l<o.nodes.length;l++){let c=o.nodes[l];if(O.isPointInRect(c,e)){let h=V.LEFT;e.x>=c.x+c.width/2?h=V.RIGHT:l>0&&(c=o.nodes[l-1],h=V.RIGHT),Object.assign(n,ct(c,h,a));break}}n.nodeId||(s==="right"||s==="center"&&e.x<=o.renderX?Object.assign(n,this.getCursorOfLineStart(o,a)):Object.assign(n,vn(o,a)))}else a=r.length-1,n.lineNumber=a,Object.assign(n,vn(r[a],a));return n}static getCursorOfLineEnd(t,e){const{nodes:s}=t;let n;if(s.length>0){const r=s[s.length-1];n=ct(r,V.RIGHT,e)}else n=Ot(t,e);return n.lineNumber=e,n}static getCursorOfLineStart(t,e){let s;return t.nodes.length===0?s=Ot(t,e):s=ct(t.nodes[0],V.LEFT,e),s.lineNumber=e,s}static getCursorOfLineHead(t,e){const s=Ot(t,e);return s.lineNumber=e,s}static getCursorOfNode(t,e,s){const n=ct(t,e,s);return n.lineNumber=s,n}static getLineByNodeId(t,e){const{lines:s}=t;return s.findIndex(n=>n.nodes.some(r=>r.id===e))}static getUpdatedCursorPropsOfLine(t,e,s,n){if(!t)return;const{nodeId:r}=s;let o;return r&&(o=t.nodes.find(a=>a.id===r)),o?ct(o,n,e):Ot(t,e)}static getUpdatedCursorProps(t,e){let{pos:s,nodeId:n,lineNumber:r}=e;if(n&&(r=v.getLineByNodeId(t,n)),r!==-1)return v.getUpdatedCursorPropsOfLine(t.lines[r],r,e,s)}static isTextSelectionAvailable(t){if(!t)return!1;const{startCursor:e,endCursor:s}=t;if(!e||!s)return!1;const{lineNumber:n,nodeId:r,pos:o}=e,{lineNumber:a,nodeId:l,pos:c}=s;return n!==a||r!==l||o!==c}static getTextNodeById(t,e){const{lines:s}=t;for(let n=0;n<s.length;n++){const o=s[n].nodes.find(a=>a.id===e);if(o)return o}}static getTextNodeIndex(t,e){const{lines:s}=t;for(let n=0;n<s.length;n++){const r=s[n],o=v.getTextNodeIndexOfLine(r,e);if(o!==-1)return o}return-1}static getTextNodeIndexOfLine(t,e){return t.nodes.findIndex(s=>s.id===e)}static sortCursors(t,e){return[...e].sort((n,r)=>n.lineNumber!==r.lineNumber?n.lineNumber-r.lineNumber:n.nodeId!==r.nodeId?v.getTextNodeIndex(t,n.nodeId)-v.getTextNodeIndex(t,r.nodeId):n.pos-r.pos)}static isCursorAtSamePosition(t,e,s){if(v.isCursorEqual(t,e))return!0;if(!t&&e||!e&&t)return!1;if(s){const{nodeId:n,lineNumber:r,pos:o}=t,{nodeId:a,lineNumber:l,pos:c}=e;if(r===l){const h=v.getTextNodeIndexOfLine(s.lines[r],n),u=v.getTextNodeIndexOfLine(s.lines[l],a);if(h!==-1&&u!==-1&&(h+1===u&&o===V.RIGHT&&c===V.LEFT||h-1===u&&o===V.LEFT&&c===V.RIGHT))return!0}}return!1}static isCursorEqual(t,e){return!!t&&!!e&&t.lineNumber===e.lineNumber&&t.nodeId===e.nodeId&&t.pos===e.pos}static isSelectionEqualWithStart(t,e,s){return!!t&&!!e&&!!t.startCursor&&!!e.startCursor&&v.isCursorAtSamePosition(t.startCursor,e.startCursor,s)}static getTextFromTextData(t){return t.lines.map(e=>e.nodes.map(s=>s.content).join("")).join(`
`)}static newFontStyleSet(){return{fontFamilies:new Set,fontStylers:new Set,fontSizes:new Set,fontColors:new Set,fontColorOpacities:new Set,fontLetterSpacings:new Set,textDecorations:new Set,textDecorationColors:new Set,textDecorationOpacities:new Set,textDecorationThicknesses:new Set}}static cacheStyleSet(t,e){t&&(k.isString(t.fontFamily)&&e.fontFamilies.add(t.fontFamily),k.isString(t.fontStyler)&&e.fontStylers.add(t.fontStyler),k.isNumber(t.fontSize)&&e.fontSizes.add(t.fontSize),k.isString(t.fontColor)&&e.fontColors.add(t.fontColor),k.isNumber(t.fontColorOpacity)&&e.fontColorOpacities.add(t.fontColorOpacity),k.isNumber(t.fontLetterSpacing)&&e.fontLetterSpacings.add(t.fontLetterSpacing),k.isString(t.textDecoration)&&e.textDecorations.add(t.textDecoration),k.isString(t.textDecorationColor)&&e.textDecorationColors.add(t.textDecorationColor),k.isNumber(t.textDecorationOpacity)&&e.textDecorationOpacities.add(t.textDecorationOpacity),k.isNumber(t.textDecorationThickness)&&e.textDecorationThicknesses.add(t.textDecorationThickness))}static cacheStyleSetOfNode(t,e){const{fontStyle:s}=t;v.cacheStyleSet(s,e)}static getStyleSetOfNode(t){const e=v.newFontStyleSet();return v.cacheStyleSetOfNode(t,e),e}static getStyleSetOfNodes(t){const e=v.newFontStyleSet();for(let s=0;s<t.length;s++)v.cacheStyleSetOfNode(t[s],e);return e}static getStyleSetOfTextData(t,e){const s=v.newFontStyleSet();return t.lines.forEach(n=>{n.nodes.forEach(r=>{(!e||e&&r.selected)&&v.cacheStyleSetOfNode(r,s)})}),s}static getReferByCursor(t,e){const{lineNumber:s,nodeId:n,pos:r}=t,o=e.lines[s];if(!n)return o;const a=o.nodes.findIndex(l=>l.id===n);if(a!==-1){const l=o.nodes[a];return a===0||r===V.RIGHT?l:o.nodes[a-1]}return o}static getReferFontStyleByCursor(t,e){const s=v.getReferByCursor(t,e);if(s)return s.fontStyle}static getStyleSetByCursor(t,e){const s=v.getReferFontStyleByCursor(t,e),n=v.newFontStyleSet();return v.cacheStyleSet(s,n),n}static markTextUnselected(t){t.lines.forEach(e=>{e.nodes.forEach(s=>{s.selected=!1}),e.selected=!1})}static setLineSelectedIfy(t){k.every(t.nodes,e=>e.selected)&&(t.selected=!0)}static setNodeSelected(t,e,s){if(e<=s)for(let n=e;n<=s;n++)t.nodes[n].selected=!0;else for(let n=e;n>=s;n--)t.nodes[n].selected=!0}static rightSelectOfLine(t,e,s){let n=-1;if(e){if(n=t.nodes.findIndex(r=>r.id===e),s===V.RIGHT){if(n===t.nodes.length-1)return;n++}}else n=0;v.setNodeSelected(t,n,t.nodes.length-1)}static leftSelectOfLine(t,e,s){let n=-1;if(e){if(n=t.nodes.findIndex(r=>r.id===e),s===V.LEFT){if(n===0)return;n--}}else n=0;v.setNodeSelected(t,0,n)}static partialSelectOfLine(t,e,s,n,r){let o=-1;e?o=t.nodes.findIndex(l=>l.id===e):o=0;let a=t.nodes.findIndex(l=>l.id===n);o<a?(s===V.RIGHT&&o++,r===V.LEFT&&a--):o>a&&(s===V.LEFT&&o--,r===V.RIGHT&&a++),v.setNodeSelected(t,o,a)}static markTextSelected(t,e){const{lines:s}=t;let{startCursor:n,endCursor:r}=e;const{lineNumber:o,nodeId:a,pos:l}=n,{lineNumber:c,nodeId:h,pos:u}=r;if(o===c)v.partialSelectOfLine(s[o],a,l,h,u),v.setLineSelectedIfy(s[o]);else if(o<c)for(let f=o;f<=c;f++){const m=s[f];m.nodes.length===0?m.selected=!0:(f===o?v.rightSelectOfLine(m,a,l):f===c?v.leftSelectOfLine(m,h,u):v.setNodeSelected(m,0,m.nodes.length-1),v.setLineSelectedIfy(m))}else for(let f=o;f>=c;f--){const m=s[f];m.nodes.length===0?m.selected=!0:(f===o?v.leftSelectOfLine(m,a,l):f===c?v.rightSelectOfLine(m,h,u):v.setNodeSelected(m,0,m.nodes.length-1),v.setLineSelectedIfy(m))}}static margeNodesOfLine(t,e,s){const n=t.lines[s],r=t.lines[e];n.nodes=n.nodes.filter(o=>!o.selected),r.nodes=r.nodes.filter(o=>!o.selected),r.nodes.push(...n.nodes),t.lines.splice(s,1)}static deleteSelectedNodesOfLine(t){t.nodes=t.nodes.filter(e=>!e.selected)}static getTailNodeOfLine(t,e){if(0<=e&&e<t.lines.length){const s=t.lines[e];return s.nodes[s.nodes.length-1]}return null}static getTailNodeOfLineIfNotBreak(t,e){if(0<=e&&e<t.lines.length){const s=t.lines[e];return s.isTailBreak?null:s.nodes[s.nodes.length-1]}return null}static getAnchorNodeByCursor(t,e){const{lineNumber:s,nodeId:n,pos:r}=e;let o,a=s,l=!1;if(n){const c=t.lines[s],h=c.nodes.findIndex(u=>u.id===n);o=c.nodes[h],r===V.LEFT&&(h>0?o=c.nodes[h-1]:l=!0)}else l=!0;return{textNode:o,lineNumber:a,isHead:l}}static getClosestNodeCursorOfLine(t,e,s){if(e.lineNumber===s)return e;if(t.nodes.length>0){let n;for(let r=0;r<t.nodes.length;r++){const o=t.nodes[r];o.x+o.width<=e.x&&(n=o)}if(n)return v.getCursorOfNode(n,V.RIGHT,s)}return v.getCursorOfLineStart(t,s)}static getClosestNodeCursor(t,e,s){const{lines:n}=t,{lineNumber:r}=e;if(s===V.TOP){if(r>0)return v.getClosestNodeCursorOfLine(n[r-1],e,r-1)}else if(r<n.length-1)return v.getClosestNodeCursorOfLine(n[r+1],e,r+1);return e}static getFontStyleOfModel(t){return k.pick(t.styles,["fontSize","fontFamily","fontColor","fontColorOpacity","fontLetterSpacing"])}static getStyleByNodeIfy(t,e,s){return e&&e.fontStyle?W.jsonClone(e.fontStyle):s&&s.fontStyle?W.jsonClone(s.fontStyle):v.getFontStyleOfModel(t)}static getStyleOfLineEnd(t,e){const{nodes:s,fontStyle:n}=e;return s.length?v.getStyleByNodeIfy(t,s[s.length-1]):n?W.jsonClone(n):v.getFontStyleOfModel(t)}static pickSelectedContent(t){const{lines:e}=t,s=[];for(let n=0;n<e.length;n++){const r=e[n];if(r.selected)s.push({...r,isFull:!0});else{const o=r.nodes.filter(a=>a.selected);o.length>0&&s.push({nodes:o,isFull:!1})}}return s}static isTextNode(t){return["id","content","fontStyle"].every(e=>e in t)}static isTextLine(t){return["nodes"].every(e=>e in t)}static cloneTextNode(t){const{content:e,fontStyle:s}=t;return{id:Xe(),content:e,fontStyle:W.jsonClone(s)}}static batchCloneTextNodes(t){return t.map(v.cloneTextNode)}static cloneTextLine(t){const{nodes:e,isTailBreak:s,isFull:n,fontStyle:r}=t;return{nodes:v.batchCloneTextNodes(e),isTailBreak:s,isFull:n,fontStyle:W.jsonClone(r)}}static batchCloneTextLine(t){return t.map(v.cloneTextLine)}static parseTextLines(t){let e=[];try{const s=JSON.parse(t);Array.isArray(s)&&s.every(n=>v.isTextLine(n))&&(e=v.batchCloneTextLine(s))}catch(s){s&&console.warn(s)}return e}static reflowTextLines(t,e,s){const n=v.restoreTextLines(t);return v.calcReflowTextLines(n,e,s)}static restoreTextLines(t){if(t.length===0)return[];let e=[{nodes:[],width:0}];for(let s=0;s<t.length;s++){const n=t[s],{nodes:r,isTailBreak:o,fontStyle:a}=n,l=e[e.length-1];l.nodes.push(...r),l.isTailBreak=o,o&&(l.fontStyle=a),l.width+=r.reduce((c,h)=>c+h.width+h.indentX,0),o&&s<t.length-1&&e.push({nodes:[],width:0})}return e}static calcReflowTextLines(t,e,s){if(t.length===0)return[];const n=[];let r={nodes:[]},o=0;for(let a=0;a<t.length;a++){const l=t[a],{nodes:c,isTailBreak:h,fontStyle:u={}}=l;if(c.length===0){n.push({nodes:[],isTailBreak:h,fontStyle:u});continue}for(let f=0;f<c.length;f++){const m=c[f],C=(m.width+m.indentX)/s;o+C<=e?(r.nodes.push(m),o+=C):r.nodes.length===0?(n.push({nodes:[m]}),r.nodes=[],o=0):(n.push({...W.jsonClone(r),fontStyle:{...u}}),r.nodes=[m],o=C)}r.nodes.length>0&&n.push({...W.jsonClone(r),fontStyle:{...u}}),h&&(n[n.length-1].isTailBreak=h),r.nodes=[],o=0}return n}static calcMaxLineWidth(t,e){if(t.length===0)return 0;let s=0;for(let n=0;n<t.length;n++){const r=t[n],{width:o}=r;s=Math.max(s,o/e)}return s}static calcMaxLineWidthByNodes(t,e){if(t.length===0)return 0;let s=0;for(let n=0;n<t.length;n++){const r=t[n],{nodes:o}=r;s=Math.max(s,o.reduce((a,l)=>a+l.width+l.indentX,0)/e)}return s}static calcTextRenderHeight(t,e){if(t.length===0)return 0;if(t.length===1)return t[0].height/e;const s=t[0].y;return(t[t.length-1].y+t[t.length-1].height-s)/e}}class Pr{static copyValueToClipboard(t){let e=document.createElement("input");document.body.appendChild(e),e.value=t,e.select(),document.execCommand("copy"),document.body.removeChild(e),e=null}static getContentByInnerHtml(t){let e=document.createElement("div");e.innerHTML=t;const s=e.textContent;return e.remove(),e=null,s}static async readValueFromClipboard(){return new Promise(t=>{navigator.clipboard.readText().then(e=>{t(e)})})}static async writeValueToClipboard(t){return navigator.clipboard.writeText(t)}}var Ze=(i=>(i.ElementsAdded="elements_added",i.ElementsRemoved="elements_removed",i.ElementsUpdated="elements_updated",i.ElementsRearranged="elements_rearranged",i.GroupAdded="group_added",i.GroupRemoved="group_removed",i))(Ze||{}),Ut=(i=>(i.TextUpdated="text_updated",i.CursorSelectionUpdated="cursor_selection_updated",i))(Ut||{});class Or{constructor(){g(this,"undoStack",[]);g(this,"redoStack",[])}get tailUndoCommand(){return this.undoStack[this.undoStack.length-1]}get tailRedoCommand(){return this.redoStack[this.redoStack.length-1]}add(t){this.undoStack.push(t),this.redoStack=[]}clear(){this.undoStack=[],this.redoStack=[]}async undo(){if(this.undoStack.length===0)return!1;const t=this.undoStack.pop();return this.redoStack.push(t),await t.undo(),!0}async redo(){if(this.redoStack.length===0)return!1;const t=this.redoStack.pop();return this.undoStack.push(t),await t.redo(),!0}}class Uo{constructor(t,e){g(this,"payload");g(this,"element");this.payload=t,this.element=e}async undo(){throw new Error("Method not implemented.")}async redo(){throw new Error("Method not implemented.")}}class bn extends Uo{async _restoreElementsFromData(t,e){const{textData:s,textCursor:n,textSelection:r}=t;e===Ut.TextUpdated&&(this.element.model.data=s),this.element.updateTextCursors(n,r)}async undo(){const{uData:t,type:e}=this.payload;t&&await this._restoreElementsFromData(t,e)}async redo(){const{rData:t,type:e}=this.payload;t&&await this._restoreElementsFromData(t,e)}}class et extends Js{constructor(e,s){super(e,s);g(this,"_textCursor");g(this,"_textSelection");g(this,"_cursorVisibleStatus");g(this,"_cursorVisibleTimer");g(this,"_prevMarkCursor");g(this,"_prevInputCursor");g(this,"_textUpdateId");g(this,"_prevTextLinesReflowed",!1);g(this,"_undoRedo");g(this,"_undoCommandObject");g(this,"_editorOperation",ee.NONE);g(this,"_selectionMoveId");g(this,"_isSelectionMoved",!1);g(this,"_fontStyler");g(this,"_fontSize");g(this,"_fontFamily");g(this,"_fontColor");g(this,"_fontColorOpacity");g(this,"_fontLetterSpacing");g(this,"_fontStylerMixin",!1);g(this,"_fontSizeMixin",!1);g(this,"_fontFamilyMixin",!1);g(this,"_fontColorMixin",!1);g(this,"_fontColorOpacityMixin",!1);g(this,"_fontLetterSpacingMixin",!1);g(this,"_textDecoration",Ee.none);g(this,"_textDecorationMixin",!1);g(this,"_textDecorationColor");g(this,"_textDecorationOpacity");g(this,"_textDecorationThickness");g(this,"_textDecorationColorMixin",!1);g(this,"_textDecorationOpacityMixin",!1);g(this,"_textDecorationThicknessMixin",!1);this._undoRedo=new Or}get fontEnable(){return!0}get fontInputEnable(){return!0}get fontLineHeightInputEnable(){return this.status===Q.finished}get fontLineHeightFactorInputEnable(){return this.status===Q.finished}get fontLetterSpacingInputEnable(){return!0}get paragraphSpacingInputEnable(){return this.status===Q.finished}get editingEnable(){return!0}get textCursor(){return this._textCursor}get textSelection(){return this._textSelection}get isSelectionAvailable(){return v.isTextSelectionAvailable(this._textSelection)}get isCursorVisible(){return!!this._textCursor&&!this.isSelectionAvailable&&this._cursorVisibleStatus}get transformersEnable(){return this.status===Q.finished}get cornersInputEnable(){return this.status===Q.finished}get cornersEnable(){return this.status===Q.finished}get text(){return v.getTextFromTextData(this.model.data)}get fontStyler(){return this._fontStyler}get fontSize(){return this._fontSize}get fontFamily(){return this._fontFamily}get fontColor(){return this._fontColor}get fontColorOpacity(){return this._fontColorOpacity}get fontLetterSpacing(){return this._fontLetterSpacing}get fontStylerMixin(){return this._fontStylerMixin}get fontSizeMixin(){return this._fontSizeMixin}get fontFamilyMixin(){return this._fontFamilyMixin}get fontColorMixin(){return this._fontColorMixin}get fontColorOpacityMixin(){return this._fontColorOpacityMixin}get fontLetterSpacingMixin(){return this._fontLetterSpacingMixin}get textHeight(){return this._calcTextRenderHeight()}get textDecoration(){return this._textDecoration}get textDecorationMixin(){return this._textDecorationMixin}get textDecorationColor(){return this._textDecorationColor}get textDecorationOpacity(){return this._textDecorationOpacity}get textDecorationThickness(){return this._textDecorationThickness}get textDecorationColorMixin(){return this._textDecorationColorMixin}get textDecorationOpacityMixin(){return this._textDecorationOpacityMixin}get textDecorationThicknessMixin(){return this._textDecorationThicknessMixin}get paragraphSize(){return this.model.data.lines.filter(e=>e.isTailBreak).length}_setIsEditing(e){super._setIsEditing(e),this._textCursor=null,this._textSelection=null,this._cursorVisibleStatus=!1,this._undoCommandObject=null,this._editorOperation=ee.NONE,this._textUpdateId=null,this._prevInputCursor=null,this._prevTextLinesReflowed=!1,this._selectionMoveId=null,this._isSelectionMoved=!1,this._toggleCursorVisibleTimer(e),e?this._selectAll():this._undoRedo.clear(),this._markSelection(),this._checkFontStyleChangedByCursor()}_setIsSelected(e){super._setIsSelected(e),e&&this._updateFontStyleByTextData(!1,!1,!0)}_toggleCursorVisibleTimer(e){e?this._startCursorVisibleTimer():this._clearCursorVisibleTimer()}_startCursorVisibleTimer(){this._cursorVisibleTimer||(this._cursorVisibleTimer=setInterval(()=>{this._cursorVisibleStatus=!this._cursorVisibleStatus},400))}_clearCursorVisibleTimer(){this._cursorVisibleTimer&&(clearInterval(this._cursorVisibleTimer),this._cursorVisibleTimer=null)}_updateCursor(e){if(!e)return;const s=v.getUpdatedCursorProps(this.model.data,e);s&&Object.assign(e,s)}onStageChanged(){super.onStageChanged(),this.refreshTextCursors()}onFontFamilyChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onFontFamilyChanged()}onFontStylerChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onFontStylerChanged()}onFontSizeChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onFontSizeChanged()}onFontColorChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onFontColorChanged()}onFontColorOpacityChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onFontColorOpacityChanged()}onTextDecorationChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onTextDecorationChanged()}onTextDecorationColorChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onTextDecorationColorChanged()}onTextDecorationOpacityChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onTextDecorationOpacityChanged()}onTextDecorationThicknessChanged(){this._updateFontStyleByTextData(this.isSelectionAvailable,!1,!0),super.onTextDecorationThicknessChanged()}refreshTextCursorAtPosition(e,s){var a;this._isSelectionMoved=s||!1,s||(this._undoCommandObject=this._getTextEditorCommandObject({dataExclude:!0}),this._selectionMoveId=null);const n=xe.calcElementRenderRect(this),r=xe.convertCoordInRect(e,this,n),o=v.getTextCursorAtPosition(this.model.data,r,this.textAlign);o&&(s?(v.isCursorAtSamePosition(this._textSelection.startCursor,o,this.model.data)?this._textSelection.endCursor=null:this._textSelection.endCursor=o,this._cursorVisibleStatus=!1,this._editorOperation=ee.MOVE_SELECTION,this._selectionMoveId||(this._selectionMoveId=Xe(),this._undoCommandObject=this._getTextEditorCommandObject({dataExclude:!0}))):(this._textCursor=o,this._textSelection={startCursor:o,endCursor:null},this._editorOperation=ee.MOVE_CURSOR),this._cursorVisibleStatus=!0,this._clearCursorVisibleTimer(),this._startCursorVisibleTimer(),this._prevMarkCursor=((a=this._textSelection)==null?void 0:a.endCursor)||this._textCursor),this._markSelection(),this._checkFontStyleChangedByCursor(),this._prevInputCursor=null,this._addCursorUpdateCommand()}refreshTextCursors(){var e;this.isEditing&&(this._updateCursor(this._textCursor),this._updateCursor((e=this._textSelection)==null?void 0:e.endCursor))}updateTextCursors(e,s){this._textCursor=e,this._textSelection=s}async updateText(e,s){if(this._isSelectionMoved)return;const n=W.jsonClone(this.model.data),{keyCode:r,ctrlKey:o,shiftKey:a,metaKey:l,altKey:c,updateId:h}=s;let u=!1,f=!1,m=!1;if(te.isArrowLeft(r))this._moveCursorTo(V.LEFT,s);else if(te.isArrowRight(r))this._moveCursorTo(V.RIGHT,s);else if(te.isArrowUp(r))this._moveCursorTo(V.TOP,s);else if(te.isArrowDown(r))this._moveCursorTo(V.BOTTOM,s);else if(te.isA(r)&&o)this._selectAll();else if(te.isC(r)&&o)this._copySelection(n);else{if(f=!0,te.isDeleterKey(r))u=this._deleteAtCursor(n,!0);else if(te.isEnter(r))u=this._insertNewLine(n);else if(te.isX(r)&&o)u=this._cutSelection(n);else if(te.isV(r)&&o)u=this._pasteText(e,n,s);else if(te.isZ(r)&&o){const C=this._undoRedo.tailUndoCommand;C&&(await this._undoRedo.undo(),this._editorOperation=ee.UNDO,[ee.MOVE_CURSOR,ee.MOVE_SELECTION].includes(C.payload.operation)||(f=!0))}else if(te.isY(r)&&o){const C=this._undoRedo.tailRedoCommand;C&&(await this._undoRedo.redo(),this._editorOperation=ee.REDO,[ee.MOVE_CURSOR,ee.MOVE_SELECTION].includes(C.payload.operation)||(f=!0))}else!a&&!l&&!c&&!o?(u=this._updateInput(n,e,s),u&&(this._editorOperation=ee.INPUT)):(f=!1,m=!0);u&&(this.model.data=n)}return m||(this._markSelection(),this._checkFontStyleChangedByCursor()),this._textUpdateId=h,{changed:u,reflow:f}}_insertNewLine(e){this._undoCommandObject=this._getTextEditorCommandObject(),this.isSelectionAvailable&&this._deleteAtCursor(e);const{lineNumber:s,nodeId:n,pos:r}=this._textCursor,o=s+1,a=e.lines[s],{isTailBreak:l}=a;let c=0;if(n&&(c=a.nodes.findIndex(h=>h.id===n),r===V.RIGHT&&c++),c<=a.nodes.length-1){const h=a.nodes[c],u=v.getStyleByNodeIfy(this.model,h,a),f=a.nodes.slice(c);Object.assign(a,{nodes:a.nodes.slice(0,c),isTailBreak:!0}),l?e.lines.splice(o,0,{nodes:f,isTailBreak:!0,fontStyle:u}):e.lines[o].nodes.splice(0,0,...f)}else e.lines.splice(o,0,{nodes:[],isTailBreak:!0,fontStyle:v.getStyleOfLineEnd(this.model,a)});return this._textCursor=v.getCursorOfLineStart(e.lines[o],o),this._textSelection={startCursor:this._textCursor,endCursor:null},this._prevMarkCursor=this._textCursor,this._prevInputCursor=null,this._editorOperation=ee.INSERT_NEWLINE,!0}_pasteText(e,s,n){if(e.length===0)return!1;this._undoCommandObject=this._getTextEditorCommandObject(),this.isSelectionAvailable&&this._deleteAtCursor(s),this._prevInputCursor=this._textCursor;const r=v.parseTextLines(e);if(r&&r.length>0)this._insertTextLines(s,r);else if(!Ls.isMultiLine(e))this._insertText(s,e,n);else{const o=this._getFontStyleAtInputCursor(),a=v.createTextLines(e,o);this._insertTextLines(s,a)}return this._editorOperation=ee.PASTE_TEXT,!0}_doSelectionCopy(e){const s=v.pickSelectedContent(e);Pr.copyValueToClipboard(JSON.stringify(s))}_copySelection(e){this.isSelectionAvailable&&(this._doSelectionCopy(e),this._editorOperation=ee.COPY_SELECTION)}_cutSelection(e){return this.isSelectionAvailable?(this._undoCommandObject=this._getTextEditorCommandObject(),this._doSelectionCopy(e),this._deleteAtCursor(e),this._editorOperation=ee.CUT_SELECTION,!0):!1}_updateInput(e,s,n){this._prevInputCursor||(this._undoCommandObject=this._getTextEditorCommandObject()),this.isSelectionAvailable&&this._deleteAtCursor(e);const{updateId:r,compositionType:o}=n;return(!this._prevInputCursor||o===Gs.END||this._textUpdateId!==r)&&(this._prevInputCursor=this._textCursor),this._textUpdateId===r&&(this._textCursor=this._prevInputCursor,this._deleteNodesByUpdateId(e,r)),this._insertText(e,s,n),this._prevMarkCursor=this._textCursor,!0}_deleteNodesByUpdateId(e,s){e.lines=e.lines.map(n=>(n.nodes.length>0&&(n.nodes=n.nodes.filter(o=>o.updateId!==s)),n))}_insertTextLines(e,s){if(s.length===0)return;let{textNode:n,lineNumber:r,isHead:o}=v.getAnchorNodeByCursor(e,this._prevInputCursor);const a=e.lines[r];let l=0;o||(l=a.nodes.findIndex(m=>m.id===n.id),l=l+1);let c=[];c=a.nodes.slice(l),c=v.batchCloneTextNodes(c),a.nodes=a.nodes.slice(0,l);const h=s[0],u=h.isFull,f=s[s.length-1].isFull;if(a.nodes.length===0?(e.lines.splice(r,1,h),h.isTailBreak=!0):u?(r++,e.lines.splice(r,0,h)):a.nodes.push(...h.nodes),delete e.lines[r].isFull,this._textCursor=v.getCursorOfLineEnd(e.lines[r],r),r++,s.length>1){const m=s.slice(1,s.length);e.lines.splice(r,0,...m);for(const C of m)delete C.isFull;r+=m.length,this._textCursor=v.getCursorOfLineEnd(e.lines[r-1],r-1)}c.length>0&&(f?e.lines.splice(r,0,{nodes:c,isTailBreak:!0}):e.lines[r-1].nodes.push(...c))}_getFontStyleAtInputCursor(){const{textNode:e,lineNumber:s}=v.getAnchorNodeByCursor(this.model.data,this._prevInputCursor),n=this.model.data.lines[s];return v.getStyleByNodeIfy(this.model,e,n)}_insertText(e,s,n){if(k.isEmpty(s))return;const{textNode:r,lineNumber:o,isHead:a}=v.getAnchorNodeByCursor(e,this._prevInputCursor),l=this._getFontStyleAtInputCursor(),c=s.split("").map(u=>{const f=v.createTextNode(u,l);return n&&n.updateId&&(f.updateId=n.updateId),f});let h=0;a||(h=e.lines[o].nodes.findIndex(u=>u.id===r.id),h=h+1),e.lines[o].nodes.splice(h,0,...c),this._textCursor=v.getCursorOfNode(c[c.length-1],V.RIGHT,o)}_selectAll(){this._undoCommandObject=this._getTextEditorCommandObject({dataExclude:!0});const e=this.model.data,s=v.getCursorOfLineHead(e.lines[0],0),n=v.getCursorOfLineEnd(e.lines[e.lines.length-1],e.lines.length-1);this._textSelection={startCursor:s,endCursor:n},this._textCursor=s,this._editorOperation=ee.SELECT_ALL,this._addCursorUpdateCommand()}_markSelection(){v.markTextUnselected(this.model.data),this.isSelectionAvailable&&v.markTextSelected(this.model.data,this._textSelection)}_checkFontStyleChangedByCursor(){let e;this.isSelectionAvailable?e=v.getStyleSetOfTextData(this.model.data,!0):this._textCursor&&(e=v.getStyleSetByCursor(this._textCursor,this.model.data)),e&&this._checkFontStyleChanged(e)}_updateFontStyleByTextData(e,s=!0,n){const r=v.getStyleSetOfTextData(this.model.data,e);this._checkFontStyleChanged(r,s,n)}_checkFontStyleChanged(e,s=!0,n){const r=ot=>ot.size>1,{fontStylers:o,fontSizes:a,fontFamilies:l,fontColors:c,fontColorOpacities:h,fontLetterSpacings:u,textDecorations:f,textDecorationColors:m,textDecorationOpacities:C,textDecorationThicknesses:y}=e,w=r(o),L=r(a),B=r(l),j=r(c),b=r(h),S=r(u),A=r(f),M=r(m),D=r(C),J=r(y),G=w?null:o.values().next().value,oe=L?null:a.values().next().value,ye=B?null:l.values().next().value,Ge=j?null:c.values().next().value,qe=b?null:h.values().next().value,be=S?null:u.values().next().value,$e=A?null:f.values().next().value,we=M?null:m.values().next().value,Ye=D?null:C.values().next().value,it=J?null:y.values().next().value;n&&(this._fontStylerMixin=w,this._fontSizeMixin=L,this._fontFamilyMixin=B,this._fontColorMixin=j,this._fontColorOpacityMixin=b,this._fontLetterSpacingMixin=S,this._textDecorationMixin=A,this._textDecorationColorMixin=M,this._textDecorationOpacityMixin=D,this._textDecorationThicknessMixin=J,this._fontStyler=G,this._fontSize=oe,this._fontFamily=ye,this._fontColor=Ge,this._fontColorOpacity=qe,this._fontLetterSpacing=be,this._textDecoration=$e,this._textDecorationColor=we,this._textDecorationOpacity=Ye,this._textDecorationThickness=it),s&&(this.emitPropChanged(E.fontStylerChanged,[G]),this.emitPropChanged(E.fontSizeChanged,[oe]),this.emitPropChanged(E.fontFamilyChanged,[ye]),this.emitPropChanged(E.fontColorChanged,[Ge]),this.emitPropChanged(E.fontColorOpacityChanged,[qe]),this.emitPropChanged(E.fontLetterSpacingChanged,[be]),this.emitPropChanged(E.fontStylerMixinChanged,[w]),this.emitPropChanged(E.fontSizeMixinChanged,[L]),this.emitPropChanged(E.fontFamilyMixinChanged,[B]),this.emitPropChanged(E.fontColorMixinChanged,[j]),this.emitPropChanged(E.fontColorOpacityMixinChanged,[b]),this.emitPropChanged(E.fontLetterSpacingMixinChanged,[S]),this.emitPropChanged(E.textDecorationChanged,[$e]),this.emitPropChanged(E.textDecorationColorChanged,[we]),this.emitPropChanged(E.textDecorationOpacityChanged,[Ye]),this.emitPropChanged(E.textDecorationThicknessChanged,[it]),this.emitPropChanged(E.textDecorationMixinChanged,[A]),this.emitPropChanged(E.textDecorationColorMixinChanged,[M]),this.emitPropChanged(E.textDecorationOpacityMixinChanged,[D]),this.emitPropChanged(E.textDecorationThicknessMixinChanged,[J]))}_moveCursorTo(e,s){var w;this._undoCommandObject=this._getTextEditorCommandObject({dataExclude:!0});const n=this.model.data,{shiftKey:r}=s;let o=this._textCursor;if(this.isSelectionAvailable){if(!r){const[L,B]=v.sortCursors(n,[this._textSelection.startCursor,this._textSelection.endCursor]);switch(e){case V.LEFT:case V.TOP:this._textCursor=L;break;case V.RIGHT:case V.BOTTOM:this._textCursor=B;break}this._textSelection=null,v.markTextUnselected(n),this._editorOperation=ee.MOVE_CURSOR;return}o=this._textSelection.endCursor}let{nodeId:a,lineNumber:l,pos:c}=o;const h=n.lines[l],u=l-1,f=l+1,m=n.lines[u],C=n.lines[f];let y;if(e===V.TOP)l===0?y=v.getCursorOfLineStart(h,l):u>=0&&(y=v.getClosestNodeCursorOfLine(m,this._prevMarkCursor,u));else if(e===V.BOTTOM)l===n.lines.length-1?y=v.getCursorOfLineEnd(h,l):f<n.lines.length&&(y=v.getClosestNodeCursorOfLine(C,this._prevMarkCursor,f));else if(h.nodes.length){let L=-1;switch(a?L=h.nodes.findIndex(B=>B.id===a):(L=0,c=V.LEFT),e){case V.LEFT:c===V.RIGHT?y=v.getCursorOfNode(h.nodes[L],V.LEFT,l):L>0?y=v.getCursorOfNode(h.nodes[L-1],V.LEFT,l):u>=0&&(m.isTailBreak||m.nodes.length===0?y=v.getCursorOfLineEnd(m,u):y=v.getCursorOfNode(m.nodes[m.nodes.length-1],V.LEFT,u));break;case V.RIGHT:(L===h.nodes.length-1||L===h.nodes.length-2&&c===V.RIGHT)&&!h.isTailBreak?y=v.getCursorOfLineStart(C,f):c===V.LEFT?y=v.getCursorOfNode(h.nodes[L],V.RIGHT,l):L<h.nodes.length-1?y=v.getCursorOfNode(h.nodes[L+1],V.RIGHT,l):f<=n.lines.length-1&&(y=v.getCursorOfLineStart(C,f));break}}else switch(e){case V.LEFT:u>=0&&(y=v.getCursorOfLineEnd(m,u));break;case V.RIGHT:f<=n.lines.length-1&&(y=v.getCursorOfLineStart(C,f));break}y&&(r?(this._textSelection={startCursor:this._textCursor,endCursor:y},this._editorOperation=ee.MOVE_SELECTION):(this._textCursor=y,this._textSelection=null,this._editorOperation=ee.MOVE_CURSOR),[V.TOP,V.BOTTOM].includes(e)||(this._prevMarkCursor=((w=this._textSelection)==null?void 0:w.endCursor)||this._textCursor)),this._prevInputCursor=null,this._addCursorUpdateCommand()}_getTextEditorCommandObject(e){return{textData:e!=null&&e.dataExclude?null:W.jsonClone(this.model.data),textCursor:W.jsonClone(this._textCursor),textSelection:W.jsonClone(this._textSelection)}}_deleteAtCursor(e,s){s&&(this._undoCommandObject=this._getTextEditorCommandObject());let n=!0;if(this.isSelectionAvailable){const[r,o]=v.sortCursors(e,[this._textSelection.startCursor,this._textSelection.endCursor]),{nodeId:a,lineNumber:l,pos:c}=r;let h=r;const u=e.lines[l],f=u.nodes.findIndex(y=>y.id===a);c===V.LEFT&&(f===0?h=v.getCursorOfLineHead(u,l):h=v.getCursorOfNode(u.nodes[f-1],V.RIGHT,l)),this._textCursor=h;let{lineNumber:m}=o;const C=m-l-1;C>0?(e.lines.splice(l+1,C),m-=C,v.margeNodesOfLine(e,l,m)):l===m?v.deleteSelectedNodesOfLine(e.lines[l]):v.margeNodesOfLine(e,l,m),this._editorOperation=ee.DELETE_SELECTION}else{const{nodeId:r,lineNumber:o,pos:a}=this._textCursor,l=o-1;if(r){const c=e.lines[o],h=c.nodes.findIndex(u=>u.id===r);if(a===V.LEFT)if(h===0)if(o!==0){const u=e.lines[l],f=u.nodes.length;if(u.nodes.push(...c.nodes),e.lines.splice(o,1),f>0){const m=u.nodes[f-1];this._textCursor=v.getCursorOfNode(m,V.RIGHT,l)}else this._textCursor=v.getCursorOfLineStart(u,l)}else n=!1,this._undoCommandObject=null;else c.nodes.splice(h-1,1),this._textCursor=v.getCursorOfNode(c.nodes[h-1],V.LEFT,o);else c.nodes.splice(h,1),h===0?this._textCursor=v.getCursorOfLineStart(c,o):this._textCursor=v.getCursorOfNode(c.nodes[h-1],V.RIGHT,o)}else e.lines.length===1?(e.lines[0].nodes=[],this._textCursor=v.getCursorOfLineStart(e.lines[0],0)):(e.lines.splice(this._textCursor.lineNumber,1),o!==0&&(this._textCursor=v.getCursorOfLineEnd(e.lines[l],l)));n&&(this._editorOperation=ee.DELETE_PREV)}return this._textSelection={startCursor:this._textCursor,endCursor:null},this._prevMarkCursor=this._textCursor,this._prevInputCursor=null,n}reflowText(e){return this._prevTextLinesReflowed=this._doReflowTextLines(!this._prevTextLinesReflowed||e),this._prevTextLinesReflowed}_doReflowTextLines(e=!1){const s=this.model.data,n=this.shield.stageScale,r=v.restoreTextLines(s.lines),a=v.calcMaxLineWidth(r,n)>=this.width||e;if(a){const l=v.calcReflowTextLines(r,this.width,n);s.lines=l}return a}_calcTextRenderWidth(){return Math.ceil(v.calcMaxLineWidth(this.model.data.lines,this.shield.stageScale))}_calcTextRenderHeight(){return Math.ceil(v.calcTextRenderHeight(this.model.data.lines,this.shield.stageScale))}reCalcSizeAndCoords(){const e=this._calcTextRenderWidth(),s=this._calcTextRenderHeight();this.model.width=e,this.model.height=s,this.model.coords=O.getBoxByLeftTop(this.model.coords[0],{width:e,height:s}),this.model.boxCoords=O.getBoxByLeftTop(this.model.boxCoords[0],{width:e,height:s})}onTransforming(){super.onTransforming(),this.reflowText()}onEditorPressChange(e){switch(e){case ht.PRESS_UP:{this._selectionMoveId=null,this._isSelectionMoved=!1;break}}}setFontFamily(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setFontFamily(e),s.lines.forEach(r=>{(r.selected||!n)&&(r.fontStyle=Object.assign({},r.fontStyle||{},{fontFamily:e})),r.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.fontFamily=e)})})}setFontStyler(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setFontStyler(e),s.lines.forEach(r=>{(r.selected||!n)&&(r.fontStyle=Object.assign({},r.fontStyle||{},{fontStyler:e})),r.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.fontStyler=e)})})}setFontSize(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setFontSize(e),s.lines.forEach(r=>{(r.selected||!n)&&(r.fontStyle=Object.assign({},r.fontStyle||{},{fontSize:e})),r.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.fontSize=e)})})}setFontColor(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setFontColor(e),s.lines.forEach(r=>{(r.selected||!n)&&(r.fontStyle=Object.assign({},r.fontStyle||{},{fontColor:e})),r.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.fontColor=e)})})}setFontColorOpacity(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setFontColorOpacity(e),s.lines.forEach(r=>{(r.selected||!n)&&(r.fontStyle=Object.assign({},r.fontStyle||{},{fontColorOpacity:e})),r.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.fontColorOpacity=e)})})}setFontLetterSpacing(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setFontLetterSpacing(e),s.lines.forEach(r=>{(r.selected||!n)&&(r.fontStyle=Object.assign({},r.fontStyle||{},{fontLetterSpacing:e})),r.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.fontLetterSpacing=e)})})}setTextDecoration(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setTextDecoration(e),s.lines.forEach(r=>{(r.selected||!n)&&(r.fontStyle=Object.assign({},r.fontStyle||{},{textDecoration:e})),r.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.textDecoration=e)})})}setTextDecorationColor(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setTextDecorationColor(e),s.lines.forEach(r=>{(r.selected||!n)&&(r.fontStyle=Object.assign({},r.fontStyle||{},{textDecorationColor:e})),r.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.textDecorationColor=e)})})}setTextDecorationOpacity(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setTextDecorationOpacity(e),s.lines.forEach(r=>{(r.selected||!n)&&(r.fontStyle=Object.assign({},r.fontStyle||{},{textDecorationOpacity:e})),r.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.textDecorationOpacity=e)})})}setTextDecorationThickness(e){const s=this.model.data;let n=this.isSelectionAvailable;n||super.setTextDecorationThickness(e),s.lines.forEach(r=>{(r.selected||!n)&&(r.fontStyle=Object.assign({},r.fontStyle||{},{textDecorationThickness:e})),r.nodes.forEach(o=>{(o.selected||!n)&&(o.fontStyle.textDecorationThickness=e)})})}refreshOriginalElementProps(){super.refreshOriginalElementProps(),this._originalData=W.jsonClone(this.model.data)}async toOriginalTransformJson(){const e=await super.toOriginalTransformJson();return e.data=this._originalData,e}async toTransformJson(){const e=await super.toTransformJson();return e.data=W.jsonClone(this.model.data),e}async toFontStyleJson(){const e=await super.toFontStyleJson();return e.data=W.jsonClone(this.model.data),e}onTextReflowed(e){e&&this._addUpdateCommand()}_addUpdateCommand(){let e=!1;const s=this._undoRedo.tailUndoCommand;if(s){const{payload:{operation:n}}=s;e=this._editorOperation===ee.DELETE_PREV&&n===ee.DELETE_PREV||this._editorOperation===ee.INPUT&&n===ee.INPUT}if(e)s.payload.rData=this._getTextEditorCommandObject();else{const n=new bn({type:Ut.TextUpdated,operation:this._editorOperation,updateId:this._textUpdateId,uData:this._undoCommandObject,rData:this._getTextEditorCommandObject()},this);this._undoRedo.add(n)}}_addCursorUpdateCommand(){let e=!1;const s=this._undoRedo.tailUndoCommand;if(s){const{payload:{operation:n,uData:{textCursor:r,textSelection:o}}}=s;e=this._editorOperation===ee.MOVE_CURSOR&&n===ee.MOVE_CURSOR&&v.isCursorAtSamePosition(this._textCursor,r,this.model.data)||this._editorOperation===ee.MOVE_SELECTION&&n===ee.MOVE_SELECTION&&v.isSelectionEqualWithStart(this._textSelection,o,this.model.data)}if(e)s.payload.rData=this._getTextEditorCommandObject({dataExclude:!0});else{const n=new bn({type:Ut.CursorSelectionUpdated,operation:this._editorOperation,updateId:this._textUpdateId,uData:this._undoCommandObject,rData:this._getTextEditorCommandObject({dataExclude:!0})},this);this._undoRedo.add(n)}}_isTextNodesContainsCoord(e){const s=this.model.data;if(s.lines.length===0)return!1;const n=xe.convertCoordInRect(e,this,xe.calcElementRenderRect(this));return s.lines.some(r=>r.nodes.some(o=>!te.isSpace(o.content)&&O.isPointInRect(o,n)))}_isTextContainsCoord(e){const s=this._getTextRotateRenderCoords();return d.isPointInPolygonByRayCasting(e,s)}_getTextRenderCoords(){const e=this._calcTextRenderHeight();return this._getTextCoordsByHeight(e)}_getTextCoordsByHeight(e){let{x:s,y:n,width:r,height:o}=this.model;switch(s=s-r/2,n=n-o/2,this.textVerticalAlign){case"middle":n+=(o-e)/2;break;case"bottom":n+=o-e;break}return O.getBoxByLeftTop({x:s,y:n},{width:r,height:e})}_getTextRotateRenderCoords(){const e=this._getTextRenderCoords();return d.batchTransWithCenter(e,this.angles,this.centerCoord)}_isTextPolygnOverlap(e){const s=this._getTextRotateRenderCoords();return d.isPolygonsOverlap(s,e)}isContainsCoord(e){return this.isSelected||this.strokeEffective?super.isContainsCoord(e)||this._isTextContainsCoord(e)||this._isTextNodesContainsCoord(e):this._isTextNodesContainsCoord(e)}isPolygonOverlap(e){return this.isSelected||this.strokeEffective?super.isPolygonOverlap(e)||this._isTextPolygnOverlap(e):this._isTextPolygnOverlap(e)}isModelPolygonOverlap(e){return super.isModelPolygonOverlap(e)||d.isPolygonsOverlap(this._getTextRotateRenderCoords(),e)}}class Jo extends Ne{async run(){if(!this.canvas||!this.element)return;const{innermostStrokeCoordIndex:t,unLeanStrokeCoords:e,model:{styles:s,styles:{strokes:n}},center:r,angle:o,flipX:a,leanY:l,actualAngle:c,shield:h}=this.element,u={angle:o,flipX:a,leanY:l,actualAngle:c},f=F.batchCalcStageRelativePoints(e),m=f[t],C=xe.calcRenderRect(m,r,h.stageScale);s.fills.forEach(y=>{Y.drawEllipseFillWithScale(this.canvas,r,{rx:C.width/2/h.stageScale,ry:C.height/2/h.stageScale},y,C,u)}),f.forEach((y,w)=>{const L=xe.calcRenderRect(y,r,h.stageScale);Y.drawEllipseStrokeWithScale(this.canvas,r,{rx:L.width/2/h.stageScale,ry:L.height/2/h.stageScale},n[w],L,u)})}}class Ko extends Ct{get editingEnable(){return!1}}class Fs{static createImageFromImageData(t){const e=Y.getCanvasByImageData(t),s=new Image;return s.src=e.toDataURL(),s}static waitForImageLoad(t){return new Promise((e,s)=>{t.onload=()=>{e(t)},t.onerror=()=>{s(new Error("Image load failed"))}})}static async createImageFromUrl(t){const e=new Image;return e.src=t,await this.waitForImageLoad(e),e}}class Qo extends Ne{async run(){if(!this.canvas||!this.element)return;ls.drawArcRect(this.element,this.canvas);const{model:{styles:{fontStyler:t,fontSize:e,fontFamily:s,textAlign:n,textVerticalAlign:r,textBaseline:o,fontColor:a,fontColorOpacity:l,fontLineHeight:c,fontLetterSpacing:h,textDecoration:u,textDecorationColor:f,textDecorationOpacity:m,textDecorationThickness:C,paragraphSpacing:y},data:w},angle:L,flipX:B,leanY:j,actualAngle:b,unLeanBoxCoords:S}=this.element,A={angle:L,flipX:B,leanY:j,actualAngle:b},M=F.calcStageRelativePoints(S),D=xe.calcElementRenderRect(this.element);Y.drawRotateTextWithScale(this.canvas,w,M,D,{fontStyler:t,fontSize:e,fontFamily:s,textAlign:n,textVerticalAlign:r,textBaseline:o,fontColor:a,fontColorOpacity:l,fontLineHeight:c,fontLetterSpacing:h,textDecoration:u,textDecorationColor:f,textDecorationOpacity:m,textDecorationThickness:C,paragraphSpacing:y},A)}}class Jt{}g(Jt,"stageCalcParams");var Te=(i=>(i.isSelected="isSelected",i.isVisible="isVisible",i.isLocked="isLocked",i.isEditing="isEditing",i.isMoving="isMoving",i.isTransforming="isTransforming",i.isRotating="isRotating",i.isRotatingTarget="isRotatingTarget",i.isDragging="isDragging",i.isProvisional="isProvisional",i.isTarget="isTarget",i.isInRange="isInRange",i.isOnStage="isOnStage",i.status="status",i.isRatioLocked="isRatioLocked",i))(Te||{}),Ue=(i=>(i[i.added=0]="added",i[i.removed=1]="removed",i))(Ue||{});class F{static createElementTask(t,e){let s;switch(t.model.type){case I.rectangle:s=new ao(t,e);break;case I.image:{s=new Yo(t,e);break}case I.line:{s=new $o(t,e);break}case I.ellipse:{s=new Jo(t,e);break}case I.arbitrary:{s=new Xo(t,e);break}case I.text:{s=new Qo(t,e);break}}return s}static calcStageRelativePoints(t){return t.map(e=>F.calcStageRelativePoint(e))}static batchCalcStageRelativePoints(t){return t.map(e=>F.calcStageRelativePoints(e))}static calcStageRelativePoint(t){const{rect:{width:e,height:s},scale:n,worldCoord:{x:r,y:o}}=Jt.stageCalcParams;return{x:t.x+e/2/n-r,y:t.y+s/2/n-o}}static calcWorldCoords(t){return t.map(e=>F.calcWorldCoord(e))}static calcWorldCoord(t){const{rect:{width:e,height:s},scale:n,worldCoord:{x:r,y:o}}=Jt.stageCalcParams;return{x:t.x-e/2/n+r,y:t.y-s/2/n+o}}static calcCreatorPoints(t,e){switch(e){case I.rectangle:case I.image:case I.arbitrary:case I.text:case I.ellipse:case I.group:return O.getBoxByPoints(t);default:return t}}static createElement(t,e){const{type:s}=t;switch(s){case I.rectangle:return new Js(t,e);case I.line:return new Go(t,e);case I.ellipse:return new Ko(t,e);case I.image:return new Sn(t,e);case I.arbitrary:return new qo(t,e);case I.text:return new et(t,e);case I.group:return new Ks(t,e);case I.image:return new Sn(t,e);default:return new Ct(t,e)}}static getTopAElementByCoord(t,e){for(let s=t.length-1;s>=0;s--){const n=t[s];if(n.isContainsCoord(e))return n}}static calcElementRotatePoint(t){const{centerCoord:e,rotation:{angle:s,scale:n},model:{height:r}}=t;return d.calcTargetPoint(e,r/2+xo*n,s)}static calcPosition(t){switch(t.type){case I.rectangle:case I.image:case I.line:case I.ellipse:case I.arbitrary:case I.text:case I.group:return d.calcCenter(t.coords)}}static calcSize(t){const{coords:e,boxCoords:s,type:n}=t;switch(n){case I.rectangle:case I.text:case I.group:case I.image:case I.ellipse:case I.arbitrary:return O.calcRectangleSize(s);case I.line:return{width:d.precise(d.calcDistance(e[0],e[1]),2),height:0}}}static fixAngle(t){return t>180&&(t=t-360),t}static calcOutlinePoints(t,e,s,n){if(s&&e!==ae.inside){let r=s/2;e===ae.outside&&(r=s);const{flipX:o,flipY:a}=n;return o!==a?je.getArbitraryInnerVertices(t,r,n):je.getArbitraryOuterVertices(t,r,n)}return t}static calcNoFoldArbitraryBorderRegions(t,e){const{width:s}=e,n=[];return t.forEach((r,o)=>{if(o<t.length-1){const a=t[o+1];if(n.push(Me.calcBentLineOuterVertices([r,a],s/2)),o!==0){const l=t[o-1];n.push(F.calc3PArbitraryBorderRegions(l,r,a,e))}}}),n}static calcFoldArbitraryBorderRegions(t,e){const{width:s}=e,n=[];return t.forEach((r,o)=>{const a=O.getPrevOfArray(t,o),l=O.getNextOfArray(t,o);n.push(Me.calcBentLineOuterVertices([r,l],s/2)),n.push(F.calc3PArbitraryBorderRegions(a,r,l,e))}),n}static calcArbitraryBorderRegions(t,e,s){return s?F.calcFoldArbitraryBorderRegions(t,e):F.calcNoFoldArbitraryBorderRegions(t,e)}static calc3PArbitraryBorderRegions(t,e,s,n){const{width:r}=n,o=d.isPointClockwiseOfLine(s,t,e),l=(180-d.calcTriangleAngle(t,e,s))/2,c=d.calcAngle(t,e),h=d.calcTriangleSide3By2(l,r/2),u=d.calcTargetPoint(e,h,c+(o?-l:l)),f=[];return f.push(e),f.push(d.calcTargetPoint(e,r/2,c-90)),f.push(u),f.push(d.calcTargetPoint(e,r/2,d.calcAngle(s,e)+90)),f}static calcCoordsByTransPoints(t,e,s){const n=d.calcCenter(t.map(o=>d.transWithCenter(o,e,s,!0))),r=d.transWithCenter(n,e,s);return t.map(o=>d.rotateWithCenter(o,-e.angle,r))}static calcCoordsByRotatePoints(t,e,s){let n=d.calcCenter(t.map(o=>d.rotateWithCenter(o,-e,s)));const r=d.rotateWithCenter(n,e,s);return t.map(o=>d.rotateWithCenter(o,-e,r))}static normalizeMatrixPoint(t,e,s,n){t=d.transWithCenter(t,n,s,!0);const[r,o]=d.multiply(e,[t.x-s.x,t.y-s.y,1]);return{x:r+s.x,y:o+s.y}}static calcMatrixPoint(t,e,s,n){const r=F.normalizeMatrixPoint(t,e,s,n);return d.transWithCenter(r,n,s)}static calcMatrixPoints(t,e,s,n){return t.map(r=>F.calcMatrixPoint(r,e,s,n))}static isSameAncestorGroup(t){return t.length<=1?!0:F.getAncestorGroup(t)!==null}static getAncestorGroup(t){if(t.length===0)return null;const e=F.getNoParentElements(t);return e.length>1?null:e[0]}static getNoParentElements(t){return t.filter(e=>!e.isGroupSubject)}static createEmptyGroupObject(){return{...F.createEmptyObject(),type:I.group}}static createEmptyObject(){return{id:`${O.getDateId()}`,subIds:[],coords:[],boxCoords:[],width:0,height:0,styles:{strokes:[]},x:0,y:0,...Ys,...Rt}}static fixCornersBasedOnMinSize(t,e){return k.range(4).forEach(s=>{t[s]!==0&&(t[s]=k.clamp(t[s],0,e/2))}),t}static convertElementsJson(t){const e=t,s=new Map,n=[],r=O.getDateId();return e.forEach((o,a)=>{s.set(o.id,o),n.push(r+a)}),e.forEach((o,a)=>{F.reBindGroup(o,s,`${n[a]}`),F.divateCoords(o,40)}),e}static reBindGroup(t,e,s){const{subIds:n,groupId:r,id:o}=t;if(t.id=s,e.set(s,t),e.delete(o),n&&n.forEach(a=>{const l=e.get(a);l&&(l.groupId=s)}),r){const a=e.get(r);if(a){const l=a.subIds.indexOf(o);if(l===-1)return;a.subIds.splice(l,1,s)}}}static divateCoords(t,e){const{coords:s,boxCoords:n}=t;return t.x+=e,t.y+=e,t.coords=d.batchTranslate(s,{x:e,y:e}),t.boxCoords=d.batchTranslate(n,{x:e,y:e}),t}static async convertElementModel(t){const{type:e,data:s}=t;switch(e){case I.image:t.data=await Fs.createImageFromUrl(s)}return t}static calcStageRelativeArcPoint(t){let{start:e,end:s,controller:n,corner:r,value:o}=t;return[e,s,n,r]=F.calcStageRelativePoints([e,s,n,r]),{start:e,end:s,controller:n,corner:r,value:o}}static calcStageRelativeArcPoints(t){return t.map(e=>F.calcStageRelativeArcPoint(e))}static batchCalcStageRelativeArcPoints(t){return t.map(e=>F.calcStageRelativeArcPoints(e))}}var Ht={exports:{}},wn;function Zo(){if(wn)return Ht.exports;wn=1;var i=typeof Reflect=="object"?Reflect:null,t=i&&typeof i.apply=="function"?i.apply:function(S,A,M){return Function.prototype.apply.call(S,A,M)},e;i&&typeof i.ownKeys=="function"?e=i.ownKeys:Object.getOwnPropertySymbols?e=function(S){return Object.getOwnPropertyNames(S).concat(Object.getOwnPropertySymbols(S))}:e=function(S){return Object.getOwnPropertyNames(S)};function s(b){console&&console.warn&&console.warn(b)}var n=Number.isNaN||function(S){return S!==S};function r(){r.init.call(this)}Ht.exports=r,Ht.exports.once=L,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var o=10;function a(b){if(typeof b!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(b){if(typeof b!="number"||b<0||n(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");o=b}}),r.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(S){if(typeof S!="number"||S<0||n(S))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+S+".");return this._maxListeners=S,this};function l(b){return b._maxListeners===void 0?r.defaultMaxListeners:b._maxListeners}r.prototype.getMaxListeners=function(){return l(this)},r.prototype.emit=function(S){for(var A=[],M=1;M<arguments.length;M++)A.push(arguments[M]);var D=S==="error",J=this._events;if(J!==void 0)D=D&&J.error===void 0;else if(!D)return!1;if(D){var G;if(A.length>0&&(G=A[0]),G instanceof Error)throw G;var oe=new Error("Unhandled error."+(G?" ("+G.message+")":""));throw oe.context=G,oe}var ye=J[S];if(ye===void 0)return!1;if(typeof ye=="function")t(ye,this,A);else for(var Ge=ye.length,qe=C(ye,Ge),M=0;M<Ge;++M)t(qe[M],this,A);return!0};function c(b,S,A,M){var D,J,G;if(a(A),J=b._events,J===void 0?(J=b._events=Object.create(null),b._eventsCount=0):(J.newListener!==void 0&&(b.emit("newListener",S,A.listener?A.listener:A),J=b._events),G=J[S]),G===void 0)G=J[S]=A,++b._eventsCount;else if(typeof G=="function"?G=J[S]=M?[A,G]:[G,A]:M?G.unshift(A):G.push(A),D=l(b),D>0&&G.length>D&&!G.warned){G.warned=!0;var oe=new Error("Possible EventEmitter memory leak detected. "+G.length+" "+String(S)+" listeners added. Use emitter.setMaxListeners() to increase limit");oe.name="MaxListenersExceededWarning",oe.emitter=b,oe.type=S,oe.count=G.length,s(oe)}return b}r.prototype.addListener=function(S,A){return c(this,S,A,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(S,A){return c(this,S,A,!0)};function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(b,S,A){var M={fired:!1,wrapFn:void 0,target:b,type:S,listener:A},D=h.bind(M);return D.listener=A,M.wrapFn=D,D}r.prototype.once=function(S,A){return a(A),this.on(S,u(this,S,A)),this},r.prototype.prependOnceListener=function(S,A){return a(A),this.prependListener(S,u(this,S,A)),this},r.prototype.removeListener=function(S,A){var M,D,J,G,oe;if(a(A),D=this._events,D===void 0)return this;if(M=D[S],M===void 0)return this;if(M===A||M.listener===A)--this._eventsCount===0?this._events=Object.create(null):(delete D[S],D.removeListener&&this.emit("removeListener",S,M.listener||A));else if(typeof M!="function"){for(J=-1,G=M.length-1;G>=0;G--)if(M[G]===A||M[G].listener===A){oe=M[G].listener,J=G;break}if(J<0)return this;J===0?M.shift():y(M,J),M.length===1&&(D[S]=M[0]),D.removeListener!==void 0&&this.emit("removeListener",S,oe||A)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(S){var A,M,D;if(M=this._events,M===void 0)return this;if(M.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):M[S]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete M[S]),this;if(arguments.length===0){var J=Object.keys(M),G;for(D=0;D<J.length;++D)G=J[D],G!=="removeListener"&&this.removeAllListeners(G);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(A=M[S],typeof A=="function")this.removeListener(S,A);else if(A!==void 0)for(D=A.length-1;D>=0;D--)this.removeListener(S,A[D]);return this};function f(b,S,A){var M=b._events;if(M===void 0)return[];var D=M[S];return D===void 0?[]:typeof D=="function"?A?[D.listener||D]:[D]:A?w(D):C(D,D.length)}r.prototype.listeners=function(S){return f(this,S,!0)},r.prototype.rawListeners=function(S){return f(this,S,!1)},r.listenerCount=function(b,S){return typeof b.listenerCount=="function"?b.listenerCount(S):m.call(b,S)},r.prototype.listenerCount=m;function m(b){var S=this._events;if(S!==void 0){var A=S[b];if(typeof A=="function")return 1;if(A!==void 0)return A.length}return 0}r.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};function C(b,S){for(var A=new Array(S),M=0;M<S;++M)A[M]=b[M];return A}function y(b,S){for(;S+1<b.length;S++)b[S]=b[S+1];b.pop()}function w(b){for(var S=new Array(b.length),A=0;A<S.length;++A)S[A]=b[A].listener||b[A];return S}function L(b,S){return new Promise(function(A,M){function D(G){b.removeListener(S,J),M(G)}function J(){typeof b.removeListener=="function"&&b.removeListener("error",D),A([].slice.call(arguments))}j(b,S,J,{once:!0}),S!=="error"&&B(b,D,{once:!0})})}function B(b,S,A){typeof b.on=="function"&&j(b,"error",S,A)}function j(b,S,A,M){if(typeof b.on=="function")M.once?b.once(S,A):b.on(S,A);else if(typeof b.addEventListener=="function")b.addEventListener(S,function D(J){M.once&&b.removeEventListener(S,D),A(J)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b)}return Ht.exports}var Qs=Zo();class ea extends Qs.EventEmitter{constructor(e){super();g(this,"nodes");g(this,"_head");g(this,"_tail");g(this,"_eqFunc",(e,s)=>e===s);this.nodes=new Set,this._head=null,this._tail=null,this._eqFunc=e}get head(){return this._head}get tail(){return this._tail}get length(){return this.nodes.size}insert(e){this._tail?this.insertAfter(e,this._tail):(this._tail=e,this.nodes.add(e)),this._head||(this._head=e)}prepend(e){this._head?this.insertBefore(e,this._head):(this._head=e,this.nodes.add(e)),this._tail||(this._tail=e)}remove(e,s){this.nodes.delete(e);const n=e.prev,r=e.next;n&&(n.next=r),r&&(r.prev=n),e.prev=null,e.next=null,this._eqFunc(e,this._tail)&&(this._tail=n),this._eqFunc(e,this._head)&&(this._head=r)}removeBy(e,s){let n=[];return Array.from(this.nodes).forEach(r=>{e(r)&&(this.remove(r,s),n.push(r))}),n}insertBefore(e,s){s&&(s.insertBefore(e),this.nodes.add(e),e.isHead&&(this._head=e))}insertAfter(e,s){s&&(s.insertAfter(e),this.nodes.add(e),e.isTail&&(this._tail=e))}forEach(e){this.forEachBreak(e,()=>!1)}forEachBreak(e,s){let n=0,r=this._head;for(;r;){if(s&&s(r,n))return;e(r,n),r=r.next,n++}}forEachRevert(e){this.forEachBreakRevert(e,()=>!1)}forEachBreakRevert(e,s){let n=this.length-1,r=this._tail;for(;r;){if(s&&s(r,n))return;e(r,n),r=r.prev,n--}}getIndex(e){let s=-1,n=this._head;for(;n;){if(s++,this._eqFunc(n,e))return s;n=n.next}return s}filter(e){const s=[];return this.forEach(n=>{e(n)&&s.push(n)}),s}}const Tn=(i,t)=>i.value&&t.value&&i.value.id===t.value.id;class Ss extends ea{constructor(){super(Tn)}_addElementObserve(t){Object.keys(Te).forEach(e=>{We(()=>t.value[e],()=>{this.emit(e,t.value,t.value[e])})})}insert(t,e=!0){lt(()=>{this._addElementObserve(t),super.insert(t),e&&this.emit(Ue.added,t)})}insertBefore(t,e,s=!0){lt(()=>{this._addElementObserve(t),super.insertBefore(t,e),s&&this.emit(Ue.added,t)})}insertAfter(t,e,s=!0){lt(()=>{this._addElementObserve(t),super.insertAfter(t,e),s&&this.emit(Ue.added,t)})}prepend(t,e=!0){lt(()=>{this._addElementObserve(t),super.prepend(t),e&&this.emit(Ue.added,t)})}remove(t,e=!0){lt(()=>{super.remove(t),e&&this.emit(Ue.removed,t)})}removeBy(t,e=!0){let s=[];return lt(()=>{s=super.removeBy(t,e)}),s}static isConsecutive(t){if(t.length<2)return!0;let e=t[0],s=1;for(;e.next&&Tn(e.next,t[s]);)if(e=e.next,s++,s===t.length)break;return s===t.length}}class ta{constructor(t){g(this,"shield");g(this,"_elementList",new Ss);g(this,"_currentCreatingElementId");g(this,"_elementsMap",new Map);g(this,"_provisionalElements",[]);g(this,"_selectedElements",[]);g(this,"_targetElements",[]);g(this,"_rangeElements",[]);g(this,"_visibleElements",[]);g(this,"_stageElements",[]);g(this,"_editingElements",[]);g(this,"_rotatingTargetElements",[]);g(this,"_provisionalElementIds",ne.set(new Set));g(this,"_selectedElementIds",ne.set(new Set));g(this,"_targetElementIds",ne.set(new Set));g(this,"_visibleElementIds",ne.set(new Set));g(this,"_rangeElementIds",ne.set(new Set));g(this,"_stageElementIds",ne.set(new Set));g(this,"_editingElementIds",ne.set(new Set));g(this,"_rotatingTargetElementIds",ne.set(new Set));g(this,"_rotatingCenter");g(this,"_rotatingCenterCoord");g(this,"_rotatingOriginalAngle");g(this,"_isMultiSelected",!1);g(this,"_noParentElements",[]);g(this,"_selectedAncestorElement");g(this,"_primarySelectedElement");this.shield=t,this._reactionElementAdded(),this._reactionElementRemoved(),this._reactionElementsPropsChanged(),this._reactionElementsSelectionChanged()}get selectedElementIds(){return this._selectedElementIds}get creatingElements(){const t=this._elementsMap.get(this._currentCreatingElementId);return t?[t]:[]}get isProvisionalEmpty(){return this._provisionalElementIds.size===0}get provisionalElements(){return this._provisionalElements}get selectedElements(){return this._selectedElements}get targetElements(){return this._targetElements}get stageElements(){return this._stageElements}get rangeElements(){return this._rangeElements}get visibleElements(){return this._visibleElements}get selectedAncestorElement(){return this._selectedAncestorElement}get primarySelectedElement(){return this._primarySelectedElement}get rotatingTargetElements(){return this._rotatingTargetElements}get editingElements(){return this._editingElements}get isSelectedEmpty(){return this._selectedElementIds.size===0}get isVisibleEmpty(){return this._visibleElementIds.size===0}get isEmpty(){return this._elementList.length===0}get isEditingEmpty(){return this._editingElementIds.size===0}get isTargetEmpty(){return this._targetElementIds.size===0}get isRangeEmpty(){return this._rangeElementIds.size===0}get isStageEmpty(){return this._stageElementIds.size===0}get isRotatingTargetEmpty(){return this._rotatingTargetElementIds.size===0}get noParentElements(){return this._noParentElements}get isMultiSelected(){return this._isMultiSelected}_reactionElementAdded(){this._elementList.on(Ue.added,t=>{const e=t.value;Object.keys(Te).forEach(s=>{this._reactionElementPropsChanged(Te[s],e,e[s])})})}_reactionElementRemoved(){this._elementList.on(Ue.removed,t=>{const{id:e}=t.value;this._elementsMap.delete(e),this._selectedElementIds.delete(e),this._targetElementIds.delete(e),this._provisionalElementIds.delete(e),this._rotatingTargetElementIds.delete(e),this._editingElementIds.delete(e),this._rangeElementIds.delete(e),this._visibleElementIds.delete(e),this._stageElementIds.delete(e)})}_reactionElementsPropsChanged(){Object.keys(Te).forEach(t=>{this._elementList.on(t,(e,s)=>{this._reactionElementPropsChanged(t,e,s)})})}_reactionElementsSelectionChanged(){We(()=>Array.from(this._selectedElementIds),()=>{this._reactionSelectedElementsChanged(),this.shield.selection.refresh()}),We(()=>Array.from(this._targetElementIds),()=>this._reactionTargetElementsChanged()),We(()=>Array.from(this._provisionalElementIds),()=>this._reactionProvisionalElementsChanged()),We(()=>Array.from(this._rotatingTargetElementIds),()=>this._reactionRotatingTargetElementsChanged()),We(()=>Array.from(this._editingElementIds),()=>this._reactionEditingElementsChanged()),We(()=>Array.from(this._rangeElementIds),()=>this._reactRangeElementsChanged()),We(()=>Array.from(this._visibleElementIds),()=>this._reactionVisibleElementsChanged()),We(()=>Array.from(this._stageElementIds),()=>this._reactionStageElementsChanged())}_reactionSelectedElementsChanged(){this._selectedElements=this._filterList(this._selectedElementIds),this._noParentElements=F.getNoParentElements(this._selectedElements),this._isMultiSelected=this._noParentElements.length>1,this._selectedAncestorElement=F.getAncestorGroup(this._selectedElements),this._primarySelectedElement=this._selectedAncestorElement&&!this._selectedAncestorElement.isProvisional?this._selectedAncestorElement:null,this.shield.emit(E.selectedChanged,this._selectedElements),this.shield.emit(E.multiSelectedChanged,this._isMultiSelected),this.shield.emit(E.primarySelectedChanged,this._primarySelectedElement),this.emitElementsLayerChanged()}emitElementsLayerChanged(){this._selectedElements.length?Ss.isConsecutive(this._selectedElements.map(t=>t.node))?(this.shield.emit(E.layerShiftMoveEnableChanged,!this._selectedElements[this._selectedElements.length-1].isTopmost),this.shield.emit(E.layerGoDownEnableChanged,!this._selectedElements[0].isBottommost)):(this.shield.emit(E.layerShiftMoveEnableChanged,!0),this.shield.emit(E.layerGoDownEnableChanged,!0)):(this.shield.emit(E.layerShiftMoveEnableChanged,!1),this.shield.emit(E.layerGoDownEnableChanged,!1))}_reactionTargetElementsChanged(){this._targetElements=this._filterList(this._targetElementIds),this.shield.emit(E.targetChanged,this._targetElements)}_reactionStageElementsChanged(){this._stageElements=this._filterList(this._stageElementIds)}_reactionVisibleElementsChanged(){this._visibleElements=this._filterList(this._visibleElementIds)}_reactRangeElementsChanged(){this._rangeElements=this._filterList(this._rangeElementIds)}_reactionEditingElementsChanged(){this._editingElements=this._filterList(this._editingElementIds)}_reactionRotatingTargetElementsChanged(){this._rotatingTargetElements=this._filterList(this._rotatingTargetElementIds)}_reactionProvisionalElementsChanged(){this._provisionalElements=this._filterList(this._provisionalElementIds)}resortElementsArray(){this._reactionStageElementsChanged(),this._reactionVisibleElementsChanged(),this._reactionSelectedElementsChanged()}_filterList(t){return this._elementList.filter(e=>t.has(e.value.id)).map(e=>e.value)}_setAddDelete(t,e,s){s?t.add(e):t.delete(e)}_reactionElementPropsChanged(t,e,s){switch(t){case Te.isSelected:{this._setAddDelete(this._selectedElementIds,e.id,s);break}case Te.isProvisional:{this._setAddDelete(this._provisionalElementIds,e.id,s);break}case Te.isTarget:{this._setAddDelete(this._targetElementIds,e.id,s);break}case Te.isRotatingTarget:{this._setAddDelete(this._rotatingTargetElementIds,e.id,s);break}case Te.isEditing:{this._setAddDelete(this._editingElementIds,e.id,s);break}case Te.isInRange:{this._setAddDelete(this._rangeElementIds,e.id,s);break}case Te.isVisible:{this._setAddDelete(this._visibleElementIds,e.id,s);break}case Te.isOnStage:{this._setAddDelete(this._stageElementIds,e.id,s);break}}}filterEmit(t,e,...s){var n;e&&(e.id===((n=this.primarySelectedElement)==null?void 0:n.id)||e.id===this._currentCreatingElementId)&&this.shield.emit(t,e,...s)}async setElementsPosition(t,e){t.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){const{x:n,y:r}=s.model,{x:o,y:a}=e;if(n===o&&r===a)return;const l={x:o-n,y:a-r};s.setPosition(o,a,l),s.isGroup&&s.deepSubs.forEach(c=>{c.setPosition(c.model.x+l.x,c.model.y+l.y,l)})}})}async setElementsWidth(t,e){t.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){if(s.width===e)return;const n=s.setWidth(e);s.isGroup&&this.scaleSubs(s,n)}})}async setElementsHeight(t,e){t.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){if(s.height===e)return;const n=s.setHeight(e);s.isGroup&&this.scaleSubs(s,n)}})}scaleSubs(t,e){const{centerCoord:s,angle:n,leanYAngle:r}=t,{scaleX:o,scaleY:a}=d.getScaleFromMatrix(e);t.deepSubs.forEach(l=>{l.scaleBy(s,o,a,{angle:n,leanYAngle:r})})}async setElementsAngle(t,e){t.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){if(s.angle===e)return;this.rotateElements([s],e,s.angle,s.centerCoord),s.onRotateAfter(),s.isGroup&&s.deepSubs.forEach(n=>n.onRotateAfter())}})}async setElementsCorners(t,e,s){t.forEach(n=>{if(this.hasElement(n.id)&&!n.isGroupSubject){if(k.isEqual(n.corners,[e,e,e,e]))return;n.setCorners(e,s)}})}async setElementsLeanYAngle(t,e){t.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){if(s.leanYAngle===e)return;const n=s.leanYAngle;if(e=d.precise(e,1),s.setLeanYAngle(e),s.isGroup){const r=s.centerCoord;s.deepSubs.forEach(o=>{o.leanYBy(e,n,s.angle,r)})}}})}async setElementsStrokeType(t,e,s){t.forEach(n=>{if(this.hasElement(n.id)){if(n.model.styles.strokes[s].type===e)return;n.setStrokeType(e,s)}})}async setElementsStrokeWidth(t,e,s){t.forEach(n=>{if(this.hasElement(n.id)){if(n.model.styles.strokes[s].width===e)return;n.setStrokeWidth(e,s)}})}async setElementsStrokeColor(t,e,s){t.forEach(n=>{if(this.hasElement(n.id)){if(n.model.styles.strokes[s].color===e)return;n.setStrokeColor(e,s)}})}async setElementsStrokeColorOpacity(t,e,s){t.forEach(n=>{if(this.hasElement(n.id)){if(n.model.styles.strokes[s].colorOpacity===e)return;n.setStrokeColorOpacity(e,s)}})}async addElementsStroke(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.addStroke(e)})}async removeElementsStroke(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.removeStroke(e)})}async setElementsFillColor(t,e,s){t.forEach(n=>{if(this.hasElement(n.id)){if(n.model.styles.fills[s].color===e)return;n.setFillColor(e,s)}})}async setElementsFillColorOpacity(t,e,s){t.forEach(n=>{if(this.hasElement(n.id)){if(n.model.styles.fills[s].colorOpacity===e)return;n.setFillColorOpacity(e,s)}})}async addElementsFill(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.addFill(e)})}async removeElementsFill(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.removeFill(e)})}async setElementsTextAlign(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.textAlign===e)return;s.setTextAlign(e)}})}async setElementsTextVerticalAlign(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.textVerticalAlign===e)return;s.setTextVerticalAlign(e)}})}async setElementsTextBaseline(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.textBaseline===e)return;s.setTextBaseline(e)}})}async setElementsFontStyler(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setFontStyler(e)})}async setElementsFontSize(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setFontSize(e)})}async setElementsFontFamily(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setFontFamily(e)})}async setElementsFontLineHeight(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.fontLineHeight===e)return;s.setFontLineHeight(e)}})}async setElementsFontLineHeightFactor(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.fontLineHeightFactor===e)return;s.setFontLineHeightFactor(e)}})}async setElementsFontLineHeightAutoFit(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.fontLineHeightAutoFit===e)return;s.setFontLineHeightAutoFit(e)}})}async setElementsFontColor(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setFontColor(e)})}async setElementsFontColorOpacity(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setFontColorOpacity(e)})}async setElementsFontLetterSpacing(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setFontLetterSpacing(e)})}async setElementsTextDecoration(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setTextDecoration(e)})}async setElementsTextDecorationColor(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setTextDecorationColor(e)})}async setElementsTextDecorationOpacity(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setTextDecorationOpacity(e)})}async setElementsTextDecorationThickness(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setTextDecorationThickness(e)})}async setElementsRatioLocked(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.isRatioLocked===e)return;s.setRatioLocked(e)}})}hasElement(t){return this._elementsMap.has(t)}getElementById(t){return this._elementsMap.get(t)}getElementsByIds(t){return t.map(e=>this.getElementById(e)).filter(e=>e!==void 0)}getIndexById(t){return this.hasElement(t)&&this._elementList.forEachBreak((e,s)=>{if(e.value.id===t)return s},e=>{if(e.value.id===t)return!0}),-1}addElement(t,e,s){const n=new fn(t);return t.node=n,e?this._elementList.insertAfter(n,e.node):s?this._elementList.prepend(n):this._elementList.insert(n),this._elementsMap.set(t.id,t),t}beforeAddElement(t,e,s){const n=new fn(t);return t.node=n,e?this._elementList.insertBefore(n,e.node):s?this._elementList.insert(n):this._elementList.prepend(n),this._elementsMap.set(t.id,t),t}_createElementByModel(t){const e=F.createElement(t,this.shield);return Object.assign(e,{status:Q.finished,isOnStage:!0,isSelected:!0}),e}afterAddElementByModel(t,e,s){const n=this._createElementByModel(t);return this.addElement(n,e,s),n.refresh(),n}beforeAddElementByModel(t,e,s){const n=this._createElementByModel(t);return this.beforeAddElement(n,e,s),n.refresh(),n}removeElement(t){if(this.hasElement(t)){let e=this._elementsMap.get(t);return this._elementList.removeBy(s=>s.value.id===t),this._elementsMap.delete(t),e=null,e}}updateElementById(t,e){if(this.hasElement(t)){const s=this._elementsMap.get(t);return Object.assign(s,e),s}}updateElements(t,e){return t.forEach(s=>this.updateElementById(s.id,e)),t}updateElementModel(t,e){if(this.hasElement(t)){const s=this._elementsMap.get(t),n=s.model.id;return W.deepPlanObjectAssign(s.model,e,{id:n}),s}}updateElementsModel(t,e){t.forEach(s=>{this.updateElementModel(s.id,e)})}createElementModel(t,e,s){const n=F.calcSize({coords:e,boxCoords:O.getBoxByPoints(e),type:t}),r=F.calcPosition({type:t,coords:e});return{...F.createEmptyObject(),type:t,coords:e,boxCoords:O.getBoxByPoints(e),data:s,width:n.width,height:n.height,name:`${Ar.getCreatorByType(t).name} ${+new Date}`,styles:pn(t),isRatioLocked:!1,...r,...Ys,...Rt}}_setElementProvisionalCreating(t){this.updateElementById(t.id,{status:Q.creating,isOnStage:!1,isProvisional:!0,isSelected:!0})}_createProvisionalElement(t){const e=F.createElement(t,this.shield);return this._currentCreatingElementId=e.id,this.updateElementById(e.id,{status:Q.startCreating}),this.addElement(e),e}creatingElement(t){let e;const{category:s,type:n}=this.shield.currentCreator;switch(s){case he.shapes:{const r=this.createElementModel(n,F.calcCreatorPoints(t,n));this._currentCreatingElementId?(delete r.id,e=this.updateElementModel(this._currentCreatingElementId,r),e.model.boxCoords=O.getBoxByPoints(e.model.coords),this._setElementProvisionalCreating(e)):e=this._createProvisionalElement(r)}}return this.selectElement(e),e.refresh(),e}creatingArbitraryElement(t,e){let s,n;return this._currentCreatingElementId?(s=this.getElementById(this._currentCreatingElementId),n=s.model,e?d.isPointClosest(t,n.coords[0],zi/this.shield.stageScale)?s.tailCoordIndex>0&&(n.isFold=!0):(n.coords.splice(n.coords.length-1,1,t),s.tailCoordIndex=n.coords.length-1):s.tailCoordIndex+1===n.coords.length?n.coords.push(t):n.coords.splice(s.tailCoordIndex+1,1,t),s.model.boxCoords=O.getBoxByPoints(s.model.coords),this._setElementProvisionalCreating(s)):(n=this.createElementModel(I.arbitrary,[t]),n.isFold=!1,s=this._createProvisionalElement(n),s.tailCoordIndex=0),this.selectElement(s),s.refresh({size:!0,points:!0,position:!0}),s}_finishArbitraryElement(t){const e=t.tailCoordIndex;t.tailCoordIndex=-1,e<t.model.coords.length-1&&(t.model.coords=t.model.coords.slice(0,e+1))}finishCreatingElement(){if(this._currentCreatingElementId){let t=this.getElementById(this._currentCreatingElementId);if(t){this._currentCreatingElementId=null;const{model:{type:e}}=t;switch(e){case I.arbitrary:{this._finishArbitraryElement(t);break}}return this.updateElementById(t.id,{status:Q.finished}),t.model.boxCoords=O.getBoxByPoints(t.model.coords),t.refresh(),t}}}findElements(t){const e=[];return this._elementList.forEach(s=>{t(s.value)&&e.push(s.value)}),e}updateElementsTransform(t,e){t.forEach(s=>{s.transform(e),s.isGroup&&!s.isGroupSubject&&s.deepSubs.forEach(n=>{const{transformLockCoord:r,transformLockIndex:o,originalTransformMoveCoord:a,transformType:l,model:{angle:c,leanYAngle:h}}=s;n.transformBy({lockCoord:r,lockIndex:o,originalMovingCoord:a,offset:e,groupAngle:c,groupLeanYAngle:h,transformType:l})})})}updateElementsCorner(t,e){t.forEach(s=>{s.updateCornerByOffset(e)})}updateElementsTranslate(t,e){t.forEach(s=>{s.translateBy(e),!s.isOnStage&&this._updateElementStageStatusIfy(s)})}forEach(t){this._elementList.forEach((e,s)=>{t(e.value,s)})}refreshElementsOriginals(t,e){this._refreshElementsByFunc(t,s=>s.refreshOriginalProps(),e)}refreshElementsOriginalAngles(t,e){this._refreshElementsByFunc(t,s=>s.refreshOriginalAngle(),e)}_refreshElementsByFunc(t,e,s){s=Object.assign({},lo,s||{});let n=new Set;function r(o){n.has(o.id)||(n.add(o.id),e(o))}t.forEach(o=>{r(o),o.isGroup&&(s.deepSubs?o.deepSubs.forEach(r):s.subs&&o.subs.forEach(r))}),n.clear(),n=null}_updateElementStageStatusIfy(t){const e=t.isModelPolygonOverlap(this.shield.stageWordRectCoords);this.updateElementById(t.id,{isOnStage:e})}refreshStageElements(){this._elementList.forEach(({value:t})=>{this._updateElementStageStatusIfy(t),t.refresh({points:!0,rotation:!0,originals:!0,outline:!0,strokes:!0})})}refreshElements(t){t.forEach(e=>{e.refresh()})}isSelectedContainsTarget(){return this.isTargetEmpty?!1:k.every(Array.from(this._targetElementIds),t=>this._selectedElementIds.has(t))}refreshRotatingStates(t){this.refreshElementsRotationStates(this.rotatingTargetElements,t)}refreshElementsRotationStates(t,e){const{center:s,centerCoord:n,angle:r}=this.calcRotatingStatesByElements(e,t);this._rotatingCenter=s,this._rotatingCenterCoord=n,this._rotatingOriginalAngle=r}calcRotatingStatesByElements(t,e){const s=d.calcCenter(e.map(o=>o.centerCoord).flat()),n=F.calcStageRelativePoint(s),r=d.precise(d.calcAngle(n,t));return{center:n,centerCoord:s,angle:r}}clearRotatingStates(){this._rotatingCenter=null,this._rotatingCenterCoord=null,this._rotatingOriginalAngle=null}updateElementsRotation(t,e){const s=d.precise(d.calcAngle(this._rotatingCenter,e));this.rotateElements(t,s,this._rotatingOriginalAngle,this._rotatingCenterCoord)}rotateElements(t,e,s,n){t.forEach(r=>{r.model.type!==I.line&&(e=d.mirrorAngle(r.originalAngle+e-s),e=d.precise(e,1)),r.setAngle(e),!r.isOnStage&&this._updateElementStageStatusIfy(r),r.isGroup&&r.deepSubs.forEach(o=>{o.rotateBy(e-r.originalAngle,n),!o.isOnStage&&this._updateElementStageStatusIfy(o)})})}async createImageElementModel(t,e){const{colorSpace:s}=e,{width:n,height:r}=t,o=O.getBoxByCenter(this.shield.stageWorldCoord,{width:n,height:r}),a=d.calcCenter(o);return{...F.createEmptyObject(),coords:o,boxCoords:O.getBoxByPoints(o),type:I.image,data:t,name:"image",width:n,height:r,length:0,styles:pn(I.image),colorSpace:s,naturalWidth:n,naturalHeight:r,isRatioLocked:!0,...a,...Rt}}async insertImageElement(t){let e;t instanceof ImageData&&(e=t.colorSpace,t=Fs.createImageFromImageData(t),await Fs.waitForImageLoad(t));const s=await this.createImageElementModel(t,{colorSpace:e});return this.afterAddElementByModel(s)}insertTextElement(t,e,s){const n=v.createTextData(t,e),r=this.createElementModel(I.text,s,n);return this.afterAddElementByModel(r)}deleteSelects(){this.selectedElements.forEach(t=>{this.removeElement(t.id)})}selectElement(t){this.updateElementById(t.id,{isSelected:!0})}deSelectElement(t){this.updateElementById(t.id,{isSelected:!1})}selectElements(t){t.forEach(e=>{this.selectElement(e)})}deSelectElements(t){t.forEach(e=>{this.deSelectElement(e)})}toggleSelectElement(t){t.isSelected?this.deSelectElement(t):this.selectElement(t)}toggleSelectElements(t){t.forEach(e=>{this.toggleSelectElement(e)})}selectAll(){this._elementList.forEach(t=>{this.selectElement(t.value)})}deSelectAll(){this._elementList.forEach(t=>{this.deSelectElement(t.value)})}cancelTargetElements(){this.targetElements.forEach(t=>{this.updateElementById(t.id,{isTarget:!1})})}beginEditingElements(t){this._setElementsEditing(t,!0)}endEditingElements(t){this._setElementsEditing(t,!1)}getFinishedSelectedElements(t){return this.selectedElements.filter(e=>e.status===Q.finished&&(t?!e.isGroupSubject:!0))}getSelectedElements(t){return this.selectedElements.filter(e=>t?!e.isGroupSubject:!0)}_setElementsEditing(t,e){t.forEach(s=>{s.editingEnable&&e!==s.isEditing&&(this.updateElementById(s.id,{isEditing:e,status:e?Q.editing:Q.finished}),s.tfRefreshAfterEdChanged&&s.refresh())})}isSelectedEqCreating(){const t=new Set(this.selectedElements.map(s=>s.id)),e=new Set(this.creatingElements.map(s=>s.id));return k.isEqual(t,e)}_bindElementsGroup(t){t.subs.forEach(e=>{this.updateElementModel(e.id,{groupId:t.id})})}_unbindElementsGroup(t){this.updateElementsModel(t.getSubs(),{groupId:void 0}),this.updateElementModel(t.id,{subIds:[]})}_createElementGroupObject(t){t=t.filter(l=>!l.isGroupSubject);const e=t.map(l=>l.id),s=O.getBoxByPoints(t.map(l=>l.rotateCoords).flat()),{width:n,height:r,x:o,y:a}=O.getRect(s);return{...F.createEmptyGroupObject(),subIds:e,coords:s,boxCoords:O.getBoxByPoints(s),width:n,height:r,x:o+n/2,y:a+r/2}}_sortElementsByLevel(t){return t.sort((e,s)=>this.getIndexById(e.id)-this.getIndexById(s.id))}_rearrangeForwardElementNodes(t){let e=t;if(!Ss.isConsecutive(t.map(s=>s.node))){e=this._sortElementsByLevel(t);const s=e[e.length-1];this._removeNodesByElements(e.slice(0,e.length-1));for(let n=0;n<=e.length-2;n++)this._elementList.insertBefore(e[n].node,s.node,!1)}return e}createElementGroup(t){const e=this._rearrangeForwardElementNodes(t),s=new Ks(this._createElementGroupObject(e),this.shield);return this._bindElementsGroup(s),this.addElement(s,e[e.length-1]),this.updateElementById(s.id,{status:Q.finished,isOnStage:!0}),s.refresh(),s}removeElementGroup(t){this.hasElementGroup(t.id)&&(this._unbindElementsGroup(t),this.deSelectGroup(t),this.removeElement(t.id))}hasElementGroup(t){return this.hasElement(t)}selectToGroup(){const t=this.selectedElements;return t.length<2||F.isSameAncestorGroup(t)?null:this.createElementGroup(t)}cancelGroups(t){t.forEach(e=>{this.removeElementGroup(e)})}getSelectedElementGroups(){return this.selectedElements.filter(t=>t.model.type===I.group)}getSelectedAncestorElementGroups(){return F.getNoParentElements(this.getSelectedElementGroups())}selectGroup(t){this.updateElementById(t.id,{isSelected:!0})}deSelectGroup(t){this.updateElementById(t.id,{isSelected:!1})}deSelectGroups(t){t.forEach(e=>{this.deSelectGroup(e)})}async copySelectElements(){return Promise.all(this.selectedElements.map(async t=>await t.toJson()))}async pasteElements(t){const e=[],s=F.convertElementsJson(t);for(const n of s){await F.convertElementModel(n);const r=this.afterAddElementByModel(n);e.push(r)}return e}rearrangeElementAfter(t,e,s){const{node:n}=t;this._elementList.remove(n,!1),e?this._elementList.insertAfter(n,e.node,!1):s?this._elementList.prepend(n,!1):this._elementList.insert(n,!1)}rearrangeElementBefore(t,e,s){const{node:n}=t;this._elementList.remove(n,!1),e?this._elementList.insertBefore(n,e.node,!1):s?this._elementList.insert(n,!1):this._elementList.prepend(n,!1)}_removeNodesByElements(t){const e=[];return t.forEach(s=>{const[n]=this._elementList.removeBy(r=>r.value.id===s.id,!1);e.push(n)}),e}_getPrevmostElement(t){let e=t.subs[0];return e&&e.isGroup&&(e=this._getPrevmostElement(e)),e}_doElementsGoDown(t){let s=t[0].node.prev;s!=null&&s.value.isGroup&&(s=this._getPrevmostElement(s.value).node);const n=this._removeNodesByElements(t);s?n.forEach(r=>{this._elementList.insertBefore(r,s,!1)}):n.reverse().forEach(r=>{this._elementList.prepend(r,!1)})}async setElementsGoDown(t){t.length!==0&&(this._doElementsGoDown(t),this.resortElementsArray(),this.emitElementsLayerChanged())}_doElementsShiftMove(t){let s=t[t.length-1].node.next;s!=null&&s.value.isGroupSubject&&(s=s.value.ancestorGroup.node);const n=this._removeNodesByElements(t);s?n.forEach(r=>{this._elementList.insertAfter(r,s,!1),s=r}):n.forEach(r=>{this._elementList.insert(r,!1)})}async setElementsShiftMove(t){t.length!==0&&(this._doElementsShiftMove(t),this.resortElementsArray(),this.emitElementsLayerChanged())}async setElementsParagraphSpacing(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.setParagraphSpacing(e)})}}class Zs extends rs{constructor(e){super();g(this,"tasks");g(this,"running");this.tasks=e}isEmpty(){return this.tasks.length===0}add(e){this.running||e&&this.tasks.push(e)}addAll(e){e.forEach(s=>{this.add(s)})}prepend(e){this.running||e&&this.tasks.unshift(e)}async run(){for(this.running=!0;this.tasks.length>0;){let e=this.tasks.shift();if(e)try{await e.run()}catch{}finally{e.destroy&&await e.destroy(),e=null}}this.running=!1}}class Ke extends rs{constructor(e,s){super();g(this,"model");g(this,"canvas");this.model=e,this.canvas=s}destroy(){return this.model=null,this.id=null,this.canvas=null,Promise.resolve()}}class sa extends Ke{async run(){var s,n;if(!this.canvas||!this.model)return;const{width:t}=_n.strokes[0];let{points:e}=this.model;e=F.calcStageRelativePoints(e),[Ce.selection,Ce.path].includes(this.model.type),Y.drawPathWithScale(this.canvas,e,{},{..._n.strokes[0],width:t/Y.scale},{isFold:typeof((s=this.model.element)==null?void 0:s.isFold)>"u"?!0:(n=this.model.element)==null?void 0:n.isFold})}}class An extends Ke{async run(){var t;this.canvas&&((t=this.canvas.getContext("2d"))==null||t.clearRect(0,0,this.canvas.width,this.canvas.height))}}class na extends Ke{async run(){if(!this.canvas||!this.model)return;const{width:t}=Lt.strokes[0];let{point:e,leanYAngle:s,actualAngle:n}=this.model;e=F.calcStageRelativePoint(e),Y.drawPathWithScale(this.canvas,O.getBoxByCenter(e,{width:$t/Y.scale,height:$t/Y.scale},{angle:n,leanYAngle:s}),Lt.fills[0],{...Lt.strokes[0],width:t/Y.scale},{calcVertices:!1})}}class Lr{static wait(t){return new Promise(e=>{setTimeout(()=>{e()},t)})}}class Kt{constructor(){g(this,"running");g(this,"queue");g(this,"stopped");this.running=!1,this.queue=[],this.stopped=!1}async add(t){this.stopped||(this.queue.push(t),this.running||(this.running=!0,await this.run()))}async run(){if(this.stopped)return;if(this.queue.length===0){this.running=!1;return}let t=this.queue.shift();if(t)try{await t.run()}catch{}finally{t.destroy&&await t.destroy(),t=null}this.queue.length>0?requestAnimationFrame(()=>{this.run()}):this.running=!1}async wait(){for(;this.running;)await Lr.wait(10)}async destroy(){await this.wait(),this.stopped=!0,this.queue=null,this.running=!1}}class ra extends Kt{}class en{constructor(t){g(this,"drawer");g(this,"renderQueue");this.drawer=t,this.renderQueue=new Kt}async renderCargo(t){await this.renderQueue.add(t)}get canvas(){return this.drawer.node}clear(){throw new Error("Method not implemented.")}async redraw(t){throw new Error("Method not implemented.")}}const ia="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1735111770421'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1464'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M510.9%2064.7c-108.7%200-214%2040.4-295%20111.8L107.3%2068v299.4h299.4L295.4%20256.1c60.3-51.3%20134.9-80.6%20215.5-80.6%20184.8%200%20335.2%20150.3%20335.2%20335.2S695.7%20845.8%20510.9%20845.8%20175.7%20695.4%20175.7%20510.6H64.9c0%20245.8%20200.1%20445.9%20445.9%20445.9s445.9-200.1%20445.9-445.9-200-445.9-445.8-445.9z'%20fill='%231296db'%20p-id='1465'%3e%3c/path%3e%3c/svg%3e";class oa extends Ke{get svg(){return ia}async run(){if(!this.canvas||!this.model)return;let{point:t,width:e,height:s}=this.model;t=F.calcStageRelativePoint(t),await Y.drawImgLike(this.canvas,this.svg,{x:(t.x-e/Y.scale/2)*Y.scale,y:(t.y-s/Y.scale/2)*Y.scale,width:e,height:s},{angle:this.model.angle})}}class aa extends Ke{async run(){if(!this.canvas||!this.model)return;let{text:t,point:e}=this.model;e=F.calcStageRelativePoint(e),Y.drawCommonRotateTextWithScale(this.canvas,t,e,Rs,Rs.fills[0],{angle:this.model.angle})}}class la extends Ke{async run(){if(!this.canvas||!this.model)return;let{text:t,point:e}=this.model;e&&(e=F.calcStageRelativePoint(e),await Y.drawCommonRotateTextWithScale(this.canvas,t,e,En,En.fills[0]))}}class vs extends Ke{async run(){if(!this.canvas||!this.model)return;let{point:t}=this.model;if(!t)return;let{radius:e}=this.model;const s={...Lt.strokes[0]};s.width/=Y.scale;const n={...Lt.fills[0]};e/=Y.scale,t=F.calcStageRelativePoint(t),Y.drawEllipseFillWithScale(this.canvas,t,{rx:e,ry:e},n),Y.drawEllipseStrokeWithScale(this.canvas,t,{rx:e,ry:e},s)}}class ca extends Ne{async run(){!this.canvas||!this.element||ls.drawTextCursor(this.element,this.canvas,this.element.textCursor)}}class da extends Ne{async run(){if(!this.canvas||!this.element)return;const{textSelection:t,isSelectionAvailable:e,angle:s,flipX:n,leanY:r,actualAngle:o}=this.element;if(!e)return;const a={angle:s,flipX:n,leanY:r,actualAngle:o},{startCursor:l,endCursor:c}=t,{lineNumber:h}=l,{lineNumber:u}=c,f=xe.calcElementRenderRect(this.element);if(h===u)this._drawLineSelection(l,c,f,a);else{const{lines:m}=this.element.model.data;if(h<u)for(let C=h;C<=u;C++){const y=m[C];y.nodes.length===0?this._draweEmptyLine(y,f,a):C===h?this._drawPartialLine(y,l,V.RIGHT,f,a):C===u?this._drawPartialLine(y,c,V.LEFT,f,a):this._drawFullLine(y,f,a)}else for(let C=h;C>=u;C--){const y=m[C];y.nodes.length===0?this._draweEmptyLine(y,f,a):C===h?this._drawPartialLine(y,l,V.LEFT,f,a):C===u?this._drawPartialLine(y,c,V.RIGHT,f,a):this._drawFullLine(y,f,a)}}}_draweEmptyLine(t,e,s){const{x:n,y:r,height:o}=t,a={x:n,y:r,height:o,renderRect:e},l={x:n+4*Y.scale,y:r,height:o,renderRect:e};this._drawLineSelection(a,l,e,s)}_drawFullLine(t,e,s){const n=t.nodes[0];this._drawPartialLine(t,{...k.pick(n,["x","y","height"]),renderRect:e},V.RIGHT,e,s)}_drawPartialLine(t,e,s,n,r){if(s===V.LEFT){const o=t.nodes[0];this._drawLineSelection({...k.pick(o,["x","y","height"])},e,n,r)}else if(s===V.RIGHT){const o=t.nodes[t.nodes.length-1];this._drawLineSelection(e,{x:o.x+o.width,...k.pick(o,["y","height"])},n,r)}}_drawLineSelection(t,e,s,n){const r=Math.min(t.x,e.x),o=t.y,a=Math.abs(t.x-e.x),l=t.height;Y.drawRectInRenderRect(this.canvas,{...s,desX:r,desY:o,desWidth:a,desHeight:l},{color:ko,colorOpacity:Io},n)}}class Pn extends Ne{constructor(e,s,n){super(e,s);g(this,"cursorType");this.cursorType=n}async run(){if(!this.canvas||!this.element)return;const{textSelection:e}=this.element,s=e[this.cursorType===qt.START?"startCursor":"endCursor"];ls.drawTextCursor(this.element,this.canvas,s)}}class ha extends Ne{async run(){if(!this.canvas||!this.element)return;const{angle:t,flipX:e,leanY:s,actualAngle:n,model:{data:r}}=this.element,o={angle:t,flipX:e,leanY:s,actualAngle:n},a=xe.calcElementRenderRect(this.element);r.lines.forEach(l=>{this._drawUnderline(l,a,o)})}_drawUnderline(t,e,s){const{nodes:n=[]}=t;if(n.length){const{x:r,baseline:o}=n[0],{x:a,width:l}=n[n.length-1];Y.drawLineInRenderRect(this.canvas,{...e,desX:r,desY:o,desWidth:a+l-r},{color:Oo,colorOpacity:Ro,width:Lo},s)}}}class ua extends en{constructor(){super(...arguments);g(this,"_lastCursorRendered",!1);g(this,"_lastSelectionRendered",!1)}async redraw(){let e=new Zs([]),s=!1;const n=this.createMaskSelectionTasks();n.forEach(C=>{e.add(C)}),n.length&&(this._lastSelectionRendered=!0);const r=this.createMaskTransformerTasks();r.length&&e.addAll(r);const o=this.createControllerTasks();o.length&&e.addAll(o);const{store:{noParentElements:a},configure:{rotationIconEnable:l},selection:{rangeElement:c},cursor:h,isDrawerActive:u,isTextEditing:f}=this.drawer.shield;if(a.length===1){const C=a[0];l&&C.rotationEnable&&C.status===Q.finished&&e.add(this.createMaskRotateTask(C.rotation)),e.add(this.createMaskIndicatorTask(C))}else a.length>1&&e.add(this.createMaskRotateTask(c.rotation));const m=h.getTask();m&&(e.add(m),this._lastCursorRendered=!0,s=!0),u&&(e.add(this.createMaskCursorPositionTask()),e.add(this.createMaskArbitraryCursorTask())),f&&(e.add(this.createTextElementCursorTask()),e.add(this.createTextElementSelectionTask()),e.addAll(this.createTextElementSelectionCursorTasks())),e.addAll(this.createTextElementsHighlightUndelineTasks()),e.isEmpty()?(this._lastCursorRendered||this._lastSelectionRendered)&&!n.length&&!s?(e.add(new An(null,this.canvas)),await this.renderCargo(e),this._lastCursorRendered=!1,this._lastSelectionRendered=!1):e=null:(e.prepend(this.createMaskClearTask()),await this.renderCargo(e))}createMaskCursorPositionTask(){const{cursor:{worldValue:e},stageScale:s}=this.drawer.shield;if(!e)return;const n={point:{x:e.x+20/s,y:e.y+20/s},type:Ce.cursorPosition,text:`${d.precise(e.x,1)},${d.precise(e.y,1)}`};return new la(n,this.canvas)}createMaskSelectionTasks(){const{selection:e}=this.drawer.shield,s=[];return[...e.getModels(),e.selectionModel].forEach(r=>{if(r&&r.points.length>0){const o=new sa(r,this.canvas);s.push(o)}}),s}createMaskClearTask(){return new An(null,this.canvas)}createMaskTransformerTasks(){const{selection:{transformerModels:e}}=this.drawer.shield;return e.map(s=>{switch(s.element.transformerType){case nt.circle:return new vs(s,this.canvas);case nt.rect:return new na(s,this.canvas);default:return null}}).filter(s=>!!s)}createControllerTasks(){const{store:{primarySelectedElement:e},selection:{rangeElement:s}}=this.drawer.shield,n=e||s;if(n){const{controllers:r=[]}=n;return r.map(o=>{if(!(o instanceof Bt)&&!(o instanceof ft)&&!(o instanceof kt)){const a={point:{x:o.x,y:o.y},type:Ce.transformer,radius:ks};return new vs(a,this.canvas)}return null}).filter(o=>!!o)}return[]}createMaskRotateTask(e){const s={point:{x:e.x,y:e.y},type:Ce.rotate,...k.pick(e,["points","angle","width","height"])};return new oa(s,this.canvas)}createMaskIndicatorTask(e){const{stageScale:s}=this.drawer.shield;let n,r;switch(e.model.type){case I.line:{[n,r]=[...e.rotateCoords].sort((l,c)=>l.x-c.x);break}default:{if(e.model.angle%90===0&&e.model.leanYAngle===0){const{maxBoxCoords:l}=e;n=l[3],r=l[2]}else{const[l,c,h]=O.getLBRPoints(e.rotateBoxCoords,!0);let u=d.transformToAcuteAngle(d.calcAngle(c,l)+180),f=d.transformToAcuteAngle(d.calcAngle(c,h)+180);[n,r]=[u<f?l:h,c].sort((C,y)=>C.x-y.x)}break}}const o=d.calcAngle(n,r),a={point:d.calcSegmentLineCenterCrossPoint(n,r,!0,So/s),angle:o,type:Ce.indicator,text:`${e.width} x ${e.height}`};return new aa(a,this.canvas)}createMaskArbitraryCursorTask(){const{currentCreator:e,cursor:s}=this.drawer.shield;if(e.category===he.freedom){const n={point:s.value,type:Ce.cursor,radius:ks};return new vs(n,this.canvas)}}_getEditingTextElement(){const{isEditingEmpty:e,editingElements:s}=this.drawer.shield.store;if(e)return null;const n=s[0];return n instanceof et?n:null}createTextElementCursorTask(){const e=this._getEditingTextElement();return e&&e.isCursorVisible?new ca(e,this.canvas):null}createTextElementSelectionCursorTasks(){const e=this._getEditingTextElement();return e?e.isSelectionAvailable?[new Pn(e,this.canvas,qt.START),new Pn(e,this.canvas,qt.END)]:[]:[]}createTextElementSelectionTask(){const e=this._getEditingTextElement();return e&&e.isSelectionAvailable?new da(e,this.canvas):null}createTextElementsHighlightUndelineTasks(){const e=[];return this.drawer.shield.store.targetElements.forEach(s=>{!s.isSelected&&!s.isEditing&&s instanceof et&&e.push(new ha(s,this.canvas))}),e}}class cs extends Qs.EventEmitter{constructor(e){super();g(this,"node");g(this,"renderer");g(this,"shield");this.shield=e}initNode(){return this.node=document.createElement("canvas"),this.initStyle(),this.node}initStyle(){this.node.style.position="absolute",this.node.style.top="0",this.node.style.left="0"}updateSize(e){this.node instanceof HTMLCanvasElement?(this.node.width=e.width,this.node.height=e.height):(this.node.style.width=`${e.width}px`,this.node.style.height=`${e.height}px`)}clear(){var e;this.node instanceof HTMLCanvasElement?(e=this.node.getContext("2d"))==null||e.clearRect(0,0,this.node.width,this.node.height):this.node.innerHTML=""}async redraw(e){await this.renderer.redraw(e)}}class fa extends cs{constructor(t){super(t),this.renderer=new ua(this)}initNode(){return super.initNode(),this.node.id="mask",this.node.style.pointerEvents="none",this.node}}class Rr extends Ne{async run(){var t;this.canvas&&((t=this.canvas.getContext("2d"))==null||t.clearRect(0,0,this.canvas.width,this.canvas.height))}}class ga extends en{constructor(){super(...arguments);g(this,"_latestElementRendered");g(this,"_latestClearRendered")}async redraw(){let e=new Zs([]);const{creatingElements:s}=this.drawer.shield.store;s.length>0&&(s.forEach(n=>{const r=F.createElementTask(n,this.canvas);r&&e.add(r)}),this._latestElementRendered=!0),this._latestClearRendered=e.isEmpty()&&this._latestElementRendered,!e.isEmpty()||this._latestClearRendered?(e.prepend(new Rr(null,this.canvas)),await this.renderCargo(e),this._latestClearRendered&&(this._latestClearRendered=!1)):e=null}}class ma extends cs{constructor(t){super(t),this.renderer=new ga(this)}initNode(){return super.initNode(),this.node.id="provisional",this.node.style.pointerEvents="none",this.node}}class pa{constructor(t){g(this,"shield");g(this,"rangeElement");g(this,"_selectionModel");g(this,"_transformerModels",[]);g(this,"_rangeCoords",null);this.shield=t,this.rangeElement=new Ks({...F.createEmptyGroupObject()},this.shield,!0),this.rangeElement.status=Q.finished}get isEmpty(){const{isSelectedEmpty:t,isTargetEmpty:e,isRangeEmpty:s}=this.shield.store;return t&&e&&s}get isRange(){return this._rangeCoords!==null&&this._rangeCoords.length>0}get selectionModel(){return this._selectionModel}get transformerModels(){return this._transformerModels}get center(){return null}get internalAngle(){return 0}setRange(t){this._rangeCoords=t,this.refreshRangeElements(this._rangeCoords)}_getElementMaskModelProps(t,e){const{rotateCoords:s,rotateBoxCoords:n,model:{angle:r,isFold:o}}=t;return{points:e?n:s,angle:r,element:{isFold:o}}}_getElementsMaskModels(t,e){const s=[];return t.forEach(n=>{n&&(n.isGroupSubject||s.push({type:e,...this._getElementMaskModelProps(n)}))}),s}_getRangeElementsMaskModels(){return this._getElementsMaskModels(this.shield.store.rangeElements,Ce.path)}_getTargetElementsMaskModels(){return this._getElementsMaskModels(this.shield.store.targetElements,Ce.path)}_getSelectedElementsMaskModels(){const{store:t}=this.shield;return this._getElementsMaskModels([t.primarySelectedElement||t.creatingElements[0]],Ce.path)}getModels(){const t=[];return this.isRange&&t.push(...this._getRangeElementsMaskModels()),t.push(...this._getTargetElementsMaskModels()),t.push(...this._getSelectedElementsMaskModels()),this.isRange&&t.push({points:this._rangeCoords,type:Ce.range}),t}calcSelectionModel(){if(this.shield.store.isSelectedEmpty)return;const t=this.shield.store.primarySelectedElement||this.rangeElement;if(t&&t.boxVerticesTransformEnable&&t.model.coords.length>0)return{type:Ce.selection,points:t.rotateBoxCoords,angle:t.model.angle}}calcTransformerModels(){if(this.shield.store.isSelectedEmpty)return[];const{primarySelectedElement:t,creatingElements:e}=this.shield.store,s=t||e[0]||this.rangeElement;if(s&&s.transformersEnable&&s.model.coords.length>0){const{transformerType:n,angle:r,leanYAngle:o,actualAngle:a,transformers:l,coordTransformEnable:c,boxVerticesTransformEnable:h,flipX:u,flipY:f}=s;if(c||h)return this.calcTransformerModelsByPoints(l,{angle:r,leanYAngle:o,actualAngle:a,flipX:u,flipY:f},c?n:nt.rect)}return[]}calcTransformerModelsByPoints(t,e,s){return t.map(n=>({point:n,type:Ce.transformer,element:{transformerType:s},radius:ks,...e}))}clearSelects(){const{store:t}=this.shield;t.deSelectElements(t.selectedElements)}hitTargetElements(t){const{store:e}=this.shield;for(let s=e.stageElements.length-1;s>=0;s--){const n=e.stageElements[s],r=n.isContainsCoord(t);if(e.updateElementById(n.id,{isTarget:r}),r){e.targetElements.forEach(o=>{o.id!==n.id&&e.updateElementById(o.id,{isTarget:!1})});break}}}selectTargets(){this.shield.store.updateElements(this.shield.store.targetElements,{isSelected:!0,isTarget:!1})}refreshRangeElements(t){if(t&&t.length){const{store:e}=this.shield;e.stageElements.forEach(s=>{e.updateElementById(s.id,{isInRange:s.isPolygonOverlap(t)})})}}selectRange(){if(this.isRange){const{store:t}=this.shield;t.updateElements(t.rangeElements,{isSelected:!0,isInRange:!1})}}getElementOnCoord(t){const e=this.shield.store.stageElements;for(let s=e.length-1;s>=0;s--){const n=e[s];if(n.isContainsCoord(t))return n}}refreshSelectionModel(){this._selectionModel=this.calcSelectionModel()}refreshTransformerModels(){this._transformerModels=this.calcTransformerModels()}refreshRangeElement(){const t=this.shield.store.selectedElements;if(t.length===0)Object.assign(this.rangeElement.model,F.createEmptyGroupObject());else{if(!this.rangeElement.isRotating&&!this.rangeElement.isTransforming){const e=O.getBoxByPoints(t.map(s=>s.rotateCoords).flat());Object.assign(this.rangeElement.model,{coords:e,boxCoords:W.jsonClone(e),...O.getRect(e),subIds:t.map(s=>s.id),...Ys})}this.rangeElement.isTransforming?this.rangeElement.refresh({points:!0,size:!0,rotation:!0,angles:!0,outline:!0,strokes:!0}):this.rangeElement.refresh()}}refresh(){this.refreshRangeElement(),this.refreshSelectionModel(),this.refreshTransformerModels()}tryActiveController(t){if(this.shield.store.isSelectedEmpty)return;const e=this.shield.store.primarySelectedElement||this.rangeElement;if(e){const s=e.getControllerByCoord(t);if(e.setControllersActive(e.controllers.filter(n=>n.id!==(s==null?void 0:s.id)),!1),s)return e.setControllersActive([s],!0),s}}getActiveController(){if(this.shield.store.isSelectedEmpty)return;const t=this.shield.store.primarySelectedElement||this.rangeElement;if(t)return t.getActiveController()}}const Ca="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1735892982581'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='15410'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M552.224%20179.712v664.576l68.704-68.704a36.576%2036.576%200%200%201%2051.712%2051.712l-130.24%20130.208a36.48%2036.48%200%200%201-26.72%2011.648h-0.064-0.032c-9.024%200-17.28-3.264-23.648-8.704l0.064%200.032a36.48%2036.48%200%200%201-4.576-3.872l-129.28-129.312a36.576%2036.576%200%200%201%2051.712-51.712l69.216%2069.216V179.232l-69.216%2069.216a36.576%2036.576%200%200%201-51.712-51.712l129.28-129.28c1.472-1.472%202.976-2.752%204.576-3.904a36.48%2036.48%200%200%201%2050.4%202.944l0.032%200.032%20130.24%20130.208a36.576%2036.576%200%200%201-51.712%2051.712l-68.704-68.704z'%20p-id='15411'%20fill='%232c2c2c'%3e%3c/path%3e%3c/svg%3e",ya="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1735887761508'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='7589'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M641.264941%20791.853176l42.586353%2042.586353L512%201006.351059l-171.911529-171.91153%2042.586353-42.586353L481.882353%20891.060706v-227.20753h60.235294v227.20753l99.147294-99.20753zM481.882353%20132.939294v227.20753h60.235294V132.939294l99.147294%2099.147294%2042.586353-42.586353L512%2017.648941%20340.088471%20189.500235l42.586353%2042.586353L481.882353%20132.939294zM0%20481.882353v60.235294h1024V481.882353H0z'%20fill='%232c2c2c'%20p-id='7590'%3e%3c/path%3e%3c/svg%3e",_a="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1737787540457'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1497'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M870.4%20204.8c-18.6368%200-36.1472%205.0176-51.2%2013.7728l0-64.9728c0-56.4736-45.9264-102.4-102.4-102.4-21.0944%200-40.6528%206.4-56.9856%2017.3568-14.0288-39.8848-52.0192-68.5568-96.6144-68.5568s-82.6368%2028.672-96.6144%2068.5568c-16.2816-10.9568-35.8912-17.3568-56.9856-17.3568-56.4736%200-102.4%2045.9264-102.4%20102.4l0%20377.4976-68.9152-119.4496c-13.3632-24.32-35.1744-41.6256-61.3888-48.7936-25.5488-6.9632-52.1216-3.2768-74.8544%2010.3424-46.4384%2027.8528-64.1536%2090.8288-39.424%20140.3904%201.536%203.1232%2034.2016%2070.0416%20136.192%20273.92%2048.0256%2096%20100.7104%20164.6592%20156.6208%20203.9808%2043.8784%2030.8736%2074.1888%2032.4608%2079.8208%2032.4608l256%200c43.5712%200%2084.0704-14.1824%20120.4224-42.0864%2034.1504-26.2656%2063.7952-64.256%2088.064-112.8448%2047.8208-95.6416%2073.1136-227.9424%2073.1136-382.6688l0-179.2c0-56.4736-45.9264-102.4-102.4-102.4zM921.6%20486.4c0%20146.7904-23.3984%20271.1552-67.6864%20359.7312-28.8768%2057.7536-80.5888%20126.6688-162.7136%20126.6688l-255.488%200c-1.9968-0.1536-23.552-2.56-56.064-26.88-32.4096-24.2688-82.176-75.3664-135.0656-181.248-103.7824-207.5648-135.68-272.9472-135.9872-273.5616-0.0512-0.1024-0.0512-0.1536-0.1024-0.2048-12.8512-25.7536-3.7376-59.4944%2019.9168-73.6768%2010.6496-6.4%2023.0912-8.0896%2035.072-4.864%2012.7488%203.4816%2023.4496%2012.0832%2030.0544%2024.1664%200.1024%200.1536%200.2048%200.3584%200.3072%200.512l79.9232%20138.496c16.3328%2029.8496%2034.7136%2042.3936%2054.6304%2037.3248%2019.968-5.0688%2030.0544-25.0368%2030.0544-59.2384l0-400.0256c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20332.8c0%2014.1312%2011.4688%2025.6%2025.6%2025.6s25.6-11.4688%2025.6-25.6l0-384c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20384c0%2014.1312%2011.4688%2025.6%2025.6%2025.6s25.6-11.4688%2025.6-25.6l0-332.8c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20384c0%2014.1312%2011.4688%2025.6%2025.6%2025.6s25.6-11.4688%2025.6-25.6l0-230.4c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20179.2z'%20fill='%23000000'%20p-id='1498'%3e%3c/path%3e%3c/svg%3e",Ea="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1736172747971'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='4849'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M512%200a36.571429%2036.571429%200%200%201%2036.571429%2036.571429v950.857142a36.571429%2036.571429%200%200%201-73.142858%200V36.571429A36.571429%2036.571429%200%200%201%20512%200z'%20fill='%23000000'%20p-id='4850'%3e%3c/path%3e%3cpath%20d='M0%20509.074286a36.571429%2036.571429%200%200%201%2036.571429-36.571429h950.857142a36.571429%2036.571429%200%200%201%200%2073.142857H36.571429a36.571429%2036.571429%200%200%201-36.571429-36.571428z'%20fill='%23000000'%20p-id='4851'%3e%3c/path%3e%3c/svg%3e",xa="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1737790480190'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='8613'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M550.034286%20633.904762v154.331428l58.392381-56.661333%2050.95619%2052.46781-144.505905%20140.288-147.065904-140.01981%2050.419809-52.979809%2058.684953%2055.832381-0.024381-153.283048h73.142857z%20m234.008381-269.287619l140.288%20144.505905-140.01981%20147.065904-52.979809-50.419809%2055.832381-58.684953H633.904762v-73.142857h154.331428l-56.661333-58.368%2052.46781-50.95619z%20m-544.231619%200l52.467809%2050.95619-56.685714%2058.368H390.095238v73.142857H236.690286l55.832381%2058.684953-52.955429%2050.419809-140.019809-147.065904%20140.263619-144.505905zM514.876952%2099.669333l144.505905%20140.288-50.95619%2052.46781-58.368-56.661333L550.034286%20390.095238h-73.142857V236.81219l-58.660572%2055.832381-50.419809-52.979809%20147.065904-140.01981z'%20p-id='8614'%3e%3c/path%3e%3c/svg%3e",Sa="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1740288855242'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='38476'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M679.338667%20849.152a4.266667%204.266667%200%200%200%206.656%200l161.792-202.24a4.266667%204.266667%200%200%200-3.328-6.912H736v-32a320%20320%200%200%200-320-320H384V179.541333a4.266667%204.266667%200%200%200-6.912-3.328l-202.24%20161.792a4.266667%204.266667%200%200%200%200%206.656l202.24%20161.792A4.266667%204.266667%200%200%200%20384%20503.125333V394.666667h32a213.333333%20213.333333%200%200%201%20213.333333%20213.333333V640h-108.458666a4.266667%204.266667%200%200%200-3.328%206.912l161.792%20202.24z'%20fill='%23000000'%20p-id='38477'%3e%3c/path%3e%3cpath%20d='M685.994667%20849.152l-13.312-10.666667%2013.312%2010.666667z%20m-6.656%200l13.312-10.666667-13.312%2010.666667z%20m168.448-202.24l-13.312-10.666667%2013.312%2010.666667zM736%20640v17.066667h-17.066667V640h17.066667zM384%20288v17.066667h-17.066667v-17.066667H384z%20m-6.912-111.786667l10.666667%2013.312-10.666667-13.312z%20m-202.24%20161.792l10.666667%2013.312-10.666667-13.312z%20m0%206.656l-10.666667%2013.312%2010.666667-13.312z%20m202.24%20161.792l10.666667-13.312-10.666667%2013.312zM384%20394.666667h-17.066667v-17.066667H384v17.066667zM629.333333%20640h17.066667v17.066667h-17.066667V640z%20m-111.786666%206.912l-13.312%2010.666667%2013.312-10.666667z%20m181.76%20212.906667a21.333333%2021.333333%200%200%201-33.28%200l26.624-21.333334a12.8%2012.8%200%200%200-19.968%200l26.624%2021.333334z%20m161.792-202.24l-161.792%20202.24-26.624-21.333334%20161.792-202.24%2026.624%2021.333334z%20m-16.64-34.645334a21.333333%2021.333333%200%200%201%2016.64%2034.645334l-26.624-21.333334a12.8%2012.8%200%200%200%209.984%2020.821334v-34.133334z%20m-108.458667%200h108.458667v34.133334H736v-34.133334z%20m-17.066667%2017.066667v-32h34.133334V640h-34.133334z%20m0-32a302.933333%20302.933333%200%200%200-302.933333-302.933333v-34.133334a337.066667%20337.066667%200%200%201%20337.066667%20337.066667h-34.133334z%20m-302.933333-302.933333H384v-34.133334h32v34.133334zM401.066667%20179.541333V288h-34.133334V179.541333h34.133334z%20m-34.645334-16.64a21.333333%2021.333333%200%200%201%2034.645334%2016.64h-34.133334a12.8%2012.8%200%200%200%2020.778667%209.984l-21.333333-26.624zM164.181333%20324.693333l202.24-161.792%2021.333334%2026.624-202.24%20161.792-21.333334-26.624z%20m0%2033.28a21.333333%2021.333333%200%200%201%200-33.28l21.333334%2026.624a12.8%2012.8%200%200%200%200-19.968l-21.333334%2026.624z%20m202.24%20161.792L164.181333%20357.973333l21.333334-26.624%20202.24%20161.792-21.333334%2026.624z%20m34.645334-16.64a21.333333%2021.333333%200%200%201-34.645334%2016.64l21.333334-26.624a12.8%2012.8%200%200%200-20.821334%209.984h34.133334z%20m0-108.458666v108.458666h-34.133334V394.666667h34.133334z%20m-17.066667-17.066667h32v34.133333H384v-34.133333z%20m32%200a230.4%20230.4%200%200%201%20230.4%20230.4h-34.133333a196.266667%20196.266667%200%200%200-196.266667-196.266667v-34.133333z%20m230.4%20230.4V640h-34.133333v-32h34.133333z%20m-125.525333%2014.933333h108.458666v34.133334h-108.458666v-34.133334z%20m-16.64%2034.645334a21.333333%2021.333333%200%200%201%2016.64-34.645334v34.133334a12.8%2012.8%200%200%200%209.984-20.778667l-26.624%2021.333333z%20m161.792%20202.24l-161.792-202.24%2026.624-21.333334%20161.792%20202.24-26.624%2021.333334z'%20fill='%23FFFFFF'%20p-id='38478'%3e%3c/path%3e%3c/svg%3e";class wt extends Ke{constructor(e,s,n){super(e,s);g(this,"type",Ae.vertices);this.type=n}get img(){switch(this.type){case Ae.vertices:return Ca;case Ae.border:return ya;case Ae.hand:return _a;case Ae.cross:return Ea;case Ae.move:return xa;case Ae.rotation:return Sa}}async run(){if(!this.canvas||!this.model)return;let{point:{x:e,y:s},width:n,height:r}=this.model;await Y.drawImgLike(this.canvas,this.img,{x:(e-n/Y.scale/2)*Y.scale,y:(s-r/Y.scale/2)*Y.scale,width:n,height:r},{angle:this.model.angle})}}class va{constructor(t){g(this,"value");g(this,"shield");this.shield=t,this.value=null}get worldValue(){return this.value?F.calcWorldCoord(this.value):null}clear(){this.value=null}transform(t){return this.shield.stageRect?(this.value=O.getEventPosition(t,this.shield.stageRect,this.shield.stageScale),this.value.x=Math.round(this.value.x),this.value.y=Math.round(this.value.y),this.value):{x:0,y:0}}setStyle(t){this.shield.node.style.cursor=t}updateStyle(t){this.shield.selection.getActiveController()||this.shield.isDrawerActive||this.shield.isTextCreating?this.setStyle("none"):this.shield.isHandActive?this.setStyle("grab"):this.shield.isTextEditing&&this.shield.store.editingElements.some(e=>e.isContainsCoord(this.worldValue))?this.setStyle("text"):this.setStyle("default")}getTask(){if(this.shield.isDrawerActive||this.shield.isTextCreating)return this.createMaskDrawingCursorTask();if(this.shield.isMoveableActive){const t=this.shield.selection.getActiveController();if(t instanceof Sr)return this.createMaskRotationControllerCursorTask(t);if(t instanceof Bt||t instanceof Xt)return this.createMaskRotationCursorTask(t);if(t instanceof ft)return this.createMaskTransformerCursorTask(t);if(t instanceof kt)return this.createMaskBorderTransformerCursorTask(t)}}createMaskDrawingCursorTask(){if(this.value)return new wt(this._createTransformerCursorModel(),this.shield.mask.node,Ae.cross)}createMaskRotationCursorTask(t){if(this.value)return new wt(this._createTransformerCursorModel({angle:t.angle}),this.shield.mask.node,Ae.move)}createMaskRotationControllerCursorTask(t){if(this.value)return new wt(this._createTransformerCursorModel({angle:t.angle}),this.shield.mask.node,Ae.rotation)}createMaskBorderTransformerCursorTask(t){if(this.value)return new wt(this._createTransformerCursorModel(t),this.shield.mask.node,Ae.border)}createMaskTransformerCursorTask(t){if(this.value)return new wt(this._createTransformerCursorModel(t),this.shield.mask.node,Ae.vertices)}_createTransformerCursorModel(t){return{point:this.value,type:Ce.cursor,width:xn,height:xn,angle:(t==null?void 0:t.angle)||0}}}class de{static stopPP(t){t.stopPropagation(),t.preventDefault()}}var kr=function(){if(typeof Map<"u")return Map;function i(t,e){var s=-1;return t.some(function(n,r){return n[0]===e?(s=r,!0):!1}),s}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(e){var s=i(this.__entries__,e),n=this.__entries__[s];return n&&n[1]},t.prototype.set=function(e,s){var n=i(this.__entries__,e);~n?this.__entries__[n][1]=s:this.__entries__.push([e,s])},t.prototype.delete=function(e){var s=this.__entries__,n=i(s,e);~n&&s.splice(n,1)},t.prototype.has=function(e){return!!~i(this.__entries__,e)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,s){s===void 0&&(s=null);for(var n=0,r=this.__entries__;n<r.length;n++){var o=r[n];e.call(s,o[1],o[0])}},t}()}(),Bs=typeof window<"u"&&typeof document<"u"&&window.document===document,Qt=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),ba=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(Qt):function(i){return setTimeout(function(){return i(Date.now())},1e3/60)}}(),wa=2;function Ta(i,t){var e=!1,s=!1,n=0;function r(){e&&(e=!1,i()),s&&a()}function o(){ba(r)}function a(){var l=Date.now();if(e){if(l-n<wa)return;s=!0}else e=!0,s=!1,setTimeout(o,t);n=l}return a}var Aa=20,Pa=["top","right","bottom","left","width","height","size","weight"],Oa=typeof MutationObserver<"u",La=function(){function i(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=Ta(this.refresh.bind(this),Aa)}return i.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},i.prototype.removeObserver=function(t){var e=this.observers_,s=e.indexOf(t);~s&&e.splice(s,1),!e.length&&this.connected_&&this.disconnect_()},i.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},i.prototype.updateObservers_=function(){var t=this.observers_.filter(function(e){return e.gatherActive(),e.hasActive()});return t.forEach(function(e){return e.broadcastActive()}),t.length>0},i.prototype.connect_=function(){!Bs||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),Oa?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},i.prototype.disconnect_=function(){!Bs||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},i.prototype.onTransitionEnd_=function(t){var e=t.propertyName,s=e===void 0?"":e,n=Pa.some(function(r){return!!~s.indexOf(r)});n&&this.refresh()},i.getInstance=function(){return this.instance_||(this.instance_=new i),this.instance_},i.instance_=null,i}(),Ir=function(i,t){for(var e=0,s=Object.keys(t);e<s.length;e++){var n=s[e];Object.defineProperty(i,n,{value:t[n],enumerable:!1,writable:!1,configurable:!0})}return i},gt=function(i){var t=i&&i.ownerDocument&&i.ownerDocument.defaultView;return t||Qt},Fr=ds(0,0,0,0);function Zt(i){return parseFloat(i)||0}function On(i){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return t.reduce(function(s,n){var r=i["border-"+n+"-width"];return s+Zt(r)},0)}function Ra(i){for(var t=["top","right","bottom","left"],e={},s=0,n=t;s<n.length;s++){var r=n[s],o=i["padding-"+r];e[r]=Zt(o)}return e}function ka(i){var t=i.getBBox();return ds(0,0,t.width,t.height)}function Ia(i){var t=i.clientWidth,e=i.clientHeight;if(!t&&!e)return Fr;var s=gt(i).getComputedStyle(i),n=Ra(s),r=n.left+n.right,o=n.top+n.bottom,a=Zt(s.width),l=Zt(s.height);if(s.boxSizing==="border-box"&&(Math.round(a+r)!==t&&(a-=On(s,"left","right")+r),Math.round(l+o)!==e&&(l-=On(s,"top","bottom")+o)),!Ba(i)){var c=Math.round(a+r)-t,h=Math.round(l+o)-e;Math.abs(c)!==1&&(a-=c),Math.abs(h)!==1&&(l-=h)}return ds(n.left,n.top,a,l)}var Fa=function(){return typeof SVGGraphicsElement<"u"?function(i){return i instanceof gt(i).SVGGraphicsElement}:function(i){return i instanceof gt(i).SVGElement&&typeof i.getBBox=="function"}}();function Ba(i){return i===gt(i).document.documentElement}function Ma(i){return Bs?Fa(i)?ka(i):Ia(i):Fr}function Da(i){var t=i.x,e=i.y,s=i.width,n=i.height,r=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,o=Object.create(r.prototype);return Ir(o,{x:t,y:e,width:s,height:n,top:e,right:t+s,bottom:n+e,left:t}),o}function ds(i,t,e,s){return{x:i,y:t,width:e,height:s}}var Na=function(){function i(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=ds(0,0,0,0),this.target=t}return i.prototype.isActive=function(){var t=Ma(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},i.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},i}(),Va=function(){function i(t,e){var s=Da(e);Ir(this,{target:t,contentRect:s})}return i}(),Ha=function(){function i(t,e,s){if(this.activeObservations_=[],this.observations_=new kr,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=e,this.callbackCtx_=s}return i.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof gt(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new Na(t)),this.controller_.addObserver(this),this.controller_.refresh())}},i.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof gt(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},i.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},i.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(e){e.isActive()&&t.activeObservations_.push(e)})},i.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map(function(s){return new Va(s.target,s.broadcastRect())});this.callback_.call(t,e,t),this.clearActive()}},i.prototype.clearActive=function(){this.activeObservations_.splice(0)},i.prototype.hasActive=function(){return this.activeObservations_.length>0},i}(),Br=typeof WeakMap<"u"?new WeakMap:new kr,Mr=function(){function i(t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var e=La.getInstance(),s=new Ha(t,e,this);Br.set(this,s)}return i}();["observe","unobserve","disconnect"].forEach(function(i){Mr.prototype[i]=function(){var t;return(t=Br.get(this))[i].apply(t,arguments)}});var za=function(){return typeof Qt.ResizeObserver<"u"?Qt.ResizeObserver:Mr}();const Wa=typeof window>"u",ja=function(i){for(const t of i){const e=t.target.__resizeListeners__||[];e.length&&e.forEach(s=>{s(t)})}};class Ga{static addListener(t,e){Wa||t&&(t.__resizeListeners__||(t.__resizeListeners__=[],t.__ro__=new za(ja),t.__ro__.observe(t)),t.__resizeListeners__.push(e))}static removeListener(t,e){!t||!t.__resizeListeners__||(t.__resizeListeners__.splice(t.__resizeListeners__.indexOf(e),1),t.__resizeListeners__.length||t.__ro__.disconnect())}}var Ie={},Ln;function $a(){if(Ln)return Ie;Ln=1,Object.defineProperty(Ie,"__esModule",{value:!0});for(var i=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),t={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},e={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:i?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},s={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},n=1;n<20;n++)s["f"+n]=111+n;function r(f,m,C){m&&!("byKey"in m)&&(C=m,m=null),Array.isArray(f)||(f=[f]);var y=f.map(function(B){return l(B,m)}),w=function(j){return y.some(function(b){return c(b,j)})},L=C==null?w:w(C);return L}function o(f,m){return r(f,m)}function a(f,m){return r(f,{byKey:!0},m)}function l(f,m){var C=m&&m.byKey,y={};f=f.replace("++","+add");var w=f.split("+"),L=w.length;for(var B in t)y[t[B]]=!1;var j=!0,b=!1,S=void 0;try{for(var A=w[Symbol.iterator](),M;!(j=(M=A.next()).done);j=!0){var D=M.value,J=D.endsWith("?")&&D.length>1;J&&(D=D.slice(0,-1));var G=u(D),oe=t[G];if(D.length>1&&!oe&&!e[D]&&!s[G])throw new TypeError('Unknown modifier: "'+D+'"');(L===1||!oe)&&(C?y.key=G:y.which=h(D)),oe&&(y[oe]=J?null:!0)}}catch(ye){b=!0,S=ye}finally{try{!j&&A.return&&A.return()}finally{if(b)throw S}}return y}function c(f,m){for(var C in f){var y=f[C],w=void 0;if(y!=null&&(C==="key"&&m.key!=null?w=m.key.toLowerCase():C==="which"?w=y===91&&m.which===93?91:m.which:w=m[C],!(w==null&&y===!1)&&w!==y))return!1}return!0}function h(f){f=u(f);var m=s[f]||f.toUpperCase().charCodeAt(0);return m}function u(f){return f=f.toLowerCase(),f=e[f]||f,f}return Ie.default=r,Ie.isHotkey=r,Ie.isCodeHotkey=o,Ie.isKeyHotkey=a,Ie.parseHotkey=l,Ie.compareHotkey=c,Ie.toKeyCode=h,Ie.toKeyName=u,Ie}var Ya=$a();const me=Ci(Ya);class Xa extends rs{constructor(e){super();g(this,"func");this.func=e}async run(){await this.func()}async destroy(){}}class qa extends Xa{}class ut{static getImageDataFromClipboard(t){return new Promise((e,s)=>{var a;const n=(a=t.clipboardData)==null?void 0:a.items;if(!n)return console.warn("No clipboard data"),s();const r=Array.from(n).filter(l=>l.type.startsWith("image/"));if(!r.length)return console.warn("No image in clipboard"),s();const o=Promise.all(r.map(l=>{const c=l.getAsFile();if(!c){console.warn("No blob in clipboard"),s();return}return Y.getImageDataFromBlob(c)}));e(o)})}static getImageDataFromFileTransfer(t){return new Promise((e,s)=>{var r;const n=(r=t.dataTransfer)==null?void 0:r.files;if(!n)return console.warn("No files in drag event"),s();ut.parseImageFiles(Array.from(n),e,s)})}static getImageDataFromFiles(t){return new Promise((e,s)=>ut.parseImageFiles(t,e,s))}static parseImageFiles(t,e,s){const n=Array.from(t).filter(o=>o.type.startsWith("image/"));if(!n.length)return console.warn("No image in files"),s();const r=Promise.all(n.map(o=>Y.getImageDataFromBlob(o)));e(r)}}class Ua extends Qs.EventEmitter{constructor(e){super();g(this,"shield");g(this,"_isCtrl");g(this,"_isCtrlWheel");g(this,"_isShift");g(this,"_isCtrlEvent");g(this,"_isCtrlPlusEvent");g(this,"_isCtrlReduceEvent");g(this,"_isCtrl0Event");g(this,"_isCtrlAEvent");g(this,"_isCtrlMEvent");g(this,"_isCtrlHEvent");g(this,"_isCtrlGEvent");g(this,"_isCtrlCEvent");g(this,"_isCtrlZEvent");g(this,"_isCtrlYEvent");g(this,"_isCtrlShiftGEvent");g(this,"_isShiftEvent");g(this,"_isShift1Event");g(this,"_isDeleteEvent");g(this,"_isEscEvent");this.shield=e}get isCtrl(){return this._isCtrl}get isOnlyCtrl(){return this._isCtrl&&!this._isShift}get isCtrlWheel(){return this._isCtrlWheel}get isShift(){return this._isShift}get isOnlyShift(){return this._isShift&&!this._isCtrl}init(){this._isCtrl=!1,this._isCtrlWheel=!1,this._isCtrlEvent=me("ctrl"),this._isCtrlPlusEvent=me("ctrl+="),this._isCtrlReduceEvent=me("ctrl+-"),this._isCtrl0Event=me("ctrl+0"),this._isShiftEvent=me("shift"),this._isShift1Event=me("shift+1"),this._isDeleteEvent=me("backspace"),this._isCtrlAEvent=me("ctrl+a"),this._isCtrlMEvent=me("ctrl+m"),this._isCtrlHEvent=me("ctrl+h"),this._isCtrlGEvent=me("ctrl+g"),this._isCtrlCEvent=me("ctrl+c"),this._isCtrlZEvent=me("ctrl+z"),this._isCtrlYEvent=me("ctrl+y"),this._isCtrlShiftGEvent=me("ctrl+shift+g"),this._isEscEvent=me("esc"),this.initEvents()}async initEvents(){Promise.all([this.initRenderResizeEvent(),this.initMouseEvents()])}_isInputEvent(e){return e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement}async initRenderResizeEvent(){Ga.addListener(this.shield.renderEl,e=>{this.emit("resize",e)})}_createImages(e){if(e&&e.length){let s=new ra;e.forEach((n,r)=>{s.add(new qa(async()=>{await new Promise(o=>{this.emit("pasteImage",n,async()=>{await Lr.wait(100),o(!0)})}),r===e.length-1&&(await s.destroy(),s=null)}))})}}async initMouseEvents(){this.shield.node.addEventListener("mousemove",e=>{this.emit("cursorMove",e)}),this.shield.node.addEventListener("mouseleave",e=>{this.emit("cursorLeave",e)}),this.shield.node.addEventListener("mousedown",e=>{this.emit("pressDown",e)}),this.shield.node.addEventListener("mouseup",e=>{this.emit("pressUp",e)}),this.shield.node.addEventListener("dblclick",e=>{this.emit("dblClick",e)}),this.shield.node.addEventListener("wheel",e=>{de.stopPP(e),this._isCtrlWheel=this._isCtrl,this._isCtrlWheel?this.emit("wheelScale",-e.deltaY/2e3,e):this.emit("wheelMove",{x:e.deltaX,y:e.deltaY},e)}),this.shield.node.addEventListener("dragover",e=>{de.stopPP(e)}),this.shield.node.addEventListener("drop",e=>{de.stopPP(e),ut.getImageDataFromFileTransfer(e).then(s=>{this._createImages(s)}).catch(s=>{s&&console.warn(s)})}),document.addEventListener("keydown",e=>{this._isCtrl=this._isCtrlEvent(e),this._isCtrlPlusEvent(e)&&(de.stopPP(e),this.emit("scaleIncrease")),this._isCtrlReduceEvent(e)&&(de.stopPP(e),this.emit("scaleReduce")),this._isCtrl0Event(e)&&(de.stopPP(e),this.emit("scale100")),this._isShift1Event(e)?(de.stopPP(e),this.emit("scaleAutoFit")):this._isShiftEvent(e)?this._isShift=!0:this._isShift=!1,this._isInputEvent(e)||(this._isDeleteEvent(e)&&(de.stopPP(e),this.emit("deleteSelects")),this._isCtrlAEvent(e)&&(de.stopPP(e),this.emit("selectAll")),this._isCtrlMEvent(e)&&(de.stopPP(e),this.emit("selectMoveable")),this._isCtrlHEvent(e)&&(de.stopPP(e),this.emit("selectHand")),this._isCtrlGEvent(e)&&(de.stopPP(e),this.emit("selectGroup")),this._isCtrlCEvent(e)&&(de.stopPP(e),this.emit("selectCopy",e)),this._isCtrlZEvent(e)&&(de.stopPP(e),this.emit("undo")),this._isCtrlYEvent(e)&&(de.stopPP(e),this.emit("redo")),this._isCtrlShiftGEvent(e)&&(de.stopPP(e),this.emit("selectGroupCancel")),this._isEscEvent(e)&&(de.stopPP(e),this.emit("cancel")))}),document.addEventListener("keyup",e=>{this._isCtrl=e.ctrlKey,this._isShift=e.shiftKey}),document.addEventListener("paste",e=>{this._isInputEvent(e)||ut.getImageDataFromClipboard(e).then(s=>{this._createImages(s)}).catch(s=>{s&&console.warn(s);try{const n=JSON.parse(e.clipboardData.getData("text/plain"));n&&this.emit("pasteElements",n)}catch(n){n&&console.warn(n)}})})}async onImagesUpload(e){if(e.length){const s=await ut.getImageDataFromFiles(e);this._createImages(s)}}}class Ja extends en{constructor(){super(...arguments);g(this,"_lastestStageElementsSize",0)}async redraw(e){const{stageElements:s}=this.drawer.store;if(e||s.length!==this._lastestStageElementsSize){this._lastestStageElementsSize=s.length;const n=new Zs([]);n.add(new Rr(null,this.canvas)),s.forEach(r=>{const o=F.createElementTask(r,this.canvas);o&&n.add(o)}),await this.renderCargo(n)}}}const Rn={rotationIconEnable:!0};class Ka{constructor(){g(this,"_configs",Rn);this.config(Rn),Ri({enforceActions:"never"})}get rotationIconEnable(){return this._configs.rotationIconEnable}config(t){Object.assign(this._configs,t)}}var se=(i=>(i[i.NONE=0]="NONE",i[i.MOVING=1]="MOVING",i[i.ROTATING=2]="ROTATING",i[i.TRANSFORMING=3]="TRANSFORMING",i[i.CORNER_MOVING=4]="CORNER_MOVING",i))(se||{});class Qa{constructor(t){g(this,"shield");this.shield=t}_getElementsCoordsRect(t){return O.getRect(t.map(e=>this._getElementAlignCoords(e)).flat())}_calcElementsAllWidth(t){let e=0;return t.forEach(s=>{const n=O.getRect(this._getElementAlignCoords(s));e+=n.width}),e}_calcElementsAllHeight(t){let e=0;return t.forEach(s=>{const n=O.getRect(this._getElementAlignCoords(s));e+=n.height}),e}_sortElementsByX(t){return k.sortBy(t,e=>O.getRect(this._getElementAlignCoords(e)).x)}_sortElementsByXW(t){return k.sortBy(t,e=>{const{x:s,width:n}=O.getRect(this._getElementAlignCoords(e));return s+n})}_sortElementsByY(t){return k.sortBy(t,e=>O.getRect(this._getElementAlignCoords(e)).y)}_sortElementsByYH(t){return k.sortBy(t,e=>{const{y:s,height:n}=O.getRect(this._getElementAlignCoords(e));return s+n})}_getElementAlignCoords(t){return this.shield.event.isShift?t.alignOutlineCoords.flat():t.alignCoords}_setElementPositionByOffset(t,e,s){const n={x:e,y:s};t.setPosition(t.model.x+e,t.model.y+s,n),t.isGroup&&!t.isGroupSubject&&t.deepSubs.forEach(r=>{r.setPosition(r.model.x+e,r.model.y+s,n)})}setElementsAlignLeft(t){t=F.getNoParentElements(t);const{x:e}=this._getElementsCoordsRect(t);t.forEach(s=>{const{x:n}=O.getRect(this._getElementAlignCoords(s)),r=e-n;r!==0&&this._setElementPositionByOffset(s,r,0)})}setElementsAlignRight(t){t=F.getNoParentElements(t);const{x:e,width:s}=this._getElementsCoordsRect(t);t.forEach(n=>{const{x:r,width:o}=O.getRect(this._getElementAlignCoords(n)),a=e+s-r-o;a!==0&&this._setElementPositionByOffset(n,a,0)})}setElementsAlignTop(t){t=F.getNoParentElements(t);const{y:e}=this._getElementsCoordsRect(t);t.forEach(s=>{const{y:n}=O.getRect(this._getElementAlignCoords(s)),r=e-n;r!==0&&this._setElementPositionByOffset(s,0,r)})}setElementsAlignBottom(t){t=F.getNoParentElements(t);const{y:e,height:s}=this._getElementsCoordsRect(t);t.forEach(n=>{const{y:r,height:o}=O.getRect(this._getElementAlignCoords(n)),a=e+s-r-o;a!==0&&this._setElementPositionByOffset(n,0,a)})}setElementsAlignCenter(t){t=F.getNoParentElements(t);const{x:e,width:s}=this._getElementsCoordsRect(t);t.forEach(n=>{const{x:r,width:o}=O.getRect(this._getElementAlignCoords(n)),a=e+s/2-(r+o/2);a!==0&&this._setElementPositionByOffset(n,a,0)})}setElementsAlignMiddle(t){t=F.getNoParentElements(t);const{y:e,height:s}=this._getElementsCoordsRect(t);t.forEach(n=>{const{y:r,height:o}=O.getRect(this._getElementAlignCoords(n)),a=e+s/2-(r+o/2);a!==0&&this._setElementPositionByOffset(n,0,a)})}setElementsAverageVertical(t){t=F.getNoParentElements(t),t=this._sortElementsByY(t);const{y:e,height:s}=this._getElementsCoordsRect(t),n=O.getRect(this._getElementAlignCoords(t[0]));let r=e+n.height;const o=this._calcElementsAllHeight(t),a=(s-o)/(t.length-1);t=this._sortElementsByYH(t.slice(1)),t.forEach((l,c)=>{if(c!==t.length-1){const{y:h,height:u}=O.getRect(this._getElementAlignCoords(l)),f=r+a-h;f!==0&&this._setElementPositionByOffset(l,0,f),r=h+f+u}})}setElementsAverageHorizontal(t){t=F.getNoParentElements(t),t=this._sortElementsByX(t);const{x:e,width:s}=this._getElementsCoordsRect(t),n=O.getRect(this._getElementAlignCoords(t[0]));let r=e+n.width;const o=this._calcElementsAllWidth(t),a=(s-o)/(t.length-1);t=this._sortElementsByXW(t.slice(1)),t.forEach((l,c)=>{if(c!==t.length-1){const{x:h,width:u}=O.getRect(this._getElementAlignCoords(l)),f=r+a-h;f!==0&&this._setElementPositionByOffset(l,f,0),r=h+f+u}})}}class yt{constructor(t,e){g(this,"payload");g(this,"store");this.payload=t,this.store=e}async undo(){throw new Error("Method not implemented.")}async redo(){throw new Error("Method not implemented.")}}class Za extends yt{async undo(){this.payload.uDataList.forEach(t=>{const{model:{id:e}}=t;this.store.removeElement(e)})}async redo(){this.payload.uDataList.forEach(t=>{this.store.afterAddElementByModel(W.jsonClone(t.model))})}}class bs extends yt{async _restoreElementsFromData(t){t.forEach(e=>{const{model:s}=e,n=this.store.updateElementModel(s.id,W.jsonClone(s));n&&(n.refreshFlipX(),n.refresh())})}async undo(){this.payload.uDataList&&await this._restoreElementsFromData(this.payload.uDataList)}async redo(){this.payload.rDataList&&await this._restoreElementsFromData(this.payload.rDataList)}}class el extends yt{async undo(){this.payload.uDataList.forEach(t=>{const{prevId:e,model:s}=t;let n;e&&(n=this.store.getElementById(e)),this.store.afterAddElementByModel(W.jsonClone(s),n,!e)})}async redo(){this.payload.uDataList.forEach(t=>{const{model:{id:e}}=t;this.store.removeElement(e)})}}class tl extends yt{async undo(){this.payload.uDataList.forEach(t=>{const{model:{id:e},isGroup:s,isGroupSubject:n,prevId:r}=t;if(s)this.store.removeElement(e);else{const o=this.store.getElementById(e);o&&(n&&this.store.updateElementModel(e,{groupId:void 0}),this.store.rearrangeElementAfter(o,r?this.store.getElementById(r):null,!0))}}),this.store.resortElementsArray(),this.store.emitElementsLayerChanged()}async redo(){for(let t=this.payload.rDataList.length-1;t>=0;t--){const e=this.payload.rDataList[t],{model:{id:s,groupId:n},isGroup:r,isGroupSubject:o,nextId:a}=e;if(r)this.store.beforeAddElementByModel(W.jsonClone(e.model),a?this.store.getElementById(a):null,!0);else{const l=this.store.getElementById(s);l&&(o&&this.store.updateElementModel(s,{groupId:n}),this.store.rearrangeElementBefore(l,a?this.store.getElementById(a):null,!0))}}this.store.resortElementsArray(),this.store.emitElementsLayerChanged()}}class sl extends yt{async undo(){this.payload.uDataList.forEach(t=>{const{model:{id:e,groupId:s},isGroup:n,prevId:r}=t;n?this.store.afterAddElementByModel(W.jsonClone(t.model),r?this.store.getElementById(r):null,!0):this.store.updateElementModel(e,{groupId:s})})}async redo(){this.payload.uDataList.forEach(t=>{const{model:{id:e},isGroup:s}=t;s?this.store.removeElement(e):this.store.updateElementModel(e,{groupId:void 0})})}}class nl extends yt{async _rearrange(t){t.forEach(e=>{const{model:{id:s},prevId:n}=e,r=this.store.getElementById(s);r&&this.store.rearrangeElementAfter(r,n?this.store.getElementById(n):null,!0)}),this.store.resortElementsArray(),this.store.emitElementsLayerChanged()}async undo(){this.payload.uDataList&&await this._rearrange(this.payload.uDataList)}async redo(){this.payload.rDataList&&await this._rearrange(this.payload.rDataList)}}const kn=200,In=20;class rl extends cs{constructor(){super(...arguments);g(this,"textEditor");g(this,"textCursorEditor");g(this,"_textEditorPosition");g(this,"_textEditorUpdateId");g(this,"_prevTextCursorKeycode",-1);g(this,"_prevTextCursorCtrlKey",!1);g(this,"_prevTextCursorShiftKey",!1)}initNode(){return this.node=document.createElement("div"),this.node.id="html-drawer",this.initStyle(),this._initStyleSheet(),this.node}updateSize(e){const{width:s,height:n}=e,{stageScale:r}=this.shield;Object.assign(this.node.style,{width:`${s/r}px`,height:`${n/r}px`,transform:`scale(${r})`})}createTextInput(e){if(this.textEditor)return this.textEditor;const s=this._createInputElement(e);return this._addInputEvents(s),this.node.appendChild(s),setTimeout(()=>{s.setSelectionRange(0,0),s.focus()},0),this.textEditor=s,s}createTextCursorInput(){if(!this.textCursorEditor){const e=document.createElement("textarea");e.id="text-cursor-editor",this._addCursorInputEvents(e),this.node.appendChild(e),this.textCursorEditor=e}return this._resetTextCursorInput(),this.textCursorEditor}_resetTextCursorInput(){this.textCursorEditor&&(this.textCursorEditor.value="",this._textEditorUpdateId=Xe())}focusTextCursorInput(){this.textCursorEditor&&this.textCursorEditor.focus()}_initStyleSheet(){const e=document.createElement("style");e.innerHTML=`
        #html-drawer {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            transform-origin: top left;
        }
        #html-drawer textarea {
            position: absolute;
            top: 0;
            left: 0;
            min-width: 0;
            min-height: 0;
            overflow: visible;
            padding: 0;
            margin: 0;
            border: none;
            outline: none;
            resize: none;
            word-break: break-word;
            white-space: nowrap;
            pointer-events: auto;
            background: transparent;
            caret-color: #000;
            color: #000;
            box-sizing: border-box;
        }
        #html-drawer textarea::-webkit-scrollbar {
            display: none;
        }
        #html-drawer textarea {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        #text-cursor-editor {
          position: absolute;
          top: 0;
          left: 0;
          width: 0;
          height: 0;
          caret-color: transparent;
        }
    `,document.head.appendChild(e)}_updateInputStyleWhileInputing(){let{width:e,height:s}=Er.measureTextWithSpan(this.textEditor.value,Fe);e=Math.max(e,kn),s=Math.max(s,In,Math.ceil(this.textEditor.value.split(`
`).length*Fe.fontLineHeight)),Object.assign(this.textEditor.style,{minWidth:`${e}px`,minHeight:`${s}px`})}_addInputEvents(e){e.addEventListener("blur",()=>{this.textEditor.value&&this.emit("textInput",this.textEditor.value,Fe,{width:e.offsetWidth,height:e.offsetHeight},this._textEditorPosition),this.textEditor.remove(),this.textEditor=null}),e.addEventListener("keydown",s=>{s.key==="Enter"&&this._updateInputStyleWhileInputing()}),e.addEventListener("input",()=>{this._updateInputStyleWhileInputing()})}_emitTextCursorUpdate(){this.emit("textUpdate",this.textCursorEditor.value,{keyCode:this._prevTextCursorKeycode,ctrlKey:this._prevTextCursorCtrlKey,shiftKey:this._prevTextCursorShiftKey,updateId:this._textEditorUpdateId})}_addCursorInputEvents(e){e.addEventListener("keydown",s=>{const{keyCode:n,ctrlKey:r,shiftKey:o,metaKey:a,altKey:l}=s;this._prevTextCursorKeycode=n,this._prevTextCursorCtrlKey=r,this._prevTextCursorShiftKey=o,(r||o||a||l||te.isDeleterKey(n)||te.isArrowLeft(n)||te.isArrowRight(n)||te.isArrowUp(n)||te.isArrowDown(n)||te.isEnter(n)||r&&te.isA(n)||r&&te.isX(n)||r&&te.isC(n)||r&&te.isV(n)||r&&te.isZ(n)||r&&te.isY(n))&&(te.isV(n)||(de.stopPP(s),this._resetTextCursorInput(),this._emitTextCursorUpdate(),requestAnimationFrame(()=>{this.focusTextCursorInput()})))}),e.addEventListener("paste",s=>{de.stopPP(s);const n=s.clipboardData.getData("text/plain");this.textCursorEditor.value=n,this._prevTextCursorKeycode=86,this._emitTextCursorUpdate(),this._resetTextCursorInput(),requestAnimationFrame(()=>{this.focusTextCursorInput()})}),e.addEventListener("input",()=>{this._emitTextCursorUpdate()}),e.addEventListener("compositionstart",()=>{this._resetTextCursorInput()}),e.addEventListener("compositionend",()=>{this.emit("textUpdate","",{compositionType:Gs.END}),requestAnimationFrame(()=>{this.focusTextCursorInput()})})}_createInputElement(e){this._textEditorPosition=e;const s=1/this.shield.stageScale,n=document.createElement("textarea");return Object.assign(n.style,{top:`${e.y}px`,left:`${e.x}px`,minWidth:`${kn}px`,minHeight:`${In}px`,boxShadow:`0 -${s}px 0 0 ${Pt}, -${s}px 0 0 0 ${Pt}, ${s}px 0 0 0 ${Pt}, 0 ${s}px 0 0 ${Pt}`,fontSize:`${Fe.fontSize}px`,fontFamily:Fe.fontFamily,lineHeight:`${Fe.fontLineHeight}px`,color:Os.hashToRgba(Fe.fontColor,Fe.fontColorOpacity),verticalAlign:Fe.textBaseline,textAlign:Fe.textAlign}),n}}class il extends cs{constructor(){super();g(this,"currentCreator");g(this,"cursor");g(this,"mask");g(this,"provisional");g(this,"html");g(this,"configure");g(this,"store");g(this,"selection");g(this,"event");g(this,"align");g(this,"undoRedo");g(this,"stageScale",1);g(this,"stageWorldCoord",{x:0,y:0});g(this,"stageRect");g(this,"renderEl");g(this,"elementsStatus",se.NONE);g(this,"_cursorMoveQueue",new Kt);g(this,"_redrawQueue",new Kt);g(this,"_shouldRedraw",!1);g(this,"_latestMousedownTimestamp",0);g(this,"_shouldSelectTopAWhilePressUp",!0);g(this,"_pressDownPosition");g(this,"_pressDownStageWorldCoord");g(this,"_pressUpPosition");g(this,"_pressUpStageWorldCoord");g(this,"_pressMovePosition");g(this,"_pressMoveStageWorldCoord");g(this,"_isPressDown",!1);g(this,"_isStageMoving",!1);g(this,"_originalStageWorldCoord");g(this,"_originalEditingDataList");this.configure=new Ka,this.event=new Ua(this),this.store=new ta(this),this.cursor=new va(this),this.provisional=new ma(this),this.html=new rl(this),this.selection=new pa(this),this.align=new Qa(this),this.mask=new fa(this),this.undoRedo=new Or,this.renderer=new Ja(this),nr(this,{stageCalcParams:ki,stageRect:ne,stageWorldCoord:ne,stageScale:ne}),We(()=>this.stageCalcParams,()=>{Jt.stageCalcParams=this.stageCalcParams}),this._requestAnimationRedraw()}get stageRectPoints(){return O.getRectBySize(this.stageRect)}get stageWordRectCoords(){return O.getBoxByCenter(this.stageWorldCoord,{width:this.stageRect.width/this.stageScale,height:this.stageRect.height/this.stageScale})}get isElementsBusy(){return[se.ROTATING,se.MOVING,se.TRANSFORMING,se.CORNER_MOVING].includes(this.elementsStatus)}get isStageMoving(){return this._isStageMoving}get isDrawerActive(){var e;return[he.shapes,he.freedom].includes((e=this.currentCreator)==null?void 0:e.category)}get isTextCreating(){var e;return[he.text].includes((e=this.currentCreator)==null?void 0:e.category)}get isTextEditing(){return!this.store.isEditingEmpty&&this.store.editingElements[0].model.type===I.text}get isHandActive(){var e;return((e=this.currentCreator)==null?void 0:e.type)===I.hand}get isMoveableActive(){var e;return((e=this.currentCreator)==null?void 0:e.type)===I.moveable}get isArbitraryDrawing(){var e;return((e=this.currentCreator)==null?void 0:e.type)===I.arbitrary}get isArbitraryEditing(){return!this.store.isEditingEmpty&&this.store.editingElements[0].model.type===I.arbitrary}get stageCalcParams(){return{rect:this.stageRect,worldCoord:this.stageWorldCoord,scale:this.stageScale}}get movingOffset(){return{x:Math.floor(this._pressMoveStageWorldCoord.x-this._pressDownStageWorldCoord.x),y:Math.floor(this._pressMoveStageWorldCoord.y-this._pressDownStageWorldCoord.y)}}async _addRedrawTask(e){return new Promise(s=>{this._redrawQueue.add({run:async()=>{await Promise.all([this.redraw(e),this.mask.redraw(),this.provisional.redraw()]),s()}})})}async _requestAnimationRedraw(){requestAnimationFrame(async()=>{await this._addRedrawTask(this._shouldRedraw),this._shouldRedraw=!1,await this._requestAnimationRedraw()})}_createUpdateCommandBy(e,s){const n=new bs({type:Ze.ElementsUpdated,uDataList:e,rDataList:s},this.store);this.undoRedo.add(n)}async _createTranslateCommand(e,s){const n=await Promise.all(e.map(async o=>({model:await o.toTranslateJson()})));await s();const r=await Promise.all(e.map(async o=>({model:await o.toTranslateJson()})));this._createUpdateCommandBy(n,r)}async setElementsPosition(e,s){await this._createTranslateCommand(e,async()=>{await this.store.setElementsPosition(e,s)}),e.forEach(n=>n.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async _createTransformCommand(e,s){const n=await Promise.all(e.map(async o=>({model:await o.toTransformJson()})));await s(),await this._reflowTextIfy(e,!0);const r=await Promise.all(e.map(async o=>({model:await o.toTransformJson()})));this._createUpdateCommandBy(n,r)}async setElementsWidth(e,s){await this._createTransformCommand(e,async()=>{await this.store.setElementsWidth(e,s),e.forEach(n=>n.onWidthChanged()),this.selection.refresh()})}async setElementsHeight(e,s){await this._createTransformCommand(e,async()=>{await this.store.setElementsHeight(e,s),e.forEach(n=>n.onHeightChanged()),this.selection.refresh()})}async setElementsLeanYAngle(e,s){await this._createTransformCommand(e,async()=>{await this.store.setElementsLeanYAngle(e,s),e.forEach(n=>n.onLeanyAngleChanged()),this.selection.refresh()})}async setElementsAngle(e,s){await this._createTransformCommand(e,async()=>{await this.store.setElementsAngle(e,s),e.forEach(n=>n.onAngleChanged()),this.selection.refresh()})}async setElementsCorners(e,s,n){const r=await Promise.all(e.map(async a=>({model:await a.toCornerJson()})));await this.store.setElementsCorners(e,s,n);const o=await Promise.all(e.map(async a=>({model:await a.toCornerJson()})));this._createUpdateCommandBy(r,o),e.forEach(a=>a.onCornerChanged()),this._shouldRedraw=!0}async _createStrokeCommand(e,s){const n=await Promise.all(e.map(async o=>({model:await o.toStrokesJson()})));await s();const r=await Promise.all(e.map(async o=>({model:await o.toStrokesJson()})));this._createUpdateCommandBy(n,r)}async setElementsStrokeType(e,s,n){await this._createStrokeCommand(e,async()=>{await this.store.setElementsStrokeType(e,s,n)}),e.forEach(r=>r.onStrokeTypeChanged()),this._shouldRedraw=!0}async setElementsStrokeWidth(e,s,n){await this._createStrokeCommand(e,async()=>{await this.store.setElementsStrokeWidth(e,s,n)}),e.forEach(r=>r.onStrokeWidthChanged()),this._shouldRedraw=!0}async setElementsStrokeColor(e,s,n){await this._createStrokeCommand(e,async()=>{await this.store.setElementsStrokeColor(e,s,n)}),e.forEach(r=>r.onStrokeColorChanged()),this._shouldRedraw=!0}async setElementsStrokeColorOpacity(e,s,n){await this._createStrokeCommand(e,async()=>{await this.store.setElementsStrokeColorOpacity(e,s,n)}),e.forEach(r=>r.onStrokeColorOpacityChanged()),this._shouldRedraw=!0}async addElementsStroke(e,s){await this._createStrokeCommand(e,async()=>{await this.store.addElementsStroke(e,s)}),e.forEach(n=>n.onStrokeAdded()),this._shouldRedraw=!0}async removeElementsStroke(e,s){await this._createStrokeCommand(e,async()=>{await this.store.removeElementsStroke(e,s)}),e.forEach(n=>n.onStrokeRemoved()),this._shouldRedraw=!0}async _createFillCommand(e,s){const n=await Promise.all(e.map(async o=>({model:await o.toFillsJson()})));await s();const r=await Promise.all(e.map(async o=>({model:await o.toFillsJson()})));this._createUpdateCommandBy(n,r)}async setElementsFillColor(e,s,n){await this._createFillCommand(e,async()=>{await this.store.setElementsFillColor(e,s,n)}),e.forEach(r=>r.onFillColorChanged()),this._shouldRedraw=!0}async setElementsFillColorOpacity(e,s,n){await this._createFillCommand(e,async()=>{await this.store.setElementsFillColorOpacity(e,s,n)}),e.forEach(r=>r.onFillColorOpacityChanged()),this._shouldRedraw=!0}async addElementsFill(e,s){await this._createFillCommand(e,async()=>{await this.store.addElementsFill(e,s)}),e.forEach(n=>n.onFillAdded()),this._shouldRedraw=!0}async removeElementsFill(e,s){await this._createFillCommand(e,async()=>{await this.store.removeElementsFill(e,s)}),e.forEach(n=>n.onFillRemoved()),this._shouldRedraw=!0}async _createFontStyleCommand(e,s){const n=await Promise.all(e.map(async o=>({model:await o.toFontStyleJson()})));await s();const r=await Promise.all(e.map(async o=>({model:await o.toFontStyleJson()})));this._createUpdateCommandBy(n,r)}async _reflowTextIfy(e,s,n){const r=[];return await Promise.all(e.map(async o=>{o instanceof et&&o.reflowText(s||n)&&r.push(o)})),r.length>0&&(await this._addRedrawTask(!0),r.forEach(o=>o.onTextReflowed(n)),await Promise.all(e.map(async o=>o instanceof et&&o.refreshTextCursors())),await this._addRedrawTask(!0)),r}async setElementsTextAlign(e,s){await this._createFontStyleCommand(e,async()=>{await this.store.setElementsTextAlign(e,s),await this._addRedrawTask(!0),await this._reflowTextIfy(e,!0),e.forEach(n=>n.onTextAlignChanged())})}async setElementsTextVerticalAlign(e,s){await this._createFontStyleCommand(e,async()=>{await this.store.setElementsTextVerticalAlign(e,s),await this._addRedrawTask(!0),await this._reflowTextIfy(e,!0),e.forEach(n=>n.onTextVerticalAlignChanged())})}async setElementsTextBaseline(e,s){await this._createFontStyleCommand(e,async()=>{await this.store.setElementsTextBaseline(e,s)}),e.forEach(n=>n.onTextBaselineChanged()),this._shouldRedraw=!0}async setElementsFontStyler(e,s){await this._createFontStyleCommand(e,async()=>{await this.store.setElementsFontStyler(e,s),await this._addRedrawTask(!0),await this._reflowTextIfy(e,!0),e.forEach(n=>n.onFontStylerChanged())})}async setElementsFontSize(e,s){await this._createFontStyleCommand(e,async()=>{await this.store.setElementsFontSize(e,s),await this._addRedrawTask(!0),await this._reflowTextIfy(e,!0),e.forEach(n=>{n.onFontSizeChanged(),!n.isSelectionAvailable&&n.fontLineHeightAutoFit&&n.onFontLineHeightChanged()})})}async setElementsFontFamily(e,s){await this._createFontStyleCommand(e,async()=>{await this.store.setElementsFontFamily(e,s),await this._addRedrawTask(!0),await this._reflowTextIfy(e,!0),e.forEach(n=>n.onFontFamilyChanged())})}async setElementsFontLineHeight(e,s){await this._createFontStyleCommand(e,async()=>{await this.store.setElementsFontLineHeight(e,s)}),e.forEach(n=>{n.onFontLineHeightChanged(),n.onFontLineHeightFactorChanged()}),this._shouldRedraw=!0}async setElementsFontLineHeightFactor(e,s){await this._createFontStyleCommand(e,async()=>{await this.store.setElementsFontLineHeightFactor(e,s)}),e.forEach(n=>{n.onFontLineHeightFactorChanged(),n.onFontLineHeightChanged()}),this._shouldRedraw=!0}async setElementsFontLineHeightAutoFit(e,s){await this._createFontStyleCommand(e,async()=>{await this.store.setElementsFontLineHeightAutoFit(e,s)}),e.forEach(n=>{n.onFontLineHeightAutoFitChanged(),n.onFontLineHeightChanged()}),this._shouldRedraw=!0}async setElementsFontColor(e,s){await this._createFontStyleCommand(e,async()=>{await this.store.setElementsFontColor(e,s)}),e.forEach(n=>n.onFontColorChanged()),this._shouldRedraw=!0}async setElementsFontColorOpacity(e,s){await this._createFontStyleCommand(e,async()=>{await this.store.setElementsFontColorOpacity(e,s)}),e.forEach(n=>n.onFontColorOpacityChanged()),this._shouldRedraw=!0}async setElementsFontLetterSpacing(e,s){await this._createFontStyleCommand(e,async()=>{await this.store.setElementsFontLetterSpacing(e,s),await this._addRedrawTask(!0),await this._reflowTextIfy(e,!0),e.forEach(n=>n.onFontLetterSpacingChanged())})}async setElementsTextDecoration(e,s){await this._createFontStyleCommand(e,async()=>{await this.store.setElementsTextDecoration(e,s)}),e.forEach(n=>n.onTextDecorationChanged()),this._shouldRedraw=!0}async setElementsTextDecorationColor(e,s){await this._createFontStyleCommand(e,async()=>{await this.store.setElementsTextDecorationColor(e,s)}),e.forEach(n=>n.onTextDecorationColorChanged()),this._shouldRedraw=!0}async setElementsTextDecorationOpacity(e,s){await this._createFontStyleCommand(e,async()=>{await this.store.setElementsTextDecorationOpacity(e,s)}),e.forEach(n=>n.onTextDecorationOpacityChanged()),this._shouldRedraw=!0}async setElementsTextDecorationThickness(e,s){await this._createFontStyleCommand(e,async()=>{await this.store.setElementsTextDecorationThickness(e,s)}),e.forEach(n=>n.onTextDecorationThicknessChanged()),this._shouldRedraw=!0}async setElementsParagraphSpacing(e,s){await this._createFontStyleCommand(e,async()=>{await this.store.setElementsParagraphSpacing(e,s)}),e.forEach(n=>n.onParagraphSpacingChanged()),this._shouldRedraw=!0}async setElementsRatioLocked(e,s){await this.store.setElementsRatioLocked(e,s),e.forEach(n=>n.onRatioLockedChanged())}async init(e){this.renderEl=e,await Promise.all([this.initNode(),this.event.init()]),this._addEventListeners()}_addCursorQueueTask(e){this._cursorMoveQueue.add({run:e})}_addEventListeners(){this.event.on("resize",this._refreshSize.bind(this)),this.event.on("cursorMove",e=>this._addCursorQueueTask(()=>this._handleCursorMove(e))),this.event.on("pressDown",e=>this._addCursorQueueTask(()=>this._handlePressDown(e))),this.event.on("pressUp",e=>this._addCursorQueueTask(()=>this._handlePressUp(e))),this.event.on("cursorLeave",this._handleCursorLeave.bind(this)),this.event.on("dblClick",this._handleDblClick.bind(this)),this.event.on("wheelScale",this._handleWheelScale.bind(this)),this.event.on("wheelMove",this._handleWheelMove.bind(this)),this.event.on("scaleReduce",this._handleScaleReduce.bind(this)),this.event.on("scaleIncrease",this._handleScaleIncrease.bind(this)),this.event.on("scaleAutoFit",this._handleScaleAutoFit.bind(this)),this.event.on("scale100",this._handleScale100.bind(this)),this.event.on("pasteImage",this._handleImagePasted.bind(this)),this.event.on("deleteSelects",this._handleSelectsDelete.bind(this)),this.event.on("selectAll",this._handleSelectAll.bind(this)),this.event.on("selectCopy",this._handleSelectCopy.bind(this)),this.event.on("pasteElements",this._handlePasteElements.bind(this)),this.event.on("cancel",this._handleCancel.bind(this)),this.event.on("selectMoveable",this._handleSelectMoveable.bind(this)),this.event.on("selectHand",this._handleSelectHand.bind(this)),this.event.on("selectGroup",this._handleSelectGroup.bind(this)),this.event.on("selectGroupCancel",this._handleSelectGroupCancel.bind(this)),this.event.on("undo",this._handleUndo.bind(this)),this.event.on("redo",this._handleRedo.bind(this)),this.html.on("textInput",this._handleTextInput.bind(this)),this.html.on("textUpdate",this._handleTextUpdate.bind(this))}initNode(){super.initNode();const e=this.mask.initNode(),s=this.provisional.initNode(),n=this.html.initNode();return this.renderEl.insertBefore(e,this.renderEl.firstChild),this.renderEl.insertBefore(n,this.mask.node),this.renderEl.insertBefore(s,this.html.node),this.node.id="shield",this.renderEl.insertBefore(this.node,this.provisional.node),this.node}async _doElementsOperating(){switch(this.elementsStatus){case se.ROTATING:{this._rotateElements();break}case se.MOVING:{this._dragElements();break}case se.TRANSFORMING:{this._transformElements();break}case se.CORNER_MOVING:{this._movingElementsCorner();break}}}async _updateStatusWhileElementsOperating(){![se.ROTATING,se.TRANSFORMING,se.CORNER_MOVING].includes(this.elementsStatus)&&this.store.isSelectedContainsTarget()&&this.store.isEditingEmpty&&(this.elementsStatus=se.MOVING,await this._dragElements())}async _handleCursorMove(e){this.cursor.transform(e),this.cursor.updateStyle(e),this.isMoveableActive&&!this.isElementsBusy&&this.selection.hitTargetElements(this.cursor.worldValue),this._isPressDown?(this.calcPressMove(e),this.isTextEditing?this._tryRetrieveTextCursor(ht.PRESS_MOVE,!0):this.isArbitraryDrawing?(this._updatingArbitraryElementOnMovement(e),this.selection.refreshTransformerModels()):this.isDrawerActive?(this._creatingElementOnMovement(e),this.selection.refreshTransformerModels()):this.isMoveableActive?this.store.isSelectedEmpty?this._createRange():this.checkCursorPressMovedALittle(e)&&(await this._doElementsOperating(),await this._updateStatusWhileElementsOperating()):this.isHandActive&&(this._isStageMoving=!0,this._dragStage(e))):this.isMoveableActive&&this._tryActiveController(),this.isElementsBusy&&this.store.cancelTargetElements()}_tryActiveController(){return this.selection.tryActiveController(this.cursor.worldValue)}triggetEditingElementsStageChanged(){requestAnimationFrame(()=>{this.store.editingElements.forEach(e=>e.onStageChanged())})}_dragStage(e){this._refreshStageWorldCoord(e),this.store.refreshStageElements(),this.selection.refresh(),this.triggetEditingElementsStageChanged(),this._shouldRedraw=!0}_dragElements(){const{selectedElements:e}=this.store;this.store.updateElementsTranslate(e,this.movingOffset),e.forEach(s=>{s.isDragging=!0,s.onTranslating()}),this.selection.refresh(),this._shouldRedraw=!0}_movingElementsCorner(){const{selectedElements:e}=this.store;this.store.updateElementsCorner(e,this.movingOffset),e.forEach(s=>{s.isCornerMoving=!0,s.onCornerChanging()}),this._shouldRedraw=!0}_transformElements(){const{selectedElements:e}=this.store;this.store.isMultiSelected?(this.selection.rangeElement.isTransforming=!0,this.store.updateElementsTransform([this.selection.rangeElement],this.movingOffset)):this.store.updateElementsTransform(e,this.movingOffset),e.forEach(s=>{s.isTransforming=!0,s.onTransforming()}),this.selection.refresh(),this._shouldRedraw=!0}_rotateElements(){const{selectedElements:e,noParentElements:s}=this.store;this.store.isMultiSelected?(this.selection.rangeElement.isRotating=!0,this.store.updateElementsRotation([this.selection.rangeElement],this._pressMovePosition)):this.store.updateElementsRotation(s,this._pressMovePosition),e.forEach(n=>{n.isRotating=!0,n.onRotating()}),this.selection.refresh(),this._shouldRedraw=!0}_createRange(){const e=O.getBoxByPoints([this._pressDownStageWorldCoord,this._pressMoveStageWorldCoord]);this.selection.setRange(e)}async _handleCursorLeave(){this.cursor.clear(),this.cursor.setStyle("default")}_preProcessRotationStates(e){this.store.updateElementById(e.host.id,{isRotatingTarget:!0}),this.store.isMultiSelected?this.store.refreshElementsRotationStates([this.selection.rangeElement],this._pressDownPosition):this.store.refreshRotatingStates(this._pressDownPosition)}_processSelectWhilePressDown(e){const s=this.selection.getElementOnCoord(this.cursor.worldValue),n=this.store.isSelectedContainsTarget();e.ctrlKey?s&&this.store.toggleSelectElement(s):n||(this._clearStageSelects(),s&&this.store.selectElement(s))}async _handlePressDown(e){if(this._latestMousedownTimestamp=window.performance.now(),this._isPressDown=!0,this.calcPressDown(e),this.isTextEditing)this._isCursorOnEditingElement()?this._tryRetrieveTextCursor(ht.PRESS_DOWN,!1):(await this._commitEidting(),this._shouldSelectTopAWhilePressUp=!1);else if(this.isTextCreating)this.html.createTextInput(this.cursor.value);else if(this.isDrawerActive&&!this.store.isSelectedEqCreating())this._clearStageSelects();else if(this.isMoveableActive){const s=this._tryActiveController();s&&this._refreshElementsOriginals([...this.store.selectedElements,this.selection.rangeElement],{deepSubs:!0}),s instanceof Bt?(this._preProcessRotationStates(s),this.elementsStatus=se.ROTATING):s instanceof ft||s instanceof kt?this.elementsStatus=se.TRANSFORMING:s instanceof Xt?this.elementsStatus=se.CORNER_MOVING:this._processSelectWhilePressDown(e)}else this.isHandActive&&(this._originalStageWorldCoord=W.jsonClone(this.stageWorldCoord))}_isCursorOnEditingElement(){const e=this.selection.getElementOnCoord(this.cursor.worldValue);return this.store.editingElements.includes(e)}_tryRetrieveTextCursor(e,s){const{selectedElements:n}=this.store,r=this.selection.getElementOnCoord(this.cursor.worldValue);r&&r instanceof et&&n[0]===r&&(e!==ht.PRESS_UP&&(r.refreshTextCursorAtPosition(this.cursor.worldValue,s),this._retreiveTextCursorInput(r)),r.onEditorPressChange(e))}_refreshElementsOriginals(e,s){this.store.refreshElementsOriginalAngles(e,s),this.store.refreshElementsOriginals(e,s)}_handleArbitraryPressUp(){const e=this.store.creatingArbitraryElement(this.cursor.worldValue,!0);e!=null&&e.model.isFold&&this.commitArbitraryDrawing()}_clearStageSelects(){this.selection.clearSelects(),this.selection.setRange([])}async _endElementsOperation(){switch(this.elementsStatus){case se.MOVING:{await this._endElementsDrag();break}case se.ROTATING:{await this._endElementsRotate();break}case se.TRANSFORMING:{await this._endElementsTransform();break}case se.CORNER_MOVING:{await this._endMovingElementsCorner();break}}}_updateStatusWhileEndElementsOperation(){[se.ROTATING,se.TRANSFORMING,se.CORNER_MOVING,se.MOVING].includes(this.elementsStatus)&&this.store.isEditingEmpty&&(this.elementsStatus=se.NONE)}_selectTopAElementIfy(){this._shouldSelectTopAWhilePressUp&&this._selectTopAElement(this.store.selectedElements),this._shouldSelectTopAWhilePressUp=!0}async _handlePressUp(e){this._isPressDown=!1,this.calcPressUp(e),this.isTextEditing?this._tryRetrieveTextCursor(ht.PRESS_UP,!1):this.isArbitraryDrawing?(this._isPressDown=!0,this._handleArbitraryPressUp()):this.isDrawerActive?this.store.finishCreatingElement():this.isMoveableActive?this.store.isSelectedEmpty?(this.selection.selectRange(),this.selection.setRange(null)):this.checkCursorPressUpALittle(e)?(await this._endElementsOperation(),this._updateStatusWhileEndElementsOperation()):!e.ctrlKey&&!e.shiftKey&&this._selectTopAElementIfy():this.isHandActive&&this._processHandCreatorMove(e),this.isArbitraryDrawing||await this._tryCreatedRedraw()}_retreiveTextCursorInput(e){!e||!(e instanceof et)||(this.html.createTextCursorInput(),requestAnimationFrame(()=>{this.html.focusTextCursorInput()}))}async _handleDblClick(e){if(this.isMoveableActive){const{stageElements:s,selectedElements:n}=this.store;this._selectTopAElement(s),this.store.beginEditingElements(n),this.selection.refresh(),this._originalEditingDataList=await Promise.all(n.map(async r=>({model:await r.toOriginalTransformJson()}))),this.isTextEditing&&this._retreiveTextCursorInput(n[0])}}async _tryCreatedRedraw(){await Promise.all([this.selection.refresh(),this._addRedrawTask(!0),this.tryEmitElementCreated()])}async _createOriginalTranslateCommand(e){const s=await Promise.all(e.map(async r=>({model:await r.toOriginalTranslateJson()}))),n=await Promise.all(e.map(async r=>({model:await r.toTranslateJson()})));this._createUpdateCommandBy(s,n)}async _endElementsDrag(){const{selectedElements:e}=this.store;await this._createOriginalTranslateCommand(e),e.forEach(s=>{s.isDragging=!1,s.onTranslateAfter()}),this.store.isMultiSelected&&(this.selection.rangeElement.isDragging=!1)}async _createOrignalRotateCommand(e){const s=await Promise.all(e.map(async r=>({model:await r.toOriginalRotateJson()}))),n=await Promise.all(e.map(async r=>({model:await r.toRotateJson()})));this._createUpdateCommandBy(s,n)}async _endElementsRotate(){const{selectedElements:e}=this.store;await this._createOrignalRotateCommand(e),e.forEach(s=>{s.isRotatingTarget=!1,s.isRotating=!1,s.onRotateAfter()}),this.store.isMultiSelected&&(this.selection.rangeElement.isRotating=!1),this.store.clearRotatingStates()}async _createOriginalTransformCommand(e){const s=await Promise.all(e.map(async r=>({model:await r.toOriginalTransformJson()}))),n=await Promise.all(e.map(async r=>({model:await r.toTransformJson()})));this._createUpdateCommandBy(s,n)}async _endElementsTransform(){const{selectedElements:e,isEditingEmpty:s}=this.store;s&&(await this._createOriginalTransformCommand(e),e.forEach(n=>{n.isTransforming=!1,n.onTransformAfter()}),this.store.isMultiSelected&&(this.selection.rangeElement.isTransforming=!1))}async _createOriginalCornerCommand(e){const s=await Promise.all(e.map(async r=>({model:await r.toOriginalCornerJson()}))),n=await Promise.all(e.map(async r=>({model:await r.toCornerJson()})));this._createUpdateCommandBy(s,n)}async _endMovingElementsCorner(){const{selectedElements:e}=this.store;await this._createOriginalCornerCommand(e),e.forEach(s=>{s.isCornerMoving=!1,s.onCornerChanged()})}_selectTopAElement(e){const s=F.getTopAElementByCoord(e,this.cursor.worldValue);this.store.deSelectElements(this.store.selectedElements.filter(n=>s&&s.isGroup?n.ancestorGroup!==s:n!==s)),s&&this.store.selectElement(s)}_processHandCreatorMove(e){this._refreshStageWorldCoord(e),this.store.refreshStageElements(),this.selection.refresh(),this._isStageMoving=!1}async _createAddedCommand(e){const s=new Za({type:Ze.ElementsAdded,uDataList:await Promise.all(e.map(async n=>({model:await n.toJson()})))},this.store);this.undoRedo.add(s)}_emitElementsCreated(e){this.setCreator(Je),this.emit(E.elementCreated,e)}async tryEmitElementCreated(){const e=this.store.provisionalElements;e.length&&(this.store.updateElements(e,{isProvisional:!1,isOnStage:!0}),this._emitElementsCreated(e),await this._createAddedCommand(e))}calcPressDown(e){this._pressDownPosition=this.cursor.transform(e),this._pressDownStageWorldCoord=F.calcWorldCoord(this._pressDownPosition)}calcPressUp(e){this._pressUpPosition=this.cursor.transform(e),this._pressUpStageWorldCoord=F.calcWorldCoord(this._pressUpPosition)}calcPressMove(e){this._pressMovePosition=this.cursor.transform(e),this._pressMoveStageWorldCoord=F.calcWorldCoord(this._pressMovePosition)}checkCursorPressMovedALittle(e){return Math.abs(this._pressMoveStageWorldCoord.x-this._pressDownStageWorldCoord.x)>=dn||Math.abs(this._pressMoveStageWorldCoord.y-this._pressDownStageWorldCoord.y)>=hn}checkCursorPressUpALittle(e){return Math.abs(this._pressUpStageWorldCoord.x-this._pressDownStageWorldCoord.x)>=dn||Math.abs(this._pressUpStageWorldCoord.y-this._pressDownStageWorldCoord.y)>=hn}async _refreshSize(){const e=this.renderEl.getBoundingClientRect();this.stageRect=e,this._updateCanvasSize(e),this.store.refreshStageElements(),this.selection.refresh(),this.triggetEditingElementsStageChanged(),this._shouldRedraw=!0}_updateCanvasSize(e){this.mask.updateSize(e),this.provisional.updateSize(e),this.html.updateSize(e),this.updateSize(e)}async setCreator(e){this.currentCreator=e,this.emit(E.creatorChanged,e)}_creatingElementOnMovement(e){if(this.checkCursorPressMovedALittle(e))return this.store.creatingElement([this._pressDownStageWorldCoord,this._pressMoveStageWorldCoord])}_updatingArbitraryElementOnMovement(e){if(this.checkCursorPressMovedALittle(e))return this.store.creatingArbitraryElement(this._pressMoveStageWorldCoord,!1)}_refreshStageWorldCoord(e){if(!this._originalStageWorldCoord)return;const s=O.getEventPosition(e,this.stageRect,this.stageScale);this.stageWorldCoord={x:this._originalStageWorldCoord.x-(s.x-this._pressDownPosition.x),y:this._originalStageWorldCoord.y-(s.y-this._pressDownPosition.y)}}_checkScale(e){let s=k.clamp(this.stageScale+e,.02,5);return s=d.precise(s,2),this.stageScale===.02&&e>0&&(s=.1),s}async setScale(e){this.stageScale=e,Y.scale=e,this.html.updateSize(this.renderEl.getBoundingClientRect()),this.emit(E.scaleChanged,e),this.store.refreshStageElements(),this.selection.refresh(),this.triggetEditingElementsStageChanged(),this._shouldRedraw=!0}_handleWheelScale(e,s){const n=O.getEventPosition(s,this.stageRect,this.stageScale),r=F.calcWorldCoord(n),o=this._checkScale(e),a=(s.clientX-this.stageRect.left)/o,l=(s.clientY-this.stageRect.top)/o,c=r.x-a,h=r.y-l,u=c+this.stageRect.width/2/o,f=h+this.stageRect.height/2/o;this.stageWorldCoord={x:u,y:f},this.setScale(o)}_handleWheelMove(e){this.stageWorldCoord.x+=e.x/2/this.stageScale,this.stageWorldCoord.y+=e.y/2/this.stageScale,this.store.refreshStageElements(),this.selection.refresh(),this.store.editingElements.forEach(s=>s.onStageChanged()),this._shouldRedraw=!0}calcScaleAutoFitValueByBox(e){const{width:s,height:n}=O.calcRectangleSize(e);let r=d.precise(O.calcScale(this.stageRect,{width:s,height:n},Do*this.stageScale),2);return r=k.clamp(r,.02,1),r}calcScaleAutoFitValue(){const e=O.getBoxByPoints(this.store.visibleElements.map(s=>s.maxOutlineBoxCoords).flat());return this.calcScaleAutoFitValueByBox(e)}calcElementAutoFitValue(e){return this.calcScaleAutoFitValueByBox(e.maxOutlineBoxCoords)}setScaleAutoFit(){if(this.store.isVisibleEmpty)this.stageWorldCoord={x:0,y:0},this.setScale(1);else{const e=d.calcCenter(this.store.visibleElements.map(s=>s.rotateOutlineCoords.flat()).flat());this.stageWorldCoord=e,this.store.refreshStageElements(),this.setScale(this.calcScaleAutoFitValue())}}setScaleReduce(){const e=this._checkScale(-.05);this.setScale(e)}setScaleIncrease(){const e=this._checkScale(.05);this.setScale(e)}setScale100(){this.setScale(1)}_handleScaleReduce(){this.setScaleReduce()}_handleScaleIncrease(){this.setScaleIncrease()}_handleScaleAutoFit(){this.setScaleAutoFit()}_handleScale100(){this.setScale100()}async _handleImagePasted(e,s){this._clearStageSelects();const n=await this.store.insertImageElement(e),r=this.calcElementAutoFitValue(n);this.stageScale>r&&await this.setScale(r),await this._createAddedCommand([n]),s&&s()}async uploadImages(e){e.length&&await this.event.onImagesUpload(e)}_createRearrangeModel(e){var s,n,r,o;return{prevId:(n=(s=e.node.prev)==null?void 0:s.value)==null?void 0:n.id,nextId:(o=(r=e.node.next)==null?void 0:r.value)==null?void 0:o.id}}async _handleSelectsDelete(){if(this.store.isSelectedEmpty)return;const e=new el({type:Ze.ElementsRemoved,uDataList:await Promise.all(this.store.selectedElements.map(async s=>({model:await s.toJson(),...this._createRearrangeModel(s)})))},this.store);this.undoRedo.add(e),this.store.deleteSelects()}selectAll(){this.store.selectAll()}_handleSelectAll(){this.selectAll()}async _handleSelectCopy(){const e=await this.store.copySelectElements(),s=JSON.stringify(e);Pr.copyValueToClipboard(s)}async _handlePasteElements(e){const s=!e||e.length===0;s||this._clearStageSelects();const n=await this.store.pasteElements(e);s||this.selection.refresh(),await this._createAddedCommand(n)}_handleCancel(){this.isArbitraryDrawing?this.commitArbitraryDrawing():this.isArbitraryEditing&&this.commitEditingDrawing()}_handleSelectMoveable(){this.currentCreator.type===Is.type&&(this.setCreator(Je),this.cursor.updateStyle())}_handleSelectHand(){this.currentCreator.type===Je.type&&(this.setCreator(Is),this.cursor.updateStyle())}async _createGroupAddedDataList(e,s){const{id:n}=e;return await Promise.all(s.map(async r=>{const{id:o,model:{groupId:a}}=r;let l;const c=n===o;c?l=await r.toJson():a===n?l=await r.toGroupJson():l={id:o};const h={model:l,isGroup:c,...this._createRearrangeModel(r)};return a===n&&(h.isGroupSubject=!0),h}))}async _handleSelectGroup(){if(this.isElementsBusy||this.store.isSelectedEmpty)return;const e=await Promise.all(this.store.selectedElements.map(async n=>({model:{id:n.id},isGroupSubject:!n.isGroupSubject,...this._createRearrangeModel(n)}))),s=this.store.selectToGroup();if(s){e.push({model:{id:s.id},isGroup:!0}),this.store.selectGroup(s);const n=await this._createGroupAddedDataList(s,this.store.selectedElements),r=new tl({type:Ze.GroupAdded,uDataList:e,rDataList:n},this.store);this.undoRedo.add(r)}}async _createGroupRemovedCommand(e){const s=[];await Promise.all(e.map(async r=>{s.push({model:await r.toJson(),isGroup:!0,...this._createRearrangeModel(r)}),r.subs.forEach(async o=>{s.push({model:await o.toGroupJson(),isGroup:!1})})}));const n=new sl({type:Ze.GroupRemoved,uDataList:s},this.store);this.undoRedo.add(n)}async _handleSelectGroupCancel(){if(this.isElementsBusy)return;const e=this.store.getSelectedAncestorElementGroups();e.length!==0&&(await this._createGroupRemovedCommand(e),this.store.cancelGroups(e),e.forEach(s=>{s.subs.forEach(n=>{n.isSelected=!0})}))}async _handleUndo(){const e=this.undoRedo.tailUndoCommand;e&&(e instanceof bs||this.store.deSelectAll(),await this.undoRedo.undo(),this.selection.refresh(),this._shouldRedraw=!0,this.emit(E.selectedChanged,this.store.selectedElements))}async _handleRedo(){const e=this.undoRedo.tailRedoCommand;e&&(e instanceof bs||this.store.deSelectAll(),await this.undoRedo.redo(),this.selection.refresh(),this._shouldRedraw=!0,this.emit(E.selectedChanged,this.store.selectedElements))}async _handleTextInput(e,s,n,r){this._clearStageSelects();const o=F.calcWorldCoord(r),a=await this.store.insertTextElement(e,s,O.getBoxByLeftTop(o,n));window.performance.now()-this._latestMousedownTimestamp<=50&&(this._shouldSelectTopAWhilePressUp=!1),await this._addRedrawTask(!0),a.reCalcSizeAndCoords(),a.refresh(),await this._createAddedCommand([a]),this.selection.refresh(),this._emitElementsCreated([a])}async _handleTextUpdate(e,s){if(this.isTextEditing){const n=this.store.selectedElements[0],r=await n.updateText(e,s);if(!r)return;const{changed:o,reflow:a}=r;await this._addRedrawTask(!0),a&&await this._reflowTextIfy([n],!0,o)}}async setElementsAlignLeft(e){await this._createTranslateCommand(e,async()=>{await this.align.setElementsAlignLeft(e)}),e.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAlignRight(e){await this._createTranslateCommand(e,async()=>{await this.align.setElementsAlignRight(e)}),e.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAlignTop(e){await this._createTranslateCommand(e,async()=>{await this.align.setElementsAlignTop(e)}),e.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAlignBottom(e){await this._createTranslateCommand(e,async()=>{await this.align.setElementsAlignBottom(e)}),e.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAlignCenter(e){await this._createTranslateCommand(e,async()=>{await this.align.setElementsAlignCenter(e)}),e.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAlignMiddle(e){await this._createTranslateCommand(e,async()=>{await this.align.setElementsAlignMiddle(e)}),e.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAverageVertical(e){await this._createTranslateCommand(e,async()=>{await this.align.setElementsAverageVertical(e)}),e.forEach(s=>s.onPositionChanged()),this._shouldRedraw=!0}async setElementsAverageHorizontal(e){await this._createTranslateCommand(e,async()=>{await this.align.setElementsAverageHorizontal(e)}),e.forEach(s=>s.onPositionChanged()),this._shouldRedraw=!0}async commitArbitraryDrawing(){this.isArbitraryDrawing&&(this._isPressDown=!1,this.store.finishCreatingElement(),await this._tryCreatedRedraw())}async _commitEidting(){const{editingElements:e}=this.store,s=await Promise.all(e.map(async n=>({model:await n.toJson()})));this._createUpdateCommandBy(this._originalEditingDataList,s),this.store.endEditingElements(e),this.selection.refresh(),this.elementsStatus=se.NONE,this._originalEditingDataList=null}async commitEditingDrawing(){this.isArbitraryEditing&&await this._commitEidting()}async _createRearrangeCommand(e,s){const n=await Promise.all(e.map(async a=>({model:{id:a.id},...this._createRearrangeModel(a)})));await s();const r=await Promise.all(e.map(async a=>({model:{id:a.id},...this._createRearrangeModel(a)}))),o=new nl({type:Ze.ElementsRearranged,uDataList:n,rDataList:r},this.store);this.undoRedo.add(o)}async setElementsGoDown(e){await this._createRearrangeCommand(e,async()=>{await this.store.setElementsGoDown(e)}),e.forEach(s=>s.onLayerChanged()),this._shouldRedraw=!0}async setElementsShiftMove(e){await this._createRearrangeCommand(e,async()=>{await this.store.setElementsShiftMove(e)}),e.forEach(s=>s.onLayerChanged()),this._shouldRedraw=!0}}const H=new il,ol=new Ni;H.configure.config({rotationIconEnable:!0});const al=200,ll={leading:!0,trailing:!0},Fn={position:{x:0,y:0},width:0,height:0,angle:0,corners:[...Rt.corners],flipX:!1,leanYAngle:0,scale:1,strokes:[{...os}],fills:[{...as}],fontStyler:ue.fontStyler,fontSize:ue.fontSize,fontFamily:ue.fontFamily,fontLineHeight:ue.fontLineHeight,fontLineHeightFactor:ue.fontLineHeightFactor,fontLineHeightAutoFit:ue.fontLineHeightAutoFit,fontLetterSpacing:ue.fontLetterSpacing,fontColor:ue.fontColor,fontColorOpacity:ue.fontColorOpacity,fontStylerMixin:!1,fontSizeMixin:!1,fontFamilyMixin:!1,fontColorMixin:!1,fontColorOpacityMixin:!1,fontLetterSpacingMixin:!1,textAlign:ue.textAlign,textVerticalAlign:ue.textVerticalAlign,textBaseline:ue.textBaseline,textDecoration:ue.textDecoration,textDecorationColor:ue.textDecorationColor,textDecorationOpacity:ue.textDecorationOpacity,textDecorationThickness:ue.textDecorationThickness,textDecorationMixin:!1,textDecorationColorMixin:!1,textDecorationOpacityMixin:!1,textDecorationThicknessMixin:!1,paragraphSpacing:ue.paragraphSpacing,paragraphSpacingMixin:!1,isRatioLocked:!1,fillEnable:!1,strokeEnable:!1,fontEnable:!1,cornersEnable:!1,ratioLockedEnable:!1,fillInputEnable:!1,strokeInputEnable:!1,fontInputEnable:!1,fontLineHeightInputEnable:!1,fontLineHeightFactorInputEnable:!1,fontLetterSpacingInputEnable:!1,cornersInputEnable:!1,widthInputEnable:!1,heightInputEnable:!1,angleInputEnable:!1,leanYAngleInputEnable:!1,positionInputEnable:!1,paragraphSpacingInputEnable:!1,status:Q.initialed},le=Kn("stage",{state:()=>({currentCreator:Je,currentCursorCreator:Je,currentShapeCreator:qs,currentTextCreator:vr,currentArbitraryCreator:Us,selectedElements:[],targetElements:[],isMultiSelected:!1,primarySelectedElement:null,layerShiftMoveEnable:!1,layerGoDownEnable:!1,...W.jsonClone(Fn)}),getters:{inputDisabled(){return!this.primarySelectedElement},alignEnable(){var i;return((i=this.selectedElements)==null?void 0:i.length)>=2},averageEnable(){var i;return((i=this.selectedElements)==null?void 0:i.length)>=3},arbitraryVisible(){var i;return((i=this.currentCreator)==null?void 0:i.type)===I.arbitrary}},actions:{async init(i){await ol.init(i.containerEl),await H.init(i.shieldEl),this.setCreator(Je),[[E.elementCreated,this.onElementCreated],[E.selectedChanged,this.onSelectedChanged],[E.targetChanged,this.onTargetChanged],[E.multiSelectedChanged,this.onMultiSelectedChanged],[E.primarySelectedChanged,this.onPrimarySelectedChanged]].forEach(([t,e])=>{H.on(t,e.bind(this))}),[[E.positionChanged,this.onPositionChanged],[E.widthChanged,this.onWidthChanged],[E.heightChanged,this.onHeightChanged],[E.angleChanged,this.onAngleChanged],[E.cornersChanged,this.onCornersChanged],[E.flipXChanged,this.onFlipXChanged],[E.leanYAngleChanged,this.onLeanYAngleChanged],[E.scaleChanged,this.onScaleChanged],[E.strokesChanged,this.onStrokesChanged],[E.fillsChanged,this.onFillsChanged],[E.statusChanged,this.onStatusChanged],[E.fontStylerChanged,this.onFontStylerChanged],[E.fontSizeChanged,this.onFontSizeChanged],[E.fontFamilyChanged,this.onFontFamilyChanged],[E.fontLineHeightChanged,this.onFontLineHeightChanged],[E.fontLineHeightFactorChanged,this.onFontLineHeightFactorChanged],[E.fontLineHeightAutoFitChanged,this.onFontLineHeightAutoFitChanged],[E.fontLetterSpacingChanged,this.onFontLetterSpacingChanged],[E.fontColorChanged,this.onFontColorChanged],[E.fontColorOpacityChanged,this.onFontColorOpacityChanged],[E.fontStylerMixinChanged,this.onFontStylerMixinChanged],[E.fontSizeMixinChanged,this.onFontSizeMixinChanged],[E.fontFamilyMixinChanged,this.onFontFamilyMixinChanged],[E.fontColorMixinChanged,this.onFontColorMixinChanged],[E.fontColorOpacityMixinChanged,this.onFontColorOpacityMixinChanged],[E.fontLetterSpacingMixinChanged,this.onFontLetterSpacingMixinChanged],[E.textDecorationChanged,this.onTextDecorationChanged],[E.textDecorationColorChanged,this.onTextDecorationColorChanged],[E.textDecorationOpacityChanged,this.onTextDecorationOpacityChanged],[E.textDecorationThicknessChanged,this.onTextDecorationThicknessChanged],[E.textDecorationMixinChanged,this.onTextDecorationMixinChanged],[E.textDecorationColorMixinChanged,this.onTextDecorationColorMixinChanged],[E.textDecorationOpacityMixinChanged,this.onTextDecorationOpacityMixinChanged],[E.textDecorationThicknessMixinChanged,this.onTextDecorationThicknessMixinChanged],[E.textAlignChanged,this.onTextAlignChanged],[E.textVerticalAlignChanged,this.onTextVerticalAlignChanged],[E.textBaselineChanged,this.onTextBaselineChanged],[E.ratioLockedChanged,this.onRatioLockedChanged],[E.creatorChanged,this.onCreatorChanged],[E.layerShiftMoveEnableChanged,this.onLayerShiftMoveEnableChanged],[E.layerGoDownEnableChanged,this.onLayerGoDownEnableChanged],[E.paragraphSpacingChanged,this.onParagraphSpacingChanged]].forEach(([t,e])=>{H.on(t,k.throttle(e.bind(this),al,ll))})},async setCreator(i){await H.setCreator(i)},onCreatorChanged(i){this.currentCreator=i,i.category===he.cursor&&(this.currentCursorCreator=i),i.category===he.shapes&&(this.currentShapeCreator=i),i.category===he.freedom&&(this.currentArbitraryCreator=i)},onMultiSelectedChanged(i){this.isMultiSelected=i},onPrimarySelectedChanged(i){this.primarySelectedElement=i},onElementCreated(i){i.length&&this.onElementChanged(i[0])},onSelectedChanged(i){if(this.selectedElements=i,this.selectedElements.length){const t=F.getAncestorGroup(this.selectedElements);if(!t){Object.assign(this,W.jsonClone(Fn));return}this.onElementChanged(t)}},onElementChanged(i){if(!i)return;const{status:t,position:e,width:s,height:n,angle:r,corners:o,flipX:a,leanYAngle:l,strokes:c,fills:h,fontStyler:u,fontSize:f,fontFamily:m,fontColor:C,fontColorOpacity:y,fontStylerMixin:w,fontSizeMixin:L,fontFamilyMixin:B,fontColorMixin:j,fontColorOpacityMixin:b,fontLetterSpacingMixin:S,fontLineHeight:A,fontLineHeightFactor:M,fontLineHeightAutoFit:D,fontLetterSpacing:J,textAlign:G,textVerticalAlign:oe,textBaseline:ye,isRatioLocked:Ge,textDecoration:qe,textDecorationColor:be,textDecorationOpacity:$e,textDecorationThickness:we,textDecorationMixin:Ye,textDecorationColorMixin:it,textDecorationOpacityMixin:ot,textDecorationThicknessMixin:He,paragraphSpacing:at}=i;this.onStatusChanged(i,t),this.onPositionChanged(i,e),this.onWidthChanged(i,s),this.onHeightChanged(i,n),this.onAngleChanged(i,r),this.onCornersChanged(i,o),this.onFlipXChanged(i,a),this.onLeanYAngleChanged(i,l),this.onStrokesChanged(i,c),this.onFillsChanged(i,h),this.onFontStylerChanged(i,u),this.onFontSizeChanged(i,f),this.onFontFamilyChanged(i,m),this.onFontLineHeightChanged(i,A),this.onFontLineHeightFactorChanged(i,M),this.onFontLineHeightAutoFitChanged(i,D),this.onFontLetterSpacingChanged(i,J),this.onFontColorChanged(i,C),this.onFontColorOpacityChanged(i,y),this.onFontStylerMixinChanged(i,w),this.onFontSizeMixinChanged(i,L),this.onFontFamilyMixinChanged(i,B),this.onFontColorMixinChanged(i,j),this.onFontColorOpacityMixinChanged(i,b),this.onFontLetterSpacingMixinChanged(i,S),this.onTextAlignChanged(i,G),this.onTextVerticalAlignChanged(i,oe),this.onTextBaselineChanged(i,ye),this.onRatioLockedChanged(i,Ge),this.onTextDecorationChanged(i,qe),this.onTextDecorationColorChanged(i,be),this.onTextDecorationOpacityChanged(i,$e),this.onTextDecorationThicknessChanged(i,we),this.onTextDecorationMixinChanged(i,Ye),this.onTextDecorationColorMixinChanged(i,it),this.onTextDecorationOpacityMixinChanged(i,ot),this.onTextDecorationThicknessMixinChanged(i,He),this.onParagraphSpacingChanged(i,at)},onTargetChanged(i){this.targetElements=i},onStatusChanged(i,t){this.status=t;const{fillEnable:e,strokeEnable:s,fontEnable:n,cornersEnable:r,ratioLockedEnable:o,widthInputEnable:a,heightInputEnable:l,fillInputEnable:c,strokeInputEnable:h,fontInputEnable:u,fontLineHeightInputEnable:f,fontLineHeightFactorInputEnable:m,fontLetterSpacingInputEnable:C,cornersInputEnable:y,angleInputEnable:w,leanYAngleInputEnable:L,positionInputEnable:B,paragraphSpacingInputEnable:j}=i;this.fillEnable=e,this.strokeEnable=s,this.fontEnable=n,this.cornersEnable=r,this.ratioLockedEnable=o,this.widthInputEnable=a,this.heightInputEnable=l,this.fillInputEnable=c,this.strokeInputEnable=h,this.fontInputEnable=u,this.fontLineHeightInputEnable=f,this.fontLineHeightFactorInputEnable=m,this.fontLetterSpacingInputEnable=C,this.angleInputEnable=w,this.leanYAngleInputEnable=L,this.cornersInputEnable=y,this.positionInputEnable=B,this.paragraphSpacingInputEnable=j},onPositionChanged(i,t){t&&(this.position={x:t.x,y:t.y})},onWidthChanged(i,t){this.width=t},onHeightChanged(i,t){this.height=t},onAngleChanged(i,t){this.angle=t},onCornersChanged(i,t){this.corners=[...t]},onFlipXChanged(i,t){this.flipX=t},onLeanYAngleChanged(i,t){this.leanYAngle=t},onScaleChanged(i){this.scale=i},onStrokesChanged(i,t=[]){this.strokes=W.jsonClone(t)},onFillsChanged(i,t=[]){this.fills=W.jsonClone(t)},onFontStylerChanged(i,t){this.fontStyler=W.jsonClone(t)},onFontSizeChanged(i,t){this.fontSize=t},onFontFamilyChanged(i,t){this.fontFamily=t},onFontLineHeightChanged(i,t){this.fontLineHeight=t},onFontLineHeightFactorChanged(i,t){this.fontLineHeightFactor=t},onFontLineHeightAutoFitChanged(i,t){this.fontLineHeightAutoFit=t},onFontLetterSpacingChanged(i,t){this.fontLetterSpacing=t},onFontColorChanged(i,t){this.fontColor=t},onFontColorOpacityChanged(i,t){this.fontColorOpacity=t},onFontStylerMixinChanged(i,t){this.fontStylerMixin=t},onFontSizeMixinChanged(i,t){this.fontSizeMixin=t},onFontFamilyMixinChanged(i,t){this.fontFamilyMixin=t},onFontColorMixinChanged(i,t){this.fontColorMixin=t},onFontColorOpacityMixinChanged(i,t){this.fontColorOpacityMixin=t},onFontLetterSpacingMixinChanged(i,t){this.fontLetterSpacingMixin=t},onTextAlignChanged(i,t){this.textAlign=t},onTextVerticalAlignChanged(i,t){this.textVerticalAlign=t},onTextBaselineChanged(i,t){this.textBaseline=t},onTextDecorationChanged(i,t){this.textDecoration=t},onTextDecorationColorChanged(i,t){this.textDecorationColor=t},onTextDecorationOpacityChanged(i,t){this.textDecorationOpacity=t},onTextDecorationThicknessChanged(i,t){this.textDecorationThickness=t},onTextDecorationMixinChanged(i,t){this.textDecorationMixin=t},onTextDecorationColorMixinChanged(i,t){this.textDecorationColorMixin=t},onTextDecorationOpacityMixinChanged(i,t){this.textDecorationOpacityMixin=t},onTextDecorationThicknessMixinChanged(i,t){this.textDecorationThicknessMixin=t},onRatioLockedChanged(i,t){this.isRatioLocked=t},onParagraphSpacingChanged(i,t){this.paragraphSpacing=t},onLayerShiftMoveEnableChanged(i){this.layerShiftMoveEnable=i},onLayerGoDownEnableChanged(i){this.layerGoDownEnable=i},setElementsPosition(i){H.setElementsPosition(X(this.selectedElements),i)},setElementsWidth(i){H.setElementsWidth(X(this.selectedElements),i)},setElementsHeight(i){H.setElementsHeight(X(this.selectedElements),i)},setElementsAngle(i){H.setElementsAngle(X(this.selectedElements),i)},setElementsCorners(i,t){H.setElementsCorners(X(this.selectedElements),i,t)},setElementsLeanYAngle(i){H.setElementsLeanYAngle(X(this.selectedElements),i)},setElementsStrokeType(i,t){H.setElementsStrokeType(X(this.selectedElements),i,t)},setElementsStrokeWidth(i,t){H.setElementsStrokeWidth(X(this.selectedElements),i,t)},setElementsStrokeColor(i,t){H.setElementsStrokeColor(X(this.selectedElements),i,t)},setElementsStrokeColorOpacity(i,t){H.setElementsStrokeColorOpacity(X(this.selectedElements),i,t)},addElementsStroke(i){H.addElementsStroke(X(this.selectedElements),i)},removeElementsStroke(i){H.removeElementsStroke(X(this.selectedElements),i)},setElementsFillColor(i,t){H.setElementsFillColor(X(this.selectedElements),i,t)},setElementsFillColorOpacity(i,t){H.setElementsFillColorOpacity(X(this.selectedElements),i,t)},addElementsFill(i){H.addElementsFill(X(this.selectedElements),i)},removeElementsFill(i){H.removeElementsFill(X(this.selectedElements),i)},setElementsTextAlign(i){H.setElementsTextAlign(X(this.selectedElements),i)},setElementsTextVerticalAlign(i){H.setElementsTextVerticalAlign(X(this.selectedElements),i)},setElementsTextBaseline(i){H.setElementsTextBaseline(X(this.selectedElements),i)},setElementsFontStyler(i){H.setElementsFontStyler(X(this.selectedElements),i)},setElementsFontSize(i){H.setElementsFontSize(X(this.selectedElements),i)},setElementsFontFamily(i){H.setElementsFontFamily(X(this.selectedElements),i)},setElementsFontLineHeight(i){H.setElementsFontLineHeight(X(this.selectedElements),i)},setElementsFontLineHeightFactor(i){H.setElementsFontLineHeightFactor(X(this.selectedElements),i)},setElementsFontLineHeightAutoFit(i){H.setElementsFontLineHeightAutoFit(X(this.selectedElements),i)},setElementsFontColor(i){H.setElementsFontColor(X(this.selectedElements),i)},setElementsFontColorOpacity(i){H.setElementsFontColorOpacity(X(this.selectedElements),i)},setElementsFontLetterSpacing(i){H.setElementsFontLetterSpacing(X(this.selectedElements),i)},setElementsTextDecoration(i){H.setElementsTextDecoration(X(this.selectedElements),i)},setElementsTextDecorationColor(i){H.setElementsTextDecorationColor(X(this.selectedElements),i)},setElementsTextDecorationOpacity(i){H.setElementsTextDecorationOpacity(X(this.selectedElements),i)},setElementsTextDecorationThickness(i){H.setElementsTextDecorationThickness(X(this.selectedElements),i)},setScale(i){H.setScale(i)},setScaleAutoFit(){H.setScaleAutoFit()},setScaleIncrease(){H.setScaleIncrease()},setScaleReduce(){H.setScaleReduce()},setRatioLocked(i){H.setElementsRatioLocked(X(this.selectedElements),i)},setElementsAlignLeft(){this.alignEnable&&H.setElementsAlignLeft(X(this.selectedElements))},setElementsAlignCenter(){this.alignEnable&&H.setElementsAlignCenter(X(this.selectedElements))},setElementsAlignRight(){this.alignEnable&&H.setElementsAlignRight(X(this.selectedElements))},setElementsAlignTop(){this.alignEnable&&H.setElementsAlignTop(X(this.selectedElements))},setElementsAlignMiddle(){this.alignEnable&&H.setElementsAlignMiddle(X(this.selectedElements))},setElementsAlignBottom(){this.alignEnable&&H.setElementsAlignBottom(X(this.selectedElements))},setElementsAverageVertical(){this.averageEnable&&H.setElementsAverageVertical(X(this.selectedElements))},setElementsAverageHorizontal(){this.averageEnable&&H.setElementsAverageHorizontal(X(this.selectedElements))},setElementsGoDown(){this.layerGoDownEnable&&H.setElementsGoDown(X(this.selectedElements))},setElementsShiftMove(){this.layerShiftMoveEnable&&H.setElementsShiftMove(X(this.selectedElements))},uploadImages(i){i.length&&H.uploadImages(i)},commitArbitraryDrawing(){H.commitArbitraryDrawing()},setElementsParagraphSpacing(i){H.setElementsParagraphSpacing(X(this.selectedElements),i)}}}),cl={class:"tool-dropdown"},dl=ie({__name:"CreatorDropdown",props:{creators:Array,currentCreator:Object,select:Function},setup(i){const t=le(),e=q([]),s=k.debounce(async()=>{t.uploadImages(e.value),e.value=[]},500),n=r=>(e.value.push(r),s(),!1);return(r,o)=>{const a=De,l=Di,c=yi,h=Qn,u=Zn,f=er;return N(),fe(f,null,{dropdown:P(()=>[x(u,null,{default:P(()=>[(N(!0),$(ve,null,Oe(i.creators,m=>(N(),fe(h,{key:m.type,class:K([{selected:m.type===i.currentCreator.type}]),onClick:C=>i.select(m)},{default:P(()=>[m.type===p(I).image?(N(),fe(c,{key:0,action:"",multiple:"",accept:"image/*","before-upload":n},{default:P(()=>[x(l,{creator:m},null,8,["creator"])]),_:2},1024)):(N(),fe(l,{key:1,creator:m},null,8,["creator"]))]),_:2},1032,["class","onClick"]))),128))]),_:1})]),default:P(()=>[T("div",cl,[x(a,{class:"icon-verbise-arrow_down iconfont"})])]),_:1})}}}),ce=(i,t)=>{const e=i.__vccOpts||i;for(const[s,n]of t)e[s]=n;return e},hl=ce(dl,[["__scopeId","data-v-1f27b774"]]),ul={class:"create-bar"},fl=ie({__name:"CreatorBar",emits:["select"],setup(i,{emit:t}){const e=t,s=le(),n=bt(()=>s.currentCreator),r=bt(()=>s.currentCursorCreator),o=bt(()=>s.currentShapeCreator),a=bt(()=>s.currentArbitraryCreator),l=bt(()=>s.currentTextCreator),c=h=>{e("select",h)};return(h,u)=>{const f=De,m=hl;return N(),$("div",ul,[T("div",{class:K(["tool-item",{selected:r.value.category===n.value.category}]),onClick:u[0]||(u[0]=C=>c(r.value))},[x(f,{class:K(["iconfont",r.value.icon])},null,8,["class"])],2),x(m,{creators:p(br),"current-creator":n.value,select:c},null,8,["creators","current-creator"]),T("div",{class:K(["tool-item",{selected:o.value.category===n.value.category}]),onClick:u[1]||(u[1]=C=>c(o.value))},[x(f,{class:K(["iconfont",o.value.icon])},null,8,["class"])],2),x(m,{creators:p(wr),"current-creator":n.value,select:c},null,8,["creators","current-creator"]),T("div",{class:K(["tool-item",{selected:a.value.category===n.value.category}]),onClick:u[2]||(u[2]=C=>c(a.value))},[x(f,{class:K(["iconfont",a.value.icon])},null,8,["class"])],2),x(m,{creators:p(Tr),"current-creator":n.value,select:c},null,8,["creators","current-creator"]),T("div",{class:K(["tool-item",{selected:l.value.category===n.value.category}]),onClick:u[3]||(u[3]=C=>c(l.value))},[x(f,{class:K(["iconfont",l.value.icon])},null,8,["class"])],2)])}}}),gl={class:"arbitrary-bar"},ml={class:"tool-item"},pl=ie({__name:"ArbitraryBar",setup(i){const t=le();return(e,s)=>{const n=De;return Le((N(),$("div",gl,[T("div",ml,[x(n,{onClick:p(t).commitArbitraryDrawing},{default:P(()=>[x(p(_i))]),_:1},8,["onClick"])])],512)),[[Re,p(t).arbitraryVisible]])}}}),Cl=ce(pl,[["__scopeId","data-v-08f9f196"]]),yl={class:"stage-shield"},_l=ie({__name:"shield",setup(i,{expose:t}){let e;return t({init:async()=>new Promise(n=>{e=n,e()})}),(n,r)=>(N(),$("div",yl))}}),El=ie({__name:"container",setup(i){const t=le(),e=q(null),s=q(),n=r=>{const{type:o}=r;o!==I.image&&t.setCreator(r)};return ui(async()=>{s.value&&await s.value.init(),await t.init({containerEl:e.value,shieldEl:s.value.$el})}),(r,o)=>{const a=Cl,l=fl;return N(),$("div",{class:"stage-container",ref_key:"stageRef",ref:e},[x(_l,{ref_key:"stageShieldRef",ref:s},null,512),x(a),x(l,{onSelect:n})],512)}}}),xl=ce(El,[["__scopeId","data-v-a64de043"]]),Sl={class:K(["layer-props right-props"])},vl={class:"layer-props__row"},bl=ie({__name:"LayerProps",setup(i){const t=le();return(e,s)=>{const n=De;return N(),$("div",Sl,[s[0]||(s[0]=T("div",{class:"layer-props__title"},[T("span",{class:"layer-props__title-text"},"层级")],-1)),T("div",vl,[x(n,{class:K(["iconfont","icon-verbise-layer-go-down",{disabled:!p(t).layerGoDownEnable}]),onClick:p(t).setElementsGoDown,title:"下移"},null,8,["class","onClick"]),x(n,{class:K(["iconfont","icon-verbise-layer-shift-move",{disabled:!p(t).layerShiftMoveEnable}]),onClick:p(t).setElementsShiftMove,title:"上移"},null,8,["class","onClick"])])])}}}),wl=ce(bl,[["__scopeId","data-v-a63d4953"]]),Tl={class:"stroke-props right-props"},Al={class:"stroke-props__title"},Pl={class:"stroke-props__row color"},Ol={class:"stroke-props__row-item"},Ll={class:"stroke-props__row-item",style:{width:"106px"}},Rl={class:"stroke-props__row"},kl={class:"stroke-props__row-item"},Il={class:"stroke-props__row-item",style:{width:"106px"}},Fl=ie({__name:"StrokeProps",setup(i){const t=q(),e=le(),s=q([{...os}]);Z(()=>e.strokes,o=>{s.value=o});const n=q([]);Z(()=>{var o;return(o=e.primarySelectedElement)==null?void 0:o.model.type},o=>{n.value=Gi(o)});const r=()=>{e.strokeInputEnable&&t.value.show()};return(o,a)=>{const l=De,c=ss,h=ns,u=ke,f=mt,m=pt;return Le((N(),$("div",Tl,[T("div",Al,[a[1]||(a[1]=T("span",{class:"stroke-props__title-text"},"描边",-1)),x(l,null,{default:P(()=>[x(p(tr),{onClick:a[0]||(a[0]=C=>p(e).addElementsStroke(s.value.length-1))})]),_:1})]),(N(!0),$(ve,null,Oe(s.value,(C,y)=>{var w;return N(),$("div",{key:y},[T("div",Pl,[T("div",Ol,[x(c,{modelValue:C.color,"onUpdate:modelValue":L=>C.color=L,onChange:L=>p(e).setElementsStrokeColor(L,y),ref_for:!0,ref_key:"colorPickerRef",ref:t,disabled:p(e).inputDisabled||!p(e).strokeInputEnable},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),x(h,{type:"info",onClick:r},{default:P(()=>[z(ge(C.color),1)]),_:2},1024)]),T("div",Ll,[x(u,{modelValue:C.colorOpacity,"onUpdate:modelValue":L=>C.colorOpacity=L,placeholder:"输入数字",type:"number",min:"0",max:"100",precision:"0",onChange:L=>p(e).setElementsStrokeColorOpacity(Number(L),y),disabled:p(e).inputDisabled||!p(e).strokeInputEnable},{prepend:P(()=>a[2]||(a[2]=[z("透明")])),append:P(()=>a[3]||(a[3]=[z("%")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"])]),x(l,null,{default:P(()=>[s.value.length>1?(N(),fe(p(sr),{key:0,onClick:L=>p(e).removeElementsStroke(y)},null,8,["onClick"])):Ft("",!0)]),_:2},1024)]),T("div",Rl,[T("div",kl,[x(m,{modelValue:C.type,"onUpdate:modelValue":L=>C.type=L,placeholder:"描边类型",size:"small",onChange:L=>p(e).setElementsStrokeType(L,y),disabled:p(e).inputDisabled||!p(e).strokeInputEnable},{default:P(()=>[(N(!0),$(ve,null,Oe(n.value,L=>(N(),fe(f,{key:L.type,label:L.name,value:L.type},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"])]),T("div",Il,[x(u,{modelValue:C.width,"onUpdate:modelValue":L=>C.width=L,placeholder:"输入数字",type:"number",precision:"1",min:((w=p(e).primarySelectedElement)==null?void 0:w.model.type)===p(I).line?1:0,onChange:L=>p(e).setElementsStrokeWidth(Number(L),y),disabled:p(e).inputDisabled||!p(e).strokeInputEnable},{prepend:P(()=>a[4]||(a[4]=[z("宽度")])),append:P(()=>a[5]||(a[5]=[z("px")])),_:2},1032,["modelValue","onUpdate:modelValue","min","onChange","disabled"])])])])}),128))],512)),[[Re,p(e).strokeEnable]])}}}),Bl=ce(Fl,[["__scopeId","data-v-f747f2c4"]]),Ml={class:"fill-props right-props"},Dl={class:"fill-props__title"},Nl={class:"fill-props__row color"},Vl={class:"fill-props__row-item"},Hl={class:"fill-props__row-item",style:{width:"106px"}},zl=ie({__name:"FillProps",setup(i){const t=q(),e=le(),s=q([{...as}]);Z(()=>e.fills,r=>{s.value=r});const n=()=>{e.fillInputEnable&&t.value.show()};return(r,o)=>{const a=De,l=ss,c=ns,h=ke;return Le((N(),$("div",Ml,[T("div",Dl,[o[1]||(o[1]=T("span",{class:"fill-props__title-text"},"填充",-1)),x(a,null,{default:P(()=>[x(p(tr),{onClick:o[0]||(o[0]=u=>p(e).addElementsFill(s.value.length-1))})]),_:1})]),(N(!0),$(ve,null,Oe(s.value,(u,f)=>(N(),$("div",{key:f},[T("div",Nl,[T("div",Vl,[x(l,{modelValue:u.color,"onUpdate:modelValue":m=>u.color=m,onChange:m=>p(e).setElementsFillColor(m,f),ref_for:!0,ref_key:"colorPickerRef",ref:t,disabled:p(e).inputDisabled||!p(e).fillInputEnable},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),x(c,{type:"info",onClick:n},{default:P(()=>[z(ge(u.color),1)]),_:2},1024)]),T("div",Hl,[x(h,{modelValue:u.colorOpacity,"onUpdate:modelValue":m=>u.colorOpacity=m,placeholder:"输入数字",type:"number",min:"0",max:"100",precision:"0",onChange:m=>p(e).setElementsFillColorOpacity(Number(m),f),disabled:p(e).inputDisabled||!p(e).fillInputEnable},{prepend:P(()=>o[2]||(o[2]=[z("透明")])),append:P(()=>o[3]||(o[3]=[z("%")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"])]),x(a,null,{default:P(()=>[s.value.length>1?(N(),fe(p(sr),{key:0,onClick:m=>p(e).removeElementsFill(f)},null,8,["onClick"])):Ft("",!0)]),_:2},1024)])]))),128))],512)),[[Re,p(e).fillEnable]])}}}),Wl=ce(zl,[["__scopeId","data-v-1799722b"]]),jl={class:K(["font-props right-props"])},Gl={class:"font-props__row"},$l={class:"fill-props__row-item"},Yl={class:"fill-props__row-item",style:{width:"106px"}},Xl={class:"font-props__row color"},ql={class:"font-props__row-item"},Ul={class:"font-props__row-item",style:{width:"106px"}},Jl=ie({__name:"FontTextDecorationProps",setup(i){const t=le(),e=q(),s=q(gr),n=q(Cr),r=q(!1),o=q(mr),a=q(pr),l=q(!1),c=q(!1);Z(()=>t.textDecoration,u=>{s.value=u}),Z(()=>t.textDecorationThickness,u=>{n.value=u}),Z(()=>t.textDecorationThicknessMixin,u=>{r.value=u}),Z(()=>t.textDecorationColor,u=>{o.value=u}),Z(()=>t.textDecorationColorMixin,u=>{l.value=u}),Z(()=>t.textDecorationOpacity,u=>{a.value=u}),Z(()=>t.textDecorationOpacityMixin,u=>{c.value=u});const h=()=>{t.fontInputEnable&&e.value.show()};return(u,f)=>{const m=Ws,C=js,y=ke,w=ss,L=ns;return Le((N(),$("div",jl,[f[14]||(f[14]=T("div",{class:"font-props__title"},[T("span",{class:"font-props__title-text text-2"},"文本装饰")],-1)),T("div",Gl,[T("div",$l,[x(C,null,{default:P(()=>[x(m,{type:s.value===p(Ee).none?"success":"default",disabled:p(t).inputDisabled||!p(t).fontInputEnable,class:K(["iconfont","icon-verbise-decoration-none"]),title:"无装饰",onClick:f[0]||(f[0]=B=>p(t).setElementsTextDecoration(p(Ee).none))},null,8,["type","disabled"]),x(m,{type:s.value===p(Ee).underline?"success":"default",disabled:p(t).inputDisabled||!p(t).fontInputEnable,class:K(["iconfont","icon-verbise-decoration-underline"]),title:"下划线",onClick:f[1]||(f[1]=B=>p(t).setElementsTextDecoration(p(Ee).underline))},null,8,["type","disabled"]),x(m,{type:s.value===p(Ee).overline?"success":"default",disabled:p(t).inputDisabled||!p(t).fontInputEnable,class:K(["iconfont","icon-verbise-decoration-overline"]),title:"上划线",onClick:f[2]||(f[2]=B=>p(t).setElementsTextDecoration(p(Ee).overline))},null,8,["type","disabled"]),x(m,{type:s.value===p(Ee).lineThrough?"success":"default",disabled:p(t).inputDisabled||!p(t).fontInputEnable,class:K(["iconfont","icon-verbise-decoration-line-through"]),title:"删除线",onClick:f[3]||(f[3]=B=>p(t).setElementsTextDecoration(p(Ee).lineThrough))},null,8,["type","disabled"])]),_:1})]),T("div",Yl,[x(y,{modelValue:n.value,"onUpdate:modelValue":f[4]||(f[4]=B=>n.value=B),disabled:p(t).inputDisabled||!p(t).fontInputEnable,size:"small",placeholder:`${r.value?"混合线宽":`${n.value}px`}`,type:"number",min:1,max:100,precision:0,onChange:f[5]||(f[5]=B=>p(t).setElementsTextDecorationThickness(Number(B)))},{prepend:P(()=>f[10]||(f[10]=[z("线宽")])),append:P(()=>f[11]||(f[11]=[z("px")])),_:1},8,["modelValue","disabled","placeholder"])])]),T("div",Xl,[T("div",ql,[x(w,{modelValue:o.value,"onUpdate:modelValue":f[6]||(f[6]=B=>o.value=B),onChange:f[7]||(f[7]=B=>p(t).setElementsTextDecorationColor(B)),ref_key:"colorPickerRef",ref:e,disabled:p(t).inputDisabled||!p(t).fontInputEnable},null,8,["modelValue","disabled"]),x(L,{type:"info",onClick:h},{default:P(()=>[z(ge(`${l.value?"混合颜色":o.value}`),1)]),_:1})]),T("div",Ul,[x(y,{modelValue:a.value,"onUpdate:modelValue":f[8]||(f[8]=B=>a.value=B),placeholder:`${c.value?"混合透明度":a.value}`,type:"number",min:"0",max:"100",precision:0,onChange:f[9]||(f[9]=B=>p(t).setElementsTextDecorationOpacity(Number(B))),disabled:p(t).inputDisabled||!p(t).fontInputEnable},{prepend:P(()=>f[12]||(f[12]=[z("透明")])),append:P(()=>f[13]||(f[13]=[z("%")])),_:1},8,["modelValue","placeholder","disabled"])])])],512)),[[Re,p(t).fontEnable]])}}}),Kl=ce(Jl,[["__scopeId","data-v-f3afdb30"]]),Ql={class:K(["font-props right-props"])},Zl={class:"font-props__row"},ec={class:"fill-props__row-item"},tc={class:"fill-props__row-item"},sc=ie({__name:"FontAlignProps",setup(i){const t=le(),e=q(cr),s=q(dr);return Z(()=>t.textAlign,n=>{e.value=n}),Z(()=>t.textVerticalAlign,n=>{s.value=n}),(n,r)=>{const o=Ws,a=js;return Le((N(),$("div",Ql,[r[6]||(r[6]=T("div",{class:"font-props__title"},[T("span",{class:"font-props__title-text text-2"},"文本对齐")],-1)),T("div",Zl,[T("div",ec,[x(a,null,{default:P(()=>[x(o,{type:e.value==="left"?"success":"default",disabled:p(t).inputDisabled||!p(t).fontInputEnable,class:K(["iconfont","icon-verbise-text-align-left"]),onClick:r[0]||(r[0]=l=>p(t).setElementsTextAlign("left"))},null,8,["type","disabled"]),x(o,{type:e.value==="center"?"success":"default",disabled:p(t).inputDisabled||!p(t).fontInputEnable,class:K(["iconfont","icon-verbise-text-align-center"]),onClick:r[1]||(r[1]=l=>p(t).setElementsTextAlign("center"))},null,8,["type","disabled"]),x(o,{type:e.value==="right"?"success":"default",disabled:p(t).inputDisabled||!p(t).fontInputEnable,class:K(["iconfont","icon-verbise-text-align-right"]),onClick:r[2]||(r[2]=l=>p(t).setElementsTextAlign("right"))},null,8,["type","disabled"])]),_:1})]),T("div",tc,[x(a,null,{default:P(()=>[x(o,{type:s.value===p(Qe).top?"success":"default",disabled:p(t).inputDisabled||!p(t).fontInputEnable,class:K(["iconfont","icon-verbise-vertical-align-top"]),onClick:r[3]||(r[3]=l=>p(t).setElementsTextVerticalAlign(p(Qe).top))},null,8,["type","disabled"]),x(o,{type:s.value===p(Qe).middle?"success":"default",disabled:p(t).inputDisabled||!p(t).fontInputEnable,class:K(["iconfont","icon-verbise-vertical-align-middle"]),onClick:r[4]||(r[4]=l=>p(t).setElementsTextVerticalAlign(p(Qe).middle))},null,8,["type","disabled"]),x(o,{type:s.value===p(Qe).bottom?"success":"default",disabled:p(t).inputDisabled||!p(t).fontInputEnable,class:K(["iconfont","icon-verbise-vertical-align-bottom"]),onClick:r[5]||(r[5]=l=>p(t).setElementsTextVerticalAlign(p(Qe).bottom))},null,8,["type","disabled"])]),_:1})])])],512)),[[Re,p(t).fontEnable]])}}}),nc=ce(sc,[["__scopeId","data-v-be1950f0"]]),rc={class:"font-props right-props"},ic={class:"font-props__row"},oc={class:"font-props__row-item"},ac=ie({__name:"FontParagraphSpacingProps",setup(i){const t=le(),e=q(yr);return Z(()=>t.paragraphSpacing,s=>{e.value=s}),(s,n)=>{const r=mt,o=ke,a=pt;return Le((N(),$("div",rc,[n[6]||(n[6]=T("div",{class:"font-props__title"},[T("span",{class:"font-props__title-text text-2"},"段落间距")],-1)),T("div",ic,[T("div",oc,[x(a,{modelValue:e.value,"onUpdate:modelValue":n[2]||(n[2]=l=>e.value=l),placeholder:"",size:"small",onChange:n[3]||(n[3]=l=>p(t).setElementsParagraphSpacing(l)),disabled:p(t).inputDisabled||!p(t).paragraphSpacingInputEnable},{header:P(()=>[x(o,{modelValue:e.value,"onUpdate:modelValue":n[0]||(n[0]=l=>e.value=l),disabled:p(t).inputDisabled||!p(t).paragraphSpacingInputEnable,size:"small",placeholder:"",type:"number",min:0,max:100,precision:0,onChange:n[1]||(n[1]=l=>p(t).setElementsParagraphSpacing(Number(l)))},{prepend:P(()=>n[4]||(n[4]=[z("自定义")])),append:P(()=>n[5]||(n[5]=[z("px")])),_:1},8,["modelValue","disabled"])]),default:P(()=>[(N(!0),$(ve,null,Oe(p(no),l=>(N(),fe(r,{key:l.name,label:`${l.value}px`,value:l.value},{default:P(()=>[z(ge(l.value)+"px ",1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])])],512)),[[Re,p(t).fontEnable]])}}}),lc=ce(ac,[["__scopeId","data-v-de8256f6"]]),cc={class:"font-props right-props"},dc={class:"font-props__row"},hc={class:"font-props__row-item"},uc=ie({__name:"FontLetterSpacingProps",setup(i){const t=le(),e=q(fr),s=q(!1);return Z(()=>t.fontLetterSpacing,n=>{e.value=n}),Z(()=>t.fontLetterSpacingMixin,n=>{s.value=n}),(n,r)=>{const o=mt,a=ke,l=pt;return Le((N(),$("div",cc,[r[6]||(r[6]=T("div",{class:"font-props__title"},[T("span",{class:"font-props__title-text text-2"},"字间距")],-1)),T("div",dc,[T("div",hc,[x(l,{modelValue:e.value,"onUpdate:modelValue":r[2]||(r[2]=c=>e.value=c),placeholder:`${p(t).fontLetterSpacingMixin?"混合字间距":`${e.value}px`}`,size:"small",onChange:r[3]||(r[3]=c=>p(t).setElementsFontLetterSpacing(c)),disabled:p(t).inputDisabled||!p(t).fontLetterSpacingInputEnable},{header:P(()=>[x(a,{modelValue:e.value,"onUpdate:modelValue":r[0]||(r[0]=c=>e.value=c),disabled:p(t).inputDisabled||!p(t).fontLetterSpacingInputEnable,size:"small",placeholder:`${p(t).fontLetterSpacingMixin?"混合字间距":`${e.value}px`}`,type:"number",min:1,max:100,precision:0,onChange:r[1]||(r[1]=c=>p(t).setElementsFontLetterSpacing(Number(c)))},{prepend:P(()=>r[4]||(r[4]=[z("自定义")])),append:P(()=>r[5]||(r[5]=[z("px")])),_:1},8,["modelValue","disabled","placeholder"])]),default:P(()=>[(N(!0),$(ve,null,Oe(p(so),c=>(N(),fe(o,{key:c.name,label:`${c.value}px`,value:c.value},{default:P(()=>[z(ge(c.value)+"px ",1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","disabled"])])])],512)),[[Re,p(t).fontEnable]])}}}),fc=ce(uc,[["__scopeId","data-v-7b30de25"]]),gc={class:"font-props right-props"},mc={class:"font-props__title"},pc={key:0,class:"font-props__row"},Cc={class:"font-props__row-item"},yc={key:1,class:"font-props__row"},_c={class:"font-props__row-item"},Ec=ie({__name:"FontLineHeightProps",setup(i){const t=le(),e=q(ur),s=q($s),n=q(hr),r=q(!1);return Z(()=>t.fontLineHeight,o=>{e.value=o}),Z(()=>t.fontLineHeightFactor,o=>{s.value=o}),Z(()=>t.fontLineHeightAutoFit,o=>{n.value=o}),Z(()=>t.fontLineHeightFactorInputEnable,o=>{r.value=o}),(o,a)=>{const l=Ei,c=xi,h=mt,u=ke,f=pt;return Le((N(),$("div",gc,[T("div",mc,[a[10]||(a[10]=T("span",{class:"font-props__title-text text-2"},"行高",-1)),x(c,{class:"item",effect:"dark",content:`点击${p(t).fontLineHeightAutoFit?"关闭":"开启"}按字号自动适应行高功能，当前行高${p(t).fontLineHeight}px`,placement:"top"},{default:P(()=>[x(l,{modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=m=>n.value=m),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"自适应行高","inactive-text":"自定义行高",onChange:a[1]||(a[1]=m=>p(t).setElementsFontLineHeightAutoFit(m))},null,8,["modelValue"])]),_:1},8,["content"])]),n.value?(N(),$("div",pc,[T("div",Cc,[x(f,{modelValue:s.value,"onUpdate:modelValue":a[4]||(a[4]=m=>s.value=m),size:"small",onChange:a[5]||(a[5]=m=>p(t).setElementsFontLineHeightFactor(m)),disabled:p(t).inputDisabled||!p(t).fontLineHeightFactorInputEnable},{header:P(()=>[x(u,{modelValue:s.value,"onUpdate:modelValue":a[2]||(a[2]=m=>s.value=m),disabled:p(t).inputDisabled||!p(t).fontLineHeightFactorInputEnable,size:"small",type:"number",step:.1,min:0,max:2,precision:1,onChange:a[3]||(a[3]=m=>p(t).setElementsFontLineHeightFactor(Number(m)))},{prepend:P(()=>a[11]||(a[11]=[z("自定义")])),append:P(()=>a[12]||(a[12]=[z("x字号")])),_:1},8,["modelValue","disabled"])]),default:P(()=>[(N(!0),$(ve,null,Oe(p(ro),m=>(N(),fe(h,{key:m.name,label:`${m.value}x字号`,value:m.value},{default:P(()=>[z(ge(m.value)+"x字号 ",1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])])):(N(),$("div",yc,[T("div",_c,[x(f,{modelValue:e.value,"onUpdate:modelValue":a[8]||(a[8]=m=>e.value=m),size:"small",onChange:a[9]||(a[9]=m=>p(t).setElementsFontLineHeight(m)),disabled:p(t).inputDisabled||!p(t).fontLineHeightInputEnable},{header:P(()=>[x(u,{modelValue:e.value,"onUpdate:modelValue":a[6]||(a[6]=m=>e.value=m),disabled:p(t).inputDisabled||!p(t).fontLineHeightInputEnable,size:"small",placeholder:"请输入行高",type:"number",min:p(is),max:100,precision:1,onChange:a[7]||(a[7]=m=>p(t).setElementsFontLineHeight(Number(m)))},{prepend:P(()=>a[13]||(a[13]=[z("自定义")])),append:P(()=>a[14]||(a[14]=[z("px")])),_:1},8,["modelValue","disabled","min"])]),default:P(()=>[(N(!0),$(ve,null,Oe(p(to),m=>(N(),fe(h,{key:m.name,label:`${m.value}px`,value:m.value},{default:P(()=>[z(ge(m.value)+"px ",1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])]))],512)),[[Re,p(t).fontEnable]])}}}),xc=ce(Ec,[["__scopeId","data-v-933f19cb"]]),Sc={class:"font-props right-props"},vc={class:"font-props__row"},bc={class:"font-props__row-item"},wc=ie({__name:"FontSizeProps",setup(i){const t=le(),e=q(is),s=q(!1);return Z(()=>t.fontSize,n=>{e.value=n}),Z(()=>t.fontSizeMixin,n=>{s.value=n}),(n,r)=>{const o=mt,a=ke,l=pt;return Le((N(),$("div",Sc,[r[6]||(r[6]=T("div",{class:"font-props__title"},[T("span",{class:"font-props__title-text text-2"},"字号")],-1)),T("div",vc,[T("div",bc,[x(l,{modelValue:e.value,"onUpdate:modelValue":r[2]||(r[2]=c=>e.value=c),placeholder:`${s.value?"混合字号":`${e.value}px`}`,size:"small",onChange:r[3]||(r[3]=c=>p(t).setElementsFontSize(c)),disabled:p(t).inputDisabled||!p(t).fontInputEnable},{header:P(()=>[x(a,{modelValue:e.value,"onUpdate:modelValue":r[0]||(r[0]=c=>e.value=c),disabled:p(t).inputDisabled||!p(t).fontInputEnable,size:"small",placeholder:`${s.value?"混合字号":`${e.value}px`}`,type:"number",min:1,max:100,precision:0,onChange:r[1]||(r[1]=c=>p(t).setElementsFontSize(Number(c)))},{prepend:P(()=>r[4]||(r[4]=[z("自定义")])),append:P(()=>r[5]||(r[5]=[z("px")])),_:1},8,["modelValue","disabled","placeholder"])]),default:P(()=>[(N(!0),$(ve,null,Oe(p(eo),c=>(N(),fe(o,{key:c.name,label:`${c.value}px`,value:c.value},{default:P(()=>[z(ge(c.value)+"px ",1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","disabled"])])])],512)),[[Re,p(t).fontEnable]])}}}),Tc=ce(wc,[["__scopeId","data-v-216a120d"]]),Ac={class:"font-props right-props"},Pc={class:"font-props__row color"},Oc={class:"font-props__row-item"},Lc={class:"font-props__row-item",style:{width:"106px"}},Rc=ie({__name:"FontColorProps",setup(i){const t=q(),e=le(),s=q(ar),n=q(lr),r=q(!1),o=q(!1);Z(()=>e.fontColor,l=>{s.value=l}),Z(()=>e.fontColorOpacity,l=>{n.value=l}),Z(()=>e.fontColorMixin,l=>{r.value=l}),Z(()=>e.fontColorOpacityMixin,l=>{o.value=l});const a=()=>{e.fontInputEnable&&t.value.show()};return(l,c)=>{const h=ss,u=ns,f=ke;return Le((N(),$("div",Ac,[c[6]||(c[6]=T("div",{class:"font-props__title"},[T("span",{class:"font-props__title-text text-2"},"文字颜色")],-1)),T("div",Pc,[T("div",Oc,[x(h,{modelValue:s.value,"onUpdate:modelValue":c[0]||(c[0]=m=>s.value=m),onChange:c[1]||(c[1]=m=>p(e).setElementsFontColor(m)),ref_key:"colorPickerRef",ref:t,disabled:p(e).inputDisabled||!p(e).fontInputEnable},null,8,["modelValue","disabled"]),x(u,{type:"info",onClick:a},{default:P(()=>[z(ge(`${r.value?"混合颜色":s.value}`),1)]),_:1})]),T("div",Lc,[x(f,{modelValue:n.value,"onUpdate:modelValue":c[2]||(c[2]=m=>n.value=m),placeholder:`${o.value?"混合透明度":n.value}`,type:"number",min:"0",max:"100",precision:"0",onChange:c[3]||(c[3]=m=>p(e).setElementsFontColorOpacity(Number(m))),disabled:p(e).inputDisabled||!p(e).fontInputEnable},{prepend:P(()=>c[4]||(c[4]=[z("透明")])),append:P(()=>c[5]||(c[5]=[z("%")])),_:1},8,["modelValue","placeholder","disabled"])])])],512)),[[Re,p(e).fontEnable]])}}}),kc=ce(Rc,[["__scopeId","data-v-076a83c3"]]),Ic={class:K(["font-props right-props"])},Fc={class:"font-props__row"},Bc={class:"fill-props__row-item large"},Mc=ie({__name:"FontStylerProps",setup(i){const t=le(),e=q(ir);return Z(()=>t.fontStyler,s=>{e.value=s}),(s,n)=>{const r=Ws,o=js;return Le((N(),$("div",Ic,[n[4]||(n[4]=T("div",{class:"font-props__title"},[T("span",{class:"font-props__title-text text-2"},"字体样式")],-1)),T("div",Fc,[T("div",Bc,[x(o,null,{default:P(()=>[x(r,{type:e.value===p(Be).normal?"success":"default",disabled:p(t).inputDisabled||!p(t).fontInputEnable,class:K(["iconfont","icon-verbise-A"]),onClick:n[0]||(n[0]=a=>p(t).setElementsFontStyler(p(Be).normal))},null,8,["type","disabled"]),x(r,{type:e.value===p(Be).bold?"success":"default",disabled:p(t).inputDisabled||!p(t).fontInputEnable,class:K(["iconfont","icon-verbise-bold"]),onClick:n[1]||(n[1]=a=>p(t).setElementsFontStyler(p(Be).bold))},null,8,["type","disabled"]),x(r,{type:e.value===p(Be).italic?"success":"default",disabled:p(t).inputDisabled||!p(t).fontInputEnable,class:K(["iconfont","icon-verbise-italic"]),onClick:n[2]||(n[2]=a=>p(t).setElementsFontStyler(p(Be).italic))},null,8,["type","disabled"]),x(r,{type:e.value===p(Be).boldItalic?"success":"default",disabled:p(t).inputDisabled||!p(t).fontInputEnable,class:K(["iconfont","icon-verbise-italic-bold"]),onClick:n[3]||(n[3]=a=>p(t).setElementsFontStyler(p(Be).boldItalic))},null,8,["type","disabled"])]),_:1})])])],512)),[[Re,p(t).fontEnable]])}}}),Dc=ce(Mc,[["__scopeId","data-v-d994e2b9"]]),Nc={class:"font-props right-props"},Vc={class:"font-props__row"},Hc={class:"font-props__row-item",style:{width:"212px"}},zc=ie({__name:"FontFamilyProps",setup(i){const t=le(),e=q(or),s=q(!1);return Z(()=>t.fontFamily,n=>{e.value=n}),Z(()=>t.fontFamilyMixin,n=>{s.value=n}),(n,r)=>{const o=mt,a=pt;return Le((N(),$("div",Nc,[r[2]||(r[2]=T("div",{class:"font-props__title"},[T("span",{class:"font-props__title-text"},"字体")],-1)),T("div",Vc,[T("div",Hc,[x(a,{modelValue:e.value,"onUpdate:modelValue":r[0]||(r[0]=l=>e.value=l),placeholder:`${s.value?"混合字体":e.value}`,size:"small",onChange:r[1]||(r[1]=l=>p(t).setElementsFontFamily(l)),disabled:p(t).inputDisabled||!p(t).fontInputEnable},{label:P(({label:l,value:c})=>[T("span",{style:cn({fontFamily:c})},ge(l),5)]),default:P(()=>[(N(!0),$(ve,null,Oe(p(_r),l=>(N(),fe(o,{key:l.name,label:l.name,value:l.name,style:cn({fontFamily:l.name})},null,8,["label","value","style"]))),128))]),_:1},8,["modelValue","placeholder","disabled"])])])],512)),[[Re,p(t).fontEnable]])}}}),Wc=ce(zc,[["__scopeId","data-v-f0a52686"]]),jc={class:"corners-props right-props"},Gc={class:"corners-props__row"},$c={class:"corners-props__row-item large"},Yc={class:"corners-props__row"},Xc={class:"corners-props__row"},qc=ie({__name:"CornerProps",setup(i){const t=le(),e=q(Rt.corners),s=q(0),n=q(!1);Z(()=>t.corners,o=>{e.value=o;const a=k.uniq(e.value);a.length===1?(n.value=!0,s.value=a[0]):(n.value=!1,s.value=0)});function r(o){switch(o){case 0:return"左上";case 1:return"右上";case 2:return"右下";case 3:return"左下"}}return(o,a)=>{var c;const l=ke;return Le((N(),$("div",jc,[a[6]||(a[6]=T("div",{class:"corners-props__title"},[T("span",{class:"corners-props__title-text"},"圆角")],-1)),T("div",Gc,[T("div",$c,[x(l,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=h=>s.value=h),placeholder:"输入数字",disabled:p(t).inputDisabled||!p(t).cornersInputEnable||!n.value,type:"number",min:"0",max:((c=p(t).primarySelectedElement)==null?void 0:c.minParallelogramVerticalSize)/2,precision:"1",onChange:a[1]||(a[1]=h=>p(t).setElementsCorners(Number(h)))},{prepend:P(()=>a[2]||(a[2]=[z("整体")])),append:P(()=>a[3]||(a[3]=[z("px")])),_:1},8,["modelValue","disabled","max"])])]),T("div",Yc,[(N(!0),$(ve,null,Oe(e.value.slice(0,2),(h,u)=>{var f;return N(),$("div",{class:"corners-props__row-item large",key:u},[x(l,{modelValue:e.value[u],"onUpdate:modelValue":m=>e.value[u]=m,placeholder:"输入数字",disabled:p(t).inputDisabled||!p(t).cornersInputEnable,type:"number",min:"0",max:((f=p(t).primarySelectedElement)==null?void 0:f.minParallelogramVerticalSize)/2,precision:"1",onChange:m=>p(t).setElementsCorners(Number(m),u)},{prepend:P(()=>[z(ge(r(u)),1)]),append:P(()=>a[4]||(a[4]=[z("px")])),_:2},1032,["modelValue","onUpdate:modelValue","disabled","max","onChange"])])}),128))]),T("div",Xc,[(N(!0),$(ve,null,Oe(e.value.slice(2,4),(h,u)=>{var f;return N(),$("div",{class:"corners-props__row-item large",key:u},[x(l,{modelValue:e.value[u+2],"onUpdate:modelValue":m=>e.value[u+2]=m,placeholder:"输入数字",disabled:p(t).inputDisabled||!p(t).cornersInputEnable,type:"number",min:"0",max:((f=p(t).primarySelectedElement)==null?void 0:f.minParallelogramVerticalSize)/2,precision:"1",onChange:m=>p(t).setElementsCorners(Number(m),u+2)},{prepend:P(()=>[z(ge(r(u+2)),1)]),append:P(()=>a[5]||(a[5]=[z("px")])),_:2},1032,["modelValue","onUpdate:modelValue","disabled","max","onChange"])])}),128))])],512)),[[Re,p(t).cornersEnable]])}}}),Uc={class:"angle-props right-props"},Jc={class:"angle-props__title"},Kc={class:"angle-props__row"},Qc={class:"angle-props__row-item large"},Zc={class:"angle-props__row-item large"},ed=ie({__name:"AngleProps",setup(i){const t=le(),e=q(0),s=q(0);Z(()=>t.angle,o=>{e.value=d.precise(o,1)}),Z(()=>t.leanYAngle,o=>{s.value=d.precise(o,1)});function n(o){let a=Number(o);a>180&&(a=180-a),a<-180&&(a=-180-a),t.setElementsAngle(a)}function r(o){if(!t.leanYAngleInputEnable)return;let a=Number(o);a=k.clamp(a,-89,89),t.setElementsLeanYAngle(a)}return(o,a)=>{const l=De,c=ke;return N(),$("div",Uc,[T("div",Jc,[a[2]||(a[2]=T("span",{class:"angle-props__title-text"},"角度",-1)),p(t).flipX?(N(),fe(l,{key:0,class:K(["iconfont","icon-verbise-flip-horizontal"])})):Ft("",!0)]),T("div",Kc,[T("div",Qc,[x(c,{modelValue:e.value,"onUpdate:modelValue":a[0]||(a[0]=h=>e.value=h),placeholder:"输入数字",disabled:p(t).inputDisabled||!p(t).angleInputEnable,type:"number",min:"-180",max:"180",precision:"1",onChange:n},{prepend:P(()=>a[3]||(a[3]=[z("整体")])),append:P(()=>a[4]||(a[4]=[z("度")])),_:1},8,["modelValue","disabled"])]),T("div",Zc,[x(c,{modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=h=>s.value=h),placeholder:"输入数字",disabled:p(t).inputDisabled||!p(t).leanYAngleInputEnable,type:"number",min:"-89",max:"89",precision:"1",onChange:r},{prepend:P(()=>a[5]||(a[5]=[z("Y轴")])),append:P(()=>a[6]||(a[6]=[z("度")])),_:1},8,["modelValue","disabled"])])])])}}}),td={class:"size-props right-props"},sd={class:"size-props__row"},nd={class:"size-props__row-item large"},rd={class:"angle-props__row-item large"},id=ie({__name:"SizeProps",setup(i){const t=le(),e=q(0),s=q(0);return Z(()=>t.width,n=>{e.value=d.precise(n,1)}),Z(()=>t.height,n=>{s.value=d.precise(n,1)}),(n,r)=>{const o=ke,a=De;return N(),$("div",td,[r[10]||(r[10]=T("div",{class:"size-props__title"},[T("span",{class:"size-props__title-text"},"尺寸")],-1)),T("div",sd,[T("div",nd,[x(o,{modelValue:e.value,"onUpdate:modelValue":r[0]||(r[0]=l=>e.value=l),placeholder:"输入数字",disabled:p(t).inputDisabled||!p(t).widthInputEnable,min:"2",type:"number",precision:"1",onChange:r[1]||(r[1]=l=>p(t).setElementsWidth(Number(l)))},{prepend:P(()=>r[6]||(r[6]=[z("宽")])),append:P(()=>r[7]||(r[7]=[z("px")])),_:1},8,["modelValue","disabled"])]),T("div",rd,[x(o,{modelValue:s.value,"onUpdate:modelValue":r[2]||(r[2]=l=>s.value=l),placeholder:"输入数字",disabled:p(t).inputDisabled||!p(t).heightInputEnable,min:"2",type:"number",precision:"1",onChange:r[3]||(r[3]=l=>p(t).setElementsHeight(Number(l)))},{prepend:P(()=>r[8]||(r[8]=[z("高")])),append:P(()=>r[9]||(r[9]=[z("px")])),_:1},8,["modelValue","disabled"])]),p(t).ratioLockedEnable?(N(),fe(a,{key:0},{default:P(()=>[p(t).isRatioLocked?(N(),fe(p(vi),{key:1,onClick:r[5]||(r[5]=l=>p(t).setRatioLocked(!1)),title:"解除宽高比锁定"})):(N(),fe(p(Si),{key:0,onClick:r[4]||(r[4]=l=>p(t).setRatioLocked(!0)),title:"锁定宽高比"}))]),_:1})):Ft("",!0)])])}}}),od=ce(id,[["__scopeId","data-v-a796778a"]]),ad={class:"position-props right-props"},ld={class:"position-props__row"},cd={class:"angle-props__row-item large"},dd={class:"angle-props__row-item large"},hd=ie({__name:"PositionProps",setup(i){const t=le(),e=q(0),s=q(0);return Z(()=>t.position,n=>{n&&(e.value=d.precise(n.x),s.value=d.precise(n.y))}),(n,r)=>{const o=ke;return N(),$("div",ad,[r[8]||(r[8]=T("div",{class:"position-props__title"},"坐标",-1)),T("div",ld,[T("div",cd,[x(o,{modelValue:e.value,"onUpdate:modelValue":r[0]||(r[0]=a=>e.value=a),placeholder:"输入数字",disabled:p(t).inputDisabled||!p(t).positionInputEnable,type:"number",precision:"1",onChange:r[1]||(r[1]=a=>p(t).setElementsPosition({x:Number(a),y:s.value}))},{prepend:P(()=>r[4]||(r[4]=[z("横")])),append:P(()=>r[5]||(r[5]=[z("px")])),_:1},8,["modelValue","disabled"])]),T("div",dd,[x(o,{modelValue:s.value,"onUpdate:modelValue":r[2]||(r[2]=a=>s.value=a),placeholder:"输入数字",disabled:p(t).inputDisabled||!p(t).positionInputEnable,type:"number",precision:"1",onChange:r[3]||(r[3]=a=>p(t).setElementsPosition({x:e.value,y:Number(a)}))},{prepend:P(()=>r[6]||(r[6]=[z("纵")])),append:P(()=>r[7]||(r[7]=[z("px")])),_:1},8,["modelValue","disabled"])])])])}}}),ud={class:K(["align-props right-props"])},fd={class:"align-props__title"},gd={class:"align-props__row"},md=ie({__name:"AlignProps",setup(i){const t=le();return(e,s)=>{const n=De;return N(),$("div",ud,[T("div",fd,[s[0]||(s[0]=T("span",{class:"align-props__title-text"},"对齐",-1)),x(n,{title:"按住shift支持组件外轮廓对齐操作"},{default:P(()=>[x(p(bi))]),_:1})]),T("div",gd,[x(n,{class:K(["iconfont","icon-verbise-align-left",{disabled:!p(t).alignEnable}]),onClick:p(t).setElementsAlignLeft},null,8,["class","onClick"]),x(n,{class:K(["iconfont","icon-verbise-align-horizontal-center",{disabled:!p(t).alignEnable}]),onClick:p(t).setElementsAlignCenter},null,8,["class","onClick"]),x(n,{class:K(["iconfont","icon-verbise-align-right",{disabled:!p(t).alignEnable}]),onClick:p(t).setElementsAlignRight},null,8,["class","onClick"]),x(n,{class:K(["iconfont","icon-verbise-align-top",{disabled:!p(t).alignEnable}]),onClick:p(t).setElementsAlignTop},null,8,["class","onClick"]),x(n,{class:K(["iconfont","icon-verbise-align-vertical-center",{disabled:!p(t).alignEnable}]),onClick:p(t).setElementsAlignMiddle},null,8,["class","onClick"]),x(n,{class:K(["iconfont","icon-verbise-align-bottom",{disabled:!p(t).alignEnable}]),onClick:p(t).setElementsAlignBottom},null,8,["class","onClick"]),x(n,{class:K(["iconfont","icon-verbise-average-h",{disabled:!p(t).averageEnable}]),onClick:p(t).setElementsAverageHorizontal},null,8,["class","onClick"]),x(n,{class:K(["iconfont","icon-verbise-average-v",{disabled:!p(t).averageEnable}]),onClick:p(t).setElementsAverageVertical},null,8,["class","onClick"])])])}}}),pd=ce(md,[["__scopeId","data-v-f3535776"]]),Cd={class:"scale-setting"},yd={class:"scale-setting__item factor"},_d={class:"el-dropdown-link"},Ed=ie({__name:"ScaleSetting",setup(i){const t=le();return(e,s)=>{const n=De,r=Qn,o=Ti,a=Zn,l=er;return N(),$("div",Cd,[T("div",yd,[x(l,{trigger:"click","popper-class":"scale-setting__dropdown","hide-on-click":!1},{dropdown:P(()=>[x(a,null,{default:P(()=>[x(r,{onClick:p(t).setScaleAutoFit},{default:P(()=>s[0]||(s[0]=[T("span",null,"自适应缩放",-1),T("span",null,"shift + 1",-1)])),_:1},8,["onClick"]),x(r,{onClick:p(t).setScaleReduce},{default:P(()=>s[1]||(s[1]=[T("span",null,"缩小",-1),T("span",null,"ctrl + -",-1)])),_:1},8,["onClick"]),x(r,{onClick:p(t).setScaleIncrease},{default:P(()=>s[2]||(s[2]=[T("span",null,"放大",-1),T("span",null,"ctrl + +",-1)])),_:1},8,["onClick"]),x(o,null,{default:P(()=>s[3]||(s[3]=[z("预置缩放")])),_:1}),(N(!0),$(ve,null,Oe(p(Mo),c=>(N(),fe(r,{key:c,onClick:h=>p(t).setScale(c)},{default:P(()=>[T("span",null,"缩放"+ge(p(d).precise(c*100,0)+"%"),1),T("span",null,ge(c===1?"ctrl + 0":""),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:P(()=>[T("span",_d,[z(ge(p(d).precise(p(t).scale*100,0)+"%")+" ",1),x(n,{class:"el-icon--right"},{default:P(()=>[x(p(wi))]),_:1})])]),_:1})])])}}}),xd=ce(Ed,[["__scopeId","data-v-ec040534"]]),Sd={},vd={class:"props-right-panel"};function bd(i,t){const e=xd,s=pd,n=hd,r=od,o=ed,a=qc,l=Wc,c=Dc,h=kc,u=Tc,f=Ai,m=xc,C=Pi,y=fc,w=lc,L=nc,B=Kl,j=Wl,b=Bl,S=wl;return N(),$("div",vd,[x(e),x(s),x(n),x(r),x(o),x(a),x(l),x(c),x(h),x(C,{gutter:0},{default:P(()=>[x(f,{span:11},{default:P(()=>[x(u)]),_:1}),x(f,{span:13},{default:P(()=>[x(m)]),_:1})]),_:1}),x(C,{gutter:0},{default:P(()=>[x(f,{span:11},{default:P(()=>[x(y)]),_:1}),x(f,{span:13},{default:P(()=>[x(w)]),_:1})]),_:1}),x(L),x(B),x(j),x(b),x(S)])}const wd=ce(Sd,[["render",bd],["__scopeId","data-v-2faf0e8e"]]),Td={},Ad={class:"right-bar"};function Pd(i,t){const e=wd;return N(),$("div",Ad,[x(e)])}const Od=ce(Td,[["render",Pd],["__scopeId","data-v-910cfe36"]]),Ld={},Rd={class:"left-bar"};function kd(i,t){return N(),$("div",Rd)}const Id=ce(Ld,[["render",kd],["__scopeId","data-v-5cc81779"]]);function Dr(i,t){return function(){return i.apply(t,arguments)}}const{toString:Fd}=Object.prototype,{getPrototypeOf:tn}=Object,hs=(i=>t=>{const e=Fd.call(t);return i[e]||(i[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),Ve=i=>(i=i.toLowerCase(),t=>hs(t)===i),us=i=>t=>typeof t===i,{isArray:_t}=Array,It=us("undefined");function Bd(i){return i!==null&&!It(i)&&i.constructor!==null&&!It(i.constructor)&&Pe(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const Nr=Ve("ArrayBuffer");function Md(i){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(i):t=i&&i.buffer&&Nr(i.buffer),t}const Dd=us("string"),Pe=us("function"),Vr=us("number"),fs=i=>i!==null&&typeof i=="object",Nd=i=>i===!0||i===!1,Wt=i=>{if(hs(i)!=="object")return!1;const t=tn(i);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},Vd=Ve("Date"),Hd=Ve("File"),zd=Ve("Blob"),Wd=Ve("FileList"),jd=i=>fs(i)&&Pe(i.pipe),Gd=i=>{let t;return i&&(typeof FormData=="function"&&i instanceof FormData||Pe(i.append)&&((t=hs(i))==="formdata"||t==="object"&&Pe(i.toString)&&i.toString()==="[object FormData]"))},$d=Ve("URLSearchParams"),[Yd,Xd,qd,Ud]=["ReadableStream","Request","Response","Headers"].map(Ve),Jd=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Mt(i,t,{allOwnKeys:e=!1}={}){if(i===null||typeof i>"u")return;let s,n;if(typeof i!="object"&&(i=[i]),_t(i))for(s=0,n=i.length;s<n;s++)t.call(null,i[s],s,i);else{const r=e?Object.getOwnPropertyNames(i):Object.keys(i),o=r.length;let a;for(s=0;s<o;s++)a=r[s],t.call(null,i[a],a,i)}}function Hr(i,t){t=t.toLowerCase();const e=Object.keys(i);let s=e.length,n;for(;s-- >0;)if(n=e[s],t===n.toLowerCase())return n;return null}const tt=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,zr=i=>!It(i)&&i!==tt;function Ms(){const{caseless:i}=zr(this)&&this||{},t={},e=(s,n)=>{const r=i&&Hr(t,n)||n;Wt(t[r])&&Wt(s)?t[r]=Ms(t[r],s):Wt(s)?t[r]=Ms({},s):_t(s)?t[r]=s.slice():t[r]=s};for(let s=0,n=arguments.length;s<n;s++)arguments[s]&&Mt(arguments[s],e);return t}const Kd=(i,t,e,{allOwnKeys:s}={})=>(Mt(t,(n,r)=>{e&&Pe(n)?i[r]=Dr(n,e):i[r]=n},{allOwnKeys:s}),i),Qd=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),Zd=(i,t,e,s)=>{i.prototype=Object.create(t.prototype,s),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:t.prototype}),e&&Object.assign(i.prototype,e)},eh=(i,t,e,s)=>{let n,r,o;const a={};if(t=t||{},i==null)return t;do{for(n=Object.getOwnPropertyNames(i),r=n.length;r-- >0;)o=n[r],(!s||s(o,i,t))&&!a[o]&&(t[o]=i[o],a[o]=!0);i=e!==!1&&tn(i)}while(i&&(!e||e(i,t))&&i!==Object.prototype);return t},th=(i,t,e)=>{i=String(i),(e===void 0||e>i.length)&&(e=i.length),e-=t.length;const s=i.indexOf(t,e);return s!==-1&&s===e},sh=i=>{if(!i)return null;if(_t(i))return i;let t=i.length;if(!Vr(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=i[t];return e},nh=(i=>t=>i&&t instanceof i)(typeof Uint8Array<"u"&&tn(Uint8Array)),rh=(i,t)=>{const s=(i&&i[Symbol.iterator]).call(i);let n;for(;(n=s.next())&&!n.done;){const r=n.value;t.call(i,r[0],r[1])}},ih=(i,t)=>{let e;const s=[];for(;(e=i.exec(t))!==null;)s.push(e);return s},oh=Ve("HTMLFormElement"),ah=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,s,n){return s.toUpperCase()+n}),Bn=(({hasOwnProperty:i})=>(t,e)=>i.call(t,e))(Object.prototype),lh=Ve("RegExp"),Wr=(i,t)=>{const e=Object.getOwnPropertyDescriptors(i),s={};Mt(e,(n,r)=>{let o;(o=t(n,r,i))!==!1&&(s[r]=o||n)}),Object.defineProperties(i,s)},ch=i=>{Wr(i,(t,e)=>{if(Pe(i)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const s=i[e];if(Pe(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},dh=(i,t)=>{const e={},s=n=>{n.forEach(r=>{e[r]=!0})};return _t(i)?s(i):s(String(i).split(t)),e},hh=()=>{},uh=(i,t)=>i!=null&&Number.isFinite(i=+i)?i:t,ws="abcdefghijklmnopqrstuvwxyz",Mn="0123456789",jr={DIGIT:Mn,ALPHA:ws,ALPHA_DIGIT:ws+ws.toUpperCase()+Mn},fh=(i=16,t=jr.ALPHA_DIGIT)=>{let e="";const{length:s}=t;for(;i--;)e+=t[Math.random()*s|0];return e};function gh(i){return!!(i&&Pe(i.append)&&i[Symbol.toStringTag]==="FormData"&&i[Symbol.iterator])}const mh=i=>{const t=new Array(10),e=(s,n)=>{if(fs(s)){if(t.indexOf(s)>=0)return;if(!("toJSON"in s)){t[n]=s;const r=_t(s)?[]:{};return Mt(s,(o,a)=>{const l=e(o,n+1);!It(l)&&(r[a]=l)}),t[n]=void 0,r}}return s};return e(i,0)},ph=Ve("AsyncFunction"),Ch=i=>i&&(fs(i)||Pe(i))&&Pe(i.then)&&Pe(i.catch),Gr=((i,t)=>i?setImmediate:t?((e,s)=>(tt.addEventListener("message",({source:n,data:r})=>{n===tt&&r===e&&s.length&&s.shift()()},!1),n=>{s.push(n),tt.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",Pe(tt.postMessage)),yh=typeof queueMicrotask<"u"?queueMicrotask.bind(tt):typeof process<"u"&&process.nextTick||Gr,_={isArray:_t,isArrayBuffer:Nr,isBuffer:Bd,isFormData:Gd,isArrayBufferView:Md,isString:Dd,isNumber:Vr,isBoolean:Nd,isObject:fs,isPlainObject:Wt,isReadableStream:Yd,isRequest:Xd,isResponse:qd,isHeaders:Ud,isUndefined:It,isDate:Vd,isFile:Hd,isBlob:zd,isRegExp:lh,isFunction:Pe,isStream:jd,isURLSearchParams:$d,isTypedArray:nh,isFileList:Wd,forEach:Mt,merge:Ms,extend:Kd,trim:Jd,stripBOM:Qd,inherits:Zd,toFlatObject:eh,kindOf:hs,kindOfTest:Ve,endsWith:th,toArray:sh,forEachEntry:rh,matchAll:ih,isHTMLForm:oh,hasOwnProperty:Bn,hasOwnProp:Bn,reduceDescriptors:Wr,freezeMethods:ch,toObjectSet:dh,toCamelCase:ah,noop:hh,toFiniteNumber:uh,findKey:Hr,global:tt,isContextDefined:zr,ALPHABET:jr,generateString:fh,isSpecCompliantForm:gh,toJSONObject:mh,isAsyncFn:ph,isThenable:Ch,setImmediate:Gr,asap:yh};function U(i,t,e,s,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),s&&(this.request=s),n&&(this.response=n,this.status=n.status?n.status:null)}_.inherits(U,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:_.toJSONObject(this.config),code:this.code,status:this.status}}});const $r=U.prototype,Yr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{Yr[i]={value:i}});Object.defineProperties(U,Yr);Object.defineProperty($r,"isAxiosError",{value:!0});U.from=(i,t,e,s,n,r)=>{const o=Object.create($r);return _.toFlatObject(i,o,function(l){return l!==Error.prototype},a=>a!=="isAxiosError"),U.call(o,i.message,t,e,s,n),o.cause=i,o.name=i.name,r&&Object.assign(o,r),o};const _h=null;function Ds(i){return _.isPlainObject(i)||_.isArray(i)}function Xr(i){return _.endsWith(i,"[]")?i.slice(0,-2):i}function Dn(i,t,e){return i?i.concat(t).map(function(n,r){return n=Xr(n),!e&&r?"["+n+"]":n}).join(e?".":""):t}function Eh(i){return _.isArray(i)&&!i.some(Ds)}const xh=_.toFlatObject(_,{},null,function(t){return/^is[A-Z]/.test(t)});function gs(i,t,e){if(!_.isObject(i))throw new TypeError("target must be an object");t=t||new FormData,e=_.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,w){return!_.isUndefined(w[y])});const s=e.metaTokens,n=e.visitor||h,r=e.dots,o=e.indexes,l=(e.Blob||typeof Blob<"u"&&Blob)&&_.isSpecCompliantForm(t);if(!_.isFunction(n))throw new TypeError("visitor must be a function");function c(C){if(C===null)return"";if(_.isDate(C))return C.toISOString();if(!l&&_.isBlob(C))throw new U("Blob is not supported. Use a Buffer instead.");return _.isArrayBuffer(C)||_.isTypedArray(C)?l&&typeof Blob=="function"?new Blob([C]):Buffer.from(C):C}function h(C,y,w){let L=C;if(C&&!w&&typeof C=="object"){if(_.endsWith(y,"{}"))y=s?y:y.slice(0,-2),C=JSON.stringify(C);else if(_.isArray(C)&&Eh(C)||(_.isFileList(C)||_.endsWith(y,"[]"))&&(L=_.toArray(C)))return y=Xr(y),L.forEach(function(j,b){!(_.isUndefined(j)||j===null)&&t.append(o===!0?Dn([y],b,r):o===null?y:y+"[]",c(j))}),!1}return Ds(C)?!0:(t.append(Dn(w,y,r),c(C)),!1)}const u=[],f=Object.assign(xh,{defaultVisitor:h,convertValue:c,isVisitable:Ds});function m(C,y){if(!_.isUndefined(C)){if(u.indexOf(C)!==-1)throw Error("Circular reference detected in "+y.join("."));u.push(C),_.forEach(C,function(L,B){(!(_.isUndefined(L)||L===null)&&n.call(t,L,_.isString(B)?B.trim():B,y,f))===!0&&m(L,y?y.concat(B):[B])}),u.pop()}}if(!_.isObject(i))throw new TypeError("data must be an object");return m(i),t}function Nn(i){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function sn(i,t){this._pairs=[],i&&gs(i,this,t)}const qr=sn.prototype;qr.append=function(t,e){this._pairs.push([t,e])};qr.toString=function(t){const e=t?function(s){return t.call(this,s,Nn)}:Nn;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};function Sh(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ur(i,t,e){if(!t)return i;const s=e&&e.encode||Sh;_.isFunction(e)&&(e={serialize:e});const n=e&&e.serialize;let r;if(n?r=n(t,e):r=_.isURLSearchParams(t)?t.toString():new sn(t,e).toString(s),r){const o=i.indexOf("#");o!==-1&&(i=i.slice(0,o)),i+=(i.indexOf("?")===-1?"?":"&")+r}return i}class Vn{constructor(){this.handlers=[]}use(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){_.forEach(this.handlers,function(s){s!==null&&t(s)})}}const Jr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},vh=typeof URLSearchParams<"u"?URLSearchParams:sn,bh=typeof FormData<"u"?FormData:null,wh=typeof Blob<"u"?Blob:null,Th={isBrowser:!0,classes:{URLSearchParams:vh,FormData:bh,Blob:wh},protocols:["http","https","file","blob","url","data"]},nn=typeof window<"u"&&typeof document<"u",Ns=typeof navigator=="object"&&navigator||void 0,Ah=nn&&(!Ns||["ReactNative","NativeScript","NS"].indexOf(Ns.product)<0),Ph=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Oh=nn&&window.location.href||"http://localhost",Lh=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:nn,hasStandardBrowserEnv:Ah,hasStandardBrowserWebWorkerEnv:Ph,navigator:Ns,origin:Oh},Symbol.toStringTag,{value:"Module"})),pe={...Lh,...Th};function Rh(i,t){return gs(i,new pe.classes.URLSearchParams,Object.assign({visitor:function(e,s,n,r){return pe.isNode&&_.isBuffer(e)?(this.append(s,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}function kh(i){return _.matchAll(/\w+|\[(\w*)]/g,i).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Ih(i){const t={},e=Object.keys(i);let s;const n=e.length;let r;for(s=0;s<n;s++)r=e[s],t[r]=i[r];return t}function Kr(i){function t(e,s,n,r){let o=e[r++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),l=r>=e.length;return o=!o&&_.isArray(n)?n.length:o,l?(_.hasOwnProp(n,o)?n[o]=[n[o],s]:n[o]=s,!a):((!n[o]||!_.isObject(n[o]))&&(n[o]=[]),t(e,s,n[o],r)&&_.isArray(n[o])&&(n[o]=Ih(n[o])),!a)}if(_.isFormData(i)&&_.isFunction(i.entries)){const e={};return _.forEachEntry(i,(s,n)=>{t(kh(s),n,e,0)}),e}return null}function Fh(i,t,e){if(_.isString(i))try{return(t||JSON.parse)(i),_.trim(i)}catch(s){if(s.name!=="SyntaxError")throw s}return(0,JSON.stringify)(i)}const Dt={transitional:Jr,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const s=e.getContentType()||"",n=s.indexOf("application/json")>-1,r=_.isObject(t);if(r&&_.isHTMLForm(t)&&(t=new FormData(t)),_.isFormData(t))return n?JSON.stringify(Kr(t)):t;if(_.isArrayBuffer(t)||_.isBuffer(t)||_.isStream(t)||_.isFile(t)||_.isBlob(t)||_.isReadableStream(t))return t;if(_.isArrayBufferView(t))return t.buffer;if(_.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(r){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Rh(t,this.formSerializer).toString();if((a=_.isFileList(t))||s.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return gs(a?{"files[]":t}:t,l&&new l,this.formSerializer)}}return r||n?(e.setContentType("application/json",!1),Fh(t)):t}],transformResponse:[function(t){const e=this.transitional||Dt.transitional,s=e&&e.forcedJSONParsing,n=this.responseType==="json";if(_.isResponse(t)||_.isReadableStream(t))return t;if(t&&_.isString(t)&&(s&&!this.responseType||n)){const o=!(e&&e.silentJSONParsing)&&n;try{return JSON.parse(t)}catch(a){if(o)throw a.name==="SyntaxError"?U.from(a,U.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:pe.classes.FormData,Blob:pe.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};_.forEach(["delete","get","head","post","put","patch"],i=>{Dt.headers[i]={}});const Bh=_.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Mh=i=>{const t={};let e,s,n;return i&&i.split(`
`).forEach(function(o){n=o.indexOf(":"),e=o.substring(0,n).trim().toLowerCase(),s=o.substring(n+1).trim(),!(!e||t[e]&&Bh[e])&&(e==="set-cookie"?t[e]?t[e].push(s):t[e]=[s]:t[e]=t[e]?t[e]+", "+s:s)}),t},Hn=Symbol("internals");function Tt(i){return i&&String(i).trim().toLowerCase()}function jt(i){return i===!1||i==null?i:_.isArray(i)?i.map(jt):String(i)}function Dh(i){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=e.exec(i);)t[s[1]]=s[2];return t}const Nh=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function Ts(i,t,e,s,n){if(_.isFunction(s))return s.call(this,t,e);if(n&&(t=e),!!_.isString(t)){if(_.isString(s))return t.indexOf(s)!==-1;if(_.isRegExp(s))return s.test(t)}}function Vh(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,s)=>e.toUpperCase()+s)}function Hh(i,t){const e=_.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(i,s+e,{value:function(n,r,o){return this[s].call(this,t,n,r,o)},configurable:!0})})}class Se{constructor(t){t&&this.set(t)}set(t,e,s){const n=this;function r(a,l,c){const h=Tt(l);if(!h)throw new Error("header name must be a non-empty string");const u=_.findKey(n,h);(!u||n[u]===void 0||c===!0||c===void 0&&n[u]!==!1)&&(n[u||l]=jt(a))}const o=(a,l)=>_.forEach(a,(c,h)=>r(c,h,l));if(_.isPlainObject(t)||t instanceof this.constructor)o(t,e);else if(_.isString(t)&&(t=t.trim())&&!Nh(t))o(Mh(t),e);else if(_.isHeaders(t))for(const[a,l]of t.entries())r(l,a,s);else t!=null&&r(e,t,s);return this}get(t,e){if(t=Tt(t),t){const s=_.findKey(this,t);if(s){const n=this[s];if(!e)return n;if(e===!0)return Dh(n);if(_.isFunction(e))return e.call(this,n,s);if(_.isRegExp(e))return e.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=Tt(t),t){const s=_.findKey(this,t);return!!(s&&this[s]!==void 0&&(!e||Ts(this,this[s],s,e)))}return!1}delete(t,e){const s=this;let n=!1;function r(o){if(o=Tt(o),o){const a=_.findKey(s,o);a&&(!e||Ts(s,s[a],a,e))&&(delete s[a],n=!0)}}return _.isArray(t)?t.forEach(r):r(t),n}clear(t){const e=Object.keys(this);let s=e.length,n=!1;for(;s--;){const r=e[s];(!t||Ts(this,this[r],r,t,!0))&&(delete this[r],n=!0)}return n}normalize(t){const e=this,s={};return _.forEach(this,(n,r)=>{const o=_.findKey(s,r);if(o){e[o]=jt(n),delete e[r];return}const a=t?Vh(r):String(r).trim();a!==r&&delete e[r],e[a]=jt(n),s[a]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return _.forEach(this,(s,n)=>{s!=null&&s!==!1&&(e[n]=t&&_.isArray(s)?s.join(", "):s)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const s=new this(t);return e.forEach(n=>s.set(n)),s}static accessor(t){const s=(this[Hn]=this[Hn]={accessors:{}}).accessors,n=this.prototype;function r(o){const a=Tt(o);s[a]||(Hh(n,o),s[a]=!0)}return _.isArray(t)?t.forEach(r):r(t),this}}Se.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);_.reduceDescriptors(Se.prototype,({value:i},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>i,set(s){this[e]=s}}});_.freezeMethods(Se);function As(i,t){const e=this||Dt,s=t||e,n=Se.from(s.headers);let r=s.data;return _.forEach(i,function(a){r=a.call(e,r,n.normalize(),t?t.status:void 0)}),n.normalize(),r}function Qr(i){return!!(i&&i.__CANCEL__)}function Et(i,t,e){U.call(this,i??"canceled",U.ERR_CANCELED,t,e),this.name="CanceledError"}_.inherits(Et,U,{__CANCEL__:!0});function Zr(i,t,e){const s=e.config.validateStatus;!e.status||!s||s(e.status)?i(e):t(new U("Request failed with status code "+e.status,[U.ERR_BAD_REQUEST,U.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function zh(i){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return t&&t[1]||""}function Wh(i,t){i=i||10;const e=new Array(i),s=new Array(i);let n=0,r=0,o;return t=t!==void 0?t:1e3,function(l){const c=Date.now(),h=s[r];o||(o=c),e[n]=l,s[n]=c;let u=r,f=0;for(;u!==n;)f+=e[u++],u=u%i;if(n=(n+1)%i,n===r&&(r=(r+1)%i),c-o<t)return;const m=h&&c-h;return m?Math.round(f*1e3/m):void 0}}function jh(i,t){let e=0,s=1e3/t,n,r;const o=(c,h=Date.now())=>{e=h,n=null,r&&(clearTimeout(r),r=null),i.apply(null,c)};return[(...c)=>{const h=Date.now(),u=h-e;u>=s?o(c,h):(n=c,r||(r=setTimeout(()=>{r=null,o(n)},s-u)))},()=>n&&o(n)]}const es=(i,t,e=3)=>{let s=0;const n=Wh(50,250);return jh(r=>{const o=r.loaded,a=r.lengthComputable?r.total:void 0,l=o-s,c=n(l),h=o<=a;s=o;const u={loaded:o,total:a,progress:a?o/a:void 0,bytes:l,rate:c||void 0,estimated:c&&a&&h?(a-o)/c:void 0,event:r,lengthComputable:a!=null,[t?"download":"upload"]:!0};i(u)},e)},zn=(i,t)=>{const e=i!=null;return[s=>t[0]({lengthComputable:e,total:i,loaded:s}),t[1]]},Wn=i=>(...t)=>_.asap(()=>i(...t)),Gh=pe.hasStandardBrowserEnv?((i,t)=>e=>(e=new URL(e,pe.origin),i.protocol===e.protocol&&i.host===e.host&&(t||i.port===e.port)))(new URL(pe.origin),pe.navigator&&/(msie|trident)/i.test(pe.navigator.userAgent)):()=>!0,$h=pe.hasStandardBrowserEnv?{write(i,t,e,s,n,r){const o=[i+"="+encodeURIComponent(t)];_.isNumber(e)&&o.push("expires="+new Date(e).toGMTString()),_.isString(s)&&o.push("path="+s),_.isString(n)&&o.push("domain="+n),r===!0&&o.push("secure"),document.cookie=o.join("; ")},read(i){const t=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(i){this.write(i,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Yh(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function Xh(i,t){return t?i.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):i}function ei(i,t){return i&&!Yh(t)?Xh(i,t):t}const jn=i=>i instanceof Se?{...i}:i;function rt(i,t){t=t||{};const e={};function s(c,h,u,f){return _.isPlainObject(c)&&_.isPlainObject(h)?_.merge.call({caseless:f},c,h):_.isPlainObject(h)?_.merge({},h):_.isArray(h)?h.slice():h}function n(c,h,u,f){if(_.isUndefined(h)){if(!_.isUndefined(c))return s(void 0,c,u,f)}else return s(c,h,u,f)}function r(c,h){if(!_.isUndefined(h))return s(void 0,h)}function o(c,h){if(_.isUndefined(h)){if(!_.isUndefined(c))return s(void 0,c)}else return s(void 0,h)}function a(c,h,u){if(u in t)return s(c,h);if(u in i)return s(void 0,c)}const l={url:r,method:r,data:r,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(c,h,u)=>n(jn(c),jn(h),u,!0)};return _.forEach(Object.keys(Object.assign({},i,t)),function(h){const u=l[h]||n,f=u(i[h],t[h],h);_.isUndefined(f)&&u!==a||(e[h]=f)}),e}const ti=i=>{const t=rt({},i);let{data:e,withXSRFToken:s,xsrfHeaderName:n,xsrfCookieName:r,headers:o,auth:a}=t;t.headers=o=Se.from(o),t.url=Ur(ei(t.baseURL,t.url),i.params,i.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let l;if(_.isFormData(e)){if(pe.hasStandardBrowserEnv||pe.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((l=o.getContentType())!==!1){const[c,...h]=l?l.split(";").map(u=>u.trim()).filter(Boolean):[];o.setContentType([c||"multipart/form-data",...h].join("; "))}}if(pe.hasStandardBrowserEnv&&(s&&_.isFunction(s)&&(s=s(t)),s||s!==!1&&Gh(t.url))){const c=n&&r&&$h.read(r);c&&o.set(n,c)}return t},qh=typeof XMLHttpRequest<"u",Uh=qh&&function(i){return new Promise(function(e,s){const n=ti(i);let r=n.data;const o=Se.from(n.headers).normalize();let{responseType:a,onUploadProgress:l,onDownloadProgress:c}=n,h,u,f,m,C;function y(){m&&m(),C&&C(),n.cancelToken&&n.cancelToken.unsubscribe(h),n.signal&&n.signal.removeEventListener("abort",h)}let w=new XMLHttpRequest;w.open(n.method.toUpperCase(),n.url,!0),w.timeout=n.timeout;function L(){if(!w)return;const j=Se.from("getAllResponseHeaders"in w&&w.getAllResponseHeaders()),S={data:!a||a==="text"||a==="json"?w.responseText:w.response,status:w.status,statusText:w.statusText,headers:j,config:i,request:w};Zr(function(M){e(M),y()},function(M){s(M),y()},S),w=null}"onloadend"in w?w.onloadend=L:w.onreadystatechange=function(){!w||w.readyState!==4||w.status===0&&!(w.responseURL&&w.responseURL.indexOf("file:")===0)||setTimeout(L)},w.onabort=function(){w&&(s(new U("Request aborted",U.ECONNABORTED,i,w)),w=null)},w.onerror=function(){s(new U("Network Error",U.ERR_NETWORK,i,w)),w=null},w.ontimeout=function(){let b=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const S=n.transitional||Jr;n.timeoutErrorMessage&&(b=n.timeoutErrorMessage),s(new U(b,S.clarifyTimeoutError?U.ETIMEDOUT:U.ECONNABORTED,i,w)),w=null},r===void 0&&o.setContentType(null),"setRequestHeader"in w&&_.forEach(o.toJSON(),function(b,S){w.setRequestHeader(S,b)}),_.isUndefined(n.withCredentials)||(w.withCredentials=!!n.withCredentials),a&&a!=="json"&&(w.responseType=n.responseType),c&&([f,C]=es(c,!0),w.addEventListener("progress",f)),l&&w.upload&&([u,m]=es(l),w.upload.addEventListener("progress",u),w.upload.addEventListener("loadend",m)),(n.cancelToken||n.signal)&&(h=j=>{w&&(s(!j||j.type?new Et(null,i,w):j),w.abort(),w=null)},n.cancelToken&&n.cancelToken.subscribe(h),n.signal&&(n.signal.aborted?h():n.signal.addEventListener("abort",h)));const B=zh(n.url);if(B&&pe.protocols.indexOf(B)===-1){s(new U("Unsupported protocol "+B+":",U.ERR_BAD_REQUEST,i));return}w.send(r||null)})},Jh=(i,t)=>{const{length:e}=i=i?i.filter(Boolean):[];if(t||e){let s=new AbortController,n;const r=function(c){if(!n){n=!0,a();const h=c instanceof Error?c:this.reason;s.abort(h instanceof U?h:new Et(h instanceof Error?h.message:h))}};let o=t&&setTimeout(()=>{o=null,r(new U(`timeout ${t} of ms exceeded`,U.ETIMEDOUT))},t);const a=()=>{i&&(o&&clearTimeout(o),o=null,i.forEach(c=>{c.unsubscribe?c.unsubscribe(r):c.removeEventListener("abort",r)}),i=null)};i.forEach(c=>c.addEventListener("abort",r));const{signal:l}=s;return l.unsubscribe=()=>_.asap(a),l}},Kh=function*(i,t){let e=i.byteLength;if(e<t){yield i;return}let s=0,n;for(;s<e;)n=s+t,yield i.slice(s,n),s=n},Qh=async function*(i,t){for await(const e of Zh(i))yield*Kh(e,t)},Zh=async function*(i){if(i[Symbol.asyncIterator]){yield*i;return}const t=i.getReader();try{for(;;){const{done:e,value:s}=await t.read();if(e)break;yield s}}finally{await t.cancel()}},Gn=(i,t,e,s)=>{const n=Qh(i,t);let r=0,o,a=l=>{o||(o=!0,s&&s(l))};return new ReadableStream({async pull(l){try{const{done:c,value:h}=await n.next();if(c){a(),l.close();return}let u=h.byteLength;if(e){let f=r+=u;e(f)}l.enqueue(new Uint8Array(h))}catch(c){throw a(c),c}},cancel(l){return a(l),n.return()}},{highWaterMark:2})},ms=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",si=ms&&typeof ReadableStream=="function",eu=ms&&(typeof TextEncoder=="function"?(i=>t=>i.encode(t))(new TextEncoder):async i=>new Uint8Array(await new Response(i).arrayBuffer())),ni=(i,...t)=>{try{return!!i(...t)}catch{return!1}},tu=si&&ni(()=>{let i=!1;const t=new Request(pe.origin,{body:new ReadableStream,method:"POST",get duplex(){return i=!0,"half"}}).headers.has("Content-Type");return i&&!t}),$n=64*1024,Vs=si&&ni(()=>_.isReadableStream(new Response("").body)),ts={stream:Vs&&(i=>i.body)};ms&&(i=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!ts[t]&&(ts[t]=_.isFunction(i[t])?e=>e[t]():(e,s)=>{throw new U(`Response type '${t}' is not supported`,U.ERR_NOT_SUPPORT,s)})})})(new Response);const su=async i=>{if(i==null)return 0;if(_.isBlob(i))return i.size;if(_.isSpecCompliantForm(i))return(await new Request(pe.origin,{method:"POST",body:i}).arrayBuffer()).byteLength;if(_.isArrayBufferView(i)||_.isArrayBuffer(i))return i.byteLength;if(_.isURLSearchParams(i)&&(i=i+""),_.isString(i))return(await eu(i)).byteLength},nu=async(i,t)=>{const e=_.toFiniteNumber(i.getContentLength());return e??su(t)},ru=ms&&(async i=>{let{url:t,method:e,data:s,signal:n,cancelToken:r,timeout:o,onDownloadProgress:a,onUploadProgress:l,responseType:c,headers:h,withCredentials:u="same-origin",fetchOptions:f}=ti(i);c=c?(c+"").toLowerCase():"text";let m=Jh([n,r&&r.toAbortSignal()],o),C;const y=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let w;try{if(l&&tu&&e!=="get"&&e!=="head"&&(w=await nu(h,s))!==0){let S=new Request(t,{method:"POST",body:s,duplex:"half"}),A;if(_.isFormData(s)&&(A=S.headers.get("content-type"))&&h.setContentType(A),S.body){const[M,D]=zn(w,es(Wn(l)));s=Gn(S.body,$n,M,D)}}_.isString(u)||(u=u?"include":"omit");const L="credentials"in Request.prototype;C=new Request(t,{...f,signal:m,method:e.toUpperCase(),headers:h.normalize().toJSON(),body:s,duplex:"half",credentials:L?u:void 0});let B=await fetch(C);const j=Vs&&(c==="stream"||c==="response");if(Vs&&(a||j&&y)){const S={};["status","statusText","headers"].forEach(J=>{S[J]=B[J]});const A=_.toFiniteNumber(B.headers.get("content-length")),[M,D]=a&&zn(A,es(Wn(a),!0))||[];B=new Response(Gn(B.body,$n,M,()=>{D&&D(),y&&y()}),S)}c=c||"text";let b=await ts[_.findKey(ts,c)||"text"](B,i);return!j&&y&&y(),await new Promise((S,A)=>{Zr(S,A,{data:b,headers:Se.from(B.headers),status:B.status,statusText:B.statusText,config:i,request:C})})}catch(L){throw y&&y(),L&&L.name==="TypeError"&&/fetch/i.test(L.message)?Object.assign(new U("Network Error",U.ERR_NETWORK,i,C),{cause:L.cause||L}):U.from(L,L&&L.code,i,C)}}),Hs={http:_h,xhr:Uh,fetch:ru};_.forEach(Hs,(i,t)=>{if(i){try{Object.defineProperty(i,"name",{value:t})}catch{}Object.defineProperty(i,"adapterName",{value:t})}});const Yn=i=>`- ${i}`,iu=i=>_.isFunction(i)||i===null||i===!1,ri={getAdapter:i=>{i=_.isArray(i)?i:[i];const{length:t}=i;let e,s;const n={};for(let r=0;r<t;r++){e=i[r];let o;if(s=e,!iu(e)&&(s=Hs[(o=String(e)).toLowerCase()],s===void 0))throw new U(`Unknown adapter '${o}'`);if(s)break;n[o||"#"+r]=s}if(!s){const r=Object.entries(n).map(([a,l])=>`adapter ${a} `+(l===!1?"is not supported by the environment":"is not available in the build"));let o=t?r.length>1?`since :
`+r.map(Yn).join(`
`):" "+Yn(r[0]):"as no adapter specified";throw new U("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return s},adapters:Hs};function Ps(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new Et(null,i)}function Xn(i){return Ps(i),i.headers=Se.from(i.headers),i.data=As.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),ri.getAdapter(i.adapter||Dt.adapter)(i).then(function(s){return Ps(i),s.data=As.call(i,i.transformResponse,s),s.headers=Se.from(s.headers),s},function(s){return Qr(s)||(Ps(i),s&&s.response&&(s.response.data=As.call(i,i.transformResponse,s.response),s.response.headers=Se.from(s.response.headers))),Promise.reject(s)})}const ii="1.7.9",ps={};["object","boolean","number","function","string","symbol"].forEach((i,t)=>{ps[i]=function(s){return typeof s===i||"a"+(t<1?"n ":" ")+i}});const qn={};ps.transitional=function(t,e,s){function n(r,o){return"[Axios v"+ii+"] Transitional option '"+r+"'"+o+(s?". "+s:"")}return(r,o,a)=>{if(t===!1)throw new U(n(o," has been removed"+(e?" in "+e:"")),U.ERR_DEPRECATED);return e&&!qn[o]&&(qn[o]=!0,console.warn(n(o," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(r,o,a):!0}};ps.spelling=function(t){return(e,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function ou(i,t,e){if(typeof i!="object")throw new U("options must be an object",U.ERR_BAD_OPTION_VALUE);const s=Object.keys(i);let n=s.length;for(;n-- >0;){const r=s[n],o=t[r];if(o){const a=i[r],l=a===void 0||o(a,r,i);if(l!==!0)throw new U("option "+r+" must be "+l,U.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new U("Unknown option "+r,U.ERR_BAD_OPTION)}}const Gt={assertOptions:ou,validators:ps},ze=Gt.validators;class st{constructor(t){this.defaults=t,this.interceptors={request:new Vn,response:new Vn}}async request(t,e){try{return await this._request(t,e)}catch(s){if(s instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const r=n.stack?n.stack.replace(/^.+\n/,""):"";try{s.stack?r&&!String(s.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+r):s.stack=r}catch{}}throw s}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=rt(this.defaults,e);const{transitional:s,paramsSerializer:n,headers:r}=e;s!==void 0&&Gt.assertOptions(s,{silentJSONParsing:ze.transitional(ze.boolean),forcedJSONParsing:ze.transitional(ze.boolean),clarifyTimeoutError:ze.transitional(ze.boolean)},!1),n!=null&&(_.isFunction(n)?e.paramsSerializer={serialize:n}:Gt.assertOptions(n,{encode:ze.function,serialize:ze.function},!0)),Gt.assertOptions(e,{baseUrl:ze.spelling("baseURL"),withXsrfToken:ze.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let o=r&&_.merge(r.common,r[e.method]);r&&_.forEach(["delete","get","head","post","put","patch","common"],C=>{delete r[C]}),e.headers=Se.concat(o,r);const a=[];let l=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(e)===!1||(l=l&&y.synchronous,a.unshift(y.fulfilled,y.rejected))});const c=[];this.interceptors.response.forEach(function(y){c.push(y.fulfilled,y.rejected)});let h,u=0,f;if(!l){const C=[Xn.bind(this),void 0];for(C.unshift.apply(C,a),C.push.apply(C,c),f=C.length,h=Promise.resolve(e);u<f;)h=h.then(C[u++],C[u++]);return h}f=a.length;let m=e;for(u=0;u<f;){const C=a[u++],y=a[u++];try{m=C(m)}catch(w){y.call(this,w);break}}try{h=Xn.call(this,m)}catch(C){return Promise.reject(C)}for(u=0,f=c.length;u<f;)h=h.then(c[u++],c[u++]);return h}getUri(t){t=rt(this.defaults,t);const e=ei(t.baseURL,t.url);return Ur(e,t.params,t.paramsSerializer)}}_.forEach(["delete","get","head","options"],function(t){st.prototype[t]=function(e,s){return this.request(rt(s||{},{method:t,url:e,data:(s||{}).data}))}});_.forEach(["post","put","patch"],function(t){function e(s){return function(r,o,a){return this.request(rt(a||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:r,data:o}))}}st.prototype[t]=e(),st.prototype[t+"Form"]=e(!0)});class rn{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(r){e=r});const s=this;this.promise.then(n=>{if(!s._listeners)return;let r=s._listeners.length;for(;r-- >0;)s._listeners[r](n);s._listeners=null}),this.promise.then=n=>{let r;const o=new Promise(a=>{s.subscribe(a),r=a}).then(n);return o.cancel=function(){s.unsubscribe(r)},o},t(function(r,o,a){s.reason||(s.reason=new Et(r,o,a),e(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=s=>{t.abort(s)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new rn(function(n){t=n}),cancel:t}}}function au(i){return function(e){return i.apply(null,e)}}function lu(i){return _.isObject(i)&&i.isAxiosError===!0}const zs={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(zs).forEach(([i,t])=>{zs[t]=i});function oi(i){const t=new st(i),e=Dr(st.prototype.request,t);return _.extend(e,st.prototype,t,{allOwnKeys:!0}),_.extend(e,t,null,{allOwnKeys:!0}),e.create=function(n){return oi(rt(i,n))},e}const re=oi(Dt);re.Axios=st;re.CanceledError=Et;re.CancelToken=rn;re.isCancel=Qr;re.VERSION=ii;re.toFormData=gs;re.AxiosError=U;re.Cancel=re.CanceledError;re.all=function(t){return Promise.all(t)};re.spread=au;re.isAxiosError=lu;re.mergeConfig=rt;re.AxiosHeaders=Se;re.formToJSON=i=>Kr(_.isHTMLForm(i)?new FormData(i):i);re.getAdapter=ri.getAdapter;re.HttpStatusCode=zs;re.default=re;const cu=Kn("app",{state:()=>({name:"app",locale:"zh",version:"1.0.0",user:{},token:"",config:{},menu:{},isMobile:!1,isLandscape:!1,isFullScreen:!1,isShowSidebar:!0,isShowHeader:!0,isShowFooter:!0}),actions:{async init(){const i=await Promise.all([this.getLocale(),this.getUserInfo(),this.getVersion(),this.getConfig()]),[t,e,s,n]=i;this.locale=t.data,this.user=e.data,this.version=s.data,this.config=n.data},async getLocale(){return"zh"},async getUserInfo(){return await re.get("/api/user")},async getVersion(){return await re.get("/api/version")},async getConfig(){return await re.get("/api/config")},async getUploadToken(){return await re.get("/api/upload/token")},async getUploadUrl(){return await re.get("/api/upload/url")},async getUploadFileInfo(i){return await re.get("/api/upload/file",i)},async getUploadFileList(i){return await re.get("/api/upload/list",i)}}}),du={class:"left"},hu={class:"right"},uu={class:"stage"},fu=ie({__name:"App",setup(i){const{locale:t}=fi(),e=cu(),{init:s,locale:n}=e;return s().then(()=>{t.value=n}),(r,o)=>{const a=Id,l=Od,c=xl;return N(),$(ve,null,[T("div",du,[x(a)]),T("div",hu,[x(l)]),T("div",uu,[x(c)])],64)}}}),gu=ce(fu,[["__scopeId","data-v-14305c40"]]),mu="modulepreload",pu=function(i,t){return new URL(i,t).href},Un={},Jn=function(t,e,s){let n=Promise.resolve();if(e&&e.length>0){const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(e.map(c=>{if(c=pu(c,s),c in Un)return;Un[c]=!0;const h=c.endsWith(".css"),u=h?'[rel="stylesheet"]':"";if(!!s)for(let C=o.length-1;C>=0;C--){const y=o[C];if(y.href===c&&(!h||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${u}`))return;const m=document.createElement("link");if(m.rel=h?"stylesheet":mu,h||(m.as="script"),m.crossOrigin="",m.href=c,l&&m.setAttribute("nonce",l),document.head.appendChild(m),h)return new Promise((C,y)=>{m.addEventListener("load",C),m.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return n.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return t().catch(r)})},ai=gi({legacy:!1,locale:"zh",messages:{}});async function Cu(){const i=Object.assign({"/src/locales/en.json":()=>Jn(()=>import("./en-BIHI7g3E.js"),[],import.meta.url),"/src/locales/zh.json":()=>Jn(()=>import("./zh-DkCPf_Nl.js"),[],import.meta.url)});for(const t in i){const e=t.match(/\/([A-Za-z0-9-_]+)\.json$/)[1];i[t]().then(s=>{ai.global.setLocaleMessage(e,s.default)})}}Cu();class on{static async loadFont(t,e){e=e.replace("@",".");const s=new FontFace(t,`url(${e})`);await s.load(),document.fonts.add(s)}static async batchLoadFonts(t){await Promise.all(t.map(e=>on.loadFont(e.name,e.url)))}}on.batchLoadFonts(_r);const Cs=mi(gu),yu=pi();Cs.use(Oi,{size:"small"});Cs.use(yu);Cs.use(ai);Cs.mount("#app");
