var tn=Object.defineProperty;var sn=(i,t,e)=>t in i?tn(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var g=(i,t,e)=>sn(i,typeof t!="symbol"?t+"":t,e);import{x as ae,y as V,z as Y,A as B,O as Fe,P as k,C as K,L as Ye,aw as ar,ab as G,r as ne,G as pe,H as W,Q as We,a4 as qe,u as x,c as tt,I as Pt,J as Rt,k as rn,f as Re,M as Z,ax as nn,ay as on,at as an,az as ln}from"./vue-lfwZ6J9M.js";import{E as _e,g as cn,a as hn,b as lr,d as cr,e as hr,f as dn,p as dr,m as ur,h as gr,i as fr,j as Ue,k as un,l as gn,u as fn,n as mn,w as pn,o as Cn,q as yn,r as En}from"./element-D83ZfnbP.js";import{r as _n}from"./lodash-7Fc9gIMR.js";import{m as wn,o as J,r as Pe,a as Ve,c as vn}from"./mobx-aks1-jRs.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();const xn={class:"creator-menu__item"},Sn={class:"text"},bn={class:"icon"},An={key:0,class:"shortcut"},Pn=ae({__name:"CreatorDropDownItem",props:{creator:{}},setup(i){return(t,e)=>{const s=_e;return V(),Y("div",xn,[B("div",Sn,Fe(t.creator.name),1),B("div",bn,[k(s,{class:K(["iconfont",t.creator.icon])},null,8,["class"])]),t.creator.shortcut?(V(),Y("div",An,Fe(t.creator.shortcut),1)):Ye("",!0)])}}});class Rn{constructor(){g(this,"el")}async init(t){this.el=t}}const Ps=2,Rs=2,Tn=4,kn=4,On=4,Ts=8,mr=32;var le=(i=>(i[i.path=0]="path",i[i.transformer=1]="transformer",i[i.cursor=2]="cursor",i[i.cursorPosition=3]="cursorPosition",i[i.selection=4]="selection",i[i.rotate=5]="rotate",i[i.indicator=6]="indicator",i[i.range=7]="range",i))(le||{}),Q=(i=>(i[i.initialed=-1]="initialed",i[i.startCreating=0]="startCreating",i[i.creating=1]="creating",i[i.finished=2]="finished",i[i.editing=3]="editing",i))(Q||{}),T=(i=>(i.elementCreated="elementCreated",i.selectedChanged="selectedChanged",i.targetChanged="targetChanged",i.positionChanged="positionChanged",i.widthChanged="widthChanged",i.heightChanged="heightChanged",i.angleChanged="angleChanged",i.cornersChanged="cornersChanged",i.flipXChanged="flipXChanged",i.leanYAngleChanged="leanYAngleChanged",i.scaleChanged="scaleChanged",i.strokesChanged="strokesChanged",i.fillsChanged="fillsChanged",i.fontSizeChanged="fontSizeChanged",i.fontFamilyChanged="fontFamilyChanged",i.fontLineHeightChanged="fontLineHeightChanged",i.fontColorChanged="fontColorChanged",i.fontColorOpacityChanged="fontColorOpacityChanged",i.textAlignChanged="textAlignChanged",i.textBaselineChanged="textBaselineChanged",i.creatorChanged="creatorChanged",i.ratioLockedChanged="ratioLockedChanged",i.multiSelectedChanged="multiSelectedChanged",i.primarySelectedChanged="primarySelectedChanged",i.layerShiftMoveEnableChanged="layerShiftMoveEnableChanged",i.layerGoDownEnableChanged="layerGoDownEnableChanged",i))(T||{});class ks{constructor(t){g(this,"prev",null);g(this,"next",null);g(this,"value");this.value=t}get isHead(){return this.prev===null}get isTail(){return this.next===null}get isEmpty(){return this.value===null}insertAfter(t){const e=this.next;this.next=t,t.prev=this,t.next=e,e&&(e.prev=t)}insertBefore(t){const e=this.prev;this.prev=t,t.next=this,t.prev=e,e&&(e.next=t)}}const Ln="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let je=(i=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(i|=0));for(;i--;)t+=Ln[e[i]&63];return t};const nt=new Worker(new URL(""+new URL("MathWorker-CmujXtXM.js",import.meta.url).href,import.meta.url),{type:"module"}),Ge=new Map;nt.onmessage=i=>{const{id:t,result:e}=i.data;let s=Ge.get(t);s&&s(e),Ge.delete(t),s=null};class c{static multiply(t,e){const s=t.length,r=t[0].length;if(Array.isArray(e[0])){const n=e.length,o=e[0].length;if(r!==n)throw new Error("矩阵 A 的列数必须等于矩阵 B 的行数");const a=new Array(s);for(let l=0;l<s;l++)a[l]=new Array(o).fill(0);for(let l=0;l<s;l++)for(let h=0;h<o;h++)for(let d=0;d<r;d++)a[l][h]+=t[l][d]*e[d][h];return a}else{if(r!==e.length)throw new Error("矩阵 A 的列数必须等于向量的长度");const n=new Array(s).fill(0);for(let o=0;o<s;o++)for(let a=0;a<r;a++)n[o]+=t[o][a]*e[a];return n}}static calcTranslateMatrix(t,e){return[[1,0,t],[0,1,e],[0,0,1]]}static translate(t,e){return!e||e.x===0&&e.y===0?t:{x:t.x+e.x,y:t.y+e.y}}static batchTranslate(t,e){return t.map(s=>this.translate(s,e))}static asyncTranslate(t,e){return new Promise(s=>{const r=`${Date.now()}_${je(4)}`;nt.postMessage({funcName:"translate",args:[t,e],id:r}),Ge.set(r,n=>{s(n)})})}static asyncBatchTranslate(t,e){return new Promise(s=>{const r=`${Date.now()}_${je(4)}`;nt.postMessage({funcName:"batchTranslate",args:[t,e],id:r}),Ge.set(r,n=>{s(n)})})}static asyncNamedBatchTranslate(t,e){return new Promise(s=>{const r=`${Date.now()}_${je(4)}`;nt.postMessage({funcName:"namedBatchTranslate",args:[t,e],id:r}),Ge.set(r,n=>{s(n)})})}static asyncMapNamedBatchTranslate(t,e){return new Promise(s=>{const r=`${Date.now()}_${je(4)}`;nt.postMessage({funcName:"mapNamedBatchTranslate",args:[t,e],id:r}),Ge.set(r,n=>{s(n)})})}static rotate(t,e){if(e===0)return t;const s=c.calcRotateMatrix(e),r=c.multiply(s,[t.x,t.y,1]);return{x:r[0],y:r[1]}}static batchRotate(t,e){return t.map(s=>this.rotate(s,e))}static calcScaleMatrix(t,e){return[[t,0,0],[0,e,0],[0,0,1]]}static calcTransformMatrix(t,e,s,r={}){e=c.transWithCenter(e,r,t,!0),s=c.transWithCenter(s,r,t,!0);const n=s.x-t.x,o=s.y-t.y,a=e.x-t.x,l=e.y-t.y,h=n===0?1:a/n,d=o===0?1:l/o;return c.calcScaleMatrix(h,d)}static rotateWithCenter(t,e,s){if(e===0||!s)return t;t={x:t.x-s.x,y:t.y-s.y};const r=c.rotate(t,e);return{x:r.x+s.x,y:r.y+s.y}}static batchRotateWithCenter(t,e,s){return t.map(r=>c.rotateWithCenter(r,e,s))}static leanYWithCenter(t,e,s){return c.leanWithCenter(t,0,e,s)}static batchLeanYWithCenter(t,e,s){return t.map(r=>c.leanYWithCenter(r,e,s))}static leanXWithCenter(t,e,s){return c.leanWithCenter(t,e,0,s)}static batchLeanXWithCenter(t,e,s){return t.map(r=>c.leanXWithCenter(r,e,s))}static calcLeanMatrix(t,e){t=t||0,e=e||0;const s=Math.tan(c.angleToRadian(t));return[[1,-Math.tan(c.angleToRadian(e)),0],[s,1,0],[0,0,1]]}static calcRotateMatrix(t){t=t||0;const e=c.angleToRadian(t);return[[Math.cos(e),-Math.sin(e),0],[Math.sin(e),Math.cos(e),0],[0,0,1]]}static leanWithCenter(t,e,s,r){if(e===0&&s===0)return t;const n=c.calcLeanMatrix(e,s),o=c.multiply(n,[t.x-r.x,t.y-r.y,1]);return{x:o[0]+r.x,y:o[1]+r.y}}static batchLeanWithCenter(t,e,s,r){return t.map(n=>c.leanWithCenter(n,e,s,r))}static transWithCenter(t,e,s,r){let{angle:n=0,leanXAngle:o=0,leanYAngle:a=0}=e||{};if(n===0&&o===0&&a===0)return t;r&&(n=-n,o=-o,a=-a);let l;const h=c.calcLeanMatrix(o,a),d=c.calcRotateMatrix(n);r?l=c.multiply(h,d):l=c.multiply(d,h);let u=c.multiply(l,[t.x-s.x,t.y-s.y,1]);return{x:u[0]+s.x,y:u[1]+s.y}}static batchTransWithCenter(t,e,s,r){return t.map(n=>c.transWithCenter(n,e,s,r))}static rotateAndTranslate(t,e,s){return c.translate(c.rotate(t,e),s)}static translateArcPoint(t,e){let{start:s,controller:r,end:n,corner:o,value:a}=t;return[s,r,n,o]=c.batchTranslate([s,r,n,o],e),{start:s,controller:r,end:n,corner:o,value:a}}static translateArcPoints(t,e){return t.map(s=>c.translateArcPoint(s,e))}static batchTranslateArcPoints(t,e){return t.map((s,r)=>c.translateArcPoints(s,e))}static calcSymmetryPoint(t,e,s){const r=s.x-e.x,n=s.y-e.y,o=r*r+n*n;if(o===0)return{...t};const a=t.x-e.x,l=t.y-e.y,d=(a*r+l*n)/o,u=e.x+d*r,f=e.y+d*n,p=2*u-t.x,m=2*f-t.y;return{x:p,y:m}}static batchCalcSymmetryPoints(t,e,s){return t.map(r=>c.calcSymmetryPoint(r,e,s))}static scale(t,e){if(e.sx===1&&e.sy===1)return t;const s=c.calcScaleMatrix(e.sx,e.sy),r=c.multiply(s,[t.x,t.y,1]);return{x:r[0],y:r[1]}}static scales(t,e){return t.map(s=>c.scale(s,e))}static scaleWithCenter(t,e,s){return e.sx===1&&e.sy===1?t:(t={x:t.x-s.x,y:t.y-s.y},t=c.scale(t,e),{x:t.x+s.x,y:t.y+s.y})}static batchScaleWithCenter(t,e,s){return t.map(r=>c.scaleWithCenter(r,e,s))}static angleToRadian(t){return t*(Math.PI/180)}static radianToAngle(t){return t*(180/Math.PI)}static isPointInPolygonByRayCasting(t,e){const s=[t.x,t.y],r=e.map(l=>[l.x,l.y]),[n,o]=s;let a=!1;for(let l=0,h=r.length-1;l<r.length;h=l++){const[d,u]=r[l],[f,p]=r[h];if(u>o!=p>o&&n<(f-d)*(o-u)/(p-u)+d&&(a=!a),u===o&&o===p&&n>=Math.min(d,f)&&n<=Math.max(d,f)&&o>=Math.min(u,p)&&o<=Math.max(u,p))return!0}return a}static isPolygonsOverlap(t,e){const s=t.map(f=>[f.x,f.y]),r=e.map(f=>[f.x,f.y]);function n(f){let p=[];for(let m=0;m<f.length;m++){let y=(m+1)%f.length,w=[f[y][0]-f[m][0],f[y][1]-f[m][1]];p.push(w)}return p}function o(f,p){return f[0]*p[0]+f[1]*p[1]}function a(f){return[-f[1],f[0]]}function l(f,p){let m=o(f,p[0]),y=m;for(let w=1;w<p.length;w++){let D=o(f,p[w]);m=Math.min(m,D),y=Math.max(y,D)}return[m,y]}function h(f,p){return f[0]<=p[1]&&p[0]<=f[1]}let d=n(s),u=n(r);for(let f of d.concat(u)){let p=a(f),m=l(p,s),y=l(p,r);if(!h(m,y))return!1}return!0}static calcPolygonCentroid(t){if(!t||t.length===0)throw new Error("顶点数组不能为空");let e=0,s=0;const r=t.length;for(let n=0;n<r;n++)e+=t[n].x,s+=t[n].y;return e/=r,s/=r,{x:e,y:s}}static calcCenter(t){const e=v.getBoxPoints(t);return c.calcPolygonCentroid(e)}static calcTargetPoint(t,e,s){const r=c.angleToRadian(s),n=t.x+e*Math.cos(r),o=t.y+e*Math.sin(r);return{x:n,y:o}}static calcAngle(t,e){const s=e.x-t.x,r=e.y-t.y;return Math.atan2(r,s)*(180/Math.PI)}static calcInternalAngle(t){return 180-c.calcTriangleAngle(t[0],t[3],t[2])}static calcLeanYAngle(t,e){return e?t-90:90-t}static calcLeanYAngleByPoints(t,e){return c.calcLeanYAngle(c.calcInternalAngle(t),e)}static calcUnLeanByPoints(t,e,s){if(e===0&&s===0)return t;const r=c.calcCenter(t);return c.batchLeanWithCenter(t,-e,-s,r)}static calcFlipXByPoints(t){const e=c.calcCenter(t);return c.isPointClockwiseOfLine(e,t[0],t[3])}static calcViewAngleByPoints(t){const e=c.calcAngle(t[2],t[1]);return c.mirrorAngle(e+90)}static calcActualAngleByPoints(t){const e=c.calcInternalAngle(t),s=c.calcLeanYAngle(e,c.calcFlipXByPoints(t)),r=c.calcViewAngleByPoints(t);return c.mirrorAngle(r-s)}static mirrorAngle(t){for(;t>180;)t-=360;for(;t<-180;)t+=360;return t}static normalizeAngle(t){return t<0&&(t=t+360),t}static calcSegmentLineCenterCrossPoint(t,e,s,r){const n=c.calcCenter([t,e]),o=c.calcAngle(t,e);return c.calcTargetPoint(n,r,s?o+90:o-90)}static calcProjectionOnSegment(t,e,s){const r=c.calcSegmentProportion(t,e,s),n=e.x+r*(s.x-e.x),o=e.y+r*(s.y-e.y);return{x:n,y:o}}static calcDistancePointToLine(t,e,s){const{x:r,y:n}=c.calcProjectionOnSegment(t,e,s);return Math.sqrt((t.x-r)*(t.x-r)+(t.y-n)*(t.y-n))}static calcSegmentProportion(t,e,s){const r=s.x-e.x,n=s.y-e.y,o=t.x-e.x,a=t.y-e.y,l=r*r+n*n;return(o*r+a*n)/l}static isProjectionOnSegment(t,e,s){const r=c.calcSegmentProportion(t,e,s);return r>=0&&r<=1}static calcLimitPointOnSegment(t,e,s){const r=c.calcSegmentProportion(t,e,s);if(r<0)return e;if(r>1)return s}static calcInnerLimitPointOnSegment(t,e,s,r){const n=c.calcSegmentProportion(t,e,s);if(n<0){const o=c.calcAngle(e,s);return c.calcTargetPoint(e,r,o)}else if(n>1){const o=c.calcAngle(s,e);return c.calcTargetPoint(s,r,o)}return t}static isPointClosestSegment(t,e,s,r){return c.isProjectionOnSegment(t,e,s)?c.calcDistancePointToLine(t,e,s)<r:!1}static isPointClosest(t,e,s){return c.calcDistance(t,e)<=s}static isPointClosestWhichPoint(t,e,s){for(let r=0;r<e.length;r++)if(c.isPointClosest(t,e[r],s))return r}static transformToAcuteAngle(t){return t>90&&(t=180-t),t}static calcDistance(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static isRectangle(t){if(t.length!==4)return!1;const e=[c.calcDistance(t[0],t[1]),c.calcDistance(t[1],t[2]),c.calcDistance(t[2],t[3]),c.calcDistance(t[3],t[0])];return new Set(e).size===2}static isSameSign(t,e){return t*e>=0}static precise(t,e=2){if(typeof t!="number"||typeof e!="number")throw new TypeError("Both arguments must be numbers");if(!isFinite(t))return t;const s=Math.pow(10,e),o=(Math.round(t*s)/s).toString().split(".");for(o.length===1&&o.push("");o[1].length<e;)o[1]+="0";return Number(o.join("."))}static batchPrecise(t,e){return t.map(s=>c.precise(s,e))}static precisePoint(t,e){return{x:c.precise(t.x,e),y:c.precise(t.y,e)}}static batchPrecisePoint(t,e){return t.map(s=>c.precisePoint(s,e))}static calcTriangleAngle(t,e,s){let r={x:e.x-t.x,y:e.y-t.y},n={x:s.x-e.x,y:s.y-e.y},o=r.x*n.x+r.y*n.y,a=Math.sqrt(r.x*r.x+r.y*r.y),l=Math.sqrt(n.x*n.x+n.y*n.y),h=o/(a*l),u=Math.acos(h)*(180/Math.PI);return isNaN(u)&&(u=0),u}static calcTriangleAngleWithClockwise(t,e,s){const r=c.calcTriangleAngle(t,e,s);return c.isPointClockwiseOfLine(e,t,s)?r:180-r}static calcTriangleAngle2(t,e,s){return Math.acos((Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))/(Math.pow(s.x-t.x,2)+Math.pow(s.y-t.y,2)))*(180/Math.PI)}static calcTriangleAngle3(t,e,s){return Math.acos((Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2))/(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)))*(180/Math.PI)}static calcVectorC(t,e){const s=t.x+e.x,r=t.y+e.y;return{x:s,y:r}}static calcVector(t,e){const s=e.x-t.x,r=e.y-t.y;return{x:s,y:r}}static translateVector(t,e){const s=t.x-e.x,r=t.y-e.y;return{x:s,y:r}}static calcTriangleSide1By2(t,e){const s=t*c.angleToRadian(t);return e/Math.tan(s)}static calcTriangleSide3By1(t,e){const s=t*c.angleToRadian(t);return e/Math.cos(s)}static calcTriangleSide3By2(t,e){const s=c.angleToRadian(t);return e/Math.sin(s)}static calcTriangleSide1By3(t,e){const s=c.angleToRadian(t);return e*Math.cos(s)}static calcTriangleSide2By3(t,e){const s=c.angleToRadian(t);return e*Math.sin(s)}static sortPointsClockwise(t){let e=c.calcCenter(t);return c.sortPointsClockwiseByCenter(t,e)}static sortPointsClockwiseByCenter(t,e){let s=t.map((n,o)=>{let a=Math.atan2(n.y-e.y,n.x-e.x);return{index:o,angle:a}});s.sort((n,o)=>n.angle-o.angle);let r=[];for(let n=0;n<s.length;n++)r.push(t[s[n].index]);return r}static calcPointToSegmentCenterAngle(t,e,s){const r=c.calcCenter([e,s]);return c.calcAngle(t,r)}static resignValue(t,e){return t>=0?Math.abs(e):-Math.abs(e)}static isPointClockwiseOfLine(t,e,s){return(t.x-e.x)*(s.y-e.y)-(t.y-e.y)*(s.x-e.x)<0}static getScaleFromMatrix(t){return{scaleX:t[0][0],scaleY:t[1][1]}}static calculateAngleBisectorIntersection(t){if(t.length!==4)throw new Error("必须提供四个顶点坐标");const e=c.calcBisectors(t),{width:s,height:r}=c.calcParallelogramVerticalSize(t),n=[];return s<r?(n.push(c.calcIntersectionOfLines(e[0],e[1])),n.push(c.calcIntersectionOfLines(e[2],e[3]))):(n.push(c.calcIntersectionOfLines(e[0],e[3])),n.push(c.calcIntersectionOfLines(e[1],e[2]))),n}static calcIntersectionOfLines(t,e){const s=t.point,r=t.direction,n=e.point,o=e.direction,a=r.x*o.y-r.y*o.x;if(Math.abs(a)<1e-6)return null;const l=n.x-s.x,h=n.y-s.y,d=(l*o.y-h*o.x)/a;return(l*r.y-h*r.x)/a,c.precisePoint({x:s.x+d*r.x,y:s.y+d*r.y},1)}static calcBisectors(t){const[e,s,r,n]=t;return t.map((o,a)=>{let l,h;switch(a){case 0:l={x:s.x-e.x,y:s.y-e.y},h={x:n.x-e.x,y:n.y-e.y};break;case 1:l={x:e.x-s.x,y:e.y-s.y},h={x:r.x-s.x,y:r.y-s.y};break;case 2:l={x:s.x-r.x,y:s.y-r.y},h={x:n.x-r.x,y:n.y-r.y};break;case 3:l={x:r.x-n.x,y:r.y-n.y},h={x:e.x-n.x,y:e.y-n.y};break;default:throw new Error("无效的顶点索引")}const d=Math.hypot(l.x,l.y),u=Math.hypot(h.x,h.y),f={x:l.x/d,y:l.y/d},p={x:h.x/u,y:h.y/u},m={x:f.x+p.x,y:f.y+p.y};return{point:o,direction:m}})}static calcCrossPointsOfParallelLines(t,e){const[s,r,n,o]=e,a={x:r.x-s.x,y:r.y-s.y},l={x:n.x-r.x,y:n.y-r.y},h={x:o.x-n.x,y:o.y-n.y},d={x:s.x-o.x,y:s.y-o.y},u={x:s.x-r.x,y:s.y-r.y},f=c.calcIntersectionOfLines({point:s,direction:a},{point:t,direction:d}),p=c.calcIntersectionOfLines({point:r,direction:l},{point:t,direction:a}),m=c.calcIntersectionOfLines({point:n,direction:h},{point:t,direction:l}),y=c.calcIntersectionOfLines({point:o,direction:d},{point:t,direction:u});return[f,p,m,y]}static calcTriangleArea(t,e,s){const r=c.calcDistance(t,e),n=c.calcDistance(e,s),o=c.calcDistance(s,t),a=(r+n+o)/2;return Math.sqrt(a*(a-r)*(a-n)*(a-o))}static calcParallelogramVerticalIntersectionPoints(t,e,s){const[r,n,o,a]=e;let l=c.calcProjectionOnSegment(t,a,r),h=c.calcProjectionOnSegment(t,r,n),d=c.calcProjectionOnSegment(t,n,o),u=c.calcProjectionOnSegment(t,o,a);return s&&(c.isProjectionOnSegment(l,a,r)||(l=c.calcInnerLimitPointOnSegment(l,a,r,.01)),c.isProjectionOnSegment(h,r,n)||(h=c.calcInnerLimitPointOnSegment(h,r,n,.01)),c.isProjectionOnSegment(d,n,o)||(d=c.calcInnerLimitPointOnSegment(d,n,o,.01)),c.isProjectionOnSegment(u,o,a)||(u=c.calcInnerLimitPointOnSegment(u,o,a,.01))),[l,h,d,u]}static calcParallelogramVerticalSize(t){const[e,s,r,n]=t,o=c.calcDistancePointToLine(e,s,r),a=c.calcDistancePointToLine(e,r,n);return{width:o,height:a}}static calcMirrorPointToLine(t,e,s){const r=c.calcProjectionOnSegment(t,e,s),n=c.calcDistance(t,r),o=c.calcAngle(e,s);return c.calcTargetPoint(r,n*2,o)}}var R=_n();class v{static getMinX(t){return Math.min(...t.map(e=>e.x))}static getMinY(t){return Math.min(...t.map(e=>e.y))}static getBoxPoints(t){let e=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return t.forEach(o=>{e=Math.min(e,o.x),s=Math.min(s,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y)}),[{x:e,y:s},{x:r,y:s},{x:r,y:n},{x:e,y:n}]}static getRect(t){let e=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return t.forEach(o=>{e=Math.min(e,o.x),s=Math.min(s,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y)}),{x:e,y:s,width:r-e,height:n-s}}static getDateId(){return+new Date}static getRandomId(){return je(8)}static getEventPosition(t,e,s){return s=s||1,{x:(t.clientX-e.x)/s,y:(t.clientY-e.y)/s}}static getBoxVertices(t,e){return[{x:t.x-e.width/2,y:t.y-e.height/2},{x:t.x+e.width/2,y:t.y-e.height/2},{x:t.x+e.width/2,y:t.y+e.height/2},{x:t.x-e.width/2,y:t.y+e.height/2}]}static getRectVertices(t){return[{x:0,y:0},{x:t.width,y:0},{x:t.width,y:t.height},{x:0,y:t.height}]}static getLBRPoints(t,e){let[s,r,n]=v.getLBRPointIndexes(t,e);return s===r&&(s=v.getPrevIndexOfArray(t.length,s)),r===n&&(n=v.getNextIndexOfArray(t.length,n)),[t[s],t[r],t[n]]}static getLBRPointIndexes(t,e){let s,r,n;return e=e??!1,t.forEach((o,a)=>{e||((s===void 0||o.x<t[s].x)&&(s=a),(n===void 0||o.x>t[n].x)&&(n=a)),(r===void 0||o.y>t[r].y)&&(r=a)}),e&&(s=v.getPrevIndexOfArray(t.length,r),n=v.getNextIndexOfArray(t.length,r)),[s,r,n]}static get4BoxPoints(t,e,s){const r=[{x:t.x-e.width/2,y:t.y-e.height/2},{x:t.x+e.width/2,y:t.y-e.height/2},{x:t.x+e.width/2,y:t.y+e.height/2},{x:t.x-e.width/2,y:t.y+e.height/2}];return r.forEach(n=>{Object.assign(n,c.transWithCenter(n,s,t))}),r}static getPrevIndexOfArray(t,e,s=1){let r;for(;r=e-s,r<0&&(r=t+r),!(r>=0););return r}static getPrevOfArray(t,e,s=1){return t[v.getPrevIndexOfArray(t.length,e,s)]}static getNextIndexOfArray(t,e,s=1){let r;for(;r=e+s,r>=t&&(r=r-t),!(r<t););return r}static getNextOfArray(t,e,s=1){return t[v.getNextIndexOfArray(t.length,e,s)]}static calcRectangleSize(t){const e=c.precise(c.calcDistance(t[0],t[1])),s=c.precise(c.calcDistance(t[0],t[3]));return{width:e,height:s}}static calcLineSize(t){const e=c.precise(Math.abs(t[0].x-t[1].x)),s=c.precise(Math.abs(t[0].y-t[1].y));return{width:e,height:s}}static scalePoint(t,e){return{x:t.x*e,y:t.y*e}}static scalePoints(t,e){return e===1?t:t.map(s=>v.scalePoint(s,e))}static calcScale(t,e,s=0){const r=(t.width-s*2)/e.width,n=(t.height-s*2)/e.height;return Math.min(r,n)}static calcRectangleSizeInRect(t,e,s,r=0){const n=s.width-r*2,o=s.height-r*2;if(t>n||e>o){const a=c.precise(t/e,1),l=c.precise(s.width/s.height,2);a>l?(t=n,e=c.precise(t/a,1)):(e=o,t=c.precise(e*a,1))}return{width:t,height:e}}static calcCenterInnerRectPoints(t,e){const{width:s,height:r}=t,{width:n,height:o}=e;return[{x:n/2-s/2,y:o/2-r/2},{x:n/2+s/2,y:o/2-r/2},{x:n/2+s/2,y:o/2+r/2},{x:n/2-s/2,y:o/2+r/2}]}static scaleRect(t,e){const s={};return["x","y","width","height","left","top","right","bottom"].forEach(r=>{const n=t[r];R.isNumber(n)&&(s[r]=c.precise(n*e))}),s}static sortPointsByY(t){return t.sort((e,s)=>e.y-s.y)}static sortPointsByX(t){return t.sort((e,s)=>e.x-s.x)}static calcRenderRect(t,e){const s=c.calcDistance(t[0],t[1]),r=c.calcDistancePointToLine(t[0],t[2],t[3]);return{x:e.x-s/2,y:e.y-r/2,width:s,height:r}}static isPointInRect(t,e){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}}class Tt{constructor(){g(this,"id");this.id=`${v.getDateId()}`}run(){return Promise.resolve()}}class Te extends Tt{constructor(e,s){super();g(this,"element");g(this,"canvas");this.element=e,s&&(this.canvas=s.canvas)}destroy(){return this.element=null,this.canvas=null,Promise.resolve()}}var ye=(i=>(i[i.LEFT=0]="LEFT",i[i.RIGHT=1]="RIGHT",i))(ye||{}),A=(i=>(i.moveable="moveable",i.hand="hand",i.rectangle="rectangle",i.line="line",i.image="image",i.polygon="polygon",i.arbitrary="arbitrary",i.pencil="pencil",i.text="text",i.group="group",i.ellipse="ellipse",i))(A||{}),te=(i=>(i.cursor="cursor",i.shapes="shapes",i.freedom="freedom",i.text="text",i))(te||{});class H{static deepPlanObjectAssign(t,...e){return e.forEach(s=>{for(const r in s)s.hasOwnProperty(r)&&(R.isPlainObject(s[r])?(t[r]===void 0&&(t[r]={}),this.deepPlanObjectAssign(t[r],s[r])):t[r]=s[r])}),t}static isAllEqualWith(t,e,s){return t.every(r=>s(r,e))}static jsonClone(t){return R.isPlainObject(t)||R.isArray(t)?JSON.parse(JSON.stringify(t)):(console.warn("jsonClone: 非对象或数组类型",t),R.cloneDeep(t))}}var U=(i=>(i[i.inside=0]="inside",i[i.middle=1]="middle",i[i.outside=2]="outside",i))(U||{});const Os=[{type:0,name:"内描边"},{type:1,name:"平分线宽"},{type:2,name:"外描边"}],In=[{type:1,name:"平分线宽"}];function Bn(i){switch(i){case A.arbitrary:case A.rectangle:case A.ellipse:case A.image:return Os;case A.line:return In;default:return Os}}const Mn=1,Fn="#000000",Dn=1,Wn="#999999",Nn=.15,zn=1,Vn=16,jn="sans-serif",Gn="#000000",Hn=1,$n="left",Yn="top",qn=1,Xn=100,Jn=1.4,kt={type:Mn,width:zn,color:Fn,colorOpacity:Dn},Ot={color:Wn,colorOpacity:Nn},xe={fontSize:Vn,fontFamily:jn,fontColor:Gn,fontColorOpacity:Hn,fontLineHeight:Jn,textAlign:$n,textBaseline:Yn},ke={strokes:[{...kt}],fills:[{...Ot}],...xe},Ls=i=>{const t=H.jsonClone(ke);return[A.line,A.arbitrary].includes(i)&&t.strokes.forEach(e=>{e.width=qn}),[A.image,A.arbitrary,A.text].includes(i)&&t.fills.forEach(e=>{e.colorOpacity=0}),[A.text].includes(i)&&t.strokes.forEach(e=>{e.width=0}),t};class Kt{static hashToRgba(t,e){if(!/^#([0-9A-F]{3}){1,2}$/i.test(t))throw new Error("Invalid color format");let s=t.slice(1);s.length===3&&(s=s.split("").map(a=>a+a).join(""));const r=parseInt(s.substring(0,2),16),n=parseInt(s.substring(2,4),16),o=parseInt(s.substring(4,6),16);return`rgba(${r}, ${n}, ${o}, ${e})`}static getRandomColor(){const t="0123456789ABCDEF";let e="#";for(let s=0;s<6;s++)e+=t[Math.floor(Math.random()*16)];return e}}class me{static joinFillColor(t){return t.color?`${Kt.hashToRgba(t.color,t.colorOpacity)}`:""}static joinStrokeColor(t){return t.color?`${Kt.hashToRgba(t.color,t.colorOpacity)}`:""}static joinFont(t){return`${t.fontSize}px ${t.fontFamily}`}}class Ee{static calcIOPoint(t,e,s,r,n){const o=s/2,a=c.calcTriangleSide3By2(o,r);let l=c.calcAngle(t,e);l<0&&(l+=360);let h=o+l;return c.calcTargetPoint(t,a,n?h:h+180)}static getPolygonVertices(t,e,s){const r=c.sortPointsClockwise(t);return r.map((n,o)=>{const a=v.getPrevOfArray(r,o),l=v.getNextOfArray(r,o),h=c.calcTriangleAngle(a,n,l);return Ee.calcIOPoint(n,l,h,e,s)})}static getPolygonInnerVertices(t,e){return Ee.getPolygonVertices(t,e,!0)}static getPolygonOuterVertices(t,e){return Ee.getPolygonVertices(t,e,!1)}static calcBentLineOuterVertices(t,e){const s=[];return s.push(...Ee.calcBentLineClockWisePoints(t,e,!0)),s.push(...Ee.calcBentLineClockWisePoints(t.reverse(),e,!0)),s}static calcBentLineClockWisePoints(t,e,s){const r=[];for(let n=0;n<t.length-1;n++){const o=t[n],a=t[n+1];let l=c.calcAngle(o,a);s?l=l+90:l=l-90,r.push(c.calcTargetPoint(o,e,l)),n===t.length-2&&r.push(c.calcTargetPoint(a,e,l))}return r}}class Se{static getArbitraryInnerVertices(t,e,s){return Se.getArbitraryVertices(t,e,!0,s)}static getArbitraryOuterVertices(t,e,s){return Se.getArbitraryVertices(t,e,!1,s)}static getArbitraryVertices(t,e,s,r){return t.length===1?t:t.length===2?Ee.calcBentLineClockWisePoints(t,e,s):t.map((n,o)=>{const a=v.getPrevOfArray(t,o),l=v.getNextOfArray(t,o),h=c.isPointClockwiseOfLine(l,a,n);let d=c.calcTriangleAngle(a,n,l);h?d=180-d:d=180+d;const{isFold:u=!0}=r;if(!u&&[0,t.length-1].includes(o)){let f;return o===0?f=c.calcAngle(n,l)+(s?90:-90):f=c.calcAngle(n,a)+(s?-90:90),c.calcTargetPoint(n,e,f)}else return Ee.calcIOPoint(n,l,d,e,s)})}}class hs{static measureText(t,e){const{fontSize:s,fontFamily:r,textBaseline:n,textAlign:o}=e,a=t.split(`
`);let l=0,h=0,d=document.createElement("canvas"),u=d.getContext("2d");u.font=`${s}px ${r}`,n&&(u.textBaseline=n),o&&(u.textAlign=o),a.forEach(p=>{const m=u.measureText(p||" "),{width:y,fontBoundingBoxAscent:w,fontBoundingBoxDescent:D}=m;y>l&&(l=y),h+=w+D});const f={width:l,height:h};return u=null,d=null,f}static measureTextWithSpan(t,e){const{fontSize:s,fontFamily:r,textBaseline:n,textAlign:o,fontLineHeight:a}=e,l=t.split(`
`);let h=0,d=0;const u=document.createElement("span");document.body.appendChild(u),u.style.visibility="hidden",u.style.fontSize=`${s}px`,u.style.fontFamily=r,u.style.display="inline-block",a&&(u.style.lineHeight=`${a}`),n&&(u.style.verticalAlign=n),o&&(u.style.textAlign=o),l.forEach(p=>{u.textContent=p||" ";const m=u.offsetWidth;m>h&&(h=m),d+=u.offsetHeight});const f={width:h,height:d};return document.body.removeChild(u),f}}g(hs,"DUMMY_TEXT","abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789天地玄黄宇宙洪荒日月盈昃辰宿列张孔曹卢甘");const b=class b{static convertPointsByStrokeType(t,e,s,r){if(!s)return t;const{flipX:n=!1,flipY:o=!1}=r,a=s/2;switch(e){case U.inside:return n!==o?Se.getArbitraryOuterVertices(t,a,r):Se.getArbitraryInnerVertices(t,a,r);case U.middle:return t;case U.outside:return n!==o?Se.getArbitraryInnerVertices(t,a,r):Se.getArbitraryOuterVertices(t,a,r)}}static async drawImgLike(t,e,s,r={}){return new Promise((n,o)=>{if(e instanceof ImageData&&(e=b.getCanvasByImageData(e).toDataURL()),typeof e=="string"){if(b.ImageCaches.has(e)){b.drawRotateImage(t,b.ImageCaches.get(e),s,r),n();return}const a=new Image;a.src=e,a.onload=()=>{b.ImageCaches.set(e,a),b.drawRotateImage(t,a,s,r),n()},a.onerror=()=>{o()}}else(e instanceof HTMLCanvasElement||e instanceof HTMLImageElement)&&b.drawRotateImage(t,e,s,r),n()})}static getTransformValues(t){let{angle:e=0,flipX:s=!1,leanY:r,actualAngle:n}=t;typeof n=="number"&&(e=n);let o=c.angleToRadian(e),a=1,l=1;return s&&(a=-1,o=-o,r=-r),{radian:o,scaleX:a,scaleY:l,leanY:r}}static transformCtx(t,e,s){const{x:r,y:n,width:o,height:a}=e,{radian:l,scaleX:h,scaleY:d,leanY:u}=s;t.translate(r+o/2,n+a/2),t.scale(h,d),t.rotate(l),t.transform(1,0,u,1,0,0)}static calcOffsetByRect(t){return{x:-(t.x+t.width/2),y:-(t.y+t.height/2)}}static transPointsOfBox(t,e){const s=b.calcOffsetByRect(e);return t.map(r=>c.translate(r,s))}static translateArcPoints(t,e){const s=b.calcOffsetByRect(e);return c.translateArcPoints(t,s)}static drawClipArcPoints(t,e,s){e=b.transArcParamsWithScale(e)[0],e=b.translateArcPoints(e,s),t.beginPath(),b.drawBazierPoints(e,t),t.closePath(),t.clip()}static drawRotateImage(t,e,s,r={}){const{width:n,height:o,desX:a,desY:l,desWidth:h,desHeight:d}=s,u=t.getContext("2d");u.save(),b.transformCtx(u,s,this.getTransformValues(r)),r.clipArcPoints&&b.drawClipArcPoints(u,r.clipArcPoints,s),R.every([a,l,h,d],R.isNumber)?u.drawImage(e,a-h/2,l,h,d):u.drawImage(e,-n/2,-o/2,n,o),u.restore()}static drawRotateImageData(t,e,s,r={}){const n=b.getCanvasByImageData(e);b.drawRotateImage(t,n,s,r)}static drawRectFill(t,e,s,r={}){const{width:n,height:o,desX:a,desY:l,desWidth:h,desHeight:d}=e,u=t.getContext("2d");u.save(),b.transformCtx(u,e,this.getTransformValues(r)),u.fillStyle=me.joinFillColor(s),R.every([a,l,h,d],R.isNumber)?u.fillRect(a,l,h,d):u.fillRect(-n/2,-o/2,n,o),u.restore()}static drawRotateText(t,e,s,r,n,o={}){const{fontColor:a,fontFamily:l,fontSize:h,textAlign:d,textBaseline:u,fontLineHeight:f,fontColorOpacity:p}=n,{flipX:m}=o,y=t.getContext("2d");y.save(),b.transformCtx(y,r,this.getTransformValues(o)),s=b.transPointsOfBox(s,r),y.font=`${h}px ${l}`,y.textAlign=d,y.textBaseline=u,y.fillStyle=me.joinFillColor({color:a,colorOpacity:p});let w=s[0].y;e.lines.forEach(D=>{let M=m?-s[0].x:s[0].x;Object.assign(D,{x:M,y:w,width:r.width});const{nodes:$}=D;let _=0;$.length===0?_=f*h:($.forEach(E=>{_=Math.max(f*E.fontStyle.fontSize*b.scale,_)}),$.forEach(E=>{y.save();let{content:S,fontStyle:L}=E;L=b.transFontWithScale(L);let{fontColor:I,fontColorOpacity:j,fontSize:z,fontFamily:se}=L;y.fillStyle=me.joinFillColor({color:I,colorOpacity:j}),y.font=`${z}px ${se}`;const Ae=y.measureText(hs.DUMMY_TEXT),{actualBoundingBoxDescent:ut,fontBoundingBoxDescent:Vt}=Ae;let bs=0;u==="top"&&(bs=Math.max(ut,Vt));const{width:As}=y.measureText(S);Object.assign(E,{x:M,y:w,width:As,height:_}),y.fillText(S,M,w+(_-bs)/2),M+=As,y.restore()})),D.height=_,w+=_}),y.restore()}static drawRotateTextWithScale(t,e,s,r,n,o={}){s=b.transPointsWidthScale(s),n=b.transFontWithScale(n),b.drawRotateText(t,e,s,r,n,o)}static drawCommonRotateText(t,e,s,r,n,o={}){const{angle:a=0}=o,l=t.getContext("2d");l.save(),l.translate(s.x,s.y),l.rotate(c.angleToRadian(a)),l.font=me.joinFont(r),l.fillStyle=me.joinFillColor(n),l.textAlign=r.textAlign,l.textBaseline=r.textBaseline,l.fillText(e,0,0),l.restore()}static drawCommonRotateTextWithScale(t,e,s,r,n,o={}){b.scale!==1&&(s={x:s.x*b.scale,y:s.y*b.scale}),b.drawCommonRotateText(t,e,s,r,n,o)}static transPointsWidthScale(t){return b.scale===1?t:v.scalePoints(t,b.scale)}static transStrokeWithScale(t){return b.scale===1?t:{...t,width:t.width*b.scale}}static transFontWithScale(t){return b.scale===1?t:{...t,fontSize:t.fontSize*b.scale}}static transArcParamsWithScale(t,e){return b.scale===1?[t,e]:(t=b.scaleArcPoints(t),e&&(e={...e,width:e.width*b.scale}),[t,e])}static transEllipseModelWithScale(t){return b.scale===1?t:{...t,rx:t.rx*b.scale,ry:t.ry*b.scale}}static drawPathWithScale(t,e,s,r,n,o={}){e=b.transPointsWidthScale(e),n=b.transStrokeWithScale(n),r.colorOpacity&&b.drawInnerPathFill(t,e,r,n,o),n.width&&n.colorOpacity&&b.drawPathStroke(t,e,n,o)}static drawInnerPathFill(t,e,s,r,n={}){const{calcVertices:o=!0}=n;let a;o?a=Se.getArbitraryInnerVertices(e,r.width/2,n):a=e,b.drawPathFill(t,a,s)}static drawInnerPathFillWithScale(t,e,s,r,n={}){e=b.transPointsWidthScale(e),r=b.transStrokeWithScale(r),s.colorOpacity&&b.drawInnerPathFill(t,e,s,r,n)}static scaleArcPoints(t){return b.scale===1||(t=t.map(e=>{const{start:s,controller:r,end:n,value:o,corner:a}=e,[l,h,d,u]=v.scalePoints([s,r,n,a],b.scale);return{start:l,controller:h,end:d,corner:u,value:o*b.scale}})),t}static drawInnerArcPathFillWithScale(t,e,s,r,n={}){s=b.scaleArcPoints(s),r.colorOpacity&&b.drawArcPathFill(t,s,e,r,n)}static drawPathStrokeWidthScale(t,e,s,r={}){e=b.transPointsWidthScale(e),s=b.transStrokeWithScale(s),b.drawPathStroke(t,e,s,r)}static drawArcPathStrokeWidthScale(t,e,s,r,n={}){[e,r]=b.transArcParamsWithScale(e,r),b.drawArcPathStroke(t,e,s,r,n)}static drawPathStroke(t,e,s,r={}){const{isFold:n=!0,miterLimit:o}=r,a=t.getContext("2d");a.save(),o&&(a.miterLimit=o),a.strokeStyle=me.joinStrokeColor(s),a.beginPath(),e.forEach((l,h)=>{h===0?a.moveTo(l.x,l.y):a.lineTo(l.x,l.y)}),n&&a.closePath(),s.width&&(a.lineWidth=s.width,a.stroke()),a.restore()}static calcStartOfArcPoints(t){let e=0,s;const[r,n,o]=t,a=t.map(d=>d.controller),{width:l,height:h}=c.calcParallelogramVerticalSize(a);return l>=h?(s=c.calcCenter([r.end,n.start]),e=1):(s=c.calcCenter([n.end,o.start]),e=2),{point:s,index:e}}static arcToBezierPoints(t,e){let{point:s,index:r}=b.calcStartOfArcPoints(t),n=0,o=t[r];for(;o;){const{start:a,controller:l,end:h,corner:d,value:u}=o;if(n===0&&e.moveTo(s.x,s.y),u){const f=c.calcDistance(a,d);e.arcTo(l.x,l.y,h.x,h.y,f)}else e.lineTo(l.x,l.y);if(o=v.getNextOfArray(t,r,1),r++,r>=t.length&&(r=0),n++,n>=t.length)break}}static drawBazierPoints(t,e){t.forEach((s,r)=>{const{start:n,controller:o,end:a,value:l}=s;r===0?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y),l?e.arcTo(o.x,o.y,a.x,a.y,l):e.lineTo(o.x,o.y)})}static drawArcPathStroke(t,e,s,r,n={}){const{isFold:o=!0}=n,a=t.getContext("2d");a.save(),b.transformCtx(a,s,b.getTransformValues(n)),a.miterLimit=0,a.lineCap="round",a.strokeStyle=me.joinStrokeColor(r),a.beginPath(),e=b.translateArcPoints(e,s),b.drawBazierPoints(e,a),o&&a.closePath(),r.width&&(a.lineWidth=r.width,a.stroke()),a.restore()}static drawPathFill(t,e,s){const r=t.getContext("2d");r.save(),r.fillStyle=me.joinFillColor(s),r.beginPath(),e.forEach((n,o)=>{o===0?r.moveTo(n.x,n.y):r.lineTo(n.x,n.y)}),r.closePath(),r.fill(),r.restore()}static drawArcPathFill(t,e,s,r,n={}){const o=t.getContext("2d");o.save(),b.transformCtx(o,s,b.getTransformValues(n)),o.fillStyle=me.joinFillColor(r),o.beginPath(),e=b.translateArcPoints(e,s),b.drawBazierPoints(e,o),o.closePath(),o.fill(),o.restore()}static transformEllipse(t,e,s,r,n){return r&&n&&(b.transformCtx(t,r,b.getTransformValues(n)),e=b.transPointsOfBox([e],r)[0]),s=b.transEllipseModelWithScale(s),{point:e,model:s}}static drawEllipseFill(t,e,s,r,n,o){const a=t.getContext("2d");a.save();const{point:{x:l,y:h},model:{rx:d,ry:u}}=b.transformEllipse(a,e,s,n,o);a.fillStyle=me.joinFillColor(r),a.beginPath(),a.ellipse(l,h,d,u,0,0,Math.PI*2),a.closePath(),a.fill(),a.restore()}static drawEllipseStroke(t,e,s,r,n,o){const a=t.getContext("2d");a.save();const{point:{x:l,y:h},model:{rx:d,ry:u}}=b.transformEllipse(a,e,s,n,o);a.lineWidth=r.width,a.strokeStyle=me.joinStrokeColor(r),a.beginPath(),a.ellipse(l,h,d,u,0,0,Math.PI*2),a.closePath(),a.stroke(),a.restore()}static drawEllipseStrokeWithScale(t,e,s,r,n,o){const a=b.transPointsWidthScale([e]);r=b.transStrokeWithScale(r),b.drawEllipseStroke(t,a[0],s,r,n,o)}static drawEllipseFillWithScale(t,e,s,r,n,o){const a=b.transPointsWidthScale([e]);b.drawEllipseFill(t,a[0],s,r,n,o)}static drawLine(t,e,s){const r=t.getContext("2d");r.save(),r.beginPath(),r.lineWidth=s.width,r.strokeStyle=me.joinStrokeColor(s),e.forEach((n,o)=>{o===0?r.moveTo(n.x,n.y):r.lineTo(n.x,n.y)}),r.closePath(),r.stroke(),r.restore()}static drawLineWidthScale(t,e,s){e=b.transPointsWidthScale(e),s=b.transStrokeWithScale(s),b.drawLine(t,e,s)}static getImageDataFromBlob(t){return new Promise((e,s)=>{const r=new Image;r.onload=()=>{const n=document.createElement("canvas");n.width=r.width,n.height=r.height;const o=n.getContext("2d");o.drawImage(r,0,0);const a=o.getImageData(0,0,r.width,r.height);e(a)},r.onerror=s,r.src=URL.createObjectURL(t)})}static getImageDataFromImage(t){return new Promise((e,s)=>{const r=document.createElement("canvas");r.width=t.width,r.height=t.height;const n=r.getContext("2d");n?(n.drawImage(t,0,0),e(n.getImageData(0,0,t.width,t.height))):s(new Error("Failed to get 2d context from canvas"))})}static getCanvasByImageData(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");return s&&s.putImageData(t,0,0),e}static getDataUrlFromImage(t){return new Promise((e,s)=>{const r=document.createElement("canvas");r.width=t.width,r.height=t.height;const n=r.getContext("2d");n?(n.drawImage(t,0,0),e(r.toDataURL())):s(new Error("Failed to get 2d context from canvas"))})}};g(b,"ImageCaches",new Map),g(b,"scale",1);let F=b;function Qt(i,t){const{id:e,x:s,y:r,height:n,width:o}=i;return{nodeId:e,pos:t,x:s+(t===ye.RIGHT?o:0),y:r,width:mr,height:n}}function gt(i){const{nodes:t}=i,e=t[t.length-1];if(e)return Qt(e,1);{const{x:s,y:r,height:n}=i;return{x:s,y:r,width:mr,height:n}}}class be{static draw(t,e){const{arcCoords:s,arcFillCoords:r,model:{styles:n},angle:o,flipX:a,leanY:l,actualAngle:h}=t,d={angle:o,flipX:a,leanY:l,actualAngle:h},u=P.batchCalcStageRelativeArcPoints(s),f=P.calcStageRelativeArcPoints(r),p=be.calcElementRenderRect(t);n.fills.forEach(m=>{F.drawInnerArcPathFillWithScale(e,p,f,m,d)}),u.forEach((m,y)=>{F.drawArcPathStrokeWidthScale(e,m,p,n.strokes[y],d)})}static calcElementRenderRect(t){const{rotateBoxCoords:e,center:s}=t;let r=v.calcRenderRect(e,s);return r=v.scaleRect(r,t.shield.stageScale),r}static retrieveTextCursorAtPosition(t,e,s){const r={},[n]=F.transPointsOfBox([e],s),{lines:o}=t;let a,l=-1;for(let h=0;h<o.length;h++){const d=o[h];if(v.isPointInRect(d,n)){a=d,l=h;break}}if(a){r.lineNumber=l;for(let h=0;h<a.nodes.length;h++){const d=a.nodes[h];if(v.isPointInRect(d,n)){let u=ye.LEFT;n.x>=d.x+d.width/2&&(u=ye.RIGHT),Object.assign(r,Qt(d,u));break}}r.nodeId||Object.assign(r,gt(a))}else r.lineNumber=o.length-1,Object.assign(r,gt(o[o.length-1]));return r.renderRect=s,r}static getUpdatedTextCursorProps(t,e){const{lines:s}=t,{nodeId:r,pos:n,lineNumber:o}=e,a=s[o];if(a)if(r){const l=a.nodes.find(h=>h.id===r);return l?Qt(l,n):gt(a)}else return gt(a)}}class Un extends Te{async run(){!this.canvas||!this.element||be.draw(this.element,this.canvas)}}const Kn={subs:!1,deepSubs:!1},ds={angle:0,leanYAngle:0,internalAngle:90,actualAngle:0,viewAngle:0},ot={corners:[0,0,0,0]},Qn={view:!0,leanY:!0,actual:!0,internal:!0},Zn={size:!0,position:!0,points:!0,rotation:!0,angles:!0,originals:!0,outline:!0,strokes:!0,corners:!0},it="#0c8ce9",ei=1,ti="#0c8ce9",si=.025,ri=1,ni="#0c8ce9",ii=1,oi="#ffffff",ai=1,li=1,Et=6,_t=12,ci=12,hi=12,di="#0c8ce9",ui=1,gi=12,fi="Arial",mi="center",pi="middle",Ci="#0c8ce9",yi=.25,Ei=Et+Math.sqrt(Math.pow(_t/2,2)),jt={strokes:[{type:U.middle,width:ri,color:it,colorOpacity:ei}],fills:[{color:ti,colorOpacity:si}]},He={strokes:[{type:U.middle,width:li,color:ni,colorOpacity:ii}],fills:[{color:oi,colorOpacity:ai}]},Zt={fontSize:gi,fontFamily:fi,fills:[{color:di,colorOpacity:ui}],textAlign:mi,textBaseline:pi},Is=Zt,Bs=20,es=3;class pr{constructor(t){g(this,"id");g(this,"isActive");g(this,"host");this.host=t,this.id=v.getRandomId(),this.isActive=!1}get angle(){return 0}get scale(){return 1/this.host.shield.stageScale}isCoordHitting(t){return!1}}class us extends pr{constructor(e,s){super(e);g(this,"width");g(this,"height");g(this,"x");g(this,"y");g(this,"points");const{points:r=[],x:n=0,y:o=0,width:a=0,height:l=0}=s||{};this.points=r,this.x=n,this.y=o,this.width=a,this.height=l}isContainsCoord(e){return c.isPointInPolygonByRayCasting(e,this.points)}isCoordHitting(e){return this.isContainsCoord(e)}}class ct extends us{constructor(){super(...arguments);g(this,"width",_t);g(this,"height",_t)}get angle(){return this.host.viewAngle-90}refresh(){if(!this.host.rotationEnable)return;const e=this.host.shield.stageScale,{x:s,y:r}=P.calcElementRotatePoint(this.host);this.x=s,this.y=r,this.points=v.getBoxVertices({x:s,y:r},{width:this.width/e,height:this.height/e}).map(n=>c.rotateWithCenter(n,this.host.viewAngle,{x:s,y:r}))}isContainsCoord(e){return this.host.rotationEnable?c.isPointInPolygonByRayCasting(e,this.points):!1}}var Ne=(i=>(i[i.rect=0]="rect",i[i.circle=1]="circle",i))(Ne||{});class Xe extends us{get angle(){return c.calcAngle(this.host.centerCoord,{x:this.x,y:this.y})+90}}class _i extends pr{constructor(e,s){super(e);g(this,"start");g(this,"end");g(this,"index");const{start:r,end:n,index:o}=s||{};r&&(this.start=r),n&&(this.end=n),R.isNumber(o)&&(this.index=o)}get angle(){return c.calcAngle(this.start,this.end)}isClosest(e){return c.isPointClosestSegment(e,this.start,this.end,Tn/this.host.shield.stageScale)}isCoordHitting(e){return this.isClosest(e)}}class at extends _i{}const wi=[.25,.5,1,2,3,4,5];var mt=(i=>(i[i.vertices=0]="vertices",i[i.border=1]="border",i))(mt||{}),ue=(i=>(i[i.vertices=0]="vertices",i[i.border=1]="border",i[i.hand=2]="hand",i[i.cross=3]="cross",i[i.move=4]="move",i[i.rotation=5]="rotation",i))(ue||{});const vi=100;class Cr extends ct{get angle(){return c.calcAngle(this.host.centerCoord,{x:this.x,y:this.y})+45}}const Le={type:A.moveable,name:"移动",category:te.cursor,icon:"icon-verbise-arrow-cursor-2--mouse-select-cursor",shortcut:"ctrl+m"},ts={type:A.hand,name:"手型",category:te.cursor,icon:"icon-verbise-hand",shortcut:"ctrl+h"},gs={type:A.rectangle,name:"矩形",category:te.shapes,icon:"icon-verbise-Rectangle"},xi={type:A.line,name:"直线",category:te.shapes,icon:"icon-verbise-line"},Si={type:A.polygon,name:"多边形",category:te.shapes,icon:"icon-verbise-polygon"},bi={type:A.image,name:"图片",category:te.shapes,icon:"icon-verbise-Image"},fs={type:A.arbitrary,name:"线条",category:te.freedom,icon:"icon-verbise-pen"},Ai={type:A.pencil,name:"画笔",category:te.freedom,icon:"icon-verbise-pencil"},Pi={type:A.ellipse,name:"椭圆",category:te.shapes,icon:"icon-verbise-eclipse"},yr={type:A.text,name:"文本",category:te.text,icon:"icon-verbise-text"},Er=[Le,ts],_r=[gs,xi,Pi,Si,bi],wr=[fs,Ai],Ri=[Le,...Er,gs,..._r,fs,...wr,yr];class vr{static getCreatorByType(t){return Ri.find(e=>e.type===t)}static isElement(t){return[A.image,A.text,A.arbitrary,A.rectangle,A.ellipse,A.polygon,A.line,A.text,A.pencil].includes(t)}}const Gt=["id","coords","boxCoords","x","y"];let Ke=class{constructor(t,e,s){g(this,"model");g(this,"rotation");g(this,"shield");g(this,"node");g(this,"_originalTransformerCoords",[]);g(this,"_originalCoords",[]);g(this,"_originalRotateCoords",[]);g(this,"_originalBoxCoords",[]);g(this,"_originalRotateBoxCoords",[]);g(this,"_originalRotateOutlineCoords",[]);g(this,"_originalStrokeCoords",[]);g(this,"_originalUnLeanCoords",[]);g(this,"_originalUnLeanBoxCoords",[]);g(this,"_originalUnLeanStrokeCoords",[]);g(this,"_originalMaxBoxCoords",[]);g(this,"_originalMaxOutlineBoxCoords",[]);g(this,"_originalTransformMatrix",[]);g(this,"_originalTransformMoveCoord");g(this,"_originalCenterCoord");g(this,"_originalAngle",0);g(this,"_originalSize",{});g(this,"_originalCorners",[]);g(this,"_transformMatrix",[]);g(this,"_transformLockCoord");g(this,"_transformLockIndex");g(this,"_unLeanCoords",[]);g(this,"_unLeanBoxCoords",[]);g(this,"_maxBoxCoords",[]);g(this,"_rotateCoords",[]);g(this,"_rotateBoxCoords",[]);g(this,"_maxOutlineBoxCoords",[]);g(this,"_rotateOutlineCoords",[]);g(this,"_strokeCoords",[]);g(this,"_unLeanStrokeCoords",[]);g(this,"_rect",{});g(this,"_transformers",[]);g(this,"_borderTransformers",[]);g(this,"_transformType");g(this,"_rotateControllers",[]);g(this,"_minParallelogramVerticalSize");g(this,"_minLeanSize");g(this,"_flipX",!1);g(this,"_innermostStrokeCoordIndex",0);g(this,"_isRangeElement",!1);g(this,"_status",Q.initialed);g(this,"_isSelected",!1);g(this,"_isVisible",!0);g(this,"_isEditing",!1);g(this,"_isLocked",!1);g(this,"_isMoving",!1);g(this,"_isTransforming",!1);g(this,"_isRotating",!1);g(this,"_isRotatingTarget",!1);g(this,"_isDragging",!1);g(this,"_isCornerMoving",!1);g(this,"_isProvisional",!1);g(this,"_isTarget",!1);g(this,"_isInRange",!1);g(this,"_isOnStage",!1);this.model=t,this.rotation=new ct(this),this.shield=e,this._isRangeElement=s??!1,this.refreshFlipX(),wn(this,{_status:J,_isDragging:J,_isRotating:J,_isTransforming:J,_isRotatingTarget:J,_isProvisional:J,_isOnStage:J,_isEditing:J,_isMoving:J,_isSelected:J,_isVisible:J,_isLocked:J,_isTarget:J,_isInRange:J,_isCornerMoving:J})}get isRangeElement(){return this._isRangeElement}get id(){return this.model.id}get isElement(){return vr.isElement(this.model.type)}get isGroup(){return this.model.type===A.group}get group(){return this.isGroupSubject?this.shield.store.getElementById(this.model.groupId):null}get ancestorGroup(){if(!this.isGroupSubject)return null;let t=this.group;for(;t&&t.isGroupSubject;)t=t.group;return t}get isGroupSubject(){return this.model.groupId!==void 0}get strokeCoords(){return this._strokeCoords}get unLeanStrokeCoords(){return this._unLeanStrokeCoords}get innermostStrokeCoordIndex(){return this._innermostStrokeCoordIndex}get innermostStrokeCoords(){return this._strokeCoords[this.innermostStrokeCoordIndex]}get flipX(){return this.flipXEnable?!this._isTransforming||this._isEditing?this._flipX:(this.refreshFlipX(),this._flipX):!1}get flipY(){return!1}get flip(){return{flipX:this.flipX,flipY:this.flipY}}get flipXEnable(){return!0}get flipYEnable(){return!0}get widthModifyEnable(){return!0}get heightModifyEnable(){return!0}get rotationEnable(){return!0}get verticesRotationEnable(){return!0}get coordTransformEnable(){return!1}get boxVerticesTransformEnable(){return this.status===Q.finished}get borderTransformEnable(){return this.status===Q.finished}get transformersEnable(){return!0}get fillEnabled(){return!0}get strokeEnable(){return!0}get ratioLockedEnable(){return!0}get editingEnable(){return!0}get tfRefreshAfterEdChanged(){return!1}get shouldRatioLockResize(){return this.ratioLockedEnable&&(this.isRatioLocked||this.shield.event.isShift)}get originalCoords(){return this._originalCoords}get originalBoxCoords(){return this._originalBoxCoords}get width(){return this.model.width}get height(){return this.model.height}get minParallelogramVerticalSize(){return this._minParallelogramVerticalSize}get minLeanSize(){return this._minLeanSize}get angle(){return this.getAngle()}get corners(){return this.model.corners}get center(){return P.calcStageRelativePoint(this.centerCoord)}get centerCoord(){return this.calcCenterCoord()}get position(){return{x:this.model.x,y:this.model.y}}get strokes(){return this.model.styles.strokes}get fills(){return this.model.styles.fills}get textAlign(){return this.model.styles.textAlign}get textBaseline(){return this.model.styles.textBaseline}get fontSize(){return this.model.styles.fontSize}get fontFamily(){return this.model.styles.fontFamily}get fontLineHeight(){return this.model.styles.fontLineHeight}get fontColor(){return this.model.styles.fontColor}get fontColorOpacity(){return this.model.styles.fontColorOpacity}get status(){return this._status}set status(t){this._setStatus(t)}get isSelected(){return this._isSelected}set isSelected(t){this._setIsSelected(t)}get isVisible(){return this._isVisible}set isVisible(t){this._setIsVisible(t)}get isEditing(){return this._isEditing}set isEditing(t){this._setIsEditing(t)}get isLocked(){return this._isLocked}set isLocked(t){this._setIsLocked(t)}get isMoving(){return this._isMoving}set isMoving(t){this._setIsMoving(t)}get isTransforming(){return this._isTransforming}set isTransforming(t){this._setIsTransforming(t)}get isRotating(){return this._isRotating}set isRotating(t){this._setIsRotating(t)}get isRotatingTarget(){return this._isRotatingTarget}set isRotatingTarget(t){this._setIsRotatingTarget(t)}get isDragging(){return this._isDragging}set isDragging(t){this._setIsDragging(t)}get isCornerMoving(){return this._isCornerMoving}set isCornerMoving(t){this._setIsCornerMoving(t)}get isProvisional(){return this._isProvisional}set isProvisional(t){this._setIsRendered(t)}get isTarget(){return this._isTarget}set isTarget(t){this._setIsTarget(t)}get isInRange(){return this._isInRange}set isInRange(t){this._setIsInRange(t)}get isOnStage(){return this._isOnStage}set isOnStage(t){this._setIsOnStage(t)}get isRatioLocked(){return this.model.isRatioLocked}_setStatus(t){this._status=t}_setIsSelected(t){this._isSelected=t}_setIsVisible(t){this._isVisible=t}_setIsEditing(t){this._isEditing=t}_setIsLocked(t){this._isLocked=t}_setIsMoving(t){this._isMoving=t}_setIsTransforming(t){this._isTransforming=t}_setIsRotating(t){this._isRotating=t}_setIsRotatingTarget(t){this._isRotatingTarget=t}_setIsDragging(t){this._isDragging=t}_setIsRendered(t){this._isProvisional=t}_setIsTarget(t){this._isTarget=t}_setIsOnStage(t){this._isOnStage=t}_setIsInRange(t){this._isInRange=t}_setIsCornerMoving(t){this._isCornerMoving=t}get maxBoxCoords(){return this._maxBoxCoords}get maxOutlineBoxCoords(){return this._maxOutlineBoxCoords}get rotateCoords(){return this._rotateCoords}get rotateBoxCoords(){return this._rotateBoxCoords}get rotateOutlineCoords(){return this._rotateOutlineCoords}get unLeanCoords(){return this._unLeanCoords}get unLeanBoxCoords(){return this._unLeanBoxCoords}get transformers(){return this._transformers}get borderTransformers(){return this._borderTransformers}get transformerType(){return Ne.rect}get rect(){return this._rect}get activeCoordIndex(){return-1}get alignCoords(){return this._rotateCoords}get alignOutlineCoords(){return this._rotateOutlineCoords}get visualStrokeWidth(){return Math.max(...this.strokes.map(t=>t.width*this.shield.stageScale))}get visualFontSize(){return this.fontSize*this.shield.stageScale}get originalAngle(){return this._originalAngle}set originalAngle(t){this._originalAngle=t}get transformMatrix(){return this._transformMatrix}get transformLockIndex(){return this._transformLockIndex}get transformLockCoord(){return this._transformLockCoord}get originalTransformMoveCoord(){return this._originalTransformMoveCoord}get transformType(){return this._transformType}get viewAngle(){return this.model.viewAngle}get internalAngle(){return this.model.internalAngle}get leanYAngle(){return this.model.leanYAngle}get angles(){return{angle:this.model.angle,leanYAngle:this.model.leanYAngle,internalAngle:this.model.internalAngle,actualAngle:this.model.actualAngle,viewAngle:this.model.viewAngle}}get leanY(){return-Math.tan(c.angleToRadian(this.model.leanYAngle))}get actualAngle(){return this.model.actualAngle}get viewAngleCalcEnable(){return!0}get leanYAngleCalcEnable(){return!0}get leanYAngleModifyEnable(){return!0}get cornersModifyEnable(){return!1}get cornerEnable(){return!1}get rotateControllers(){return this._rotateControllers}get controllers(){const t=[];return this.rotationEnable&&(this.shield.configure.rotationIconEnable&&t.push(this.rotation),t.push(...this._rotateControllers)),(this.coordTransformEnable||this.boxVerticesTransformEnable)&&t.push(...this._transformers),this.borderTransformEnable&&t.push(...this._borderTransformers),t}get isTopmost(){return this.node.next===null}get isBottommost(){return this.node.prev===null}get isInMultiSelected(){const{selectedElementIds:t}=this.shield.store;return t.has(this.model.id)&&t.size>1}get shouldPropChangedEmit(){const t=this.isInMultiSelected;return!t||t&&!this.isGroupSubject}onPositionChanged(){this.refresh(),this.emitPropChanged(T.positionChanged,[this.position])}onWidthChanged(){this.refresh(),this.emitPropChanged(T.widthChanged,[this.width])}onHeightChanged(){this.refresh(),this.emitPropChanged(T.heightChanged,[this.height])}onLayerChanged(){}onTranslateBefore(){this.refreshOriginalProps()}onTranslateAfter(){this.refreshOriginalProps()}onTranslating(){const{x:t,y:e}=P.calcPosition({type:this.model.type,coords:this.model.coords});this.model.x=t,this.model.y=e,this.refreshCorners(),this.refreshRotation(),this.refreshTransformers(),this.emitPropChanged(T.positionChanged,[this.position])}onRotateBefore(){this.refreshOriginalProps()}onRotateAfter(){this.refreshOriginalProps()}onRotating(){this.refresh({points:!0,rotation:!0,position:!0,angles:!0,outline:!0,strokes:!0,corners:!0}),this.emitPropChanged(T.angleChanged,[this.angle])}onTransformBefore(){this.refreshOriginalProps()}onTransformAfter(){this.refreshOriginalProps()}onTransforming(){this.refresh({points:!0,rotation:!0,size:!0,position:!0,angles:!0,outline:!0,strokes:!0,corners:!0},{angles:{view:!0,actual:!0}}),this.emitPropChanged(T.positionChanged,[this.position]),this.emitPropChanged(T.widthChanged,[this.width]),this.emitPropChanged(T.heightChanged,[this.height]),this.emitPropChanged(T.angleChanged,[this.angle]),this.emitPropChanged(T.flipXChanged,[this._flipX])}onAngleChanged(){this.refresh(null,{angles:{view:!0,actual:!0}}),this.emitPropChanged(T.angleChanged,[this.angle])}onLeanyAngleChanged(){this.refresh(null,{angles:{view:!0,actual:!0,internal:!0}}),this.emitPropChanged(T.leanYAngleChanged,[this.leanYAngle])}onCornerChanging(){this.refresh({corners:!0,strokes:!0}),this.emitPropChanged(T.cornersChanged,[this.corners])}onCornerChanged(){this.refresh({corners:!0,strokes:!0,originals:!0}),this.emitPropChanged(T.cornersChanged,[this.corners])}onStrokeTypeChanged(){this.refresh({strokes:!0,outline:!0,originals:!0}),this.emitPropChanged(T.strokesChanged,[this.strokes])}onStrokeWidthChanged(){this.refresh({strokes:!0,outline:!0,originals:!0}),this.emitPropChanged(T.strokesChanged,[this.strokes])}onStrokeColorChanged(){this.emitPropChanged(T.strokesChanged,[this.strokes])}onStrokeColorOpacityChanged(){this.emitPropChanged(T.strokesChanged,[this.strokes])}onStrokeAdded(){this.refresh({strokes:!0,outline:!0,originals:!0}),this.emitPropChanged(T.strokesChanged,[this.strokes])}onStrokeRemoved(){this.refresh({strokes:!0,outline:!0,originals:!0}),this.emitPropChanged(T.strokesChanged,[this.strokes])}onFillColorChanged(){this.emitPropChanged(T.fillsChanged,[this.fills])}onFillColorOpacityChanged(){this.emitPropChanged(T.fillsChanged,[this.fills])}onFillAdded(){this.emitPropChanged(T.fillsChanged,[this.fills])}onFillRemoved(){this.emitPropChanged(T.fillsChanged,[this.fills])}onTextAlignChanged(){this.emitPropChanged(T.textAlignChanged,[this.textAlign])}onTextBaselineChanged(){this.emitPropChanged(T.textBaselineChanged,[this.textBaseline])}onFontSizeChanged(){this.emitPropChanged(T.fontSizeChanged,[this.fontSize])}onFontFamilyChanged(){this.emitPropChanged(T.fontFamilyChanged,[this.fontFamily])}onFontLineHeightChanged(){this.emitPropChanged(T.fontLineHeightChanged,[this.fontLineHeight])}onFontColorChanged(){this.emitPropChanged(T.fontColorChanged,[this.fontColor])}onFontColorOpacityChanged(){this.emitPropChanged(T.fontColorOpacityChanged,[this.fontColorOpacity])}onRatioLockedChanged(){this.emitPropChanged(T.ratioLockedChanged,[this.isRatioLocked])}onStageChanged(){}getAngle(){return this.model.angle}emitPropChanged(t,e){this.shouldPropChangedEmit&&this.shield.store.filterEmit(t,this,...e)}convertPointsByStrokeType(t,e){return F.convertPointsByStrokeType(t,e.type,e.width,{...this.flip,isFold:this.model.isFold})}calcRotateBoxCoords(){return this.model.boxCoords.map(t=>c.rotateWithCenter(t,this.model.angle,this.centerCoord))}calcMaxBoxCoords(){return v.getBoxPoints(this._rotateCoords)}calcMaxOutlineBoxCoords(){return v.getBoxPoints(this._rotateOutlineCoords.flat())}calcRotateCoords(){return this.model.coords.map(t=>c.rotateWithCenter(t,this.model.angle,this.centerCoord))}calcRotateOutlineCoords(){return this.model.styles.strokes.map(t=>P.calcOutlinePoints(this._rotateCoords,t.type,t.width,{...this.flip,isFold:this.model.isFold}))}calcCenterCoord(){return c.calcCenter(this.model.boxCoords)}getController4BoxCoords(t,e){return e=e||Et,v.get4BoxPoints(t,{width:e/this.shield.stageScale,height:e/this.shield.stageScale},{angle:this.model.actualAngle,leanYAngle:this.model.leanYAngle})}calcTransformersByCoords(t){return t.map((e,s)=>{const{x:r,y:n}=e,o=this.getController4BoxCoords(e);let a=this._transformers[s];return a?(a.points=o,a.x=r,a.y=n):a=new Xe(this,{points:o,x:r,y:n}),a})}calcBoxVerticesTransformers(){return this.calcTransformersByCoords(this._rotateBoxCoords)}calcCoordTransformers(){return this.calcTransformersByCoords(this._rotateCoords)}calcTransformers(){return this.coordTransformEnable?this.calcCoordTransformers():this.boxVerticesTransformEnable?this.calcBoxVerticesTransformers():[]}calcRotateControllers(){const t=this.centerCoord;return this._rotateBoxCoords.map((e,s)=>{const r=c.calcAngle(t,e),{x:n,y:o}=c.calcTargetPoint(e,Ei/this.shield.stageScale,r),a=this.getController4BoxCoords({x:n,y:o},_t);let l=this._rotateControllers[s];return l?(l.points=a,l.x=n,l.y=o):l=new Cr(this,{x:n,y:o,points:a}),l})}calcBorderTransformers(){return this._rotateBoxCoords.map((e,s)=>{const r=v.getNextOfArray(this._rotateBoxCoords,s);let n=this._borderTransformers[s];return n?(n.start=e,n.end=r):n=new at(this,{start:e,end:r,index:s}),n})}calcUnLeanCoords(){return c.calcUnLeanByPoints(this.model.coords,0,this.model.leanYAngle)}calcUnLeanBoxCoords(){return c.calcUnLeanByPoints(this.model.boxCoords,0,this.model.leanYAngle)}calcStrokeCoords(){return this.model.styles.strokes.map(t=>this.convertPointsByStrokeType(this._rotateCoords,t))}calcInnermostStrokeCoordIndex(){let t=0,e=0;return this._strokeCoords.forEach((s,r)=>{const{width:n,type:o}=this.model.styles.strokes[r];o===U.middle&&e<n/2&&(e=n/2,t=r),o===U.inside&&e<n&&(e=n,t=r)}),t}calcUnLeanStrokeCoords(){return this.model.styles.strokes.map(t=>this.convertPointsByStrokeType(this._unLeanCoords,t))}calcInternalAngle(){return this._isRangeElement?90:c.calcInternalAngle(this.model.boxCoords)}calcLeanYAngle(){return!this.leanYAngleCalcEnable||this._isRangeElement?0:c.calcLeanYAngle(this.model.internalAngle,this.flipX)}calcViewAngle(){return this.viewAngleCalcEnable?c.calcViewAngleByPoints(this._rotateBoxCoords):this.model.angle}calcActualAngle(){return c.mirrorAngle(this.model.viewAngle-this.model.leanYAngle)}calcPrimitiveSize(){return v.calcRectangleSize(c.batchLeanWithCenter(this.model.boxCoords,-this.model.leanXAngle,-this.model.leanYAngle,this.centerCoord))}refreshAngles(t){t=t||Qn,t.view&&(this.model.viewAngle=this.calcViewAngle()),t.internal&&(this.model.internalAngle=this.calcInternalAngle()),t.leanY&&(this.model.leanYAngle=this.calcLeanYAngle()),t.actual&&(this.model.actualAngle=this.calcActualAngle())}refreshRotation(){this.rotationEnable&&(this.shield.configure.rotationIconEnable&&this.rotation.refresh(),this._rotateControllers=this.calcRotateControllers())}refreshPoints(){this._rotateCoords=this.calcRotateCoords(),this._rotateBoxCoords=this.calcRotateBoxCoords(),this._unLeanCoords=this.calcUnLeanCoords(),this._unLeanBoxCoords=this.calcUnLeanBoxCoords(),this._maxBoxCoords=this.calcMaxBoxCoords(),this.refreshTransformers()}isContainsCoord(t){return R.some(this._rotateOutlineCoords,e=>c.isPointInPolygonByRayCasting(t,e))}isPolygonOverlap(t){return R.some(this._rotateOutlineCoords,e=>c.isPolygonsOverlap(e,t))}isModelPolygonOverlap(t){return R.some(this._rotateOutlineCoords,e=>c.isPolygonsOverlap(e,t))}refreshOriginalElementProps(){this.refreshOriginalCoords(),this.refreshOriginalStrokes(),this._originalSize={width:this.model.width,height:this.model.height},this._originalCorners=H.jsonClone(this.model.corners),this._originalTransformMatrix=[]}refreshOriginalCoords(){this._originalCoords=H.jsonClone(this.model.coords),this._originalBoxCoords=H.jsonClone(this.model.boxCoords),this._originalRotateCoords=H.jsonClone(this._rotateCoords),this._originalRotateBoxCoords=H.jsonClone(this._rotateBoxCoords),this._originalUnLeanCoords=H.jsonClone(this._unLeanCoords),this._originalUnLeanBoxCoords=H.jsonClone(this._unLeanBoxCoords),this._originalCenterCoord=H.jsonClone(this.centerCoord),this._originalRotateOutlineCoords=H.jsonClone(this._rotateOutlineCoords),this._originalMaxOutlineBoxCoords=H.jsonClone(this._maxOutlineBoxCoords),this._originalMaxBoxCoords=H.jsonClone(this._maxBoxCoords)}refreshOriginalStrokes(){this._originalStrokeCoords=H.jsonClone(this._strokeCoords),this._originalUnLeanStrokeCoords=H.jsonClone(this._unLeanStrokeCoords)}refreshOriginalTransformerCoords(){this._originalTransformerCoords=this._transformers.map(t=>{const{x:e,y:s}=t;return{x:e,y:s}})}refreshOriginalProps(){this.refreshOriginalTransformerCoords(),this.refreshOriginalElementProps()}refreshSize(){const{width:t,height:e}=P.calcSize(this.model);if(this.model.width=c.precise(t,1),this.model.height=c.precise(e,1),this._rotateBoxCoords&&this._rotateBoxCoords.length){const{width:s,height:r}=c.calcParallelogramVerticalSize(this._rotateBoxCoords);this._minParallelogramVerticalSize=Math.min(s,r),this._minLeanSize=Math.min(this.model.width,r)}}refreshPosition(){Object.assign(this.model,this.calcCenterCoord())}refreshTransformers(){this._transformers=this.calcTransformers(),this.borderTransformEnable&&(this._borderTransformers=this.calcBorderTransformers())}flipAngle(){let t;this.model.angle>0?t=this.model.angle-180:t=this.model.angle+180,this.model.angle=c.mirrorAngle(t)}batchCalcTransformPointsByCenter(t,e,s,r){return this.calcTransformPointsByCenter(t,e,s,r,this.angles)}calcTransformPointsByCenter(t,e,s,r,n){const o=P.calcMatrixPoint(r,e,s,n);return t.map(a=>(a=P.calcMatrixPoint(a,e,s,n),c.rotateWithCenter(a,-n.angle,o)))}transform(t){this.getActiveController()instanceof Xe?(this.transformByVertices(t),this._transformType=mt.vertices):this.getActiveController()instanceof at&&(this.transformByBorder(t),this._transformType=mt.border)}transformBy(t){const{lockCoord:e,lockIndex:s,transformType:r,originalMovingCoord:n,offset:o,groupAngle:a,groupLeanYAngle:l}=t,h={angle:a,leanYAngle:l},d=this.getTransformMatrix(e,n,o,h,!1);r===mt.border&&this._transBorderMatrix(d,s,!1),this._doTransformBy(d,e,h,n)}_doTransformBy(t,e,s,r){const n=P.calcMatrixPoints(this._originalRotateCoords,t,e,s),o=P.calcMatrixPoints(this._originalRotateBoxCoords,t,e,s);this._doTransformByPoints(n,o,e,t,r)}_doTransformByPoints(t,e,s,r,n){this.model.internalAngle=c.calcInternalAngle(e),this.model.leanYAngle=c.calcLeanYAngle(this.model.internalAngle,c.calcFlipXByPoints(e)),this.model.angle=c.mirrorAngle(c.calcActualAngleByPoints(e)),this.model.coords=c.batchPrecisePoint(P.calcCoordsByTransPoints(t,this.angles,s),1),this.model.boxCoords=c.batchPrecisePoint(P.calcCoordsByTransPoints(e,this.angles,s),1),n&&r&&this._tryFlipAngle(s,n,r)}transformByVertices(t){!this.coordTransformEnable&&!this.boxVerticesTransformEnable||this.doVerticesTransform(t)}doVerticesTransform(t){const e=this._transformers.findIndex(s=>s.isActive);if(e!==-1){const s=v.getPrevIndexOfArray(this._transformers.length,e,2),r=this._originalTransformerCoords[s],n=this._originalTransformerCoords[e];this._originalTransformMoveCoord=n,this.transformByLockPoint(r,n,t,e)}}transformByLockPoint(t,e,s,r){const n=this.getTransformMatrix(t,e,s,this.angles);this._transformMatrix=n,this._transformLockCoord=t,this._transformLockIndex=r,this.model.coords=c.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,n,t,this._originalCenterCoord),1),this.model.boxCoords=c.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,n,t,this._originalCenterCoord),1),this._tryFlipAngle(t,e,n)}getTransformMatrix(t,e,s,r,n){typeof n>"u"&&(n=!0);const o={x:e.x+s.x,y:e.y+s.y},a=c.calcTransformMatrix(t,o,e,r);return n&&this.shouldRatioLockResize&&(a[1][1]=c.resignValue(a[1][1],a[0][0])),a}_tryFlipAngle(t,e,s){this._originalTransformMatrix.length||(this._originalTransformMatrix=c.calcTransformMatrix(t,e,e,this.angles));const r=this._doFlipAngle(s,this._originalTransformMatrix);return r&&(this._originalTransformMatrix=H.jsonClone(s)),r}_doFlipAngle(t,e){e[0][0];const s=e[1][1];t[0][0];const r=t[1][1];return c.isSameSign(r,s)?!1:(this.flipAngle(),!0)}transformByBorder(t){this.borderTransformEnable&&this.doBorderTransform(t)}getBorderTransformLockCoord(t){const e=v.getPrevIndexOfArray(this._borderTransformers.length,t,2),s=v.getNextIndexOfArray(this._borderTransformers.length,t,3);return c.calcCenter([this._originalTransformerCoords[e],this._originalTransformerCoords[s]])}_transBorderMatrix(t,e,s){typeof s>"u"&&(s=!0);const r=s&&this.shouldRatioLockResize;return e===0||e===2?t[0][0]=r?c.resignValue(t[0][0],t[1][1]):1:(e===1||e===3)&&(t[1][1]=r?c.resignValue(t[1][1],t[0][0]):1),[1,3].includes(e)&&t[1][1]<0&&(t[1][1]=Math.abs(t[1][1])),[0,2].includes(e)&&t[0][0]<0&&(t[0][0]=Math.abs(t[0][0])),t}doBorderTransform(t){const e=this._borderTransformers.findIndex(s=>s.isActive);if(e!==-1){const s=this.getBorderTransformLockCoord(e),r=this._originalTransformerCoords[e];this._originalTransformMoveCoord=r;const n={x:r.x+t.x,y:r.y+t.y},o=c.calcTransformMatrix(s,n,r,this.angles);this._transBorderMatrix(o,e),this._transformMatrix=o,this._transformLockCoord=s,this._transformLockIndex=e,this.model.coords=c.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,o,s,this._originalCenterCoord),1),this.model.boxCoords=c.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,o,s,this._originalCenterCoord),1),this._tryFlipAngle(s,r,o)}}translateBy(t){this.model.coords=c.batchTranslate(this._originalCoords,t),this.model.boxCoords=c.batchTranslate(this._originalBoxCoords,t),this._rotateCoords=c.batchTranslate(this._originalRotateCoords,t),this._rotateBoxCoords=c.batchTranslate(this._originalRotateBoxCoords,t),this._unLeanCoords=c.batchTranslate(this._originalUnLeanCoords,t),this._unLeanBoxCoords=c.batchTranslate(this._originalUnLeanBoxCoords,t),this._unLeanStrokeCoords=this._originalUnLeanStrokeCoords.map(e=>c.batchTranslate(e,t)),this._strokeCoords=this._originalStrokeCoords.map(e=>c.batchTranslate(e,t)),this._maxBoxCoords=c.batchTranslate(this._originalMaxBoxCoords,t),this._maxOutlineBoxCoords=c.batchTranslate(this._originalMaxOutlineBoxCoords,t),this._rotateOutlineCoords=this._originalRotateOutlineCoords.map(e=>c.batchTranslate(e,t))}refresh(t,e){t=t||Zn,t!=null&&t.points&&this.refreshPoints(),t!=null&&t.size&&this.refreshSize(),t!=null&&t.position&&this.refreshPosition(),t!=null&&t.angles&&this.refreshAngles(e==null?void 0:e.angles),t!=null&&t.rotation&&this.refreshRotation(),t!=null&&t.corners&&this.refreshCorners(),t!=null&&t.strokes&&this.refreshStrokePoints(),t!=null&&t.outline&&this.refreshOutlinePoints(),t!=null&&t.originals&&this.refreshOriginalProps()}refreshOutlinePoints(){this._rotateOutlineCoords=this.calcRotateOutlineCoords(),this._maxOutlineBoxCoords=this.calcMaxOutlineBoxCoords()}refreshFlipX(){var t;(t=this.model.boxCoords)!=null&&t.length&&(this._flipX=c.calcFlipXByPoints(this.model.boxCoords))}setWidth(t){const e=c.calcScaleMatrix(t/this._originalSize.width,1);return e[1][1]=this.shouldRatioLockResize?c.resignValue(e[1][1],e[0][0]):1,this._setWH(e),e}setHeight(t){const e=c.calcScaleMatrix(1,t/this._originalSize.height);return e[0][0]=this.shouldRatioLockResize?c.resignValue(e[0][0],e[1][1]):1,this._setWH(e),e}scaleBy(t,e,s,r){const n=c.calcScaleMatrix(e,s);r?this._doTransformBy(n,t,r):(this.model.coords=c.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,n,t,this._originalCenterCoord),1),this.model.boxCoords=c.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,n,t,this._originalCenterCoord),1)),this.refresh({points:!0,size:!0,position:!0,rotation:!0,originals:!0,outline:!0,strokes:!0,corners:!0})}_setWH(t){this._transformMatrix=t,this._transformLockCoord=this._originalCenterCoord,this.model.coords=c.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,t,this._originalCenterCoord,this._originalCenterCoord),1),this.model.boxCoords=c.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,t,this._originalCenterCoord,this._originalCenterCoord),1)}setPosition(t,e,s){this.model.x=t,this.model.y=e,this.model.coords=c.batchPrecisePoint(c.batchTranslate(this.model.coords,s),1),this.model.boxCoords=c.batchPrecisePoint(c.batchTranslate(this.model.boxCoords,s),1)}setAngle(t){this.model.angle=t}setLeanYAngle(t){t=R.clamp(t,-89,89);const e=this.calcUnLeanCoords(),s=this.centerCoord;this.model.coords=c.batchPrecisePoint(c.batchLeanYWithCenter(e,t,s),1);const r=this.calcUnLeanBoxCoords();this.model.boxCoords=c.batchPrecisePoint(c.batchLeanYWithCenter(r,t,s),1),this.model.leanYAngle=t}leanYBy(t,e,s,r){let n=c.batchTransWithCenter(this._rotateCoords,{angle:s,leanYAngle:e},r,!0),o=c.batchTransWithCenter(this._rotateBoxCoords,{angle:s,leanYAngle:e},r,!0);n=c.batchTransWithCenter(n,{angle:s,leanYAngle:t},r),o=c.batchTransWithCenter(o,{angle:s,leanYAngle:t},r),this._doTransformByPoints(n,o,r)}refreshCorners(){}refreshStrokePoints(){this._strokeCoords=this.calcStrokeCoords(),this._unLeanStrokeCoords=this.calcUnLeanStrokeCoords(),this._innermostStrokeCoordIndex=this.calcInnermostStrokeCoordIndex()}setCorners(t,e){let s=H.jsonClone(this.model.corners);R.isNumber(e)?s[e]=t:s.fill(t),s=P.fixCornersBasedOnMinSize(s,this._minParallelogramVerticalSize),this.model.corners=s}setStrokeType(t,e){this.model.styles.strokes[e].type=t}setStrokeColor(t,e){this.model.styles.strokes[e].color=t}setStrokeColorOpacity(t,e){this.model.styles.strokes[e].colorOpacity=R.clamp(t,0,1)}setStrokeWidth(t,e){switch(this.model.styles.strokes[e].type){case U.middle:t=R.clamp(t,0,this._minLeanSize);break;case U.inside:t=R.clamp(t,0,this._minLeanSize/2);break;case U.outside:t=R.clamp(t,0,this._minLeanSize*2);break}t=c.precise(t,1),this.model.styles.strokes[e].width=t}addStroke(t){this.model.styles.strokes.splice(t+1,0,{...kt})}removeStroke(t){this.model.styles.strokes.splice(t,1)}setFillColor(t,e){this.model.styles.fills[e].color=t}setFillColorOpacity(t,e){this.model.styles.fills[e].colorOpacity=R.clamp(t,0,1)}addFill(t){this.model.styles.fills.splice(t+1,0,{...Ot})}removeFill(t){this.model.styles.fills.splice(t,1)}setFontSize(t){this.model.styles.fontSize=t}setFontFamily(t){this.model.styles.fontFamily=t}setFontLineHeight(t){this.model.styles.fontLineHeight=t}setFontColor(t){this.model.styles.fontColor=t}setFontColorOpacity(t){this.model.styles.fontColorOpacity=R.clamp(t,0,1)}setTextAlign(t){this.model.styles.textAlign=t}setTextBaseline(t){this.model.styles.textBaseline=t}setRatioLocked(t){this.model.isRatioLocked=t,t?this.model.ratio=this.model.width/this.model.height:this.model.ratio=null}rotateBy(t,e){const s=c.rotateWithCenter(this._originalCenterCoord,t,e),r={x:s.x-this._originalCenterCoord.x,y:s.y-this._originalCenterCoord.y},n=this._originalCoords.map(a=>c.translate(a,r)),o=this._originalBoxCoords.map(a=>c.translate(a,r));this.model.coords=c.batchPrecisePoint(n,1),this.model.boxCoords=c.batchPrecisePoint(o,1),this.model.angle=c.mirrorAngle(c.normalizeAngle(this._originalAngle)+c.normalizeAngle(t)%360)}getActiveController(){return this.controllers.find(t=>t.isActive)}setControllersActive(t,e){t.forEach(s=>s.isActive=e)}getControllerByCoord(t){return this.controllers.find(e=>e.isCoordHitting(t))}refreshOriginalAngle(){this._originalAngle=this.model.angle}async toJson(){return JSON.parse(JSON.stringify({...this.model,...this.flip}))}fromJson(t){this.model=JSON.parse(JSON.stringify(t))}_toOriginalCommonJson(){const{id:t,_originalCoords:e,_originalBoxCoords:s,_originalCenterCoord:{x:r,y:n}}=this;return{id:t,coords:e,boxCoords:s,x:r,y:n}}async toOriginalTranslateJson(){const t=this._toOriginalCommonJson();return JSON.parse(JSON.stringify(t))}async toTranslateJson(){return JSON.parse(JSON.stringify(R.pick(this.model,[...Gt])))}async toOriginalRotateJson(){const t=this._toOriginalCommonJson();return t.angle=this._originalAngle,JSON.parse(JSON.stringify(t))}async toRotateJson(){return JSON.parse(JSON.stringify(R.pick(this.model,[...Gt,"angle"])))}async toOriginalTransformJson(){const t=this._toOriginalCommonJson();return t.width=this._originalSize.width,t.height=this._originalSize.height,t.angle=this._originalAngle,JSON.parse(JSON.stringify(t))}async toTransformJson(){return JSON.parse(JSON.stringify(R.pick(this.model,[...Gt,"width","height","angle"])))}async toOriginalCornerJson(){const{id:t,_originalCorners:e}=this;return JSON.parse(JSON.stringify({id:t,corners:e}))}async toCornerJson(){return JSON.parse(JSON.stringify(R.pick(this.model,["id","corners"])))}async toStrokesJson(){return JSON.parse(JSON.stringify(R.pick(this.model,["id","styles.strokes"])))}async toFillsJson(){return JSON.parse(JSON.stringify(R.pick(this.model,["id","styles.fills"])))}async toGroupJson(){return JSON.parse(JSON.stringify(R.pick(this.model,["id","groupId"])))}};class wt extends us{}class ms extends Ke{constructor(){super(...arguments);g(this,"_cornerControllers",[]);g(this,"_cornerCoords",[]);g(this,"_originalCornerCoords",[]);g(this,"_originalAllCornerEqual",!1);g(this,"_arcCoords",[]);g(this,"_arcFillCoords",[]);g(this,"_originalArcCoords",[]);g(this,"_originalArcFillCoords",[])}get cornersModifyEnable(){return!0}get cornerEnable(){return!0}get cornerControllers(){return this._cornerControllers}get normalizeCorners(){return this._normalizeCorners()}get cornerCoords(){return this._cornerCoords}get visualCorners(){return this.normalizeCorners.map(e=>this._getCorner(e))}get editingEnable(){return!1}get controllers(){const e=super.controllers;return this.cornerEnable&&e.push(...this.cornerControllers),e}get isAllCornerEqual(){return R.uniq(this.model.corners).length===1}get arcCoords(){return this._arcCoords}get arcFillCoords(){return this._arcFillCoords}calcArcCoords(){return this.model.styles.strokes.map(e=>this._getArcVerticalCoords(e))}calcArcFillCoords(){const e=this.innermostStrokeCoordIndex;let s=this.model.styles.strokes[e],{width:r,type:n}=s;switch(n){case U.inside:{r=r*2;break}case U.middle:{r=r;break}case U.outside:{r=0;break}}return s={...s,type:U.inside,width:r},this._getArcVerticalCoords(s)}_getArcBoxCoords(e){const{type:s,width:r}=e;let n=this.calcUnLeanBoxCoords();const{width:o,height:a}=v.calcRectangleSize(n);let l=1,h=1;switch(s){case U.outside:{l=(o+r)/o,h=(a+r)/a;break}case U.inside:{l=(o-r)/o,h=(a-r)/a;break}}return[U.inside,U.outside].includes(s)&&(n=c.batchScaleWithCenter(n,{sx:l,sy:h},this.centerCoord)),n}_getArcCorner(e,s){let r=this.normalizeCorners;const{type:n,width:o}=s,{width:a,height:l}=c.calcParallelogramVerticalSize(e),h=Math.min(a,l);return r=r.map(d=>{if(d===0)return d;switch(n){case U.inside:return R.clamp(d-o/2,0,h/2);case U.outside:return R.clamp(d+o/2,0,h/2);default:return d}}),r}_getVerticalIntersection(e,s){return{coords:c.calcParallelogramVerticalIntersectionPoints(e,s,!0),indexes:[[0,1],[1,2],[2,3],[3,0]]}}_getCrossPointsOfParallelLines(e,s){return{coords:c.calcCrossPointsOfParallelLines(e,s),indexes:[[3,0],[0,1],[1,2],[2,3]]}}_getArcVerticalCoords(e){let s=this.calcUnLeanBoxCoords();s=this._getArcBoxCoords(e);const r=this._getArcCorner(s,e),n=[];return R.range(4).forEach(o=>{const a=s[o],l=r[o],h=this.calcUnLeanCornerCoordBy(a,o,l);let d=s[o],u,f;if(!l)u=s[o],f=s[o];else{const{coords:p,indexes:m}=this._getVerticalIntersection(h,s);u=p[m[o][0]],f=p[m[o][1]],u||(u=s[o]),f||(f=s[o])}n.push({start:u,controller:d,end:f,value:l,corner:h})}),n}calcUnLeanCornerCoord(e,s){const r=s?this.normalizeCorners[e]:this.visualCorners[e],n=c.leanWithCenter(this.model.boxCoords[e],this.model.leanXAngle,-this.model.leanYAngle,this.centerCoord);return this.calcUnLeanCornerCoordBy(n,e,r)}calcUnLeanCornerCoordBy(e,s,r){if(r===0)return e;let n,o;return[0,3].includes(s)?n=this.flipX?-r:r:n=this.flipX?r:-r,[0,1].includes(s)?o=r:o=-r,c.translate(e,{x:n,y:o})}calcCornerCoord(e,s){const r=this._rotateBoxCoords[e],n=this.visualCorners[e];let o=this.calcUnLeanCornerCoord(e,s);o=c.transWithCenter(o,this.angles,this.centerCoord);const{coords:a,indexes:l}=this._getCrossPointsOfParallelLines(o,this._rotateBoxCoords);let h=a[l[e][0]],d=a[l[e][1]];if(!h||!d)return r;let u=c.calcTriangleAngleWithClockwise(h,r,d);const f=this.flipX;f&&(u=180-u);const p=c.calcAngle(r,d)+(f?-u/2:u/2),m=this._getCornerTargetCoord(e,this._rotateBoxCoords),y=c.calcDistance(r,m)*2,w=n/this.minParallelogramVerticalSize,D=y*w;return c.calcTargetPoint(r,D,p)}refreshCornersController(e){if(this._cornerCoords.length===0)return;const{x:s,y:r}=this._cornerCoords[e],n=this.getController4BoxCoords(this._cornerCoords[e]);this._cornerControllers[e]?(this._cornerControllers[e].x=s,this._cornerControllers[e].y=r,this._cornerControllers[e].points=n):this._cornerControllers[e]=new wt(this,{x:s,y:r,points:n})}refreshCornerCoords(e){!this._rotateBoxCoords||!this._rotateBoxCoords.length||(this._cornerCoords[e]=this.calcCornerCoord(e))}refreshCornersCoords(e){e=e||[0,1,2,3],e.forEach(s=>{this.refreshCornerCoords(s)})}refreshCornersControllers(e){e=e||[0,1,2,3],e.forEach(s=>{this.refreshCornersController(s)})}_refreshCorners(){this.status===Q.finished&&(this.refreshCornersCoords(),this.refreshCornersControllers())}refreshCorners(){super.refreshCorners(),this.isInMultiSelected||this._refreshCorners()}refreshStrokePoints(){super.refreshStrokePoints(),this._arcCoords=this.calcArcCoords(),this._arcFillCoords=this.calcArcFillCoords()}_getCorner(e){return this._isCornerMoving?e:e===0?this.minParallelogramVerticalSize/2*.2:e}refreshOriginalElementProps(){super.refreshOriginalElementProps(),this._originalCornerCoords=H.jsonClone(this._cornerCoords),this._originalAllCornerEqual=this.isAllCornerEqual}refreshOriginalStrokes(){super.refreshOriginalStrokes(),this._originalArcCoords=H.jsonClone(this._arcCoords),this._originalArcFillCoords=H.jsonClone(this._arcFillCoords)}_getCornerTargetCoord(e,s){let r,[n,o]=c.calculateAngleBisectorIntersection(s);const{width:a,height:l}=c.calcParallelogramVerticalSize(s);return a<=l?[0,1].includes(e)?r=n:r=o:[0,3].includes(e)?r=n:r=o,r}updateCornerByOffset(e){const s=this.getActiveController();if(s instanceof wt){const r=this.cornerControllers.indexOf(s);if(r!==-1){const n=this._getCornerTargetCoord(r,this._rotateBoxCoords),o=this._originalCornerCoords[r],a={x:e.x+o.x,y:e.y+o.y},l=this._rotateBoxCoords[r],h=c.calcProjectionOnSegment(a,n,l);let d=c.calcSegmentProportion(h,n,l);d=R.clamp(d,0,1),d=1-d;let u=d*(this.minParallelogramVerticalSize/2);this._originalAllCornerEqual?this.setCorners(u):this.setCorners(u,r)}}}_normalizeCorners(){const e=[...this.model.corners];return R.every(e,s=>s===0)?e:P.fixCornersBasedOnMinSize(e,this.minParallelogramVerticalSize)}_translateArc(e){this._arcCoords=c.batchTranslateArcPoints(this._originalArcCoords,e),this._arcFillCoords=c.translateArcPoints(this._originalArcFillCoords,e)}translateBy(e){this._translateArc(e),super.translateBy(e)}_setIsSelected(e){super._setIsSelected(e),e&&this._refreshCorners()}}class Ti extends Ke{constructor(){super(...arguments);g(this,"_outerCoords",[]);g(this,"_originalOuterCoords",[])}get editingEnable(){return!1}get flipXEnable(){return!1}get flipYEnable(){return!1}get coordTransformEnable(){return!0}get boxVerticesTransformEnable(){return!1}get heightModifyEnable(){return!1}get rotationEnable(){return!1}get borderTransformEnable(){return!1}get fillEnabled(){return!1}get ratioLockedEnable(){return!1}get viewAngleCalcEnable(){return!1}get leanYAngleCalcEnable(){return!1}get leanYAngleModifyEnable(){return!1}get startRotateCoord(){return this._rotateCoords[0]}get endRotateCoord(){return this._rotateCoords[1]}get outerCoords(){return this._outerCoords}get transformerType(){return Ne.circle}get alignOutlineCoords(){return this._outerCoords}refreshBentOutline(){this._outerCoords=this.calcOuterCoords(),this._maxOutlineBoxCoords=v.getBoxPoints(this._outerCoords.flat())}refreshPoints(){super.refreshPoints(),this.refreshBentOutline()}calcOuterCoords(){return this.model.styles.strokes.map(e=>Ee.calcBentLineOuterVertices(this._rotateCoords,e.width/2))}refreshOutlinePoints(){super.refreshOutlinePoints(),this.refreshBentOutline()}getAngle(){return this.startRotateCoord&&this.endRotateCoord?P.fixAngle(c.calcAngle(this.startRotateCoord,this.endRotateCoord)+90):0}isContainsCoord(e){return R.some(this.model.styles.strokes,s=>c.isPointClosestSegment(e,this.startRotateCoord,this.endRotateCoord,kn+s.width/2/this.shield.stageScale))}isPolygonOverlap(e){return R.some(this._outerCoords,s=>c.isPolygonsOverlap(s,e))}isModelPolygonOverlap(e){return R.some(this._outerCoords,s=>c.isPolygonsOverlap(s,e))}doVerticesTransform(e){const s=this._transformers.findIndex(r=>r.isActive);if(s!==-1){const r=this._originalTransformerCoords[v.getNextIndexOfArray(2,s,1)],n=this._originalTransformerCoords[s];this.transformByLockPoint(r,n,e,s)}}setWidth(e){const s=c.calcTargetPoint(this.startRotateCoord,e,this.angle-90);return this.model.coords=[this.startRotateCoord,s],this.model.boxCoords=v.getBoxPoints(this.model.coords),this.model.width=e,this.model.angle=0,[[]]}setAngle(e){const s=c.calcTargetPoint(this.startRotateCoord,this.model.width,e-90);this.model.coords=[this.startRotateCoord,s],this.model.boxCoords=v.getBoxPoints(this.model.coords),this.model.angle=0}translateBy(e){this._outerCoords=this._originalOuterCoords.map(s=>c.batchTranslate(s,e)),super.translateBy(e)}refreshOriginalStrokes(){super.refreshOriginalStrokes(),this._originalOuterCoords=H.jsonClone(this._outerCoords)}}class ki extends Te{async run(){if(!this.canvas||!this.element)return;const{strokeCoords:t,model:{styles:e}}=this.element;P.batchCalcStageRelativePoints(t).forEach((r,n)=>{F.drawPathWithScale(this.canvas,r,e,e.fills[0],e.strokes[n])})}}class Ms extends ms{get fillEnabled(){return!1}async toJson(){const t=await super.toJson(),e=this.model.data,s=await F.getDataUrlFromImage(e);return t.data=s,t}}class Oi extends Te{async run(){if(!this.canvas||!this.element)return;const{arcCoords:t,arcFillCoords:e,model:{styles:s},angle:r,flipX:n,leanY:o,actualAngle:a}=this.element,l=P.batchCalcStageRelativeArcPoints(t),h=P.calcStageRelativeArcPoints(e),d={angle:r,flipX:n,leanY:o,actualAngle:a},u=be.calcElementRenderRect(this.element);F.drawImgLike(this.canvas,this.element.model.data,u,{...d,clipArcPoints:h}),l.forEach((f,p)=>{F.drawArcPathStrokeWidthScale(this.canvas,f,u,s.strokes[p],d)})}}class Li extends Te{async run(){if(!this.canvas||!this.element)return;let{innermostStrokeCoordIndex:t,strokeCoords:e,model:{styles:s,isFold:r}}=this.element;const n=P.batchCalcStageRelativePoints(e);r&&s.fills.forEach(o=>{F.drawInnerPathFillWithScale(this.canvas,n[t],o,s.strokes[t])}),n.forEach((o,a)=>{F.drawPathStrokeWidthScale(this.canvas,o,s.strokes[a],{isFold:r,miterLimit:Xn})})}}class Ii extends Ke{constructor(e,s){super(e,s);g(this,"tailCoordIndex");g(this,"editingCoordIndex");g(this,"_outerWorldPaths",[]);g(this,"_originalOuterWorldPaths",[]);this.tailCoordIndex=-1}get transformerType(){return Ne.circle}get coordTransformEnable(){return this.status!==Q.finished}get activeCoordIndex(){return[Q.startCreating,Q.creating,Q.initialed].includes(this.status)?this.model.coords.length>this.tailCoordIndex+1?this.tailCoordIndex+1:this.tailCoordIndex:-1}get outerWorldPaths(){return this._outerWorldPaths}get tfRefreshAfterEdChanged(){return!0}_setStatus(e){super._setStatus(e),e===Q.finished&&(this.tailCoordIndex=-1)}calcOuterWorldPaths(){return this._strokeCoords.map((e,s)=>P.calcArbitraryBorderRegions(e,this.model.styles.strokes[s],this.model.isFold))}refreshOutlinePoints(){this._outerWorldPaths=this.calcOuterWorldPaths(),super.refreshOutlinePoints()}refreshOriginalStrokes(){super.refreshOriginalStrokes(),this._originalOuterWorldPaths=H.jsonClone(this._outerWorldPaths)}isContainsCoord(e){let s;return this.visualStrokeWidth<Ts?s=this._strokeCoords.map(r=>P.calcArbitraryBorderRegions(r,{width:Ts/this.shield.stageScale},this.model.isFold)):s=this._outerWorldPaths,R.some(s,r=>R.some(r,n=>c.isPointInPolygonByRayCasting(e,n)))}isPolygonOverlap(e){return R.some(this._outerWorldPaths,s=>R.some(s,r=>c.isPolygonsOverlap(r,e)))}isModelPolygonOverlap(e){return R.some(this._outerWorldPaths,s=>R.some(s,r=>c.isPolygonsOverlap(r,e)))}calcRotateOutlineCoords(){return this._outerWorldPaths.flat()}activeEditingCoord(e){this.editingCoordIndex=e}deActiveEditingCoord(){this.editingCoordIndex=-1}setControllersActive(e,s){super.setControllersActive(e,s),e.forEach(r=>{if(r instanceof Xe){const n=this._transformers.findIndex(o=>o.id===r.id);if(n===-1)return;s?this.activeEditingCoord(n):this.deActiveEditingCoord()}})}doVerticesTransform(e){this.status===Q.editing?this.doEditingTransform(e):super.doVerticesTransform(e)}doEditingTransform(e){if(this.editingCoordIndex!==-1){const s=H.jsonClone(this._originalRotateCoords);s[this.editingCoordIndex]={x:s[this.editingCoordIndex].x+e.x,y:s[this.editingCoordIndex].y+e.y};const r=this._originalRotateBoxCoords[0];this.model.coords=c.batchPrecisePoint(P.calcCoordsByTransPoints(s,this.angles,r),1);let n=c.batchPrecisePoint(c.batchLeanWithCenter(v.getBoxPoints(c.calcUnLeanByPoints(this.model.coords,0,this.model.leanYAngle)),0,this.model.leanYAngle,this.calcCenterCoord()),1);this._flipX&&(n=c.batchCalcSymmetryPoints(n,c.calcPolygonCentroid([n[0],n[1]]),c.calcPolygonCentroid([n[2],n[3]]))),this.model.boxCoords=n}}_translateOuterCoords(e){this._outerWorldPaths=this._originalOuterWorldPaths.map((s,r)=>s.map(n=>n.map(o=>c.translate(o,e))))}translateBy(e){this._translateOuterCoords(e),super.translateBy(e)}}class ps extends Ke{get subs(){return this.getSubs()}get deepSubs(){return this.getDeepSubs()}get strokeEnable(){return!1}get fillEnabled(){return!1}get editingEnable(){return!1}get alignOutlineCoords(){return[v.getBoxPoints(this.subs.map(t=>t.alignOutlineCoords.flat()).flat())]}addSub(t){this.model.subIds.push(t.id)}removeSub(t){const e=this.model.subIds.indexOf(t.id);e!==-1&&this.model.subIds.splice(e,1)}removeSubById(t){const e=this.model.subIds.indexOf(t);e!==-1&&this.model.subIds.splice(e,1)}hasSub(t){var e;return(e=this.model.subIds)==null?void 0:e.includes(t.id)}hasSubById(t){var e;return(e=this.model.subIds)==null?void 0:e.includes(t)}getSubs(){return this.shield.store.getElementsByIds(this.model.subIds)}getDeepSubs(){const t=[];return this._getDeepSubs(t,this.getSubs()),t}_getDeepSubs(t,e){return e.forEach(s=>{t.push(s),s.isGroup&&this._getDeepSubs(t,s.subs)}),t}getSubElementsByType(t){return this.getSubs().filter(e=>e.isElement&&e.model.type===t)}getAllSubElements(){return this.getSubs().filter(t=>t.isElement)}getAllSubElementGroups(){return this.getSubs().filter(t=>t.isGroup)}clearSubs(){this.model.subIds=[]}isContainsCoord(t){return this.deepSubs.some(e=>e.isContainsCoord(t))}isPolygonOverlap(t){return this.deepSubs.some(e=>e.isPolygonOverlap(t))}isModelPolygonOverlap(t){return this.deepSubs.some(e=>e.isModelPolygonOverlap(t))}_setIsSelected(t){super._setIsSelected(t),this.deepSubs.forEach(e=>{e.isSelected=t})}calcRotateOutlineCoords(){return[this._rotateCoords]}}class Cs extends ms{constructor(){super(...arguments);g(this,"_textCursor");g(this,"_textSelection")}get editingEnable(){return!0}get textCursor(){return this._textCursor}get textSelection(){return this._textSelection}get isSelectionAvailable(){return!!this._textSelection&&R.every(this._textSelection,e=>!!e)}get transformersEnable(){return this.status===Q.finished}get cornerEnable(){return this.status===Q.finished}_setIsEditing(e){super._setIsEditing(e),this._textCursor=null,this._textSelection=null}onStageChanged(){if(super.onStageChanged(),this._textCursor){const e=be.getUpdatedTextCursorProps(this.model.data,this._textCursor);Object.assign(this._textCursor,e),this._textCursor.renderRect=be.calcElementRenderRect(this)}}retrieveTextCursor(e,s){if(!this.isContainsCoord(e)){this._textCursor=null,this._textSelection=null;return}e=c.transWithCenter(e,this.angles,this.centerCoord,!0);const r=P.calcStageRelativePoint(e),n=be.calcElementRenderRect(this),o=be.retrieveTextCursorAtPosition(this.model.data,v.scalePoint(r,this.shield.stageScale),n);s?this._textSelection.endNode=o:(this._textCursor=o,this._textSelection={startNode:o,endNode:null})}}class Bi extends Te{async run(){if(!this.canvas||!this.element)return;const{innermostStrokeCoordIndex:t,unLeanStrokeCoords:e,model:{styles:s,styles:{strokes:r}},center:n,angle:o,flipX:a,leanY:l,actualAngle:h}=this.element,d={angle:o,flipX:a,leanY:l,actualAngle:h},u=P.batchCalcStageRelativePoints(e),f=u[t],p=v.getRect(f);s.fills.forEach(m=>{F.drawEllipseFillWithScale(this.canvas,n,{rx:p.width/2,ry:p.height/2},m,p,d)}),u.forEach((m,y)=>{const w=v.getRect(m);F.drawEllipseStrokeWithScale(this.canvas,n,{rx:w.width/2,ry:w.height/2},r[y],w,d)})}}class Mi extends Ke{get editingEnable(){return!1}}class ss{static createImageFromImageData(t){const e=F.getCanvasByImageData(t),s=new Image;return s.src=e.toDataURL(),s}static waitForImageLoad(t){return new Promise((e,s)=>{t.onload=()=>{e(t)},t.onerror=()=>{s(new Error("Image load failed"))}})}static async createImageFromUrl(t){const e=new Image;return e.src=t,await this.waitForImageLoad(e),e}}let Fi=class extends Te{async run(){if(!this.canvas||!this.element)return;be.draw(this.element,this.canvas);const{model:{styles:{fontSize:t,fontFamily:e,textAlign:s,textBaseline:r,fontColor:n,fontColorOpacity:o,fontLineHeight:a},data:l},angle:h,flipX:d,leanY:u,actualAngle:f,unLeanBoxCoords:p}=this.element,m={angle:h,flipX:d,leanY:u,actualAngle:f},y=P.calcStageRelativePoints(p),w=be.calcElementRenderRect(this.element);F.drawRotateTextWithScale(this.canvas,l,y,w,{fontSize:t,fontFamily:e,textAlign:s,textBaseline:r,fontColor:n,fontColorOpacity:o,fontLineHeight:a},m)}};var de=(i=>(i.isSelected="isSelected",i.isVisible="isVisible",i.isLocked="isLocked",i.isEditing="isEditing",i.isMoving="isMoving",i.isTransforming="isTransforming",i.isRotating="isRotating",i.isRotatingTarget="isRotatingTarget",i.isDragging="isDragging",i.isProvisional="isProvisional",i.isTarget="isTarget",i.isInRange="isInRange",i.isOnStage="isOnStage",i.status="status",i.isRatioLocked="isRatioLocked",i))(de||{}),Oe=(i=>(i[i.added=0]="added",i[i.removed=1]="removed",i))(Oe||{});class P{static createElementTask(t,e){let s;switch(t.model.type){case A.rectangle:s=new Un(t,e);break;case A.image:{s=new Oi(t,e);break}case A.line:{s=new ki(t,e);break}case A.ellipse:{s=new Bi(t,e);break}case A.arbitrary:{s=new Li(t,e);break}case A.text:{s=new Fi(t,e);break}}return s}static calcStageRelativePoints(t){return t.map(e=>P.calcStageRelativePoint(e))}static batchCalcStageRelativePoints(t){return t.map(e=>P.calcStageRelativePoints(e))}static calcStageRelativePoint(t){const{rect:{width:e,height:s},scale:r,worldCoord:{x:n,y:o}}=window.shield.stageCalcParams;return{x:t.x+e/2/r-n,y:t.y+s/2/r-o}}static calcWorldCoords(t){return t.map(e=>P.calcWorldCoord(e))}static calcWorldCoord(t){const{rect:{width:e,height:s},scale:r,worldCoord:{x:n,y:o}}=window.shield.stageCalcParams;return{x:t.x-e/2/r+n,y:t.y-s/2/r+o}}static calcCreatorPoints(t,e){switch(e){case A.rectangle:case A.image:case A.arbitrary:case A.text:case A.ellipse:case A.group:return v.getBoxPoints(t);default:return t}}static createElement(t,e){const{type:s}=t;switch(s){case A.rectangle:return new ms(t,e);case A.line:return new Ti(t,e);case A.ellipse:return new Mi(t,e);case A.image:return new Ms(t,e);case A.arbitrary:return new Ii(t,e);case A.text:return new Cs(t,e);case A.group:return new ps(t,e);case A.image:return new Ms(t,e);default:return new Ke(t,e)}}static getTopAElementByCoord(t,e){for(let s=t.length-1;s>=0;s--){const r=t[s];if(r.isContainsCoord(e))return r}}static calcElementRotatePoint(t){const{centerCoord:e,rotation:{angle:s,scale:r},model:{height:n}}=t;return c.calcTargetPoint(e,n/2+ci*r,s)}static calcPosition(t){switch(t.type){case A.rectangle:case A.image:case A.line:case A.ellipse:case A.arbitrary:case A.text:case A.group:return c.calcCenter(t.coords)}}static calcSize(t){const{coords:e,boxCoords:s,type:r}=t;switch(r){case A.rectangle:case A.text:case A.group:case A.image:case A.ellipse:case A.arbitrary:return v.calcRectangleSize(s);case A.line:return{width:c.precise(c.calcDistance(e[0],e[1]),2),height:0}}}static fixAngle(t){return t>180&&(t=t-360),t}static calcOutlinePoints(t,e,s,r){if(s&&e!==U.inside){let n=s/2;e===U.outside&&(n=s);const{flipX:o,flipY:a}=r;return o!==a?Se.getArbitraryInnerVertices(t,n,r):Se.getArbitraryOuterVertices(t,n,r)}return t}static calcNoFoldArbitraryBorderRegions(t,e){const{width:s}=e,r=[];return t.forEach((n,o)=>{if(o<t.length-1){const a=t[o+1];if(r.push(Ee.calcBentLineOuterVertices([n,a],s/2)),o!==0){const l=t[o-1];r.push(P.calc3PArbitraryBorderRegions(l,n,a,e))}}}),r}static calcFoldArbitraryBorderRegions(t,e){const{width:s}=e,r=[];return t.forEach((n,o)=>{const a=v.getPrevOfArray(t,o),l=v.getNextOfArray(t,o);r.push(Ee.calcBentLineOuterVertices([n,l],s/2)),r.push(P.calc3PArbitraryBorderRegions(a,n,l,e))}),r}static calcArbitraryBorderRegions(t,e,s){return s?P.calcFoldArbitraryBorderRegions(t,e):P.calcNoFoldArbitraryBorderRegions(t,e)}static calc3PArbitraryBorderRegions(t,e,s,r){const{width:n}=r,o=c.isPointClockwiseOfLine(s,t,e),l=(180-c.calcTriangleAngle(t,e,s))/2,h=c.calcAngle(t,e),d=c.calcTriangleSide3By2(l,n/2),u=c.calcTargetPoint(e,d,h+(o?-l:l)),f=[];return f.push(e),f.push(c.calcTargetPoint(e,n/2,h-90)),f.push(u),f.push(c.calcTargetPoint(e,n/2,c.calcAngle(s,e)+90)),f}static calcCoordsByTransPoints(t,e,s){const r=c.calcCenter(t.map(o=>c.transWithCenter(o,e,s,!0))),n=c.transWithCenter(r,e,s);return t.map(o=>c.rotateWithCenter(o,-e.angle,n))}static calcCoordsByRotatePoints(t,e,s){let r=c.calcCenter(t.map(o=>c.rotateWithCenter(o,-e,s)));const n=c.rotateWithCenter(r,e,s);return t.map(o=>c.rotateWithCenter(o,-e,n))}static normalizeMatrixPoint(t,e,s,r){t=c.transWithCenter(t,r,s,!0);const[n,o]=c.multiply(e,[t.x-s.x,t.y-s.y,1]);return{x:n+s.x,y:o+s.y}}static calcMatrixPoint(t,e,s,r){const n=P.normalizeMatrixPoint(t,e,s,r);return c.transWithCenter(n,r,s)}static calcMatrixPoints(t,e,s,r){return t.map(n=>P.calcMatrixPoint(n,e,s,r))}static isSameAncestorGroup(t){return t.length<=1?!0:P.getAncestorGroup(t)!==null}static getAncestorGroup(t){if(t.length===0)return null;const e=P.getNoParentElements(t);return e.length>1?null:e[0]}static getNoParentElements(t){return t.filter(e=>!e.isGroupSubject)}static createEmptyGroupObject(){return{...P.createEmptyObject(),type:A.group}}static createEmptyObject(){return{id:`${v.getDateId()}`,subIds:[],coords:[],boxCoords:[],width:0,height:0,styles:{strokes:[]},x:0,y:0,...ds,...ot}}static fixCornersBasedOnMinSize(t,e){return R.range(4).forEach(s=>{t[s]!==0&&(t[s]=R.clamp(t[s],0,e/2))}),t}static convertElementsJson(t){const e=t,s=new Map,r=[],n=v.getDateId();return e.forEach((o,a)=>{s.set(o.id,o),r.push(n+a)}),e.forEach((o,a)=>{P.reBindGroup(o,s,`${r[a]}`),P.divateCoords(o,40)}),e}static reBindGroup(t,e,s){const{subIds:r,groupId:n,id:o}=t;if(t.id=s,e.set(s,t),e.delete(o),r&&r.forEach(a=>{const l=e.get(a);l&&(l.groupId=s)}),n){const a=e.get(n);if(a){const l=a.subIds.indexOf(o);if(l===-1)return;a.subIds.splice(l,1,s)}}}static divateCoords(t,e){const{coords:s,boxCoords:r}=t;return t.x+=e,t.y+=e,t.coords=c.batchTranslate(s,{x:e,y:e}),t.boxCoords=c.batchTranslate(r,{x:e,y:e}),t}static async convertElementModel(t){const{type:e,data:s}=t;switch(e){case A.image:t.data=await ss.createImageFromUrl(s)}return t}static calcStageRelativeArcPoint(t){let{start:e,end:s,controller:r,corner:n,value:o}=t;return[e,s,r,n]=P.calcStageRelativePoints([e,s,r,n]),{start:e,end:s,controller:r,corner:n,value:o}}static calcStageRelativeArcPoints(t){return t.map(e=>P.calcStageRelativeArcPoint(e))}static batchCalcStageRelativeArcPoints(t){return t.map(e=>P.calcStageRelativeArcPoints(e))}}var ft={exports:{}},Fs;function Di(){if(Fs)return ft.exports;Fs=1;var i=typeof Reflect=="object"?Reflect:null,t=i&&typeof i.apply=="function"?i.apply:function(E,S,L){return Function.prototype.apply.call(E,S,L)},e;i&&typeof i.ownKeys=="function"?e=i.ownKeys:Object.getOwnPropertySymbols?e=function(E){return Object.getOwnPropertyNames(E).concat(Object.getOwnPropertySymbols(E))}:e=function(E){return Object.getOwnPropertyNames(E)};function s(_){console&&console.warn&&console.warn(_)}var r=Number.isNaN||function(E){return E!==E};function n(){n.init.call(this)}ft.exports=n,ft.exports.once=D,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var o=10;function a(_){if(typeof _!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof _)}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(_){if(typeof _!="number"||_<0||r(_))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+_+".");o=_}}),n.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(E){if(typeof E!="number"||E<0||r(E))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+E+".");return this._maxListeners=E,this};function l(_){return _._maxListeners===void 0?n.defaultMaxListeners:_._maxListeners}n.prototype.getMaxListeners=function(){return l(this)},n.prototype.emit=function(E){for(var S=[],L=1;L<arguments.length;L++)S.push(arguments[L]);var I=E==="error",j=this._events;if(j!==void 0)I=I&&j.error===void 0;else if(!I)return!1;if(I){var z;if(S.length>0&&(z=S[0]),z instanceof Error)throw z;var se=new Error("Unhandled error."+(z?" ("+z.message+")":""));throw se.context=z,se}var Ae=j[E];if(Ae===void 0)return!1;if(typeof Ae=="function")t(Ae,this,S);else for(var ut=Ae.length,Vt=m(Ae,ut),L=0;L<ut;++L)t(Vt[L],this,S);return!0};function h(_,E,S,L){var I,j,z;if(a(S),j=_._events,j===void 0?(j=_._events=Object.create(null),_._eventsCount=0):(j.newListener!==void 0&&(_.emit("newListener",E,S.listener?S.listener:S),j=_._events),z=j[E]),z===void 0)z=j[E]=S,++_._eventsCount;else if(typeof z=="function"?z=j[E]=L?[S,z]:[z,S]:L?z.unshift(S):z.push(S),I=l(_),I>0&&z.length>I&&!z.warned){z.warned=!0;var se=new Error("Possible EventEmitter memory leak detected. "+z.length+" "+String(E)+" listeners added. Use emitter.setMaxListeners() to increase limit");se.name="MaxListenersExceededWarning",se.emitter=_,se.type=E,se.count=z.length,s(se)}return _}n.prototype.addListener=function(E,S){return h(this,E,S,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(E,S){return h(this,E,S,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(_,E,S){var L={fired:!1,wrapFn:void 0,target:_,type:E,listener:S},I=d.bind(L);return I.listener=S,L.wrapFn=I,I}n.prototype.once=function(E,S){return a(S),this.on(E,u(this,E,S)),this},n.prototype.prependOnceListener=function(E,S){return a(S),this.prependListener(E,u(this,E,S)),this},n.prototype.removeListener=function(E,S){var L,I,j,z,se;if(a(S),I=this._events,I===void 0)return this;if(L=I[E],L===void 0)return this;if(L===S||L.listener===S)--this._eventsCount===0?this._events=Object.create(null):(delete I[E],I.removeListener&&this.emit("removeListener",E,L.listener||S));else if(typeof L!="function"){for(j=-1,z=L.length-1;z>=0;z--)if(L[z]===S||L[z].listener===S){se=L[z].listener,j=z;break}if(j<0)return this;j===0?L.shift():y(L,j),L.length===1&&(I[E]=L[0]),I.removeListener!==void 0&&this.emit("removeListener",E,se||S)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(E){var S,L,I;if(L=this._events,L===void 0)return this;if(L.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):L[E]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete L[E]),this;if(arguments.length===0){var j=Object.keys(L),z;for(I=0;I<j.length;++I)z=j[I],z!=="removeListener"&&this.removeAllListeners(z);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(S=L[E],typeof S=="function")this.removeListener(E,S);else if(S!==void 0)for(I=S.length-1;I>=0;I--)this.removeListener(E,S[I]);return this};function f(_,E,S){var L=_._events;if(L===void 0)return[];var I=L[E];return I===void 0?[]:typeof I=="function"?S?[I.listener||I]:[I]:S?w(I):m(I,I.length)}n.prototype.listeners=function(E){return f(this,E,!0)},n.prototype.rawListeners=function(E){return f(this,E,!1)},n.listenerCount=function(_,E){return typeof _.listenerCount=="function"?_.listenerCount(E):p.call(_,E)},n.prototype.listenerCount=p;function p(_){var E=this._events;if(E!==void 0){var S=E[_];if(typeof S=="function")return 1;if(S!==void 0)return S.length}return 0}n.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};function m(_,E){for(var S=new Array(E),L=0;L<E;++L)S[L]=_[L];return S}function y(_,E){for(;E+1<_.length;E++)_[E]=_[E+1];_.pop()}function w(_){for(var E=new Array(_.length),S=0;S<E.length;++S)E[S]=_[S].listener||_[S];return E}function D(_,E){return new Promise(function(S,L){function I(z){_.removeListener(E,j),L(z)}function j(){typeof _.removeListener=="function"&&_.removeListener("error",I),S([].slice.call(arguments))}$(_,E,j,{once:!0}),E!=="error"&&M(_,I,{once:!0})})}function M(_,E,S){typeof _.on=="function"&&$(_,"error",E,S)}function $(_,E,S,L){if(typeof _.on=="function")L.once?_.once(E,S):_.on(E,S);else if(typeof _.addEventListener=="function")_.addEventListener(E,function I(j){L.once&&_.removeEventListener(E,I),S(j)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof _)}return ft.exports}var ys=Di();class Wi extends ys.EventEmitter{constructor(e){super();g(this,"nodes");g(this,"_head");g(this,"_tail");g(this,"_eqFunc",(e,s)=>e===s);this.nodes=new Set,this._head=null,this._tail=null,this._eqFunc=e}get head(){return this._head}get tail(){return this._tail}get length(){return this.nodes.size}insert(e){this._tail?this.insertAfter(e,this._tail):(this._tail=e,this.nodes.add(e)),this._head||(this._head=e)}prepend(e){this._head?this.insertBefore(e,this._head):(this._head=e,this.nodes.add(e)),this._tail||(this._tail=e)}remove(e,s){this.nodes.delete(e);const r=e.prev,n=e.next;r&&(r.next=n),n&&(n.prev=r),e.prev=null,e.next=null,this._eqFunc(e,this._tail)&&(this._tail=r),this._eqFunc(e,this._head)&&(this._head=n)}removeBy(e,s){let r=[];return Array.from(this.nodes).forEach(n=>{e(n)&&(this.remove(n,s),r.push(n))}),r}insertBefore(e,s){s&&(s.insertBefore(e),this.nodes.add(e),e.isHead&&(this._head=e))}insertAfter(e,s){s&&(s.insertAfter(e),this.nodes.add(e),e.isTail&&(this._tail=e))}forEach(e){this.forEachBreak(e,()=>!1)}forEachBreak(e,s){let r=0,n=this._head;for(;n;){if(s&&s(n,r))return;e(n,r),n=n.next,r++}}forEachRevert(e){this.forEachBreakRevert(e,()=>!1)}forEachBreakRevert(e,s){let r=this.length-1,n=this._tail;for(;n;){if(s&&s(n,r))return;e(n,r),n=n.prev,r--}}getIndex(e){let s=-1,r=this._head;for(;r;){if(s++,this._eqFunc(r,e))return s;r=r.next}return s}filter(e){const s=[];return this.forEach(r=>{e(r)&&s.push(r)}),s}}const Ds=(i,t)=>i.value&&t.value&&i.value.id===t.value.id;class Ht extends Wi{constructor(){super(Ds)}_addElementObserve(t){Object.keys(de).forEach(e=>{Pe(()=>t.value[e],()=>{this.emit(e,t.value,t.value[e])})})}insert(t,e=!0){Ve(()=>{this._addElementObserve(t),super.insert(t),e&&this.emit(Oe.added,t)})}insertBefore(t,e,s=!0){Ve(()=>{this._addElementObserve(t),super.insertBefore(t,e),s&&this.emit(Oe.added,t)})}insertAfter(t,e,s=!0){Ve(()=>{this._addElementObserve(t),super.insertAfter(t,e),s&&this.emit(Oe.added,t)})}prepend(t,e=!0){Ve(()=>{this._addElementObserve(t),super.prepend(t),e&&this.emit(Oe.added,t)})}remove(t,e=!0){Ve(()=>{super.remove(t),e&&this.emit(Oe.removed,t)})}removeBy(t,e=!0){let s=[];return Ve(()=>{s=super.removeBy(t,e)}),s}static isConsecutive(t){if(t.length<2)return!0;let e=t[0],s=1;for(;e.next&&Ds(e.next,t[s]);)if(e=e.next,s++,s===t.length)break;return s===t.length}}class Ni{static createTextData(t,e){e=R.pick(e,["fontFamily","fontSize","fontColor","fontColorOpacity"]);const s=[];return t.split(`
`).forEach(r=>{const n=r.split("").map(o=>({content:o,id:je(),fontStyle:e}));s.push({nodes:n})}),{lines:s}}}class zi{constructor(t){g(this,"shield");g(this,"_elementList",new Ht);g(this,"_currentCreatingElementId");g(this,"_elementsMap",new Map);g(this,"_provisionalElements",[]);g(this,"_selectedElements",[]);g(this,"_targetElements",[]);g(this,"_rangeElements",[]);g(this,"_visibleElements",[]);g(this,"_stageElements",[]);g(this,"_editingElements",[]);g(this,"_rotatingTargetElements",[]);g(this,"_provisionalElementIds",J.set(new Set));g(this,"_selectedElementIds",J.set(new Set));g(this,"_targetElementIds",J.set(new Set));g(this,"_visibleElementIds",J.set(new Set));g(this,"_rangeElementIds",J.set(new Set));g(this,"_stageElementIds",J.set(new Set));g(this,"_editingElementIds",J.set(new Set));g(this,"_rotatingTargetElementIds",J.set(new Set));g(this,"_rotatingCenter");g(this,"_rotatingCenterCoord");g(this,"_rotatingOriginalAngle");g(this,"_isMultiSelected",!1);g(this,"_noParentElements",[]);g(this,"_selectedAncestorElement");g(this,"_primarySelectedElement");this.shield=t,this._reactionElementAdded(),this._reactionElementRemoved(),this._reactionElementsPropsChanged(),this._reactionElementsSelectionChanged()}get selectedElementIds(){return this._selectedElementIds}get creatingElements(){const t=this._elementsMap.get(this._currentCreatingElementId);return t?[t]:[]}get isProvisionalEmpty(){return this._provisionalElementIds.size===0}get provisionalElements(){return this._provisionalElements}get selectedElements(){return this._selectedElements}get targetElements(){return this._targetElements}get stageElements(){return this._stageElements}get rangeElements(){return this._rangeElements}get visibleElements(){return this._visibleElements}get selectedAncestorElement(){return this._selectedAncestorElement}get primarySelectedElement(){return this._primarySelectedElement}get rotatingTargetElements(){return this._rotatingTargetElements}get editingElements(){return this._editingElements}get isSelectedEmpty(){return this._selectedElementIds.size===0}get isVisibleEmpty(){return this._visibleElementIds.size===0}get isEmpty(){return this._elementList.length===0}get isEditingEmpty(){return this._editingElementIds.size===0}get isTargetEmpty(){return this._targetElementIds.size===0}get isRangeEmpty(){return this._rangeElementIds.size===0}get isStageEmpty(){return this._stageElementIds.size===0}get isRotatingTargetEmpty(){return this._rotatingTargetElementIds.size===0}get noParentElements(){return this._noParentElements}get isMultiSelected(){return this._isMultiSelected}_reactionElementAdded(){this._elementList.on(Oe.added,t=>{const e=t.value;Object.keys(de).forEach(s=>{this._reactionElementPropsChanged(de[s],e,e[s])})})}_reactionElementRemoved(){this._elementList.on(Oe.removed,t=>{const{id:e}=t.value;this._elementsMap.delete(e),this._selectedElementIds.delete(e),this._targetElementIds.delete(e),this._provisionalElementIds.delete(e),this._rotatingTargetElementIds.delete(e),this._editingElementIds.delete(e),this._rangeElementIds.delete(e),this._visibleElementIds.delete(e),this._stageElementIds.delete(e)})}_reactionElementsPropsChanged(){Object.keys(de).forEach(t=>{this._elementList.on(t,(e,s)=>{this._reactionElementPropsChanged(t,e,s)})})}_reactionElementsSelectionChanged(){Pe(()=>Array.from(this._selectedElementIds),()=>{this._reactionSelectedElementsChanged(),this.shield.selection.refresh()}),Pe(()=>Array.from(this._targetElementIds),()=>this._reactionTargetElementsChanged()),Pe(()=>Array.from(this._provisionalElementIds),()=>this._reactionProvisionalElementsChanged()),Pe(()=>Array.from(this._rotatingTargetElementIds),()=>this._reactionRotatingTargetElementsChanged()),Pe(()=>Array.from(this._editingElementIds),()=>this._reactionEditingElementsChanged()),Pe(()=>Array.from(this._rangeElementIds),()=>this._reactRangeElementsChanged()),Pe(()=>Array.from(this._visibleElementIds),()=>this._reactionVisibleElementsChanged()),Pe(()=>Array.from(this._stageElementIds),()=>this._reactionStageElementsChanged())}_reactionSelectedElementsChanged(){this._selectedElements=this._filterList(this._selectedElementIds),this._noParentElements=P.getNoParentElements(this._selectedElements),this._isMultiSelected=this._noParentElements.length>1,this._selectedAncestorElement=P.getAncestorGroup(this._selectedElements),this._primarySelectedElement=this._selectedAncestorElement&&!this._selectedAncestorElement.isProvisional?this._selectedAncestorElement:null,this.shield.emit(T.selectedChanged,this._selectedElements),this.shield.emit(T.multiSelectedChanged,this._isMultiSelected),this.shield.emit(T.primarySelectedChanged,this._primarySelectedElement),this.emitElementsLayerChanged()}emitElementsLayerChanged(){this._selectedElements.length?Ht.isConsecutive(this._selectedElements.map(t=>t.node))?(this.shield.emit(T.layerShiftMoveEnableChanged,!this._selectedElements[this._selectedElements.length-1].isTopmost),this.shield.emit(T.layerGoDownEnableChanged,!this._selectedElements[0].isBottommost)):(this.shield.emit(T.layerShiftMoveEnableChanged,!0),this.shield.emit(T.layerGoDownEnableChanged,!0)):(this.shield.emit(T.layerShiftMoveEnableChanged,!1),this.shield.emit(T.layerGoDownEnableChanged,!1))}_reactionTargetElementsChanged(){this._targetElements=this._filterList(this._targetElementIds),this.shield.emit(T.targetChanged,this._targetElements)}_reactionStageElementsChanged(){this._stageElements=this._filterList(this._stageElementIds)}_reactionVisibleElementsChanged(){this._visibleElements=this._filterList(this._visibleElementIds)}_reactRangeElementsChanged(){this._rangeElements=this._filterList(this._rangeElementIds)}_reactionEditingElementsChanged(){this._editingElements=this._filterList(this._editingElementIds)}_reactionRotatingTargetElementsChanged(){this._rotatingTargetElements=this._filterList(this._rotatingTargetElementIds)}_reactionProvisionalElementsChanged(){this._provisionalElements=this._filterList(this._provisionalElementIds)}resortElementsArray(){this._reactionStageElementsChanged(),this._reactionVisibleElementsChanged(),this._reactionSelectedElementsChanged()}_filterList(t){return this._elementList.filter(e=>t.has(e.value.id)).map(e=>e.value)}_setAddDelete(t,e,s){s?t.add(e):t.delete(e)}_reactionElementPropsChanged(t,e,s){switch(t){case de.isSelected:{this._setAddDelete(this._selectedElementIds,e.id,s);break}case de.isProvisional:{this._setAddDelete(this._provisionalElementIds,e.id,s);break}case de.isTarget:{this._setAddDelete(this._targetElementIds,e.id,s);break}case de.isRotatingTarget:{this._setAddDelete(this._rotatingTargetElementIds,e.id,s);break}case de.isEditing:{this._setAddDelete(this._editingElementIds,e.id,s);break}case de.isInRange:{this._setAddDelete(this._rangeElementIds,e.id,s);break}case de.isVisible:{this._setAddDelete(this._visibleElementIds,e.id,s);break}case de.isOnStage:{this._setAddDelete(this._stageElementIds,e.id,s);break}}}filterEmit(t,e,...s){var r;e&&(e.id===((r=this.primarySelectedElement)==null?void 0:r.id)||e.id===this._currentCreatingElementId)&&this.shield.emit(t,e,...s)}async setElementsPosition(t,e){t.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){const{x:r,y:n}=s.model,{x:o,y:a}=e;if(r===o&&n===a)return;const l={x:o-r,y:a-n};s.setPosition(o,a,l),s.isGroup&&s.deepSubs.forEach(h=>{h.setPosition(h.model.x+l.x,h.model.y+l.y,l)})}})}async setElementsWidth(t,e){t.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){if(s.width===e)return;const r=s.setWidth(e);s.isGroup&&this.scaleSubs(s,r)}})}async setElementsHeight(t,e){t.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){if(s.height===e)return;const r=s.setHeight(e);s.isGroup&&this.scaleSubs(s,r)}})}scaleSubs(t,e){const{centerCoord:s,angle:r,leanYAngle:n}=t,{scaleX:o,scaleY:a}=c.getScaleFromMatrix(e);t.deepSubs.forEach(l=>{l.scaleBy(s,o,a,{angle:r,leanYAngle:n})})}async setElementsAngle(t,e){t.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){if(s.angle===e)return;this.rotateElements([s],e,s.angle,s.centerCoord)}})}async setElementsCorners(t,e,s){t.forEach(r=>{if(this.hasElement(r.id)&&!r.isGroupSubject){if(R.isEqual(r.corners,[e,e,e,e]))return;r.setCorners(e,s)}})}async setElementsLeanYAngle(t,e){t.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){if(s.leanYAngle===e)return;const r=s.leanYAngle;if(e=c.precise(e,1),s.setLeanYAngle(e),s.isGroup){const n=s.centerCoord;s.deepSubs.forEach(o=>{o.leanYBy(e,r,s.angle,n)})}}})}async setElementsStrokeType(t,e,s){t.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.strokes[s].type===e)return;r.setStrokeType(e,s)}})}async setElementsStrokeWidth(t,e,s){t.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.strokes[s].width===e)return;r.setStrokeWidth(e,s)}})}async setElementsStrokeColor(t,e,s){t.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.strokes[s].color===e)return;r.setStrokeColor(e,s)}})}async setElementsStrokeColorOpacity(t,e,s){t.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.strokes[s].colorOpacity===e)return;r.setStrokeColorOpacity(e,s)}})}async addElementsStroke(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.addStroke(e)})}async removeElementsStroke(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.removeStroke(e)})}async setElementsFillColor(t,e,s){t.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.fills[s].color===e)return;r.setFillColor(e,s)}})}async setElementsFillColorOpacity(t,e,s){t.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.fills[s].colorOpacity===e)return;r.setFillColorOpacity(e,s)}})}async addElementsFill(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.addFill(e)})}async removeElementsFill(t,e){t.forEach(s=>{this.hasElement(s.id)&&s.removeFill(e)})}async setElementsTextAlign(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.textAlign===e)return;s.setTextAlign(e)}})}async setElementsTextBaseline(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.textBaseline===e)return;s.setTextBaseline(e)}})}async setElementsFontSize(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.fontSize===e)return;s.setFontSize(e)}})}async setElementsFontFamily(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.fontFamily===e)return;s.setFontFamily(e)}})}async setElementsFontLineHeight(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.fontLineHeight===e)return;s.setFontLineHeight(e)}})}async setElementsFontColor(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.fontColor===e)return;s.setFontColor(e)}})}async setElementsFontColorOpacity(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.fontColorOpacity===e)return;s.setFontColorOpacity(e)}})}async setElementsRatioLocked(t,e){t.forEach(s=>{if(this.hasElement(s.id)){if(s.isRatioLocked===e)return;s.setRatioLocked(e)}})}hasElement(t){return this._elementsMap.has(t)}getElementById(t){return this._elementsMap.get(t)}getElementsByIds(t){return t.map(e=>this.getElementById(e)).filter(e=>e!==void 0)}getIndexById(t){return this.hasElement(t)&&this._elementList.forEachBreak((e,s)=>{if(e.value.id===t)return s},e=>{if(e.value.id===t)return!0}),-1}addElement(t,e,s){const r=new ks(t);return t.node=r,e?this._elementList.insertAfter(r,e.node):s?this._elementList.prepend(r):this._elementList.insert(r),this._elementsMap.set(t.id,t),t}beforeAddElement(t,e,s){const r=new ks(t);return t.node=r,e?this._elementList.insertBefore(r,e.node):s?this._elementList.insert(r):this._elementList.prepend(r),this._elementsMap.set(t.id,t),t}_createElementByModel(t){const e=P.createElement(t,this.shield);return Object.assign(e,{status:Q.finished,isOnStage:!0,isSelected:!0}),e}afterAddElementByModel(t,e,s){const r=this._createElementByModel(t);return this.addElement(r,e,s),r.refresh(),r}beforeAddElementByModel(t,e,s){const r=this._createElementByModel(t);return this.beforeAddElement(r,e,s),r.refresh(),r}removeElement(t){if(this.hasElement(t)){let e=this._elementsMap.get(t);return this._elementList.removeBy(s=>s.value.id===t),this._elementsMap.delete(t),e=null,e}}updateElementById(t,e){if(this.hasElement(t)){const s=this._elementsMap.get(t);return Object.assign(s,e),s}}updateElements(t,e){return t.forEach(s=>this.updateElementById(s.id,e)),t}updateElementModel(t,e){if(this.hasElement(t)){const s=this._elementsMap.get(t),r=s.model.id;return H.deepPlanObjectAssign(s.model,e,{id:r}),s}}updateElementsModel(t,e){t.forEach(s=>{this.updateElementModel(s.id,e)})}createElementModel(t,e,s){const r=P.calcSize({coords:e,boxCoords:v.getBoxPoints(e),type:t}),n=P.calcPosition({type:t,coords:e});return{...P.createEmptyObject(),type:t,coords:e,boxCoords:v.getBoxPoints(e),data:s,width:r.width,height:r.height,name:`${vr.getCreatorByType(t).name} ${+new Date}`,styles:Ls(t),isRatioLocked:!1,...n,...ds,...ot}}_setElementProvisionalCreating(t){this.updateElementById(t.id,{status:Q.creating,isOnStage:!1,isProvisional:!0,isSelected:!0})}_createProvisionalElement(t){const e=P.createElement(t,this.shield);return this._currentCreatingElementId=e.id,this.updateElementById(e.id,{status:Q.startCreating}),this.addElement(e),e}creatingElement(t){let e;const{category:s,type:r}=this.shield.currentCreator;switch(s){case te.shapes:{const n=this.createElementModel(r,P.calcCreatorPoints(t,r));this._currentCreatingElementId?(delete n.id,e=this.updateElementModel(this._currentCreatingElementId,n),e.model.boxCoords=v.getBoxPoints(e.model.coords),this._setElementProvisionalCreating(e)):e=this._createProvisionalElement(n)}}return this.selectElement(e),e.refresh(),e}creatingArbitraryElement(t,e){let s,r;return this._currentCreatingElementId?(s=this.getElementById(this._currentCreatingElementId),r=s.model,e?c.isPointClosest(t,r.coords[0],On/this.shield.stageScale)?s.tailCoordIndex>0&&(r.isFold=!0):(r.coords.splice(r.coords.length-1,1,t),s.tailCoordIndex=r.coords.length-1):s.tailCoordIndex+1===r.coords.length?r.coords.push(t):r.coords.splice(s.tailCoordIndex+1,1,t),s.model.boxCoords=v.getBoxPoints(s.model.coords),this._setElementProvisionalCreating(s)):(r=this.createElementModel(A.arbitrary,[t]),r.isFold=!1,s=this._createProvisionalElement(r),s.tailCoordIndex=0),this.selectElement(s),s.refresh({size:!0,points:!0,position:!0}),s}_finishArbitraryElement(t){const e=t.tailCoordIndex;t.tailCoordIndex=-1,e<t.model.coords.length-1&&(t.model.coords=t.model.coords.slice(0,e+1))}finishCreatingElement(){if(this._currentCreatingElementId){let t=this.getElementById(this._currentCreatingElementId);if(t){this._currentCreatingElementId=null;const{model:{type:e}}=t;switch(e){case A.arbitrary:{this._finishArbitraryElement(t);break}}return this.updateElementById(t.id,{status:Q.finished}),t.model.boxCoords=v.getBoxPoints(t.model.coords),t.refresh(),t}}}findElements(t){const e=[];return this._elementList.forEach(s=>{t(s.value)&&e.push(s.value)}),e}updateElementsTransform(t,e){t.forEach(s=>{s.transform(e),s.isGroup&&!s.isGroupSubject&&s.deepSubs.forEach(r=>{const{transformLockCoord:n,transformLockIndex:o,originalTransformMoveCoord:a,transformType:l,model:{angle:h,leanYAngle:d}}=s;r.transformBy({lockCoord:n,lockIndex:o,originalMovingCoord:a,offset:e,groupAngle:h,groupLeanYAngle:d,transformType:l})})})}updateElementsCorner(t,e){t.forEach(s=>{s.updateCornerByOffset(e)})}updateElementsTranslate(t,e){t.forEach(s=>{s.translateBy(e),!s.isOnStage&&this._updateElementStageStatusIfy(s)})}forEach(t){this._elementList.forEach((e,s)=>{t(e.value,s)})}refreshElementsOriginals(t,e){this._refreshElementsByFunc(t,s=>s.refreshOriginalProps(),e)}refreshElementsOriginalAngles(t,e){this._refreshElementsByFunc(t,s=>s.refreshOriginalAngle(),e)}_refreshElementsByFunc(t,e,s){s=Object.assign({},Kn,s||{});let r=new Set;function n(o){r.has(o.id)||(r.add(o.id),e(o))}t.forEach(o=>{n(o),o.isGroup&&(s.deepSubs?o.deepSubs.forEach(n):s.subs&&o.subs.forEach(n))}),r.clear(),r=null}_updateElementStageStatusIfy(t){const e=t.isModelPolygonOverlap(this.shield.stageWordRectCoords);this.updateElementById(t.id,{isOnStage:e})}refreshStageElements(){this._elementList.forEach(({value:t})=>{this._updateElementStageStatusIfy(t),t.refresh({points:!0,rotation:!0,originals:!0,outline:!0,strokes:!0})})}refreshElements(t){t.forEach(e=>{e.refresh()})}isSelectedContainsTarget(){return this.isTargetEmpty?!1:R.every(Array.from(this._targetElementIds),t=>this._selectedElementIds.has(t))}refreshRotatingStates(t){this.refreshElementsRotationStates(this.rotatingTargetElements,t)}refreshElementsRotationStates(t,e){const{center:s,centerCoord:r,angle:n}=this.calcRotatingStatesByElements(e,t);this._rotatingCenter=s,this._rotatingCenterCoord=r,this._rotatingOriginalAngle=n}calcRotatingStatesByElements(t,e){const s=c.calcCenter(e.map(o=>o.centerCoord).flat()),r=P.calcStageRelativePoint(s),n=c.precise(c.calcAngle(r,t));return{center:r,centerCoord:s,angle:n}}clearRotatingStates(){this._rotatingCenter=null,this._rotatingCenterCoord=null,this._rotatingOriginalAngle=null}updateElementsRotation(t,e){const s=c.precise(c.calcAngle(this._rotatingCenter,e));this.rotateElements(t,s,this._rotatingOriginalAngle,this._rotatingCenterCoord)}rotateElements(t,e,s,r){t.forEach(n=>{n.model.type!==A.line&&(e=c.mirrorAngle(n.originalAngle+e-s),e=c.precise(e,1)),n.setAngle(e),!n.isOnStage&&this._updateElementStageStatusIfy(n),n.isGroup&&n.deepSubs.forEach(o=>{o.rotateBy(e-n.originalAngle,r),!o.isOnStage&&this._updateElementStageStatusIfy(o)})})}async createImageElementModel(t,e){const{colorSpace:s}=e,{width:r,height:n}=t,o=v.get4BoxPoints(this.shield.stageWorldCoord,{width:r,height:n}),a=c.calcCenter(o);return{...P.createEmptyObject(),coords:o,boxCoords:v.getBoxPoints(o),type:A.image,data:t,name:"image",width:r,height:n,length:0,styles:Ls(A.image),colorSpace:s,naturalWidth:r,naturalHeight:n,isRatioLocked:!0,...a,...ot}}async insertImageElement(t){let e;t instanceof ImageData&&(e=t.colorSpace,t=ss.createImageFromImageData(t),await ss.waitForImageLoad(t));const s=await this.createImageElementModel(t,{colorSpace:e});return this.afterAddElementByModel(s)}insertTextElement(t,e,s){const r=Ni.createTextData(t,e),n=this.createElementModel(A.text,s,r);return this.afterAddElementByModel(n)}deleteSelects(){this.selectedElements.forEach(t=>{this.removeElement(t.id)})}selectElement(t){this.updateElementById(t.id,{isSelected:!0})}deSelectElement(t){this.updateElementById(t.id,{isSelected:!1})}selectElements(t){t.forEach(e=>{this.selectElement(e)})}deSelectElements(t){t.forEach(e=>{this.deSelectElement(e)})}toggleSelectElement(t){t.isSelected?this.deSelectElement(t):this.selectElement(t)}toggleSelectElements(t){t.forEach(e=>{this.toggleSelectElement(e)})}selectAll(){this._elementList.forEach(t=>{this.selectElement(t.value)})}deSelectAll(){this._elementList.forEach(t=>{this.deSelectElement(t.value)})}cancelTargetElements(){this.targetElements.forEach(t=>{this.updateElementById(t.id,{isTarget:!1})})}beginEditingElements(t){this._setElementsEditing(t,!0)}endEditingElements(t){this._setElementsEditing(t,!1)}getFinishedSelectedElements(t){return this.selectedElements.filter(e=>e.status===Q.finished&&(t?!e.isGroupSubject:!0))}getSelectedElements(t){return this.selectedElements.filter(e=>t?!e.isGroupSubject:!0)}_setElementsEditing(t,e){t.forEach(s=>{s.editingEnable&&e!==s.isEditing&&(this.updateElementById(s.id,{isEditing:e,status:e?Q.editing:Q.finished}),s.tfRefreshAfterEdChanged&&s.refresh())})}isSelectedEqCreating(){const t=new Set(this.selectedElements.map(s=>s.id)),e=new Set(this.creatingElements.map(s=>s.id));return R.isEqual(t,e)}_bindElementsGroup(t){t.subs.forEach(e=>{this.updateElementModel(e.id,{groupId:t.id})})}_unbindElementsGroup(t){this.updateElementsModel(t.getSubs(),{groupId:void 0}),this.updateElementModel(t.id,{subIds:[]})}_createElementGroupObject(t){t=t.filter(l=>!l.isGroupSubject);const e=t.map(l=>l.id),s=v.getBoxPoints(t.map(l=>l.rotateCoords).flat()),{width:r,height:n,x:o,y:a}=v.getRect(s);return{...P.createEmptyGroupObject(),subIds:e,coords:s,boxCoords:v.getBoxPoints(s),width:r,height:n,x:o+r/2,y:a+n/2}}_sortElementsByLevel(t){return t.sort((e,s)=>this.getIndexById(e.id)-this.getIndexById(s.id))}_rearrangeForwardElementNodes(t){let e=t;if(!Ht.isConsecutive(t.map(s=>s.node))){e=this._sortElementsByLevel(t);const s=e[e.length-1];this._removeNodesByElements(e.slice(0,e.length-1));for(let r=0;r<=e.length-2;r++)this._elementList.insertBefore(e[r].node,s.node,!1)}return e}createElementGroup(t){const e=this._rearrangeForwardElementNodes(t),s=new ps(this._createElementGroupObject(e),this.shield);return this._bindElementsGroup(s),this.addElement(s,e[e.length-1]),this.updateElementById(s.id,{status:Q.finished,isOnStage:!0}),s.refresh(),s}removeElementGroup(t){this.hasElementGroup(t.id)&&(this._unbindElementsGroup(t),this.deSelectGroup(t),this.removeElement(t.id))}hasElementGroup(t){return this.hasElement(t)}selectToGroup(){const t=this.selectedElements;return t.length<2||P.isSameAncestorGroup(t)?null:this.createElementGroup(t)}cancelGroups(t){t.forEach(e=>{this.removeElementGroup(e)})}getSelectedElementGroups(){return this.selectedElements.filter(t=>t.model.type===A.group)}getSelectedAncestorElementGroups(){return P.getNoParentElements(this.getSelectedElementGroups())}selectGroup(t){this.updateElementById(t.id,{isSelected:!0})}deSelectGroup(t){this.updateElementById(t.id,{isSelected:!1})}deSelectGroups(t){t.forEach(e=>{this.deSelectGroup(e)})}async copySelectElements(){return Promise.all(this.selectedElements.map(async t=>await t.toJson()))}async pasteElements(t){const e=[],s=P.convertElementsJson(t);for(const r of s){await P.convertElementModel(r);const n=this.afterAddElementByModel(r);e.push(n)}return e}rearrangeElementAfter(t,e,s){const{node:r}=t;this._elementList.remove(r,!1),e?this._elementList.insertAfter(r,e.node,!1):s?this._elementList.prepend(r,!1):this._elementList.insert(r,!1)}rearrangeElementBefore(t,e,s){const{node:r}=t;this._elementList.remove(r,!1),e?this._elementList.insertBefore(r,e.node,!1):s?this._elementList.insert(r,!1):this._elementList.prepend(r,!1)}_removeNodesByElements(t){const e=[];return t.forEach(s=>{const[r]=this._elementList.removeBy(n=>n.value.id===s.id,!1);e.push(r)}),e}_getPrevmostElement(t){let e=t.subs[0];return e&&e.isGroup&&(e=this._getPrevmostElement(e)),e}_doElementsGoDown(t){let s=t[0].node.prev;s!=null&&s.value.isGroup&&(s=this._getPrevmostElement(s.value).node);const r=this._removeNodesByElements(t);s?r.forEach(n=>{this._elementList.insertBefore(n,s,!1)}):r.reverse().forEach(n=>{this._elementList.prepend(n,!1)})}async setElementsGoDown(t){t.length!==0&&(this._doElementsGoDown(t),this.resortElementsArray(),this.emitElementsLayerChanged())}_doElementsShiftMove(t){let s=t[t.length-1].node.next;s!=null&&s.value.isGroupSubject&&(s=s.value.ancestorGroup.node);const r=this._removeNodesByElements(t);s?r.forEach(n=>{this._elementList.insertAfter(n,s,!1),s=n}):r.forEach(n=>{this._elementList.insert(n,!1)})}async setElementsShiftMove(t){t.length!==0&&(this._doElementsShiftMove(t),this.resortElementsArray(),this.emitElementsLayerChanged())}}class Es extends Tt{constructor(e){super();g(this,"tasks");g(this,"running");this.tasks=e}isEmpty(){return this.tasks.length===0}add(e){this.running||e&&this.tasks.push(e)}addAll(e){e.forEach(s=>{this.add(s)})}prepend(e){this.running||e&&this.tasks.unshift(e)}async run(){for(this.running=!0;this.tasks.length>0;){let e=this.tasks.shift();if(e)try{await e.run()}catch{}finally{e.destroy&&await e.destroy(),e=null}}this.running=!1}}class Ie extends Tt{constructor(e,s){super();g(this,"model");g(this,"canvas");this.model=e,s&&(this.canvas=s.canvas)}destroy(){return this.model=null,this.id=null,this.canvas=null,Promise.resolve()}}class Vi extends Ie{async run(){var r,n;if(!this.canvas||!this.model)return;const{width:t}=jt.strokes[0],e={};let{points:s}=this.model;s=P.calcStageRelativePoints(s),[le.selection,le.path].includes(this.model.type)&&(e.fills=[{colorOpacity:0}]),F.drawPathWithScale(this.canvas,s,Object.assign({},{...jt,...e}),{},{...jt.strokes[0],width:t/F.scale},{isFold:typeof((r=this.model.element)==null?void 0:r.isFold)>"u"?!0:(n=this.model.element)==null?void 0:n.isFold})}}class Ws extends Ie{async run(){var t;this.canvas&&((t=this.canvas.getContext("2d"))==null||t.clearRect(0,0,this.canvas.width,this.canvas.height))}}class ji extends Ie{async run(){if(!this.canvas||!this.model)return;const{width:t}=He.strokes[0];let{point:e,leanYAngle:s,actualAngle:r}=this.model;e=P.calcStageRelativePoint(e),F.drawPathWithScale(this.canvas,v.get4BoxPoints(e,{width:Et/F.scale,height:Et/F.scale},{angle:r,leanYAngle:s}),He,He.fills[0],{...He.strokes[0],width:t/F.scale},{calcVertices:!1})}}class xr{static wait(t){return new Promise(e=>{setTimeout(()=>{e()},t)})}}class vt{constructor(){g(this,"running");g(this,"queue");g(this,"stopped");this.running=!1,this.queue=[],this.stopped=!1}async add(t){this.stopped||(this.queue.push(t),this.running||(this.running=!0,await this.run()))}async run(){if(this.stopped)return;if(this.queue.length===0){this.running=!1;return}let t=this.queue.shift();if(t)try{await t.run()}catch{}finally{t.destroy&&await t.destroy(),t=null}this.queue.length>0?requestAnimationFrame(()=>{this.run()}):this.running=!1}async wait(){for(;this.running;)await xr.wait(10)}async destroy(){await this.wait(),this.stopped=!0,this.queue=null,this.running=!1}}class Gi extends vt{}class _s{constructor(t){g(this,"drawer");g(this,"renderQueue");this.drawer=t,this.renderQueue=new vt}async renderCargo(t){await this.renderQueue.add(t)}get renderParams(){return{canvas:this.drawer.node}}clear(){throw new Error("Method not implemented.")}async redraw(t){throw new Error("Method not implemented.")}}const Hi="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1735111770421'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1464'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M510.9%2064.7c-108.7%200-214%2040.4-295%20111.8L107.3%2068v299.4h299.4L295.4%20256.1c60.3-51.3%20134.9-80.6%20215.5-80.6%20184.8%200%20335.2%20150.3%20335.2%20335.2S695.7%20845.8%20510.9%20845.8%20175.7%20695.4%20175.7%20510.6H64.9c0%20245.8%20200.1%20445.9%20445.9%20445.9s445.9-200.1%20445.9-445.9-200-445.9-445.8-445.9z'%20fill='%231296db'%20p-id='1465'%3e%3c/path%3e%3c/svg%3e";class $i extends Ie{get svg(){return Hi}async run(){if(!this.canvas||!this.model)return;let{point:t,width:e,height:s}=this.model;t=P.calcStageRelativePoint(t),await F.drawImgLike(this.canvas,this.svg,{x:(t.x-e/F.scale/2)*F.scale,y:(t.y-s/F.scale/2)*F.scale,width:e,height:s},{angle:this.model.angle})}}class Yi extends Ie{async run(){if(!this.canvas||!this.model)return;let{text:t,point:e}=this.model;e=P.calcStageRelativePoint(e),F.drawCommonRotateTextWithScale(this.canvas,t,e,Zt,Zt.fills[0],{angle:this.model.angle})}}class qi extends Ie{async run(){if(!this.canvas||!this.model)return;let{text:t,point:e}=this.model;e&&(e=P.calcStageRelativePoint(e),await F.drawCommonRotateTextWithScale(this.canvas,t,e,Is,Is.fills[0]))}}class $t extends Ie{async run(){if(!this.canvas||!this.model)return;let{point:t}=this.model;if(!t)return;let{radius:e}=this.model;const s={...He.strokes[0]};s.width/=F.scale;const r={...He.fills[0]};e/=F.scale,t=P.calcStageRelativePoint(t),F.drawEllipseFillWithScale(this.canvas,t,{rx:e,ry:e},r),F.drawEllipseStrokeWithScale(this.canvas,t,{rx:e,ry:e},s)}}const Xi="data:image/svg+xml,%3csvg%20t='1742220316555'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='19653'%20width='200'%20height='200'%3e%3cpath%20d='M506.016%200c20%200%2036%2016%2036%2036v952c0%2020-16%2036-36%2036s-36-16-36-36V36c0-20%2016-36%2036-36z'%20p-id='19654'%20fill='%23e74b1f'%3e%3c/path%3e%3c/svg%3e";class Ji extends Te{constructor(e,s){super(e,s);g(this,"cursor");this.cursor=s.cursor}async run(){if(!this.canvas||!this.element)return;const{textCursor:e,angle:s,flipX:r,leanY:n,actualAngle:o}=this.element;if(!e)return;const{x:a,y:l,width:h,height:d,renderRect:u}=e,f={angle:s,flipX:r,leanY:n,actualAngle:o};F.drawImgLike(this.canvas,Xi,{...u,desX:a,desY:l,desWidth:h,desHeight:d},{...f})}}class Ui extends Te{async run(){if(!this.canvas||!this.element)return;const{textSelection:t,isSelectionAvailable:e,angle:s,flipX:r,leanY:n,actualAngle:o}=this.element;if(!e)return;const a={angle:s,flipX:r,leanY:n,actualAngle:o},{startNode:l,endNode:h}=t,{lineNumber:d,renderRect:u}=l,{lineNumber:f}=h;if(d===f)this._drawLineSelection(l,h,a);else{const{lines:p}=this.element.model.data;if(d<f)for(let m=d;m<=f;m++){const y=p[m];y.nodes.length===0?this._draweEmptyLine(y,u,a):m===d?this._drawPartialLine(y,l,ye.RIGHT,u,a):m===f?this._drawPartialLine(y,h,ye.LEFT,u,a):this._drawFullLine(y,u,a)}else for(let m=d;m>=f;m--){const y=p[m];y.nodes.length===0?this._draweEmptyLine(y,u,a):m===d?this._drawPartialLine(y,l,ye.LEFT,u,a):m===f?this._drawPartialLine(y,h,ye.RIGHT,u,a):this._drawFullLine(y,u,a)}}}_draweEmptyLine(t,e,s){const{x:r,y:n,height:o}=t,a={x:r,y:n,height:o,renderRect:e},l={x:r+4*F.scale,y:n,height:o,renderRect:e};this._drawLineSelection(a,l,s)}_drawFullLine(t,e,s){const r=t.nodes[0];this._drawPartialLine(t,{...R.pick(r,["x","y","height"]),renderRect:e},ye.RIGHT,e,s)}_drawPartialLine(t,e,s,r,n){if(s===ye.LEFT){const o=t.nodes[0];this._drawLineSelection({...R.pick(o,["x","y","height"]),renderRect:r},e,n)}else if(s===ye.RIGHT){const o=t.nodes[t.nodes.length-1];this._drawLineSelection(e,{x:o.x+o.width,...R.pick(o,["y","height"]),renderRect:r},n)}}_drawLineSelection(t,e,s){const r=Math.min(t.x,e.x),n=t.y,o=Math.abs(t.x-e.x),a=t.height;F.drawRectFill(this.canvas,{...t.renderRect,desX:r,desY:n,desWidth:o,desHeight:a},{color:Ci,colorOpacity:yi},{...s})}}class Ki extends _s{constructor(){super(...arguments);g(this,"_lastCursorRendered",!1);g(this,"_lastSelectionRendered",!1)}async redraw(){let e=new Es([]),s=!1;const r=this.createMaskSelectionTasks();r.forEach(m=>{e.add(m)}),r.length&&(this._lastSelectionRendered=!0);const n=this.createMaskTransformerTasks();n.length&&e.addAll(n);const o=this.createControllerTasks();o.length&&e.addAll(o);const{store:{noParentElements:a},configure:{rotationIconEnable:l},selection:{rangeElement:h},cursor:d,isDrawerActive:u,isTextEditing:f}=this.drawer.shield;if(a.length===1){const m=a[0];l&&m.rotationEnable&&m.status===Q.finished&&e.add(this.createMaskRotateTask(m.rotation)),e.add(this.createMaskIndicatorTask(m))}else a.length>1&&e.add(this.createMaskRotateTask(h.rotation));const p=d.getTask();p&&(e.add(p),this._lastCursorRendered=!0,s=!0),u&&(e.add(this.createMaskCursorPositionTask()),e.add(this.createMaskArbitraryCursorTask())),f&&(e.add(this.createTextElementCursorTask()),e.add(this.createTextElementSelectionTask())),e.isEmpty()?(this._lastCursorRendered||this._lastSelectionRendered)&&!r.length&&!s?(e.add(new Ws(null,this.renderParams)),await this.renderCargo(e),this._lastCursorRendered=!1,this._lastSelectionRendered=!1):e=null:(e.prepend(this.createMaskClearTask()),await this.renderCargo(e))}createMaskCursorPositionTask(){const{cursor:{worldValue:e},stageScale:s}=this.drawer.shield;if(!e)return;const r={point:{x:e.x+20/s,y:e.y+20/s},type:le.cursorPosition,text:`${c.precise(e.x,1)},${c.precise(e.y,1)}`};return new qi(r,this.renderParams)}createMaskSelectionTasks(){const{selection:e}=this.drawer.shield,s=[];return[...e.getModels(),e.selectionModel].forEach(n=>{if(n&&n.points.length>0){const o=new Vi(n,this.renderParams);s.push(o)}}),s}createMaskClearTask(){return new Ws(null,this.renderParams)}createMaskTransformerTasks(){const{selection:{transformerModels:e}}=this.drawer.shield;return e.map(s=>{switch(s.element.transformerType){case Ne.circle:return new $t(s,this.renderParams);case Ne.rect:return new ji(s,this.renderParams);default:return null}}).filter(s=>!!s)}createControllerTasks(){const{store:{primarySelectedElement:e},selection:{rangeElement:s}}=this.drawer.shield,r=e||s;if(r){const{controllers:n=[]}=r;return n.map(o=>{if(!(o instanceof ct)&&!(o instanceof Xe)&&!(o instanceof at)){const a={point:{x:o.x,y:o.y},type:le.transformer,radius:es};return new $t(a,this.renderParams)}return null}).filter(o=>!!o)}return[]}createMaskRotateTask(e){const s={point:{x:e.x,y:e.y},type:le.rotate,...R.pick(e,["points","angle","width","height"])};return new $i(s,this.renderParams)}createMaskIndicatorTask(e){const{stageScale:s}=this.drawer.shield;let r,n;switch(e.model.type){case A.line:{[r,n]=[...e.rotateCoords].sort((l,h)=>l.x-h.x);break}default:{if(e.model.angle%90===0&&e.model.leanYAngle===0){const{maxBoxCoords:l}=e;r=l[3],n=l[2]}else{const[l,h,d]=v.getLBRPoints(e.rotateBoxCoords,!0);let u=c.transformToAcuteAngle(c.calcAngle(h,l)+180),f=c.transformToAcuteAngle(c.calcAngle(h,d)+180);[r,n]=[u<f?l:d,h].sort((m,y)=>m.x-y.x)}break}}const o=c.calcAngle(r,n),a={point:c.calcSegmentLineCenterCrossPoint(r,n,!0,hi/s),angle:o,type:le.indicator,text:`${e.width} x ${e.height}`};return new Yi(a,this.renderParams)}createMaskArbitraryCursorTask(){const{currentCreator:e,cursor:s}=this.drawer.shield;if(e.category===te.freedom){const r={point:s.value,type:le.cursor,radius:es};return new $t(r,this.renderParams)}}_getEditingTextElement(){const{isEditingEmpty:e,editingElements:s}=this.drawer.shield.store;if(e)return null;const r=s[0];return r instanceof Cs?r:null}createTextElementCursorTask(){const e=this._getEditingTextElement();return!e||e.isSelectionAvailable?null:new Ji(e,this.renderParams)}createTextElementSelectionTask(){const e=this._getEditingTextElement();return e&&e.isSelectionAvailable?new Ui(e,this.renderParams):null}}class Lt extends ys.EventEmitter{constructor(e){super();g(this,"node");g(this,"renderer");g(this,"shield");this.shield=e}initNode(){return this.node=document.createElement("canvas"),this.initStyle(),this.node}initStyle(){this.node.style.position="absolute",this.node.style.top="0",this.node.style.left="0"}updateSize(e){this.node instanceof HTMLCanvasElement?(this.node.width=e.width,this.node.height=e.height):(this.node.style.width=`${e.width}px`,this.node.style.height=`${e.height}px`)}clear(){var e;this.node instanceof HTMLCanvasElement?(e=this.node.getContext("2d"))==null||e.clearRect(0,0,this.node.width,this.node.height):this.node.innerHTML=""}async redraw(e){await this.renderer.redraw(e)}}class Qi extends Lt{constructor(t){super(t),this.renderer=new Ki(this)}initNode(){return super.initNode(),this.node.id="mask",this.node.style.pointerEvents="none",this.node}}class Sr extends Te{async run(){var t;this.canvas&&((t=this.canvas.getContext("2d"))==null||t.clearRect(0,0,this.canvas.width,this.canvas.height))}}class Zi extends _s{constructor(){super(...arguments);g(this,"_latestElementRendered");g(this,"_latestClearRendered")}async redraw(){let e=new Es([]);const{creatingElements:s}=this.drawer.shield.store;s.length>0&&(s.forEach(r=>{const n=P.createElementTask(r,this.renderParams);n&&e.add(n)}),this._latestElementRendered=!0),this._latestClearRendered=e.isEmpty()&&this._latestElementRendered,!e.isEmpty()||this._latestClearRendered?(e.prepend(new Sr(null,this.renderParams)),await this.renderCargo(e),this._latestClearRendered&&(this._latestClearRendered=!1)):e=null}}class eo extends Lt{constructor(t){super(t),this.renderer=new Zi(this)}initNode(){return super.initNode(),this.node.id="provisional",this.node.style.pointerEvents="none",this.node}}class to{constructor(t){g(this,"shield");g(this,"rangeElement");g(this,"_selectionModel");g(this,"_transformerModels",[]);g(this,"_rangeCoords",null);this.shield=t,this.rangeElement=new ps({...P.createEmptyGroupObject()},this.shield,!0),this.rangeElement.status=Q.finished}get isEmpty(){const{isSelectedEmpty:t,isTargetEmpty:e,isRangeEmpty:s}=this.shield.store;return t&&e&&s}get isRange(){return this._rangeCoords!==null&&this._rangeCoords.length>0}get selectionModel(){return this._selectionModel}get transformerModels(){return this._transformerModels}get center(){return null}get internalAngle(){return 0}setRange(t){this._rangeCoords=t,this.refreshRangeElements(this._rangeCoords)}_getElementMaskModelProps(t,e){const{rotateCoords:s,rotateBoxCoords:r,model:{angle:n,isFold:o}}=t;return{points:e?r:s,angle:n,element:{isFold:o}}}_getElementsMaskModels(t,e){const s=[];return t.forEach(r=>{r&&(r.isGroupSubject||s.push({type:e,...this._getElementMaskModelProps(r)}))}),s}_getRangeElementsMaskModels(){return this._getElementsMaskModels(this.shield.store.rangeElements,le.path)}_getTargetElementsMaskModels(){return this._getElementsMaskModels(this.shield.store.targetElements,le.path)}_getSelectedElementsMaskModels(){const{store:t}=this.shield;return this._getElementsMaskModels([t.primarySelectedElement||t.creatingElements[0]],le.path)}getModels(){const t=[];return this.isRange&&t.push(...this._getRangeElementsMaskModels()),t.push(...this._getTargetElementsMaskModels()),t.push(...this._getSelectedElementsMaskModels()),this.isRange&&t.push({points:this._rangeCoords,type:le.range}),t}calcSelectionModel(){if(this.shield.store.isSelectedEmpty)return;const t=this.shield.store.primarySelectedElement||this.rangeElement;if(t&&t.boxVerticesTransformEnable&&t.model.coords.length>0)return{type:le.selection,points:t.rotateBoxCoords,angle:t.model.angle}}calcTransformerModels(){if(this.shield.store.isSelectedEmpty)return[];const{primarySelectedElement:t,creatingElements:e}=this.shield.store,s=t||e[0]||this.rangeElement;if(s&&s.transformersEnable&&s.model.coords.length>0){const{transformerType:r,angle:n,leanYAngle:o,actualAngle:a,transformers:l,coordTransformEnable:h,boxVerticesTransformEnable:d,flipX:u,flipY:f}=s;if(h||d)return this.calcTransformerModelsByPoints(l,{angle:n,leanYAngle:o,actualAngle:a,flipX:u,flipY:f},h?r:Ne.rect)}return[]}calcTransformerModelsByPoints(t,e,s){return t.map(r=>({point:r,type:le.transformer,element:{transformerType:s},radius:es,...e}))}clearSelects(){const{store:t}=this.shield;t.deSelectElements(t.selectedElements)}hitTargetElements(t){const{store:e}=this.shield;for(let s=e.stageElements.length-1;s>=0;s--){const r=e.stageElements[s],n=r.isContainsCoord(t);if(e.updateElementById(r.id,{isTarget:n}),n){e.targetElements.forEach(o=>{o.id!==r.id&&e.updateElementById(o.id,{isTarget:!1})});break}}}selectTargets(){this.shield.store.updateElements(this.shield.store.targetElements,{isSelected:!0,isTarget:!1})}refreshRangeElements(t){if(t&&t.length){const{store:e}=this.shield;e.stageElements.forEach(s=>{e.updateElementById(s.id,{isInRange:s.isPolygonOverlap(t)})})}}selectRange(){if(this.isRange){const{store:t}=this.shield;t.updateElements(t.rangeElements,{isSelected:!0,isInRange:!1})}}getElementOnCoord(t){const e=this.shield.store.stageElements;for(let s=e.length-1;s>=0;s--){const r=e[s];if(r.isContainsCoord(t))return r}}refreshSelectionModel(){this._selectionModel=this.calcSelectionModel()}refreshTransformerModels(){this._transformerModels=this.calcTransformerModels()}refreshRangeElement(){const t=this.shield.store.selectedElements;if(t.length===0)Object.assign(this.rangeElement.model,P.createEmptyGroupObject());else{if(!this.rangeElement.isRotating&&!this.rangeElement.isTransforming){const e=v.getBoxPoints(t.map(s=>s.rotateCoords).flat());Object.assign(this.rangeElement.model,{coords:e,boxCoords:H.jsonClone(e),...v.getRect(e),subIds:t.map(s=>s.id),...ds})}this.rangeElement.isTransforming?this.rangeElement.refresh({points:!0,size:!0,rotation:!0,angles:!0,outline:!0,strokes:!0}):this.rangeElement.refresh()}}refresh(){this.refreshRangeElement(),this.refreshSelectionModel(),this.refreshTransformerModels()}tryActiveController(t){if(this.shield.store.isSelectedEmpty)return;const e=this.shield.store.primarySelectedElement||this.rangeElement;if(e){const s=e.getControllerByCoord(t);if(e.setControllersActive(e.controllers.filter(r=>r.id!==(s==null?void 0:s.id)),!1),s)return e.setControllersActive([s],!0),s}}getActiveController(){if(this.shield.store.isSelectedEmpty)return;const t=this.shield.store.primarySelectedElement||this.rangeElement;if(t)return t.getActiveController()}}const so="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1735892982581'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='15410'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M552.224%20179.712v664.576l68.704-68.704a36.576%2036.576%200%200%201%2051.712%2051.712l-130.24%20130.208a36.48%2036.48%200%200%201-26.72%2011.648h-0.064-0.032c-9.024%200-17.28-3.264-23.648-8.704l0.064%200.032a36.48%2036.48%200%200%201-4.576-3.872l-129.28-129.312a36.576%2036.576%200%200%201%2051.712-51.712l69.216%2069.216V179.232l-69.216%2069.216a36.576%2036.576%200%200%201-51.712-51.712l129.28-129.28c1.472-1.472%202.976-2.752%204.576-3.904a36.48%2036.48%200%200%201%2050.4%202.944l0.032%200.032%20130.24%20130.208a36.576%2036.576%200%200%201-51.712%2051.712l-68.704-68.704z'%20p-id='15411'%20fill='%232c2c2c'%3e%3c/path%3e%3c/svg%3e",ro="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1735887761508'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='7589'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M641.264941%20791.853176l42.586353%2042.586353L512%201006.351059l-171.911529-171.91153%2042.586353-42.586353L481.882353%20891.060706v-227.20753h60.235294v227.20753l99.147294-99.20753zM481.882353%20132.939294v227.20753h60.235294V132.939294l99.147294%2099.147294%2042.586353-42.586353L512%2017.648941%20340.088471%20189.500235l42.586353%2042.586353L481.882353%20132.939294zM0%20481.882353v60.235294h1024V481.882353H0z'%20fill='%232c2c2c'%20p-id='7590'%3e%3c/path%3e%3c/svg%3e",no="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1737787540457'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1497'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M870.4%20204.8c-18.6368%200-36.1472%205.0176-51.2%2013.7728l0-64.9728c0-56.4736-45.9264-102.4-102.4-102.4-21.0944%200-40.6528%206.4-56.9856%2017.3568-14.0288-39.8848-52.0192-68.5568-96.6144-68.5568s-82.6368%2028.672-96.6144%2068.5568c-16.2816-10.9568-35.8912-17.3568-56.9856-17.3568-56.4736%200-102.4%2045.9264-102.4%20102.4l0%20377.4976-68.9152-119.4496c-13.3632-24.32-35.1744-41.6256-61.3888-48.7936-25.5488-6.9632-52.1216-3.2768-74.8544%2010.3424-46.4384%2027.8528-64.1536%2090.8288-39.424%20140.3904%201.536%203.1232%2034.2016%2070.0416%20136.192%20273.92%2048.0256%2096%20100.7104%20164.6592%20156.6208%20203.9808%2043.8784%2030.8736%2074.1888%2032.4608%2079.8208%2032.4608l256%200c43.5712%200%2084.0704-14.1824%20120.4224-42.0864%2034.1504-26.2656%2063.7952-64.256%2088.064-112.8448%2047.8208-95.6416%2073.1136-227.9424%2073.1136-382.6688l0-179.2c0-56.4736-45.9264-102.4-102.4-102.4zM921.6%20486.4c0%20146.7904-23.3984%20271.1552-67.6864%20359.7312-28.8768%2057.7536-80.5888%20126.6688-162.7136%20126.6688l-255.488%200c-1.9968-0.1536-23.552-2.56-56.064-26.88-32.4096-24.2688-82.176-75.3664-135.0656-181.248-103.7824-207.5648-135.68-272.9472-135.9872-273.5616-0.0512-0.1024-0.0512-0.1536-0.1024-0.2048-12.8512-25.7536-3.7376-59.4944%2019.9168-73.6768%2010.6496-6.4%2023.0912-8.0896%2035.072-4.864%2012.7488%203.4816%2023.4496%2012.0832%2030.0544%2024.1664%200.1024%200.1536%200.2048%200.3584%200.3072%200.512l79.9232%20138.496c16.3328%2029.8496%2034.7136%2042.3936%2054.6304%2037.3248%2019.968-5.0688%2030.0544-25.0368%2030.0544-59.2384l0-400.0256c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20332.8c0%2014.1312%2011.4688%2025.6%2025.6%2025.6s25.6-11.4688%2025.6-25.6l0-384c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20384c0%2014.1312%2011.4688%2025.6%2025.6%2025.6s25.6-11.4688%2025.6-25.6l0-332.8c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20384c0%2014.1312%2011.4688%2025.6%2025.6%2025.6s25.6-11.4688%2025.6-25.6l0-230.4c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20179.2z'%20fill='%23000000'%20p-id='1498'%3e%3c/path%3e%3c/svg%3e",io="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1736172747971'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='4849'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M512%200a36.571429%2036.571429%200%200%201%2036.571429%2036.571429v950.857142a36.571429%2036.571429%200%200%201-73.142858%200V36.571429A36.571429%2036.571429%200%200%201%20512%200z'%20fill='%23000000'%20p-id='4850'%3e%3c/path%3e%3cpath%20d='M0%20509.074286a36.571429%2036.571429%200%200%201%2036.571429-36.571429h950.857142a36.571429%2036.571429%200%200%201%200%2073.142857H36.571429a36.571429%2036.571429%200%200%201-36.571429-36.571428z'%20fill='%23000000'%20p-id='4851'%3e%3c/path%3e%3c/svg%3e",oo="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1737790480190'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='8613'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M550.034286%20633.904762v154.331428l58.392381-56.661333%2050.95619%2052.46781-144.505905%20140.288-147.065904-140.01981%2050.419809-52.979809%2058.684953%2055.832381-0.024381-153.283048h73.142857z%20m234.008381-269.287619l140.288%20144.505905-140.01981%20147.065904-52.979809-50.419809%2055.832381-58.684953H633.904762v-73.142857h154.331428l-56.661333-58.368%2052.46781-50.95619z%20m-544.231619%200l52.467809%2050.95619-56.685714%2058.368H390.095238v73.142857H236.690286l55.832381%2058.684953-52.955429%2050.419809-140.019809-147.065904%20140.263619-144.505905zM514.876952%2099.669333l144.505905%20140.288-50.95619%2052.46781-58.368-56.661333L550.034286%20390.095238h-73.142857V236.81219l-58.660572%2055.832381-50.419809-52.979809%20147.065904-140.01981z'%20p-id='8614'%3e%3c/path%3e%3c/svg%3e",ao="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1740288855242'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='38476'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M679.338667%20849.152a4.266667%204.266667%200%200%200%206.656%200l161.792-202.24a4.266667%204.266667%200%200%200-3.328-6.912H736v-32a320%20320%200%200%200-320-320H384V179.541333a4.266667%204.266667%200%200%200-6.912-3.328l-202.24%20161.792a4.266667%204.266667%200%200%200%200%206.656l202.24%20161.792A4.266667%204.266667%200%200%200%20384%20503.125333V394.666667h32a213.333333%20213.333333%200%200%201%20213.333333%20213.333333V640h-108.458666a4.266667%204.266667%200%200%200-3.328%206.912l161.792%20202.24z'%20fill='%23000000'%20p-id='38477'%3e%3c/path%3e%3cpath%20d='M685.994667%20849.152l-13.312-10.666667%2013.312%2010.666667z%20m-6.656%200l13.312-10.666667-13.312%2010.666667z%20m168.448-202.24l-13.312-10.666667%2013.312%2010.666667zM736%20640v17.066667h-17.066667V640h17.066667zM384%20288v17.066667h-17.066667v-17.066667H384z%20m-6.912-111.786667l10.666667%2013.312-10.666667-13.312z%20m-202.24%20161.792l10.666667%2013.312-10.666667-13.312z%20m0%206.656l-10.666667%2013.312%2010.666667-13.312z%20m202.24%20161.792l10.666667-13.312-10.666667%2013.312zM384%20394.666667h-17.066667v-17.066667H384v17.066667zM629.333333%20640h17.066667v17.066667h-17.066667V640z%20m-111.786666%206.912l-13.312%2010.666667%2013.312-10.666667z%20m181.76%20212.906667a21.333333%2021.333333%200%200%201-33.28%200l26.624-21.333334a12.8%2012.8%200%200%200-19.968%200l26.624%2021.333334z%20m161.792-202.24l-161.792%20202.24-26.624-21.333334%20161.792-202.24%2026.624%2021.333334z%20m-16.64-34.645334a21.333333%2021.333333%200%200%201%2016.64%2034.645334l-26.624-21.333334a12.8%2012.8%200%200%200%209.984%2020.821334v-34.133334z%20m-108.458667%200h108.458667v34.133334H736v-34.133334z%20m-17.066667%2017.066667v-32h34.133334V640h-34.133334z%20m0-32a302.933333%20302.933333%200%200%200-302.933333-302.933333v-34.133334a337.066667%20337.066667%200%200%201%20337.066667%20337.066667h-34.133334z%20m-302.933333-302.933333H384v-34.133334h32v34.133334zM401.066667%20179.541333V288h-34.133334V179.541333h34.133334z%20m-34.645334-16.64a21.333333%2021.333333%200%200%201%2034.645334%2016.64h-34.133334a12.8%2012.8%200%200%200%2020.778667%209.984l-21.333333-26.624zM164.181333%20324.693333l202.24-161.792%2021.333334%2026.624-202.24%20161.792-21.333334-26.624z%20m0%2033.28a21.333333%2021.333333%200%200%201%200-33.28l21.333334%2026.624a12.8%2012.8%200%200%200%200-19.968l-21.333334%2026.624z%20m202.24%20161.792L164.181333%20357.973333l21.333334-26.624%20202.24%20161.792-21.333334%2026.624z%20m34.645334-16.64a21.333333%2021.333333%200%200%201-34.645334%2016.64l21.333334-26.624a12.8%2012.8%200%200%200-20.821334%209.984h34.133334z%20m0-108.458666v108.458666h-34.133334V394.666667h34.133334z%20m-17.066667-17.066667h32v34.133333H384v-34.133333z%20m32%200a230.4%20230.4%200%200%201%20230.4%20230.4h-34.133333a196.266667%20196.266667%200%200%200-196.266667-196.266667v-34.133333z%20m230.4%20230.4V640h-34.133333v-32h34.133333z%20m-125.525333%2014.933333h108.458666v34.133334h-108.458666v-34.133334z%20m-16.64%2034.645334a21.333333%2021.333333%200%200%201%2016.64-34.645334v34.133334a12.8%2012.8%200%200%200%209.984-20.778667l-26.624%2021.333333z%20m161.792%20202.24l-161.792-202.24%2026.624-21.333334%20161.792%20202.24-26.624%2021.333334z'%20fill='%23FFFFFF'%20p-id='38478'%3e%3c/path%3e%3c/svg%3e";class st extends Ie{constructor(e,s,r){super(e,r);g(this,"type",ue.vertices);this.type=s}get img(){switch(this.type){case ue.vertices:return so;case ue.border:return ro;case ue.hand:return no;case ue.cross:return io;case ue.move:return oo;case ue.rotation:return ao}}async run(){if(!this.canvas||!this.model)return;let{point:{x:e,y:s},width:r,height:n}=this.model;await F.drawImgLike(this.canvas,this.img,{x:(e-r/F.scale/2)*F.scale,y:(s-n/F.scale/2)*F.scale,width:r,height:n},{angle:this.model.angle})}}class lo{constructor(t){g(this,"value");g(this,"shield");this.shield=t,this.value=null}get worldValue(){return this.value?P.calcWorldCoord(this.value):null}get renderParams(){return{canvas:this.shield.mask.node}}clear(){this.value=null}transform(t){return this.shield.stageRect?(this.value=v.getEventPosition(t,this.shield.stageRect,this.shield.stageScale),this.value.x=Math.round(this.value.x),this.value.y=Math.round(this.value.y),this.value):{x:0,y:0}}setStyle(t){this.shield.node.style.cursor=t}updateStyle(t){this.shield.selection.getActiveController()||this.shield.isDrawerActive||this.shield.isTextCreating?this.setStyle("none"):this.shield.isHandActive?this.setStyle("grab"):this.setStyle("default")}getTask(){if(this.shield.isDrawerActive||this.shield.isTextCreating)return this.createMaskDrawingCursorTask();if(this.shield.isMoveableActive){const t=this.shield.selection.getActiveController();if(t instanceof Cr)return this.createMaskRotationControllerCursorTask(t);if(t instanceof ct||t instanceof wt)return this.createMaskRotationCursorTask(t);if(t instanceof Xe)return this.createMaskTransformerCursorTask(t);if(t instanceof at)return this.createMaskBorderTransformerCursorTask(t)}}createMaskDrawingCursorTask(){if(this.value)return new st(this._createTransformerCursorModel(),ue.cross,this.renderParams)}createMaskRotationCursorTask(t){if(this.value)return new st(this._createTransformerCursorModel({angle:t.angle}),ue.move,this.renderParams)}createMaskRotationControllerCursorTask(t){if(this.value)return new st(this._createTransformerCursorModel({angle:t.angle}),ue.rotation,this.renderParams)}createMaskBorderTransformerCursorTask(t){if(this.value)return new st(this._createTransformerCursorModel(t),ue.border,this.renderParams)}createMaskTransformerCursorTask(t){if(this.value)return new st(this._createTransformerCursorModel(t),ue.vertices,this.renderParams)}_createTransformerCursorModel(t){return{point:this.value,type:le.cursor,width:Bs,height:Bs,angle:(t==null?void 0:t.angle)||0}}}class re{static stopPP(t){t.stopPropagation(),t.preventDefault()}}var br=function(){if(typeof Map<"u")return Map;function i(t,e){var s=-1;return t.some(function(r,n){return r[0]===e?(s=n,!0):!1}),s}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(e){var s=i(this.__entries__,e),r=this.__entries__[s];return r&&r[1]},t.prototype.set=function(e,s){var r=i(this.__entries__,e);~r?this.__entries__[r][1]=s:this.__entries__.push([e,s])},t.prototype.delete=function(e){var s=this.__entries__,r=i(s,e);~r&&s.splice(r,1)},t.prototype.has=function(e){return!!~i(this.__entries__,e)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,s){s===void 0&&(s=null);for(var r=0,n=this.__entries__;r<n.length;r++){var o=n[r];e.call(s,o[1],o[0])}},t}()}(),rs=typeof window<"u"&&typeof document<"u"&&window.document===document,xt=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),co=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(xt):function(i){return setTimeout(function(){return i(Date.now())},1e3/60)}}(),ho=2;function uo(i,t){var e=!1,s=!1,r=0;function n(){e&&(e=!1,i()),s&&a()}function o(){co(n)}function a(){var l=Date.now();if(e){if(l-r<ho)return;s=!0}else e=!0,s=!1,setTimeout(o,t);r=l}return a}var go=20,fo=["top","right","bottom","left","width","height","size","weight"],mo=typeof MutationObserver<"u",po=function(){function i(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=uo(this.refresh.bind(this),go)}return i.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},i.prototype.removeObserver=function(t){var e=this.observers_,s=e.indexOf(t);~s&&e.splice(s,1),!e.length&&this.connected_&&this.disconnect_()},i.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},i.prototype.updateObservers_=function(){var t=this.observers_.filter(function(e){return e.gatherActive(),e.hasActive()});return t.forEach(function(e){return e.broadcastActive()}),t.length>0},i.prototype.connect_=function(){!rs||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),mo?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},i.prototype.disconnect_=function(){!rs||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},i.prototype.onTransitionEnd_=function(t){var e=t.propertyName,s=e===void 0?"":e,r=fo.some(function(n){return!!~s.indexOf(n)});r&&this.refresh()},i.getInstance=function(){return this.instance_||(this.instance_=new i),this.instance_},i.instance_=null,i}(),Ar=function(i,t){for(var e=0,s=Object.keys(t);e<s.length;e++){var r=s[e];Object.defineProperty(i,r,{value:t[r],enumerable:!1,writable:!1,configurable:!0})}return i},Je=function(i){var t=i&&i.ownerDocument&&i.ownerDocument.defaultView;return t||xt},Pr=It(0,0,0,0);function St(i){return parseFloat(i)||0}function Ns(i){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return t.reduce(function(s,r){var n=i["border-"+r+"-width"];return s+St(n)},0)}function Co(i){for(var t=["top","right","bottom","left"],e={},s=0,r=t;s<r.length;s++){var n=r[s],o=i["padding-"+n];e[n]=St(o)}return e}function yo(i){var t=i.getBBox();return It(0,0,t.width,t.height)}function Eo(i){var t=i.clientWidth,e=i.clientHeight;if(!t&&!e)return Pr;var s=Je(i).getComputedStyle(i),r=Co(s),n=r.left+r.right,o=r.top+r.bottom,a=St(s.width),l=St(s.height);if(s.boxSizing==="border-box"&&(Math.round(a+n)!==t&&(a-=Ns(s,"left","right")+n),Math.round(l+o)!==e&&(l-=Ns(s,"top","bottom")+o)),!wo(i)){var h=Math.round(a+n)-t,d=Math.round(l+o)-e;Math.abs(h)!==1&&(a-=h),Math.abs(d)!==1&&(l-=d)}return It(r.left,r.top,a,l)}var _o=function(){return typeof SVGGraphicsElement<"u"?function(i){return i instanceof Je(i).SVGGraphicsElement}:function(i){return i instanceof Je(i).SVGElement&&typeof i.getBBox=="function"}}();function wo(i){return i===Je(i).document.documentElement}function vo(i){return rs?_o(i)?yo(i):Eo(i):Pr}function xo(i){var t=i.x,e=i.y,s=i.width,r=i.height,n=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,o=Object.create(n.prototype);return Ar(o,{x:t,y:e,width:s,height:r,top:e,right:t+s,bottom:r+e,left:t}),o}function It(i,t,e,s){return{x:i,y:t,width:e,height:s}}var So=function(){function i(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=It(0,0,0,0),this.target=t}return i.prototype.isActive=function(){var t=vo(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},i.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},i}(),bo=function(){function i(t,e){var s=xo(e);Ar(this,{target:t,contentRect:s})}return i}(),Ao=function(){function i(t,e,s){if(this.activeObservations_=[],this.observations_=new br,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=e,this.callbackCtx_=s}return i.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof Je(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new So(t)),this.controller_.addObserver(this),this.controller_.refresh())}},i.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof Je(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},i.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},i.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(e){e.isActive()&&t.activeObservations_.push(e)})},i.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map(function(s){return new bo(s.target,s.broadcastRect())});this.callback_.call(t,e,t),this.clearActive()}},i.prototype.clearActive=function(){this.activeObservations_.splice(0)},i.prototype.hasActive=function(){return this.activeObservations_.length>0},i}(),Rr=typeof WeakMap<"u"?new WeakMap:new br,Tr=function(){function i(t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var e=po.getInstance(),s=new Ao(t,e,this);Rr.set(this,s)}return i}();["observe","unobserve","disconnect"].forEach(function(i){Tr.prototype[i]=function(){var t;return(t=Rr.get(this))[i].apply(t,arguments)}});var Po=function(){return typeof xt.ResizeObserver<"u"?xt.ResizeObserver:Tr}();const Ro=typeof window>"u",To=function(i){for(const t of i){const e=t.target.__resizeListeners__||[];e.length&&e.forEach(s=>{s(t)})}};class ko{static addListener(t,e){Ro||t&&(t.__resizeListeners__||(t.__resizeListeners__=[],t.__ro__=new Po(To),t.__ro__.observe(t)),t.__resizeListeners__.push(e))}static removeListener(t,e){!t||!t.__resizeListeners__||(t.__resizeListeners__.splice(t.__resizeListeners__.indexOf(e),1),t.__resizeListeners__.length||t.__ro__.disconnect())}}var Ce={},zs;function Oo(){if(zs)return Ce;zs=1,Object.defineProperty(Ce,"__esModule",{value:!0});for(var i=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),t={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},e={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:i?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},s={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},r=1;r<20;r++)s["f"+r]=111+r;function n(f,p,m){p&&!("byKey"in p)&&(m=p,p=null),Array.isArray(f)||(f=[f]);var y=f.map(function(M){return l(M,p)}),w=function($){return y.some(function(_){return h(_,$)})},D=m==null?w:w(m);return D}function o(f,p){return n(f,p)}function a(f,p){return n(f,{byKey:!0},p)}function l(f,p){var m=p&&p.byKey,y={};f=f.replace("++","+add");var w=f.split("+"),D=w.length;for(var M in t)y[t[M]]=!1;var $=!0,_=!1,E=void 0;try{for(var S=w[Symbol.iterator](),L;!($=(L=S.next()).done);$=!0){var I=L.value,j=I.endsWith("?")&&I.length>1;j&&(I=I.slice(0,-1));var z=u(I),se=t[z];if(I.length>1&&!se&&!e[I]&&!s[z])throw new TypeError('Unknown modifier: "'+I+'"');(D===1||!se)&&(m?y.key=z:y.which=d(I)),se&&(y[se]=j?null:!0)}}catch(Ae){_=!0,E=Ae}finally{try{!$&&S.return&&S.return()}finally{if(_)throw E}}return y}function h(f,p){for(var m in f){var y=f[m],w=void 0;if(y!=null&&(m==="key"&&p.key!=null?w=p.key.toLowerCase():m==="which"?w=y===91&&p.which===93?91:p.which:w=p[m],!(w==null&&y===!1)&&w!==y))return!1}return!0}function d(f){f=u(f);var p=s[f]||f.toUpperCase().charCodeAt(0);return p}function u(f){return f=f.toLowerCase(),f=e[f]||f,f}return Ce.default=n,Ce.isHotkey=n,Ce.isCodeHotkey=o,Ce.isKeyHotkey=a,Ce.parseHotkey=l,Ce.compareHotkey=h,Ce.toKeyCode=d,Ce.toKeyName=u,Ce}var Lo=Oo();const ie=cn(Lo);class Io extends Tt{constructor(e){super();g(this,"func");this.func=e}async run(){await this.func()}async destroy(){}}class Bo extends Io{}class $e{static getImageDataFromClipboard(t){return new Promise((e,s)=>{var a;const r=(a=t.clipboardData)==null?void 0:a.items;if(!r)return console.warn("No clipboard data"),s();const n=Array.from(r).filter(l=>l.type.startsWith("image/"));if(!n.length)return console.warn("No image in clipboard"),s();const o=Promise.all(n.map(l=>{const h=l.getAsFile();if(!h){console.warn("No blob in clipboard"),s();return}return F.getImageDataFromBlob(h)}));e(o)})}static getImageDataFromFileTransfer(t){return new Promise((e,s)=>{var n;const r=(n=t.dataTransfer)==null?void 0:n.files;if(!r)return console.warn("No files in drag event"),s();$e.parseImageFiles(Array.from(r),e,s)})}static getImageDataFromFiles(t){return new Promise((e,s)=>$e.parseImageFiles(t,e,s))}static parseImageFiles(t,e,s){const r=Array.from(t).filter(o=>o.type.startsWith("image/"));if(!r.length)return console.warn("No image in files"),s();const n=Promise.all(r.map(o=>F.getImageDataFromBlob(o)));e(n)}}class Mo extends ys.EventEmitter{constructor(e){super();g(this,"shield");g(this,"_isCtrl");g(this,"_isCtrlWheel");g(this,"_isShift");g(this,"_isCtrlEvent");g(this,"_isCtrlPlusEvent");g(this,"_isCtrlReduceEvent");g(this,"_isCtrl0Event");g(this,"_isCtrlAEvent");g(this,"_isCtrlMEvent");g(this,"_isCtrlHEvent");g(this,"_isCtrlGEvent");g(this,"_isCtrlCEvent");g(this,"_isCtrlZEvent");g(this,"_isCtrlYEvent");g(this,"_isCtrlShiftGEvent");g(this,"_isShiftEvent");g(this,"_isShift1Event");g(this,"_isDeleteEvent");g(this,"_isEscEvent");this.shield=e}get isCtrl(){return this._isCtrl}get isOnlyCtrl(){return this._isCtrl&&!this._isShift}get isCtrlWheel(){return this._isCtrlWheel}get isShift(){return this._isShift}get isOnlyShift(){return this._isShift&&!this._isCtrl}init(){this._isCtrl=!1,this._isCtrlWheel=!1,this._isCtrlEvent=ie("ctrl"),this._isCtrlPlusEvent=ie("ctrl+="),this._isCtrlReduceEvent=ie("ctrl+-"),this._isCtrl0Event=ie("ctrl+0"),this._isShiftEvent=ie("shift"),this._isShift1Event=ie("shift+1"),this._isDeleteEvent=ie("backspace"),this._isCtrlAEvent=ie("ctrl+a"),this._isCtrlMEvent=ie("ctrl+m"),this._isCtrlHEvent=ie("ctrl+h"),this._isCtrlGEvent=ie("ctrl+g"),this._isCtrlCEvent=ie("ctrl+c"),this._isCtrlZEvent=ie("ctrl+z"),this._isCtrlYEvent=ie("ctrl+y"),this._isCtrlShiftGEvent=ie("ctrl+shift+g"),this._isEscEvent=ie("esc"),this.initEvents()}async initEvents(){Promise.all([this.initRenderResizeEvent(),this.initMouseEvents()])}_isInputEvent(e){return e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement}async initRenderResizeEvent(){ko.addListener(this.shield.renderEl,e=>{this.emit("resize",e)})}_createImages(e){if(e&&e.length){let s=new Gi;e.forEach((r,n)=>{s.add(new Bo(async()=>{await new Promise(o=>{this.emit("pasteImage",r,async()=>{await xr.wait(100),o(!0)})}),n===e.length-1&&(await s.destroy(),s=null)}))})}}async initMouseEvents(){this.shield.node.addEventListener("mousemove",e=>{this.emit("cursorMove",e)}),this.shield.node.addEventListener("mouseleave",e=>{this.emit("cursorLeave",e)}),this.shield.node.addEventListener("mousedown",e=>{this.emit("pressDown",e)}),this.shield.node.addEventListener("mouseup",e=>{this.emit("pressUp",e)}),this.shield.node.addEventListener("dblclick",e=>{this.emit("dblClick",e)}),this.shield.node.addEventListener("wheel",e=>{re.stopPP(e),this._isCtrlWheel=this._isCtrl,this._isCtrlWheel?this.emit("wheelScale",-e.deltaY/2e3,e):this.emit("wheelMove",{x:e.deltaX,y:e.deltaY},e)}),this.shield.node.addEventListener("dragover",e=>{re.stopPP(e)}),this.shield.node.addEventListener("drop",e=>{re.stopPP(e),$e.getImageDataFromFileTransfer(e).then(s=>{this._createImages(s)}).catch(s=>{s&&console.warn(s)})}),document.addEventListener("keydown",e=>{this._isCtrl=this._isCtrlEvent(e),this._isCtrlPlusEvent(e)&&(re.stopPP(e),this.emit("scaleIncrease")),this._isCtrlReduceEvent(e)&&(re.stopPP(e),this.emit("scaleReduce")),this._isCtrl0Event(e)&&(re.stopPP(e),this.emit("scale100")),this._isShift1Event(e)?(re.stopPP(e),this.emit("scaleAutoFit")):this._isShiftEvent(e)?this._isShift=!0:this._isShift=!1,this._isInputEvent(e)||(this._isDeleteEvent(e)&&(re.stopPP(e),this.emit("deleteSelects")),this._isCtrlAEvent(e)&&(re.stopPP(e),this.emit("selectAll")),this._isCtrlMEvent(e)&&(re.stopPP(e),this.emit("selectMoveable")),this._isCtrlHEvent(e)&&(re.stopPP(e),this.emit("selectHand")),this._isCtrlGEvent(e)&&(re.stopPP(e),this.emit("selectGroup")),this._isCtrlCEvent(e)&&(re.stopPP(e),this.emit("selectCopy",e)),this._isCtrlZEvent(e)&&(re.stopPP(e),this.emit("undo")),this._isCtrlYEvent(e)&&(re.stopPP(e),this.emit("redo")),this._isCtrlShiftGEvent(e)&&(re.stopPP(e),this.emit("selectGroupCancel")),this._isEscEvent(e)&&(re.stopPP(e),this.emit("cancel")))}),document.addEventListener("keyup",e=>{this._isCtrl=e.ctrlKey,this._isShift=e.shiftKey}),document.addEventListener("paste",e=>{this._isInputEvent(e)||$e.getImageDataFromClipboard(e).then(s=>{this._createImages(s)}).catch(s=>{s&&console.warn(s);try{const r=JSON.parse(e.clipboardData.getData("text/plain"));r&&this.emit("pasteElements",r)}catch(r){r&&console.warn(r)}})})}async onImagesUpload(e){if(e.length){const s=await $e.getImageDataFromFiles(e);this._createImages(s)}}}class Fo extends _s{constructor(){super(...arguments);g(this,"_lastestStageElementsSize",0)}async redraw(e){const{stageElements:s}=this.drawer.store;if(e||s.length!==this._lastestStageElementsSize){this._lastestStageElementsSize=s.length;const r=new Es([]);r.add(new Sr(null,this.renderParams)),s.forEach(n=>{const o=P.createElementTask(n,this.renderParams);o&&r.add(o)}),await this.renderCargo(r)}}}const Vs={rotationIconEnable:!0};class Do{constructor(){g(this,"_configs",Vs);this.config(Vs),vn({enforceActions:"never"})}get rotationIconEnable(){return this._configs.rotationIconEnable}config(t){Object.assign(this._configs,t)}}var q=(i=>(i[i.NONE=0]="NONE",i[i.MOVING=1]="MOVING",i[i.ROTATING=2]="ROTATING",i[i.TRANSFORMING=3]="TRANSFORMING",i[i.CORNER_MOVING=4]="CORNER_MOVING",i))(q||{});class Wo{constructor(t){g(this,"shield");this.shield=t}_getElementsCoordsRect(t){return v.getRect(t.map(e=>this._getElementAlignCoords(e)).flat())}_calcElementsAllWidth(t){let e=0;return t.forEach(s=>{const r=v.getRect(this._getElementAlignCoords(s));e+=r.width}),e}_calcElementsAllHeight(t){let e=0;return t.forEach(s=>{const r=v.getRect(this._getElementAlignCoords(s));e+=r.height}),e}_sortElementsByX(t){return R.sortBy(t,e=>v.getRect(this._getElementAlignCoords(e)).x)}_sortElementsByXW(t){return R.sortBy(t,e=>{const{x:s,width:r}=v.getRect(this._getElementAlignCoords(e));return s+r})}_sortElementsByY(t){return R.sortBy(t,e=>v.getRect(this._getElementAlignCoords(e)).y)}_sortElementsByYH(t){return R.sortBy(t,e=>{const{y:s,height:r}=v.getRect(this._getElementAlignCoords(e));return s+r})}_getElementAlignCoords(t){return this.shield.event.isShift?t.alignOutlineCoords.flat():t.alignCoords}_setElementPositionByOffset(t,e,s){const r={x:e,y:s};t.setPosition(t.model.x+e,t.model.y+s,r),t.isGroup&&!t.isGroupSubject&&t.deepSubs.forEach(n=>{n.setPosition(n.model.x+e,n.model.y+s,r)})}setElementsAlignLeft(t){t=P.getNoParentElements(t);const{x:e}=this._getElementsCoordsRect(t);t.forEach(s=>{const{x:r}=v.getRect(this._getElementAlignCoords(s)),n=e-r;n!==0&&this._setElementPositionByOffset(s,n,0)})}setElementsAlignRight(t){t=P.getNoParentElements(t);const{x:e,width:s}=this._getElementsCoordsRect(t);t.forEach(r=>{const{x:n,width:o}=v.getRect(this._getElementAlignCoords(r)),a=e+s-n-o;a!==0&&this._setElementPositionByOffset(r,a,0)})}setElementsAlignTop(t){t=P.getNoParentElements(t);const{y:e}=this._getElementsCoordsRect(t);t.forEach(s=>{const{y:r}=v.getRect(this._getElementAlignCoords(s)),n=e-r;n!==0&&this._setElementPositionByOffset(s,0,n)})}setElementsAlignBottom(t){t=P.getNoParentElements(t);const{y:e,height:s}=this._getElementsCoordsRect(t);t.forEach(r=>{const{y:n,height:o}=v.getRect(this._getElementAlignCoords(r)),a=e+s-n-o;a!==0&&this._setElementPositionByOffset(r,0,a)})}setElementsAlignCenter(t){t=P.getNoParentElements(t);const{x:e,width:s}=this._getElementsCoordsRect(t);t.forEach(r=>{const{x:n,width:o}=v.getRect(this._getElementAlignCoords(r)),a=e+s/2-(n+o/2);a!==0&&this._setElementPositionByOffset(r,a,0)})}setElementsAlignMiddle(t){t=P.getNoParentElements(t);const{y:e,height:s}=this._getElementsCoordsRect(t);t.forEach(r=>{const{y:n,height:o}=v.getRect(this._getElementAlignCoords(r)),a=e+s/2-(n+o/2);a!==0&&this._setElementPositionByOffset(r,0,a)})}setElementsAverageVertical(t){t=P.getNoParentElements(t),t=this._sortElementsByY(t);const{y:e,height:s}=this._getElementsCoordsRect(t),r=v.getRect(this._getElementAlignCoords(t[0]));let n=e+r.height;const o=this._calcElementsAllHeight(t),a=(s-o)/(t.length-1);t=this._sortElementsByYH(t.slice(1)),t.forEach((l,h)=>{if(h!==t.length-1){const{y:d,height:u}=v.getRect(this._getElementAlignCoords(l)),f=n+a-d;f!==0&&this._setElementPositionByOffset(l,0,f),n=d+f+u}})}setElementsAverageHorizontal(t){t=P.getNoParentElements(t),t=this._sortElementsByX(t);const{x:e,width:s}=this._getElementsCoordsRect(t),r=v.getRect(this._getElementAlignCoords(t[0]));let n=e+r.width;const o=this._calcElementsAllWidth(t),a=(s-o)/(t.length-1);t=this._sortElementsByXW(t.slice(1)),t.forEach((l,h)=>{if(h!==t.length-1){const{x:d,width:u}=v.getRect(this._getElementAlignCoords(l)),f=n+a-d;f!==0&&this._setElementPositionByOffset(l,f,0),n=d+f+u}})}}class No{static copyValueToClipboard(t){let e=document.createElement("input");document.body.appendChild(e),e.value=t,e.select(),document.execCommand("copy"),document.body.removeChild(e),e=null}}class zo{constructor(t){g(this,"shield");g(this,"undoStack",[]);g(this,"redoStack",[]);this.shield=t}get tailUndoCommand(){return this.undoStack[this.undoStack.length-1]}get tailRedoCommand(){return this.redoStack[this.redoStack.length-1]}add(t){this.undoStack.push(t),this.redoStack=[]}undo(){if(this.undoStack.length>0){const t=this.undoStack.pop();this.redoStack.push(t),t.undo()}}redo(){if(this.redoStack.length>0){const t=this.redoStack.pop();this.undoStack.push(t),t.redo()}}}var Be=(i=>(i.ElementsAdded="elements_added",i.ElementsRemoved="elements_removed",i.ElementsUpdated="elements_updated",i.ElementsRearranged="elements_rearranged",i.GroupAdded="group_added",i.GroupRemoved="group_removed",i))(Be||{});class Qe{constructor(t,e){g(this,"payload");g(this,"store");this.payload=t,this.store=e}undo(){throw new Error("Method not implemented.")}redo(){throw new Error("Method not implemented.")}}class Vo extends Qe{undo(){this.payload.dataList.forEach(t=>{const{model:{id:e}}=t;this.store.removeElement(e)})}redo(){this.payload.dataList.forEach(t=>{this.store.afterAddElementByModel(H.jsonClone(t.model))})}}class Yt extends Qe{_restoreElementsFromData(t){t.forEach(e=>{const{model:s}=e,r=this.store.updateElementModel(s.id,H.jsonClone(s));r&&(r.refreshFlipX(),r.refresh())})}undo(){this.payload.dataList&&this._restoreElementsFromData(this.payload.dataList)}redo(){this.payload.rDataList&&this._restoreElementsFromData(this.payload.rDataList)}}class jo extends Qe{undo(){this.payload.dataList.forEach(t=>{const{prevId:e,model:s}=t;let r;e&&(r=this.store.getElementById(e)),this.store.afterAddElementByModel(H.jsonClone(s),r,!e)})}redo(){this.payload.dataList.forEach(t=>{const{model:{id:e}}=t;this.store.removeElement(e)})}}class Go extends Qe{undo(){this.payload.dataList.forEach(t=>{const{model:{id:e},isGroup:s,isGroupSubject:r,prevId:n}=t;if(s)this.store.removeElement(e);else{const o=this.store.getElementById(e);o&&(r&&this.store.updateElementModel(e,{groupId:void 0}),this.store.rearrangeElementAfter(o,n?this.store.getElementById(n):null,!0))}}),this.store.resortElementsArray(),this.store.emitElementsLayerChanged()}redo(){for(let t=this.payload.rDataList.length-1;t>=0;t--){const e=this.payload.rDataList[t],{model:{id:s,groupId:r},isGroup:n,isGroupSubject:o,nextId:a}=e;if(n)this.store.beforeAddElementByModel(H.jsonClone(e.model),a?this.store.getElementById(a):null,!0);else{const l=this.store.getElementById(s);l&&(o&&this.store.updateElementModel(s,{groupId:r}),this.store.rearrangeElementBefore(l,a?this.store.getElementById(a):null,!0))}}this.store.resortElementsArray(),this.store.emitElementsLayerChanged()}}class Ho extends Qe{undo(){this.payload.dataList.forEach(t=>{const{model:{id:e,groupId:s},isGroup:r,prevId:n}=t;r?this.store.afterAddElementByModel(H.jsonClone(t.model),n?this.store.getElementById(n):null,!0):this.store.updateElementModel(e,{groupId:s})})}redo(){this.payload.dataList.forEach(t=>{const{model:{id:e},isGroup:s}=t;s?this.store.removeElement(e):this.store.updateElementModel(e,{groupId:void 0})})}}class $o extends Qe{_rearrange(t){t.forEach(e=>{const{model:{id:s},prevId:r}=e,n=this.store.getElementById(s);n&&this.store.rearrangeElementAfter(n,r?this.store.getElementById(r):null,!0)}),this.store.resortElementsArray(),this.store.emitElementsLayerChanged()}undo(){this.payload.dataList&&this._rearrange(this.payload.dataList)}redo(){this.payload.rDataList&&this._rearrange(this.payload.rDataList)}}const js=200,Gs=20;class Yo extends Lt{constructor(){super(...arguments);g(this,"textEditor");g(this,"_textEditorPosition")}initNode(){return this.node=document.createElement("div"),this.node.id="html-drawer",this.initStyle(),this._initStyleSheet(),this.node}updateSize(e){const{width:s,height:r}=e,{stageScale:n}=this.shield;Object.assign(this.node.style,{width:`${s/n}px`,height:`${r/n}px`,transform:`scale(${n})`})}createTextInput(e){if(this.textEditor)return this.textEditor;const s=this._createInputElement(e);return this._addInputEvents(s),this.node.appendChild(s),setTimeout(()=>{s.setSelectionRange(0,0),s.focus()},0),this.textEditor=s,s}_initStyleSheet(){const e=document.createElement("style");e.innerHTML=`
        #html-drawer {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            transform-origin: top left;
        }
        #html-drawer textarea {
            position: absolute;
            top: 0;
            left: 0;
            min-width: 0;
            min-height: 0;
            overflow: visible;
            padding: 0;
            margin: 0;
            border: none;
            outline: none;
            resize: none;
            word-break: break-word;
            white-space: nowrap;
            pointer-events: auto;
            background: transparent;
            caret-color: #000;
            color: #000;
            box-sizing: border-box;
        }
        #html-drawer textarea::-webkit-scrollbar {
            display: none;
        }
        #html-drawer textarea {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    `,document.head.appendChild(e)}_updateInputStyleWhileInputing(){let{width:e,height:s}=hs.measureTextWithSpan(this.textEditor.value,xe);e=Math.max(e,js),s=Math.max(s,Gs),Object.assign(this.textEditor.style,{minWidth:`${e}px`,minHeight:`${s}px`})}_addInputEvents(e){e.addEventListener("blur",()=>{this.textEditor.value&&this.emit("input",this.textEditor.value,xe,{width:e.offsetWidth,height:e.offsetHeight},this._textEditorPosition),this.textEditor.remove(),this.textEditor=null}),e.addEventListener("keydown",s=>{s.key==="Enter"&&this._updateInputStyleWhileInputing()}),e.addEventListener("input",()=>{this._updateInputStyleWhileInputing()})}_createInputElement(e){this._textEditorPosition=e;const s=1/this.shield.stageScale,r=document.createElement("textarea");return Object.assign(r.style,{top:`${e.y}px`,left:`${e.x}px`,minWidth:`${js}px`,minHeight:`${Gs}px`,boxShadow:`0 -${s}px 0 0 ${it}, -${s}px 0 0 0 ${it}, ${s}px 0 0 0 ${it}, 0 ${s}px 0 0 ${it}`,fontSize:`${xe.fontSize}px`,fontFamily:xe.fontFamily,lineHeight:`${xe.fontLineHeight}`,color:Kt.hashToRgba(xe.fontColor,xe.fontColorOpacity),verticalAlign:xe.textBaseline,textAlign:xe.textAlign}),r}}class qo extends Lt{constructor(){super();g(this,"currentCreator");g(this,"cursor");g(this,"mask");g(this,"provisional");g(this,"html");g(this,"configure");g(this,"store");g(this,"selection");g(this,"event");g(this,"align");g(this,"undo");g(this,"stageScale",1);g(this,"stageWorldCoord",{x:0,y:0});g(this,"stageRect");g(this,"renderEl");g(this,"elementsStatus",q.NONE);g(this,"_cursorMoveQueue",new vt);g(this,"_redrawQueue",new vt);g(this,"_shouldRedraw",!1);g(this,"_latestMousedownTimestamp",0);g(this,"_shouldSelectTopAWhilePressUp",!0);g(this,"_pressDownPosition");g(this,"_pressDownStageWorldCoord");g(this,"_pressUpPosition");g(this,"_pressUpStageWorldCoord");g(this,"_pressMovePosition");g(this,"_pressMoveStageWorldCoord");g(this,"_isPressDown",!1);g(this,"_isStageMoving",!1);g(this,"_originalStageWorldCoord");g(this,"_originalEditingDataList");this.configure=new Do,this.event=new Mo(this),this.store=new zi(this),this.cursor=new lo(this),this.provisional=new eo(this),this.html=new Yo(this),this.selection=new to(this),this.align=new Wo(this),this.mask=new Qi(this),this.undo=new zo(this),this.renderer=new Fo(this),this._requestAnimationRedraw(),window.shield=this}get stageRectPoints(){return v.getRectVertices(this.stageRect)}get stageWordRectCoords(){return v.getBoxVertices(this.stageWorldCoord,{width:this.stageRect.width/this.stageScale,height:this.stageRect.height/this.stageScale})}get isElementsBusy(){return[q.ROTATING,q.MOVING,q.TRANSFORMING,q.CORNER_MOVING].includes(this.elementsStatus)}get isStageMoving(){return this._isStageMoving}get isDrawerActive(){var e;return[te.shapes,te.freedom].includes((e=this.currentCreator)==null?void 0:e.category)}get isTextCreating(){var e;return[te.text].includes((e=this.currentCreator)==null?void 0:e.category)}get isTextEditing(){return!this.store.isEditingEmpty&&this.store.editingElements[0].model.type===A.text}get isHandActive(){var e;return((e=this.currentCreator)==null?void 0:e.type)===A.hand}get isMoveableActive(){var e;return((e=this.currentCreator)==null?void 0:e.type)===A.moveable}get isArbitraryDrawing(){var e;return((e=this.currentCreator)==null?void 0:e.type)===A.arbitrary}get isArbitraryEditing(){return!this.store.isEditingEmpty&&this.store.editingElements[0].model.type===A.arbitrary}get stageCalcParams(){return{rect:this.stageRect,worldCoord:this.stageWorldCoord,scale:this.stageScale}}get movingOffset(){return{x:Math.floor(this._pressMoveStageWorldCoord.x-this._pressDownStageWorldCoord.x),y:Math.floor(this._pressMoveStageWorldCoord.y-this._pressDownStageWorldCoord.y)}}_addRedrawTask(e,s){this._redrawQueue.add({run:async()=>{await Promise.all([this.redraw(s),this.mask.redraw(),this.provisional.redraw()]),e&&await e()}})}async _requestAnimationRedraw(){requestAnimationFrame(async()=>{this._addRedrawTask(()=>this._requestAnimationRedraw(),this._shouldRedraw),this._shouldRedraw=!1})}_createUpdateCommandBy(e,s){const r=new Yt({type:Be.ElementsUpdated,dataList:e,rDataList:s},this.store);this.undo.add(r)}async _createTranslateCommand(e,s){const r=await Promise.all(e.map(async o=>({model:await o.toTranslateJson()})));await s();const n=await Promise.all(e.map(async o=>({model:await o.toTranslateJson()})));this._createUpdateCommandBy(r,n)}async setElementsPosition(e,s){await this._createTranslateCommand(e,async()=>{await this.store.setElementsPosition(e,s)}),e.forEach(r=>r.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async _createTransformCommand(e,s){const r=await Promise.all(e.map(async o=>({model:await o.toTransformJson()})));await s();const n=await Promise.all(e.map(async o=>({model:await o.toTransformJson()})));this._createUpdateCommandBy(r,n)}async setElementsWidth(e,s){await this._createTransformCommand(e,async()=>{await this.store.setElementsWidth(e,s)}),e.forEach(r=>r.onWidthChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsHeight(e,s){await this._createTransformCommand(e,async()=>{await this.store.setElementsHeight(e,s)}),e.forEach(r=>r.onHeightChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsLeanYAngle(e,s){await this._createTransformCommand(e,async()=>{await this.store.setElementsLeanYAngle(e,s)}),e.forEach(r=>r.onLeanyAngleChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAngle(e,s){await this._createTransformCommand(e,async()=>{await this.store.setElementsAngle(e,s)}),e.forEach(r=>r.onAngleChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsCorners(e,s,r){const n=await Promise.all(e.map(async a=>({model:await a.toCornerJson()})));await this.store.setElementsCorners(e,s,r);const o=await Promise.all(e.map(async a=>({model:await a.toCornerJson()})));this._createUpdateCommandBy(n,o),e.forEach(a=>a.onCornerChanged()),this._shouldRedraw=!0}async _createStrokeCommand(e,s){const r=await Promise.all(e.map(async o=>({model:await o.toStrokesJson(),isStroke:!0,isStyle:!0})));await s();const n=await Promise.all(e.map(async o=>({model:await o.toStrokesJson(),isStroke:!0,isStyle:!0})));this._createUpdateCommandBy(r,n)}async setElementsStrokeType(e,s,r){await this._createStrokeCommand(e,async()=>{await this.store.setElementsStrokeType(e,s,r)}),e.forEach(n=>n.onStrokeTypeChanged()),this._shouldRedraw=!0}async setElementsStrokeWidth(e,s,r){await this._createStrokeCommand(e,async()=>{await this.store.setElementsStrokeWidth(e,s,r)}),e.forEach(n=>n.onStrokeWidthChanged()),this._shouldRedraw=!0}async setElementsStrokeColor(e,s,r){await this._createStrokeCommand(e,async()=>{await this.store.setElementsStrokeColor(e,s,r)}),e.forEach(n=>n.onStrokeColorChanged()),this._shouldRedraw=!0}async setElementsStrokeColorOpacity(e,s,r){await this._createStrokeCommand(e,async()=>{await this.store.setElementsStrokeColorOpacity(e,s,r)}),e.forEach(n=>n.onStrokeColorOpacityChanged()),this._shouldRedraw=!0}async addElementsStroke(e,s){await this._createStrokeCommand(e,async()=>{await this.store.addElementsStroke(e,s)}),e.forEach(r=>r.onStrokeAdded()),this._shouldRedraw=!0}async removeElementsStroke(e,s){await this._createStrokeCommand(e,async()=>{await this.store.removeElementsStroke(e,s)}),e.forEach(r=>r.onStrokeRemoved()),this._shouldRedraw=!0}async _createFillCommand(e,s){const r=await Promise.all(e.map(async o=>({model:await o.toFillsJson(),isFill:!0,isStyle:!0})));await s();const n=await Promise.all(e.map(async o=>({model:await o.toFillsJson(),isFill:!0,isStyle:!0})));this._createUpdateCommandBy(r,n)}async setElementsFillColor(e,s,r){await this._createFillCommand(e,async()=>{await this.store.setElementsFillColor(e,s,r)}),e.forEach(n=>n.onFillColorChanged()),this._shouldRedraw=!0}async setElementsFillColorOpacity(e,s,r){await this._createFillCommand(e,async()=>{await this.store.setElementsFillColorOpacity(e,s,r)}),e.forEach(n=>n.onFillColorOpacityChanged()),this._shouldRedraw=!0}async addElementsFill(e,s){await this._createFillCommand(e,async()=>{await this.store.addElementsFill(e,s)}),e.forEach(r=>r.onFillAdded()),this._shouldRedraw=!0}async removeElementsFill(e,s){await this._createFillCommand(e,async()=>{await this.store.removeElementsFill(e,s)}),e.forEach(r=>r.onFillRemoved()),this._shouldRedraw=!0}async setElementsTextAlign(e,s){await this.store.setElementsTextAlign(e,s),e.forEach(r=>r.onTextAlignChanged()),this._shouldRedraw=!0}async setElementsTextBaseline(e,s){await this.store.setElementsTextBaseline(e,s),e.forEach(r=>r.onTextBaselineChanged()),this._shouldRedraw=!0}async setElementsFontSize(e,s){await this.store.setElementsFontSize(e,s),e.forEach(r=>r.onFontSizeChanged()),this._shouldRedraw=!0}async setElementsFontFamily(e,s){await this.store.setElementsFontFamily(e,s),e.forEach(r=>r.onFontFamilyChanged()),this._shouldRedraw=!0}async setElementsFontLineHeight(e,s){await this.store.setElementsFontLineHeight(e,s),e.forEach(r=>r.onFontLineHeightChanged()),this._shouldRedraw=!0}async setElementsFontColor(e,s){await this.store.setElementsFontColor(e,s),e.forEach(r=>r.onFontColorChanged()),this._shouldRedraw=!0}async setElementsFontColorOpacity(e,s){await this.store.setElementsFontColorOpacity(e,s),e.forEach(r=>r.onFontColorOpacityChanged()),this._shouldRedraw=!0}async setElementsRatioLocked(e,s){await this.store.setElementsRatioLocked(e,s),e.forEach(r=>r.onRatioLockedChanged())}async init(e){this.renderEl=e,await Promise.all([this.initNode(),this.event.init()]),this._addEventListeners()}_addCursorQueueTask(e){this._cursorMoveQueue.add({run:e})}_addEventListeners(){this.event.on("resize",this._refreshSize.bind(this)),this.event.on("cursorMove",e=>this._addCursorQueueTask(()=>this._handleCursorMove(e))),this.event.on("pressDown",e=>this._addCursorQueueTask(()=>this._handlePressDown(e))),this.event.on("pressUp",e=>this._addCursorQueueTask(()=>this._handlePressUp(e))),this.event.on("cursorLeave",this._handleCursorLeave.bind(this)),this.event.on("dblClick",this._handleDblClick.bind(this)),this.event.on("wheelScale",this._handleWheelScale.bind(this)),this.event.on("wheelMove",this._handleWheelMove.bind(this)),this.event.on("scaleReduce",this._handleScaleReduce.bind(this)),this.event.on("scaleIncrease",this._handleScaleIncrease.bind(this)),this.event.on("scaleAutoFit",this._handleScaleAutoFit.bind(this)),this.event.on("scale100",this._handleScale100.bind(this)),this.event.on("pasteImage",this._handleImagePasted.bind(this)),this.event.on("deleteSelects",this._handleSelectsDelete.bind(this)),this.event.on("selectAll",this._handleSelectAll.bind(this)),this.event.on("selectCopy",this._handleSelectCopy.bind(this)),this.event.on("pasteElements",this._handlePasteElements.bind(this)),this.event.on("cancel",this._handleCancel.bind(this)),this.event.on("selectMoveable",this._handleSelectMoveable.bind(this)),this.event.on("selectHand",this._handleSelectHand.bind(this)),this.event.on("selectGroup",this._handleSelectGroup.bind(this)),this.event.on("selectGroupCancel",this._handleSelectGroupCancel.bind(this)),this.event.on("undo",this._handleUndo.bind(this)),this.event.on("redo",this._handleRedo.bind(this)),this.html.on("input",this._handleInput.bind(this))}initNode(){super.initNode();const e=this.mask.initNode(),s=this.provisional.initNode(),r=this.html.initNode();return this.renderEl.insertBefore(e,this.renderEl.firstChild),this.renderEl.insertBefore(r,this.mask.node),this.renderEl.insertBefore(s,this.html.node),this.node.id="shield",this.renderEl.insertBefore(this.node,this.provisional.node),this.node}async _doElementsOperating(){switch(this.elementsStatus){case q.ROTATING:{this._rotateElements();break}case q.MOVING:{this._dragElements();break}case q.TRANSFORMING:{this._transformElements();break}case q.CORNER_MOVING:{this._movingElementsCorner();break}}}async _updateStatusWhileElementsOperating(){![q.ROTATING,q.TRANSFORMING,q.CORNER_MOVING].includes(this.elementsStatus)&&this.store.isSelectedContainsTarget()&&this.store.isEditingEmpty&&(this.elementsStatus=q.MOVING,await this._dragElements())}async _handleCursorMove(e){this.cursor.transform(e),this.cursor.updateStyle(e),this.isMoveableActive&&!this.isElementsBusy&&this.selection.hitTargetElements(this.cursor.worldValue),this._isPressDown?(this.calcPressMove(e),this.isTextEditing?this._tryRetrieveTextCursor(!0):this.isArbitraryDrawing?(this._updatingArbitraryElementOnMovement(e),this.selection.refreshTransformerModels()):this.isDrawerActive?(this._creatingElementOnMovement(e),this.selection.refreshTransformerModels()):this.isMoveableActive?this.store.isSelectedEmpty?this._createRange():this.checkCursorPressMovedALittle(e)&&(await this._doElementsOperating(),await this._updateStatusWhileElementsOperating()):this.isHandActive&&(this._isStageMoving=!0,this._dragStage(e))):this.isMoveableActive&&this._tryActiveController(),this.isElementsBusy&&this.store.cancelTargetElements()}_tryActiveController(){return this.selection.tryActiveController(this.cursor.worldValue)}triggetEditingElementsStageChanged(){requestAnimationFrame(()=>{this.store.editingElements.forEach(e=>e.onStageChanged())})}_dragStage(e){this._refreshStageWorldCoord(e),this.store.refreshStageElements(),this.selection.refresh(),this.triggetEditingElementsStageChanged(),this._shouldRedraw=!0}_dragElements(){const{selectedElements:e}=this.store;this.store.updateElementsTranslate(e,this.movingOffset),e.forEach(s=>{s.isDragging=!0,s.onTranslating()}),this.selection.refresh(),this._shouldRedraw=!0}_movingElementsCorner(){const{selectedElements:e}=this.store;this.store.updateElementsCorner(e,this.movingOffset),e.forEach(s=>{s.isCornerMoving=!0,s.onCornerChanging()}),this._shouldRedraw=!0}_transformElements(){const{selectedElements:e}=this.store;this.store.isMultiSelected?(this.selection.rangeElement.isTransforming=!0,this.store.updateElementsTransform([this.selection.rangeElement],this.movingOffset)):this.store.updateElementsTransform(e,this.movingOffset),e.forEach(s=>{s.isTransforming=!0,s.onTransforming()}),this.selection.refresh(),this._shouldRedraw=!0}_rotateElements(){const{selectedElements:e,noParentElements:s}=this.store;this.store.isMultiSelected?(this.selection.rangeElement.isRotating=!0,this.store.updateElementsRotation([this.selection.rangeElement],this._pressMovePosition)):this.store.updateElementsRotation(s,this._pressMovePosition),e.forEach(r=>{r.isRotating=!0,r.onRotating()}),this.selection.refresh(),this._shouldRedraw=!0}_createRange(){const e=v.getBoxPoints([this._pressDownStageWorldCoord,this._pressMoveStageWorldCoord]);this.selection.setRange(e)}async _handleCursorLeave(){this.cursor.clear(),this.cursor.setStyle("default")}_toggleIntervalRedraw(e){setTimeout(()=>{this._shouldRedraw=e},0)}_preProcessRotationStates(e){this.store.updateElementById(e.host.id,{isRotatingTarget:!0}),this.store.isMultiSelected?this.store.refreshElementsRotationStates([this.selection.rangeElement],this._pressDownPosition):this.store.refreshRotatingStates(this._pressDownPosition)}_processSelectWhilePressDown(e){const s=this.selection.getElementOnCoord(this.cursor.worldValue),r=this.store.isSelectedContainsTarget();e.ctrlKey?s&&this.store.toggleSelectElement(s):r||(this._clearStageSelects(),s&&this.store.selectElement(s))}async _handlePressDown(e){if(this._latestMousedownTimestamp=window.performance.now(),this._isPressDown=!0,this.calcPressDown(e),this.isTextEditing)this._isCursorOnEditingElement()?this._tryRetrieveTextCursor():(await this._commitEidting(),this._shouldSelectTopAWhilePressUp=!1);else if(this.isTextCreating)this.html.createTextInput(this.cursor.value);else if(this.isDrawerActive&&!this.store.isSelectedEqCreating())this._clearStageSelects();else if(this.isMoveableActive){const s=this._tryActiveController();s&&this._refreshElementsOriginals([...this.store.selectedElements,this.selection.rangeElement],{deepSubs:!0}),s instanceof ct?(this._preProcessRotationStates(s),this.elementsStatus=q.ROTATING):s instanceof Xe||s instanceof at?this.elementsStatus=q.TRANSFORMING:s instanceof wt?this.elementsStatus=q.CORNER_MOVING:this._processSelectWhilePressDown(e)}else this.isHandActive&&(this._originalStageWorldCoord=H.jsonClone(this.stageWorldCoord))}_isCursorOnEditingElement(){const e=this.selection.getElementOnCoord(this.cursor.worldValue);return this.store.editingElements.includes(e)}_tryRetrieveTextCursor(e){const{selectedElements:s}=this.store,r=this.selection.getElementOnCoord(this.cursor.worldValue);r&&r instanceof Cs&&s[0]===r&&r.retrieveTextCursor(this.cursor.worldValue,e)}_refreshElementsOriginals(e,s){this.store.refreshElementsOriginalAngles(e,s),this.store.refreshElementsOriginals(e,s)}_handleArbitraryPressUp(){const e=this.store.creatingArbitraryElement(this.cursor.worldValue,!0);e!=null&&e.model.isFold&&this.commitArbitraryDrawing()}_clearStageSelects(){this.selection.clearSelects(),this.selection.setRange([])}async _endElementsOperation(){switch(this.elementsStatus){case q.MOVING:{await this._endElementsDrag();break}case q.ROTATING:{await this._endElementsRotate();break}case q.TRANSFORMING:{await this._endElementsTransform();break}case q.CORNER_MOVING:{await this._endMovingElementsCorner();break}}}_updateStatusWhileEndElementsOperation(){[q.ROTATING,q.TRANSFORMING,q.CORNER_MOVING,q.MOVING].includes(this.elementsStatus)&&this.store.isEditingEmpty&&(this.elementsStatus=q.NONE)}_selectTopAElementIfy(){this._shouldSelectTopAWhilePressUp&&this._selectTopAElement(this.store.selectedElements),this._shouldSelectTopAWhilePressUp=!0}async _handlePressUp(e){this._isPressDown=!1,this.calcPressUp(e),this.isTextEditing||(this.isArbitraryDrawing?(this._isPressDown=!0,this._handleArbitraryPressUp()):this.isDrawerActive?this.store.finishCreatingElement():this.isMoveableActive?this.store.isSelectedEmpty?(this.selection.selectRange(),this.selection.setRange(null)):this.checkCursorPressUpALittle(e)?(await this._endElementsOperation(),this._updateStatusWhileEndElementsOperation()):!e.ctrlKey&&!e.shiftKey&&this._selectTopAElementIfy():this.isHandActive&&this._processHandCreatorMove(e)),this.isArbitraryDrawing||await this._tryCreatedRedraw()}async _handleDblClick(e){if(this.isMoveableActive){const{stageElements:s,selectedElements:r}=this.store;this._selectTopAElement(s),this.store.beginEditingElements(r),this.selection.refresh(),this._originalEditingDataList=await Promise.all(r.map(async n=>({model:await n.toOriginalTransformJson()})))}}async _tryCreatedRedraw(){await Promise.all([this.selection.refresh(),this._addRedrawTask(null,!0),this.tryEmitElementCreated()])}async _createOriginalTranslateCommand(e){const s=await Promise.all(e.map(async n=>({model:await n.toOriginalTranslateJson()}))),r=await Promise.all(e.map(async n=>({model:await n.toTranslateJson()})));this._createUpdateCommandBy(s,r)}async _endElementsDrag(){const{selectedElements:e}=this.store;await this._createOriginalTranslateCommand(e),e.forEach(s=>{s.isDragging=!1,s.onTranslateAfter()}),this.store.isMultiSelected&&(this.selection.rangeElement.isDragging=!1)}async _createOrignalRotateCommand(e){const s=await Promise.all(e.map(async n=>({model:await n.toOriginalRotateJson()}))),r=await Promise.all(e.map(async n=>({model:await n.toRotateJson()})));this._createUpdateCommandBy(s,r)}async _endElementsRotate(){const{selectedElements:e}=this.store;await this._createOrignalRotateCommand(e),e.forEach(s=>{s.isRotatingTarget=!1,s.isRotating=!1,s.onRotateAfter()}),this.store.isMultiSelected&&(this.selection.rangeElement.isRotating=!1),this.store.clearRotatingStates()}async _createOriginalTransformCommand(e){const s=await Promise.all(e.map(async n=>({model:await n.toOriginalTransformJson()}))),r=await Promise.all(e.map(async n=>({model:await n.toTransformJson()})));this._createUpdateCommandBy(s,r)}async _endElementsTransform(){const{selectedElements:e,isEditingEmpty:s}=this.store;s&&(await this._createOriginalTransformCommand(e),e.forEach(r=>{r.isTransforming=!1,r.onTransformAfter()}),this.store.isMultiSelected&&(this.selection.rangeElement.isTransforming=!1))}async _createOriginalCornerCommand(e){const s=await Promise.all(e.map(async n=>({model:await n.toOriginalCornerJson()}))),r=await Promise.all(e.map(async n=>({model:await n.toCornerJson()})));this._createUpdateCommandBy(s,r)}async _endMovingElementsCorner(){const{selectedElements:e}=this.store;await this._createOriginalCornerCommand(e),e.forEach(s=>{s.isCornerMoving=!1,s.onCornerChanged()})}_selectTopAElement(e){const s=P.getTopAElementByCoord(e,this.cursor.worldValue);this.store.deSelectElements(this.store.selectedElements.filter(r=>s&&s.isGroup?r.ancestorGroup!==s:r!==s)),s&&this.store.selectElement(s)}_processHandCreatorMove(e){this._refreshStageWorldCoord(e),this.store.refreshStageElements(),this.selection.refresh(),this._isStageMoving=!1}async _createAddedCommand(e){const s=new Vo({type:Be.ElementsAdded,dataList:await Promise.all(e.map(async r=>({model:await r.toJson()})))},this.store);this.undo.add(s)}_emitElementsCreated(e){this.setCreator(Le),this.emit(T.elementCreated,e)}async tryEmitElementCreated(){const e=this.store.provisionalElements;e.length&&(this.store.updateElements(e,{isProvisional:!1,isOnStage:!0}),this._emitElementsCreated(e),await this._createAddedCommand(e))}calcPressDown(e){this._pressDownPosition=this.cursor.transform(e),this._pressDownStageWorldCoord=P.calcWorldCoord(this._pressDownPosition)}calcPressUp(e){this._pressUpPosition=this.cursor.transform(e),this._pressUpStageWorldCoord=P.calcWorldCoord(this._pressUpPosition)}calcPressMove(e){this._pressMovePosition=this.cursor.transform(e),this._pressMoveStageWorldCoord=P.calcWorldCoord(this._pressMovePosition)}checkCursorPressMovedALittle(e){return Math.abs(this._pressMoveStageWorldCoord.x-this._pressDownStageWorldCoord.x)>=Ps||Math.abs(this._pressMoveStageWorldCoord.y-this._pressDownStageWorldCoord.y)>=Rs}checkCursorPressUpALittle(e){return Math.abs(this._pressUpStageWorldCoord.x-this._pressDownStageWorldCoord.x)>=Ps||Math.abs(this._pressUpStageWorldCoord.y-this._pressDownStageWorldCoord.y)>=Rs}async _refreshSize(){const e=this.renderEl.getBoundingClientRect();this.stageRect=e,this._updateCanvasSize(e),this.store.refreshStageElements(),this.selection.refresh(),this.triggetEditingElementsStageChanged(),this._shouldRedraw=!0}_updateCanvasSize(e){this.mask.updateSize(e),this.provisional.updateSize(e),this.html.updateSize(e),this.updateSize(e)}async setCreator(e){this.currentCreator=e,this.emit(T.creatorChanged,e)}_creatingElementOnMovement(e){if(this.checkCursorPressMovedALittle(e))return this.store.creatingElement([this._pressDownStageWorldCoord,this._pressMoveStageWorldCoord])}_updatingArbitraryElementOnMovement(e){if(this.checkCursorPressMovedALittle(e))return this.store.creatingArbitraryElement(this._pressMoveStageWorldCoord,!1)}_refreshStageWorldCoord(e){if(!this._originalStageWorldCoord)return;const s=v.getEventPosition(e,this.stageRect,this.stageScale);this.stageWorldCoord={x:this._originalStageWorldCoord.x-(s.x-this._pressDownPosition.x),y:this._originalStageWorldCoord.y-(s.y-this._pressDownPosition.y)}}_checkScale(e){let s=R.clamp(this.stageScale+e,.02,5);return s=c.precise(s,2),this.stageScale===.02&&e>0&&(s=.1),s}async setScale(e){this.stageScale=e,F.scale=e,this.html.updateSize(this.renderEl.getBoundingClientRect()),this.emit(T.scaleChanged,e),this.store.refreshStageElements(),this.selection.refresh(),this.triggetEditingElementsStageChanged(),this._shouldRedraw=!0}_handleWheelScale(e,s){const r=v.getEventPosition(s,this.stageRect,this.stageScale),n=P.calcWorldCoord(r),o=this._checkScale(e),a=(s.clientX-this.stageRect.left)/o,l=(s.clientY-this.stageRect.top)/o,h=n.x-a,d=n.y-l,u=h+this.stageRect.width/2/o,f=d+this.stageRect.height/2/o;this.stageWorldCoord={x:u,y:f},this.setScale(o)}_handleWheelMove(e){this.stageWorldCoord.x+=e.x/2/this.stageScale,this.stageWorldCoord.y+=e.y/2/this.stageScale,this.store.refreshStageElements(),this.selection.refresh(),this.store.editingElements.forEach(s=>s.onStageChanged()),this._shouldRedraw=!0}calcScaleAutoFitValueByBox(e){const{width:s,height:r}=v.calcRectangleSize(e);let n=c.precise(v.calcScale(this.stageRect,{width:s,height:r},vi*this.stageScale),2);return n=R.clamp(n,.02,1),n}calcScaleAutoFitValue(){const e=v.getBoxPoints(this.store.visibleElements.map(s=>s.maxOutlineBoxCoords).flat());return this.calcScaleAutoFitValueByBox(e)}calcElementAutoFitValue(e){return this.calcScaleAutoFitValueByBox(e.maxOutlineBoxCoords)}setScaleAutoFit(){if(this.store.isVisibleEmpty)this.stageWorldCoord={x:0,y:0},this.setScale(1);else{const e=c.calcCenter(this.store.visibleElements.map(s=>s.rotateOutlineCoords.flat()).flat());this.stageWorldCoord=e,this.store.refreshStageElements(),this.setScale(this.calcScaleAutoFitValue())}}setScaleReduce(){const e=this._checkScale(-.05);this.setScale(e)}setScaleIncrease(){const e=this._checkScale(.05);this.setScale(e)}setScale100(){this.setScale(1)}_handleScaleReduce(){this.setScaleReduce()}_handleScaleIncrease(){this.setScaleIncrease()}_handleScaleAutoFit(){this.setScaleAutoFit()}_handleScale100(){this.setScale100()}async _handleImagePasted(e,s){this._clearStageSelects();const r=await this.store.insertImageElement(e),n=this.calcElementAutoFitValue(r);this.stageScale>n&&await this.setScale(n),await this._createAddedCommand([r]),s&&s()}async uploadImages(e){e.length&&await this.event.onImagesUpload(e)}_createRearrangeModel(e){var s,r,n,o;return{prevId:(r=(s=e.node.prev)==null?void 0:s.value)==null?void 0:r.id,nextId:(o=(n=e.node.next)==null?void 0:n.value)==null?void 0:o.id}}async _handleSelectsDelete(){if(this.store.isSelectedEmpty)return;const e=new jo({type:Be.ElementsRemoved,dataList:await Promise.all(this.store.selectedElements.map(async s=>({model:await s.toJson(),...this._createRearrangeModel(s)})))},this.store);this.undo.add(e),this.store.deleteSelects()}selectAll(){this.store.selectAll()}_handleSelectAll(){this.selectAll()}async _handleSelectCopy(){const e=await this.store.copySelectElements(),s=JSON.stringify(e);No.copyValueToClipboard(s)}async _handlePasteElements(e){const s=!e||e.length===0;s||this._clearStageSelects();const r=await this.store.pasteElements(e);s||this.selection.refresh(),await this._createAddedCommand(r)}_handleCancel(){this.isArbitraryDrawing?this.commitArbitraryDrawing():this.isArbitraryEditing&&this.commitEditingDrawing()}_handleSelectMoveable(){this.currentCreator.type===ts.type&&(this.setCreator(Le),this.cursor.updateStyle())}_handleSelectHand(){this.currentCreator.type===Le.type&&(this.setCreator(ts),this.cursor.updateStyle())}async _createGroupAddedDataList(e,s){const{id:r}=e;return await Promise.all(s.map(async n=>{const{id:o,model:{groupId:a}}=n;let l;const h=r===o;h?l=await n.toJson():a===r?l=await n.toGroupJson():l={id:o};const d={model:l,isGroup:h,...this._createRearrangeModel(n)};return a===r&&(d.isGroupSubject=!0),d}))}async _handleSelectGroup(){if(this.isElementsBusy||this.store.isSelectedEmpty)return;const e=await Promise.all(this.store.selectedElements.map(async r=>({model:{id:r.id},isGroupSubject:!r.isGroupSubject,...this._createRearrangeModel(r)}))),s=this.store.selectToGroup();if(s){e.push({model:{id:s.id},isGroup:!0}),this.store.selectGroup(s);const r=await this._createGroupAddedDataList(s,this.store.selectedElements),n=new Go({type:Be.GroupAdded,dataList:e,rDataList:r},this.store);this.undo.add(n)}}async _createGroupRemovedCommand(e){const s=[];await Promise.all(e.map(async n=>{s.push({model:await n.toJson(),isGroup:!0,...this._createRearrangeModel(n)}),n.subs.forEach(async o=>{s.push({model:await o.toGroupJson(),isGroup:!1})})}));const r=new Ho({type:Be.GroupRemoved,dataList:s},this.store);this.undo.add(r)}async _handleSelectGroupCancel(){if(this.isElementsBusy)return;const e=this.store.getSelectedAncestorElementGroups();e.length!==0&&(await this._createGroupRemovedCommand(e),this.store.cancelGroups(e),e.forEach(s=>{s.subs.forEach(r=>{r.isSelected=!0})}))}_handleUndo(){const e=this.undo.tailUndoCommand;e&&(e instanceof Yt||this.store.deSelectAll(),this.undo.undo(),this.selection.refresh(),this._shouldRedraw=!0,this.emit(T.selectedChanged,this.store.selectedElements))}_handleRedo(){const e=this.undo.tailRedoCommand;e&&(e instanceof Yt||this.store.deSelectAll(),this.undo.redo(),this.selection.refresh(),this._shouldRedraw=!0,this.emit(T.selectedChanged,this.store.selectedElements))}async _handleInput(e,s,r,n){this._clearStageSelects();const{x:o,y:a}=P.calcWorldCoord(n),{width:l,height:h}=r,d=await this.store.insertTextElement(e,s,v.get4BoxPoints({x:o+l/2,y:a+h/2},r));await this._createAddedCommand([d]),this.selection.refresh(),this._emitElementsCreated([d]),window.performance.now()-this._latestMousedownTimestamp<=50&&(this._shouldSelectTopAWhilePressUp=!1)}async setElementsAlignLeft(e){await this._createTranslateCommand(e,async()=>{await this.align.setElementsAlignLeft(e)}),e.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAlignRight(e){await this._createTranslateCommand(e,async()=>{await this.align.setElementsAlignRight(e)}),e.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAlignTop(e){await this._createTranslateCommand(e,async()=>{await this.align.setElementsAlignTop(e)}),e.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAlignBottom(e){await this._createTranslateCommand(e,async()=>{await this.align.setElementsAlignBottom(e)}),e.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAlignCenter(e){await this._createTranslateCommand(e,async()=>{await this.align.setElementsAlignCenter(e)}),e.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAlignMiddle(e){await this._createTranslateCommand(e,async()=>{await this.align.setElementsAlignMiddle(e)}),e.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAverageVertical(e){await this._createTranslateCommand(e,async()=>{await this.align.setElementsAverageVertical(e)}),e.forEach(s=>s.onPositionChanged()),this._shouldRedraw=!0}async setElementsAverageHorizontal(e){await this._createTranslateCommand(e,async()=>{await this.align.setElementsAverageHorizontal(e)}),e.forEach(s=>s.onPositionChanged()),this._shouldRedraw=!0}async commitArbitraryDrawing(){this.isArbitraryDrawing&&(this._isPressDown=!1,this.store.finishCreatingElement(),await this._tryCreatedRedraw())}async _commitEidting(){const{editingElements:e}=this.store,s=await Promise.all(e.map(async r=>({model:await r.toJson()})));this._createUpdateCommandBy(this._originalEditingDataList,s),this.store.endEditingElements(e),this.selection.refresh(),this.elementsStatus=q.NONE,this._originalEditingDataList=null}async commitEditingDrawing(){this.isArbitraryEditing&&await this._commitEidting()}async _createRearrangeCommand(e,s){const r=await Promise.all(e.map(async a=>({model:{id:a.id},...this._createRearrangeModel(a)})));await s();const n=await Promise.all(e.map(async a=>({model:{id:a.id},...this._createRearrangeModel(a)}))),o=new $o({type:Be.ElementsRearranged,dataList:r,rDataList:n},this.store);this.undo.add(o)}async setElementsGoDown(e){await this._createRearrangeCommand(e,async()=>{await this.store.setElementsGoDown(e)}),e.forEach(s=>s.onLayerChanged()),this._shouldRedraw=!0}async setElementsShiftMove(e){await this._createRearrangeCommand(e,async()=>{await this.store.setElementsShiftMove(e)}),e.forEach(s=>s.onLayerChanged()),this._shouldRedraw=!0}}const O=new qo,Xo=new Rn;O.configure.config({rotationIconEnable:!0});const ee=200,Hs={position:{x:0,y:0},width:0,height:0,angle:0,corners:[...ot.corners],flipX:!1,leanYAngle:0,scale:1,strokes:[{...kt}],fills:[{...Ot}],fontSize:ke.fontSize,fontFamily:ke.fontFamily,fontLineHeight:ke.fontLineHeight,fontColor:ke.fontColor,fontColorOpacity:ke.fontColorOpacity,textAlign:ke.textAlign,textBaseline:ke.textBaseline,isRatioLocked:!1},fe=ar("stage",{state:()=>({currentCreator:Le,currentCursorCreator:Le,currentShapeCreator:gs,currentTextCreator:yr,currentArbitraryCreator:fs,selectedElements:[],targetElements:[],isMultiSelected:!1,primarySelectedElement:null,layerShiftMoveEnable:!1,layerGoDownEnable:!1,...H.jsonClone(Hs)}),getters:{inputDisabled(){return!this.primarySelectedElement},alignEnable(){var i;return((i=this.selectedElements)==null?void 0:i.length)>=2},averageEnable(){var i;return((i=this.selectedElements)==null?void 0:i.length)>=3},arbitraryVisible(){var i;return((i=this.currentCreator)==null?void 0:i.type)===A.arbitrary}},actions:{async init(i){await Xo.init(i.containerEl),await O.init(i.shieldEl),this.setCreator(Le),O.on(T.elementCreated,this.onElementCreated),O.on(T.selectedChanged,this.onSelectedChanged),O.on(T.targetChanged,this.onTargetChanged),O.on(T.multiSelectedChanged,this.onMultiSelectedChanged.bind(this)),O.on(T.primarySelectedChanged,this.onPrimarySelectedChanged.bind(this)),O.on(T.positionChanged,R.throttle(this.onPositionChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.widthChanged,R.throttle(this.onWidthChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.heightChanged,R.throttle(this.onHeightChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.angleChanged,R.throttle(this.onAngleChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.cornersChanged,R.throttle(this.onCornersChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.flipXChanged,R.throttle(this.onFlipXChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.leanYAngleChanged,R.throttle(this.onLeanYAngleChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.scaleChanged,R.throttle(this.onScaleChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.strokesChanged,R.throttle(this.onStrokesChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.fillsChanged,R.throttle(this.onFillsChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.fontSizeChanged,R.throttle(this.onFontSizeChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.fontFamilyChanged,R.throttle(this.onFontFamilyChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.fontLineHeightChanged,R.throttle(this.onFontLineHeightChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.fontColorChanged,R.throttle(this.onFontColorChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.fontColorOpacityChanged,R.throttle(this.onFontColorOpacityChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.textAlignChanged,R.throttle(this.onTextAlignChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.textBaselineChanged,R.throttle(this.onTextBaselineChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.ratioLockedChanged,R.throttle(this.onRatioLockedChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.creatorChanged,R.throttle(this.onCreatorChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.layerShiftMoveEnableChanged,R.throttle(this.onLayerShiftMoveEnableChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(T.layerGoDownEnableChanged,R.throttle(this.onLayerGoDownEnableChanged.bind(this),ee,{leading:!0,trailing:!0}))},async setCreator(i){await O.setCreator(i)},onCreatorChanged(i){this.currentCreator=i,i.category===te.cursor&&(this.currentCursorCreator=i),i.category===te.shapes&&(this.currentShapeCreator=i),i.category===te.freedom&&(this.currentArbitraryCreator=i)},onMultiSelectedChanged(i){this.isMultiSelected=i},onPrimarySelectedChanged(i){this.primarySelectedElement=i},onElementCreated(i){i.length&&this.onElementChanged(i[0])},onSelectedChanged(i){if(this.selectedElements=i,this.selectedElements.length){const t=P.getAncestorGroup(this.selectedElements);if(!t){Object.assign(this,H.jsonClone(Hs));return}this.onElementChanged(t)}},onElementChanged(i){if(!i)return;const{position:t,width:e,height:s,angle:r,corners:n,flipX:o,leanYAngle:a,strokes:l,fills:h,fontSize:d,fontFamily:u,fontColor:f,fontColorOpacity:p,fontLineHeight:m,textAlign:y,textBaseline:w,isRatioLocked:D}=i;this.onPositionChanged(i,t),this.onWidthChanged(i,e),this.onHeightChanged(i,s),this.onAngleChanged(i,r),this.onCornersChanged(i,n),this.onFlipXChanged(i,o),this.onLeanYAngleChanged(i,a),this.onStrokesChanged(i,l),this.onFillsChanged(i,h),this.onFontSizeChanged(i,d),this.onFontFamilyChanged(i,u),this.onFontLineHeightChanged(i,m),this.onFontColorChanged(i,f),this.onFontColorOpacityChanged(i,p),this.onTextAlignChanged(i,y),this.onTextBaselineChanged(i,w),this.onRatioLockedChanged(i,D)},onTargetChanged(i){this.targetElements=i},onPositionChanged(i,t){t&&(this.position={x:t.x,y:t.y})},onWidthChanged(i,t){this.width=t},onHeightChanged(i,t){this.height=t},onAngleChanged(i,t){this.angle=t},onCornersChanged(i,t){this.corners=[...t]},onFlipXChanged(i,t){this.flipX=t},onLeanYAngleChanged(i,t){this.leanYAngle=t},onScaleChanged(i){this.scale=i},onStrokesChanged(i,t=[]){this.strokes=H.jsonClone(t)},onFillsChanged(i,t=[]){this.fills=H.jsonClone(t)},onFontSizeChanged(i,t){this.fontSize=t},onFontFamilyChanged(i,t){this.fontFamily=t},onFontLineHeightChanged(i,t){this.fontLineHeight=t},onFontColorChanged(i,t){this.fontColor=t},onFontColorOpacityChanged(i,t){this.fontColorOpacity=t},onTextAlignChanged(i,t){this.textAlign=t},onTextBaselineChanged(i,t){this.textBaseline=t},onRatioLockedChanged(i,t){this.isRatioLocked=t},onLayerShiftMoveEnableChanged(i){this.layerShiftMoveEnable=i},onLayerGoDownEnableChanged(i){this.layerGoDownEnable=i},setElementsPosition(i){O.setElementsPosition(G(this.selectedElements),i)},setElementsWidth(i){O.setElementsWidth(G(this.selectedElements),i)},setElementsHeight(i){O.setElementsHeight(G(this.selectedElements),i)},setElementsAngle(i){O.setElementsAngle(G(this.selectedElements),i)},setElementsCorners(i,t){O.setElementsCorners(G(this.selectedElements),i,t)},setElementsLeanYAngle(i){O.setElementsLeanYAngle(G(this.selectedElements),i)},setElementsStrokeType(i,t){O.setElementsStrokeType(G(this.selectedElements),i,t)},setElementsStrokeWidth(i,t){O.setElementsStrokeWidth(G(this.selectedElements),i,t)},setElementsStrokeColor(i,t){O.setElementsStrokeColor(G(this.selectedElements),i,t)},setElementsStrokeColorOpacity(i,t){O.setElementsStrokeColorOpacity(G(this.selectedElements),i,t)},addElementsStroke(i){O.addElementsStroke(G(this.selectedElements),i)},removeElementsStroke(i){O.removeElementsStroke(G(this.selectedElements),i)},setElementsFillColor(i,t){O.setElementsFillColor(G(this.selectedElements),i,t)},setElementsFillColorOpacity(i,t){O.setElementsFillColorOpacity(G(this.selectedElements),i,t)},addElementsFill(i){O.addElementsFill(G(this.selectedElements),i)},removeElementsFill(i){O.removeElementsFill(G(this.selectedElements),i)},setElementsTextAlign(i){O.setElementsTextAlign(G(this.selectedElements),i)},setElementsTextBaseline(i){O.setElementsTextBaseline(G(this.selectedElements),i)},setElementsFontSize(i){O.setElementsFontSize(G(this.selectedElements),i)},setElementsFontFamily(i){O.setElementsFontFamily(G(this.selectedElements),i)},setElementsFontLineHeight(i){O.setElementsFontLineHeight(G(this.selectedElements),i)},setElementsFontColor(i){O.setElementsFontColor(G(this.selectedElements),i)},setElementsFontColorOpacity(i){O.setElementsFontColorOpacity(G(this.selectedElements),i)},setScale(i){O.setScale(i)},setScaleAutoFit(){O.setScaleAutoFit()},setScaleIncrease(){O.setScaleIncrease()},setScaleReduce(){O.setScaleReduce()},setRatioLocked(i){O.setElementsRatioLocked(G(this.selectedElements),i)},setElementsAlignLeft(){this.alignEnable&&O.setElementsAlignLeft(G(this.selectedElements))},setElementsAlignCenter(){this.alignEnable&&O.setElementsAlignCenter(G(this.selectedElements))},setElementsAlignRight(){this.alignEnable&&O.setElementsAlignRight(G(this.selectedElements))},setElementsAlignTop(){this.alignEnable&&O.setElementsAlignTop(G(this.selectedElements))},setElementsAlignMiddle(){this.alignEnable&&O.setElementsAlignMiddle(G(this.selectedElements))},setElementsAlignBottom(){this.alignEnable&&O.setElementsAlignBottom(G(this.selectedElements))},setElementsAverageVertical(){this.averageEnable&&O.setElementsAverageVertical(G(this.selectedElements))},setElementsAverageHorizontal(){this.averageEnable&&O.setElementsAverageHorizontal(G(this.selectedElements))},setElementsGoDown(){this.layerGoDownEnable&&O.setElementsGoDown(G(this.selectedElements))},setElementsShiftMove(){this.layerShiftMoveEnable&&O.setElementsShiftMove(G(this.selectedElements))},uploadImages(i){i.length&&O.uploadImages(i)},commitArbitraryDrawing(){O.commitArbitraryDrawing()}}}),Jo={class:"tool-dropdown"},Uo=ae({__name:"CreatorDropdown",props:{creators:Array,currentCreator:Object,select:Function},setup(i){const t=fe(),e=ne([]),s=R.debounce(async()=>{t.uploadImages(e.value),e.value=[]},500),r=n=>(e.value.push(n),s(),!1);return(n,o)=>{const a=_e,l=Pn,h=hn,d=lr,u=cr,f=hr;return V(),pe(f,null,{dropdown:W(()=>[k(u,null,{default:W(()=>[(V(!0),Y(We,null,qe(i.creators,p=>(V(),pe(d,{key:p.type,class:K([{selected:p.type===i.currentCreator.type}]),onClick:m=>i.select(p)},{default:W(()=>[p.type===x(A).image?(V(),pe(h,{key:0,action:"",multiple:"",accept:"image/*","before-upload":r},{default:W(()=>[k(l,{creator:p},null,8,["creator"])]),_:2},1024)):(V(),pe(l,{key:1,creator:p},null,8,["creator"]))]),_:2},1032,["class","onClick"]))),128))]),_:1})]),default:W(()=>[B("div",Jo,[k(a,{class:"icon-verbise-arrow_down iconfont"})])]),_:1})}}}),he=(i,t)=>{const e=i.__vccOpts||i;for(const[s,r]of t)e[s]=r;return e},Ko=he(Uo,[["__scopeId","data-v-1f27b774"]]),Qo={class:"create-bar"},Zo=ae({__name:"CreatorBar",emits:["select"],setup(i,{emit:t}){const e=t,s=fe(),r=tt(()=>s.currentCreator),n=tt(()=>s.currentCursorCreator),o=tt(()=>s.currentShapeCreator),a=tt(()=>s.currentArbitraryCreator),l=tt(()=>s.currentTextCreator),h=d=>{e("select",d)};return(d,u)=>{const f=_e,p=Ko;return V(),Y("div",Qo,[B("div",{class:K(["tool-item",{selected:n.value.category===r.value.category}]),onClick:u[0]||(u[0]=m=>h(n.value))},[k(f,{class:K(["iconfont",n.value.icon])},null,8,["class"])],2),k(p,{creators:x(Er),"current-creator":r.value,select:h},null,8,["creators","current-creator"]),B("div",{class:K(["tool-item",{selected:o.value.category===r.value.category}]),onClick:u[1]||(u[1]=m=>h(o.value))},[k(f,{class:K(["iconfont",o.value.icon])},null,8,["class"])],2),k(p,{creators:x(_r),"current-creator":r.value,select:h},null,8,["creators","current-creator"]),B("div",{class:K(["tool-item",{selected:a.value.category===r.value.category}]),onClick:u[2]||(u[2]=m=>h(a.value))},[k(f,{class:K(["iconfont",a.value.icon])},null,8,["class"])],2),k(p,{creators:x(wr),"current-creator":r.value,select:h},null,8,["creators","current-creator"]),B("div",{class:K(["tool-item",{selected:l.value.category===r.value.category}]),onClick:u[3]||(u[3]=m=>h(l.value))},[k(f,{class:K(["iconfont",l.value.icon])},null,8,["class"])],2)])}}}),ea={class:"arbitrary-bar"},ta={class:"tool-item"},sa=ae({__name:"ArbitraryBar",setup(i){const t=fe();return(e,s)=>{const r=_e;return Pt((V(),Y("div",ea,[B("div",ta,[k(r,{onClick:x(t).commitArbitraryDrawing},{default:W(()=>[k(x(dn))]),_:1},8,["onClick"])])],512)),[[Rt,x(t).arbitraryVisible]])}}}),ra=he(sa,[["__scopeId","data-v-dc2ef5a8"]]),na={class:"stage-shield"},ia=ae({__name:"shield",setup(i,{expose:t}){let e;return t({init:async()=>new Promise(r=>{e=r,e()})}),(r,n)=>(V(),Y("div",na))}}),oa=ae({__name:"container",setup(i){const t=fe(),e=ne(null),s=ne(),r=n=>{const{type:o}=n;o!==A.image&&t.setCreator(n)};return rn(async()=>{s.value&&await s.value.init(),await t.init({containerEl:e.value,shieldEl:s.value.$el})}),(n,o)=>{const a=ra,l=Zo;return V(),Y("div",{class:"stage-container",ref_key:"stageRef",ref:e},[k(ia,{ref_key:"stageShieldRef",ref:s},null,512),k(a),k(l,{onSelect:r})],512)}}}),aa=he(oa,[["__scopeId","data-v-a64de043"]]),la={class:K(["layer-props right-props"])},ca={class:"layer-props__row"},ha=ae({__name:"LayerProps",setup(i){const t=fe();return(e,s)=>{const r=_e;return V(),Y("div",la,[s[0]||(s[0]=B("div",{class:"layer-props__title"},[B("span",{class:"layer-props__title-text"},"层级")],-1)),B("div",ca,[k(r,{class:K(["iconfont","icon-verbise-layer-go-down",{disabled:!x(t).layerGoDownEnable}]),onClick:x(t).setElementsGoDown,title:"下移"},null,8,["class","onClick"]),k(r,{class:K(["iconfont","icon-verbise-layer-shift-move",{disabled:!x(t).layerShiftMoveEnable}]),onClick:x(t).setElementsShiftMove,title:"上移"},null,8,["class","onClick"])])])}}}),da=he(ha,[["__scopeId","data-v-a63d4953"]]),ua={class:"stroke-props right-props"},ga={class:"stroke-props__title"},fa={class:"stroke-props__row color"},ma={class:"stroke-props__row-item"},pa={class:"stroke-props__row-item"},Ca={class:"stroke-props__row"},ya={class:"stroke-props__row-item"},Ea={class:"stroke-props__row-item"},_a=ae({__name:"StrokeProps",setup(i){const t=ne(),e=fe(),s=ne([{...kt}]);Re(()=>e.strokes,o=>{s.value=o});const r=ne([]);Re(()=>{var o;return(o=e.primarySelectedElement)==null?void 0:o.model.type},o=>{r.value=Bn(o)});const n=()=>{t.value.show()};return(o,a)=>{var m;const l=_e,h=gr,d=fr,u=Ue,f=un,p=gn;return Pt((V(),Y("div",ua,[B("div",ga,[a[1]||(a[1]=B("span",{class:"stroke-props__title-text"},"描边",-1)),k(l,null,{default:W(()=>[k(x(dr),{onClick:a[0]||(a[0]=y=>x(e).addElementsStroke(s.value.length-1))})]),_:1})]),(V(!0),Y(We,null,qe(s.value,(y,w)=>{var D;return V(),Y("div",{key:w},[B("div",fa,[B("div",ma,[k(h,{modelValue:y.color,"onUpdate:modelValue":M=>y.color=M,onChange:M=>x(e).setElementsStrokeColor(M,w),ref_for:!0,ref_key:"colorPickerRef",ref:t,disabled:x(e).inputDisabled},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),k(d,{type:"info",onClick:n},{default:W(()=>[Z(Fe(y.color),1)]),_:2},1024)]),B("div",pa,[k(u,{modelValue:y.colorOpacity,"onUpdate:modelValue":M=>y.colorOpacity=M,placeholder:"输入数字",type:"number",min:"0",max:"1",precision:"1",onChange:M=>x(e).setElementsStrokeColorOpacity(Number(M),w),disabled:x(e).inputDisabled},{prepend:W(()=>a[2]||(a[2]=[Z("O")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"])]),k(l,null,{default:W(()=>[s.value.length>1?(V(),pe(x(ur),{key:0,onClick:M=>x(e).removeElementsStroke(w)},null,8,["onClick"])):Ye("",!0)]),_:2},1024)]),B("div",Ca,[B("div",ya,[k(p,{modelValue:y.type,"onUpdate:modelValue":M=>y.type=M,placeholder:"描边类型",size:"small",onChange:M=>x(e).setElementsStrokeType(M,w),disabled:x(e).inputDisabled},{default:W(()=>[(V(!0),Y(We,null,qe(r.value,M=>(V(),pe(f,{key:M.type,label:M.name,value:M.type},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"])]),B("div",Ea,[k(u,{modelValue:y.width,"onUpdate:modelValue":M=>y.width=M,placeholder:"输入数字",type:"number",precision:"1",min:((D=x(e).primarySelectedElement)==null?void 0:D.model.type)===x(A).line?1:0,onChange:M=>x(e).setElementsStrokeWidth(Number(M),w),disabled:x(e).inputDisabled},{prepend:W(()=>a[3]||(a[3]=[Z("S")])),append:W(()=>a[4]||(a[4]=[Z("px")])),_:2},1032,["modelValue","onUpdate:modelValue","min","onChange","disabled"])])])])}),128))],512)),[[Rt,(m=x(e).primarySelectedElement)==null?void 0:m.strokeEnable]])}}}),wa=he(_a,[["__scopeId","data-v-168aab7f"]]),va={class:"fill-props right-props"},xa={class:"fill-props__title"},Sa={class:"fill-props__row color"},ba={class:"fill-props__row-item"},Aa={class:"fill-props__row-item"},Pa=ae({__name:"FillProps",setup(i){const t=ne(),e=fe(),s=ne([{...Ot}]);Re(()=>e.fills,n=>{s.value=n});const r=()=>{t.value.show()};return(n,o)=>{var u;const a=_e,l=gr,h=fr,d=Ue;return Pt((V(),Y("div",va,[B("div",xa,[o[1]||(o[1]=B("span",{class:"fill-props__title-text"},"填充",-1)),k(a,null,{default:W(()=>[k(x(dr),{onClick:o[0]||(o[0]=f=>x(e).addElementsFill(s.value.length-1))})]),_:1})]),(V(!0),Y(We,null,qe(s.value,(f,p)=>(V(),Y("div",{key:p},[B("div",Sa,[B("div",ba,[k(l,{modelValue:f.color,"onUpdate:modelValue":m=>f.color=m,onChange:m=>x(e).setElementsFillColor(m,p),ref_for:!0,ref_key:"colorPickerRef",ref:t,disabled:x(e).inputDisabled},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),k(h,{type:"info",onClick:r},{default:W(()=>[Z(Fe(f.color),1)]),_:2},1024)]),B("div",Aa,[k(d,{modelValue:f.colorOpacity,"onUpdate:modelValue":m=>f.colorOpacity=m,placeholder:"输入数字",type:"number",min:"0",max:"1",precision:"1",onChange:m=>x(e).setElementsFillColorOpacity(Number(m),p),disabled:x(e).inputDisabled},{prepend:W(()=>o[2]||(o[2]=[Z("O")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"])]),k(a,null,{default:W(()=>[s.value.length>1?(V(),pe(x(ur),{key:0,onClick:m=>x(e).removeElementsFill(p)},null,8,["onClick"])):Ye("",!0)]),_:2},1024)])]))),128))],512)),[[Rt,(u=x(e).primarySelectedElement)==null?void 0:u.fillEnabled]])}}}),Ra=he(Pa,[["__scopeId","data-v-fe653b46"]]),Ta={class:"corners-props right-props"},ka={class:"corners-props__row"},Oa={class:"corners-props__row-item"},La={class:"corners-props__row"},Ia=ae({__name:"CornerProps",setup(i){const t=fe(),e=ne(ot.corners),s=ne(0),r=ne(!1);return Re(()=>t.corners,n=>{e.value=n;const o=R.uniq(e.value);o.length===1?(r.value=!0,s.value=o[0]):(r.value=!1,s.value=0)}),(n,o)=>{var l,h;const a=Ue;return Pt((V(),Y("div",Ta,[o[4]||(o[4]=B("div",{class:"corners-props__title"},[B("span",{class:"corners-props__title-text"},"圆角")],-1)),B("div",ka,[B("div",Oa,[k(a,{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=d=>s.value=d),placeholder:"输入数字",disabled:x(t).inputDisabled||!r.value,type:"number",min:"0",max:((l=x(t).primarySelectedElement)==null?void 0:l.minParallelogramVerticalSize)/2,precision:"1",onChange:o[1]||(o[1]=d=>x(t).setElementsCorners(Number(d)))},{prepend:W(()=>o[2]||(o[2]=[Z("C")])),append:W(()=>o[3]||(o[3]=[Z("px")])),_:1},8,["modelValue","disabled","max"])])]),B("div",La,[(V(!0),Y(We,null,qe(e.value,(d,u)=>{var f;return V(),Y("div",{class:"corners-props__row-item",key:u},[k(a,{modelValue:e.value[u],"onUpdate:modelValue":p=>e.value[u]=p,placeholder:"输入数字",disabled:x(t).inputDisabled,type:"number",min:"0",max:((f=x(t).primarySelectedElement)==null?void 0:f.minParallelogramVerticalSize)/2,precision:"1",onChange:p=>x(t).setElementsCorners(Number(p),u)},null,8,["modelValue","onUpdate:modelValue","disabled","max","onChange"])])}),128))])],512)),[[Rt,(h=x(t).primarySelectedElement)==null?void 0:h.cornersModifyEnable]])}}}),Ba=he(Ia,[["__scopeId","data-v-84bd0b46"]]),Ma={class:"angle-props right-props"},Fa={class:"angle-props__title"},Da={class:"angle-props__row"},Wa={class:"angle-props__row-item"},Na={key:0,class:"angle-props__row-item"},za=ae({__name:"AngleProps",setup(i){const t=fe(),e=ne(0),s=ne(0);Re(()=>t.angle,o=>{e.value=c.precise(o,1)}),Re(()=>t.leanYAngle,o=>{s.value=c.precise(o,1)});function r(o){let a=Number(o);a>180&&(a=180-a),a<-180&&(a=-180-a),t.setElementsAngle(a)}function n(o){let a=Number(o);a=R.clamp(a,-89,89),t.setElementsLeanYAngle(a)}return(o,a)=>{var d;const l=_e,h=Ue;return V(),Y("div",Ma,[B("div",Fa,[a[2]||(a[2]=B("span",{class:"angle-props__title-text"},"角度",-1)),x(t).flipX?(V(),pe(l,{key:0,class:K(["iconfont","icon-verbise-flip-horizontal"])})):Ye("",!0)]),B("div",Da,[B("div",Wa,[k(h,{modelValue:e.value,"onUpdate:modelValue":a[0]||(a[0]=u=>e.value=u),placeholder:"输入数字",disabled:x(t).inputDisabled,type:"number",min:"-180",max:"180",precision:"1",onChange:r},{prepend:W(()=>a[3]||(a[3]=[Z("A")])),append:W(()=>a[4]||(a[4]=[Z("°")])),_:1},8,["modelValue","disabled"])]),(d=x(t).primarySelectedElement)!=null&&d.leanYAngleModifyEnable?(V(),Y("div",Na,[k(h,{modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=u=>s.value=u),placeholder:"输入数字",disabled:x(t).inputDisabled,type:"number",min:"-89",max:"89",precision:"1",onChange:n},{prepend:W(()=>a[5]||(a[5]=[Z("LY")])),append:W(()=>a[6]||(a[6]=[Z("°")])),_:1},8,["modelValue","disabled"])])):Ye("",!0)])])}}}),Va={class:"size-props right-props"},ja={class:"size-props__row"},Ga={class:"angle-props__row-item"},Ha={class:"angle-props__row-item"},$a=ae({__name:"SizeProps",setup(i){const t=fe(),e=ne(0),s=ne(0);return Re(()=>t.width,r=>{e.value=c.precise(r,1)}),Re(()=>t.height,r=>{s.value=c.precise(r,1)}),(r,n)=>{var l;const o=Ue,a=_e;return V(),Y("div",Va,[n[10]||(n[10]=B("div",{class:"size-props__title"},[B("span",{class:"size-props__title-text"},"尺寸")],-1)),B("div",ja,[B("div",Ga,[k(o,{modelValue:e.value,"onUpdate:modelValue":n[0]||(n[0]=h=>e.value=h),placeholder:"输入数字",disabled:x(t).inputDisabled,min:"2",type:"number",precision:"1",onChange:n[1]||(n[1]=h=>x(t).setElementsWidth(Number(h)))},{prepend:W(()=>n[6]||(n[6]=[Z("W")])),append:W(()=>n[7]||(n[7]=[Z("px")])),_:1},8,["modelValue","disabled"])]),B("div",Ha,[k(o,{modelValue:s.value,"onUpdate:modelValue":n[2]||(n[2]=h=>s.value=h),placeholder:"输入数字",disabled:x(t).inputDisabled||!((l=x(t).primarySelectedElement)!=null&&l.heightModifyEnable),min:"2",type:"number",precision:"1",onChange:n[3]||(n[3]=h=>x(t).setElementsHeight(Number(h)))},{prepend:W(()=>n[8]||(n[8]=[Z("H")])),append:W(()=>n[9]||(n[9]=[Z("px")])),_:1},8,["modelValue","disabled"])]),x(t).primarySelectedElement&&x(t).primarySelectedElement.ratioLockedEnable?(V(),pe(a,{key:0},{default:W(()=>[x(t).isRatioLocked?(V(),pe(x(mn),{key:1,onClick:n[5]||(n[5]=h=>x(t).setRatioLocked(!1)),title:"解除宽高比锁定"})):(V(),pe(x(fn),{key:0,onClick:n[4]||(n[4]=h=>x(t).setRatioLocked(!0)),title:"锁定宽高比"}))]),_:1})):Ye("",!0)])])}}}),Ya=he($a,[["__scopeId","data-v-48fc6838"]]),qa={class:"position-props right-props"},Xa={class:"position-props__row"},Ja={class:"angle-props__row-item"},Ua={class:"angle-props__row-item"},Ka=ae({__name:"PositionProps",setup(i){const t=fe(),e=ne(0),s=ne(0);return Re(()=>t.position,r=>{r&&(e.value=c.precise(r.x),s.value=c.precise(r.y))}),(r,n)=>{const o=Ue;return V(),Y("div",qa,[n[8]||(n[8]=B("div",{class:"position-props__title"},"坐标",-1)),B("div",Xa,[B("div",Ja,[k(o,{modelValue:e.value,"onUpdate:modelValue":n[0]||(n[0]=a=>e.value=a),placeholder:"输入数字",disabled:x(t).inputDisabled,type:"number",precision:"1",onChange:n[1]||(n[1]=a=>x(t).setElementsPosition({x:Number(a),y:s.value}))},{prepend:W(()=>n[4]||(n[4]=[Z("X")])),append:W(()=>n[5]||(n[5]=[Z("px")])),_:1},8,["modelValue","disabled"])]),B("div",Ua,[k(o,{modelValue:s.value,"onUpdate:modelValue":n[2]||(n[2]=a=>s.value=a),placeholder:"输入数字",disabled:x(t).inputDisabled,type:"number",precision:"1",onChange:n[3]||(n[3]=a=>x(t).setElementsPosition({x:e.value,y:Number(a)}))},{prepend:W(()=>n[6]||(n[6]=[Z("Y")])),append:W(()=>n[7]||(n[7]=[Z("px")])),_:1},8,["modelValue","disabled"])])])])}}}),Qa={class:K(["align-props right-props"])},Za={class:"align-props__title"},el={class:"align-props__row"},tl=ae({__name:"AlignProps",setup(i){const t=fe();return(e,s)=>{const r=_e;return V(),Y("div",Qa,[B("div",Za,[s[0]||(s[0]=B("span",{class:"align-props__title-text"},"对齐",-1)),k(r,{title:"按住shift支持组件外轮廓对齐操作"},{default:W(()=>[k(x(pn))]),_:1})]),B("div",el,[k(r,{class:K(["iconfont","icon-verbise-align-left",{disabled:!x(t).alignEnable}]),onClick:x(t).setElementsAlignLeft},null,8,["class","onClick"]),k(r,{class:K(["iconfont","icon-verbise-align-horizontal-center",{disabled:!x(t).alignEnable}]),onClick:x(t).setElementsAlignCenter},null,8,["class","onClick"]),k(r,{class:K(["iconfont","icon-verbise-align-right",{disabled:!x(t).alignEnable}]),onClick:x(t).setElementsAlignRight},null,8,["class","onClick"]),k(r,{class:K(["iconfont","icon-verbise-align-top",{disabled:!x(t).alignEnable}]),onClick:x(t).setElementsAlignTop},null,8,["class","onClick"]),k(r,{class:K(["iconfont","icon-verbise-align-vertical-center",{disabled:!x(t).alignEnable}]),onClick:x(t).setElementsAlignMiddle},null,8,["class","onClick"]),k(r,{class:K(["iconfont","icon-verbise-align-bottom",{disabled:!x(t).alignEnable}]),onClick:x(t).setElementsAlignBottom},null,8,["class","onClick"]),k(r,{class:K(["iconfont","icon-verbise-average-h",{disabled:!x(t).averageEnable}]),onClick:x(t).setElementsAverageHorizontal},null,8,["class","onClick"]),k(r,{class:K(["iconfont","icon-verbise-average-v",{disabled:!x(t).averageEnable}]),onClick:x(t).setElementsAverageVertical},null,8,["class","onClick"])])])}}}),sl=he(tl,[["__scopeId","data-v-f3535776"]]),rl={class:"scale-setting"},nl={class:"scale-setting__item factor"},il={class:"el-dropdown-link"},ol=ae({__name:"ScaleSetting",setup(i){const t=fe();return(e,s)=>{const r=_e,n=lr,o=yn,a=cr,l=hr;return V(),Y("div",rl,[B("div",nl,[k(l,{trigger:"click","popper-class":"scale-setting__dropdown","hide-on-click":!1},{dropdown:W(()=>[k(a,null,{default:W(()=>[k(n,{onClick:x(t).setScaleAutoFit},{default:W(()=>s[0]||(s[0]=[B("span",null,"自适应缩放",-1),B("span",null,"shift + 1",-1)])),_:1},8,["onClick"]),k(n,{onClick:x(t).setScaleReduce},{default:W(()=>s[1]||(s[1]=[B("span",null,"缩小",-1),B("span",null,"ctrl + -",-1)])),_:1},8,["onClick"]),k(n,{onClick:x(t).setScaleIncrease},{default:W(()=>s[2]||(s[2]=[B("span",null,"放大",-1),B("span",null,"ctrl + +",-1)])),_:1},8,["onClick"]),k(o,null,{default:W(()=>s[3]||(s[3]=[Z("预置缩放")])),_:1}),(V(!0),Y(We,null,qe(x(wi),h=>(V(),pe(n,{key:h,onClick:d=>x(t).setScale(h)},{default:W(()=>[B("span",null,"缩放"+Fe(x(c).precise(h*100,0)+"%"),1),B("span",null,Fe(h===1?"ctrl + 0":""),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:W(()=>[B("span",il,[Z(Fe(x(c).precise(x(t).scale*100,0)+"%")+" ",1),k(r,{class:"el-icon--right"},{default:W(()=>[k(x(Cn))]),_:1})])]),_:1})])])}}}),al=he(ol,[["__scopeId","data-v-ec040534"]]),ll={},cl={class:"props-right-panel"};function hl(i,t){const e=al,s=sl,r=Ka,n=Ya,o=za,a=Ba,l=Ra,h=wa,d=da;return V(),Y("div",cl,[k(e),k(s),k(r),k(n),k(o),k(a),k(l),k(h),k(d)])}const dl=he(ll,[["render",hl],["__scopeId","data-v-d0f46be5"]]),ul={},gl={class:"right-bar"};function fl(i,t){const e=dl;return V(),Y("div",gl,[k(e)])}const ml=he(ul,[["render",fl],["__scopeId","data-v-910cfe36"]]),pl={},Cl={class:"left-bar"};function yl(i,t){return V(),Y("div",Cl)}const El=he(pl,[["render",yl],["__scopeId","data-v-5cc81779"]]);function kr(i,t){return function(){return i.apply(t,arguments)}}const{toString:_l}=Object.prototype,{getPrototypeOf:ws}=Object,Bt=(i=>t=>{const e=_l.call(t);return i[e]||(i[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),we=i=>(i=i.toLowerCase(),t=>Bt(t)===i),Mt=i=>t=>typeof t===i,{isArray:Ze}=Array,lt=Mt("undefined");function wl(i){return i!==null&&!lt(i)&&i.constructor!==null&&!lt(i.constructor)&&ge(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const Or=we("ArrayBuffer");function vl(i){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(i):t=i&&i.buffer&&Or(i.buffer),t}const xl=Mt("string"),ge=Mt("function"),Lr=Mt("number"),Ft=i=>i!==null&&typeof i=="object",Sl=i=>i===!0||i===!1,pt=i=>{if(Bt(i)!=="object")return!1;const t=ws(i);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},bl=we("Date"),Al=we("File"),Pl=we("Blob"),Rl=we("FileList"),Tl=i=>Ft(i)&&ge(i.pipe),kl=i=>{let t;return i&&(typeof FormData=="function"&&i instanceof FormData||ge(i.append)&&((t=Bt(i))==="formdata"||t==="object"&&ge(i.toString)&&i.toString()==="[object FormData]"))},Ol=we("URLSearchParams"),[Ll,Il,Bl,Ml]=["ReadableStream","Request","Response","Headers"].map(we),Fl=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ht(i,t,{allOwnKeys:e=!1}={}){if(i===null||typeof i>"u")return;let s,r;if(typeof i!="object"&&(i=[i]),Ze(i))for(s=0,r=i.length;s<r;s++)t.call(null,i[s],s,i);else{const n=e?Object.getOwnPropertyNames(i):Object.keys(i),o=n.length;let a;for(s=0;s<o;s++)a=n[s],t.call(null,i[a],a,i)}}function Ir(i,t){t=t.toLowerCase();const e=Object.keys(i);let s=e.length,r;for(;s-- >0;)if(r=e[s],t===r.toLowerCase())return r;return null}const Me=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Br=i=>!lt(i)&&i!==Me;function ns(){const{caseless:i}=Br(this)&&this||{},t={},e=(s,r)=>{const n=i&&Ir(t,r)||r;pt(t[n])&&pt(s)?t[n]=ns(t[n],s):pt(s)?t[n]=ns({},s):Ze(s)?t[n]=s.slice():t[n]=s};for(let s=0,r=arguments.length;s<r;s++)arguments[s]&&ht(arguments[s],e);return t}const Dl=(i,t,e,{allOwnKeys:s}={})=>(ht(t,(r,n)=>{e&&ge(r)?i[n]=kr(r,e):i[n]=r},{allOwnKeys:s}),i),Wl=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),Nl=(i,t,e,s)=>{i.prototype=Object.create(t.prototype,s),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:t.prototype}),e&&Object.assign(i.prototype,e)},zl=(i,t,e,s)=>{let r,n,o;const a={};if(t=t||{},i==null)return t;do{for(r=Object.getOwnPropertyNames(i),n=r.length;n-- >0;)o=r[n],(!s||s(o,i,t))&&!a[o]&&(t[o]=i[o],a[o]=!0);i=e!==!1&&ws(i)}while(i&&(!e||e(i,t))&&i!==Object.prototype);return t},Vl=(i,t,e)=>{i=String(i),(e===void 0||e>i.length)&&(e=i.length),e-=t.length;const s=i.indexOf(t,e);return s!==-1&&s===e},jl=i=>{if(!i)return null;if(Ze(i))return i;let t=i.length;if(!Lr(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=i[t];return e},Gl=(i=>t=>i&&t instanceof i)(typeof Uint8Array<"u"&&ws(Uint8Array)),Hl=(i,t)=>{const s=(i&&i[Symbol.iterator]).call(i);let r;for(;(r=s.next())&&!r.done;){const n=r.value;t.call(i,n[0],n[1])}},$l=(i,t)=>{let e;const s=[];for(;(e=i.exec(t))!==null;)s.push(e);return s},Yl=we("HTMLFormElement"),ql=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,s,r){return s.toUpperCase()+r}),$s=(({hasOwnProperty:i})=>(t,e)=>i.call(t,e))(Object.prototype),Xl=we("RegExp"),Mr=(i,t)=>{const e=Object.getOwnPropertyDescriptors(i),s={};ht(e,(r,n)=>{let o;(o=t(r,n,i))!==!1&&(s[n]=o||r)}),Object.defineProperties(i,s)},Jl=i=>{Mr(i,(t,e)=>{if(ge(i)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const s=i[e];if(ge(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},Ul=(i,t)=>{const e={},s=r=>{r.forEach(n=>{e[n]=!0})};return Ze(i)?s(i):s(String(i).split(t)),e},Kl=()=>{},Ql=(i,t)=>i!=null&&Number.isFinite(i=+i)?i:t,qt="abcdefghijklmnopqrstuvwxyz",Ys="0123456789",Fr={DIGIT:Ys,ALPHA:qt,ALPHA_DIGIT:qt+qt.toUpperCase()+Ys},Zl=(i=16,t=Fr.ALPHA_DIGIT)=>{let e="";const{length:s}=t;for(;i--;)e+=t[Math.random()*s|0];return e};function ec(i){return!!(i&&ge(i.append)&&i[Symbol.toStringTag]==="FormData"&&i[Symbol.iterator])}const tc=i=>{const t=new Array(10),e=(s,r)=>{if(Ft(s)){if(t.indexOf(s)>=0)return;if(!("toJSON"in s)){t[r]=s;const n=Ze(s)?[]:{};return ht(s,(o,a)=>{const l=e(o,r+1);!lt(l)&&(n[a]=l)}),t[r]=void 0,n}}return s};return e(i,0)},sc=we("AsyncFunction"),rc=i=>i&&(Ft(i)||ge(i))&&ge(i.then)&&ge(i.catch),Dr=((i,t)=>i?setImmediate:t?((e,s)=>(Me.addEventListener("message",({source:r,data:n})=>{r===Me&&n===e&&s.length&&s.shift()()},!1),r=>{s.push(r),Me.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",ge(Me.postMessage)),nc=typeof queueMicrotask<"u"?queueMicrotask.bind(Me):typeof process<"u"&&process.nextTick||Dr,C={isArray:Ze,isArrayBuffer:Or,isBuffer:wl,isFormData:kl,isArrayBufferView:vl,isString:xl,isNumber:Lr,isBoolean:Sl,isObject:Ft,isPlainObject:pt,isReadableStream:Ll,isRequest:Il,isResponse:Bl,isHeaders:Ml,isUndefined:lt,isDate:bl,isFile:Al,isBlob:Pl,isRegExp:Xl,isFunction:ge,isStream:Tl,isURLSearchParams:Ol,isTypedArray:Gl,isFileList:Rl,forEach:ht,merge:ns,extend:Dl,trim:Fl,stripBOM:Wl,inherits:Nl,toFlatObject:zl,kindOf:Bt,kindOfTest:we,endsWith:Vl,toArray:jl,forEachEntry:Hl,matchAll:$l,isHTMLForm:Yl,hasOwnProperty:$s,hasOwnProp:$s,reduceDescriptors:Mr,freezeMethods:Jl,toObjectSet:Ul,toCamelCase:ql,noop:Kl,toFiniteNumber:Ql,findKey:Ir,global:Me,isContextDefined:Br,ALPHABET:Fr,generateString:Zl,isSpecCompliantForm:ec,toJSONObject:tc,isAsyncFn:sc,isThenable:rc,setImmediate:Dr,asap:nc};function N(i,t,e,s,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),s&&(this.request=s),r&&(this.response=r,this.status=r.status?r.status:null)}C.inherits(N,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:C.toJSONObject(this.config),code:this.code,status:this.status}}});const Wr=N.prototype,Nr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{Nr[i]={value:i}});Object.defineProperties(N,Nr);Object.defineProperty(Wr,"isAxiosError",{value:!0});N.from=(i,t,e,s,r,n)=>{const o=Object.create(Wr);return C.toFlatObject(i,o,function(l){return l!==Error.prototype},a=>a!=="isAxiosError"),N.call(o,i.message,t,e,s,r),o.cause=i,o.name=i.name,n&&Object.assign(o,n),o};const ic=null;function is(i){return C.isPlainObject(i)||C.isArray(i)}function zr(i){return C.endsWith(i,"[]")?i.slice(0,-2):i}function qs(i,t,e){return i?i.concat(t).map(function(r,n){return r=zr(r),!e&&n?"["+r+"]":r}).join(e?".":""):t}function oc(i){return C.isArray(i)&&!i.some(is)}const ac=C.toFlatObject(C,{},null,function(t){return/^is[A-Z]/.test(t)});function Dt(i,t,e){if(!C.isObject(i))throw new TypeError("target must be an object");t=t||new FormData,e=C.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,w){return!C.isUndefined(w[y])});const s=e.metaTokens,r=e.visitor||d,n=e.dots,o=e.indexes,l=(e.Blob||typeof Blob<"u"&&Blob)&&C.isSpecCompliantForm(t);if(!C.isFunction(r))throw new TypeError("visitor must be a function");function h(m){if(m===null)return"";if(C.isDate(m))return m.toISOString();if(!l&&C.isBlob(m))throw new N("Blob is not supported. Use a Buffer instead.");return C.isArrayBuffer(m)||C.isTypedArray(m)?l&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function d(m,y,w){let D=m;if(m&&!w&&typeof m=="object"){if(C.endsWith(y,"{}"))y=s?y:y.slice(0,-2),m=JSON.stringify(m);else if(C.isArray(m)&&oc(m)||(C.isFileList(m)||C.endsWith(y,"[]"))&&(D=C.toArray(m)))return y=zr(y),D.forEach(function($,_){!(C.isUndefined($)||$===null)&&t.append(o===!0?qs([y],_,n):o===null?y:y+"[]",h($))}),!1}return is(m)?!0:(t.append(qs(w,y,n),h(m)),!1)}const u=[],f=Object.assign(ac,{defaultVisitor:d,convertValue:h,isVisitable:is});function p(m,y){if(!C.isUndefined(m)){if(u.indexOf(m)!==-1)throw Error("Circular reference detected in "+y.join("."));u.push(m),C.forEach(m,function(D,M){(!(C.isUndefined(D)||D===null)&&r.call(t,D,C.isString(M)?M.trim():M,y,f))===!0&&p(D,y?y.concat(M):[M])}),u.pop()}}if(!C.isObject(i))throw new TypeError("data must be an object");return p(i),t}function Xs(i){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function vs(i,t){this._pairs=[],i&&Dt(i,this,t)}const Vr=vs.prototype;Vr.append=function(t,e){this._pairs.push([t,e])};Vr.toString=function(t){const e=t?function(s){return t.call(this,s,Xs)}:Xs;return this._pairs.map(function(r){return e(r[0])+"="+e(r[1])},"").join("&")};function lc(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function jr(i,t,e){if(!t)return i;const s=e&&e.encode||lc;C.isFunction(e)&&(e={serialize:e});const r=e&&e.serialize;let n;if(r?n=r(t,e):n=C.isURLSearchParams(t)?t.toString():new vs(t,e).toString(s),n){const o=i.indexOf("#");o!==-1&&(i=i.slice(0,o)),i+=(i.indexOf("?")===-1?"?":"&")+n}return i}class Js{constructor(){this.handlers=[]}use(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){C.forEach(this.handlers,function(s){s!==null&&t(s)})}}const Gr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},cc=typeof URLSearchParams<"u"?URLSearchParams:vs,hc=typeof FormData<"u"?FormData:null,dc=typeof Blob<"u"?Blob:null,uc={isBrowser:!0,classes:{URLSearchParams:cc,FormData:hc,Blob:dc},protocols:["http","https","file","blob","url","data"]},xs=typeof window<"u"&&typeof document<"u",os=typeof navigator=="object"&&navigator||void 0,gc=xs&&(!os||["ReactNative","NativeScript","NS"].indexOf(os.product)<0),fc=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",mc=xs&&window.location.href||"http://localhost",pc=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:xs,hasStandardBrowserEnv:gc,hasStandardBrowserWebWorkerEnv:fc,navigator:os,origin:mc},Symbol.toStringTag,{value:"Module"})),oe={...pc,...uc};function Cc(i,t){return Dt(i,new oe.classes.URLSearchParams,Object.assign({visitor:function(e,s,r,n){return oe.isNode&&C.isBuffer(e)?(this.append(s,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}function yc(i){return C.matchAll(/\w+|\[(\w*)]/g,i).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Ec(i){const t={},e=Object.keys(i);let s;const r=e.length;let n;for(s=0;s<r;s++)n=e[s],t[n]=i[n];return t}function Hr(i){function t(e,s,r,n){let o=e[n++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),l=n>=e.length;return o=!o&&C.isArray(r)?r.length:o,l?(C.hasOwnProp(r,o)?r[o]=[r[o],s]:r[o]=s,!a):((!r[o]||!C.isObject(r[o]))&&(r[o]=[]),t(e,s,r[o],n)&&C.isArray(r[o])&&(r[o]=Ec(r[o])),!a)}if(C.isFormData(i)&&C.isFunction(i.entries)){const e={};return C.forEachEntry(i,(s,r)=>{t(yc(s),r,e,0)}),e}return null}function _c(i,t,e){if(C.isString(i))try{return(t||JSON.parse)(i),C.trim(i)}catch(s){if(s.name!=="SyntaxError")throw s}return(0,JSON.stringify)(i)}const dt={transitional:Gr,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const s=e.getContentType()||"",r=s.indexOf("application/json")>-1,n=C.isObject(t);if(n&&C.isHTMLForm(t)&&(t=new FormData(t)),C.isFormData(t))return r?JSON.stringify(Hr(t)):t;if(C.isArrayBuffer(t)||C.isBuffer(t)||C.isStream(t)||C.isFile(t)||C.isBlob(t)||C.isReadableStream(t))return t;if(C.isArrayBufferView(t))return t.buffer;if(C.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(n){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Cc(t,this.formSerializer).toString();if((a=C.isFileList(t))||s.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return Dt(a?{"files[]":t}:t,l&&new l,this.formSerializer)}}return n||r?(e.setContentType("application/json",!1),_c(t)):t}],transformResponse:[function(t){const e=this.transitional||dt.transitional,s=e&&e.forcedJSONParsing,r=this.responseType==="json";if(C.isResponse(t)||C.isReadableStream(t))return t;if(t&&C.isString(t)&&(s&&!this.responseType||r)){const o=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(t)}catch(a){if(o)throw a.name==="SyntaxError"?N.from(a,N.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:oe.classes.FormData,Blob:oe.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};C.forEach(["delete","get","head","post","put","patch"],i=>{dt.headers[i]={}});const wc=C.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),vc=i=>{const t={};let e,s,r;return i&&i.split(`
`).forEach(function(o){r=o.indexOf(":"),e=o.substring(0,r).trim().toLowerCase(),s=o.substring(r+1).trim(),!(!e||t[e]&&wc[e])&&(e==="set-cookie"?t[e]?t[e].push(s):t[e]=[s]:t[e]=t[e]?t[e]+", "+s:s)}),t},Us=Symbol("internals");function rt(i){return i&&String(i).trim().toLowerCase()}function Ct(i){return i===!1||i==null?i:C.isArray(i)?i.map(Ct):String(i)}function xc(i){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=e.exec(i);)t[s[1]]=s[2];return t}const Sc=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function Xt(i,t,e,s,r){if(C.isFunction(s))return s.call(this,t,e);if(r&&(t=e),!!C.isString(t)){if(C.isString(s))return t.indexOf(s)!==-1;if(C.isRegExp(s))return s.test(t)}}function bc(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,s)=>e.toUpperCase()+s)}function Ac(i,t){const e=C.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(i,s+e,{value:function(r,n,o){return this[s].call(this,t,r,n,o)},configurable:!0})})}class ce{constructor(t){t&&this.set(t)}set(t,e,s){const r=this;function n(a,l,h){const d=rt(l);if(!d)throw new Error("header name must be a non-empty string");const u=C.findKey(r,d);(!u||r[u]===void 0||h===!0||h===void 0&&r[u]!==!1)&&(r[u||l]=Ct(a))}const o=(a,l)=>C.forEach(a,(h,d)=>n(h,d,l));if(C.isPlainObject(t)||t instanceof this.constructor)o(t,e);else if(C.isString(t)&&(t=t.trim())&&!Sc(t))o(vc(t),e);else if(C.isHeaders(t))for(const[a,l]of t.entries())n(l,a,s);else t!=null&&n(e,t,s);return this}get(t,e){if(t=rt(t),t){const s=C.findKey(this,t);if(s){const r=this[s];if(!e)return r;if(e===!0)return xc(r);if(C.isFunction(e))return e.call(this,r,s);if(C.isRegExp(e))return e.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=rt(t),t){const s=C.findKey(this,t);return!!(s&&this[s]!==void 0&&(!e||Xt(this,this[s],s,e)))}return!1}delete(t,e){const s=this;let r=!1;function n(o){if(o=rt(o),o){const a=C.findKey(s,o);a&&(!e||Xt(s,s[a],a,e))&&(delete s[a],r=!0)}}return C.isArray(t)?t.forEach(n):n(t),r}clear(t){const e=Object.keys(this);let s=e.length,r=!1;for(;s--;){const n=e[s];(!t||Xt(this,this[n],n,t,!0))&&(delete this[n],r=!0)}return r}normalize(t){const e=this,s={};return C.forEach(this,(r,n)=>{const o=C.findKey(s,n);if(o){e[o]=Ct(r),delete e[n];return}const a=t?bc(n):String(n).trim();a!==n&&delete e[n],e[a]=Ct(r),s[a]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return C.forEach(this,(s,r)=>{s!=null&&s!==!1&&(e[r]=t&&C.isArray(s)?s.join(", "):s)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const s=new this(t);return e.forEach(r=>s.set(r)),s}static accessor(t){const s=(this[Us]=this[Us]={accessors:{}}).accessors,r=this.prototype;function n(o){const a=rt(o);s[a]||(Ac(r,o),s[a]=!0)}return C.isArray(t)?t.forEach(n):n(t),this}}ce.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);C.reduceDescriptors(ce.prototype,({value:i},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>i,set(s){this[e]=s}}});C.freezeMethods(ce);function Jt(i,t){const e=this||dt,s=t||e,r=ce.from(s.headers);let n=s.data;return C.forEach(i,function(a){n=a.call(e,n,r.normalize(),t?t.status:void 0)}),r.normalize(),n}function $r(i){return!!(i&&i.__CANCEL__)}function et(i,t,e){N.call(this,i??"canceled",N.ERR_CANCELED,t,e),this.name="CanceledError"}C.inherits(et,N,{__CANCEL__:!0});function Yr(i,t,e){const s=e.config.validateStatus;!e.status||!s||s(e.status)?i(e):t(new N("Request failed with status code "+e.status,[N.ERR_BAD_REQUEST,N.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function Pc(i){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return t&&t[1]||""}function Rc(i,t){i=i||10;const e=new Array(i),s=new Array(i);let r=0,n=0,o;return t=t!==void 0?t:1e3,function(l){const h=Date.now(),d=s[n];o||(o=h),e[r]=l,s[r]=h;let u=n,f=0;for(;u!==r;)f+=e[u++],u=u%i;if(r=(r+1)%i,r===n&&(n=(n+1)%i),h-o<t)return;const p=d&&h-d;return p?Math.round(f*1e3/p):void 0}}function Tc(i,t){let e=0,s=1e3/t,r,n;const o=(h,d=Date.now())=>{e=d,r=null,n&&(clearTimeout(n),n=null),i.apply(null,h)};return[(...h)=>{const d=Date.now(),u=d-e;u>=s?o(h,d):(r=h,n||(n=setTimeout(()=>{n=null,o(r)},s-u)))},()=>r&&o(r)]}const bt=(i,t,e=3)=>{let s=0;const r=Rc(50,250);return Tc(n=>{const o=n.loaded,a=n.lengthComputable?n.total:void 0,l=o-s,h=r(l),d=o<=a;s=o;const u={loaded:o,total:a,progress:a?o/a:void 0,bytes:l,rate:h||void 0,estimated:h&&a&&d?(a-o)/h:void 0,event:n,lengthComputable:a!=null,[t?"download":"upload"]:!0};i(u)},e)},Ks=(i,t)=>{const e=i!=null;return[s=>t[0]({lengthComputable:e,total:i,loaded:s}),t[1]]},Qs=i=>(...t)=>C.asap(()=>i(...t)),kc=oe.hasStandardBrowserEnv?((i,t)=>e=>(e=new URL(e,oe.origin),i.protocol===e.protocol&&i.host===e.host&&(t||i.port===e.port)))(new URL(oe.origin),oe.navigator&&/(msie|trident)/i.test(oe.navigator.userAgent)):()=>!0,Oc=oe.hasStandardBrowserEnv?{write(i,t,e,s,r,n){const o=[i+"="+encodeURIComponent(t)];C.isNumber(e)&&o.push("expires="+new Date(e).toGMTString()),C.isString(s)&&o.push("path="+s),C.isString(r)&&o.push("domain="+r),n===!0&&o.push("secure"),document.cookie=o.join("; ")},read(i){const t=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(i){this.write(i,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Lc(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function Ic(i,t){return t?i.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):i}function qr(i,t){return i&&!Lc(t)?Ic(i,t):t}const Zs=i=>i instanceof ce?{...i}:i;function ze(i,t){t=t||{};const e={};function s(h,d,u,f){return C.isPlainObject(h)&&C.isPlainObject(d)?C.merge.call({caseless:f},h,d):C.isPlainObject(d)?C.merge({},d):C.isArray(d)?d.slice():d}function r(h,d,u,f){if(C.isUndefined(d)){if(!C.isUndefined(h))return s(void 0,h,u,f)}else return s(h,d,u,f)}function n(h,d){if(!C.isUndefined(d))return s(void 0,d)}function o(h,d){if(C.isUndefined(d)){if(!C.isUndefined(h))return s(void 0,h)}else return s(void 0,d)}function a(h,d,u){if(u in t)return s(h,d);if(u in i)return s(void 0,h)}const l={url:n,method:n,data:n,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(h,d,u)=>r(Zs(h),Zs(d),u,!0)};return C.forEach(Object.keys(Object.assign({},i,t)),function(d){const u=l[d]||r,f=u(i[d],t[d],d);C.isUndefined(f)&&u!==a||(e[d]=f)}),e}const Xr=i=>{const t=ze({},i);let{data:e,withXSRFToken:s,xsrfHeaderName:r,xsrfCookieName:n,headers:o,auth:a}=t;t.headers=o=ce.from(o),t.url=jr(qr(t.baseURL,t.url),i.params,i.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let l;if(C.isFormData(e)){if(oe.hasStandardBrowserEnv||oe.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((l=o.getContentType())!==!1){const[h,...d]=l?l.split(";").map(u=>u.trim()).filter(Boolean):[];o.setContentType([h||"multipart/form-data",...d].join("; "))}}if(oe.hasStandardBrowserEnv&&(s&&C.isFunction(s)&&(s=s(t)),s||s!==!1&&kc(t.url))){const h=r&&n&&Oc.read(n);h&&o.set(r,h)}return t},Bc=typeof XMLHttpRequest<"u",Mc=Bc&&function(i){return new Promise(function(e,s){const r=Xr(i);let n=r.data;const o=ce.from(r.headers).normalize();let{responseType:a,onUploadProgress:l,onDownloadProgress:h}=r,d,u,f,p,m;function y(){p&&p(),m&&m(),r.cancelToken&&r.cancelToken.unsubscribe(d),r.signal&&r.signal.removeEventListener("abort",d)}let w=new XMLHttpRequest;w.open(r.method.toUpperCase(),r.url,!0),w.timeout=r.timeout;function D(){if(!w)return;const $=ce.from("getAllResponseHeaders"in w&&w.getAllResponseHeaders()),E={data:!a||a==="text"||a==="json"?w.responseText:w.response,status:w.status,statusText:w.statusText,headers:$,config:i,request:w};Yr(function(L){e(L),y()},function(L){s(L),y()},E),w=null}"onloadend"in w?w.onloadend=D:w.onreadystatechange=function(){!w||w.readyState!==4||w.status===0&&!(w.responseURL&&w.responseURL.indexOf("file:")===0)||setTimeout(D)},w.onabort=function(){w&&(s(new N("Request aborted",N.ECONNABORTED,i,w)),w=null)},w.onerror=function(){s(new N("Network Error",N.ERR_NETWORK,i,w)),w=null},w.ontimeout=function(){let _=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const E=r.transitional||Gr;r.timeoutErrorMessage&&(_=r.timeoutErrorMessage),s(new N(_,E.clarifyTimeoutError?N.ETIMEDOUT:N.ECONNABORTED,i,w)),w=null},n===void 0&&o.setContentType(null),"setRequestHeader"in w&&C.forEach(o.toJSON(),function(_,E){w.setRequestHeader(E,_)}),C.isUndefined(r.withCredentials)||(w.withCredentials=!!r.withCredentials),a&&a!=="json"&&(w.responseType=r.responseType),h&&([f,m]=bt(h,!0),w.addEventListener("progress",f)),l&&w.upload&&([u,p]=bt(l),w.upload.addEventListener("progress",u),w.upload.addEventListener("loadend",p)),(r.cancelToken||r.signal)&&(d=$=>{w&&(s(!$||$.type?new et(null,i,w):$),w.abort(),w=null)},r.cancelToken&&r.cancelToken.subscribe(d),r.signal&&(r.signal.aborted?d():r.signal.addEventListener("abort",d)));const M=Pc(r.url);if(M&&oe.protocols.indexOf(M)===-1){s(new N("Unsupported protocol "+M+":",N.ERR_BAD_REQUEST,i));return}w.send(n||null)})},Fc=(i,t)=>{const{length:e}=i=i?i.filter(Boolean):[];if(t||e){let s=new AbortController,r;const n=function(h){if(!r){r=!0,a();const d=h instanceof Error?h:this.reason;s.abort(d instanceof N?d:new et(d instanceof Error?d.message:d))}};let o=t&&setTimeout(()=>{o=null,n(new N(`timeout ${t} of ms exceeded`,N.ETIMEDOUT))},t);const a=()=>{i&&(o&&clearTimeout(o),o=null,i.forEach(h=>{h.unsubscribe?h.unsubscribe(n):h.removeEventListener("abort",n)}),i=null)};i.forEach(h=>h.addEventListener("abort",n));const{signal:l}=s;return l.unsubscribe=()=>C.asap(a),l}},Dc=function*(i,t){let e=i.byteLength;if(e<t){yield i;return}let s=0,r;for(;s<e;)r=s+t,yield i.slice(s,r),s=r},Wc=async function*(i,t){for await(const e of Nc(i))yield*Dc(e,t)},Nc=async function*(i){if(i[Symbol.asyncIterator]){yield*i;return}const t=i.getReader();try{for(;;){const{done:e,value:s}=await t.read();if(e)break;yield s}}finally{await t.cancel()}},er=(i,t,e,s)=>{const r=Wc(i,t);let n=0,o,a=l=>{o||(o=!0,s&&s(l))};return new ReadableStream({async pull(l){try{const{done:h,value:d}=await r.next();if(h){a(),l.close();return}let u=d.byteLength;if(e){let f=n+=u;e(f)}l.enqueue(new Uint8Array(d))}catch(h){throw a(h),h}},cancel(l){return a(l),r.return()}},{highWaterMark:2})},Wt=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Jr=Wt&&typeof ReadableStream=="function",zc=Wt&&(typeof TextEncoder=="function"?(i=>t=>i.encode(t))(new TextEncoder):async i=>new Uint8Array(await new Response(i).arrayBuffer())),Ur=(i,...t)=>{try{return!!i(...t)}catch{return!1}},Vc=Jr&&Ur(()=>{let i=!1;const t=new Request(oe.origin,{body:new ReadableStream,method:"POST",get duplex(){return i=!0,"half"}}).headers.has("Content-Type");return i&&!t}),tr=64*1024,as=Jr&&Ur(()=>C.isReadableStream(new Response("").body)),At={stream:as&&(i=>i.body)};Wt&&(i=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!At[t]&&(At[t]=C.isFunction(i[t])?e=>e[t]():(e,s)=>{throw new N(`Response type '${t}' is not supported`,N.ERR_NOT_SUPPORT,s)})})})(new Response);const jc=async i=>{if(i==null)return 0;if(C.isBlob(i))return i.size;if(C.isSpecCompliantForm(i))return(await new Request(oe.origin,{method:"POST",body:i}).arrayBuffer()).byteLength;if(C.isArrayBufferView(i)||C.isArrayBuffer(i))return i.byteLength;if(C.isURLSearchParams(i)&&(i=i+""),C.isString(i))return(await zc(i)).byteLength},Gc=async(i,t)=>{const e=C.toFiniteNumber(i.getContentLength());return e??jc(t)},Hc=Wt&&(async i=>{let{url:t,method:e,data:s,signal:r,cancelToken:n,timeout:o,onDownloadProgress:a,onUploadProgress:l,responseType:h,headers:d,withCredentials:u="same-origin",fetchOptions:f}=Xr(i);h=h?(h+"").toLowerCase():"text";let p=Fc([r,n&&n.toAbortSignal()],o),m;const y=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let w;try{if(l&&Vc&&e!=="get"&&e!=="head"&&(w=await Gc(d,s))!==0){let E=new Request(t,{method:"POST",body:s,duplex:"half"}),S;if(C.isFormData(s)&&(S=E.headers.get("content-type"))&&d.setContentType(S),E.body){const[L,I]=Ks(w,bt(Qs(l)));s=er(E.body,tr,L,I)}}C.isString(u)||(u=u?"include":"omit");const D="credentials"in Request.prototype;m=new Request(t,{...f,signal:p,method:e.toUpperCase(),headers:d.normalize().toJSON(),body:s,duplex:"half",credentials:D?u:void 0});let M=await fetch(m);const $=as&&(h==="stream"||h==="response");if(as&&(a||$&&y)){const E={};["status","statusText","headers"].forEach(j=>{E[j]=M[j]});const S=C.toFiniteNumber(M.headers.get("content-length")),[L,I]=a&&Ks(S,bt(Qs(a),!0))||[];M=new Response(er(M.body,tr,L,()=>{I&&I(),y&&y()}),E)}h=h||"text";let _=await At[C.findKey(At,h)||"text"](M,i);return!$&&y&&y(),await new Promise((E,S)=>{Yr(E,S,{data:_,headers:ce.from(M.headers),status:M.status,statusText:M.statusText,config:i,request:m})})}catch(D){throw y&&y(),D&&D.name==="TypeError"&&/fetch/i.test(D.message)?Object.assign(new N("Network Error",N.ERR_NETWORK,i,m),{cause:D.cause||D}):N.from(D,D&&D.code,i,m)}}),ls={http:ic,xhr:Mc,fetch:Hc};C.forEach(ls,(i,t)=>{if(i){try{Object.defineProperty(i,"name",{value:t})}catch{}Object.defineProperty(i,"adapterName",{value:t})}});const sr=i=>`- ${i}`,$c=i=>C.isFunction(i)||i===null||i===!1,Kr={getAdapter:i=>{i=C.isArray(i)?i:[i];const{length:t}=i;let e,s;const r={};for(let n=0;n<t;n++){e=i[n];let o;if(s=e,!$c(e)&&(s=ls[(o=String(e)).toLowerCase()],s===void 0))throw new N(`Unknown adapter '${o}'`);if(s)break;r[o||"#"+n]=s}if(!s){const n=Object.entries(r).map(([a,l])=>`adapter ${a} `+(l===!1?"is not supported by the environment":"is not available in the build"));let o=t?n.length>1?`since :
`+n.map(sr).join(`
`):" "+sr(n[0]):"as no adapter specified";throw new N("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return s},adapters:ls};function Ut(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new et(null,i)}function rr(i){return Ut(i),i.headers=ce.from(i.headers),i.data=Jt.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),Kr.getAdapter(i.adapter||dt.adapter)(i).then(function(s){return Ut(i),s.data=Jt.call(i,i.transformResponse,s),s.headers=ce.from(s.headers),s},function(s){return $r(s)||(Ut(i),s&&s.response&&(s.response.data=Jt.call(i,i.transformResponse,s.response),s.response.headers=ce.from(s.response.headers))),Promise.reject(s)})}const Qr="1.7.9",Nt={};["object","boolean","number","function","string","symbol"].forEach((i,t)=>{Nt[i]=function(s){return typeof s===i||"a"+(t<1?"n ":" ")+i}});const nr={};Nt.transitional=function(t,e,s){function r(n,o){return"[Axios v"+Qr+"] Transitional option '"+n+"'"+o+(s?". "+s:"")}return(n,o,a)=>{if(t===!1)throw new N(r(o," has been removed"+(e?" in "+e:"")),N.ERR_DEPRECATED);return e&&!nr[o]&&(nr[o]=!0,console.warn(r(o," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(n,o,a):!0}};Nt.spelling=function(t){return(e,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function Yc(i,t,e){if(typeof i!="object")throw new N("options must be an object",N.ERR_BAD_OPTION_VALUE);const s=Object.keys(i);let r=s.length;for(;r-- >0;){const n=s[r],o=t[n];if(o){const a=i[n],l=a===void 0||o(a,n,i);if(l!==!0)throw new N("option "+n+" must be "+l,N.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new N("Unknown option "+n,N.ERR_BAD_OPTION)}}const yt={assertOptions:Yc,validators:Nt},ve=yt.validators;class De{constructor(t){this.defaults=t,this.interceptors={request:new Js,response:new Js}}async request(t,e){try{return await this._request(t,e)}catch(s){if(s instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const n=r.stack?r.stack.replace(/^.+\n/,""):"";try{s.stack?n&&!String(s.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+n):s.stack=n}catch{}}throw s}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=ze(this.defaults,e);const{transitional:s,paramsSerializer:r,headers:n}=e;s!==void 0&&yt.assertOptions(s,{silentJSONParsing:ve.transitional(ve.boolean),forcedJSONParsing:ve.transitional(ve.boolean),clarifyTimeoutError:ve.transitional(ve.boolean)},!1),r!=null&&(C.isFunction(r)?e.paramsSerializer={serialize:r}:yt.assertOptions(r,{encode:ve.function,serialize:ve.function},!0)),yt.assertOptions(e,{baseUrl:ve.spelling("baseURL"),withXsrfToken:ve.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let o=n&&C.merge(n.common,n[e.method]);n&&C.forEach(["delete","get","head","post","put","patch","common"],m=>{delete n[m]}),e.headers=ce.concat(o,n);const a=[];let l=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(e)===!1||(l=l&&y.synchronous,a.unshift(y.fulfilled,y.rejected))});const h=[];this.interceptors.response.forEach(function(y){h.push(y.fulfilled,y.rejected)});let d,u=0,f;if(!l){const m=[rr.bind(this),void 0];for(m.unshift.apply(m,a),m.push.apply(m,h),f=m.length,d=Promise.resolve(e);u<f;)d=d.then(m[u++],m[u++]);return d}f=a.length;let p=e;for(u=0;u<f;){const m=a[u++],y=a[u++];try{p=m(p)}catch(w){y.call(this,w);break}}try{d=rr.call(this,p)}catch(m){return Promise.reject(m)}for(u=0,f=h.length;u<f;)d=d.then(h[u++],h[u++]);return d}getUri(t){t=ze(this.defaults,t);const e=qr(t.baseURL,t.url);return jr(e,t.params,t.paramsSerializer)}}C.forEach(["delete","get","head","options"],function(t){De.prototype[t]=function(e,s){return this.request(ze(s||{},{method:t,url:e,data:(s||{}).data}))}});C.forEach(["post","put","patch"],function(t){function e(s){return function(n,o,a){return this.request(ze(a||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:n,data:o}))}}De.prototype[t]=e(),De.prototype[t+"Form"]=e(!0)});class Ss{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(n){e=n});const s=this;this.promise.then(r=>{if(!s._listeners)return;let n=s._listeners.length;for(;n-- >0;)s._listeners[n](r);s._listeners=null}),this.promise.then=r=>{let n;const o=new Promise(a=>{s.subscribe(a),n=a}).then(r);return o.cancel=function(){s.unsubscribe(n)},o},t(function(n,o,a){s.reason||(s.reason=new et(n,o,a),e(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=s=>{t.abort(s)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new Ss(function(r){t=r}),cancel:t}}}function qc(i){return function(e){return i.apply(null,e)}}function Xc(i){return C.isObject(i)&&i.isAxiosError===!0}const cs={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(cs).forEach(([i,t])=>{cs[t]=i});function Zr(i){const t=new De(i),e=kr(De.prototype.request,t);return C.extend(e,De.prototype,t,{allOwnKeys:!0}),C.extend(e,t,null,{allOwnKeys:!0}),e.create=function(r){return Zr(ze(i,r))},e}const X=Zr(dt);X.Axios=De;X.CanceledError=et;X.CancelToken=Ss;X.isCancel=$r;X.VERSION=Qr;X.toFormData=Dt;X.AxiosError=N;X.Cancel=X.CanceledError;X.all=function(t){return Promise.all(t)};X.spread=qc;X.isAxiosError=Xc;X.mergeConfig=ze;X.AxiosHeaders=ce;X.formToJSON=i=>Hr(C.isHTMLForm(i)?new FormData(i):i);X.getAdapter=Kr.getAdapter;X.HttpStatusCode=cs;X.default=X;const Jc=ar("app",{state:()=>({name:"app",locale:"zh",version:"1.0.0",user:{},token:"",config:{},menu:{},isMobile:!1,isLandscape:!1,isFullScreen:!1,isShowSidebar:!0,isShowHeader:!0,isShowFooter:!0}),actions:{async init(){const i=await Promise.all([this.getLocale(),this.getUserInfo(),this.getVersion(),this.getConfig()]),[t,e,s,r]=i;this.locale=t.data,this.user=e.data,this.version=s.data,this.config=r.data},async getLocale(){return"zh"},async getUserInfo(){return await X.get("/api/user")},async getVersion(){return await X.get("/api/version")},async getConfig(){return await X.get("/api/config")},async getUploadToken(){return await X.get("/api/upload/token")},async getUploadUrl(){return await X.get("/api/upload/url")},async getUploadFileInfo(i){return await X.get("/api/upload/file",i)},async getUploadFileList(i){return await X.get("/api/upload/list",i)}}}),Uc={class:"left"},Kc={class:"right"},Qc={class:"stage"},Zc=ae({__name:"App",setup(i){const{locale:t}=nn(),e=Jc(),{init:s,locale:r}=e;return s().then(()=>{t.value=r}),(n,o)=>{const a=El,l=ml,h=aa;return V(),Y(We,null,[B("div",Uc,[k(a)]),B("div",Kc,[k(l)]),B("div",Qc,[k(h)])],64)}}}),eh=he(Zc,[["__scopeId","data-v-bc3e527b"]]),th="modulepreload",sh=function(i,t){return new URL(i,t).href},ir={},or=function(t,e,s){let r=Promise.resolve();if(e&&e.length>0){const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(e.map(h=>{if(h=sh(h,s),h in ir)return;ir[h]=!0;const d=h.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(!!s)for(let m=o.length-1;m>=0;m--){const y=o[m];if(y.href===h&&(!d||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${h}"]${u}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":th,d||(p.as="script"),p.crossOrigin="",p.href=h,l&&p.setAttribute("nonce",l),document.head.appendChild(p),d)return new Promise((m,y)=>{p.addEventListener("load",m),p.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${h}`)))})}))}function n(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&n(a.reason);return t().catch(n)})},en=on({legacy:!1,locale:"zh",messages:{}});async function rh(){const i=Object.assign({"/src/locales/en.json":()=>or(()=>import("./en-BIHI7g3E.js"),[],import.meta.url),"/src/locales/zh.json":()=>or(()=>import("./zh-DkCPf_Nl.js"),[],import.meta.url)});for(const t in i){const e=t.match(/\/([A-Za-z0-9-_]+)\.json$/)[1];i[t]().then(s=>{en.global.setLocaleMessage(e,s.default)})}}rh();const zt=an(eh),nh=ln();zt.use(En,{size:"small"});zt.use(nh);zt.use(en);zt.mount("#app");
