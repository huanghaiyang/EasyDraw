var jr=Object.defineProperty;var Gr=(i,e,t)=>e in i?jr(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var u=(i,e,t)=>Gr(i,typeof e!="symbol"?e+"":e,t);import{x as ae,y as N,z as H,A as L,O as Oe,P as R,C as Q,L as ze,aw as $s,ab as G,r as se,G as me,H as F,Q as Be,a4 as je,u as w,c as at,I as vt,J as wt,k as Hr,f as Se,M as K,ax as Yr,ay as $r,at as qr,az as Jr}from"./vue-lfwZ6J9M.js";import{E as ye,g as Xr,a as Ur,b as qs,d as Js,e as Xs,f as Kr,p as Us,m as Ks,h as Qs,i as Zs,j as Ye,k as Qr,l as Zr,u as en,n as tn,w as sn,o as rn,q as nn,r as on}from"./element-D83ZfnbP.js";import{r as an}from"./lodash-7Fc9gIMR.js";import{m as ln,o as X,r as be,a as De,c as cn}from"./mobx-aks1-jRs.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();const hn={class:"creator-menu__item"},dn={class:"text"},un={class:"icon"},gn={key:0,class:"shortcut"},fn=ae({__name:"CreatorDropDownItem",props:{creator:{}},setup(i){return(e,t)=>{const s=ye;return N(),H("div",hn,[L("div",dn,Oe(e.creator.name),1),L("div",un,[R(s,{class:Q(["iconfont",e.creator.icon])},null,8,["class"])]),e.creator.shortcut?(N(),H("div",gn,Oe(e.creator.shortcut),1)):ze("",!0)])}}});class mn{constructor(){u(this,"el")}async init(e){this.el=e}}const gs=2,fs=2,pn=4,Cn=4,yn=4,ms=8;var le=(i=>(i[i.path=0]="path",i[i.transformer=1]="transformer",i[i.cursor=2]="cursor",i[i.cursorPosition=3]="cursorPosition",i[i.selection=4]="selection",i[i.rotate=5]="rotate",i[i.indicator=6]="indicator",i[i.range=7]="range",i))(le||{}),Z=(i=>(i[i.initialed=-1]="initialed",i[i.startCreating=0]="startCreating",i[i.creating=1]="creating",i[i.finished=2]="finished",i[i.editing=3]="editing",i))(Z||{}),k=(i=>(i.elementCreated="elementCreated",i.selectedChanged="selectedChanged",i.targetChanged="targetChanged",i.positionChanged="positionChanged",i.widthChanged="widthChanged",i.heightChanged="heightChanged",i.angleChanged="angleChanged",i.cornersChanged="cornersChanged",i.flipXChanged="flipXChanged",i.leanYAngleChanged="leanYAngleChanged",i.scaleChanged="scaleChanged",i.strokesChanged="strokesChanged",i.fillsChanged="fillsChanged",i.fontSizeChanged="fontSizeChanged",i.fontFamilyChanged="fontFamilyChanged",i.textAlignChanged="textAlignChanged",i.textBaselineChanged="textBaselineChanged",i.creatorChanged="creatorChanged",i.ratioLockedChanged="ratioLockedChanged",i.multiSelectedChanged="multiSelectedChanged",i.primarySelectedChanged="primarySelectedChanged",i.layerShiftMoveEnableChanged="layerShiftMoveEnableChanged",i.layerGoDownEnableChanged="layerGoDownEnableChanged",i))(k||{});class ps{constructor(e){u(this,"prev",null);u(this,"next",null);u(this,"value");this.value=e}get isHead(){return this.prev===null}get isTail(){return this.next===null}get isEmpty(){return this.value===null}insertAfter(e){const t=this.next;this.next=e,e.prev=this,e.next=t,t&&(t.prev=e)}insertBefore(e){const t=this.prev;this.prev=e,e.next=this,e.prev=t,t&&(t.next=e)}}const _n="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Qe=(i=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(i|=0));for(;i--;)e+=_n[t[i]&63];return e};const Ze=new Worker(new URL(""+new URL("MathWorker-CmujXtXM.js",import.meta.url).href,import.meta.url),{type:"module"}),Ne=new Map;Ze.onmessage=i=>{const{id:e,result:t}=i.data;let s=Ne.get(e);s&&s(t),Ne.delete(e),s=null};class l{static multiply(e,t){const s=e.length,r=e[0].length;if(Array.isArray(t[0])){const n=t.length,o=t[0].length;if(r!==n)throw new Error("矩阵 A 的列数必须等于矩阵 B 的行数");const a=new Array(s);for(let c=0;c<s;c++)a[c]=new Array(o).fill(0);for(let c=0;c<s;c++)for(let h=0;h<o;h++)for(let d=0;d<r;d++)a[c][h]+=e[c][d]*t[d][h];return a}else{if(r!==t.length)throw new Error("矩阵 A 的列数必须等于向量的长度");const n=new Array(s).fill(0);for(let o=0;o<s;o++)for(let a=0;a<r;a++)n[o]+=e[o][a]*t[a];return n}}static calcTranslateMatrix(e,t){return[[1,0,e],[0,1,t],[0,0,1]]}static translate(e,t){return!t||t.x===0&&t.y===0?e:{x:e.x+t.x,y:e.y+t.y}}static batchTranslate(e,t){return e.map(s=>this.translate(s,t))}static asyncTranslate(e,t){return new Promise(s=>{const r=`${Date.now()}_${Qe(4)}`;Ze.postMessage({funcName:"translate",args:[e,t],id:r}),Ne.set(r,n=>{s(n)})})}static asyncBatchTranslate(e,t){return new Promise(s=>{const r=`${Date.now()}_${Qe(4)}`;Ze.postMessage({funcName:"batchTranslate",args:[e,t],id:r}),Ne.set(r,n=>{s(n)})})}static asyncNamedBatchTranslate(e,t){return new Promise(s=>{const r=`${Date.now()}_${Qe(4)}`;Ze.postMessage({funcName:"namedBatchTranslate",args:[e,t],id:r}),Ne.set(r,n=>{s(n)})})}static asyncMapNamedBatchTranslate(e,t){return new Promise(s=>{const r=`${Date.now()}_${Qe(4)}`;Ze.postMessage({funcName:"mapNamedBatchTranslate",args:[e,t],id:r}),Ne.set(r,n=>{s(n)})})}static rotate(e,t){if(t===0)return e;const s=l.calcRotateMatrix(t),r=l.multiply(s,[e.x,e.y,1]);return{x:r[0],y:r[1]}}static batchRotate(e,t){return e.map(s=>this.rotate(s,t))}static calcScaleMatrix(e,t){return[[e,0,0],[0,t,0],[0,0,1]]}static calcTransformMatrix(e,t,s,r={}){t=l.transWithCenter(t,r,e,!0),s=l.transWithCenter(s,r,e,!0);const n=s.x-e.x,o=s.y-e.y,a=t.x-e.x,c=t.y-e.y,h=n===0?1:a/n,d=o===0?1:c/o;return l.calcScaleMatrix(h,d)}static rotateWithCenter(e,t,s){if(t===0||!s)return e;e={x:e.x-s.x,y:e.y-s.y};const r=l.rotate(e,t);return{x:r.x+s.x,y:r.y+s.y}}static batchRotateWithCenter(e,t,s){return e.map(r=>l.rotateWithCenter(r,t,s))}static leanYWithCenter(e,t,s){return l.leanWithCenter(e,0,t,s)}static batchLeanYWithCenter(e,t,s){return e.map(r=>l.leanYWithCenter(r,t,s))}static leanXWithCenter(e,t,s){return l.leanWithCenter(e,t,0,s)}static batchLeanXWithCenter(e,t,s){return e.map(r=>l.leanXWithCenter(r,t,s))}static calcLeanMatrix(e,t){e=e||0,t=t||0;const s=Math.tan(l.angleToRadian(e));return[[1,-Math.tan(l.angleToRadian(t)),0],[s,1,0],[0,0,1]]}static calcRotateMatrix(e){e=e||0;const t=l.angleToRadian(e);return[[Math.cos(t),-Math.sin(t),0],[Math.sin(t),Math.cos(t),0],[0,0,1]]}static leanWithCenter(e,t,s,r){if(t===0&&s===0)return e;const n=l.calcLeanMatrix(t,s),o=l.multiply(n,[e.x-r.x,e.y-r.y,1]);return{x:o[0]+r.x,y:o[1]+r.y}}static batchLeanWithCenter(e,t,s,r){return e.map(n=>l.leanWithCenter(n,t,s,r))}static transWithCenter(e,t,s,r){let{angle:n=0,leanXAngle:o=0,leanYAngle:a=0}=t||{};if(n===0&&o===0&&a===0)return e;r&&(n=-n,o=-o,a=-a);let c;const h=l.calcLeanMatrix(o,a),d=l.calcRotateMatrix(n);r?c=l.multiply(h,d):c=l.multiply(d,h);let g=l.multiply(c,[e.x-s.x,e.y-s.y,1]);return{x:g[0]+s.x,y:g[1]+s.y}}static batchTransWithCenter(e,t,s,r){return e.map(n=>l.transWithCenter(n,t,s,r))}static rotateAndTranslate(e,t,s){return l.translate(l.rotate(e,t),s)}static translateArcPoint(e,t){let{start:s,controller:r,end:n,corner:o,value:a}=e;return[s,r,n,o]=l.batchTranslate([s,r,n,o],t),{start:s,controller:r,end:n,corner:o,value:a}}static translateArcPoints(e,t){return e.map(s=>l.translateArcPoint(s,t))}static batchTranslateArcPoints(e,t){return e.map((s,r)=>l.translateArcPoints(s,t))}static scale(e,t){if(t.sx===1&&t.sy===1)return e;const s=l.calcScaleMatrix(t.sx,t.sy),r=l.multiply(s,[e.x,e.y,1]);return{x:r[0],y:r[1]}}static scales(e,t){return e.map(s=>l.scale(s,t))}static scaleWithCenter(e,t,s){return t.sx===1&&t.sy===1?e:(e={x:e.x-s.x,y:e.y-s.y},e=l.scale(e,t),{x:e.x+s.x,y:e.y+s.y})}static batchScaleWithCenter(e,t,s){return e.map(r=>l.scaleWithCenter(r,t,s))}static angleToRadian(e){return e*(Math.PI/180)}static radianToAngle(e){return e*(180/Math.PI)}static isPointInPolygonByRayCasting(e,t){const s=[e.x,e.y],r=t.map(c=>[c.x,c.y]),[n,o]=s;let a=!1;for(let c=0,h=r.length-1;c<r.length;h=c++){const[d,g]=r[c],[f,C]=r[h];if(g>o!=C>o&&n<(f-d)*(o-g)/(C-g)+d&&(a=!a),g===o&&o===C&&n>=Math.min(d,f)&&n<=Math.max(d,f)&&o>=Math.min(g,C)&&o<=Math.max(g,C))return!0}return a}static isPolygonsOverlap(e,t){const s=e.map(f=>[f.x,f.y]),r=t.map(f=>[f.x,f.y]);function n(f){let C=[];for(let p=0;p<f.length;p++){let _=(p+1)%f.length,v=[f[_][0]-f[p][0],f[_][1]-f[p][1]];C.push(v)}return C}function o(f,C){return f[0]*C[0]+f[1]*C[1]}function a(f){return[-f[1],f[0]]}function c(f,C){let p=o(f,C[0]),_=p;for(let v=1;v<C.length;v++){let V=o(f,C[v]);p=Math.min(p,V),_=Math.max(_,V)}return[p,_]}function h(f,C){return f[0]<=C[1]&&C[0]<=f[1]}let d=n(s),g=n(r);for(let f of d.concat(g)){let C=a(f),p=c(C,s),_=c(C,r);if(!h(p,_))return!1}return!0}static calcPolygonCentroid(e){if(!e||e.length===0)throw new Error("顶点数组不能为空");let t=0,s=0;const r=e.length;for(let n=0;n<r;n++)t+=e[n].x,s+=e[n].y;return t/=r,s/=r,{x:t,y:s}}static calcCenter(e){const t=b.getBoxPoints(e);return l.calcPolygonCentroid(t)}static calcTargetPoint(e,t,s){const r=l.angleToRadian(s),n=e.x+t*Math.cos(r),o=e.y+t*Math.sin(r);return{x:n,y:o}}static calcAngle(e,t){const s=t.x-e.x,r=t.y-e.y;return Math.atan2(r,s)*(180/Math.PI)}static calcInternalAngle(e){return 180-l.calcTriangleAngle(e[0],e[3],e[2])}static calcLeanYAngle(e,t){return t?e-90:90-e}static calcLeanYAngleByPoints(e,t){return l.calcLeanYAngle(l.calcInternalAngle(e),t)}static calcUnLeanByPoints(e,t,s){if(t===0&&s===0)return e;const r=l.calcCenter(e);return l.batchLeanWithCenter(e,-t,-s,r)}static calcFlipXByPoints(e){const t=l.calcCenter(e);return l.isPointClockwiseOfLine(t,e[0],e[3])}static calcViewAngleByPoints(e){const t=l.calcAngle(e[2],e[1]);return l.mirrorAngle(t+90)}static calcActualAngleByPoints(e){const t=l.calcInternalAngle(e),s=l.calcLeanYAngle(t,l.calcFlipXByPoints(e)),r=l.calcViewAngleByPoints(e);return l.mirrorAngle(r-s)}static mirrorAngle(e){for(;e>180;)e-=360;for(;e<-180;)e+=360;return e}static normalizeAngle(e){return e<0&&(e=e+360),e}static calcSegmentLineCenterCrossPoint(e,t,s,r){const n=l.calcCenter([e,t]),o=l.calcAngle(e,t);return l.calcTargetPoint(n,r,s?o+90:o-90)}static calcProjectionOnSegment(e,t,s){const r=l.calcSegmentProportion(e,t,s),n=t.x+r*(s.x-t.x),o=t.y+r*(s.y-t.y);return{x:n,y:o}}static calcDistancePointToLine(e,t,s){const{x:r,y:n}=l.calcProjectionOnSegment(e,t,s);return Math.sqrt((e.x-r)*(e.x-r)+(e.y-n)*(e.y-n))}static calcSegmentProportion(e,t,s){const r=s.x-t.x,n=s.y-t.y,o=e.x-t.x,a=e.y-t.y,c=r*r+n*n;return(o*r+a*n)/c}static isProjectionOnSegment(e,t,s){const r=l.calcSegmentProportion(e,t,s);return r>=0&&r<=1}static calcLimitPointOnSegment(e,t,s){const r=l.calcSegmentProportion(e,t,s);if(r<0)return t;if(r>1)return s}static calcInnerLimitPointOnSegment(e,t,s,r){const n=l.calcSegmentProportion(e,t,s);if(n<0){const o=l.calcAngle(t,s);return l.calcTargetPoint(t,r,o)}else if(n>1){const o=l.calcAngle(s,t);return l.calcTargetPoint(s,r,o)}return e}static isPointClosestSegment(e,t,s,r){return l.isProjectionOnSegment(e,t,s)?l.calcDistancePointToLine(e,t,s)<r:!1}static isPointClosest(e,t,s){return l.calcDistance(e,t)<=s}static isPointClosestWhichPoint(e,t,s){for(let r=0;r<t.length;r++)if(l.isPointClosest(e,t[r],s))return r}static transformToAcuteAngle(e){return e>90&&(e=180-e),e}static calcDistance(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static isRectangle(e){if(e.length!==4)return!1;const t=[l.calcDistance(e[0],e[1]),l.calcDistance(e[1],e[2]),l.calcDistance(e[2],e[3]),l.calcDistance(e[3],e[0])];return new Set(t).size===2}static isSameSign(e,t){return e*t>=0}static precise(e,t=2){if(typeof e!="number"||typeof t!="number")throw new TypeError("Both arguments must be numbers");if(!isFinite(e))return e;const s=Math.pow(10,t),o=(Math.round(e*s)/s).toString().split(".");for(o.length===1&&o.push("");o[1].length<t;)o[1]+="0";return Number(o.join("."))}static batchPrecise(e,t){return e.map(s=>l.precise(s,t))}static precisePoint(e,t){return{x:l.precise(e.x,t),y:l.precise(e.y,t)}}static batchPrecisePoint(e,t){return e.map(s=>l.precisePoint(s,t))}static calcTriangleAngle(e,t,s){let r={x:t.x-e.x,y:t.y-e.y},n={x:s.x-t.x,y:s.y-t.y},o=r.x*n.x+r.y*n.y,a=Math.sqrt(r.x*r.x+r.y*r.y),c=Math.sqrt(n.x*n.x+n.y*n.y),h=o/(a*c),g=Math.acos(h)*(180/Math.PI);return isNaN(g)&&(g=0),g}static calcTriangleAngleWithClockwise(e,t,s){const r=l.calcTriangleAngle(e,t,s);return l.isPointClockwiseOfLine(t,e,s)?r:180-r}static calcTriangleAngle2(e,t,s){return Math.acos((Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))/(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2)))*(180/Math.PI)}static calcTriangleAngle3(e,t,s){return Math.acos((Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2))/(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)))*(180/Math.PI)}static calcVectorC(e,t){const s=e.x+t.x,r=e.y+t.y;return{x:s,y:r}}static calcVector(e,t){const s=t.x-e.x,r=t.y-e.y;return{x:s,y:r}}static translateVector(e,t){const s=e.x-t.x,r=e.y-t.y;return{x:s,y:r}}static calcTriangleSide1By2(e,t){const s=e*l.angleToRadian(e);return t/Math.tan(s)}static calcTriangleSide3By1(e,t){const s=e*l.angleToRadian(e);return t/Math.cos(s)}static calcTriangleSide3By2(e,t){const s=l.angleToRadian(e);return t/Math.sin(s)}static calcTriangleSide1By3(e,t){const s=l.angleToRadian(e);return t*Math.cos(s)}static calcTriangleSide2By3(e,t){const s=l.angleToRadian(e);return t*Math.sin(s)}static sortPointsClockwise(e){let t=l.calcCenter(e);return l.sortPointsClockwiseByCenter(e,t)}static sortPointsClockwiseByCenter(e,t){let s=e.map((n,o)=>{let a=Math.atan2(n.y-t.y,n.x-t.x);return{index:o,angle:a}});s.sort((n,o)=>n.angle-o.angle);let r=[];for(let n=0;n<s.length;n++)r.push(e[s[n].index]);return r}static calcPointToSegmentCenterAngle(e,t,s){const r=l.calcCenter([t,s]);return l.calcAngle(e,r)}static resignValue(e,t){return e>=0?Math.abs(t):-Math.abs(t)}static isPointClockwiseOfLine(e,t,s){return(e.x-t.x)*(s.y-t.y)-(e.y-t.y)*(s.x-t.x)<0}static getScaleFromMatrix(e){return{scaleX:e[0][0],scaleY:e[1][1]}}static calculateAngleBisectorIntersection(e){if(e.length!==4)throw new Error("必须提供四个顶点坐标");const t=l.calcBisectors(e),{width:s,height:r}=l.calcParallelogramVerticalSize(e),n=[];return s<r?(n.push(l.calcIntersectionOfLines(t[0],t[1])),n.push(l.calcIntersectionOfLines(t[2],t[3]))):(n.push(l.calcIntersectionOfLines(t[0],t[3])),n.push(l.calcIntersectionOfLines(t[1],t[2]))),n}static calcIntersectionOfLines(e,t){const s=e.point,r=e.direction,n=t.point,o=t.direction,a=r.x*o.y-r.y*o.x;if(Math.abs(a)<1e-6)return null;const c=n.x-s.x,h=n.y-s.y,d=(c*o.y-h*o.x)/a;return(c*r.y-h*r.x)/a,l.precisePoint({x:s.x+d*r.x,y:s.y+d*r.y},1)}static calcBisectors(e){const[t,s,r,n]=e;return e.map((o,a)=>{let c,h;switch(a){case 0:c={x:s.x-t.x,y:s.y-t.y},h={x:n.x-t.x,y:n.y-t.y};break;case 1:c={x:t.x-s.x,y:t.y-s.y},h={x:r.x-s.x,y:r.y-s.y};break;case 2:c={x:s.x-r.x,y:s.y-r.y},h={x:n.x-r.x,y:n.y-r.y};break;case 3:c={x:r.x-n.x,y:r.y-n.y},h={x:t.x-n.x,y:t.y-n.y};break;default:throw new Error("无效的顶点索引")}const d=Math.hypot(c.x,c.y),g=Math.hypot(h.x,h.y),f={x:c.x/d,y:c.y/d},C={x:h.x/g,y:h.y/g},p={x:f.x+C.x,y:f.y+C.y};return{point:o,direction:p}})}static calcCrossPointsOfParallelLines(e,t){const[s,r,n,o]=t,a={x:r.x-s.x,y:r.y-s.y},c={x:n.x-r.x,y:n.y-r.y},h={x:o.x-n.x,y:o.y-n.y},d={x:s.x-o.x,y:s.y-o.y},g={x:s.x-r.x,y:s.y-r.y},f=l.calcIntersectionOfLines({point:s,direction:a},{point:e,direction:d}),C=l.calcIntersectionOfLines({point:r,direction:c},{point:e,direction:a}),p=l.calcIntersectionOfLines({point:n,direction:h},{point:e,direction:c}),_=l.calcIntersectionOfLines({point:o,direction:d},{point:e,direction:g});return[f,C,p,_]}static calcTriangleArea(e,t,s){const r=l.calcDistance(e,t),n=l.calcDistance(t,s),o=l.calcDistance(s,e),a=(r+n+o)/2;return Math.sqrt(a*(a-r)*(a-n)*(a-o))}static calcParallelogramVerticalIntersectionPoints(e,t,s){const[r,n,o,a]=t;let c=l.calcProjectionOnSegment(e,a,r),h=l.calcProjectionOnSegment(e,r,n),d=l.calcProjectionOnSegment(e,n,o),g=l.calcProjectionOnSegment(e,o,a);return s&&(l.isProjectionOnSegment(c,a,r)||(c=l.calcInnerLimitPointOnSegment(c,a,r,.01)),l.isProjectionOnSegment(h,r,n)||(h=l.calcInnerLimitPointOnSegment(h,r,n,.01)),l.isProjectionOnSegment(d,n,o)||(d=l.calcInnerLimitPointOnSegment(d,n,o,.01)),l.isProjectionOnSegment(g,o,a)||(g=l.calcInnerLimitPointOnSegment(g,o,a,.01))),[c,h,d,g]}static calcParallelogramVerticalSize(e){const[t,s,r,n]=e,o=l.calcDistancePointToLine(t,s,r),a=l.calcDistancePointToLine(t,r,n);return{width:o,height:a}}static calcMirrorPointToLine(e,t,s){const r=l.calcProjectionOnSegment(e,t,s),n=l.calcDistance(e,r),o=l.calcAngle(t,s);return l.calcTargetPoint(r,n*2,o)}}var P=an();class b{static getMinX(e){return Math.min(...e.map(t=>t.x))}static getMinY(e){return Math.min(...e.map(t=>t.y))}static getBoxPoints(e){let t=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return e.forEach(o=>{t=Math.min(t,o.x),s=Math.min(s,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y)}),[{x:t,y:s},{x:r,y:s},{x:r,y:n},{x:t,y:n}]}static getRect(e){let t=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return e.forEach(o=>{t=Math.min(t,o.x),s=Math.min(s,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y)}),{x:t,y:s,width:r-t,height:n-s}}static getDateId(){return+new Date}static getRandomId(){return Qe(8)}static getEventPosition(e,t,s){return s=s||1,{x:(e.clientX-t.x)/s,y:(e.clientY-t.y)/s}}static getBoxVertices(e,t){return[{x:e.x-t.width/2,y:e.y-t.height/2},{x:e.x+t.width/2,y:e.y-t.height/2},{x:e.x+t.width/2,y:e.y+t.height/2},{x:e.x-t.width/2,y:e.y+t.height/2}]}static getRectVertices(e){return[{x:0,y:0},{x:e.width,y:0},{x:e.width,y:e.height},{x:0,y:e.height}]}static getLBRPoints(e,t){let[s,r,n]=b.getLBRPointIndexes(e,t);return s===r&&(s=b.getPrevIndexOfArray(e.length,s)),r===n&&(n=b.getNextIndexOfArray(e.length,n)),[e[s],e[r],e[n]]}static getLBRPointIndexes(e,t){let s,r,n;return t=t??!1,e.forEach((o,a)=>{t||((s===void 0||o.x<e[s].x)&&(s=a),(n===void 0||o.x>e[n].x)&&(n=a)),(r===void 0||o.y>e[r].y)&&(r=a)}),t&&(s=b.getPrevIndexOfArray(e.length,r),n=b.getNextIndexOfArray(e.length,r)),[s,r,n]}static get4BoxPoints(e,t,s){const r=[{x:e.x-t.width/2,y:e.y-t.height/2},{x:e.x+t.width/2,y:e.y-t.height/2},{x:e.x+t.width/2,y:e.y+t.height/2},{x:e.x-t.width/2,y:e.y+t.height/2}];return r.forEach(n=>{Object.assign(n,l.transWithCenter(n,s,e))}),r}static getPrevIndexOfArray(e,t,s=1){let r;for(;r=t-s,r<0&&(r=e+r),!(r>=0););return r}static getPrevOfArray(e,t,s=1){return e[b.getPrevIndexOfArray(e.length,t,s)]}static getNextIndexOfArray(e,t,s=1){let r;for(;r=t+s,r>=e&&(r=r-e),!(r<e););return r}static getNextOfArray(e,t,s=1){return e[b.getNextIndexOfArray(e.length,t,s)]}static calcRectangleSize(e){const t=l.precise(l.calcDistance(e[0],e[1])),s=l.precise(l.calcDistance(e[0],e[3]));return{width:t,height:s}}static calcLineSize(e){const t=l.precise(Math.abs(e[0].x-e[1].x)),s=l.precise(Math.abs(e[0].y-e[1].y));return{width:t,height:s}}static scalePoint(e,t){return{x:e.x*t,y:e.y*t}}static scalePoints(e,t){return t===1?e:e.map(s=>b.scalePoint(s,t))}static calcScale(e,t,s=0){const r=(e.width-s*2)/t.width,n=(e.height-s*2)/t.height;return Math.min(r,n)}static calcRectangleSizeInRect(e,t,s,r=0){const n=s.width-r*2,o=s.height-r*2;if(e>n||t>o){const a=l.precise(e/t,1),c=l.precise(s.width/s.height,2);a>c?(e=n,t=l.precise(e/a,1)):(t=o,e=l.precise(t*a,1))}return{width:e,height:t}}static calcCenterInnerRectPoints(e,t){const{width:s,height:r}=e,{width:n,height:o}=t;return[{x:n/2-s/2,y:o/2-r/2},{x:n/2+s/2,y:o/2-r/2},{x:n/2+s/2,y:o/2+r/2},{x:n/2-s/2,y:o/2+r/2}]}static scaleRect(e,t){const s={};return["x","y","width","height","left","top","right","bottom"].forEach(r=>{const n=e[r];P.isNumber(n)&&(s[r]=l.precise(n*t))}),s}static sortPointsByY(e){return e.sort((t,s)=>t.y-s.y)}static sortPointsByX(e){return e.sort((t,s)=>t.x-s.x)}static calcRotateBoxRect(e,t){const s=l.calcDistance(e[0],e[1]),r=l.calcDistancePointToLine(e[0],e[2],e[3]);return{x:t.x-s/2,y:t.y-r/2,width:s,height:r}}}class bt{constructor(){u(this,"id");this.id=`${b.getDateId()}`}run(){return Promise.resolve()}}class $e extends bt{constructor(t,s){super();u(this,"element");u(this,"canvas");this.element=t,s&&(this.canvas=s.canvas)}destroy(){return this.element=null,this.canvas=null,Promise.resolve()}}var A=(i=>(i.moveable="moveable",i.hand="hand",i.rectangle="rectangle",i.line="line",i.image="image",i.polygon="polygon",i.arbitrary="arbitrary",i.pencil="pencil",i.text="text",i.group="group",i.ellipse="ellipse",i))(A||{}),re=(i=>(i.cursor="cursor",i.shapes="shapes",i.freedom="freedom",i))(re||{});class z{static deepPlanObjectAssign(e,...t){return t.forEach(s=>{for(const r in s)s.hasOwnProperty(r)&&(P.isPlainObject(s[r])?(e[r]===void 0&&(e[r]={}),this.deepPlanObjectAssign(e[r],s[r])):e[r]=s[r])}),e}static isAllEqualWith(e,t,s){return e.every(r=>s(r,t))}static jsonClone(e){return P.isPlainObject(e)||P.isArray(e)?JSON.parse(JSON.stringify(e)):(console.warn("jsonClone: 非对象或数组类型",e),P.cloneDeep(e))}}var U=(i=>(i[i.inside=0]="inside",i[i.middle=1]="middle",i[i.outside=2]="outside",i))(U||{});const Cs=[{type:0,name:"内描边"},{type:1,name:"平分线宽"},{type:2,name:"外描边"}],En=[{type:1,name:"平分线宽"}];function vn(i){switch(i){case A.arbitrary:case A.rectangle:case A.ellipse:case A.image:return Cs;case A.line:return En;default:return Cs}}const wn=1,bn="#000000",Sn=1,xn="#999999",An=.15,Pn=1,Rn=12,Tn="sans-serif",kn="center",On="middle",In=1,Bn=100,St={type:wn,width:Pn,color:bn,colorOpacity:Sn},xt={color:xn,colorOpacity:An},et={strokes:[{...St}],fills:[{...xt}],fontSize:Rn,fontFamily:Tn,textAlign:kn,textBaseline:On},ys=i=>{const e=z.jsonClone(et);return[A.line,A.arbitrary].includes(i)&&e.strokes.forEach(t=>{t.width=In}),[A.image,A.arbitrary].includes(i)&&e.fills.forEach(t=>{t.colorOpacity=0}),e};class _s{static hashToRgba(e,t){if(!/^#([0-9A-F]{3}){1,2}$/i.test(e))throw new Error("Invalid color format");let s=e.slice(1);s.length===3&&(s=s.split("").map(a=>a+a).join(""));const r=parseInt(s.substring(0,2),16),n=parseInt(s.substring(2,4),16),o=parseInt(s.substring(4,6),16);return`rgba(${r}, ${n}, ${o}, ${t})`}static getRandomColor(){const e="0123456789ABCDEF";let t="#";for(let s=0;s<6;s++)t+=e[Math.floor(Math.random()*16)];return t}}class we{static joinFillColor(e){return e.color?`${_s.hashToRgba(e.color,e.colorOpacity)}`:""}static joinStrokeColor(e){return e.color?`${_s.hashToRgba(e.color,e.colorOpacity)}`:""}static joinFont(e){return`${e.fontSize}px ${e.fontFamily}`}}class Ce{static calcIOPoint(e,t,s,r,n){const o=s/2,a=l.calcTriangleSide3By2(o,r);let c=l.calcAngle(e,t);c<0&&(c+=360);let h=o+c;return l.calcTargetPoint(e,a,n?h:h+180)}static getPolygonVertices(e,t,s){const r=l.sortPointsClockwise(e);return r.map((n,o)=>{const a=b.getPrevOfArray(r,o),c=b.getNextOfArray(r,o),h=l.calcTriangleAngle(a,n,c);return Ce.calcIOPoint(n,c,h,t,s)})}static getPolygonInnerVertices(e,t){return Ce.getPolygonVertices(e,t,!0)}static getPolygonOuterVertices(e,t){return Ce.getPolygonVertices(e,t,!1)}static calcBentLineOuterVertices(e,t){const s=[];return s.push(...Ce.calcBentLineClockWisePoints(e,t,!0)),s.push(...Ce.calcBentLineClockWisePoints(e.reverse(),t,!0)),s}static calcBentLineClockWisePoints(e,t,s){const r=[];for(let n=0;n<e.length-1;n++){const o=e[n],a=e[n+1];let c=l.calcAngle(o,a);s?c=c+90:c=c-90,r.push(l.calcTargetPoint(o,t,c)),n===e.length-2&&r.push(l.calcTargetPoint(a,t,c))}return r}}class ve{static getArbitraryInnerVertices(e,t,s){return ve.getArbitraryVertices(e,t,!0,s)}static getArbitraryOuterVertices(e,t,s){return ve.getArbitraryVertices(e,t,!1,s)}static getArbitraryVertices(e,t,s,r){return e.length===1?e:e.length===2?Ce.calcBentLineClockWisePoints(e,t,s):e.map((n,o)=>{const a=b.getPrevOfArray(e,o),c=b.getNextOfArray(e,o),h=l.isPointClockwiseOfLine(c,a,n);let d=l.calcTriangleAngle(a,n,c);h?d=180-d:d=180+d;const{isFold:g=!0}=r;if(!g&&[0,e.length-1].includes(o)){let f;return o===0?f=l.calcAngle(n,c)+(s?90:-90):f=l.calcAngle(n,a)+(s?-90:90),l.calcTargetPoint(n,t,f)}else return Ce.calcIOPoint(n,c,d,t,s)})}}const T=class T{static convertPointsByStrokeType(e,t,s,r){if(!s)return e;const{flipX:n=!1,flipY:o=!1}=r,a=s/2;switch(t){case U.inside:return n!==o?ve.getArbitraryOuterVertices(e,a,r):ve.getArbitraryInnerVertices(e,a,r);case U.middle:return e;case U.outside:return n!==o?ve.getArbitraryInnerVertices(e,a,r):ve.getArbitraryOuterVertices(e,a,r)}}static async drawImgLike(e,t,s,r={}){return new Promise((n,o)=>{if(t instanceof ImageData&&(t=T.getCanvasByImageData(t).toDataURL()),typeof t=="string"){if(T.ImageCaches.has(t)){T.drawRotateImage(e,T.ImageCaches.get(t),s,r),n();return}const a=new Image;a.src=t,a.onload=()=>{T.ImageCaches.set(t,a),T.drawRotateImage(e,a,s,r),n()},a.onerror=()=>{o()}}else(t instanceof HTMLCanvasElement||t instanceof HTMLImageElement)&&T.drawRotateImage(e,t,s,r),n()})}static getTransformValues(e){let{angle:t=0,flipX:s=!1,leanY:r,actualAngle:n}=e;typeof n=="number"&&(t=n);let o=l.angleToRadian(t),a=1,c=1;return s&&(a=-1,o=-o,r=-r),{radian:o,scaleX:a,scaleY:c,leanY:r}}static transformCtx(e,t,s){const{x:r,y:n,width:o,height:a}=t,{radian:c,scaleX:h,scaleY:d,leanY:g}=s;e.translate(r+o/2,n+a/2),e.scale(h,d),e.rotate(c),e.transform(1,0,g,1,0,0)}static calcOffsetByRect(e){return{x:-(e.x+e.width/2),y:-(e.y+e.height/2)}}static translatePoints(e,t){const s=T.calcOffsetByRect(t);return e.map(r=>l.translate(r,s))}static translateArcPoints(e,t){const s=T.calcOffsetByRect(t);return l.translateArcPoints(e,s)}static drawClipArcPoints(e,t,s){t=T.transArcParamsWithScale(t)[0],t=T.translateArcPoints(t,s),e.beginPath(),T.drawBazierPoints(t,e),e.closePath(),e.clip()}static drawRotateImage(e,t,s,r={}){const{width:n,height:o}=s,a=e.getContext("2d");a.save(),T.transformCtx(a,s,this.getTransformValues(r)),r.clipArcPoints&&T.drawClipArcPoints(a,r.clipArcPoints,s),a.drawImage(t,-n/2,-o/2,n,o),a.restore()}static drawRotateImageData(e,t,s,r={}){const n=T.getCanvasByImageData(t);T.drawRotateImage(e,n,s,r)}static drawRotateText(e,t,s,r,n,o={}){const{angle:a=0}=o,c=e.getContext("2d");c.save(),c.translate(s.x,s.y),c.rotate(l.angleToRadian(a)),c.font=we.joinFont(r),c.fillStyle=we.joinFillColor(n),c.textAlign=r.textAlign,c.textBaseline=r.textBaseline,c.fillText(t,0,0),c.restore()}static drawRotateTextWithScale(e,t,s,r,n,o={}){T.scale!==1&&(s={x:s.x*T.scale,y:s.y*T.scale}),T.drawRotateText(e,t,s,r,n,o)}static transParamsWithScale(e,t){return T.scale===1?[e,t]:(e=b.scalePoints(e,T.scale),t&&(t={...t,width:t.width*T.scale}),[e,t])}static transArcParamsWithScale(e,t){return T.scale===1?[e,t]:(e=T.scaleArcPoints(e),t&&(t={...t,width:t.width*T.scale}),[e,t])}static transEllipseModelWithScale(e){return T.scale===1?e:{...e,rx:e.rx*T.scale,ry:e.ry*T.scale}}static drawPathWithScale(e,t,s,r,n,o={}){[t,n]=T.transParamsWithScale(t,n),r.colorOpacity&&T.drawInnerPathFill(e,t,r,n,o),n.width&&n.colorOpacity&&T.drawPathStroke(e,t,n,o)}static drawInnerPathFill(e,t,s,r,n={}){const{calcVertices:o=!0}=n;let a;o?a=ve.getArbitraryInnerVertices(t,r.width/2,n):a=t,T.drawPathFill(e,a,s)}static drawInnerPathFillWithScale(e,t,s,r,n={}){[t,r]=T.transParamsWithScale(t,r),s.colorOpacity&&T.drawInnerPathFill(e,t,s,r,n)}static scaleArcPoints(e){return T.scale===1||(e=e.map(t=>{const{start:s,controller:r,end:n,value:o,corner:a}=t,[c,h,d,g]=b.scalePoints([s,r,n,a],T.scale);return{start:c,controller:h,end:d,corner:g,value:o*T.scale}})),e}static drawInnerArcPathFillWithScale(e,t,s,r,n={}){s=T.scaleArcPoints(s),r.colorOpacity&&T.drawArcPathFill(e,s,t,r,n)}static drawPathStrokeWidthScale(e,t,s,r={}){[t,s]=T.transParamsWithScale(t,s),T.drawPathStroke(e,t,s,r)}static drawArcPathStrokeWidthScale(e,t,s,r,n={}){[t,r]=T.transArcParamsWithScale(t,r),T.drawArcPathStroke(e,t,s,r,n)}static drawPathStroke(e,t,s,r={}){const{isFold:n=!0,miterLimit:o}=r,a=e.getContext("2d");a.save(),o&&(a.miterLimit=o),a.strokeStyle=we.joinStrokeColor(s),a.beginPath(),t.forEach((c,h)=>{h===0?a.moveTo(c.x,c.y):a.lineTo(c.x,c.y)}),n&&a.closePath(),s.width&&(a.lineWidth=s.width,a.stroke()),a.restore()}static calcStartOfArcPoints(e){let t=0,s;const[r,n,o]=e,a=e.map(d=>d.controller),{width:c,height:h}=l.calcParallelogramVerticalSize(a);return c>=h?(s=l.calcCenter([r.end,n.start]),t=1):(s=l.calcCenter([n.end,o.start]),t=2),{point:s,index:t}}static arcToBezierPoints(e,t){let{point:s,index:r}=T.calcStartOfArcPoints(e),n=0,o=e[r];for(;o;){const{start:a,controller:c,end:h,corner:d,value:g}=o;if(n===0&&t.moveTo(s.x,s.y),g){const f=l.calcDistance(a,d);t.arcTo(c.x,c.y,h.x,h.y,f)}else t.lineTo(c.x,c.y);if(o=b.getNextOfArray(e,r,1),r++,r>=e.length&&(r=0),n++,n>=e.length)break}}static drawBazierPoints(e,t){e.forEach((s,r)=>{const{start:n,controller:o,end:a,value:c}=s;r===0?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y),c?t.arcTo(o.x,o.y,a.x,a.y,c):t.lineTo(o.x,o.y)})}static drawArcPathStroke(e,t,s,r,n={}){const{isFold:o=!0}=n,a=e.getContext("2d");a.save(),T.transformCtx(a,s,T.getTransformValues(n)),a.miterLimit=0,a.lineCap="round",a.strokeStyle=we.joinStrokeColor(r),a.beginPath(),t=T.translateArcPoints(t,s),T.drawBazierPoints(t,a),o&&a.closePath(),r.width&&(a.lineWidth=r.width,a.stroke()),a.restore()}static drawPathFill(e,t,s){const r=e.getContext("2d");r.save(),r.fillStyle=we.joinFillColor(s),r.beginPath(),t.forEach((n,o)=>{o===0?r.moveTo(n.x,n.y):r.lineTo(n.x,n.y)}),r.closePath(),r.fill(),r.restore()}static drawArcPathFill(e,t,s,r,n={}){const o=e.getContext("2d");o.save(),T.transformCtx(o,s,T.getTransformValues(n)),o.fillStyle=we.joinFillColor(r),o.beginPath(),t=T.translateArcPoints(t,s),T.drawBazierPoints(t,o),o.closePath(),o.fill(),o.restore()}static transformEllipse(e,t,s,r,n){return r&&n&&(T.transformCtx(e,r,T.getTransformValues(n)),t=T.translatePoints([t],r)[0]),s=T.transEllipseModelWithScale(s),{point:t,model:s}}static drawEllipseFill(e,t,s,r,n,o){const a=e.getContext("2d");a.save();const{point:{x:c,y:h},model:{rx:d,ry:g}}=T.transformEllipse(a,t,s,n,o);a.fillStyle=we.joinFillColor(r),a.beginPath(),a.ellipse(c,h,d,g,0,0,Math.PI*2),a.closePath(),a.fill(),a.restore()}static drawEllipseStroke(e,t,s,r,n,o){const a=e.getContext("2d");a.save();const{point:{x:c,y:h},model:{rx:d,ry:g}}=T.transformEllipse(a,t,s,n,o);a.lineWidth=r.width,a.strokeStyle=we.joinStrokeColor(r),a.beginPath(),a.ellipse(c,h,d,g,0,0,Math.PI*2),a.closePath(),a.stroke(),a.restore()}static drawEllipseStrokeWithScale(e,t,s,r,n,o){const[a,c]=T.transParamsWithScale([t],r);T.drawEllipseStroke(e,a[0],s,c,n,o)}static drawEllipseFillWithScale(e,t,s,r,n,o){const[a]=T.transParamsWithScale([t]);T.drawEllipseFill(e,a[0],s,r,n,o)}static drawLine(e,t,s){const r=e.getContext("2d");r.save(),r.beginPath(),r.lineWidth=s.width,r.strokeStyle=we.joinStrokeColor(s),t.forEach((n,o)=>{o===0?r.moveTo(n.x,n.y):r.lineTo(n.x,n.y)}),r.closePath(),r.stroke(),r.restore()}static drawLineWidthScale(e,t,s){[t,s]=T.transParamsWithScale(t,s),T.drawLine(e,t,s)}static getImageDataFromBlob(e){return new Promise((t,s)=>{const r=new Image;r.onload=()=>{const n=document.createElement("canvas");n.width=r.width,n.height=r.height;const o=n.getContext("2d");o.drawImage(r,0,0);const a=o.getImageData(0,0,r.width,r.height);t(a)},r.onerror=s,r.src=URL.createObjectURL(e)})}static getImageDataFromImage(e){return new Promise((t,s)=>{const r=document.createElement("canvas");r.width=e.width,r.height=e.height;const n=r.getContext("2d");n?(n.drawImage(e,0,0),t(n.getImageData(0,0,e.width,e.height))):s(new Error("Failed to get 2d context from canvas"))})}static getCanvasByImageData(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const s=t.getContext("2d");return s&&s.putImageData(e,0,0),t}static getDataUrlFromImage(e){return new Promise((t,s)=>{const r=document.createElement("canvas");r.width=e.width,r.height=e.height;const n=r.getContext("2d");n?(n.drawImage(e,0,0),t(r.toDataURL())):s(new Error("Failed to get 2d context from canvas"))})}};u(T,"ImageCaches",new Map),u(T,"scale",1);let J=T;class Ln extends $e{async run(){if(!this.canvas||!this.element)return;const{arcCoords:e,arcFillCoords:t,model:{styles:s},angle:r,flipX:n,leanY:o,actualAngle:a,rotateBoxCoords:c,center:h}=this.element,d={angle:r,flipX:n,leanY:o,actualAngle:a},g=S.batchCalcStageRelativeArcPoints(e),f=S.calcStageRelativePoints(c),C=S.calcStageRelativeArcPoints(t);let p=b.calcRotateBoxRect(f,h);p=b.scaleRect(p,this.element.shield.stageScale),s.fills.forEach(_=>{J.drawInnerArcPathFillWithScale(this.canvas,p,C,_,d)}),g.forEach((_,v)=>{J.drawArcPathStrokeWidthScale(this.canvas,_,p,s.strokes[v],d)})}}const Mn={subs:!1,deepSubs:!1},es={angle:0,leanYAngle:0,internalAngle:90,actualAngle:0,viewAngle:0},tt={corners:[0,0,0,0]},Fn={view:!0,leanY:!0,actual:!0,internal:!0},Dn={size:!0,position:!0,points:!0,rotation:!0,angles:!0,originals:!0,outline:!0,strokes:!0,corners:!0},Nn="#0c8ce9",Wn=1,Vn="#0c8ce9",zn=.025,jn=1,Gn="#0c8ce9",Hn=1,Yn="#ffffff",$n=1,qn=1,gt=6,ft=12,Jn=12,Xn=12,Un="#0c8ce9",Kn=1,Qn=12,Zn="Arial",ei="center",ti="middle",si=gt+Math.sqrt(Math.pow(ft/2,2)),Lt={strokes:[{type:U.middle,width:jn,color:Nn,colorOpacity:Wn}],fills:[{color:Vn,colorOpacity:zn}]},We={strokes:[{type:U.middle,width:qn,color:Gn,colorOpacity:Hn}],fills:[{color:Yn,colorOpacity:$n}]},Gt={fontSize:Qn,fontFamily:Zn,fills:[{color:Un,colorOpacity:Kn}],textAlign:ei,textBaseline:ti},Es=Gt,vs=20,Ht=3;class er{constructor(e){u(this,"id");u(this,"isActive");u(this,"host");this.host=e,this.id=b.getRandomId(),this.isActive=!1}get angle(){return 0}get scale(){return 1/this.host.shield.stageScale}isCoordHitting(e){return!1}}class ts extends er{constructor(t,s){super(t);u(this,"width");u(this,"height");u(this,"x");u(this,"y");u(this,"points");const{points:r=[],x:n=0,y:o=0,width:a=0,height:c=0}=s||{};this.points=r,this.x=n,this.y=o,this.width=a,this.height=c}isContainsCoord(t){return l.isPointInPolygonByRayCasting(t,this.points)}isCoordHitting(t){return this.isContainsCoord(t)}}class nt extends ts{constructor(){super(...arguments);u(this,"width",ft);u(this,"height",ft)}get angle(){return this.host.viewAngle-90}refresh(){if(!this.host.rotationEnable)return;const t=this.host.shield.stageScale,{x:s,y:r}=S.calcElementRotatePoint(this.host);this.x=s,this.y=r,this.points=b.getBoxVertices({x:s,y:r},{width:this.width/t,height:this.height/t}).map(n=>l.rotateWithCenter(n,this.host.viewAngle,{x:s,y:r}))}isContainsCoord(t){return this.host.rotationEnable?l.isPointInPolygonByRayCasting(t,this.points):!1}}var Le=(i=>(i[i.rect=0]="rect",i[i.circle=1]="circle",i))(Le||{});class Ge extends ts{get angle(){return l.calcAngle(this.host.centerCoord,{x:this.x,y:this.y})+90}}class ri extends er{constructor(t,s){super(t);u(this,"start");u(this,"end");u(this,"index");const{start:r,end:n,index:o}=s||{};r&&(this.start=r),n&&(this.end=n),P.isNumber(o)&&(this.index=o)}get angle(){return l.calcAngle(this.start,this.end)}isClosest(t){return l.isPointClosestSegment(t,this.start,this.end,pn/this.host.shield.stageScale)}isCoordHitting(t){return this.isClosest(t)}}class st extends ri{}const ni=[.25,.5,1,2,3,4,5];var ct=(i=>(i[i.vertices=0]="vertices",i[i.border=1]="border",i))(ct||{}),ue=(i=>(i[i.vertices=0]="vertices",i[i.border=1]="border",i[i.hand=2]="hand",i[i.cross=3]="cross",i[i.move=4]="move",i[i.rotation=5]="rotation",i))(ue||{});const ii=100;class tr extends nt{get angle(){return l.calcAngle(this.host.centerCoord,{x:this.x,y:this.y})+45}}const Ae={type:A.moveable,name:"移动",category:re.cursor,icon:"icon-verbise-arrow-cursor-2--mouse-select-cursor",shortcut:"ctrl+m"},Yt={type:A.hand,name:"手型",category:re.cursor,icon:"icon-verbise-hand",shortcut:"ctrl+h"},ss={type:A.rectangle,name:"矩形",category:re.shapes,icon:"icon-verbise-Rectangle"},oi={type:A.line,name:"直线",category:re.shapes,icon:"icon-verbise-line"},ai={type:A.polygon,name:"多边形",category:re.shapes,icon:"icon-verbise-polygon"},li={type:A.image,name:"图片",category:re.shapes,icon:"icon-verbise-Image"},rs={type:A.arbitrary,name:"线条",category:re.freedom,icon:"icon-verbise-pen"},ci={type:A.pencil,name:"画笔",category:re.freedom,icon:"icon-verbise-pencil"},hi={type:A.ellipse,name:"椭圆",category:re.shapes,icon:"icon-verbise-eclipse"},sr=[Ae,Yt],rr=[ss,oi,hi,ai,li],nr=[rs,ci],di=[Ae,...sr,ss,...rr,rs,...nr];class ir{static getCreatorByType(e){return di.find(t=>t.type===e)}static isElement(e){return[A.image,A.text,A.arbitrary,A.rectangle,A.ellipse,A.polygon,A.line,A.text,A.pencil].includes(e)}}const Mt=["id","coords","boxCoords","x","y"];let Fe=class{constructor(e,t,s){u(this,"model");u(this,"rotation");u(this,"shield");u(this,"node");u(this,"_originalTransformerCoords",[]);u(this,"_originalCoords",[]);u(this,"_originalRotateCoords",[]);u(this,"_originalBoxCoords",[]);u(this,"_originalRotateBoxCoords",[]);u(this,"_originalRotateOutlineCoords",[]);u(this,"_originalStrokeCoords",[]);u(this,"_originalUnLeanCoords",[]);u(this,"_originalUnLeanBoxCoords",[]);u(this,"_originalUnLeanStrokeCoords",[]);u(this,"_originalMaxBoxCoords",[]);u(this,"_originalMaxOutlineBoxCoords",[]);u(this,"_originalTransformMatrix",[]);u(this,"_originalTransformMoveCoord");u(this,"_originalCenterCoord");u(this,"_originalAngle",0);u(this,"_originalSize",{});u(this,"_originalCorners",[]);u(this,"_transformMatrix",[]);u(this,"_transformLockCoord");u(this,"_transformLockIndex");u(this,"_unLeanCoords",[]);u(this,"_unLeanBoxCoords",[]);u(this,"_maxBoxCoords",[]);u(this,"_rotateCoords",[]);u(this,"_rotateBoxCoords",[]);u(this,"_maxOutlineBoxCoords",[]);u(this,"_rotateOutlineCoords",[]);u(this,"_strokeCoords",[]);u(this,"_unLeanStrokeCoords",[]);u(this,"_rect",{});u(this,"_transformers",[]);u(this,"_borderTransformers",[]);u(this,"_transformType");u(this,"_rotateControllers",[]);u(this,"_minParallelogramVerticalSize");u(this,"_minLeanSize");u(this,"_flipX",!1);u(this,"_innermostStrokeCoordIndex",0);u(this,"_isRangeElement",!1);u(this,"_status",Z.initialed);u(this,"_isSelected",!1);u(this,"_isVisible",!0);u(this,"_isEditing",!1);u(this,"_isLocked",!1);u(this,"_isMoving",!1);u(this,"_isTransforming",!1);u(this,"_isRotating",!1);u(this,"_isRotatingTarget",!1);u(this,"_isDragging",!1);u(this,"_isCornerMoving",!1);u(this,"_isProvisional",!1);u(this,"_isTarget",!1);u(this,"_isInRange",!1);u(this,"_isOnStage",!1);this.model=e,this.rotation=new nt(this),this.shield=t,this._isRangeElement=s??!1,this.refreshFlipX(),ln(this,{_status:X,_isDragging:X,_isRotating:X,_isTransforming:X,_isRotatingTarget:X,_isProvisional:X,_isOnStage:X,_isEditing:X,_isMoving:X,_isSelected:X,_isVisible:X,_isLocked:X,_isTarget:X,_isInRange:X,_isCornerMoving:X})}get isRangeElement(){return this._isRangeElement}get id(){return this.model.id}get isElement(){return ir.isElement(this.model.type)}get isGroup(){return this.model.type===A.group}get group(){return this.isGroupSubject?this.shield.store.getElementById(this.model.groupId):null}get ancestorGroup(){if(!this.isGroupSubject)return null;let e=this.group;for(;e&&e.isGroupSubject;)e=e.group;return e}get isGroupSubject(){return this.model.groupId!==void 0}get strokeCoords(){return this._strokeCoords}get unLeanStrokeCoords(){return this._unLeanStrokeCoords}get innermostStrokeCoordIndex(){return this._innermostStrokeCoordIndex}get innermostStrokeCoords(){return this._strokeCoords[this.innermostStrokeCoordIndex]}get flipX(){return!this.flipXEnable||!this.boxVerticesTransformEnable?!1:this._isTransforming?(this.refreshFlipX(),this._flipX):this._flipX}get flipY(){return!1}get flip(){return{flipX:this.flipX,flipY:this.flipY}}get flipXEnable(){return!0}get flipYEnable(){return!0}get widthModifyEnable(){return!0}get heightModifyEnable(){return!0}get rotationEnable(){return!0}get verticesRotationEnable(){return!0}get verticesTransformEnable(){return!1}get boxVerticesTransformEnable(){return!0}get borderTransformEnable(){return!0}get fillEnabled(){return!0}get strokeEnable(){return!0}get ratioLockedEnable(){return!0}get editingEnable(){return!0}get tfRefreshAfterEdChanged(){return!1}get shouldRatioLockResize(){return this.ratioLockedEnable&&(this.isRatioLocked||this.shield.event.isShift)}get originalCoords(){return this._originalCoords}get originalBoxCoords(){return this._originalBoxCoords}get width(){return this.model.width}get height(){return this.model.height}get minParallelogramVerticalSize(){return this._minParallelogramVerticalSize}get minLeanSize(){return this._minLeanSize}get angle(){return this.getAngle()}get corners(){return this.model.corners}get center(){return S.calcStageRelativePoint(this.centerCoord)}get centerCoord(){return this.calcCenterCoord()}get position(){return{x:this.model.x,y:this.model.y}}get strokes(){return this.model.styles.strokes}get fills(){return this.model.styles.fills}get textAlign(){return this.model.styles.textAlign}get textBaseline(){return this.model.styles.textBaseline}get fontSize(){return this.model.styles.fontSize}get fontFamily(){return this.model.styles.fontFamily}get status(){return this._status}set status(e){this._setStatus(e)}get isSelected(){return this._isSelected}set isSelected(e){this._setIsSelected(e)}get isVisible(){return this._isVisible}set isVisible(e){this._setIsVisible(e)}get isEditing(){return this._isEditing}set isEditing(e){this._setIsEditing(e)}get isLocked(){return this._isLocked}set isLocked(e){this._setIsLocked(e)}get isMoving(){return this._isMoving}set isMoving(e){this._setIsMoving(e)}get isTransforming(){return this._isTransforming}set isTransforming(e){this._setIsTransforming(e)}get isRotating(){return this._isRotating}set isRotating(e){this._setIsRotating(e)}get isRotatingTarget(){return this._isRotatingTarget}set isRotatingTarget(e){this._setIsRotatingTarget(e)}get isDragging(){return this._isDragging}set isDragging(e){this._setIsDragging(e)}get isCornerMoving(){return this._isCornerMoving}set isCornerMoving(e){this._setIsCornerMoving(e)}get isProvisional(){return this._isProvisional}set isProvisional(e){this._setIsRendered(e)}get isTarget(){return this._isTarget}set isTarget(e){this._setIsTarget(e)}get isInRange(){return this._isInRange}set isInRange(e){this._setIsInRange(e)}get isOnStage(){return this._isOnStage}set isOnStage(e){this._setIsOnStage(e)}get isRatioLocked(){return this.model.isRatioLocked}_setStatus(e){this._status=e}_setIsSelected(e){this._isSelected=e}_setIsVisible(e){this._isVisible=e}_setIsEditing(e){this._isEditing=e}_setIsLocked(e){this._isLocked=e}_setIsMoving(e){this._isMoving=e}_setIsTransforming(e){this._isTransforming=e}_setIsRotating(e){this._isRotating=e}_setIsRotatingTarget(e){this._isRotatingTarget=e}_setIsDragging(e){this._isDragging=e}_setIsRendered(e){this._isProvisional=e}_setIsTarget(e){this._isTarget=e}_setIsOnStage(e){this._isOnStage=e}_setIsInRange(e){this._isInRange=e}_setIsCornerMoving(e){this._isCornerMoving=e}get maxBoxCoords(){return this._maxBoxCoords}get maxOutlineBoxCoords(){return this._maxOutlineBoxCoords}get rotateCoords(){return this._rotateCoords}get rotateBoxCoords(){return this._rotateBoxCoords}get rotateOutlineCoords(){return this._rotateOutlineCoords}get transformers(){return this._transformers}get borderTransformers(){return this._borderTransformers}get transformerType(){return Le.rect}get rect(){return this._rect}get activeCoordIndex(){return-1}get alignCoords(){return this._rotateCoords}get alignOutlineCoords(){return this._rotateOutlineCoords}get visualStrokeWidth(){return Math.max(...this.strokes.map(e=>e.width*this.shield.stageScale))}get visualFontSize(){return this.fontSize*this.shield.stageScale}get originalAngle(){return this._originalAngle}set originalAngle(e){this._originalAngle=e}get transformMatrix(){return this._transformMatrix}get transformLockIndex(){return this._transformLockIndex}get transformLockCoord(){return this._transformLockCoord}get originalTransformMoveCoord(){return this._originalTransformMoveCoord}get transformType(){return this._transformType}get viewAngle(){return this.model.viewAngle}get internalAngle(){return this.model.internalAngle}get leanYAngle(){return this.model.leanYAngle}get angles(){return{angle:this.model.angle,leanYAngle:this.model.leanYAngle,internalAngle:this.model.internalAngle,actualAngle:this.model.actualAngle,viewAngle:this.model.viewAngle}}get leanY(){return-Math.tan(l.angleToRadian(this.model.leanYAngle))}get actualAngle(){return this.model.actualAngle}get viewAngleCalcEnable(){return!0}get leanYAngleCalcEnable(){return!0}get leanYAngleModifyEnable(){return!0}get cornersModifyEnable(){return!1}get rotateControllers(){return this._rotateControllers}get controllers(){const e=[];return this.rotationEnable&&(this.shield.configure.rotationIconEnable&&e.push(this.rotation),e.push(...this._rotateControllers)),(this.verticesTransformEnable||this.boxVerticesTransformEnable)&&e.push(...this._transformers),this.borderTransformEnable&&e.push(...this._borderTransformers),e}get isTopmost(){return this.node.next===null}get isBottommost(){return this.node.prev===null}get isInMultiSelected(){const{selectedElementIds:e}=this.shield.store;return e.has(this.model.id)&&e.size>1}get shouldPropChangedEmit(){const e=this.isInMultiSelected;return!e||e&&!this.isGroupSubject}onPositionChanged(){this.refresh(),this.emitPropChanged(k.positionChanged,[this.position])}onWidthChanged(){this.refresh(),this.emitPropChanged(k.widthChanged,[this.width])}onHeightChanged(){this.refresh(),this.emitPropChanged(k.heightChanged,[this.height])}onLayerChanged(){}onTranslateBefore(){this.refreshOriginalProps()}onTranslateAfter(){this.refreshOriginalProps()}onTranslating(){const{x:e,y:t}=S.calcPosition({type:this.model.type,coords:this.model.coords});this.model.x=e,this.model.y=t,this.refreshCorners(),this.refreshRotation(),this.refreshTransformers(),this.emitPropChanged(k.positionChanged,[this.position])}onRotateBefore(){this.refreshOriginalProps()}onRotateAfter(){this.refreshOriginalProps()}onRotating(){this.refresh({points:!0,rotation:!0,position:!0,angles:!0,outline:!0,strokes:!0,corners:!0}),this.emitPropChanged(k.angleChanged,[this.angle])}onTransformBefore(){this.refreshOriginalProps()}onTransformAfter(){this.refreshOriginalProps()}onTransforming(){this.refresh({points:!0,rotation:!0,size:!0,position:!0,angles:!0,outline:!0,strokes:!0,corners:!0},{angles:{view:!0,actual:!0}}),this.emitPropChanged(k.positionChanged,[this.position]),this.emitPropChanged(k.widthChanged,[this.width]),this.emitPropChanged(k.heightChanged,[this.height]),this.emitPropChanged(k.angleChanged,[this.angle]),this.emitPropChanged(k.flipXChanged,[this._flipX])}onAngleChanged(){this.refresh(null,{angles:{view:!0,actual:!0}}),this.emitPropChanged(k.angleChanged,[this.angle])}onLeanyAngleChanged(){this.refresh(null,{angles:{view:!0,actual:!0,internal:!0}}),this.emitPropChanged(k.leanYAngleChanged,[this.leanYAngle])}onCornerChanging(){this.refresh({corners:!0,strokes:!0}),this.emitPropChanged(k.cornersChanged,[this.corners])}onCornerChanged(){this.refresh({corners:!0,strokes:!0,originals:!0}),this.emitPropChanged(k.cornersChanged,[this.corners])}onStrokeTypeChanged(){this.refresh({strokes:!0,outline:!0,originals:!0}),this.emitPropChanged(k.strokesChanged,[this.strokes])}onStrokeWidthChanged(){this.refresh({strokes:!0,outline:!0,originals:!0}),this.emitPropChanged(k.strokesChanged,[this.strokes])}onStrokeColorChanged(){this.emitPropChanged(k.strokesChanged,[this.strokes])}onStrokeColorOpacityChanged(){this.emitPropChanged(k.strokesChanged,[this.strokes])}onStrokeAdded(){this.refresh({strokes:!0,outline:!0,originals:!0}),this.emitPropChanged(k.strokesChanged,[this.strokes])}onStrokeRemoved(){this.refresh({strokes:!0,outline:!0,originals:!0}),this.emitPropChanged(k.strokesChanged,[this.strokes])}onFillColorChanged(){this.emitPropChanged(k.fillsChanged,[this.fills])}onFillColorOpacityChanged(){this.emitPropChanged(k.fillsChanged,[this.fills])}onFillAdded(){this.emitPropChanged(k.fillsChanged,[this.fills])}onFillRemoved(){this.emitPropChanged(k.fillsChanged,[this.fills])}onTextAlignChanged(){this.emitPropChanged(k.textAlignChanged,[this.textAlign])}onTextBaselineChanged(){this.emitPropChanged(k.textBaselineChanged,[this.textBaseline])}onFontSizeChanged(){this.emitPropChanged(k.fontSizeChanged,[this.fontSize])}onFontFamilyChanged(){this.emitPropChanged(k.fontFamilyChanged,[this.fontFamily])}onRatioLockedChanged(){this.emitPropChanged(k.ratioLockedChanged,[this.isRatioLocked])}getAngle(){return this.model.angle}emitPropChanged(e,t){this.shouldPropChangedEmit&&this.shield.store.filterEmit(e,this,...t)}convertPointsByStrokeType(e,t){return J.convertPointsByStrokeType(e,t.type,t.width,{...this.flip,isFold:this.model.isFold})}calcRotateBoxCoords(){return this.model.boxCoords.map(e=>l.rotateWithCenter(e,this.model.angle,this.centerCoord))}calcMaxBoxCoords(){return b.getBoxPoints(this._rotateCoords)}calcMaxOutlineBoxCoords(){return b.getBoxPoints(this._rotateOutlineCoords.flat())}calcRotateCoords(){return this.model.coords.map(e=>l.rotateWithCenter(e,this.model.angle,this.centerCoord))}calcRotateOutlineCoords(){return this.model.styles.strokes.map(e=>S.calcOutlinePoints(this._rotateCoords,e.type,e.width,{...this.flip,isFold:this.model.isFold}))}calcCenterCoord(){return l.calcCenter(this.model.boxCoords)}getController4BoxCoords(e,t){return t=t||gt,b.get4BoxPoints(e,{width:t/this.shield.stageScale,height:t/this.shield.stageScale},{angle:this.model.actualAngle,leanYAngle:this.model.leanYAngle})}calcTransformersByCoords(e){return e.map((t,s)=>{const{x:r,y:n}=t,o=this.getController4BoxCoords(t);let a=this._transformers[s];return a?(a.points=o,a.x=r,a.y=n):a=new Ge(this,{points:o,x:r,y:n}),a})}calcBoxVerticesTransformers(){return this.calcTransformersByCoords(this._rotateBoxCoords)}calcVerticesTransformers(){return this.calcTransformersByCoords(this._rotateCoords)}calcTransformers(){if(this.verticesTransformEnable)return this.calcVerticesTransformers();if(this.boxVerticesTransformEnable)return this.calcBoxVerticesTransformers()}calcRotateControllers(){const e=this.centerCoord;return this._rotateBoxCoords.map((t,s)=>{const r=l.calcAngle(e,t),{x:n,y:o}=l.calcTargetPoint(t,si/this.shield.stageScale,r),a=this.getController4BoxCoords({x:n,y:o},ft);let c=this._rotateControllers[s];return c?(c.points=a,c.x=n,c.y=o):c=new tr(this,{x:n,y:o,points:a}),c})}calcBorderTransformers(){return this._rotateBoxCoords.map((t,s)=>{const r=b.getNextOfArray(this._rotateBoxCoords,s);let n=this._borderTransformers[s];return n?(n.start=t,n.end=r):n=new st(this,{start:t,end:r,index:s}),n})}calcUnLeanCoords(){return l.calcUnLeanByPoints(this.model.coords,0,this.model.leanYAngle)}calcUnLeanBoxCoords(){return l.calcUnLeanByPoints(this.model.boxCoords,0,this.model.leanYAngle)}calcStrokeCoords(){return this.model.styles.strokes.map(e=>this.convertPointsByStrokeType(this._rotateCoords,e))}calcInnermostStrokeCoordIndex(){let e=0,t=0;return this._strokeCoords.forEach((s,r)=>{const{width:n,type:o}=this.model.styles.strokes[r];o===U.middle&&t<n/2&&(t=n/2,e=r),o===U.inside&&t<n&&(t=n,e=r)}),e}calcUnLeanStrokeCoords(){return this.model.styles.strokes.map(e=>this.convertPointsByStrokeType(this._unLeanCoords,e))}calcInternalAngle(){return this._isRangeElement?90:l.calcInternalAngle(this.model.boxCoords)}calcLeanYAngle(){return!this.leanYAngleCalcEnable||this._isRangeElement?0:l.calcLeanYAngle(this.model.internalAngle,this.flipX)}calcViewAngle(){return this.viewAngleCalcEnable?l.calcViewAngleByPoints(this._rotateBoxCoords):this.model.angle}calcActualAngle(){return l.mirrorAngle(this.model.viewAngle-this.model.leanYAngle)}calcPrimitiveSize(){return b.calcRectangleSize(l.batchLeanWithCenter(this.model.boxCoords,-this.model.leanXAngle,-this.model.leanYAngle,this.centerCoord))}refreshAngles(e){e=e||Fn,e.view&&(this.model.viewAngle=this.calcViewAngle()),e.internal&&(this.model.internalAngle=this.calcInternalAngle()),e.leanY&&(this.model.leanYAngle=this.calcLeanYAngle()),e.actual&&(this.model.actualAngle=this.calcActualAngle())}refreshRotation(){this.rotationEnable&&(this.shield.configure.rotationIconEnable&&this.rotation.refresh(),this._rotateControllers=this.calcRotateControllers())}refreshPoints(){this._rotateCoords=this.calcRotateCoords(),this._rotateBoxCoords=this.calcRotateBoxCoords(),this._unLeanCoords=this.calcUnLeanCoords(),this._unLeanBoxCoords=this.calcUnLeanBoxCoords(),this._maxBoxCoords=this.calcMaxBoxCoords(),this.refreshTransformers()}isContainsCoord(e){return P.some(this._rotateOutlineCoords,t=>l.isPointInPolygonByRayCasting(e,t))}isPolygonOverlap(e){return P.some(this._rotateOutlineCoords,t=>l.isPolygonsOverlap(t,e))}isModelPolygonOverlap(e){return P.some(this._rotateOutlineCoords,t=>l.isPolygonsOverlap(t,e))}refreshOriginalElementProps(){this.refreshOriginalCoords(),this.refreshOriginalStrokes(),this._originalSize={width:this.model.width,height:this.model.height},this._originalCorners=z.jsonClone(this.model.corners),this._originalTransformMatrix=[]}refreshOriginalCoords(){this._originalCoords=z.jsonClone(this.model.coords),this._originalBoxCoords=z.jsonClone(this.model.boxCoords),this._originalRotateCoords=z.jsonClone(this._rotateCoords),this._originalRotateBoxCoords=z.jsonClone(this._rotateBoxCoords),this._originalUnLeanCoords=z.jsonClone(this._unLeanCoords),this._originalUnLeanBoxCoords=z.jsonClone(this._unLeanBoxCoords),this._originalCenterCoord=z.jsonClone(this.centerCoord),this._originalRotateOutlineCoords=z.jsonClone(this._rotateOutlineCoords),this._originalMaxOutlineBoxCoords=z.jsonClone(this._maxOutlineBoxCoords),this._originalMaxBoxCoords=z.jsonClone(this._maxBoxCoords)}refreshOriginalStrokes(){this._originalStrokeCoords=z.jsonClone(this._strokeCoords),this._originalUnLeanStrokeCoords=z.jsonClone(this._unLeanStrokeCoords)}refreshOriginalTransformerCoords(){this._originalTransformerCoords=this.transformers.map(e=>{const{x:t,y:s}=e;return{x:t,y:s}})}refreshOriginalProps(){this.refreshOriginalTransformerCoords(),this.refreshOriginalElementProps()}refreshSize(){const{width:e,height:t}=S.calcSize(this.model);if(this.model.width=l.precise(e,1),this.model.height=l.precise(t,1),this._rotateBoxCoords&&this._rotateBoxCoords.length){const{width:s,height:r}=l.calcParallelogramVerticalSize(this._rotateBoxCoords);this._minParallelogramVerticalSize=Math.min(s,r),this._minLeanSize=Math.min(this.model.width,r)}}refreshPosition(){Object.assign(this.model,this.calcCenterCoord())}refreshTransformers(){this._transformers=this.calcTransformers(),this.borderTransformEnable&&(this._borderTransformers=this.calcBorderTransformers())}flipAngle(){let e;this.model.angle>0?e=this.model.angle-180:e=this.model.angle+180,this.model.angle=l.mirrorAngle(e)}batchCalcTransformPointsByCenter(e,t,s,r){return this.calcTransformPointsByCenter(e,t,s,r,this.angles)}calcTransformPointsByCenter(e,t,s,r,n){const o=S.calcMatrixPoint(r,t,s,n);return e.map(a=>(a=S.calcMatrixPoint(a,t,s,n),l.rotateWithCenter(a,-n.angle,o)))}transform(e){this.getActiveController()instanceof Ge?(this.transformByVertices(e),this._transformType=ct.vertices):this.getActiveController()instanceof st&&(this.transformByBorder(e),this._transformType=ct.border)}transformBy(e){const{lockCoord:t,lockIndex:s,transformType:r,originalMovingCoord:n,offset:o,groupAngle:a,groupLeanYAngle:c}=e,h={angle:a,leanYAngle:c},d=this.getTransformMatrix(t,n,o,h,!1);r===ct.border&&this._transBorderMatrix(d,s,!1),this._doTransformBy(d,t,h,n)}_doTransformBy(e,t,s,r){const n=S.calcMatrixPoints(this._originalRotateCoords,e,t,s),o=S.calcMatrixPoints(this._originalRotateBoxCoords,e,t,s);this._doTransformByPoints(n,o,t,e,r)}_doTransformByPoints(e,t,s,r,n){this.model.internalAngle=l.calcInternalAngle(t),this.model.leanYAngle=l.calcLeanYAngle(this.model.internalAngle,l.calcFlipXByPoints(t)),this.model.angle=l.mirrorAngle(l.calcActualAngleByPoints(t)),this.model.coords=l.batchPrecisePoint(S.calcCoordsByTransPoints(e,this.angles,s),1),this.model.boxCoords=l.batchPrecisePoint(S.calcCoordsByTransPoints(t,this.angles,s),1),n&&r&&this._tryFlipAngle(s,n,r)}transformByVertices(e){!this.verticesTransformEnable&&!this.boxVerticesTransformEnable||this.doVerticesTransform(e)}doVerticesTransform(e){const t=this._transformers.findIndex(s=>s.isActive);if(t!==-1){const s=b.getPrevIndexOfArray(this._transformers.length,t,2),r=this._originalTransformerCoords[s],n=this._originalTransformerCoords[t];this._originalTransformMoveCoord=n,this.transformByLockPoint(r,n,e,t)}}transformByLockPoint(e,t,s,r){const n=this.getTransformMatrix(e,t,s,this.angles);this._transformMatrix=n,this._transformLockCoord=e,this._transformLockIndex=r,this.model.coords=l.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,n,e,this._originalCenterCoord),1),this.model.boxCoords=l.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,n,e,this._originalCenterCoord),1),this._tryFlipAngle(e,t,n)}getTransformMatrix(e,t,s,r,n){typeof n>"u"&&(n=!0);const o={x:t.x+s.x,y:t.y+s.y},a=l.calcTransformMatrix(e,o,t,r);return n&&this.shouldRatioLockResize&&(a[1][1]=l.resignValue(a[1][1],a[0][0])),a}_tryFlipAngle(e,t,s){this._originalTransformMatrix.length||(this._originalTransformMatrix=l.calcTransformMatrix(e,t,t,this.angles));const r=this._doFlipAngle(s,this._originalTransformMatrix);return r&&(this._originalTransformMatrix=z.jsonClone(s)),r}_doFlipAngle(e,t){t[0][0];const s=t[1][1];e[0][0];const r=e[1][1];return l.isSameSign(r,s)?!1:(this.flipAngle(),!0)}transformByBorder(e){this.borderTransformEnable&&this.doBorderTransform(e)}getBorderTransformLockCoord(e){const t=b.getPrevIndexOfArray(this._borderTransformers.length,e,2),s=b.getNextIndexOfArray(this._borderTransformers.length,e,3);return l.calcCenter([this._originalTransformerCoords[t],this._originalTransformerCoords[s]])}_transBorderMatrix(e,t,s){typeof s>"u"&&(s=!0);const r=s&&this.shouldRatioLockResize;return t===0||t===2?e[0][0]=r?l.resignValue(e[0][0],e[1][1]):1:(t===1||t===3)&&(e[1][1]=r?l.resignValue(e[1][1],e[0][0]):1),[1,3].includes(t)&&e[1][1]<0&&(e[1][1]=Math.abs(e[1][1])),[0,2].includes(t)&&e[0][0]<0&&(e[0][0]=Math.abs(e[0][0])),e}doBorderTransform(e){const t=this._borderTransformers.findIndex(s=>s.isActive);if(t!==-1){const s=this.getBorderTransformLockCoord(t),r=this._originalTransformerCoords[t];this._originalTransformMoveCoord=r;const n={x:r.x+e.x,y:r.y+e.y},o=l.calcTransformMatrix(s,n,r,this.angles);this._transBorderMatrix(o,t),this._transformMatrix=o,this._transformLockCoord=s,this._transformLockIndex=t,this.model.coords=l.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,o,s,this._originalCenterCoord),1),this.model.boxCoords=l.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,o,s,this._originalCenterCoord),1),this._tryFlipAngle(s,r,o)}}translateBy(e){this.model.coords=l.batchTranslate(this._originalCoords,e),this.model.boxCoords=l.batchTranslate(this._originalBoxCoords,e),this._rotateCoords=l.batchTranslate(this._originalRotateCoords,e),this._rotateBoxCoords=l.batchTranslate(this._originalRotateBoxCoords,e),this._unLeanCoords=l.batchTranslate(this._originalUnLeanCoords,e),this._unLeanBoxCoords=l.batchTranslate(this._originalUnLeanBoxCoords,e),this._unLeanStrokeCoords=this._originalUnLeanStrokeCoords.map(t=>l.batchTranslate(t,e)),this._strokeCoords=this._originalStrokeCoords.map(t=>l.batchTranslate(t,e)),this._maxBoxCoords=l.batchTranslate(this._originalMaxBoxCoords,e),this._maxOutlineBoxCoords=l.batchTranslate(this._originalMaxOutlineBoxCoords,e),this._rotateOutlineCoords=this._originalRotateOutlineCoords.map(t=>l.batchTranslate(t,e))}refresh(e,t){e=e||Dn,e!=null&&e.points&&this.refreshPoints(),e!=null&&e.size&&this.refreshSize(),e!=null&&e.position&&this.refreshPosition(),e!=null&&e.angles&&this.refreshAngles(t==null?void 0:t.angles),e!=null&&e.rotation&&this.refreshRotation(),e!=null&&e.corners&&this.refreshCorners(),e!=null&&e.strokes&&this.refreshStrokePoints(),e!=null&&e.outline&&this.refreshOutlinePoints(),e!=null&&e.originals&&this.refreshOriginalProps()}refreshOutlinePoints(){this._rotateOutlineCoords=this.calcRotateOutlineCoords(),this._maxOutlineBoxCoords=this.calcMaxOutlineBoxCoords()}refreshFlipX(){var e;(e=this.model.boxCoords)!=null&&e.length&&(this._flipX=l.calcFlipXByPoints(this.model.boxCoords))}setWidth(e){const t=l.calcScaleMatrix(e/this._originalSize.width,1);return t[1][1]=this.shouldRatioLockResize?l.resignValue(t[1][1],t[0][0]):1,this._setWH(t),t}setHeight(e){const t=l.calcScaleMatrix(1,e/this._originalSize.height);return t[0][0]=this.shouldRatioLockResize?l.resignValue(t[0][0],t[1][1]):1,this._setWH(t),t}scaleBy(e,t,s,r){const n=l.calcScaleMatrix(t,s);r?this._doTransformBy(n,e,r):(this.model.coords=l.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,n,e,this._originalCenterCoord),1),this.model.boxCoords=l.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,n,e,this._originalCenterCoord),1)),this.refresh({points:!0,size:!0,position:!0,rotation:!0,originals:!0,outline:!0,strokes:!0,corners:!0})}_setWH(e){this._transformMatrix=e,this._transformLockCoord=this._originalCenterCoord,this.model.coords=l.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,e,this._originalCenterCoord,this._originalCenterCoord),1),this.model.boxCoords=l.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,e,this._originalCenterCoord,this._originalCenterCoord),1)}setPosition(e,t,s){this.model.x=e,this.model.y=t,this.model.coords=l.batchPrecisePoint(l.batchTranslate(this.model.coords,s),1),this.model.boxCoords=l.batchPrecisePoint(l.batchTranslate(this.model.boxCoords,s),1)}setAngle(e){this.model.angle=e}setLeanYAngle(e){e=P.clamp(e,-89,89);const t=this.calcUnLeanCoords(),s=this.centerCoord;this.model.coords=l.batchPrecisePoint(l.batchLeanYWithCenter(t,e,s),1);const r=this.calcUnLeanBoxCoords();this.model.boxCoords=l.batchPrecisePoint(l.batchLeanYWithCenter(r,e,s),1),this.model.leanYAngle=e}leanYBy(e,t,s,r){let n=l.batchTransWithCenter(this._rotateCoords,{angle:s,leanYAngle:t},r,!0),o=l.batchTransWithCenter(this._rotateBoxCoords,{angle:s,leanYAngle:t},r,!0);n=l.batchTransWithCenter(n,{angle:s,leanYAngle:e},r),o=l.batchTransWithCenter(o,{angle:s,leanYAngle:e},r),this._doTransformByPoints(n,o,r)}refreshCorners(){}refreshStrokePoints(){this._strokeCoords=this.calcStrokeCoords(),this._unLeanStrokeCoords=this.calcUnLeanStrokeCoords(),this._innermostStrokeCoordIndex=this.calcInnermostStrokeCoordIndex()}setCorners(e,t){let s=z.jsonClone(this.model.corners);P.isNumber(t)?s[t]=e:s.fill(e),s=S.fixCornersBasedOnMinSize(s,this._minParallelogramVerticalSize),this.model.corners=s}setStrokeType(e,t){this.model.styles.strokes[t].type=e}setStrokeColor(e,t){this.model.styles.strokes[t].color=e}setStrokeColorOpacity(e,t){this.model.styles.strokes[t].colorOpacity=P.clamp(e,0,1)}setStrokeWidth(e,t){switch(this.model.styles.strokes[t].type){case U.middle:e=P.clamp(e,0,this._minLeanSize);break;case U.inside:e=P.clamp(e,0,this._minLeanSize/2);break;case U.outside:e=P.clamp(e,0,this._minLeanSize*2);break}e=l.precise(e,1),this.model.styles.strokes[t].width=e}addStroke(e){this.model.styles.strokes.splice(e+1,0,{...St})}removeStroke(e){this.model.styles.strokes.splice(e,1)}setFillColor(e,t){this.model.styles.fills[t].color=e}setFillColorOpacity(e,t){this.model.styles.fills[t].colorOpacity=P.clamp(e,0,1)}addFill(e){this.model.styles.fills.splice(e+1,0,{...xt})}removeFill(e){this.model.styles.fills.splice(e,1)}setFontSize(e){this.model.styles.fontSize=e}setFontFamily(e){this.model.styles.fontFamily=e}setTextAlign(e){this.model.styles.textAlign=e}setTextBaseline(e){this.model.styles.textBaseline=e}setRatioLocked(e){this.model.isRatioLocked=e,e?this.model.ratio=this.model.width/this.model.height:this.model.ratio=null}rotateBy(e,t){const s=l.rotateWithCenter(this._originalCenterCoord,e,t),r={x:s.x-this._originalCenterCoord.x,y:s.y-this._originalCenterCoord.y},n=this._originalCoords.map(a=>l.translate(a,r)),o=this._originalBoxCoords.map(a=>l.translate(a,r));this.model.coords=l.batchPrecisePoint(n,1),this.model.boxCoords=l.batchPrecisePoint(o,1),this.model.angle=l.mirrorAngle(l.normalizeAngle(this._originalAngle)+l.normalizeAngle(e)%360)}getActiveController(){return this.controllers.find(e=>e.isActive)}setControllersActive(e,t){e.forEach(s=>s.isActive=t)}getControllerByCoord(e){return this.controllers.find(t=>t.isCoordHitting(e))}refreshOriginalAngle(){this._originalAngle=this.model.angle}async toJson(){return JSON.parse(JSON.stringify({...this.model,...this.flip}))}fromJson(e){this.model=JSON.parse(JSON.stringify(e))}_toOriginalCommonJson(){const{id:e,_originalCoords:t,_originalBoxCoords:s,_originalCenterCoord:{x:r,y:n}}=this;return{id:e,coords:t,boxCoords:s,x:r,y:n}}async toOriginalTranslateJson(){const e=this._toOriginalCommonJson();return JSON.parse(JSON.stringify(e))}async toTranslateJson(){return JSON.parse(JSON.stringify(P.pick(this.model,[...Mt])))}async toOriginalRotateJson(){const e=this._toOriginalCommonJson();return e.angle=this._originalAngle,JSON.parse(JSON.stringify(e))}async toRotateJson(){return JSON.parse(JSON.stringify(P.pick(this.model,[...Mt,"angle"])))}async toOriginalTransformJson(){const e=this._toOriginalCommonJson();return e.width=this._originalSize.width,e.height=this._originalSize.height,e.angle=this._originalAngle,JSON.parse(JSON.stringify(e))}async toTransformJson(){return JSON.parse(JSON.stringify(P.pick(this.model,[...Mt,"width","height","angle"])))}async toOriginalCornerJson(){const{id:e,_originalCorners:t}=this;return JSON.parse(JSON.stringify({id:e,corners:t}))}async toCornerJson(){return JSON.parse(JSON.stringify(P.pick(this.model,["id","corners"])))}async toStrokesJson(){return JSON.parse(JSON.stringify(P.pick(this.model,["id","styles.strokes"])))}async toFillsJson(){return JSON.parse(JSON.stringify(P.pick(this.model,["id","styles.fills"])))}async toGroupJson(){return JSON.parse(JSON.stringify(P.pick(this.model,["id","groupId"])))}};class mt extends ts{}class or extends Fe{constructor(){super(...arguments);u(this,"_cornerControllers",[]);u(this,"_cornerCoords",[]);u(this,"_originalCornerCoords",[]);u(this,"_originalAllCornerEqual",!1);u(this,"_arcCoords",[]);u(this,"_arcFillCoords",[]);u(this,"_originalArcCoords",[]);u(this,"_originalArcFillCoords",[])}get cornersModifyEnable(){return!0}get cornerControllers(){return this._cornerControllers}get normalizeCorners(){return this._normalizeCorners()}get cornerCoords(){return this._cornerCoords}get visualCorners(){return this.normalizeCorners.map(t=>this._getCorner(t))}get editingEnable(){return!1}get controllers(){return[...super.controllers,...this.cornerControllers]}get isAllCornerEqual(){return P.uniq(this.model.corners).length===1}get arcCoords(){return this._arcCoords}get arcFillCoords(){return this._arcFillCoords}calcArcCoords(){return this.model.styles.strokes.map(t=>this._getArcVerticalCoords(t))}calcArcFillCoords(){const t=this.innermostStrokeCoordIndex;let s=this.model.styles.strokes[t],{width:r,type:n}=s;switch(n){case U.inside:{r=r*2;break}case U.middle:{r=r;break}case U.outside:{r=0;break}}return s={...s,type:U.inside,width:r},this._getArcVerticalCoords(s)}_getArcBoxCoords(t){const{type:s,width:r}=t;let n=this.calcUnLeanBoxCoords();const{width:o,height:a}=b.calcRectangleSize(n);let c=1,h=1;switch(s){case U.outside:{c=(o+r)/o,h=(a+r)/a;break}case U.inside:{c=(o-r)/o,h=(a-r)/a;break}}return[U.inside,U.outside].includes(s)&&(n=l.batchScaleWithCenter(n,{sx:c,sy:h},this.centerCoord)),n}_getArcCorner(t,s){let r=this.normalizeCorners;const{type:n,width:o}=s,{width:a,height:c}=l.calcParallelogramVerticalSize(t),h=Math.min(a,c);return r=r.map(d=>{if(d===0)return d;switch(n){case U.inside:return P.clamp(d-o/2,0,h/2);case U.outside:return P.clamp(d+o/2,0,h/2);default:return d}}),r}_getVerticalIntersection(t,s){return{coords:l.calcParallelogramVerticalIntersectionPoints(t,s,!0),indexes:[[0,1],[1,2],[2,3],[3,0]]}}_getCrossPointsOfParallelLines(t,s){return{coords:l.calcCrossPointsOfParallelLines(t,s),indexes:[[3,0],[0,1],[1,2],[2,3]]}}_getArcVerticalCoords(t){let s=this.calcUnLeanBoxCoords();s=this._getArcBoxCoords(t);const r=this._getArcCorner(s,t),n=[];return P.range(4).forEach(o=>{const a=s[o],c=r[o],h=this.calcUnLeanCornerCoordBy(a,o,c);let d=s[o],g,f;if(!c)g=s[o],f=s[o];else{const{coords:C,indexes:p}=this._getVerticalIntersection(h,s);g=C[p[o][0]],f=C[p[o][1]],g||(g=s[o]),f||(f=s[o])}n.push({start:g,controller:d,end:f,value:c,corner:h})}),n}calcUnLeanCornerCoord(t,s){const r=s?this.normalizeCorners[t]:this.visualCorners[t],n=l.leanWithCenter(this.model.boxCoords[t],this.model.leanXAngle,-this.model.leanYAngle,this.centerCoord);return this.calcUnLeanCornerCoordBy(n,t,r)}calcUnLeanCornerCoordBy(t,s,r){if(r===0)return t;let n,o;return[0,3].includes(s)?n=this.flipX?-r:r:n=this.flipX?r:-r,[0,1].includes(s)?o=r:o=-r,l.translate(t,{x:n,y:o})}calcCornerCoord(t,s){const r=this._rotateBoxCoords[t],n=this.visualCorners[t];let o=this.calcUnLeanCornerCoord(t,s);o=l.transWithCenter(o,this.angles,this.centerCoord);const{coords:a,indexes:c}=this._getCrossPointsOfParallelLines(o,this._rotateBoxCoords);let h=a[c[t][0]],d=a[c[t][1]];if(!h||!d)return r;let g=l.calcTriangleAngleWithClockwise(h,r,d);const f=this.flipX;f&&(g=180-g);const C=l.calcAngle(r,d)+(f?-g/2:g/2),p=this._getCornerTargetCoord(t,this._rotateBoxCoords),_=l.calcDistance(r,p)*2,v=n/this.minParallelogramVerticalSize,V=_*v;return l.calcTargetPoint(r,V,C)}refreshCornersController(t){if(this._cornerCoords.length===0)return;const{x:s,y:r}=this._cornerCoords[t],n=this.getController4BoxCoords(this._cornerCoords[t]);this._cornerControllers[t]?(this._cornerControllers[t].x=s,this._cornerControllers[t].y=r,this._cornerControllers[t].points=n):this._cornerControllers[t]=new mt(this,{x:s,y:r,points:n})}refreshCornerCoords(t){!this._rotateBoxCoords||!this._rotateBoxCoords.length||(this._cornerCoords[t]=this.calcCornerCoord(t))}refreshCornersCoords(t){t=t||[0,1,2,3],t.forEach(s=>{this.refreshCornerCoords(s)})}refreshCornersControllers(t){t=t||[0,1,2,3],t.forEach(s=>{this.refreshCornersController(s)})}_refreshCorners(){this.status===Z.finished&&(this.refreshCornersCoords(),this.refreshCornersControllers())}refreshCorners(){super.refreshCorners(),this.isInMultiSelected||this._refreshCorners()}refreshStrokePoints(){super.refreshStrokePoints(),this._arcCoords=this.calcArcCoords(),this._arcFillCoords=this.calcArcFillCoords()}_getCorner(t){return this._isCornerMoving?t:t===0?this.minParallelogramVerticalSize/2*.2:t}refreshOriginalElementProps(){super.refreshOriginalElementProps(),this._originalCornerCoords=z.jsonClone(this._cornerCoords),this._originalAllCornerEqual=this.isAllCornerEqual}refreshOriginalStrokes(){super.refreshOriginalStrokes(),this._originalArcCoords=z.jsonClone(this._arcCoords),this._originalArcFillCoords=z.jsonClone(this._arcFillCoords)}_getCornerTargetCoord(t,s){let r,[n,o]=l.calculateAngleBisectorIntersection(s);const{width:a,height:c}=l.calcParallelogramVerticalSize(s);return a<=c?[0,1].includes(t)?r=n:r=o:[0,3].includes(t)?r=n:r=o,r}updateCornerByOffset(t){const s=this.getActiveController();if(s instanceof mt){const r=this.cornerControllers.indexOf(s);if(r!==-1){const n=this._getCornerTargetCoord(r,this._rotateBoxCoords),o=this._originalCornerCoords[r],a={x:t.x+o.x,y:t.y+o.y},c=this._rotateBoxCoords[r],h=l.calcProjectionOnSegment(a,n,c);let d=l.calcSegmentProportion(h,n,c);d=P.clamp(d,0,1),d=1-d;let g=d*(this.minParallelogramVerticalSize/2);this._originalAllCornerEqual?this.setCorners(g):this.setCorners(g,r)}}}_normalizeCorners(){const t=[...this.model.corners];return P.every(t,s=>s===0)?t:S.fixCornersBasedOnMinSize(t,this.minParallelogramVerticalSize)}_translateArc(t){this._arcCoords=l.batchTranslateArcPoints(this._originalArcCoords,t),this._arcFillCoords=l.translateArcPoints(this._originalArcFillCoords,t)}translateBy(t){this._translateArc(t),super.translateBy(t)}_setIsSelected(t){super._setIsSelected(t),t&&this._refreshCorners()}}class ui extends Fe{constructor(){super(...arguments);u(this,"_outerCoords",[]);u(this,"_originalOuterCoords",[])}get editingEnable(){return!1}get flipXEnable(){return!1}get flipYEnable(){return!1}get verticesTransformEnable(){return!0}get boxVerticesTransformEnable(){return!1}get heightModifyEnable(){return!1}get rotationEnable(){return!1}get borderTransformEnable(){return!1}get fillEnabled(){return!1}get ratioLockedEnable(){return!1}get viewAngleCalcEnable(){return!1}get leanYAngleCalcEnable(){return!1}get leanYAngleModifyEnable(){return!1}get startRotateCoord(){return this._rotateCoords[0]}get endRotateCoord(){return this._rotateCoords[1]}get outerCoords(){return this._outerCoords}get transformerType(){return Le.circle}get alignOutlineCoords(){return this._outerCoords}refreshBentOutline(){this._outerCoords=this.calcOuterCoords(),this._maxOutlineBoxCoords=b.getBoxPoints(this._outerCoords.flat())}refreshPoints(){super.refreshPoints(),this.refreshBentOutline()}calcOuterCoords(){return this.model.styles.strokes.map(t=>Ce.calcBentLineOuterVertices(this._rotateCoords,t.width/2))}refreshOutlinePoints(){super.refreshOutlinePoints(),this.refreshBentOutline()}getAngle(){return this.startRotateCoord&&this.endRotateCoord?S.fixAngle(l.calcAngle(this.startRotateCoord,this.endRotateCoord)+90):0}isContainsCoord(t){return P.some(this.model.styles.strokes,s=>l.isPointClosestSegment(t,this.startRotateCoord,this.endRotateCoord,Cn+s.width/2/this.shield.stageScale))}isPolygonOverlap(t){return P.some(this._outerCoords,s=>l.isPolygonsOverlap(s,t))}isModelPolygonOverlap(t){return P.some(this._outerCoords,s=>l.isPolygonsOverlap(s,t))}doVerticesTransform(t){const s=this._transformers.findIndex(r=>r.isActive);if(s!==-1){const r=this._originalTransformerCoords[b.getNextIndexOfArray(2,s,1)],n=this._originalTransformerCoords[s];this.transformByLockPoint(r,n,t,s)}}setWidth(t){const s=l.calcTargetPoint(this.startRotateCoord,t,this.angle-90);return this.model.coords=[this.startRotateCoord,s],this.model.boxCoords=b.getBoxPoints(this.model.coords),this.model.width=t,this.model.angle=0,[[]]}setAngle(t){const s=l.calcTargetPoint(this.startRotateCoord,this.model.width,t-90);this.model.coords=[this.startRotateCoord,s],this.model.boxCoords=b.getBoxPoints(this.model.coords),this.model.angle=0}translateBy(t){this._outerCoords=this._originalOuterCoords.map(s=>l.batchTranslate(s,t)),super.translateBy(t)}refreshOriginalStrokes(){super.refreshOriginalStrokes(),this._originalOuterCoords=z.jsonClone(this._outerCoords)}}class gi extends $e{async run(){if(!this.canvas||!this.element)return;const{strokeCoords:e,model:{styles:t}}=this.element;S.batchCalcStageRelativePoints(e).forEach((r,n)=>{J.drawPathWithScale(this.canvas,r,t,t.fills[0],t.strokes[n])})}}class ws extends or{get fillEnabled(){return!1}async toJson(){const e=await super.toJson(),t=this.model.data,s=await J.getDataUrlFromImage(t);return e.data=s,e}}class fi extends $e{async run(){if(!this.canvas||!this.element)return;const{arcCoords:e,arcFillCoords:t,model:{styles:s},angle:r,flipX:n,leanY:o,actualAngle:a,rotateBoxCoords:c,center:h}=this.element,d=S.batchCalcStageRelativeArcPoints(e),g=S.calcStageRelativePoints(c),f=S.calcStageRelativeArcPoints(t),C={angle:r,flipX:n,leanY:o,actualAngle:a};let p=b.calcRotateBoxRect(g,h);p=b.scaleRect(p,this.element.shield.stageScale),J.drawImgLike(this.canvas,this.element.model.data,p,{...C,clipArcPoints:f}),d.forEach((_,v)=>{J.drawArcPathStrokeWidthScale(this.canvas,_,p,s.strokes[v],C)})}}class mi extends $e{async run(){if(!this.canvas||!this.element)return;let{innermostStrokeCoordIndex:e,strokeCoords:t,model:{styles:s,isFold:r}}=this.element;const n=S.batchCalcStageRelativePoints(t);r&&s.fills.forEach(o=>{J.drawInnerPathFillWithScale(this.canvas,n[e],o,s.strokes[e])}),n.forEach((o,a)=>{J.drawPathStrokeWidthScale(this.canvas,o,s.strokes[a],{isFold:r,miterLimit:Bn})})}}class pi extends Fe{constructor(t,s){super(t,s);u(this,"tailCoordIndex");u(this,"editingCoordIndex");u(this,"_outerWorldPaths",[]);u(this,"_originalOuterWorldPaths",[]);this.tailCoordIndex=-1}get transformerType(){return Le.circle}get verticesTransformEnable(){return this.status!==Z.finished}get boxVerticesTransformEnable(){return this.status===Z.finished}get borderTransformEnable(){return this.status===Z.finished}get activeCoordIndex(){return[Z.startCreating,Z.creating,Z.initialed].includes(this.status)?this.model.coords.length>this.tailCoordIndex+1?this.tailCoordIndex+1:this.tailCoordIndex:-1}get outerWorldPaths(){return this._outerWorldPaths}get tfRefreshAfterEdChanged(){return!0}_setStatus(t){super._setStatus(t),t===Z.finished&&(this.tailCoordIndex=-1)}calcOuterWorldPaths(){return this._strokeCoords.map((t,s)=>S.calcArbitraryBorderRegions(t,this.model.styles.strokes[s],this.model.isFold))}refreshOutlinePoints(){this._outerWorldPaths=this.calcOuterWorldPaths(),super.refreshOutlinePoints()}refreshOriginalStrokes(){super.refreshOriginalStrokes(),this._originalOuterWorldPaths=z.jsonClone(this._outerWorldPaths)}isContainsCoord(t){let s;return this.visualStrokeWidth<ms?s=this._strokeCoords.map(r=>S.calcArbitraryBorderRegions(r,{width:ms/this.shield.stageScale},this.model.isFold)):s=this._outerWorldPaths,P.some(s,r=>P.some(r,n=>l.isPointInPolygonByRayCasting(t,n)))}isPolygonOverlap(t){return P.some(this._outerWorldPaths,s=>P.some(s,r=>l.isPolygonsOverlap(r,t)))}isModelPolygonOverlap(t){return P.some(this._outerWorldPaths,s=>P.some(s,r=>l.isPolygonsOverlap(r,t)))}calcRotateOutlineCoords(){return this._outerWorldPaths.flat()}activeEditingCoord(t){this.editingCoordIndex=t}deActiveEditingCoord(){this.editingCoordIndex=-1}setControllersActive(t,s){super.setControllersActive(t,s),t.forEach(r=>{if(r instanceof Ge){const n=this._transformers.findIndex(o=>o.id===r.id);if(n===-1)return;s?this.activeEditingCoord(n):this.deActiveEditingCoord()}})}doVerticesTransform(t){this.status===Z.editing?this.doEditingTransform(t):super.doVerticesTransform(t)}doEditingTransform(t){if(this.editingCoordIndex!==-1){const s=z.jsonClone(this._originalRotateCoords);s[this.editingCoordIndex]={x:s[this.editingCoordIndex].x+t.x,y:s[this.editingCoordIndex].y+t.y};const r=this._originalRotateBoxCoords[0];this.model.coords=l.batchPrecisePoint(S.calcCoordsByTransPoints(s,this.angles,r),1),this.model.boxCoords=l.batchPrecisePoint(l.batchLeanWithCenter(b.getBoxPoints(l.calcUnLeanByPoints(this.model.coords,0,this.model.leanYAngle)),0,this.model.leanYAngle,this.calcCenterCoord()),1)}}_translateOuterCoords(t){this._outerWorldPaths=this._originalOuterWorldPaths.map((s,r)=>s.map(n=>n.map(o=>l.translate(o,t))))}translateBy(t){this._translateOuterCoords(t),super.translateBy(t)}}class ns extends Fe{get subs(){return this.getSubs()}get deepSubs(){return this.getDeepSubs()}get strokeEnable(){return!1}get fillEnabled(){return!1}get editingEnable(){return!1}get alignOutlineCoords(){return[b.getBoxPoints(this.subs.map(e=>e.alignOutlineCoords.flat()).flat())]}addSub(e){this.model.subIds.push(e.id)}removeSub(e){const t=this.model.subIds.indexOf(e.id);t!==-1&&this.model.subIds.splice(t,1)}removeSubById(e){const t=this.model.subIds.indexOf(e);t!==-1&&this.model.subIds.splice(t,1)}hasSub(e){var t;return(t=this.model.subIds)==null?void 0:t.includes(e.id)}hasSubById(e){var t;return(t=this.model.subIds)==null?void 0:t.includes(e)}getSubs(){return this.shield.store.getElementsByIds(this.model.subIds)}getDeepSubs(){const e=[];return this._getDeepSubs(e,this.getSubs()),e}_getDeepSubs(e,t){return t.forEach(s=>{e.push(s),s.isGroup&&this._getDeepSubs(e,s.subs)}),e}getSubElementsByType(e){return this.getSubs().filter(t=>t.isElement&&t.model.type===e)}getAllSubElements(){return this.getSubs().filter(e=>e.isElement)}getAllSubElementGroups(){return this.getSubs().filter(e=>e.isGroup)}clearSubs(){this.model.subIds=[]}isContainsCoord(e){return this.deepSubs.some(t=>t.isContainsCoord(e))}isPolygonOverlap(e){return this.deepSubs.some(t=>t.isPolygonOverlap(e))}isModelPolygonOverlap(e){return this.deepSubs.some(t=>t.isModelPolygonOverlap(e))}_setIsSelected(e){super._setIsSelected(e),this.deepSubs.forEach(t=>{t.isSelected=e})}calcRotateOutlineCoords(){return[this._rotateCoords]}}class Ci extends Fe{get editingEnable(){return!1}}class yi extends $e{async run(){if(!this.canvas||!this.element)return;const{innermostStrokeCoordIndex:e,unLeanStrokeCoords:t,model:{styles:s,styles:{strokes:r}},center:n,angle:o,flipX:a,leanY:c,actualAngle:h}=this.element,d={angle:o,flipX:a,leanY:c,actualAngle:h},g=S.batchCalcStageRelativePoints(t),f=g[e],C=b.getRect(f);s.fills.forEach(p=>{J.drawEllipseFillWithScale(this.canvas,n,{rx:C.width/2,ry:C.height/2},p,C,d)}),g.forEach((p,_)=>{const v=b.getRect(p);J.drawEllipseStrokeWithScale(this.canvas,n,{rx:v.width/2,ry:v.height/2},r[_],v,d)})}}class _i extends Fe{get editingEnable(){return!1}}class $t{static createImageFromImageData(e){const t=J.getCanvasByImageData(e),s=new Image;return s.src=t.toDataURL(),s}static waitForImageLoad(e){return new Promise((t,s)=>{e.onload=()=>{t(e)},e.onerror=()=>{s(new Error("Image load failed"))}})}static async createImageFromUrl(e){const t=new Image;return t.src=e,await this.waitForImageLoad(t),t}}var de=(i=>(i.isSelected="isSelected",i.isVisible="isVisible",i.isLocked="isLocked",i.isEditing="isEditing",i.isMoving="isMoving",i.isTransforming="isTransforming",i.isRotating="isRotating",i.isRotatingTarget="isRotatingTarget",i.isDragging="isDragging",i.isProvisional="isProvisional",i.isTarget="isTarget",i.isInRange="isInRange",i.isOnStage="isOnStage",i.status="status",i.isRatioLocked="isRatioLocked",i))(de||{}),xe=(i=>(i[i.added=0]="added",i[i.removed=1]="removed",i))(xe||{});class S{static createElementTask(e,t){let s;switch(e.model.type){case A.rectangle:s=new Ln(e,t);break;case A.image:{s=new fi(e,t);break}case A.line:{s=new gi(e,t);break}case A.ellipse:{s=new yi(e,t);break}case A.arbitrary:s=new mi(e,t)}return s}static calcStageRelativePoints(e){return e.map(t=>S.calcStageRelativePoint(t))}static batchCalcStageRelativePoints(e){return e.map(t=>S.calcStageRelativePoints(t))}static calcStageRelativePoint(e){const{rect:{width:t,height:s},scale:r,worldCoord:{x:n,y:o}}=window.shield.stageCalcParams;return{x:e.x+t/2/r-n,y:e.y+s/2/r-o}}static calcWorldCoords(e){return e.map(t=>S.calcWorldCoord(t))}static calcWorldCoord(e){const{rect:{width:t,height:s},scale:r,worldCoord:{x:n,y:o}}=window.shield.stageCalcParams;return{x:e.x-t/2/r+n,y:e.y-s/2/r+o}}static calcCreatorPoints(e,t){switch(t){case A.rectangle:case A.image:case A.arbitrary:case A.text:case A.ellipse:case A.group:return b.getBoxPoints(e);default:return e}}static createElement(e,t){const{type:s}=e;switch(s){case A.rectangle:return new or(e,t);case A.line:return new ui(e,t);case A.ellipse:return new _i(e,t);case A.image:return new ws(e,t);case A.arbitrary:return new pi(e,t);case A.text:return new Ci(e,t);case A.group:return new ns(e,t);case A.image:return new ws(e,t);default:return new Fe(e,t)}}static getTopAElementByCoord(e,t){for(let s=e.length-1;s>=0;s--){const r=e[s];if(r.isContainsCoord(t))return r}}static calcElementRotatePoint(e){const{centerCoord:t,rotation:{angle:s,scale:r},model:{height:n}}=e;return l.calcTargetPoint(t,n/2+Jn*r,s)}static calcPosition(e){switch(e.type){case A.rectangle:case A.image:case A.line:case A.ellipse:case A.arbitrary:case A.text:case A.group:return l.calcCenter(e.coords)}}static calcSize(e){const{coords:t,boxCoords:s,type:r}=e;switch(r){case A.rectangle:case A.text:case A.group:case A.image:case A.ellipse:case A.arbitrary:return b.calcRectangleSize(s);case A.line:return{width:l.precise(l.calcDistance(t[0],t[1]),2),height:0}}}static fixAngle(e){return e>180&&(e=e-360),e}static calcOutlinePoints(e,t,s,r){if(s&&t!==U.inside){let n=s/2;t===U.outside&&(n=s);const{flipX:o,flipY:a}=r;return o!==a?ve.getArbitraryInnerVertices(e,n,r):ve.getArbitraryOuterVertices(e,n,r)}return e}static calcNoFoldArbitraryBorderRegions(e,t){const{width:s}=t,r=[];return e.forEach((n,o)=>{if(o<e.length-1){const a=e[o+1];if(r.push(Ce.calcBentLineOuterVertices([n,a],s/2)),o!==0){const c=e[o-1];r.push(S.calc3PArbitraryBorderRegions(c,n,a,t))}}}),r}static calcFoldArbitraryBorderRegions(e,t){const{width:s}=t,r=[];return e.forEach((n,o)=>{const a=b.getPrevOfArray(e,o),c=b.getNextOfArray(e,o);r.push(Ce.calcBentLineOuterVertices([n,c],s/2)),r.push(S.calc3PArbitraryBorderRegions(a,n,c,t))}),r}static calcArbitraryBorderRegions(e,t,s){return s?S.calcFoldArbitraryBorderRegions(e,t):S.calcNoFoldArbitraryBorderRegions(e,t)}static calc3PArbitraryBorderRegions(e,t,s,r){const{width:n}=r,o=l.isPointClockwiseOfLine(s,e,t),c=(180-l.calcTriangleAngle(e,t,s))/2,h=l.calcAngle(e,t),d=l.calcTriangleSide3By2(c,n/2),g=l.calcTargetPoint(t,d,h+(o?-c:c)),f=[];return f.push(t),f.push(l.calcTargetPoint(t,n/2,h-90)),f.push(g),f.push(l.calcTargetPoint(t,n/2,l.calcAngle(s,t)+90)),f}static calcCoordsByTransPoints(e,t,s){const r=l.calcCenter(e.map(o=>l.transWithCenter(o,t,s,!0))),n=l.transWithCenter(r,t,s);return e.map(o=>l.rotateWithCenter(o,-t.angle,n))}static calcCoordsByRotatePoints(e,t,s){let r=l.calcCenter(e.map(o=>l.rotateWithCenter(o,-t,s)));const n=l.rotateWithCenter(r,t,s);return e.map(o=>l.rotateWithCenter(o,-t,n))}static normalizeMatrixPoint(e,t,s,r){e=l.transWithCenter(e,r,s,!0);const[n,o]=l.multiply(t,[e.x-s.x,e.y-s.y,1]);return{x:n+s.x,y:o+s.y}}static calcMatrixPoint(e,t,s,r){const n=S.normalizeMatrixPoint(e,t,s,r);return l.transWithCenter(n,r,s)}static calcMatrixPoints(e,t,s,r){return e.map(n=>S.calcMatrixPoint(n,t,s,r))}static isSameAncestorGroup(e){return e.length<=1?!0:S.getAncestorGroup(e)!==null}static getAncestorGroup(e){if(e.length===0)return null;const t=S.getNoParentElements(e);return t.length>1?null:t[0]}static getNoParentElements(e){return e.filter(t=>!t.isGroupSubject)}static createEmptyGroupObject(){return{...S.createEmptyObject(),type:A.group}}static createEmptyObject(){return{id:`${b.getDateId()}`,subIds:[],coords:[],boxCoords:[],width:0,height:0,styles:{strokes:[]},x:0,y:0,...es,...tt}}static fixCornersBasedOnMinSize(e,t){return P.range(4).forEach(s=>{e[s]!==0&&(e[s]=P.clamp(e[s],0,t/2))}),e}static convertElementsJson(e){const t=e,s=new Map,r=[],n=b.getDateId();return t.forEach((o,a)=>{s.set(o.id,o),r.push(n+a)}),t.forEach((o,a)=>{S.reBindGroup(o,s,`${r[a]}`),S.divateCoords(o,40)}),t}static reBindGroup(e,t,s){const{subIds:r,groupId:n,id:o}=e;if(e.id=s,t.set(s,e),t.delete(o),r&&r.forEach(a=>{const c=t.get(a);c&&(c.groupId=s)}),n){const a=t.get(n);if(a){const c=a.subIds.indexOf(o);if(c===-1)return;a.subIds.splice(c,1,s)}}}static divateCoords(e,t){const{coords:s,boxCoords:r}=e;return e.x+=t,e.y+=t,e.coords=l.batchTranslate(s,{x:t,y:t}),e.boxCoords=l.batchTranslate(r,{x:t,y:t}),e}static async convertElementModel(e){const{type:t,data:s}=e;switch(t){case A.image:e.data=await $t.createImageFromUrl(s)}return e}static calcStageRelativeArcPoint(e){let{start:t,end:s,controller:r,corner:n,value:o}=e;return[t,s,r,n]=S.calcStageRelativePoints([t,s,r,n]),{start:t,end:s,controller:r,corner:n,value:o}}static calcStageRelativeArcPoints(e){return e.map(t=>S.calcStageRelativeArcPoint(t))}static batchCalcStageRelativeArcPoints(e){return e.map(t=>S.calcStageRelativeArcPoints(t))}}var lt={exports:{}},bs;function Ei(){if(bs)return lt.exports;bs=1;var i=typeof Reflect=="object"?Reflect:null,e=i&&typeof i.apply=="function"?i.apply:function(y,x,I){return Function.prototype.apply.call(y,x,I)},t;i&&typeof i.ownKeys=="function"?t=i.ownKeys:Object.getOwnPropertySymbols?t=function(y){return Object.getOwnPropertyNames(y).concat(Object.getOwnPropertySymbols(y))}:t=function(y){return Object.getOwnPropertyNames(y)};function s(E){console&&console.warn&&console.warn(E)}var r=Number.isNaN||function(y){return y!==y};function n(){n.init.call(this)}lt.exports=n,lt.exports.once=V,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var o=10;function a(E){if(typeof E!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof E)}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(E){if(typeof E!="number"||E<0||r(E))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+E+".");o=E}}),n.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(y){if(typeof y!="number"||y<0||r(y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+y+".");return this._maxListeners=y,this};function c(E){return E._maxListeners===void 0?n.defaultMaxListeners:E._maxListeners}n.prototype.getMaxListeners=function(){return c(this)},n.prototype.emit=function(y){for(var x=[],I=1;I<arguments.length;I++)x.push(arguments[I]);var B=y==="error",j=this._events;if(j!==void 0)B=B&&j.error===void 0;else if(!B)return!1;if(B){var W;if(x.length>0&&(W=x[0]),W instanceof Error)throw W;var ne=new Error("Unhandled error."+(W?" ("+W.message+")":""));throw ne.context=W,ne}var Re=j[y];if(Re===void 0)return!1;if(typeof Re=="function")e(Re,this,x);else for(var us=Re.length,zr=p(Re,us),I=0;I<us;++I)e(zr[I],this,x);return!0};function h(E,y,x,I){var B,j,W;if(a(x),j=E._events,j===void 0?(j=E._events=Object.create(null),E._eventsCount=0):(j.newListener!==void 0&&(E.emit("newListener",y,x.listener?x.listener:x),j=E._events),W=j[y]),W===void 0)W=j[y]=x,++E._eventsCount;else if(typeof W=="function"?W=j[y]=I?[x,W]:[W,x]:I?W.unshift(x):W.push(x),B=c(E),B>0&&W.length>B&&!W.warned){W.warned=!0;var ne=new Error("Possible EventEmitter memory leak detected. "+W.length+" "+String(y)+" listeners added. Use emitter.setMaxListeners() to increase limit");ne.name="MaxListenersExceededWarning",ne.emitter=E,ne.type=y,ne.count=W.length,s(ne)}return E}n.prototype.addListener=function(y,x){return h(this,y,x,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(y,x){return h(this,y,x,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(E,y,x){var I={fired:!1,wrapFn:void 0,target:E,type:y,listener:x},B=d.bind(I);return B.listener=x,I.wrapFn=B,B}n.prototype.once=function(y,x){return a(x),this.on(y,g(this,y,x)),this},n.prototype.prependOnceListener=function(y,x){return a(x),this.prependListener(y,g(this,y,x)),this},n.prototype.removeListener=function(y,x){var I,B,j,W,ne;if(a(x),B=this._events,B===void 0)return this;if(I=B[y],I===void 0)return this;if(I===x||I.listener===x)--this._eventsCount===0?this._events=Object.create(null):(delete B[y],B.removeListener&&this.emit("removeListener",y,I.listener||x));else if(typeof I!="function"){for(j=-1,W=I.length-1;W>=0;W--)if(I[W]===x||I[W].listener===x){ne=I[W].listener,j=W;break}if(j<0)return this;j===0?I.shift():_(I,j),I.length===1&&(B[y]=I[0]),B.removeListener!==void 0&&this.emit("removeListener",y,ne||x)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(y){var x,I,B;if(I=this._events,I===void 0)return this;if(I.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):I[y]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete I[y]),this;if(arguments.length===0){var j=Object.keys(I),W;for(B=0;B<j.length;++B)W=j[B],W!=="removeListener"&&this.removeAllListeners(W);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(x=I[y],typeof x=="function")this.removeListener(y,x);else if(x!==void 0)for(B=x.length-1;B>=0;B--)this.removeListener(y,x[B]);return this};function f(E,y,x){var I=E._events;if(I===void 0)return[];var B=I[y];return B===void 0?[]:typeof B=="function"?x?[B.listener||B]:[B]:x?v(B):p(B,B.length)}n.prototype.listeners=function(y){return f(this,y,!0)},n.prototype.rawListeners=function(y){return f(this,y,!1)},n.listenerCount=function(E,y){return typeof E.listenerCount=="function"?E.listenerCount(y):C.call(E,y)},n.prototype.listenerCount=C;function C(E){var y=this._events;if(y!==void 0){var x=y[E];if(typeof x=="function")return 1;if(x!==void 0)return x.length}return 0}n.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function p(E,y){for(var x=new Array(y),I=0;I<y;++I)x[I]=E[I];return x}function _(E,y){for(;y+1<E.length;y++)E[y]=E[y+1];E.pop()}function v(E){for(var y=new Array(E.length),x=0;x<y.length;++x)y[x]=E[x].listener||E[x];return y}function V(E,y){return new Promise(function(x,I){function B(W){E.removeListener(y,j),I(W)}function j(){typeof E.removeListener=="function"&&E.removeListener("error",B),x([].slice.call(arguments))}Y(E,y,j,{once:!0}),y!=="error"&&M(E,B,{once:!0})})}function M(E,y,x){typeof E.on=="function"&&Y(E,"error",y,x)}function Y(E,y,x,I){if(typeof E.on=="function")I.once?E.once(y,x):E.on(y,x);else if(typeof E.addEventListener=="function")E.addEventListener(y,function B(j){I.once&&E.removeEventListener(y,B),x(j)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof E)}return lt.exports}var is=Ei();class vi extends is.EventEmitter{constructor(t){super();u(this,"nodes");u(this,"_head");u(this,"_tail");u(this,"_eqFunc",(t,s)=>t===s);this.nodes=new Set,this._head=null,this._tail=null,this._eqFunc=t}get head(){return this._head}get tail(){return this._tail}get length(){return this.nodes.size}insert(t){this._tail?this.insertAfter(t,this._tail):(this._tail=t,this.nodes.add(t)),this._head||(this._head=t)}prepend(t){this._head?this.insertBefore(t,this._head):(this._head=t,this.nodes.add(t)),this._tail||(this._tail=t)}remove(t,s){this.nodes.delete(t);const r=t.prev,n=t.next;r&&(r.next=n),n&&(n.prev=r),t.prev=null,t.next=null,this._eqFunc(t,this._tail)&&(this._tail=r),this._eqFunc(t,this._head)&&(this._head=n)}removeBy(t,s){let r=[];return Array.from(this.nodes).forEach(n=>{t(n)&&(this.remove(n,s),r.push(n))}),r}insertBefore(t,s){s&&(s.insertBefore(t),this.nodes.add(t),t.isHead&&(this._head=t))}insertAfter(t,s){s&&(s.insertAfter(t),this.nodes.add(t),t.isTail&&(this._tail=t))}forEach(t){this.forEachBreak(t,()=>!1)}forEachBreak(t,s){let r=0,n=this._head;for(;n;){if(s&&s(n,r))return;t(n,r),n=n.next,r++}}forEachRevert(t){this.forEachBreakRevert(t,()=>!1)}forEachBreakRevert(t,s){let r=this.length-1,n=this._tail;for(;n;){if(s&&s(n,r))return;t(n,r),n=n.prev,r--}}getIndex(t){let s=-1,r=this._head;for(;r;){if(s++,this._eqFunc(r,t))return s;r=r.next}return s}filter(t){const s=[];return this.forEach(r=>{t(r)&&s.push(r)}),s}}const Ss=(i,e)=>i.value&&e.value&&i.value.id===e.value.id;class Ft extends vi{constructor(){super(Ss)}_addElementObserve(e){Object.keys(de).forEach(t=>{be(()=>e.value[t],()=>{this.emit(t,e.value,e.value[t])})})}insert(e,t=!0){De(()=>{this._addElementObserve(e),super.insert(e),t&&this.emit(xe.added,e)})}insertBefore(e,t,s=!0){De(()=>{this._addElementObserve(e),super.insertBefore(e,t),s&&this.emit(xe.added,e)})}insertAfter(e,t,s=!0){De(()=>{this._addElementObserve(e),super.insertAfter(e,t),s&&this.emit(xe.added,e)})}prepend(e,t=!0){De(()=>{this._addElementObserve(e),super.prepend(e),t&&this.emit(xe.added,e)})}remove(e,t=!0){De(()=>{super.remove(e),t&&this.emit(xe.removed,e)})}removeBy(e,t=!0){let s=[];return De(()=>{s=super.removeBy(e,t)}),s}static isConsecutive(e){if(e.length<2)return!0;let t=e[0],s=1;for(;t.next&&Ss(t.next,e[s]);)if(t=t.next,s++,s===e.length)break;return s===e.length}}class wi{constructor(e){u(this,"shield");u(this,"_elementList",new Ft);u(this,"_currentCreatingElementId");u(this,"_elementsMap",new Map);u(this,"_provisionalElements",[]);u(this,"_selectedElements",[]);u(this,"_targetElements",[]);u(this,"_rangeElements",[]);u(this,"_visibleElements",[]);u(this,"_stageElements",[]);u(this,"_editingElements",[]);u(this,"_rotatingTargetElements",[]);u(this,"_provisionalElementIds",X.set(new Set));u(this,"_selectedElementIds",X.set(new Set));u(this,"_targetElementIds",X.set(new Set));u(this,"_visibleElementIds",X.set(new Set));u(this,"_rangeElementIds",X.set(new Set));u(this,"_stageElementIds",X.set(new Set));u(this,"_editingElementIds",X.set(new Set));u(this,"_rotatingTargetElementIds",X.set(new Set));u(this,"_rotatingCenter");u(this,"_rotatingCenterCoord");u(this,"_rotatingOriginalAngle");u(this,"_isMultiSelected",!1);u(this,"_noParentElements",[]);u(this,"_selectedAncestorElement");u(this,"_primarySelectedElement");this.shield=e,this._reactionElementAdded(),this._reactionElementRemoved(),this._reactionElementsPropsChanged(),this._reactionElementsSelectionChanged()}get selectedElementIds(){return this._selectedElementIds}get creatingElements(){const e=this._elementsMap.get(this._currentCreatingElementId);return e?[e]:[]}get isProvisionalEmpty(){return this._provisionalElementIds.size===0}get provisionalElements(){return this._provisionalElements}get selectedElements(){return this._selectedElements}get targetElements(){return this._targetElements}get stageElements(){return this._stageElements}get rangeElements(){return this._rangeElements}get visibleElements(){return this._visibleElements}get selectedAncestorElement(){return this._selectedAncestorElement}get primarySelectedElement(){return this._primarySelectedElement}get rotatingTargetElements(){return this._rotatingTargetElements}get editingElements(){return this._editingElements}get isSelectedEmpty(){return this._selectedElementIds.size===0}get isVisibleEmpty(){return this._visibleElementIds.size===0}get isEmpty(){return this._elementList.length===0}get isEditingEmpty(){return this._editingElementIds.size===0}get isTargetEmpty(){return this._targetElementIds.size===0}get isRangeEmpty(){return this._rangeElementIds.size===0}get isStageEmpty(){return this._stageElementIds.size===0}get isRotatingTargetEmpty(){return this._rotatingTargetElementIds.size===0}get noParentElements(){return this._noParentElements}get isMultiSelected(){return this._isMultiSelected}_reactionElementAdded(){this._elementList.on(xe.added,e=>{const t=e.value;Object.keys(de).forEach(s=>{this._reactionElementPropsChanged(de[s],t,t[s])})})}_reactionElementRemoved(){this._elementList.on(xe.removed,e=>{const{id:t}=e.value;this._elementsMap.delete(t),this._selectedElementIds.delete(t),this._targetElementIds.delete(t),this._provisionalElementIds.delete(t),this._rotatingTargetElementIds.delete(t),this._editingElementIds.delete(t),this._rangeElementIds.delete(t),this._visibleElementIds.delete(t),this._stageElementIds.delete(t)})}_reactionElementsPropsChanged(){Object.keys(de).forEach(e=>{this._elementList.on(e,(t,s)=>{this._reactionElementPropsChanged(e,t,s)})})}_reactionElementsSelectionChanged(){be(()=>Array.from(this._selectedElementIds),()=>{this._reactionSelectedElementsChanged(),this.shield.selection.refresh()}),be(()=>Array.from(this._targetElementIds),()=>this._reactionTargetElementsChanged()),be(()=>Array.from(this._provisionalElementIds),()=>this._reactionProvisionalElementsChanged()),be(()=>Array.from(this._rotatingTargetElementIds),()=>this._reactionRotatingTargetElementsChanged()),be(()=>Array.from(this._editingElementIds),()=>this._reactionEditingElementsChanged()),be(()=>Array.from(this._rangeElementIds),()=>this._reactRangeElementsChanged()),be(()=>Array.from(this._visibleElementIds),()=>this._reactionVisibleElementsChanged()),be(()=>Array.from(this._stageElementIds),()=>this._reactionStageElementsChanged())}_reactionSelectedElementsChanged(){this._selectedElements=this._filterList(this._selectedElementIds),this._noParentElements=S.getNoParentElements(this._selectedElements),this._isMultiSelected=this._noParentElements.length>1,this._selectedAncestorElement=S.getAncestorGroup(this._selectedElements),this._primarySelectedElement=this._selectedAncestorElement&&!this._selectedAncestorElement.isProvisional?this._selectedAncestorElement:null,this.shield.emit(k.selectedChanged,this._selectedElements),this.shield.emit(k.multiSelectedChanged,this._isMultiSelected),this.shield.emit(k.primarySelectedChanged,this._primarySelectedElement),this.emitElementsLayerChanged()}emitElementsLayerChanged(){this._selectedElements.length?Ft.isConsecutive(this._selectedElements.map(e=>e.node))?(this.shield.emit(k.layerShiftMoveEnableChanged,!this._selectedElements[this._selectedElements.length-1].isTopmost),this.shield.emit(k.layerGoDownEnableChanged,!this._selectedElements[0].isBottommost)):(this.shield.emit(k.layerShiftMoveEnableChanged,!0),this.shield.emit(k.layerGoDownEnableChanged,!0)):(this.shield.emit(k.layerShiftMoveEnableChanged,!1),this.shield.emit(k.layerGoDownEnableChanged,!1))}_reactionTargetElementsChanged(){this._targetElements=this._filterList(this._targetElementIds),this.shield.emit(k.targetChanged,this._targetElements)}_reactionStageElementsChanged(){this._stageElements=this._filterList(this._stageElementIds)}_reactionVisibleElementsChanged(){this._visibleElements=this._filterList(this._visibleElementIds)}_reactRangeElementsChanged(){this._rangeElements=this._filterList(this._rangeElementIds)}_reactionEditingElementsChanged(){this._editingElements=this._filterList(this._editingElementIds)}_reactionRotatingTargetElementsChanged(){this._rotatingTargetElements=this._filterList(this._rotatingTargetElementIds)}_reactionProvisionalElementsChanged(){this._provisionalElements=this._filterList(this._provisionalElementIds)}resortElementsArray(){this._reactionStageElementsChanged(),this._reactionVisibleElementsChanged(),this._reactionSelectedElementsChanged()}_filterList(e){return this._elementList.filter(t=>e.has(t.value.id)).map(t=>t.value)}_setAddDelete(e,t,s){s?e.add(t):e.delete(t)}_reactionElementPropsChanged(e,t,s){switch(e){case de.isSelected:{this._setAddDelete(this._selectedElementIds,t.id,s);break}case de.isProvisional:{this._setAddDelete(this._provisionalElementIds,t.id,s);break}case de.isTarget:{this._setAddDelete(this._targetElementIds,t.id,s);break}case de.isRotatingTarget:{this._setAddDelete(this._rotatingTargetElementIds,t.id,s);break}case de.isEditing:{this._setAddDelete(this._editingElementIds,t.id,s);break}case de.isInRange:{this._setAddDelete(this._rangeElementIds,t.id,s);break}case de.isVisible:{this._setAddDelete(this._visibleElementIds,t.id,s);break}case de.isOnStage:{this._setAddDelete(this._stageElementIds,t.id,s);break}}}filterEmit(e,t,...s){var r;t&&(t.id===((r=this.primarySelectedElement)==null?void 0:r.id)||t.id===this._currentCreatingElementId)&&this.shield.emit(e,t,...s)}async setElementsPosition(e,t){e.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){const{x:r,y:n}=s.model,{x:o,y:a}=t;if(r===o&&n===a)return;const c={x:o-r,y:a-n};s.setPosition(o,a,c),s.isGroup&&s.deepSubs.forEach(h=>{h.setPosition(h.model.x+c.x,h.model.y+c.y,c)})}})}async setElementsWidth(e,t){e.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){if(s.width===t)return;const r=s.setWidth(t);s.isGroup&&this.scaleSubs(s,r)}})}async setElementsHeight(e,t){e.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){if(s.height===t)return;const r=s.setHeight(t);s.isGroup&&this.scaleSubs(s,r)}})}scaleSubs(e,t){const{centerCoord:s,angle:r,leanYAngle:n}=e,{scaleX:o,scaleY:a}=l.getScaleFromMatrix(t);e.deepSubs.forEach(c=>{c.scaleBy(s,o,a,{angle:r,leanYAngle:n})})}async setElementsAngle(e,t){e.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){if(s.angle===t)return;this.rotateElements([s],t,s.angle,s.centerCoord)}})}async setElementsCorners(e,t,s){e.forEach(r=>{if(this.hasElement(r.id)&&!r.isGroupSubject){if(P.isEqual(r.corners,[t,t,t,t]))return;r.setCorners(t,s)}})}async setElementsLeanYAngle(e,t){e.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){if(s.leanYAngle===t)return;const r=s.leanYAngle;if(t=l.precise(t,1),s.setLeanYAngle(t),s.isGroup){const n=s.centerCoord;s.deepSubs.forEach(o=>{o.leanYBy(t,r,s.angle,n)})}}})}async setElementsStrokeType(e,t,s){e.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.strokes[s].type===t)return;r.setStrokeType(t,s)}})}async setElementsStrokeWidth(e,t,s){e.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.strokes[s].width===t)return;r.setStrokeWidth(t,s)}})}async setElementsStrokeColor(e,t,s){e.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.strokes[s].color===t)return;r.setStrokeColor(t,s)}})}async setElementsStrokeColorOpacity(e,t,s){e.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.strokes[s].colorOpacity===t)return;r.setStrokeColorOpacity(t,s)}})}async addElementsStroke(e,t){e.forEach(s=>{this.hasElement(s.id)&&s.addStroke(t)})}async removeElementsStroke(e,t){e.forEach(s=>{this.hasElement(s.id)&&s.removeStroke(t)})}async setElementsFillColor(e,t,s){e.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.fills[s].color===t)return;r.setFillColor(t,s)}})}async setElementsFillColorOpacity(e,t,s){e.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.fills[s].colorOpacity===t)return;r.setFillColorOpacity(t,s)}})}async addElementsFill(e,t){e.forEach(s=>{this.hasElement(s.id)&&s.addFill(t)})}async removeElementsFill(e,t){e.forEach(s=>{this.hasElement(s.id)&&s.removeFill(t)})}async setElementsTextAlign(e,t){e.forEach(s=>{if(this.hasElement(s.id)){if(s.textAlign===t)return;s.setTextAlign(t)}})}async setElementsTextBaseline(e,t){e.forEach(s=>{if(this.hasElement(s.id)){if(s.textBaseline===t)return;s.setTextBaseline(t)}})}async setElementsFontSize(e,t){e.forEach(s=>{if(this.hasElement(s.id)){if(s.fontSize===t)return;s.setFontSize(t)}})}async setElementsFontFamily(e,t){e.forEach(s=>{if(this.hasElement(s.id)){if(s.fontFamily===t)return;s.setFontFamily(t)}})}async setElementsRatioLocked(e,t){e.forEach(s=>{if(this.hasElement(s.id)){if(s.isRatioLocked===t)return;s.setRatioLocked(t)}})}hasElement(e){return this._elementsMap.has(e)}getElementById(e){return this._elementsMap.get(e)}getElementsByIds(e){return e.map(t=>this.getElementById(t)).filter(t=>t!==void 0)}getIndexById(e){return this.hasElement(e)&&this._elementList.forEachBreak((t,s)=>{if(t.value.id===e)return s},t=>{if(t.value.id===e)return!0}),-1}addElement(e,t,s){const r=new ps(e);return e.node=r,t?this._elementList.insertAfter(r,t.node):s?this._elementList.prepend(r):this._elementList.insert(r),this._elementsMap.set(e.id,e),e}beforeAddElement(e,t,s){const r=new ps(e);return e.node=r,t?this._elementList.insertBefore(r,t.node):s?this._elementList.insert(r):this._elementList.prepend(r),this._elementsMap.set(e.id,e),e}_createElementByModel(e){const t=S.createElement(e,this.shield);return Object.assign(t,{status:Z.finished,isOnStage:!0,isSelected:!0}),t}afterAddElementByModel(e,t,s){const r=this._createElementByModel(e);return this.addElement(r,t,s),r.refresh(),r}beforeAddElementByModel(e,t,s){const r=this._createElementByModel(e);return this.beforeAddElement(r,t,s),r.refresh(),r}removeElement(e){if(this.hasElement(e)){let t=this._elementsMap.get(e);return this._elementList.removeBy(s=>s.value.id===e),this._elementsMap.delete(e),t=null,t}}updateElementById(e,t){if(this.hasElement(e)){const s=this._elementsMap.get(e);return Object.assign(s,t),s}}updateElements(e,t){return e.forEach(s=>this.updateElementById(s.id,t)),e}updateElementModel(e,t){if(this.hasElement(e)){const s=this._elementsMap.get(e),r=s.model.id;return z.deepPlanObjectAssign(s.model,t,{id:r}),s}}updateElementsModel(e,t){e.forEach(s=>{this.updateElementModel(s.id,t)})}createElementModel(e,t,s){const r=S.calcSize({coords:t,boxCoords:b.getBoxPoints(t),type:e}),n=S.calcPosition({type:e,coords:t});return{...S.createEmptyObject(),type:e,coords:t,boxCoords:b.getBoxPoints(t),data:s,width:r.width,height:r.height,name:`${ir.getCreatorByType(e).name} ${+new Date}`,styles:ys(e),isRatioLocked:!1,...n,...es,...tt}}_setElementProvisionalCreating(e){this.updateElementById(e.id,{status:Z.creating,isOnStage:!1,isProvisional:!0,isSelected:!0})}_createProvisionalElement(e){const t=S.createElement(e,this.shield);return this._currentCreatingElementId=t.id,this.updateElementById(t.id,{status:Z.startCreating}),this.addElement(t),t}creatingElement(e){let t;const{category:s,type:r}=this.shield.currentCreator;switch(s){case re.shapes:{const n=this.createElementModel(r,S.calcCreatorPoints(e,r));this._currentCreatingElementId?(delete n.id,t=this.updateElementModel(this._currentCreatingElementId,n),t.model.boxCoords=b.getBoxPoints(t.model.coords),this._setElementProvisionalCreating(t)):t=this._createProvisionalElement(n)}}return this.selectElement(t),t.refresh(),t}creatingArbitraryElement(e,t){let s,r;return this._currentCreatingElementId?(s=this.getElementById(this._currentCreatingElementId),r=s.model,t?l.isPointClosest(e,r.coords[0],yn/this.shield.stageScale)?s.tailCoordIndex>0&&(r.isFold=!0):(r.coords.splice(r.coords.length-1,1,e),s.tailCoordIndex=r.coords.length-1):s.tailCoordIndex+1===r.coords.length?r.coords.push(e):r.coords.splice(s.tailCoordIndex+1,1,e),s.model.boxCoords=b.getBoxPoints(s.model.coords),this._setElementProvisionalCreating(s)):(r=this.createElementModel(A.arbitrary,[e]),r.isFold=!1,s=this._createProvisionalElement(r),s.tailCoordIndex=0),this.selectElement(s),s.refresh({size:!0,points:!0,position:!0}),s}_finishArbitraryElement(e){const t=e.tailCoordIndex;e.tailCoordIndex=-1,t<e.model.coords.length-1&&(e.model.coords=e.model.coords.slice(0,t+1))}finishCreatingElement(){if(this._currentCreatingElementId){let e=this.getElementById(this._currentCreatingElementId);if(e){this._currentCreatingElementId=null;const{model:{type:t}}=e;switch(t){case A.arbitrary:{this._finishArbitraryElement(e);break}}return this.updateElementById(e.id,{status:Z.finished}),e.model.boxCoords=b.getBoxPoints(e.model.coords),e.refresh(),e}}}findElements(e){const t=[];return this._elementList.forEach(s=>{e(s.value)&&t.push(s.value)}),t}updateElementsTransform(e,t){e.forEach(s=>{s.transform(t),s.isGroup&&!s.isGroupSubject&&s.deepSubs.forEach(r=>{const{transformLockCoord:n,transformLockIndex:o,originalTransformMoveCoord:a,transformType:c,model:{angle:h,leanYAngle:d}}=s;r.transformBy({lockCoord:n,lockIndex:o,originalMovingCoord:a,offset:t,groupAngle:h,groupLeanYAngle:d,transformType:c})})})}updateElementsCorner(e,t){e.forEach(s=>{s.updateCornerByOffset(t)})}updateElementsTranslate(e,t){e.forEach(s=>{s.translateBy(t),!s.isOnStage&&this._updateElementStageStatusIfy(s)})}forEach(e){this._elementList.forEach((t,s)=>{e(t.value,s)})}refreshElementsOriginals(e,t){this._refreshElementsByFunc(e,s=>s.refreshOriginalProps(),t)}refreshElementsOriginalAngles(e,t){this._refreshElementsByFunc(e,s=>s.refreshOriginalAngle(),t)}_refreshElementsByFunc(e,t,s){s=Object.assign({},Mn,s||{});let r=new Set;function n(o){r.has(o.id)||(r.add(o.id),t(o))}e.forEach(o=>{n(o),o.isGroup&&(s.deepSubs?o.deepSubs.forEach(n):s.subs&&o.subs.forEach(n))}),r.clear(),r=null}_updateElementStageStatusIfy(e){const t=e.isModelPolygonOverlap(this.shield.stageWordRectCoords);this.updateElementById(e.id,{isOnStage:t})}refreshStageElements(){this._elementList.forEach(({value:e})=>{this._updateElementStageStatusIfy(e),e.refresh({points:!0,rotation:!0,originals:!0,outline:!0,strokes:!0})})}refreshElements(e){e.forEach(t=>{t.refresh()})}isSelectedContainsTarget(){return this.isTargetEmpty?!1:P.every(Array.from(this._targetElementIds),e=>this._selectedElementIds.has(e))}refreshRotatingStates(e){this.refreshElementsRotationStates(this.rotatingTargetElements,e)}refreshElementsRotationStates(e,t){const{center:s,centerCoord:r,angle:n}=this.calcRotatingStatesByElements(t,e);this._rotatingCenter=s,this._rotatingCenterCoord=r,this._rotatingOriginalAngle=n}calcRotatingStatesByElements(e,t){const s=l.calcCenter(t.map(o=>o.centerCoord).flat()),r=S.calcStageRelativePoint(s),n=l.precise(l.calcAngle(r,e));return{center:r,centerCoord:s,angle:n}}clearRotatingStates(){this._rotatingCenter=null,this._rotatingCenterCoord=null,this._rotatingOriginalAngle=null}updateElementsRotation(e,t){const s=l.precise(l.calcAngle(this._rotatingCenter,t));this.rotateElements(e,s,this._rotatingOriginalAngle,this._rotatingCenterCoord)}rotateElements(e,t,s,r){e.forEach(n=>{n.model.type!==A.line&&(t=l.mirrorAngle(n.originalAngle+t-s),t=l.precise(t,1)),n.setAngle(t),!n.isOnStage&&this._updateElementStageStatusIfy(n),n.isGroup&&n.deepSubs.forEach(o=>{o.rotateBy(t-n.originalAngle,r),!o.isOnStage&&this._updateElementStageStatusIfy(o)})})}async createImageElementModel(e,t){const{colorSpace:s}=t,{width:r,height:n}=e,o=b.get4BoxPoints(this.shield.stageWorldCoord,{width:r,height:n}),a=l.calcCenter(o);return{...S.createEmptyObject(),coords:o,boxCoords:b.getBoxPoints(o),type:A.image,data:e,name:"image",width:r,height:n,length:0,styles:ys(A.image),colorSpace:s,naturalWidth:r,naturalHeight:n,isRatioLocked:!0,...a,...tt}}async insertImageElement(e){let t;e instanceof ImageData&&(t=e.colorSpace,e=$t.createImageFromImageData(e),await $t.waitForImageLoad(e));const s=await this.createImageElementModel(e,{colorSpace:t});return this.afterAddElementByModel(s)}deleteSelects(){this.selectedElements.forEach(e=>{this.removeElement(e.id)})}selectElement(e){this.updateElementById(e.id,{isSelected:!0})}deSelectElement(e){this.updateElementById(e.id,{isSelected:!1})}selectElements(e){e.forEach(t=>{this.selectElement(t)})}deSelectElements(e){e.forEach(t=>{this.deSelectElement(t)})}toggleSelectElement(e){e.isSelected?this.deSelectElement(e):this.selectElement(e)}toggleSelectElements(e){e.forEach(t=>{this.toggleSelectElement(t)})}selectAll(){this._elementList.forEach(e=>{this.selectElement(e.value)})}deSelectAll(){this._elementList.forEach(e=>{this.deSelectElement(e.value)})}cancelTargetElements(){this.targetElements.forEach(e=>{this.updateElementById(e.id,{isTarget:!1})})}beginEditingElements(e){this._setElementsEditing(e,!0)}endEditingElements(e){this._setElementsEditing(e,!1)}getFinishedSelectedElements(e){return this.selectedElements.filter(t=>t.status===Z.finished&&(e?!t.isGroupSubject:!0))}getSelectedElements(e){return this.selectedElements.filter(t=>e?!t.isGroupSubject:!0)}_setElementsEditing(e,t){e.forEach(s=>{s.editingEnable&&(this.updateElementById(s.id,{isEditing:t,status:t?Z.editing:Z.finished}),s.tfRefreshAfterEdChanged&&(s.refreshTransformers(),s.refreshOriginalTransformerCoords()))})}isSelectedEqCreating(){const e=new Set(this.selectedElements.map(s=>s.id)),t=new Set(this.creatingElements.map(s=>s.id));return P.isEqual(e,t)}_bindElementsGroup(e){e.subs.forEach(t=>{this.updateElementModel(t.id,{groupId:e.id})})}_unbindElementsGroup(e){this.updateElementsModel(e.getSubs(),{groupId:void 0}),this.updateElementModel(e.id,{subIds:[]})}_createElementGroupObject(e){e=e.filter(c=>!c.isGroupSubject);const t=e.map(c=>c.id),s=b.getBoxPoints(e.map(c=>c.rotateCoords).flat()),{width:r,height:n,x:o,y:a}=b.getRect(s);return{...S.createEmptyGroupObject(),subIds:t,coords:s,boxCoords:b.getBoxPoints(s),width:r,height:n,x:o+r/2,y:a+n/2}}_sortElementsByLevel(e){return e.sort((t,s)=>this.getIndexById(t.id)-this.getIndexById(s.id))}_rearrangeForwardElementNodes(e){let t=e;if(!Ft.isConsecutive(e.map(s=>s.node))){t=this._sortElementsByLevel(e);const s=t[t.length-1];this._removeNodesByElements(t.slice(0,t.length-1));for(let r=0;r<=t.length-2;r++)this._elementList.insertBefore(t[r].node,s.node,!1)}return t}createElementGroup(e){const t=this._rearrangeForwardElementNodes(e),s=new ns(this._createElementGroupObject(t),this.shield);return this._bindElementsGroup(s),this.addElement(s,t[t.length-1]),this.updateElementById(s.id,{status:Z.finished,isOnStage:!0}),s.refresh(),s}removeElementGroup(e){this.hasElementGroup(e.id)&&(this._unbindElementsGroup(e),this.deSelectGroup(e),this.removeElement(e.id))}hasElementGroup(e){return this.hasElement(e)}selectToGroup(){const e=this.selectedElements;return e.length<2||S.isSameAncestorGroup(e)?null:this.createElementGroup(e)}cancelGroups(e){e.forEach(t=>{this.removeElementGroup(t)})}getSelectedElementGroups(){return this.selectedElements.filter(e=>e.model.type===A.group)}getSelectedAncestorElementGroups(){return S.getNoParentElements(this.getSelectedElementGroups())}selectGroup(e){this.updateElementById(e.id,{isSelected:!0})}deSelectGroup(e){this.updateElementById(e.id,{isSelected:!1})}deSelectGroups(e){e.forEach(t=>{this.deSelectGroup(t)})}async copySelectElements(){return Promise.all(this.selectedElements.map(async e=>await e.toJson()))}async pasteElements(e){const t=[],s=S.convertElementsJson(e);for(const r of s){await S.convertElementModel(r);const n=this.afterAddElementByModel(r);t.push(n)}return t}rearrangeElementAfter(e,t,s){const{node:r}=e;this._elementList.remove(r,!1),t?this._elementList.insertAfter(r,t.node,!1):s?this._elementList.prepend(r,!1):this._elementList.insert(r,!1)}rearrangeElementBefore(e,t,s){const{node:r}=e;this._elementList.remove(r,!1),t?this._elementList.insertBefore(r,t.node,!1):s?this._elementList.insert(r,!1):this._elementList.prepend(r,!1)}_removeNodesByElements(e){const t=[];return e.forEach(s=>{const[r]=this._elementList.removeBy(n=>n.value.id===s.id,!1);t.push(r)}),t}_getPrevmostElement(e){let t=e.subs[0];return t&&t.isGroup&&(t=this._getPrevmostElement(t)),t}_doElementsGoDown(e){let s=e[0].node.prev;s!=null&&s.value.isGroup&&(s=this._getPrevmostElement(s.value).node);const r=this._removeNodesByElements(e);s?r.forEach(n=>{this._elementList.insertBefore(n,s,!1)}):r.reverse().forEach(n=>{this._elementList.prepend(n,!1)})}async setElementsGoDown(e){e.length!==0&&(this._doElementsGoDown(e),this.resortElementsArray(),this.emitElementsLayerChanged())}_doElementsShiftMove(e){let s=e[e.length-1].node.next;s!=null&&s.value.isGroupSubject&&(s=s.value.ancestorGroup.node);const r=this._removeNodesByElements(e);s?r.forEach(n=>{this._elementList.insertAfter(n,s,!1),s=n}):r.forEach(n=>{this._elementList.insert(n,!1)})}async setElementsShiftMove(e){e.length!==0&&(this._doElementsShiftMove(e),this.resortElementsArray(),this.emitElementsLayerChanged())}}class os extends bt{constructor(t){super();u(this,"tasks");u(this,"running");this.tasks=t}isEmpty(){return this.tasks.length===0}add(t){this.running||t&&this.tasks.push(t)}addAll(t){t.forEach(s=>{this.add(s)})}prepend(t){this.running||t&&this.tasks.unshift(t)}async run(){for(this.running=!0;this.tasks.length>0;){let t=this.tasks.shift();if(t)try{await t.run()}catch(s){console.error("RenderTaskCargo: error running task",t.id,s)}finally{t.destroy&&await t.destroy(),t=null}}this.running=!1}}class Pe extends bt{constructor(t,s){super();u(this,"model");u(this,"canvas");this.model=t,s&&(this.canvas=s.canvas)}destroy(){return this.model=null,this.id=null,this.canvas=null,Promise.resolve()}}class bi extends Pe{async run(){var r,n;if(!this.canvas||!this.model)return;const{width:e}=Lt.strokes[0],t={};let{points:s}=this.model;s=S.calcStageRelativePoints(s),[le.selection,le.path].includes(this.model.type)&&(t.fills=[{colorOpacity:0}]),J.drawPathWithScale(this.canvas,s,Object.assign({},{...Lt,...t}),{},{...Lt.strokes[0],width:e*this.model.scale},{isFold:typeof((r=this.model.element)==null?void 0:r.isFold)>"u"?!0:(n=this.model.element)==null?void 0:n.isFold})}}class xs extends Pe{async run(){var e;this.canvas&&((e=this.canvas.getContext("2d"))==null||e.clearRect(0,0,this.canvas.width,this.canvas.height))}}class Si extends Pe{async run(){if(!this.canvas||!this.model)return;const{width:e}=We.strokes[0];let{scale:t,point:s,leanYAngle:r,actualAngle:n}=this.model;s=S.calcStageRelativePoint(s),J.drawPathWithScale(this.canvas,b.get4BoxPoints(s,{width:gt*t,height:gt*t},{angle:n,leanYAngle:r}),We,We.fills[0],{...We.strokes[0],width:e*t},{calcVertices:!1})}}class ar{static wait(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}}class pt{constructor(){u(this,"running");u(this,"queue");u(this,"stopped");this.running=!1,this.queue=[],this.stopped=!1}async add(e){this.stopped||(this.queue.push(e),this.running||(this.running=!0,await this.run()))}async run(){if(this.stopped)return;if(this.queue.length===0){this.running=!1;return}let e=this.queue.shift();if(e)try{await e.run()}catch(t){console.error("RenderQueue: error running task",e.id,t)}finally{e.destroy&&await e.destroy(),e=null}this.queue.length>0?requestAnimationFrame(()=>{this.run()}):this.running=!1}async wait(){for(;this.running;)await ar.wait(10)}async destroy(){await this.wait(),this.stopped=!0,this.queue=null,this.running=!1}}class xi extends pt{}class as{constructor(e){u(this,"drawer");u(this,"renderQueue");this.drawer=e,this.renderQueue=new pt}async renderCargo(e){await this.renderQueue.add(e)}get renderParams(){return{canvas:this.drawer.canvas}}clear(){throw new Error("Method not implemented.")}async redraw(e){throw new Error("Method not implemented.")}}const Ai="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1735111770421'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1464'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M510.9%2064.7c-108.7%200-214%2040.4-295%20111.8L107.3%2068v299.4h299.4L295.4%20256.1c60.3-51.3%20134.9-80.6%20215.5-80.6%20184.8%200%20335.2%20150.3%20335.2%20335.2S695.7%20845.8%20510.9%20845.8%20175.7%20695.4%20175.7%20510.6H64.9c0%20245.8%20200.1%20445.9%20445.9%20445.9s445.9-200.1%20445.9-445.9-200-445.9-445.8-445.9z'%20fill='%231296db'%20p-id='1465'%3e%3c/path%3e%3c/svg%3e";class Pi extends Pe{get svg(){return Ai}async run(){if(!this.canvas||!this.model)return;let{point:e,width:t,height:s,scale:r}=this.model;e=S.calcStageRelativePoint(e),await J.drawImgLike(this.canvas,this.svg,{x:(e.x-t*r/2)/r,y:(e.y-s*r/2)/r,width:t,height:s},{angle:this.model.angle})}}class Ri extends Pe{async run(){if(!this.canvas||!this.model)return;let{text:e,point:t}=this.model;t=S.calcStageRelativePoint(t),J.drawRotateTextWithScale(this.canvas,e,t,Gt,Gt.fills[0],{angle:this.model.angle})}}class Ti extends Pe{async run(){if(!this.canvas||!this.model)return;let{text:e,point:t}=this.model;await J.drawRotateTextWithScale(this.canvas,e,t,Es,Es.fills[0])}}class Dt extends Pe{async run(){if(!this.canvas||!this.model)return;let{point:e}=this.model;if(!e)return;let{radius:t}=this.model;const s={...We.strokes[0]},r={...We.fills[0]};t/=J.scale,e=S.calcStageRelativePoint(e),J.drawEllipseFillWithScale(this.canvas,e,{rx:t,ry:t},r),J.drawEllipseStrokeWithScale(this.canvas,e,{rx:t,ry:t},s)}}class ki extends as{constructor(){super(...arguments);u(this,"_lastCursorRendered",!1);u(this,"_lastSelectionRendered",!1)}async redraw(){let t=new os([]),s=!1;const r=this.createMaskSelectionTasks();r.forEach(C=>{t.add(C)}),r.length&&(this._lastSelectionRendered=!0);const n=this.createMaskTransformerTasks();n.length&&t.addAll(n);const o=this.createControllerTasks();o.length&&t.addAll(o);const{store:{noParentElements:a},configure:{rotationIconEnable:c},selection:{rangeElement:h},cursor:d,isDrawerActive:g}=this.drawer.shield;if(a.length===1){const C=a[0];c&&C.rotationEnable&&C.status===Z.finished&&t.add(this.createMaskRotateTask(C.rotation)),t.add(this.createMaskIndicatorTask(C))}else a.length>1&&t.add(this.createMaskRotateTask(h.rotation));const f=d.getTask();f&&(t.add(f),this._lastCursorRendered=!0,s=!0),g&&(t.add(this.createMaskCursorPositionTask()),t.add(this.createMaskArbitraryCursorTask())),t.isEmpty()?(this._lastCursorRendered||this._lastSelectionRendered)&&!r.length&&!s?(t.add(new xs(null,this.renderParams)),await this.renderCargo(t),this._lastCursorRendered=!1,this._lastSelectionRendered=!1):t=null:(t.prepend(this.createMaskClearTask()),await this.renderCargo(t))}createMaskCursorPositionTask(){const{cursor:{value:t,worldValue:s},stageScale:r}=this.drawer.shield;if(!s)return;const n={point:{x:t.x+20/r,y:t.y+20/r},type:le.cursorPosition,text:`${l.precise(s.x,1)},${l.precise(s.y,1)}`};return new Ti(n,this.renderParams)}createMaskSelectionTasks(){const{selection:t,stageScale:s}=this.drawer.shield,r=[];return[...t.getModels(),t.selectionModel].forEach(o=>{if(o&&o.points.length>0){const a=new bi({...o,scale:1/s},this.renderParams);r.push(a)}}),r}createMaskClearTask(){return new xs(null,this.renderParams)}createMaskTransformerTasks(){const{selection:{transformerModels:t}}=this.drawer.shield;return t.map(s=>{switch(s.element.transformerType){case Le.circle:return new Dt(s,this.renderParams);case Le.rect:return new Si(s,this.renderParams)}})}createControllerTasks(){const{store:{primarySelectedElement:t},selection:{rangeElement:s}}=this.drawer.shield,r=t||s;if(r){const{controllers:n=[]}=r;return n.map(o=>{if(!(o instanceof nt)&&!(o instanceof Ge)&&!(o instanceof st)){const a={point:{x:o.x,y:o.y},type:le.transformer,radius:Ht};return new Dt(a,this.renderParams)}}).filter(o=>!!o)}return[]}createMaskRotateTask(t){const{x:s,y:r,points:n,angle:o,width:a,height:c,scale:h}=t,d={point:{x:s,y:r},points:n,angle:o,type:le.rotate,width:a,height:c,scale:h};return new Pi(d,this.renderParams)}createMaskIndicatorTask(t){const{stageScale:s}=this.drawer.shield;let r,n;switch(t.model.type){case A.line:{[r,n]=[...t.rotateCoords].sort((c,h)=>c.x-h.x);break}default:{if(t.model.angle%90===0&&t.model.leanYAngle===0){const{maxBoxCoords:c}=t;r=c[3],n=c[2]}else{const[c,h,d]=b.getLBRPoints(t.rotateBoxCoords,!0);let g=l.transformToAcuteAngle(l.calcAngle(h,c)+180),f=l.transformToAcuteAngle(l.calcAngle(h,d)+180);[r,n]=[g<f?c:d,h].sort((p,_)=>p.x-_.x)}break}}const o=l.calcAngle(r,n),a={point:l.calcSegmentLineCenterCrossPoint(r,n,!0,Xn/s),angle:o,type:le.indicator,text:`${t.width} x ${t.height}`};return new Ri(a,this.renderParams)}createMaskArbitraryCursorTask(){const{currentCreator:t,cursor:s}=this.drawer.shield;if(t.category===re.freedom){const r={point:s.value,type:le.cursor,radius:Ht};return new Dt(r,this.renderParams)}}}class lr extends is.EventEmitter{constructor(){super(...arguments);u(this,"canvas");u(this,"renderer")}initCanvas(){return this.canvas=document.createElement("canvas"),this.canvas}updateCanvasSize(t){this.canvas.width=t.width,this.canvas.height=t.height}clearCanvas(){var t;(t=this.canvas.getContext("2d"))==null||t.clearRect(0,0,this.canvas.width,this.canvas.height)}async redraw(t){await this.renderer.redraw(t)}}class cr extends lr{constructor(t){super();u(this,"shield");this.shield=t}}class Oi extends cr{constructor(e){super(e),this.renderer=new ki(this)}initCanvas(){return super.initCanvas(),this.canvas.id="mask",this.canvas.style.pointerEvents="none",this.canvas}}class hr extends $e{async run(){var e;this.canvas&&((e=this.canvas.getContext("2d"))==null||e.clearRect(0,0,this.canvas.width,this.canvas.height))}}class Ii extends as{constructor(){super(...arguments);u(this,"_latestElementRendered");u(this,"_latestClearRendered")}async redraw(){let t=new os([]);const{creatingElements:s}=this.drawer.shield.store;s.length>0&&(s.forEach(r=>{const n=S.createElementTask(r,this.renderParams);n&&t.add(n)}),this._latestElementRendered=!0),this._latestClearRendered=t.isEmpty()&&this._latestElementRendered,!t.isEmpty()||this._latestClearRendered?(t.prepend(new hr(null,this.renderParams)),await this.renderCargo(t),this._latestClearRendered&&(this._latestClearRendered=!1)):t=null}}class Bi extends cr{constructor(e){super(e),this.renderer=new Ii(this)}initCanvas(){return super.initCanvas(),this.canvas.id="provisional",this.canvas.style.pointerEvents="none",this.canvas}}class Li{constructor(e){u(this,"shield");u(this,"rangeElement");u(this,"_selectionModel");u(this,"_transformerModels",[]);u(this,"_rangeCoords",null);this.shield=e,this.rangeElement=new ns({...S.createEmptyGroupObject()},this.shield,!0)}get isEmpty(){const{isSelectedEmpty:e,isTargetEmpty:t,isRangeEmpty:s}=this.shield.store;return e&&t&&s}get isRange(){return this._rangeCoords!==null&&this._rangeCoords.length>0}get selectionModel(){return this._selectionModel}get transformerModels(){return this._transformerModels}get center(){return null}get internalAngle(){return 0}setRange(e){this._rangeCoords=e,this.refreshRangeElements(this._rangeCoords)}_getElementMaskModelProps(e,t){const{rotateCoords:s,rotateBoxCoords:r,model:{angle:n,isFold:o}}=e;return{points:t?r:s,angle:n,element:{isFold:o}}}_getElementsMaskModels(e,t){const s=[];return e.forEach(r=>{r&&(r.isGroupSubject||s.push({type:t,...this._getElementMaskModelProps(r)}))}),s}_getRangeElementsMaskModels(){return this._getElementsMaskModels(this.shield.store.rangeElements,le.path)}_getTargetElementsMaskModels(){return this._getElementsMaskModels(this.shield.store.targetElements,le.path)}_getSelectedElementsMaskModels(){const{store:e}=this.shield;return this._getElementsMaskModels([e.primarySelectedElement||e.creatingElements[0]],le.path)}getModels(){const e=[];return this.isRange&&e.push(...this._getRangeElementsMaskModels()),e.push(...this._getTargetElementsMaskModels()),e.push(...this._getSelectedElementsMaskModels()),this.isRange&&e.push({points:this._rangeCoords,type:le.range}),e}calcSelectionModel(){const e=this.shield.store.primarySelectedElement||this.rangeElement;if(e&&e.boxVerticesTransformEnable&&e.model.coords.length>0)return{type:le.selection,points:e.rotateBoxCoords,angle:e.model.angle}}calcTransformerModels(){const{primarySelectedElement:e,creatingElements:t}=this.shield.store,s=e||t[0]||this.rangeElement;if(s&&s.model.coords.length>0){const{transformerType:r,angle:n,leanYAngle:o,actualAngle:a,transformers:c,verticesTransformEnable:h,flipX:d,flipY:g}=s;return this.calcTransformerModelsByPoints(c,{angle:n,leanYAngle:o,actualAngle:a,flipX:d,flipY:g},h?r:Le.rect)}return[]}calcTransformerModelsByPoints(e,t,s){return e.map(r=>({point:r,type:le.transformer,scale:1/this.shield.stageScale,element:{transformerType:s},radius:Ht,...t}))}clearSelects(){const{store:e}=this.shield;e.deSelectElements(e.selectedElements)}hitTargetElements(e){const{store:t}=this.shield,s=t.stageElements;for(let r=s.length-1;r>=0;r--){const n=s[r],o=n.isContainsCoord(e);if(t.updateElementById(n.id,{isTarget:o}),o){t.targetElements.forEach(a=>{a.id!==n.id&&t.updateElementById(a.id,{isTarget:!1})});break}}}selectTargets(){this.shield.store.updateElements(this.shield.store.targetElements,{isSelected:!0,isTarget:!1})}refreshRangeElements(e){if(e&&e.length){const{store:t}=this.shield;t.stageElements.forEach(s=>{t.updateElementById(s.id,{isInRange:s.isPolygonOverlap(e)})})}}selectRange(){if(this.isRange){const{store:e}=this.shield;e.updateElements(e.rangeElements,{isSelected:!0,isInRange:!1})}}getElementOnCoord(e){const t=this.shield.store.stageElements;for(let s=t.length-1;s>=0;s--){const r=t[s];if(r.isContainsCoord(e))return r}}refreshSelectionModel(){this._selectionModel=this.calcSelectionModel()}refreshTransformerModels(){this._transformerModels=this.calcTransformerModels()}refreshRangeElement(){const e=this.shield.store.selectedElements;if(e.length===0)Object.assign(this.rangeElement.model,S.createEmptyGroupObject());else{if(!this.rangeElement.isRotating&&!this.rangeElement.isTransforming){const t=b.getBoxPoints(e.map(s=>s.rotateCoords).flat());Object.assign(this.rangeElement.model,{coords:t,boxCoords:z.jsonClone(t),...b.getRect(t),subIds:e.map(s=>s.id),...es})}this.rangeElement.isTransforming?this.rangeElement.refresh({points:!0,size:!0,rotation:!0,angles:!0,outline:!0,strokes:!0}):this.rangeElement.refresh()}}refresh(){this.refreshRangeElement(),this.refreshSelectionModel(),this.refreshTransformerModels()}tryActiveController(e){const t=this.shield.store.primarySelectedElement||this.rangeElement;if(t){const s=t.getControllerByCoord(e);if(t.setControllersActive(t.controllers.filter(r=>r.id!==(s==null?void 0:s.id)),!1),s)return t.setControllersActive([s],!0),s}}getActiveController(){const e=this.shield.store.primarySelectedElement||this.rangeElement;if(e)return e.getActiveController()}}const Mi="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1735892982581'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='15410'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M552.224%20179.712v664.576l68.704-68.704a36.576%2036.576%200%200%201%2051.712%2051.712l-130.24%20130.208a36.48%2036.48%200%200%201-26.72%2011.648h-0.064-0.032c-9.024%200-17.28-3.264-23.648-8.704l0.064%200.032a36.48%2036.48%200%200%201-4.576-3.872l-129.28-129.312a36.576%2036.576%200%200%201%2051.712-51.712l69.216%2069.216V179.232l-69.216%2069.216a36.576%2036.576%200%200%201-51.712-51.712l129.28-129.28c1.472-1.472%202.976-2.752%204.576-3.904a36.48%2036.48%200%200%201%2050.4%202.944l0.032%200.032%20130.24%20130.208a36.576%2036.576%200%200%201-51.712%2051.712l-68.704-68.704z'%20p-id='15411'%20fill='%232c2c2c'%3e%3c/path%3e%3c/svg%3e",Fi="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1735887761508'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='7589'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M641.264941%20791.853176l42.586353%2042.586353L512%201006.351059l-171.911529-171.91153%2042.586353-42.586353L481.882353%20891.060706v-227.20753h60.235294v227.20753l99.147294-99.20753zM481.882353%20132.939294v227.20753h60.235294V132.939294l99.147294%2099.147294%2042.586353-42.586353L512%2017.648941%20340.088471%20189.500235l42.586353%2042.586353L481.882353%20132.939294zM0%20481.882353v60.235294h1024V481.882353H0z'%20fill='%232c2c2c'%20p-id='7590'%3e%3c/path%3e%3c/svg%3e",Di="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1737787540457'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1497'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M870.4%20204.8c-18.6368%200-36.1472%205.0176-51.2%2013.7728l0-64.9728c0-56.4736-45.9264-102.4-102.4-102.4-21.0944%200-40.6528%206.4-56.9856%2017.3568-14.0288-39.8848-52.0192-68.5568-96.6144-68.5568s-82.6368%2028.672-96.6144%2068.5568c-16.2816-10.9568-35.8912-17.3568-56.9856-17.3568-56.4736%200-102.4%2045.9264-102.4%20102.4l0%20377.4976-68.9152-119.4496c-13.3632-24.32-35.1744-41.6256-61.3888-48.7936-25.5488-6.9632-52.1216-3.2768-74.8544%2010.3424-46.4384%2027.8528-64.1536%2090.8288-39.424%20140.3904%201.536%203.1232%2034.2016%2070.0416%20136.192%20273.92%2048.0256%2096%20100.7104%20164.6592%20156.6208%20203.9808%2043.8784%2030.8736%2074.1888%2032.4608%2079.8208%2032.4608l256%200c43.5712%200%2084.0704-14.1824%20120.4224-42.0864%2034.1504-26.2656%2063.7952-64.256%2088.064-112.8448%2047.8208-95.6416%2073.1136-227.9424%2073.1136-382.6688l0-179.2c0-56.4736-45.9264-102.4-102.4-102.4zM921.6%20486.4c0%20146.7904-23.3984%20271.1552-67.6864%20359.7312-28.8768%2057.7536-80.5888%20126.6688-162.7136%20126.6688l-255.488%200c-1.9968-0.1536-23.552-2.56-56.064-26.88-32.4096-24.2688-82.176-75.3664-135.0656-181.248-103.7824-207.5648-135.68-272.9472-135.9872-273.5616-0.0512-0.1024-0.0512-0.1536-0.1024-0.2048-12.8512-25.7536-3.7376-59.4944%2019.9168-73.6768%2010.6496-6.4%2023.0912-8.0896%2035.072-4.864%2012.7488%203.4816%2023.4496%2012.0832%2030.0544%2024.1664%200.1024%200.1536%200.2048%200.3584%200.3072%200.512l79.9232%20138.496c16.3328%2029.8496%2034.7136%2042.3936%2054.6304%2037.3248%2019.968-5.0688%2030.0544-25.0368%2030.0544-59.2384l0-400.0256c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20332.8c0%2014.1312%2011.4688%2025.6%2025.6%2025.6s25.6-11.4688%2025.6-25.6l0-384c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20384c0%2014.1312%2011.4688%2025.6%2025.6%2025.6s25.6-11.4688%2025.6-25.6l0-332.8c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20384c0%2014.1312%2011.4688%2025.6%2025.6%2025.6s25.6-11.4688%2025.6-25.6l0-230.4c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20179.2z'%20fill='%23000000'%20p-id='1498'%3e%3c/path%3e%3c/svg%3e",Ni="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1736172747971'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='4849'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M512%200a36.571429%2036.571429%200%200%201%2036.571429%2036.571429v950.857142a36.571429%2036.571429%200%200%201-73.142858%200V36.571429A36.571429%2036.571429%200%200%201%20512%200z'%20fill='%23000000'%20p-id='4850'%3e%3c/path%3e%3cpath%20d='M0%20509.074286a36.571429%2036.571429%200%200%201%2036.571429-36.571429h950.857142a36.571429%2036.571429%200%200%201%200%2073.142857H36.571429a36.571429%2036.571429%200%200%201-36.571429-36.571428z'%20fill='%23000000'%20p-id='4851'%3e%3c/path%3e%3c/svg%3e",Wi="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1737790480190'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='8613'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M550.034286%20633.904762v154.331428l58.392381-56.661333%2050.95619%2052.46781-144.505905%20140.288-147.065904-140.01981%2050.419809-52.979809%2058.684953%2055.832381-0.024381-153.283048h73.142857z%20m234.008381-269.287619l140.288%20144.505905-140.01981%20147.065904-52.979809-50.419809%2055.832381-58.684953H633.904762v-73.142857h154.331428l-56.661333-58.368%2052.46781-50.95619z%20m-544.231619%200l52.467809%2050.95619-56.685714%2058.368H390.095238v73.142857H236.690286l55.832381%2058.684953-52.955429%2050.419809-140.019809-147.065904%20140.263619-144.505905zM514.876952%2099.669333l144.505905%20140.288-50.95619%2052.46781-58.368-56.661333L550.034286%20390.095238h-73.142857V236.81219l-58.660572%2055.832381-50.419809-52.979809%20147.065904-140.01981z'%20p-id='8614'%3e%3c/path%3e%3c/svg%3e",Vi="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1740288855242'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='38476'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M679.338667%20849.152a4.266667%204.266667%200%200%200%206.656%200l161.792-202.24a4.266667%204.266667%200%200%200-3.328-6.912H736v-32a320%20320%200%200%200-320-320H384V179.541333a4.266667%204.266667%200%200%200-6.912-3.328l-202.24%20161.792a4.266667%204.266667%200%200%200%200%206.656l202.24%20161.792A4.266667%204.266667%200%200%200%20384%20503.125333V394.666667h32a213.333333%20213.333333%200%200%201%20213.333333%20213.333333V640h-108.458666a4.266667%204.266667%200%200%200-3.328%206.912l161.792%20202.24z'%20fill='%23000000'%20p-id='38477'%3e%3c/path%3e%3cpath%20d='M685.994667%20849.152l-13.312-10.666667%2013.312%2010.666667z%20m-6.656%200l13.312-10.666667-13.312%2010.666667z%20m168.448-202.24l-13.312-10.666667%2013.312%2010.666667zM736%20640v17.066667h-17.066667V640h17.066667zM384%20288v17.066667h-17.066667v-17.066667H384z%20m-6.912-111.786667l10.666667%2013.312-10.666667-13.312z%20m-202.24%20161.792l10.666667%2013.312-10.666667-13.312z%20m0%206.656l-10.666667%2013.312%2010.666667-13.312z%20m202.24%20161.792l10.666667-13.312-10.666667%2013.312zM384%20394.666667h-17.066667v-17.066667H384v17.066667zM629.333333%20640h17.066667v17.066667h-17.066667V640z%20m-111.786666%206.912l-13.312%2010.666667%2013.312-10.666667z%20m181.76%20212.906667a21.333333%2021.333333%200%200%201-33.28%200l26.624-21.333334a12.8%2012.8%200%200%200-19.968%200l26.624%2021.333334z%20m161.792-202.24l-161.792%20202.24-26.624-21.333334%20161.792-202.24%2026.624%2021.333334z%20m-16.64-34.645334a21.333333%2021.333333%200%200%201%2016.64%2034.645334l-26.624-21.333334a12.8%2012.8%200%200%200%209.984%2020.821334v-34.133334z%20m-108.458667%200h108.458667v34.133334H736v-34.133334z%20m-17.066667%2017.066667v-32h34.133334V640h-34.133334z%20m0-32a302.933333%20302.933333%200%200%200-302.933333-302.933333v-34.133334a337.066667%20337.066667%200%200%201%20337.066667%20337.066667h-34.133334z%20m-302.933333-302.933333H384v-34.133334h32v34.133334zM401.066667%20179.541333V288h-34.133334V179.541333h34.133334z%20m-34.645334-16.64a21.333333%2021.333333%200%200%201%2034.645334%2016.64h-34.133334a12.8%2012.8%200%200%200%2020.778667%209.984l-21.333333-26.624zM164.181333%20324.693333l202.24-161.792%2021.333334%2026.624-202.24%20161.792-21.333334-26.624z%20m0%2033.28a21.333333%2021.333333%200%200%201%200-33.28l21.333334%2026.624a12.8%2012.8%200%200%200%200-19.968l-21.333334%2026.624z%20m202.24%20161.792L164.181333%20357.973333l21.333334-26.624%20202.24%20161.792-21.333334%2026.624z%20m34.645334-16.64a21.333333%2021.333333%200%200%201-34.645334%2016.64l21.333334-26.624a12.8%2012.8%200%200%200-20.821334%209.984h34.133334z%20m0-108.458666v108.458666h-34.133334V394.666667h34.133334z%20m-17.066667-17.066667h32v34.133333H384v-34.133333z%20m32%200a230.4%20230.4%200%200%201%20230.4%20230.4h-34.133333a196.266667%20196.266667%200%200%200-196.266667-196.266667v-34.133333z%20m230.4%20230.4V640h-34.133333v-32h34.133333z%20m-125.525333%2014.933333h108.458666v34.133334h-108.458666v-34.133334z%20m-16.64%2034.645334a21.333333%2021.333333%200%200%201%2016.64-34.645334v34.133334a12.8%2012.8%200%200%200%209.984-20.778667l-26.624%2021.333333z%20m161.792%20202.24l-161.792-202.24%2026.624-21.333334%20161.792%20202.24-26.624%2021.333334z'%20fill='%23FFFFFF'%20p-id='38478'%3e%3c/path%3e%3c/svg%3e";class Ue extends Pe{constructor(t,s,r){super(t,r);u(this,"type",ue.vertices);this.type=s}get img(){switch(this.type){case ue.vertices:return Mi;case ue.border:return Fi;case ue.hand:return Di;case ue.cross:return Ni;case ue.move:return Wi;case ue.rotation:return Vi}}async run(){if(!this.canvas||!this.model)return;let{point:{x:t,y:s},width:r,height:n,scale:o}=this.model;await J.drawImgLike(this.canvas,this.img,{x:(t-r*o/2)/o,y:(s-n*o/2)/o,width:r,height:n},{angle:this.model.angle})}}class zi{constructor(e){u(this,"value");u(this,"shield");this.shield=e,this.value=null}get worldValue(){return this.value?S.calcWorldCoord(this.value):null}get renderParams(){return{canvas:this.shield.mask.canvas}}clear(){this.value=null}transform(e){return this.shield.stageRect?(this.value=b.getEventPosition(e,this.shield.stageRect,this.shield.stageScale),this.value.x=Math.round(this.value.x),this.value.y=Math.round(this.value.y),this.value):{x:0,y:0}}setStyle(e){this.shield.canvas.style.cursor=e}updateStyle(e){this.shield.selection.getActiveController()||this.shield.isDrawerActive?this.setStyle("none"):this.shield.isHandActive?this.setStyle("grab"):this.setStyle("default")}getTask(){if(this.shield.isDrawerActive)return this.createMaskDrawingCursorTask();if(this.shield.isMoveableActive){const e=this.shield.selection.getActiveController();if(e instanceof tr)return this.createMaskRotationControllerCursorTask(e);if(e instanceof nt||e instanceof mt)return this.createMaskRotationCursorTask(e);if(e instanceof Ge)return this.createMaskTransformerCursorTask(e);if(e instanceof st)return this.createMaskBorderTransformerCursorTask(e)}}createMaskDrawingCursorTask(){if(this.value)return new Ue(this._createTransformerCursorModel(),ue.cross,this.renderParams)}createMaskRotationCursorTask(e){if(this.value)return new Ue(this._createTransformerCursorModel({angle:e.angle}),ue.move,this.renderParams)}createMaskRotationControllerCursorTask(e){if(this.value)return new Ue(this._createTransformerCursorModel({angle:e.angle}),ue.rotation,this.renderParams)}createMaskBorderTransformerCursorTask(e){if(this.value)return new Ue(this._createTransformerCursorModel(e),ue.border,this.renderParams)}createMaskTransformerCursorTask(e){if(this.value)return new Ue(this._createTransformerCursorModel(e),ue.vertices,this.renderParams)}_createTransformerCursorModel(e){return{point:this.value,type:le.cursor,width:vs,height:vs,angle:(e==null?void 0:e.angle)||0,scale:1/this.shield.stageScale}}}class te{static stopPP(e){e.stopPropagation(),e.preventDefault()}}var dr=function(){if(typeof Map<"u")return Map;function i(e,t){var s=-1;return e.some(function(r,n){return r[0]===t?(s=n,!0):!1}),s}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(t){var s=i(this.__entries__,t),r=this.__entries__[s];return r&&r[1]},e.prototype.set=function(t,s){var r=i(this.__entries__,t);~r?this.__entries__[r][1]=s:this.__entries__.push([t,s])},e.prototype.delete=function(t){var s=this.__entries__,r=i(s,t);~r&&s.splice(r,1)},e.prototype.has=function(t){return!!~i(this.__entries__,t)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,s){s===void 0&&(s=null);for(var r=0,n=this.__entries__;r<n.length;r++){var o=n[r];t.call(s,o[1],o[0])}},e}()}(),qt=typeof window<"u"&&typeof document<"u"&&window.document===document,Ct=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),ji=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(Ct):function(i){return setTimeout(function(){return i(Date.now())},1e3/60)}}(),Gi=2;function Hi(i,e){var t=!1,s=!1,r=0;function n(){t&&(t=!1,i()),s&&a()}function o(){ji(n)}function a(){var c=Date.now();if(t){if(c-r<Gi)return;s=!0}else t=!0,s=!1,setTimeout(o,e);r=c}return a}var Yi=20,$i=["top","right","bottom","left","width","height","size","weight"],qi=typeof MutationObserver<"u",Ji=function(){function i(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=Hi(this.refresh.bind(this),Yi)}return i.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},i.prototype.removeObserver=function(e){var t=this.observers_,s=t.indexOf(e);~s&&t.splice(s,1),!t.length&&this.connected_&&this.disconnect_()},i.prototype.refresh=function(){var e=this.updateObservers_();e&&this.refresh()},i.prototype.updateObservers_=function(){var e=this.observers_.filter(function(t){return t.gatherActive(),t.hasActive()});return e.forEach(function(t){return t.broadcastActive()}),e.length>0},i.prototype.connect_=function(){!qt||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),qi?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},i.prototype.disconnect_=function(){!qt||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},i.prototype.onTransitionEnd_=function(e){var t=e.propertyName,s=t===void 0?"":t,r=$i.some(function(n){return!!~s.indexOf(n)});r&&this.refresh()},i.getInstance=function(){return this.instance_||(this.instance_=new i),this.instance_},i.instance_=null,i}(),ur=function(i,e){for(var t=0,s=Object.keys(e);t<s.length;t++){var r=s[t];Object.defineProperty(i,r,{value:e[r],enumerable:!1,writable:!1,configurable:!0})}return i},He=function(i){var e=i&&i.ownerDocument&&i.ownerDocument.defaultView;return e||Ct},gr=At(0,0,0,0);function yt(i){return parseFloat(i)||0}function As(i){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return e.reduce(function(s,r){var n=i["border-"+r+"-width"];return s+yt(n)},0)}function Xi(i){for(var e=["top","right","bottom","left"],t={},s=0,r=e;s<r.length;s++){var n=r[s],o=i["padding-"+n];t[n]=yt(o)}return t}function Ui(i){var e=i.getBBox();return At(0,0,e.width,e.height)}function Ki(i){var e=i.clientWidth,t=i.clientHeight;if(!e&&!t)return gr;var s=He(i).getComputedStyle(i),r=Xi(s),n=r.left+r.right,o=r.top+r.bottom,a=yt(s.width),c=yt(s.height);if(s.boxSizing==="border-box"&&(Math.round(a+n)!==e&&(a-=As(s,"left","right")+n),Math.round(c+o)!==t&&(c-=As(s,"top","bottom")+o)),!Zi(i)){var h=Math.round(a+n)-e,d=Math.round(c+o)-t;Math.abs(h)!==1&&(a-=h),Math.abs(d)!==1&&(c-=d)}return At(r.left,r.top,a,c)}var Qi=function(){return typeof SVGGraphicsElement<"u"?function(i){return i instanceof He(i).SVGGraphicsElement}:function(i){return i instanceof He(i).SVGElement&&typeof i.getBBox=="function"}}();function Zi(i){return i===He(i).document.documentElement}function eo(i){return qt?Qi(i)?Ui(i):Ki(i):gr}function to(i){var e=i.x,t=i.y,s=i.width,r=i.height,n=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,o=Object.create(n.prototype);return ur(o,{x:e,y:t,width:s,height:r,top:t,right:e+s,bottom:r+t,left:e}),o}function At(i,e,t,s){return{x:i,y:e,width:t,height:s}}var so=function(){function i(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=At(0,0,0,0),this.target=e}return i.prototype.isActive=function(){var e=eo(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},i.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},i}(),ro=function(){function i(e,t){var s=to(t);ur(this,{target:e,contentRect:s})}return i}(),no=function(){function i(e,t,s){if(this.activeObservations_=[],this.observations_=new dr,typeof e!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=s}return i.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof He(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new so(e)),this.controller_.addObserver(this),this.controller_.refresh())}},i.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof He(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},i.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},i.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(t){t.isActive()&&e.activeObservations_.push(t)})},i.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map(function(s){return new ro(s.target,s.broadcastRect())});this.callback_.call(e,t,e),this.clearActive()}},i.prototype.clearActive=function(){this.activeObservations_.splice(0)},i.prototype.hasActive=function(){return this.activeObservations_.length>0},i}(),fr=typeof WeakMap<"u"?new WeakMap:new dr,mr=function(){function i(e){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var t=Ji.getInstance(),s=new no(e,t,this);fr.set(this,s)}return i}();["observe","unobserve","disconnect"].forEach(function(i){mr.prototype[i]=function(){var e;return(e=fr.get(this))[i].apply(e,arguments)}});var io=function(){return typeof Ct.ResizeObserver<"u"?Ct.ResizeObserver:mr}();const oo=typeof window>"u",ao=function(i){for(const e of i){const t=e.target.__resizeListeners__||[];t.length&&t.forEach(s=>{s(e)})}};class lo{static addListener(e,t){oo||e&&(e.__resizeListeners__||(e.__resizeListeners__=[],e.__ro__=new io(ao),e.__ro__.observe(e)),e.__resizeListeners__.push(t))}static removeListener(e,t){!e||!e.__resizeListeners__||(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),e.__resizeListeners__.length||e.__ro__.disconnect())}}var pe={},Ps;function co(){if(Ps)return pe;Ps=1,Object.defineProperty(pe,"__esModule",{value:!0});for(var i=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),e={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},t={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:i?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},s={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},r=1;r<20;r++)s["f"+r]=111+r;function n(f,C,p){C&&!("byKey"in C)&&(p=C,C=null),Array.isArray(f)||(f=[f]);var _=f.map(function(M){return c(M,C)}),v=function(Y){return _.some(function(E){return h(E,Y)})},V=p==null?v:v(p);return V}function o(f,C){return n(f,C)}function a(f,C){return n(f,{byKey:!0},C)}function c(f,C){var p=C&&C.byKey,_={};f=f.replace("++","+add");var v=f.split("+"),V=v.length;for(var M in e)_[e[M]]=!1;var Y=!0,E=!1,y=void 0;try{for(var x=v[Symbol.iterator](),I;!(Y=(I=x.next()).done);Y=!0){var B=I.value,j=B.endsWith("?")&&B.length>1;j&&(B=B.slice(0,-1));var W=g(B),ne=e[W];if(B.length>1&&!ne&&!t[B]&&!s[W])throw new TypeError('Unknown modifier: "'+B+'"');(V===1||!ne)&&(p?_.key=W:_.which=d(B)),ne&&(_[ne]=j?null:!0)}}catch(Re){E=!0,y=Re}finally{try{!Y&&x.return&&x.return()}finally{if(E)throw y}}return _}function h(f,C){for(var p in f){var _=f[p],v=void 0;if(_!=null&&(p==="key"&&C.key!=null?v=C.key.toLowerCase():p==="which"?v=_===91&&C.which===93?91:C.which:v=C[p],!(v==null&&_===!1)&&v!==_))return!1}return!0}function d(f){f=g(f);var C=s[f]||f.toUpperCase().charCodeAt(0);return C}function g(f){return f=f.toLowerCase(),f=t[f]||f,f}return pe.default=n,pe.isHotkey=n,pe.isCodeHotkey=o,pe.isKeyHotkey=a,pe.parseHotkey=c,pe.compareHotkey=h,pe.toKeyCode=d,pe.toKeyName=g,pe}var ho=co();const ie=Xr(ho);class uo extends bt{constructor(t){super();u(this,"func");this.func=t}async run(){await this.func()}async destroy(){}}class go extends uo{}class Ve{static getImageDataFromClipboard(e){return new Promise((t,s)=>{var a;const r=(a=e.clipboardData)==null?void 0:a.items;if(!r)return console.warn("No clipboard data"),s();const n=Array.from(r).filter(c=>c.type.startsWith("image/"));if(!n.length)return console.warn("No image in clipboard"),s();const o=Promise.all(n.map(c=>{const h=c.getAsFile();if(!h){console.warn("No blob in clipboard"),s();return}return J.getImageDataFromBlob(h)}));t(o)})}static getImageDataFromFileTransfer(e){return new Promise((t,s)=>{var n;const r=(n=e.dataTransfer)==null?void 0:n.files;if(!r)return console.warn("No files in drag event"),s();Ve.parseImageFiles(Array.from(r),t,s)})}static getImageDataFromFiles(e){return new Promise((t,s)=>Ve.parseImageFiles(e,t,s))}static parseImageFiles(e,t,s){const r=Array.from(e).filter(o=>o.type.startsWith("image/"));if(!r.length)return console.warn("No image in files"),s();const n=Promise.all(r.map(o=>J.getImageDataFromBlob(o)));t(n)}}class fo extends is.EventEmitter{constructor(t){super();u(this,"shield");u(this,"_isCtrl");u(this,"_isCtrlWheel");u(this,"_isShift");u(this,"_isCtrlEvent");u(this,"_isCtrlPlusEvent");u(this,"_isCtrlReduceEvent");u(this,"_isCtrl0Event");u(this,"_isCtrlAEvent");u(this,"_isCtrlMEvent");u(this,"_isCtrlHEvent");u(this,"_isCtrlGEvent");u(this,"_isCtrlCEvent");u(this,"_isCtrlZEvent");u(this,"_isCtrlYEvent");u(this,"_isCtrlShiftGEvent");u(this,"_isShiftEvent");u(this,"_isShift1Event");u(this,"_isDeleteEvent");u(this,"_isEscEvent");this.shield=t}get isCtrl(){return this._isCtrl}get isOnlyCtrl(){return this._isCtrl&&!this._isShift}get isCtrlWheel(){return this._isCtrlWheel}get isShift(){return this._isShift}get isOnlyShift(){return this._isShift&&!this._isCtrl}init(){this._isCtrl=!1,this._isCtrlWheel=!1,this._isCtrlEvent=ie("ctrl"),this._isCtrlPlusEvent=ie("ctrl+="),this._isCtrlReduceEvent=ie("ctrl+-"),this._isCtrl0Event=ie("ctrl+0"),this._isShiftEvent=ie("shift"),this._isShift1Event=ie("shift+1"),this._isDeleteEvent=ie("backspace"),this._isCtrlAEvent=ie("ctrl+a"),this._isCtrlMEvent=ie("ctrl+m"),this._isCtrlHEvent=ie("ctrl+h"),this._isCtrlGEvent=ie("ctrl+g"),this._isCtrlCEvent=ie("ctrl+c"),this._isCtrlZEvent=ie("ctrl+z"),this._isCtrlYEvent=ie("ctrl+y"),this._isCtrlShiftGEvent=ie("ctrl+shift+g"),this._isEscEvent=ie("esc"),this.initEvents()}async initEvents(){Promise.all([this.initRenderResizeEvent(),this.initMouseEvents()])}_isInputEvent(t){return t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement}async initRenderResizeEvent(){lo.addListener(this.shield.renderEl,t=>{this.emit("resize",t)})}_createImages(t){if(t&&t.length){let s=new xi;t.forEach((r,n)=>{s.add(new go(async()=>{await new Promise(o=>{this.emit("pasteImage",r,async()=>{await ar.wait(100),o(!0)})}),n===t.length-1&&(await s.destroy(),s=null)}))})}}async initMouseEvents(){this.shield.canvas.addEventListener("mousemove",t=>{this.emit("cursorMove",t)}),this.shield.canvas.addEventListener("mouseleave",t=>{this.emit("cursorLeave",t)}),this.shield.canvas.addEventListener("mousedown",t=>{this.emit("pressDown",t)}),this.shield.canvas.addEventListener("mouseup",t=>{this.emit("pressUp",t)}),this.shield.canvas.addEventListener("dblclick",t=>{this.emit("dblClick",t)}),this.shield.canvas.addEventListener("wheel",t=>{te.stopPP(t),this._isCtrlWheel=this._isCtrl,this._isCtrlWheel?this.emit("wheelScale",-t.deltaY/2e3,t):this.emit("wheelMove",{x:t.deltaX,y:t.deltaY},t)}),this.shield.canvas.addEventListener("dragover",t=>{te.stopPP(t)}),this.shield.canvas.addEventListener("drop",t=>{te.stopPP(t),Ve.getImageDataFromFileTransfer(t).then(s=>{this._createImages(s)}).catch(s=>{s&&console.warn(s)})}),document.addEventListener("keydown",t=>{this._isCtrl=this._isCtrlEvent(t),this._isCtrlPlusEvent(t)&&(te.stopPP(t),this.emit("scaleIncrease")),this._isCtrlReduceEvent(t)&&(te.stopPP(t),this.emit("scaleReduce")),this._isCtrl0Event(t)&&(te.stopPP(t),this.emit("scale100")),this._isShift1Event(t)?(te.stopPP(t),this.emit("scaleAutoFit")):this._isShiftEvent(t)?this._isShift=!0:this._isShift=!1,this._isInputEvent(t)||(this._isDeleteEvent(t)&&(te.stopPP(t),this.emit("deleteSelects")),this._isCtrlAEvent(t)&&(te.stopPP(t),this.emit("selectAll")),this._isCtrlMEvent(t)&&(te.stopPP(t),this.emit("selectMoveable")),this._isCtrlHEvent(t)&&(te.stopPP(t),this.emit("selectHand")),this._isCtrlGEvent(t)&&(te.stopPP(t),this.emit("selectGroup")),this._isCtrlCEvent(t)&&(te.stopPP(t),this.emit("selectCopy",t)),this._isCtrlZEvent(t)&&(te.stopPP(t),this.emit("undo")),this._isCtrlYEvent(t)&&(te.stopPP(t),this.emit("redo")),this._isCtrlShiftGEvent(t)&&(te.stopPP(t),this.emit("selectGroupCancel")),this._isEscEvent(t)&&(te.stopPP(t),this.emit("cancel")))}),document.addEventListener("keyup",t=>{this._isCtrl=t.ctrlKey,this._isShift=t.shiftKey}),document.addEventListener("paste",t=>{Ve.getImageDataFromClipboard(t).then(s=>{this._createImages(s)}).catch(s=>{s&&console.warn(s);try{const r=JSON.parse(t.clipboardData.getData("text/plain"));r&&this.emit("pasteElements",r)}catch(r){r&&console.warn(r)}})})}async onImagesUpload(t){if(t.length){const s=await Ve.getImageDataFromFiles(t);this._createImages(s)}}}class mo extends as{constructor(){super(...arguments);u(this,"_lastestStageElementsSize",0)}async redraw(t){const{stageElements:s}=this.drawer.store;if(t||s.length!==this._lastestStageElementsSize){this._lastestStageElementsSize=s.length;const r=new os([]);r.add(new hr(null,this.renderParams)),s.forEach(n=>{const o=S.createElementTask(n,this.renderParams);o&&r.add(o)}),await this.renderCargo(r)}}}const Rs={rotationIconEnable:!0};class po{constructor(){u(this,"_configs",Rs);this.config(Rs),cn({enforceActions:"never"})}get rotationIconEnable(){return this._configs.rotationIconEnable}config(e){Object.assign(this._configs,e)}}var $=(i=>(i[i.NONE=0]="NONE",i[i.MOVING=1]="MOVING",i[i.ROTATING=2]="ROTATING",i[i.TRANSFORMING=3]="TRANSFORMING",i[i.CORNER_MOVING=4]="CORNER_MOVING",i))($||{});class Co{constructor(e){u(this,"shield");this.shield=e}_getElementsCoordsRect(e){return b.getRect(e.map(t=>this._getElementAlignCoords(t)).flat())}_calcElementsAllWidth(e){let t=0;return e.forEach(s=>{const r=b.getRect(this._getElementAlignCoords(s));t+=r.width}),t}_calcElementsAllHeight(e){let t=0;return e.forEach(s=>{const r=b.getRect(this._getElementAlignCoords(s));t+=r.height}),t}_sortElementsByX(e){return P.sortBy(e,t=>b.getRect(this._getElementAlignCoords(t)).x)}_sortElementsByXW(e){return P.sortBy(e,t=>{const{x:s,width:r}=b.getRect(this._getElementAlignCoords(t));return s+r})}_sortElementsByY(e){return P.sortBy(e,t=>b.getRect(this._getElementAlignCoords(t)).y)}_sortElementsByYH(e){return P.sortBy(e,t=>{const{y:s,height:r}=b.getRect(this._getElementAlignCoords(t));return s+r})}_getElementAlignCoords(e){return this.shield.event.isShift?e.alignOutlineCoords.flat():e.alignCoords}_setElementPositionByOffset(e,t,s){const r={x:t,y:s};e.setPosition(e.model.x+t,e.model.y+s,r),e.isGroup&&!e.isGroupSubject&&e.deepSubs.forEach(n=>{n.setPosition(n.model.x+t,n.model.y+s,r)})}setElementsAlignLeft(e){e=S.getNoParentElements(e);const{x:t}=this._getElementsCoordsRect(e);e.forEach(s=>{const{x:r}=b.getRect(this._getElementAlignCoords(s)),n=t-r;n!==0&&this._setElementPositionByOffset(s,n,0)})}setElementsAlignRight(e){e=S.getNoParentElements(e);const{x:t,width:s}=this._getElementsCoordsRect(e);e.forEach(r=>{const{x:n,width:o}=b.getRect(this._getElementAlignCoords(r)),a=t+s-n-o;a!==0&&this._setElementPositionByOffset(r,a,0)})}setElementsAlignTop(e){e=S.getNoParentElements(e);const{y:t}=this._getElementsCoordsRect(e);e.forEach(s=>{const{y:r}=b.getRect(this._getElementAlignCoords(s)),n=t-r;n!==0&&this._setElementPositionByOffset(s,0,n)})}setElementsAlignBottom(e){e=S.getNoParentElements(e);const{y:t,height:s}=this._getElementsCoordsRect(e);e.forEach(r=>{const{y:n,height:o}=b.getRect(this._getElementAlignCoords(r)),a=t+s-n-o;a!==0&&this._setElementPositionByOffset(r,0,a)})}setElementsAlignCenter(e){e=S.getNoParentElements(e);const{x:t,width:s}=this._getElementsCoordsRect(e);e.forEach(r=>{const{x:n,width:o}=b.getRect(this._getElementAlignCoords(r)),a=t+s/2-(n+o/2);a!==0&&this._setElementPositionByOffset(r,a,0)})}setElementsAlignMiddle(e){e=S.getNoParentElements(e);const{y:t,height:s}=this._getElementsCoordsRect(e);e.forEach(r=>{const{y:n,height:o}=b.getRect(this._getElementAlignCoords(r)),a=t+s/2-(n+o/2);a!==0&&this._setElementPositionByOffset(r,0,a)})}setElementsAverageVertical(e){e=S.getNoParentElements(e),e=this._sortElementsByY(e);const{y:t,height:s}=this._getElementsCoordsRect(e),r=b.getRect(this._getElementAlignCoords(e[0]));let n=t+r.height;const o=this._calcElementsAllHeight(e),a=(s-o)/(e.length-1);e=this._sortElementsByYH(e.slice(1)),e.forEach((c,h)=>{if(h!==e.length-1){const{y:d,height:g}=b.getRect(this._getElementAlignCoords(c)),f=n+a-d;f!==0&&this._setElementPositionByOffset(c,0,f),n=d+f+g}})}setElementsAverageHorizontal(e){e=S.getNoParentElements(e),e=this._sortElementsByX(e);const{x:t,width:s}=this._getElementsCoordsRect(e),r=b.getRect(this._getElementAlignCoords(e[0]));let n=t+r.width;const o=this._calcElementsAllWidth(e),a=(s-o)/(e.length-1);e=this._sortElementsByXW(e.slice(1)),e.forEach((c,h)=>{if(h!==e.length-1){const{x:d,width:g}=b.getRect(this._getElementAlignCoords(c)),f=n+a-d;f!==0&&this._setElementPositionByOffset(c,f,0),n=d+f+g}})}}class yo{static copyValueToClipboard(e){let t=document.createElement("input");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t),t=null}}class _o{constructor(e){u(this,"shield");u(this,"undoStack",[]);u(this,"redoStack",[]);this.shield=e}get nearestUndoCommand(){return this.undoStack[this.undoStack.length-1]}get nearestRedoCommand(){return this.redoStack[this.redoStack.length-1]}add(e){this.undoStack.push(e),this.redoStack=[]}undo(){if(this.undoStack.length>0){const e=this.undoStack.pop();this.redoStack.push(e),e.undo()}}redo(){if(this.redoStack.length>0){const e=this.redoStack.pop();this.undoStack.push(e),e.redo()}}}var Te=(i=>(i.ElementsAdded="elements_added",i.ElementsRemoved="elements_removed",i.ElementsUpdated="elements_updated",i.ElementsRearranged="elements_rearranged",i.GroupAdded="group_added",i.GroupRemoved="group_removed",i))(Te||{});class qe{constructor(e,t){u(this,"payload");u(this,"store");this.payload=e,this.store=t}undo(){throw new Error("Method not implemented.")}redo(){throw new Error("Method not implemented.")}}class Eo extends qe{undo(){this.payload.dataList.forEach(e=>{const{model:{id:t}}=e;this.store.removeElement(t)})}redo(){this.payload.dataList.forEach(e=>{this.store.afterAddElementByModel(z.jsonClone(e.model))})}}class Nt extends qe{_restoreElementsFromData(e){e.forEach(t=>{const{model:s}=t,r=this.store.updateElementModel(s.id,z.jsonClone(s));r&&(r.refreshFlipX(),r.refresh())})}undo(){this.payload.dataList&&this._restoreElementsFromData(this.payload.dataList)}redo(){this.payload.rDataList&&this._restoreElementsFromData(this.payload.rDataList)}}class vo extends qe{undo(){this.payload.dataList.forEach(e=>{const{prevId:t,model:s}=e;let r;t&&(r=this.store.getElementById(t)),this.store.afterAddElementByModel(z.jsonClone(s),r,!t)})}redo(){this.payload.dataList.forEach(e=>{const{model:{id:t}}=e;this.store.removeElement(t)})}}class wo extends qe{undo(){this.payload.dataList.forEach(e=>{const{model:{id:t},isGroup:s,isGroupSubject:r,prevId:n}=e;if(s)this.store.removeElement(t);else{const o=this.store.getElementById(t);o&&(r&&this.store.updateElementModel(t,{groupId:void 0}),this.store.rearrangeElementAfter(o,n?this.store.getElementById(n):null,!0))}}),this.store.resortElementsArray(),this.store.emitElementsLayerChanged()}redo(){for(let e=this.payload.rDataList.length-1;e>=0;e--){const t=this.payload.rDataList[e],{model:{id:s,groupId:r},isGroup:n,isGroupSubject:o,nextId:a}=t;if(n)this.store.beforeAddElementByModel(z.jsonClone(t.model),a?this.store.getElementById(a):null,!0);else{const c=this.store.getElementById(s);c&&(o&&this.store.updateElementModel(s,{groupId:r}),this.store.rearrangeElementBefore(c,a?this.store.getElementById(a):null,!0))}}this.store.resortElementsArray(),this.store.emitElementsLayerChanged()}}class bo extends qe{undo(){this.payload.dataList.forEach(e=>{const{model:{id:t,groupId:s},isGroup:r,prevId:n}=e;r?this.store.afterAddElementByModel(z.jsonClone(e.model),n?this.store.getElementById(n):null,!0):this.store.updateElementModel(t,{groupId:s})})}redo(){this.payload.dataList.forEach(e=>{const{model:{id:t},isGroup:s}=e;s?this.store.removeElement(t):this.store.updateElementModel(t,{groupId:void 0})})}}class So extends qe{_rearrange(e){e.forEach(t=>{const{model:{id:s},prevId:r}=t,n=this.store.getElementById(s);n&&this.store.rearrangeElementAfter(n,r?this.store.getElementById(r):null,!0)}),this.store.resortElementsArray(),this.store.emitElementsLayerChanged()}undo(){this.payload.dataList&&this._rearrange(this.payload.dataList)}redo(){this.payload.rDataList&&this._rearrange(this.payload.rDataList)}}class xo extends lr{constructor(){super();u(this,"currentCreator");u(this,"cursor");u(this,"mask");u(this,"provisional");u(this,"configure");u(this,"store");u(this,"selection");u(this,"event");u(this,"align");u(this,"undo");u(this,"stageScale",1);u(this,"stageWorldCoord",{x:0,y:0});u(this,"stageRect");u(this,"renderEl");u(this,"elementsStatus",$.NONE);u(this,"_cursorMoveQueue",new pt);u(this,"_redrawQueue",new pt);u(this,"_shouldRedraw",!1);u(this,"_pressDownPosition");u(this,"_pressDownStageWorldCoord");u(this,"_pressUpPosition");u(this,"_pressUpStageWorldCoord");u(this,"_pressMovePosition");u(this,"_pressMoveStageWorldCoord");u(this,"_isPressDown",!1);u(this,"_isStageMoving",!1);u(this,"_originalStageWorldCoord");u(this,"_originalEditingDataList");this.configure=new po,this.event=new fo(this),this.store=new wi(this),this.cursor=new zi(this),this.provisional=new Bi(this),this.selection=new Li(this),this.align=new Co(this),this.mask=new Oi(this),this.undo=new _o(this),this.renderer=new mo(this),this._requestAnimationRedraw(),window.shield=this}get stageRectPoints(){return b.getRectVertices(this.stageRect)}get stageWordRectCoords(){return b.getBoxVertices(this.stageWorldCoord,{width:this.stageRect.width/this.stageScale,height:this.stageRect.height/this.stageScale})}get isElementsBusy(){return[$.ROTATING,$.MOVING,$.TRANSFORMING,$.CORNER_MOVING].includes(this.elementsStatus)}get isStageMoving(){return this._isStageMoving}get isDrawerActive(){var t;return[re.shapes,re.freedom].includes((t=this.currentCreator)==null?void 0:t.category)}get isHandActive(){var t;return((t=this.currentCreator)==null?void 0:t.type)===A.hand}get isMoveableActive(){var t;return((t=this.currentCreator)==null?void 0:t.type)===A.moveable}get isArbitraryDrawing(){var t;return((t=this.currentCreator)==null?void 0:t.type)===A.arbitrary}get stageCalcParams(){return{rect:this.stageRect,worldCoord:this.stageWorldCoord,scale:this.stageScale}}get movingOffset(){return{x:Math.floor(this._pressMoveStageWorldCoord.x-this._pressDownStageWorldCoord.x),y:Math.floor(this._pressMoveStageWorldCoord.y-this._pressDownStageWorldCoord.y)}}_addRedrawTask(t,s){this._redrawQueue.add({run:async()=>{await Promise.all([this.redraw(s),this.mask.redraw(),this.provisional.redraw()]),t&&await t()}})}async _requestAnimationRedraw(){requestAnimationFrame(async()=>{this._addRedrawTask(()=>this._requestAnimationRedraw(),this._shouldRedraw),this._shouldRedraw=!1})}_createUpdateCommandBy(t,s){const r=new Nt({type:Te.ElementsUpdated,dataList:t,rDataList:s},this.store);this.undo.add(r)}async _createTranslateCommand(t,s){const r=await Promise.all(t.map(async o=>({model:await o.toTranslateJson()})));await s();const n=await Promise.all(t.map(async o=>({model:await o.toTranslateJson()})));this._createUpdateCommandBy(r,n)}async setElementsPosition(t,s){await this._createTranslateCommand(t,async()=>{await this.store.setElementsPosition(t,s)}),t.forEach(r=>r.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async _createTransformCommand(t,s){const r=await Promise.all(t.map(async o=>({model:await o.toTransformJson()})));await s();const n=await Promise.all(t.map(async o=>({model:await o.toTransformJson()})));this._createUpdateCommandBy(r,n)}async setElementsWidth(t,s){await this._createTransformCommand(t,async()=>{await this.store.setElementsWidth(t,s)}),t.forEach(r=>r.onWidthChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsHeight(t,s){await this._createTransformCommand(t,async()=>{await this.store.setElementsHeight(t,s)}),t.forEach(r=>r.onHeightChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsLeanYAngle(t,s){await this._createTransformCommand(t,async()=>{await this.store.setElementsLeanYAngle(t,s)}),t.forEach(r=>r.onLeanyAngleChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAngle(t,s){await this._createTransformCommand(t,async()=>{await this.store.setElementsAngle(t,s)}),t.forEach(r=>r.onAngleChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsCorners(t,s,r){const n=await Promise.all(t.map(async a=>({model:await a.toCornerJson()})));await this.store.setElementsCorners(t,s,r);const o=await Promise.all(t.map(async a=>({model:await a.toCornerJson()})));this._createUpdateCommandBy(n,o),t.forEach(a=>a.onCornerChanged()),this._shouldRedraw=!0}async _createStrokeCommand(t,s){const r=await Promise.all(t.map(async o=>({model:await o.toStrokesJson(),isStroke:!0,isStyle:!0})));await s();const n=await Promise.all(t.map(async o=>({model:await o.toStrokesJson(),isStroke:!0,isStyle:!0})));this._createUpdateCommandBy(r,n)}async setElementsStrokeType(t,s,r){await this._createStrokeCommand(t,async()=>{await this.store.setElementsStrokeType(t,s,r)}),t.forEach(n=>n.onStrokeTypeChanged()),this._shouldRedraw=!0}async setElementsStrokeWidth(t,s,r){await this._createStrokeCommand(t,async()=>{await this.store.setElementsStrokeWidth(t,s,r)}),t.forEach(n=>n.onStrokeWidthChanged()),this._shouldRedraw=!0}async setElementsStrokeColor(t,s,r){await this._createStrokeCommand(t,async()=>{await this.store.setElementsStrokeColor(t,s,r)}),t.forEach(n=>n.onStrokeColorChanged()),this._shouldRedraw=!0}async setElementsStrokeColorOpacity(t,s,r){await this._createStrokeCommand(t,async()=>{await this.store.setElementsStrokeColorOpacity(t,s,r)}),t.forEach(n=>n.onStrokeColorOpacityChanged()),this._shouldRedraw=!0}async addElementsStroke(t,s){await this._createStrokeCommand(t,async()=>{await this.store.addElementsStroke(t,s)}),t.forEach(r=>r.onStrokeAdded()),this._shouldRedraw=!0}async removeElementsStroke(t,s){await this._createStrokeCommand(t,async()=>{await this.store.removeElementsStroke(t,s)}),t.forEach(r=>r.onStrokeRemoved()),this._shouldRedraw=!0}async _createFillCommand(t,s){const r=await Promise.all(t.map(async o=>({model:await o.toFillsJson(),isFill:!0,isStyle:!0})));await s();const n=await Promise.all(t.map(async o=>({model:await o.toFillsJson(),isFill:!0,isStyle:!0})));this._createUpdateCommandBy(r,n)}async setElementsFillColor(t,s,r){await this._createFillCommand(t,async()=>{await this.store.setElementsFillColor(t,s,r)}),t.forEach(n=>n.onFillColorChanged()),this._shouldRedraw=!0}async setElementsFillColorOpacity(t,s,r){await this._createFillCommand(t,async()=>{await this.store.setElementsFillColorOpacity(t,s,r)}),t.forEach(n=>n.onFillColorOpacityChanged()),this._shouldRedraw=!0}async addElementsFill(t,s){await this._createFillCommand(t,async()=>{await this.store.addElementsFill(t,s)}),t.forEach(r=>r.onFillAdded()),this._shouldRedraw=!0}async removeElementsFill(t,s){await this._createFillCommand(t,async()=>{await this.store.removeElementsFill(t,s)}),t.forEach(r=>r.onFillRemoved()),this._shouldRedraw=!0}async setElementsTextAlign(t,s){await this.store.setElementsTextAlign(t,s),t.forEach(r=>r.onTextAlignChanged()),this._shouldRedraw=!0}async setElementsTextBaseline(t,s){await this.store.setElementsTextBaseline(t,s),t.forEach(r=>r.onTextBaselineChanged()),this._shouldRedraw=!0}async setElementsFontSize(t,s){await this.store.setElementsFontSize(t,s),t.forEach(r=>r.onFontSizeChanged()),this._shouldRedraw=!0}async setElementsFontFamily(t,s){await this.store.setElementsFontFamily(t,s),t.forEach(r=>r.onFontFamilyChanged()),this._shouldRedraw=!0}async setElementsRatioLocked(t,s){await this.store.setElementsRatioLocked(t,s),t.forEach(r=>r.onRatioLockedChanged())}async init(t){this.renderEl=t,await Promise.all([this.initCanvas(),this.event.init()]),this._addEventListeners()}_addCursorQueueTask(t){this._cursorMoveQueue.add({run:t})}_addEventListeners(){this.event.on("resize",this._refreshSize.bind(this)),this.event.on("cursorMove",t=>this._addCursorQueueTask(()=>this._handleCursorMove(t))),this.event.on("pressDown",t=>this._addCursorQueueTask(()=>this._handlePressDown(t))),this.event.on("pressUp",t=>this._addCursorQueueTask(()=>this._handlePressUp(t))),this.event.on("cursorLeave",this._handleCursorLeave.bind(this)),this.event.on("dblClick",this._handleDblClick.bind(this)),this.event.on("wheelScale",this._handleWheelScale.bind(this)),this.event.on("wheelMove",this._handleWheelMove.bind(this)),this.event.on("scaleReduce",this._handleScaleReduce.bind(this)),this.event.on("scaleIncrease",this._handleScaleIncrease.bind(this)),this.event.on("scaleAutoFit",this._handleScaleAutoFit.bind(this)),this.event.on("scale100",this._handleScale100.bind(this)),this.event.on("pasteImage",this._handleImagePasted.bind(this)),this.event.on("deleteSelects",this._handleSelectsDelete.bind(this)),this.event.on("selectAll",this._handleSelectAll.bind(this)),this.event.on("selectCopy",this._handleSelectCopy.bind(this)),this.event.on("pasteElements",this._handlePasteElements.bind(this)),this.event.on("cancel",this._handleCancel.bind(this)),this.event.on("selectMoveable",this._handleSelectMoveable.bind(this)),this.event.on("selectHand",this._handleSelectHand.bind(this)),this.event.on("selectGroup",this._handleSelectGroup.bind(this)),this.event.on("selectGroupCancel",this._handleSelectGroupCancel.bind(this)),this.event.on("undo",this._handleUndo.bind(this)),this.event.on("redo",this._handleRedo.bind(this))}initCanvas(){super.initCanvas();const t=this.mask.initCanvas(),s=this.provisional.initCanvas();return this.renderEl.insertBefore(t,this.renderEl.firstChild),this.renderEl.insertBefore(s,this.mask.canvas),this.canvas.id="shield",this.renderEl.insertBefore(this.canvas,this.provisional.canvas),this.canvas}async _handleCursorMove(t){if(this.cursor.transform(t),this.cursor.updateStyle(t),this.isMoveableActive&&!this.isElementsBusy&&this.selection.hitTargetElements(this.cursor.worldValue),this._isPressDown)if(this.calcPressMove(t),this.isArbitraryDrawing)this._updatingArbitraryElementOnMovement(t),this.selection.refreshTransformerModels();else if(this.isDrawerActive)this._creatingElementOnMovement(t),this.selection.refreshTransformerModels();else if(this.isMoveableActive){if(this.store.isSelectedEmpty)this._createRange();else if(this.checkCursorPressMovedALittle(t)){switch(this.elementsStatus){case $.ROTATING:{this._rotateElements();break}case $.MOVING:{this._dragElements();break}case $.TRANSFORMING:{this._transformElements();break}case $.CORNER_MOVING:{this._movingElementsCorner();break}}[$.ROTATING,$.TRANSFORMING,$.CORNER_MOVING].includes(this.elementsStatus)||this.store.isSelectedContainsTarget()&&(this.elementsStatus=$.MOVING,await this._dragElements())}}else this.isHandActive&&(this._isStageMoving=!0,this._dragStage(t));else this.isMoveableActive&&this._tryActiveController();this.isElementsBusy&&this.store.cancelTargetElements()}_tryActiveController(){return this.selection.tryActiveController(this.cursor.worldValue)}_dragStage(t){this._refreshStageWorldCoord(t),this.store.refreshStageElements(),this.selection.refresh()}_dragElements(){const{selectedElements:t}=this.store;this.store.updateElementsTranslate(t,this.movingOffset),t.forEach(s=>{s.isDragging=!0,s.onTranslating()}),this.selection.refresh(),this._shouldRedraw=!0}_movingElementsCorner(){const{selectedElements:t}=this.store;this.store.updateElementsCorner(t,this.movingOffset),t.forEach(s=>{s.isCornerMoving=!0,s.onCornerChanging()}),this._shouldRedraw=!0}_transformElements(){const{selectedElements:t}=this.store;this.store.isMultiSelected?(this.selection.rangeElement.isTransforming=!0,this.store.updateElementsTransform([this.selection.rangeElement],this.movingOffset)):this.store.updateElementsTransform(t,this.movingOffset),t.forEach(s=>{s.isTransforming=!0,s.onTransforming()}),this.selection.refresh(),this._shouldRedraw=!0}_rotateElements(){const{selectedElements:t,noParentElements:s}=this.store;this.store.isMultiSelected?(this.selection.rangeElement.isRotating=!0,this.store.updateElementsRotation([this.selection.rangeElement],this._pressMovePosition)):this.store.updateElementsRotation(s,this._pressMovePosition),t.forEach(r=>{r.isRotating=!0,r.onRotating()}),this.selection.refresh(),this._shouldRedraw=!0}_createRange(){const t=b.getBoxPoints([this._pressDownStageWorldCoord,this._pressMoveStageWorldCoord]);this.selection.setRange(t)}async _handleCursorLeave(){this.cursor.clear(),this.cursor.setStyle("default")}async _handlePressDown(t){if(this._isPressDown=!0,this.calcPressDown(t),this.isDrawerActive&&!this.store.isSelectedEqCreating())this._clearStageSelects();else if(this.isMoveableActive){const s=this._tryActiveController();if(s&&this._refreshElementsOriginals([...this.store.selectedElements,this.selection.rangeElement],{deepSubs:!0}),s instanceof nt)this.store.updateElementById(s.host.id,{isRotatingTarget:!0}),this.store.isMultiSelected?this.store.refreshElementsRotationStates([this.selection.rangeElement],this._pressDownPosition):this.store.refreshRotatingStates(this._pressDownPosition),this.elementsStatus=$.ROTATING;else if(s instanceof Ge||s instanceof st)this.elementsStatus=$.TRANSFORMING;else if(s instanceof mt)this.elementsStatus=$.CORNER_MOVING;else{const r=this.selection.getElementOnCoord(this.cursor.worldValue),n=this.store.isSelectedContainsTarget();t.ctrlKey?r&&this.store.toggleSelectElement(r):n||(this._clearStageSelects(),r&&this.store.selectElement(r))}}else this.isHandActive&&(this._originalStageWorldCoord=z.jsonClone(this.stageWorldCoord))}_refreshElementsOriginals(t,s){this.store.refreshElementsOriginalAngles(t,s),this.store.refreshElementsOriginals(t,s)}_handleArbitraryPressUp(){const t=this.store.creatingArbitraryElement(this.cursor.worldValue,!0);t!=null&&t.model.isFold&&this.commitArbitraryDrawing()}_clearStageSelects(){this.selection.clearSelects(),this.selection.setRange([])}async _handlePressUp(t){if(this._isPressDown=!1,this.calcPressUp(t),this.isArbitraryDrawing)this._isPressDown=!0,this._handleArbitraryPressUp();else if(this.isDrawerActive)this.store.finishCreatingElement();else if(this.isMoveableActive)if(this.store.isSelectedEmpty)this.selection.selectRange(),this.selection.setRange(null);else if(this.checkCursorPressUpALittle(t)){switch(this.elementsStatus){case $.MOVING:{await this._endElementsDrag();break}case $.ROTATING:{await this._endElementsRotate();break}case $.TRANSFORMING:{await this._endElementsTransform();break}case $.CORNER_MOVING:{await this._endMovingElementsCorner();break}}[$.ROTATING,$.TRANSFORMING,$.CORNER_MOVING,$.MOVING].includes(this.elementsStatus)&&this.store.isEditingEmpty&&(this.elementsStatus=$.NONE)}else!t.ctrlKey&&!t.shiftKey&&this._selectTopAElement(this.store.selectedElements);else this.isHandActive&&this._processHandCreatorMove(t);this.isArbitraryDrawing||await this._tryCreatedRedraw()}async _handleDblClick(t){this.isMoveableActive&&(this._selectTopAElement(this.store.stageElements),this.store.beginEditingElements(this.store.selectedElements),this.selection.refresh(),this._originalEditingDataList=await Promise.all(this.store.selectedElements.map(async s=>({model:await s.toOriginalTransformJson()}))))}async _tryCreatedRedraw(){await Promise.all([this.selection.refresh(),this._addRedrawTask(null,!0),this.tryEmitElementCreated()])}async _createOriginalTranslateCommand(t){const s=await Promise.all(t.map(async n=>({model:await n.toOriginalTranslateJson()}))),r=await Promise.all(t.map(async n=>({model:await n.toTranslateJson()})));this._createUpdateCommandBy(s,r)}async _endElementsDrag(){const{selectedElements:t}=this.store;await this._createOriginalTranslateCommand(t),t.forEach(s=>{s.isDragging=!1,s.onTranslateAfter()}),this.store.isMultiSelected&&(this.selection.rangeElement.isDragging=!1)}async _createOrignalRotateCommand(t){const s=await Promise.all(t.map(async n=>({model:await n.toOriginalRotateJson()}))),r=await Promise.all(t.map(async n=>({model:await n.toRotateJson()})));this._createUpdateCommandBy(s,r)}async _endElementsRotate(){const{selectedElements:t}=this.store;await this._createOrignalRotateCommand(t),t.forEach(s=>{s.isRotatingTarget=!1,s.isRotating=!1,s.onRotateAfter()}),this.store.isMultiSelected&&(this.selection.rangeElement.isRotating=!1),this.store.clearRotatingStates()}async _createOriginalTransformCommand(t){const s=await Promise.all(t.map(async n=>({model:await n.toOriginalTransformJson()}))),r=await Promise.all(t.map(async n=>({model:await n.toTransformJson()})));this._createUpdateCommandBy(s,r)}async _endElementsTransform(){const{selectedElements:t,isEditingEmpty:s}=this.store;s&&(await this._createOriginalTransformCommand(t),t.forEach(r=>{r.isTransforming=!1,r.onTransformAfter()}),this.store.isMultiSelected&&(this.selection.rangeElement.isTransforming=!1))}async _createOriginalCornerCommand(t){const s=await Promise.all(t.map(async n=>({model:await n.toOriginalCornerJson()}))),r=await Promise.all(t.map(async n=>({model:await n.toCornerJson()})));this._createUpdateCommandBy(s,r)}async _endMovingElementsCorner(){const{selectedElements:t}=this.store;await this._createOriginalCornerCommand(t),t.forEach(s=>{s.isCornerMoving=!1,s.onCornerChanged()})}_selectTopAElement(t){const s=S.getTopAElementByCoord(t,this.cursor.worldValue);this.store.deSelectElements(this.store.selectedElements.filter(r=>s&&s.isGroup?r.ancestorGroup!==s:r!==s)),s&&this.store.selectElement(s)}_processHandCreatorMove(t){this._refreshStageWorldCoord(t),this.store.refreshStageElements(),this.selection.refresh(),this._isStageMoving=!1}async _createAddedCommand(t){const s=new Eo({type:Te.ElementsAdded,dataList:await Promise.all(t.map(async r=>({model:await r.toJson()})))},this.store);this.undo.add(s)}async tryEmitElementCreated(){const t=this.store.provisionalElements;t.length&&(this.store.updateElements(t,{isProvisional:!1,isOnStage:!0}),this.emit(k.elementCreated,t),await this._createAddedCommand(t))}calcPressDown(t){this._pressDownPosition=this.cursor.transform(t),this._pressDownStageWorldCoord=S.calcWorldCoord(this._pressDownPosition)}calcPressUp(t){this._pressUpPosition=this.cursor.transform(t),this._pressUpStageWorldCoord=S.calcWorldCoord(this._pressUpPosition)}calcPressMove(t){this._pressMovePosition=this.cursor.transform(t),this._pressMoveStageWorldCoord=S.calcWorldCoord(this._pressMovePosition)}checkCursorPressMovedALittle(t){return Math.abs(this._pressMoveStageWorldCoord.x-this._pressDownStageWorldCoord.x)>=gs||Math.abs(this._pressMoveStageWorldCoord.y-this._pressDownStageWorldCoord.y)>=fs}checkCursorPressUpALittle(t){return Math.abs(this._pressUpStageWorldCoord.x-this._pressDownStageWorldCoord.x)>=gs||Math.abs(this._pressUpStageWorldCoord.y-this._pressDownStageWorldCoord.y)>=fs}async _refreshSize(){const t=this.renderEl.getBoundingClientRect();this.stageRect=t,this._updateCanvasSize(t),this.store.refreshStageElements(),this.selection.refresh(),this._shouldRedraw=!0}_updateCanvasSize(t){this.mask.updateCanvasSize(t),this.provisional.updateCanvasSize(t),this.updateCanvasSize(t)}async setCreator(t){this.currentCreator=t,this.emit(k.creatorChanged,t)}_creatingElementOnMovement(t){if(this.checkCursorPressMovedALittle(t))return this.store.creatingElement([this._pressDownStageWorldCoord,this._pressMoveStageWorldCoord])}_updatingArbitraryElementOnMovement(t){if(this.checkCursorPressMovedALittle(t))return this.store.creatingArbitraryElement(this._pressMoveStageWorldCoord,!1)}_refreshStageWorldCoord(t){const s=b.getEventPosition(t,this.stageRect,this.stageScale);this.stageWorldCoord={x:this._originalStageWorldCoord.x-(s.x-this._pressDownPosition.x),y:this._originalStageWorldCoord.y-(s.y-this._pressDownPosition.y)}}_checkScale(t){let s=P.clamp(this.stageScale+t,.02,5);return s=l.precise(s,2),this.stageScale===.02&&t>0&&(s=.1),s}async setScale(t){this.stageScale=t,J.scale=t,this.emit(k.scaleChanged,t),this.store.refreshStageElements(),this.selection.refresh(),this._shouldRedraw=!0}_handleWheelScale(t,s){const r=b.getEventPosition(s,this.stageRect,this.stageScale),n=S.calcWorldCoord(r),o=this._checkScale(t),a=(s.clientX-this.stageRect.left)/o,c=(s.clientY-this.stageRect.top)/o,h=n.x-a,d=n.y-c,g=h+this.stageRect.width/2/o,f=d+this.stageRect.height/2/o;this.stageWorldCoord={x:g,y:f},this.setScale(o)}_handleWheelMove(t){this.stageWorldCoord.x+=t.x/2/this.stageScale,this.stageWorldCoord.y+=t.y/2/this.stageScale,this.store.refreshStageElements(),this.selection.refresh(),this._shouldRedraw=!0}calcScaleAutoFitValueByBox(t){const{width:s,height:r}=b.calcRectangleSize(t);let n=l.precise(b.calcScale(this.stageRect,{width:s,height:r},ii*this.stageScale),2);return n=P.clamp(n,.02,1),n}calcScaleAutoFitValue(){const t=b.getBoxPoints(this.store.visibleElements.map(s=>s.maxOutlineBoxCoords).flat());return this.calcScaleAutoFitValueByBox(t)}calcElementAutoFitValue(t){return this.calcScaleAutoFitValueByBox(t.maxOutlineBoxCoords)}setScaleAutoFit(){if(this.store.isVisibleEmpty)this.stageWorldCoord={x:0,y:0},this.setScale(1);else{const t=l.calcCenter(this.store.visibleElements.map(s=>s.rotateOutlineCoords.flat()).flat());this.stageWorldCoord=t,this.store.refreshStageElements(),this.setScale(this.calcScaleAutoFitValue())}}setScaleReduce(){const t=this._checkScale(-.05);this.setScale(t)}setScaleIncrease(){const t=this._checkScale(.05);this.setScale(t)}setScale100(){this.setScale(1)}_handleScaleReduce(){this.setScaleReduce()}_handleScaleIncrease(){this.setScaleIncrease()}_handleScaleAutoFit(){this.setScaleAutoFit()}_handleScale100(){this.setScale100()}async _handleImagePasted(t,s){this._clearStageSelects();const r=await this.store.insertImageElement(t),n=this.calcElementAutoFitValue(r);this.stageScale>n&&await this.setScale(n),await this._createAddedCommand([r]),s&&s()}async uploadImages(t){t.length&&await this.event.onImagesUpload(t)}_createRearrangeModel(t){var s,r,n,o;return{prevId:(r=(s=t.node.prev)==null?void 0:s.value)==null?void 0:r.id,nextId:(o=(n=t.node.next)==null?void 0:n.value)==null?void 0:o.id}}async _handleSelectsDelete(){if(this.store.isSelectedEmpty)return;const t=new vo({type:Te.ElementsRemoved,dataList:await Promise.all(this.store.selectedElements.map(async s=>({model:await s.toJson(),...this._createRearrangeModel(s)})))},this.store);this.undo.add(t),this.store.deleteSelects()}selectAll(){this.store.selectAll()}_handleSelectAll(){this.selectAll()}async _handleSelectCopy(){const t=await this.store.copySelectElements(),s=JSON.stringify(t);yo.copyValueToClipboard(s)}async _handlePasteElements(t){const s=!t||t.length===0;s||this._clearStageSelects();const r=await this.store.pasteElements(t);s||this.selection.refresh(),await this._createAddedCommand(r)}_handleCancel(){this.isArbitraryDrawing?this.commitArbitraryDrawing():this.store.isEditingEmpty||this.commitEditingDrawing()}_handleSelectMoveable(){this.currentCreator.type===Yt.type&&(this.setCreator(Ae),this.cursor.updateStyle())}_handleSelectHand(){this.currentCreator.type===Ae.type&&(this.setCreator(Yt),this.cursor.updateStyle())}async _createGroupAddedDataList(t,s){const{id:r}=t;return await Promise.all(s.map(async n=>{const{id:o,model:{groupId:a}}=n;let c;const h=r===o;h?c=await n.toJson():a===r?c=await n.toGroupJson():c={id:o};const d={model:c,isGroup:h,...this._createRearrangeModel(n)};return a===r&&(d.isGroupSubject=!0),d}))}async _handleSelectGroup(){if(this.isElementsBusy||this.store.isSelectedEmpty)return;const t=await Promise.all(this.store.selectedElements.map(async r=>({model:{id:r.id},isGroupSubject:!r.isGroupSubject,...this._createRearrangeModel(r)}))),s=this.store.selectToGroup();if(s){t.push({model:{id:s.id},isGroup:!0}),this.store.selectGroup(s);const r=await this._createGroupAddedDataList(s,this.store.selectedElements),n=new wo({type:Te.GroupAdded,dataList:t,rDataList:r},this.store);this.undo.add(n)}}async _createGroupRemovedCommand(t){const s=[];await Promise.all(t.map(async n=>{s.push({model:await n.toJson(),isGroup:!0,...this._createRearrangeModel(n)}),n.subs.forEach(async o=>{s.push({model:await o.toGroupJson(),isGroup:!1})})}));const r=new bo({type:Te.GroupRemoved,dataList:s},this.store);this.undo.add(r)}async _handleSelectGroupCancel(){if(this.isElementsBusy)return;const t=this.store.getSelectedAncestorElementGroups();t.length!==0&&(await this._createGroupRemovedCommand(t),this.store.cancelGroups(t),t.forEach(s=>{s.subs.forEach(r=>{r.isSelected=!0})}))}_handleUndo(){const t=this.undo.nearestUndoCommand;t&&(t instanceof Nt||this.store.deSelectAll(),this.undo.undo(),this.selection.refresh(),this._shouldRedraw=!0,this.emit(k.selectedChanged,this.store.selectedElements))}_handleRedo(){const t=this.undo.nearestRedoCommand;t&&(t instanceof Nt||this.store.deSelectAll(),this.undo.redo(),this.selection.refresh(),this.selection.refresh(),this._shouldRedraw=!0,this.emit(k.selectedChanged,this.store.selectedElements))}async setElementsAlignLeft(t){await this._createTranslateCommand(t,async()=>{await this.align.setElementsAlignLeft(t)}),t.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAlignRight(t){await this._createTranslateCommand(t,async()=>{await this.align.setElementsAlignRight(t)}),t.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAlignTop(t){await this._createTranslateCommand(t,async()=>{await this.align.setElementsAlignTop(t)}),t.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAlignBottom(t){await this._createTranslateCommand(t,async()=>{await this.align.setElementsAlignBottom(t)}),t.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAlignCenter(t){await this._createTranslateCommand(t,async()=>{await this.align.setElementsAlignCenter(t)}),t.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAlignMiddle(t){await this._createTranslateCommand(t,async()=>{await this.align.setElementsAlignMiddle(t)}),t.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._shouldRedraw=!0}async setElementsAverageVertical(t){await this._createTranslateCommand(t,async()=>{await this.align.setElementsAverageVertical(t)}),t.forEach(s=>s.onPositionChanged()),this._shouldRedraw=!0}async setElementsAverageHorizontal(t){await this._createTranslateCommand(t,async()=>{await this.align.setElementsAverageHorizontal(t)}),t.forEach(s=>s.onPositionChanged()),this._shouldRedraw=!0}async commitArbitraryDrawing(){this.isArbitraryDrawing&&(this._isPressDown=!1,this.store.finishCreatingElement(),await this._tryCreatedRedraw())}async commitEditingDrawing(){const{isEditingEmpty:t,editingElements:s}=this.store;if(!t){const r=await Promise.all(s.map(async n=>({model:await n.toJson()})));this._createUpdateCommandBy(this._originalEditingDataList,r),this.store.endEditingElements(s),this.selection.refresh(),this.elementsStatus=$.NONE,this._originalEditingDataList=null}}async _createRearrangeCommand(t,s){const r=await Promise.all(t.map(async a=>({model:{id:a.id},...this._createRearrangeModel(a)})));await s();const n=await Promise.all(t.map(async a=>({model:{id:a.id},...this._createRearrangeModel(a)}))),o=new So({type:Te.ElementsRearranged,dataList:r,rDataList:n},this.store);this.undo.add(o)}async setElementsGoDown(t){await this._createRearrangeCommand(t,async()=>{await this.store.setElementsGoDown(t)}),t.forEach(s=>s.onLayerChanged()),this._shouldRedraw=!0}async setElementsShiftMove(t){await this._createRearrangeCommand(t,async()=>{await this.store.setElementsShiftMove(t)}),t.forEach(s=>s.onLayerChanged()),this._shouldRedraw=!0}}const O=new xo,Ao=new mn;O.configure.config({rotationIconEnable:!0});const ee=200,Ts={position:{x:0,y:0},width:0,height:0,angle:0,corners:[...tt.corners],flipX:!1,leanYAngle:0,scale:1,strokes:[{...St}],fills:[{...xt}],fontSize:et.fontSize,fontFamily:et.fontFamily,textAlign:et.textAlign,textBaseline:et.textBaseline,isRatioLocked:!1},fe=$s("stage",{state:()=>({currentCreator:Ae,currentCursorCreator:Ae,currentShapeCreator:ss,currentArbitraryCreator:rs,selectedElements:[],targetElements:[],isMultiSelected:!1,primarySelectedElement:null,layerShiftMoveEnable:!1,layerGoDownEnable:!1,...z.jsonClone(Ts)}),getters:{inputDisabled(){return!this.primarySelectedElement},alignEnable(){var i;return((i=this.selectedElements)==null?void 0:i.length)>=2},averageEnable(){var i;return((i=this.selectedElements)==null?void 0:i.length)>=3},arbitraryVisible(){var i;return((i=this.currentCreator)==null?void 0:i.type)===A.arbitrary}},actions:{async init(i){await Ao.init(i.containerEl),await O.init(i.shieldEl),this.setCreator(Ae),O.on(k.elementCreated,this.onElementCreated),O.on(k.selectedChanged,this.onSelectedChanged),O.on(k.targetChanged,this.onTargetChanged),O.on(k.multiSelectedChanged,this.onMultiSelectedChanged.bind(this)),O.on(k.primarySelectedChanged,this.onPrimarySelectedChanged.bind(this)),O.on(k.positionChanged,P.throttle(this.onPositionChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(k.widthChanged,P.throttle(this.onWidthChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(k.heightChanged,P.throttle(this.onHeightChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(k.angleChanged,P.throttle(this.onAngleChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(k.cornersChanged,P.throttle(this.onCornersChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(k.flipXChanged,P.throttle(this.onFlipXChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(k.leanYAngleChanged,P.throttle(this.onLeanYAngleChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(k.scaleChanged,P.throttle(this.onScaleChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(k.strokesChanged,P.throttle(this.onStrokesChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(k.fillsChanged,P.throttle(this.onFillsChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(k.fontSizeChanged,P.throttle(this.onFontSizeChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(k.fontFamilyChanged,P.throttle(this.onFontFamilyChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(k.textAlignChanged,P.throttle(this.onTextAlignChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(k.textBaselineChanged,P.throttle(this.onTextBaselineChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(k.ratioLockedChanged,P.throttle(this.onRatioLockedChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(k.creatorChanged,P.throttle(this.onCreatorChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(k.layerShiftMoveEnableChanged,P.throttle(this.onLayerShiftMoveEnableChanged.bind(this),ee,{leading:!0,trailing:!0})),O.on(k.layerGoDownEnableChanged,P.throttle(this.onLayerGoDownEnableChanged.bind(this),ee,{leading:!0,trailing:!0}))},async setCreator(i){await O.setCreator(i)},onCreatorChanged(i){this.currentCreator=i,i.category===re.cursor&&(this.currentCursorCreator=i),i.category===re.shapes&&(this.currentShapeCreator=i),i.category===re.freedom&&(this.currentArbitraryCreator=i)},onMultiSelectedChanged(i){this.isMultiSelected=i},onPrimarySelectedChanged(i){this.primarySelectedElement=i},onElementCreated(i){this.setCreator(Ae),i.length&&this.onElementChanged(i[0])},onSelectedChanged(i){if(this.selectedElements=i,this.selectedElements.length){const e=S.getAncestorGroup(this.selectedElements);if(!e){Object.assign(this,z.jsonClone(Ts));return}this.onElementChanged(e)}},onElementChanged(i){if(!i)return;const{position:e,width:t,height:s,angle:r,corners:n,flipX:o,leanYAngle:a,strokes:c,fills:h,fontSize:d,fontFamily:g,textAlign:f,textBaseline:C,isRatioLocked:p}=i;this.onPositionChanged(i,e),this.onWidthChanged(i,t),this.onHeightChanged(i,s),this.onAngleChanged(i,r),this.onCornersChanged(i,n),this.onFlipXChanged(i,o),this.onLeanYAngleChanged(i,a),this.onStrokesChanged(i,c),this.onFillsChanged(i,h),this.onFontSizeChanged(i,d),this.onFontFamilyChanged(i,g),this.onTextAlignChanged(i,f),this.onTextBaselineChanged(i,C),this.onRatioLockedChanged(i,p)},onTargetChanged(i){this.targetElements=i},onPositionChanged(i,e){e&&(this.position={x:e.x,y:e.y})},onWidthChanged(i,e){this.width=e},onHeightChanged(i,e){this.height=e},onAngleChanged(i,e){this.angle=e},onCornersChanged(i,e){this.corners=[...e]},onFlipXChanged(i,e){this.flipX=e},onLeanYAngleChanged(i,e){this.leanYAngle=e},onScaleChanged(i){this.scale=i},onStrokesChanged(i,e=[]){this.strokes=z.jsonClone(e)},onFillsChanged(i,e=[]){this.fills=z.jsonClone(e)},onFontSizeChanged(i,e){this.fontSize=e},onFontFamilyChanged(i,e){this.fontFamily=e},onTextAlignChanged(i,e){this.textAlign=e},onTextBaselineChanged(i,e){this.textBaseline=e},onRatioLockedChanged(i,e){this.isRatioLocked=e},onLayerShiftMoveEnableChanged(i){this.layerShiftMoveEnable=i},onLayerGoDownEnableChanged(i){this.layerGoDownEnable=i},setElementsPosition(i){O.setElementsPosition(G(this.selectedElements),i)},setElementsWidth(i){O.setElementsWidth(G(this.selectedElements),i)},setElementsHeight(i){O.setElementsHeight(G(this.selectedElements),i)},setElementsAngle(i){O.setElementsAngle(G(this.selectedElements),i)},setElementsCorners(i,e){O.setElementsCorners(G(this.selectedElements),i,e)},setElementsLeanYAngle(i){O.setElementsLeanYAngle(G(this.selectedElements),i)},setElementsStrokeType(i,e){O.setElementsStrokeType(G(this.selectedElements),i,e)},setElementsStrokeWidth(i,e){O.setElementsStrokeWidth(G(this.selectedElements),i,e)},setElementsStrokeColor(i,e){O.setElementsStrokeColor(G(this.selectedElements),i,e)},setElementsStrokeColorOpacity(i,e){O.setElementsStrokeColorOpacity(G(this.selectedElements),i,e)},addElementsStroke(i){O.addElementsStroke(G(this.selectedElements),i)},removeElementsStroke(i){O.removeElementsStroke(G(this.selectedElements),i)},setElementsFillColor(i,e){O.setElementsFillColor(G(this.selectedElements),i,e)},setElementsFillColorOpacity(i,e){O.setElementsFillColorOpacity(G(this.selectedElements),i,e)},addElementsFill(i){O.addElementsFill(G(this.selectedElements),i)},removeElementsFill(i){O.removeElementsFill(G(this.selectedElements),i)},setElementsTextAlign(i){O.setElementsTextAlign(G(this.selectedElements),i)},setElementsTextBaseline(i){O.setElementsTextBaseline(G(this.selectedElements),i)},setElementsFontSize(i){O.setElementsFontSize(G(this.selectedElements),i)},setElementsFontFamily(i){O.setElementsFontFamily(G(this.selectedElements),i)},setScale(i){O.setScale(i)},setScaleAutoFit(){O.setScaleAutoFit()},setScaleIncrease(){O.setScaleIncrease()},setScaleReduce(){O.setScaleReduce()},setRatioLocked(i){O.setElementsRatioLocked(G(this.selectedElements),i)},setElementsAlignLeft(){this.alignEnable&&O.setElementsAlignLeft(G(this.selectedElements))},setElementsAlignCenter(){this.alignEnable&&O.setElementsAlignCenter(G(this.selectedElements))},setElementsAlignRight(){this.alignEnable&&O.setElementsAlignRight(G(this.selectedElements))},setElementsAlignTop(){this.alignEnable&&O.setElementsAlignTop(G(this.selectedElements))},setElementsAlignMiddle(){this.alignEnable&&O.setElementsAlignMiddle(G(this.selectedElements))},setElementsAlignBottom(){this.alignEnable&&O.setElementsAlignBottom(G(this.selectedElements))},setElementsAverageVertical(){this.averageEnable&&O.setElementsAverageVertical(G(this.selectedElements))},setElementsAverageHorizontal(){this.averageEnable&&O.setElementsAverageHorizontal(G(this.selectedElements))},setElementsGoDown(){this.layerGoDownEnable&&O.setElementsGoDown(G(this.selectedElements))},setElementsShiftMove(){this.layerShiftMoveEnable&&O.setElementsShiftMove(G(this.selectedElements))},uploadImages(i){i.length&&O.uploadImages(i)},commitArbitraryDrawing(){O.commitArbitraryDrawing()}}}),Po={class:"tool-dropdown"},Ro=ae({__name:"CreatorDropdown",props:{creators:Array,currentCreator:Object,select:Function},setup(i){const e=fe(),t=se([]),s=P.debounce(async()=>{e.uploadImages(t.value),t.value=[]},500),r=n=>(t.value.push(n),s(),!1);return(n,o)=>{const a=ye,c=fn,h=Ur,d=qs,g=Js,f=Xs;return N(),me(f,null,{dropdown:F(()=>[R(g,null,{default:F(()=>[(N(!0),H(Be,null,je(i.creators,C=>(N(),me(d,{key:C.type,class:Q([{selected:C.type===i.currentCreator.type}]),onClick:p=>i.select(C)},{default:F(()=>[C.type===w(A).image?(N(),me(h,{key:0,action:"",multiple:"",accept:"image/*","before-upload":r},{default:F(()=>[R(c,{creator:C},null,8,["creator"])]),_:2},1024)):(N(),me(c,{key:1,creator:C},null,8,["creator"]))]),_:2},1032,["class","onClick"]))),128))]),_:1})]),default:F(()=>[L("div",Po,[R(a,{class:"icon-verbise-arrow_down iconfont"})])]),_:1})}}}),he=(i,e)=>{const t=i.__vccOpts||i;for(const[s,r]of e)t[s]=r;return t},To=he(Ro,[["__scopeId","data-v-1f27b774"]]),ko={class:"create-bar"},Oo=ae({__name:"CreatorBar",emits:["select"],setup(i,{emit:e}){const t=e,s=fe(),r=at(()=>s.currentCreator),n=at(()=>s.currentCursorCreator),o=at(()=>s.currentShapeCreator),a=at(()=>s.currentArbitraryCreator),c=h=>{t("select",h)};return(h,d)=>{const g=ye,f=To;return N(),H("div",ko,[L("div",{class:Q(["tool-item",{selected:n.value.category===r.value.category}]),onClick:d[0]||(d[0]=C=>c(n.value))},[R(g,{class:Q(["iconfont",n.value.icon])},null,8,["class"])],2),R(f,{creators:w(sr),"current-creator":r.value,select:c},null,8,["creators","current-creator"]),L("div",{class:Q(["tool-item",{selected:o.value.category===r.value.category}]),onClick:d[1]||(d[1]=C=>c(o.value))},[R(g,{class:Q(["iconfont",o.value.icon])},null,8,["class"])],2),R(f,{creators:w(rr),"current-creator":r.value,select:c},null,8,["creators","current-creator"]),L("div",{class:Q(["tool-item",{selected:a.value.category===r.value.category}]),onClick:d[2]||(d[2]=C=>c(a.value))},[R(g,{class:Q(["iconfont",a.value.icon])},null,8,["class"])],2),R(f,{creators:w(nr),"current-creator":r.value,select:c},null,8,["creators","current-creator"])])}}}),Io={class:"arbitrary-bar"},Bo={class:"tool-item"},Lo=ae({__name:"ArbitraryBar",setup(i){const e=fe();return(t,s)=>{const r=ye;return vt((N(),H("div",Io,[L("div",Bo,[R(r,{onClick:w(e).commitArbitraryDrawing},{default:F(()=>[R(w(Kr))]),_:1},8,["onClick"])])],512)),[[wt,w(e).arbitraryVisible]])}}}),Mo=he(Lo,[["__scopeId","data-v-dc2ef5a8"]]),Fo={class:"stage-shield"},Do=ae({__name:"shield",setup(i,{expose:e}){let t;return e({init:async()=>new Promise(r=>{t=r,t()})}),(r,n)=>(N(),H("div",Fo))}}),No=ae({__name:"container",setup(i){const e=fe(),t=se(null),s=se(),r=n=>{const{type:o}=n;o!==A.image&&e.setCreator(n)};return Hr(async()=>{s.value&&await s.value.init(),await e.init({containerEl:t.value,shieldEl:s.value.$el})}),(n,o)=>{const a=Mo,c=Oo;return N(),H("div",{class:"stage-container",ref_key:"stageRef",ref:t},[R(Do,{ref_key:"stageShieldRef",ref:s},null,512),R(a),R(c,{onSelect:r})],512)}}}),Wo=he(No,[["__scopeId","data-v-a64de043"]]),Vo={class:Q(["layer-props right-props"])},zo={class:"layer-props__row"},jo=ae({__name:"LayerProps",setup(i){const e=fe();return(t,s)=>{const r=ye;return N(),H("div",Vo,[s[0]||(s[0]=L("div",{class:"layer-props__title"},[L("span",{class:"layer-props__title-text"},"层级")],-1)),L("div",zo,[R(r,{class:Q(["iconfont","icon-verbise-layer-go-down",{disabled:!w(e).layerGoDownEnable}]),onClick:w(e).setElementsGoDown,title:"下移"},null,8,["class","onClick"]),R(r,{class:Q(["iconfont","icon-verbise-layer-shift-move",{disabled:!w(e).layerShiftMoveEnable}]),onClick:w(e).setElementsShiftMove,title:"上移"},null,8,["class","onClick"])])])}}}),Go=he(jo,[["__scopeId","data-v-a63d4953"]]),Ho={class:"stroke-props right-props"},Yo={class:"stroke-props__title"},$o={class:"stroke-props__row color"},qo={class:"stroke-props__row-item"},Jo={class:"stroke-props__row-item"},Xo={class:"stroke-props__row"},Uo={class:"stroke-props__row-item"},Ko={class:"stroke-props__row-item"},Qo=ae({__name:"StrokeProps",setup(i){const e=se(),t=fe(),s=se([{...St}]);Se(()=>t.strokes,o=>{s.value=o});const r=se([]);Se(()=>{var o;return(o=t.primarySelectedElement)==null?void 0:o.model.type},o=>{r.value=vn(o)});const n=()=>{e.value.show()};return(o,a)=>{var p;const c=ye,h=Qs,d=Zs,g=Ye,f=Qr,C=Zr;return vt((N(),H("div",Ho,[L("div",Yo,[a[1]||(a[1]=L("span",{class:"stroke-props__title-text"},"描边",-1)),R(c,null,{default:F(()=>[R(w(Us),{onClick:a[0]||(a[0]=_=>w(t).addElementsStroke(s.value.length-1))})]),_:1})]),(N(!0),H(Be,null,je(s.value,(_,v)=>{var V;return N(),H("div",{key:v},[L("div",$o,[L("div",qo,[R(h,{modelValue:_.color,"onUpdate:modelValue":M=>_.color=M,onChange:M=>w(t).setElementsStrokeColor(M,v),ref_for:!0,ref_key:"colorPickerRef",ref:e,disabled:w(t).inputDisabled},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),R(d,{type:"info",onClick:n},{default:F(()=>[K(Oe(_.color),1)]),_:2},1024)]),L("div",Jo,[R(g,{modelValue:_.colorOpacity,"onUpdate:modelValue":M=>_.colorOpacity=M,placeholder:"输入数字",type:"number",min:"0",max:"1",precision:"1",onChange:M=>w(t).setElementsStrokeColorOpacity(Number(M),v),disabled:w(t).inputDisabled},{prepend:F(()=>a[2]||(a[2]=[K("O")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"])]),R(c,null,{default:F(()=>[s.value.length>1?(N(),me(w(Ks),{key:0,onClick:M=>w(t).removeElementsStroke(v)},null,8,["onClick"])):ze("",!0)]),_:2},1024)]),L("div",Xo,[L("div",Uo,[R(C,{modelValue:_.type,"onUpdate:modelValue":M=>_.type=M,placeholder:"描边类型",size:"small",onChange:M=>w(t).setElementsStrokeType(M,v),disabled:w(t).inputDisabled},{default:F(()=>[(N(!0),H(Be,null,je(r.value,M=>(N(),me(f,{key:M.type,label:M.name,value:M.type},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"])]),L("div",Ko,[R(g,{modelValue:_.width,"onUpdate:modelValue":M=>_.width=M,placeholder:"输入数字",type:"number",precision:"1",min:((V=w(t).primarySelectedElement)==null?void 0:V.model.type)===w(A).line?1:0,onChange:M=>w(t).setElementsStrokeWidth(Number(M),v),disabled:w(t).inputDisabled},{prepend:F(()=>a[3]||(a[3]=[K("S")])),append:F(()=>a[4]||(a[4]=[K("px")])),_:2},1032,["modelValue","onUpdate:modelValue","min","onChange","disabled"])])])])}),128))],512)),[[wt,(p=w(t).primarySelectedElement)==null?void 0:p.strokeEnable]])}}}),Zo=he(Qo,[["__scopeId","data-v-168aab7f"]]),ea={class:"fill-props right-props"},ta={class:"fill-props__title"},sa={class:"fill-props__row color"},ra={class:"fill-props__row-item"},na={class:"fill-props__row-item"},ia=ae({__name:"FillProps",setup(i){const e=se(),t=fe(),s=se([{...xt}]);Se(()=>t.fills,n=>{s.value=n});const r=()=>{e.value.show()};return(n,o)=>{var g;const a=ye,c=Qs,h=Zs,d=Ye;return vt((N(),H("div",ea,[L("div",ta,[o[1]||(o[1]=L("span",{class:"fill-props__title-text"},"填充",-1)),R(a,null,{default:F(()=>[R(w(Us),{onClick:o[0]||(o[0]=f=>w(t).addElementsFill(s.value.length-1))})]),_:1})]),(N(!0),H(Be,null,je(s.value,(f,C)=>(N(),H("div",{key:C},[L("div",sa,[L("div",ra,[R(c,{modelValue:f.color,"onUpdate:modelValue":p=>f.color=p,onChange:p=>w(t).setElementsFillColor(p,C),ref_for:!0,ref_key:"colorPickerRef",ref:e,disabled:w(t).inputDisabled},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),R(h,{type:"info",onClick:r},{default:F(()=>[K(Oe(f.color),1)]),_:2},1024)]),L("div",na,[R(d,{modelValue:f.colorOpacity,"onUpdate:modelValue":p=>f.colorOpacity=p,placeholder:"输入数字",type:"number",min:"0",max:"1",precision:"1",onChange:p=>w(t).setElementsFillColorOpacity(Number(p),C),disabled:w(t).inputDisabled},{prepend:F(()=>o[2]||(o[2]=[K("O")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"])]),R(a,null,{default:F(()=>[s.value.length>1?(N(),me(w(Ks),{key:0,onClick:p=>w(t).removeElementsFill(C)},null,8,["onClick"])):ze("",!0)]),_:2},1024)])]))),128))],512)),[[wt,(g=w(t).primarySelectedElement)==null?void 0:g.fillEnabled]])}}}),oa=he(ia,[["__scopeId","data-v-fe653b46"]]),aa={class:"corners-props right-props"},la={class:"corners-props__row"},ca={class:"corners-props__row-item"},ha={class:"corners-props__row"},da=ae({__name:"CornerProps",setup(i){const e=fe(),t=se(tt.corners),s=se(0),r=se(!1);return Se(()=>e.corners,n=>{t.value=n;const o=P.uniq(t.value);o.length===1?(r.value=!0,s.value=o[0]):(r.value=!1,s.value=0)}),(n,o)=>{var c,h;const a=Ye;return vt((N(),H("div",aa,[o[4]||(o[4]=L("div",{class:"corners-props__title"},[L("span",{class:"corners-props__title-text"},"圆角")],-1)),L("div",la,[L("div",ca,[R(a,{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=d=>s.value=d),placeholder:"输入数字",disabled:w(e).inputDisabled||!r.value,type:"number",min:"0",max:((c=w(e).primarySelectedElement)==null?void 0:c.minParallelogramVerticalSize)/2,precision:"1",onChange:o[1]||(o[1]=d=>w(e).setElementsCorners(Number(d)))},{prepend:F(()=>o[2]||(o[2]=[K("C")])),append:F(()=>o[3]||(o[3]=[K("px")])),_:1},8,["modelValue","disabled","max"])])]),L("div",ha,[(N(!0),H(Be,null,je(t.value,(d,g)=>{var f;return N(),H("div",{class:"corners-props__row-item",key:g},[R(a,{modelValue:t.value[g],"onUpdate:modelValue":C=>t.value[g]=C,placeholder:"输入数字",disabled:w(e).inputDisabled,type:"number",min:"0",max:((f=w(e).primarySelectedElement)==null?void 0:f.minParallelogramVerticalSize)/2,precision:"1",onChange:C=>w(e).setElementsCorners(Number(C),g)},null,8,["modelValue","onUpdate:modelValue","disabled","max","onChange"])])}),128))])],512)),[[wt,(h=w(e).primarySelectedElement)==null?void 0:h.cornersModifyEnable]])}}}),ua=he(da,[["__scopeId","data-v-84bd0b46"]]),ga={class:"angle-props right-props"},fa={class:"angle-props__title"},ma={class:"angle-props__row"},pa={class:"angle-props__row-item"},Ca={key:0,class:"angle-props__row-item"},ya=ae({__name:"AngleProps",setup(i){const e=fe(),t=se(0),s=se(0);Se(()=>e.angle,o=>{t.value=l.precise(o,1)}),Se(()=>e.leanYAngle,o=>{s.value=l.precise(o,1)});function r(o){let a=Number(o);a>180&&(a=180-a),a<-180&&(a=-180-a),e.setElementsAngle(a)}function n(o){let a=Number(o);a=P.clamp(a,-89,89),e.setElementsLeanYAngle(a)}return(o,a)=>{var d;const c=ye,h=Ye;return N(),H("div",ga,[L("div",fa,[a[2]||(a[2]=L("span",{class:"angle-props__title-text"},"角度",-1)),w(e).flipX?(N(),me(c,{key:0,class:Q(["iconfont","icon-verbise-flip-horizontal"])})):ze("",!0)]),L("div",ma,[L("div",pa,[R(h,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=g=>t.value=g),placeholder:"输入数字",disabled:w(e).inputDisabled,type:"number",min:"-180",max:"180",precision:"1",onChange:r},{prepend:F(()=>a[3]||(a[3]=[K("A")])),append:F(()=>a[4]||(a[4]=[K("°")])),_:1},8,["modelValue","disabled"])]),(d=w(e).primarySelectedElement)!=null&&d.leanYAngleModifyEnable?(N(),H("div",Ca,[R(h,{modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=g=>s.value=g),placeholder:"输入数字",disabled:w(e).inputDisabled,type:"number",min:"-89",max:"89",precision:"1",onChange:n},{prepend:F(()=>a[5]||(a[5]=[K("LY")])),append:F(()=>a[6]||(a[6]=[K("°")])),_:1},8,["modelValue","disabled"])])):ze("",!0)])])}}}),_a={class:"size-props right-props"},Ea={class:"size-props__row"},va={class:"angle-props__row-item"},wa={class:"angle-props__row-item"},ba=ae({__name:"SizeProps",setup(i){const e=fe(),t=se(0),s=se(0);return Se(()=>e.width,r=>{t.value=l.precise(r,1)}),Se(()=>e.height,r=>{s.value=l.precise(r,1)}),(r,n)=>{var c;const o=Ye,a=ye;return N(),H("div",_a,[n[10]||(n[10]=L("div",{class:"size-props__title"},[L("span",{class:"size-props__title-text"},"尺寸")],-1)),L("div",Ea,[L("div",va,[R(o,{modelValue:t.value,"onUpdate:modelValue":n[0]||(n[0]=h=>t.value=h),placeholder:"输入数字",disabled:w(e).inputDisabled,min:"2",type:"number",precision:"1",onChange:n[1]||(n[1]=h=>w(e).setElementsWidth(Number(h)))},{prepend:F(()=>n[6]||(n[6]=[K("W")])),append:F(()=>n[7]||(n[7]=[K("px")])),_:1},8,["modelValue","disabled"])]),L("div",wa,[R(o,{modelValue:s.value,"onUpdate:modelValue":n[2]||(n[2]=h=>s.value=h),placeholder:"输入数字",disabled:w(e).inputDisabled||!((c=w(e).primarySelectedElement)!=null&&c.heightModifyEnable),min:"2",type:"number",precision:"1",onChange:n[3]||(n[3]=h=>w(e).setElementsHeight(Number(h)))},{prepend:F(()=>n[8]||(n[8]=[K("H")])),append:F(()=>n[9]||(n[9]=[K("px")])),_:1},8,["modelValue","disabled"])]),w(e).primarySelectedElement&&w(e).primarySelectedElement.ratioLockedEnable?(N(),me(a,{key:0},{default:F(()=>[w(e).isRatioLocked?(N(),me(w(tn),{key:1,onClick:n[5]||(n[5]=h=>w(e).setRatioLocked(!1)),title:"解除宽高比锁定"})):(N(),me(w(en),{key:0,onClick:n[4]||(n[4]=h=>w(e).setRatioLocked(!0)),title:"锁定宽高比"}))]),_:1})):ze("",!0)])])}}}),Sa=he(ba,[["__scopeId","data-v-48fc6838"]]),xa={class:"position-props right-props"},Aa={class:"position-props__row"},Pa={class:"angle-props__row-item"},Ra={class:"angle-props__row-item"},Ta=ae({__name:"PositionProps",setup(i){const e=fe(),t=se(0),s=se(0);return Se(()=>e.position,r=>{r&&(t.value=l.precise(r.x),s.value=l.precise(r.y))}),(r,n)=>{const o=Ye;return N(),H("div",xa,[n[8]||(n[8]=L("div",{class:"position-props__title"},"坐标",-1)),L("div",Aa,[L("div",Pa,[R(o,{modelValue:t.value,"onUpdate:modelValue":n[0]||(n[0]=a=>t.value=a),placeholder:"输入数字",disabled:w(e).inputDisabled,type:"number",precision:"1",onChange:n[1]||(n[1]=a=>w(e).setElementsPosition({x:Number(a),y:s.value}))},{prepend:F(()=>n[4]||(n[4]=[K("X")])),append:F(()=>n[5]||(n[5]=[K("px")])),_:1},8,["modelValue","disabled"])]),L("div",Ra,[R(o,{modelValue:s.value,"onUpdate:modelValue":n[2]||(n[2]=a=>s.value=a),placeholder:"输入数字",disabled:w(e).inputDisabled,type:"number",precision:"1",onChange:n[3]||(n[3]=a=>w(e).setElementsPosition({x:t.value,y:Number(a)}))},{prepend:F(()=>n[6]||(n[6]=[K("Y")])),append:F(()=>n[7]||(n[7]=[K("px")])),_:1},8,["modelValue","disabled"])])])])}}}),ka={class:Q(["align-props right-props"])},Oa={class:"align-props__title"},Ia={class:"align-props__row"},Ba=ae({__name:"AlignProps",setup(i){const e=fe();return(t,s)=>{const r=ye;return N(),H("div",ka,[L("div",Oa,[s[0]||(s[0]=L("span",{class:"align-props__title-text"},"对齐",-1)),R(r,{title:"按住shift支持组件外轮廓对齐操作"},{default:F(()=>[R(w(sn))]),_:1})]),L("div",Ia,[R(r,{class:Q(["iconfont","icon-verbise-align-left",{disabled:!w(e).alignEnable}]),onClick:w(e).setElementsAlignLeft},null,8,["class","onClick"]),R(r,{class:Q(["iconfont","icon-verbise-align-horizontal-center",{disabled:!w(e).alignEnable}]),onClick:w(e).setElementsAlignCenter},null,8,["class","onClick"]),R(r,{class:Q(["iconfont","icon-verbise-align-right",{disabled:!w(e).alignEnable}]),onClick:w(e).setElementsAlignRight},null,8,["class","onClick"]),R(r,{class:Q(["iconfont","icon-verbise-align-top",{disabled:!w(e).alignEnable}]),onClick:w(e).setElementsAlignTop},null,8,["class","onClick"]),R(r,{class:Q(["iconfont","icon-verbise-align-vertical-center",{disabled:!w(e).alignEnable}]),onClick:w(e).setElementsAlignMiddle},null,8,["class","onClick"]),R(r,{class:Q(["iconfont","icon-verbise-align-bottom",{disabled:!w(e).alignEnable}]),onClick:w(e).setElementsAlignBottom},null,8,["class","onClick"]),R(r,{class:Q(["iconfont","icon-verbise-average-h",{disabled:!w(e).averageEnable}]),onClick:w(e).setElementsAverageHorizontal},null,8,["class","onClick"]),R(r,{class:Q(["iconfont","icon-verbise-average-v",{disabled:!w(e).averageEnable}]),onClick:w(e).setElementsAverageVertical},null,8,["class","onClick"])])])}}}),La=he(Ba,[["__scopeId","data-v-f3535776"]]),Ma={class:"scale-setting"},Fa={class:"scale-setting__item factor"},Da={class:"el-dropdown-link"},Na=ae({__name:"ScaleSetting",setup(i){const e=fe();return(t,s)=>{const r=ye,n=qs,o=nn,a=Js,c=Xs;return N(),H("div",Ma,[L("div",Fa,[R(c,{trigger:"click","popper-class":"scale-setting__dropdown","hide-on-click":!1},{dropdown:F(()=>[R(a,null,{default:F(()=>[R(n,{onClick:w(e).setScaleAutoFit},{default:F(()=>s[0]||(s[0]=[L("span",null,"自适应缩放",-1),L("span",null,"shift + 1",-1)])),_:1},8,["onClick"]),R(n,{onClick:w(e).setScaleReduce},{default:F(()=>s[1]||(s[1]=[L("span",null,"缩小",-1),L("span",null,"ctrl + -",-1)])),_:1},8,["onClick"]),R(n,{onClick:w(e).setScaleIncrease},{default:F(()=>s[2]||(s[2]=[L("span",null,"放大",-1),L("span",null,"ctrl + +",-1)])),_:1},8,["onClick"]),R(o,null,{default:F(()=>s[3]||(s[3]=[K("预置缩放")])),_:1}),(N(!0),H(Be,null,je(w(ni),h=>(N(),me(n,{key:h,onClick:d=>w(e).setScale(h)},{default:F(()=>[L("span",null,"缩放"+Oe(w(l).precise(h*100,0)+"%"),1),L("span",null,Oe(h===1?"ctrl + 0":""),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:F(()=>[L("span",Da,[K(Oe(w(l).precise(w(e).scale*100,0)+"%")+" ",1),R(r,{class:"el-icon--right"},{default:F(()=>[R(w(rn))]),_:1})])]),_:1})])])}}}),Wa=he(Na,[["__scopeId","data-v-ec040534"]]),Va={},za={class:"props-right-panel"};function ja(i,e){const t=Wa,s=La,r=Ta,n=Sa,o=ya,a=ua,c=oa,h=Zo,d=Go;return N(),H("div",za,[R(t),R(s),R(r),R(n),R(o),R(a),R(c),R(h),R(d)])}const Ga=he(Va,[["render",ja],["__scopeId","data-v-d0f46be5"]]),Ha={},Ya={class:"right-bar"};function $a(i,e){const t=Ga;return N(),H("div",Ya,[R(t)])}const qa=he(Ha,[["render",$a],["__scopeId","data-v-910cfe36"]]),Ja={},Xa={class:"left-bar"};function Ua(i,e){return N(),H("div",Xa)}const Ka=he(Ja,[["render",Ua],["__scopeId","data-v-5cc81779"]]);function pr(i,e){return function(){return i.apply(e,arguments)}}const{toString:Qa}=Object.prototype,{getPrototypeOf:ls}=Object,Pt=(i=>e=>{const t=Qa.call(e);return i[t]||(i[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),_e=i=>(i=i.toLowerCase(),e=>Pt(e)===i),Rt=i=>e=>typeof e===i,{isArray:Je}=Array,rt=Rt("undefined");function Za(i){return i!==null&&!rt(i)&&i.constructor!==null&&!rt(i.constructor)&&ge(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const Cr=_e("ArrayBuffer");function el(i){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(i):e=i&&i.buffer&&Cr(i.buffer),e}const tl=Rt("string"),ge=Rt("function"),yr=Rt("number"),Tt=i=>i!==null&&typeof i=="object",sl=i=>i===!0||i===!1,ht=i=>{if(Pt(i)!=="object")return!1;const e=ls(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},rl=_e("Date"),nl=_e("File"),il=_e("Blob"),ol=_e("FileList"),al=i=>Tt(i)&&ge(i.pipe),ll=i=>{let e;return i&&(typeof FormData=="function"&&i instanceof FormData||ge(i.append)&&((e=Pt(i))==="formdata"||e==="object"&&ge(i.toString)&&i.toString()==="[object FormData]"))},cl=_e("URLSearchParams"),[hl,dl,ul,gl]=["ReadableStream","Request","Response","Headers"].map(_e),fl=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function it(i,e,{allOwnKeys:t=!1}={}){if(i===null||typeof i>"u")return;let s,r;if(typeof i!="object"&&(i=[i]),Je(i))for(s=0,r=i.length;s<r;s++)e.call(null,i[s],s,i);else{const n=t?Object.getOwnPropertyNames(i):Object.keys(i),o=n.length;let a;for(s=0;s<o;s++)a=n[s],e.call(null,i[a],a,i)}}function _r(i,e){e=e.toLowerCase();const t=Object.keys(i);let s=t.length,r;for(;s-- >0;)if(r=t[s],e===r.toLowerCase())return r;return null}const ke=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Er=i=>!rt(i)&&i!==ke;function Jt(){const{caseless:i}=Er(this)&&this||{},e={},t=(s,r)=>{const n=i&&_r(e,r)||r;ht(e[n])&&ht(s)?e[n]=Jt(e[n],s):ht(s)?e[n]=Jt({},s):Je(s)?e[n]=s.slice():e[n]=s};for(let s=0,r=arguments.length;s<r;s++)arguments[s]&&it(arguments[s],t);return e}const ml=(i,e,t,{allOwnKeys:s}={})=>(it(e,(r,n)=>{t&&ge(r)?i[n]=pr(r,t):i[n]=r},{allOwnKeys:s}),i),pl=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),Cl=(i,e,t,s)=>{i.prototype=Object.create(e.prototype,s),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:e.prototype}),t&&Object.assign(i.prototype,t)},yl=(i,e,t,s)=>{let r,n,o;const a={};if(e=e||{},i==null)return e;do{for(r=Object.getOwnPropertyNames(i),n=r.length;n-- >0;)o=r[n],(!s||s(o,i,e))&&!a[o]&&(e[o]=i[o],a[o]=!0);i=t!==!1&&ls(i)}while(i&&(!t||t(i,e))&&i!==Object.prototype);return e},_l=(i,e,t)=>{i=String(i),(t===void 0||t>i.length)&&(t=i.length),t-=e.length;const s=i.indexOf(e,t);return s!==-1&&s===t},El=i=>{if(!i)return null;if(Je(i))return i;let e=i.length;if(!yr(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=i[e];return t},vl=(i=>e=>i&&e instanceof i)(typeof Uint8Array<"u"&&ls(Uint8Array)),wl=(i,e)=>{const s=(i&&i[Symbol.iterator]).call(i);let r;for(;(r=s.next())&&!r.done;){const n=r.value;e.call(i,n[0],n[1])}},bl=(i,e)=>{let t;const s=[];for(;(t=i.exec(e))!==null;)s.push(t);return s},Sl=_e("HTMLFormElement"),xl=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,r){return s.toUpperCase()+r}),ks=(({hasOwnProperty:i})=>(e,t)=>i.call(e,t))(Object.prototype),Al=_e("RegExp"),vr=(i,e)=>{const t=Object.getOwnPropertyDescriptors(i),s={};it(t,(r,n)=>{let o;(o=e(r,n,i))!==!1&&(s[n]=o||r)}),Object.defineProperties(i,s)},Pl=i=>{vr(i,(e,t)=>{if(ge(i)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=i[t];if(ge(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Rl=(i,e)=>{const t={},s=r=>{r.forEach(n=>{t[n]=!0})};return Je(i)?s(i):s(String(i).split(e)),t},Tl=()=>{},kl=(i,e)=>i!=null&&Number.isFinite(i=+i)?i:e,Wt="abcdefghijklmnopqrstuvwxyz",Os="0123456789",wr={DIGIT:Os,ALPHA:Wt,ALPHA_DIGIT:Wt+Wt.toUpperCase()+Os},Ol=(i=16,e=wr.ALPHA_DIGIT)=>{let t="";const{length:s}=e;for(;i--;)t+=e[Math.random()*s|0];return t};function Il(i){return!!(i&&ge(i.append)&&i[Symbol.toStringTag]==="FormData"&&i[Symbol.iterator])}const Bl=i=>{const e=new Array(10),t=(s,r)=>{if(Tt(s)){if(e.indexOf(s)>=0)return;if(!("toJSON"in s)){e[r]=s;const n=Je(s)?[]:{};return it(s,(o,a)=>{const c=t(o,r+1);!rt(c)&&(n[a]=c)}),e[r]=void 0,n}}return s};return t(i,0)},Ll=_e("AsyncFunction"),Ml=i=>i&&(Tt(i)||ge(i))&&ge(i.then)&&ge(i.catch),br=((i,e)=>i?setImmediate:e?((t,s)=>(ke.addEventListener("message",({source:r,data:n})=>{r===ke&&n===t&&s.length&&s.shift()()},!1),r=>{s.push(r),ke.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",ge(ke.postMessage)),Fl=typeof queueMicrotask<"u"?queueMicrotask.bind(ke):typeof process<"u"&&process.nextTick||br,m={isArray:Je,isArrayBuffer:Cr,isBuffer:Za,isFormData:ll,isArrayBufferView:el,isString:tl,isNumber:yr,isBoolean:sl,isObject:Tt,isPlainObject:ht,isReadableStream:hl,isRequest:dl,isResponse:ul,isHeaders:gl,isUndefined:rt,isDate:rl,isFile:nl,isBlob:il,isRegExp:Al,isFunction:ge,isStream:al,isURLSearchParams:cl,isTypedArray:vl,isFileList:ol,forEach:it,merge:Jt,extend:ml,trim:fl,stripBOM:pl,inherits:Cl,toFlatObject:yl,kindOf:Pt,kindOfTest:_e,endsWith:_l,toArray:El,forEachEntry:wl,matchAll:bl,isHTMLForm:Sl,hasOwnProperty:ks,hasOwnProp:ks,reduceDescriptors:vr,freezeMethods:Pl,toObjectSet:Rl,toCamelCase:xl,noop:Tl,toFiniteNumber:kl,findKey:_r,global:ke,isContextDefined:Er,ALPHABET:wr,generateString:Ol,isSpecCompliantForm:Il,toJSONObject:Bl,isAsyncFn:Ll,isThenable:Ml,setImmediate:br,asap:Fl};function D(i,e,t,s,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),s&&(this.request=s),r&&(this.response=r,this.status=r.status?r.status:null)}m.inherits(D,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:m.toJSONObject(this.config),code:this.code,status:this.status}}});const Sr=D.prototype,xr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{xr[i]={value:i}});Object.defineProperties(D,xr);Object.defineProperty(Sr,"isAxiosError",{value:!0});D.from=(i,e,t,s,r,n)=>{const o=Object.create(Sr);return m.toFlatObject(i,o,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),D.call(o,i.message,e,t,s,r),o.cause=i,o.name=i.name,n&&Object.assign(o,n),o};const Dl=null;function Xt(i){return m.isPlainObject(i)||m.isArray(i)}function Ar(i){return m.endsWith(i,"[]")?i.slice(0,-2):i}function Is(i,e,t){return i?i.concat(e).map(function(r,n){return r=Ar(r),!t&&n?"["+r+"]":r}).join(t?".":""):e}function Nl(i){return m.isArray(i)&&!i.some(Xt)}const Wl=m.toFlatObject(m,{},null,function(e){return/^is[A-Z]/.test(e)});function kt(i,e,t){if(!m.isObject(i))throw new TypeError("target must be an object");e=e||new FormData,t=m.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_,v){return!m.isUndefined(v[_])});const s=t.metaTokens,r=t.visitor||d,n=t.dots,o=t.indexes,c=(t.Blob||typeof Blob<"u"&&Blob)&&m.isSpecCompliantForm(e);if(!m.isFunction(r))throw new TypeError("visitor must be a function");function h(p){if(p===null)return"";if(m.isDate(p))return p.toISOString();if(!c&&m.isBlob(p))throw new D("Blob is not supported. Use a Buffer instead.");return m.isArrayBuffer(p)||m.isTypedArray(p)?c&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function d(p,_,v){let V=p;if(p&&!v&&typeof p=="object"){if(m.endsWith(_,"{}"))_=s?_:_.slice(0,-2),p=JSON.stringify(p);else if(m.isArray(p)&&Nl(p)||(m.isFileList(p)||m.endsWith(_,"[]"))&&(V=m.toArray(p)))return _=Ar(_),V.forEach(function(Y,E){!(m.isUndefined(Y)||Y===null)&&e.append(o===!0?Is([_],E,n):o===null?_:_+"[]",h(Y))}),!1}return Xt(p)?!0:(e.append(Is(v,_,n),h(p)),!1)}const g=[],f=Object.assign(Wl,{defaultVisitor:d,convertValue:h,isVisitable:Xt});function C(p,_){if(!m.isUndefined(p)){if(g.indexOf(p)!==-1)throw Error("Circular reference detected in "+_.join("."));g.push(p),m.forEach(p,function(V,M){(!(m.isUndefined(V)||V===null)&&r.call(e,V,m.isString(M)?M.trim():M,_,f))===!0&&C(V,_?_.concat(M):[M])}),g.pop()}}if(!m.isObject(i))throw new TypeError("data must be an object");return C(i),e}function Bs(i){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function cs(i,e){this._pairs=[],i&&kt(i,this,e)}const Pr=cs.prototype;Pr.append=function(e,t){this._pairs.push([e,t])};Pr.toString=function(e){const t=e?function(s){return e.call(this,s,Bs)}:Bs;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};function Vl(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Rr(i,e,t){if(!e)return i;const s=t&&t.encode||Vl;m.isFunction(t)&&(t={serialize:t});const r=t&&t.serialize;let n;if(r?n=r(e,t):n=m.isURLSearchParams(e)?e.toString():new cs(e,t).toString(s),n){const o=i.indexOf("#");o!==-1&&(i=i.slice(0,o)),i+=(i.indexOf("?")===-1?"?":"&")+n}return i}class Ls{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){m.forEach(this.handlers,function(s){s!==null&&e(s)})}}const Tr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},zl=typeof URLSearchParams<"u"?URLSearchParams:cs,jl=typeof FormData<"u"?FormData:null,Gl=typeof Blob<"u"?Blob:null,Hl={isBrowser:!0,classes:{URLSearchParams:zl,FormData:jl,Blob:Gl},protocols:["http","https","file","blob","url","data"]},hs=typeof window<"u"&&typeof document<"u",Ut=typeof navigator=="object"&&navigator||void 0,Yl=hs&&(!Ut||["ReactNative","NativeScript","NS"].indexOf(Ut.product)<0),$l=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ql=hs&&window.location.href||"http://localhost",Jl=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:hs,hasStandardBrowserEnv:Yl,hasStandardBrowserWebWorkerEnv:$l,navigator:Ut,origin:ql},Symbol.toStringTag,{value:"Module"})),oe={...Jl,...Hl};function Xl(i,e){return kt(i,new oe.classes.URLSearchParams,Object.assign({visitor:function(t,s,r,n){return oe.isNode&&m.isBuffer(t)?(this.append(s,t.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},e))}function Ul(i){return m.matchAll(/\w+|\[(\w*)]/g,i).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Kl(i){const e={},t=Object.keys(i);let s;const r=t.length;let n;for(s=0;s<r;s++)n=t[s],e[n]=i[n];return e}function kr(i){function e(t,s,r,n){let o=t[n++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),c=n>=t.length;return o=!o&&m.isArray(r)?r.length:o,c?(m.hasOwnProp(r,o)?r[o]=[r[o],s]:r[o]=s,!a):((!r[o]||!m.isObject(r[o]))&&(r[o]=[]),e(t,s,r[o],n)&&m.isArray(r[o])&&(r[o]=Kl(r[o])),!a)}if(m.isFormData(i)&&m.isFunction(i.entries)){const t={};return m.forEachEntry(i,(s,r)=>{e(Ul(s),r,t,0)}),t}return null}function Ql(i,e,t){if(m.isString(i))try{return(e||JSON.parse)(i),m.trim(i)}catch(s){if(s.name!=="SyntaxError")throw s}return(0,JSON.stringify)(i)}const ot={transitional:Tr,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",r=s.indexOf("application/json")>-1,n=m.isObject(e);if(n&&m.isHTMLForm(e)&&(e=new FormData(e)),m.isFormData(e))return r?JSON.stringify(kr(e)):e;if(m.isArrayBuffer(e)||m.isBuffer(e)||m.isStream(e)||m.isFile(e)||m.isBlob(e)||m.isReadableStream(e))return e;if(m.isArrayBufferView(e))return e.buffer;if(m.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(n){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Xl(e,this.formSerializer).toString();if((a=m.isFileList(e))||s.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return kt(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return n||r?(t.setContentType("application/json",!1),Ql(e)):e}],transformResponse:[function(e){const t=this.transitional||ot.transitional,s=t&&t.forcedJSONParsing,r=this.responseType==="json";if(m.isResponse(e)||m.isReadableStream(e))return e;if(e&&m.isString(e)&&(s&&!this.responseType||r)){const o=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?D.from(a,D.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:oe.classes.FormData,Blob:oe.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};m.forEach(["delete","get","head","post","put","patch"],i=>{ot.headers[i]={}});const Zl=m.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ec=i=>{const e={};let t,s,r;return i&&i.split(`
`).forEach(function(o){r=o.indexOf(":"),t=o.substring(0,r).trim().toLowerCase(),s=o.substring(r+1).trim(),!(!t||e[t]&&Zl[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},Ms=Symbol("internals");function Ke(i){return i&&String(i).trim().toLowerCase()}function dt(i){return i===!1||i==null?i:m.isArray(i)?i.map(dt):String(i)}function tc(i){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(i);)e[s[1]]=s[2];return e}const sc=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function Vt(i,e,t,s,r){if(m.isFunction(s))return s.call(this,e,t);if(r&&(e=t),!!m.isString(e)){if(m.isString(s))return e.indexOf(s)!==-1;if(m.isRegExp(s))return s.test(e)}}function rc(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function nc(i,e){const t=m.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(i,s+t,{value:function(r,n,o){return this[s].call(this,e,r,n,o)},configurable:!0})})}class ce{constructor(e){e&&this.set(e)}set(e,t,s){const r=this;function n(a,c,h){const d=Ke(c);if(!d)throw new Error("header name must be a non-empty string");const g=m.findKey(r,d);(!g||r[g]===void 0||h===!0||h===void 0&&r[g]!==!1)&&(r[g||c]=dt(a))}const o=(a,c)=>m.forEach(a,(h,d)=>n(h,d,c));if(m.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(m.isString(e)&&(e=e.trim())&&!sc(e))o(ec(e),t);else if(m.isHeaders(e))for(const[a,c]of e.entries())n(c,a,s);else e!=null&&n(t,e,s);return this}get(e,t){if(e=Ke(e),e){const s=m.findKey(this,e);if(s){const r=this[s];if(!t)return r;if(t===!0)return tc(r);if(m.isFunction(t))return t.call(this,r,s);if(m.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ke(e),e){const s=m.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||Vt(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let r=!1;function n(o){if(o=Ke(o),o){const a=m.findKey(s,o);a&&(!t||Vt(s,s[a],a,t))&&(delete s[a],r=!0)}}return m.isArray(e)?e.forEach(n):n(e),r}clear(e){const t=Object.keys(this);let s=t.length,r=!1;for(;s--;){const n=t[s];(!e||Vt(this,this[n],n,e,!0))&&(delete this[n],r=!0)}return r}normalize(e){const t=this,s={};return m.forEach(this,(r,n)=>{const o=m.findKey(s,n);if(o){t[o]=dt(r),delete t[n];return}const a=e?rc(n):String(n).trim();a!==n&&delete t[n],t[a]=dt(r),s[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return m.forEach(this,(s,r)=>{s!=null&&s!==!1&&(t[r]=e&&m.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(r=>s.set(r)),s}static accessor(e){const s=(this[Ms]=this[Ms]={accessors:{}}).accessors,r=this.prototype;function n(o){const a=Ke(o);s[a]||(nc(r,o),s[a]=!0)}return m.isArray(e)?e.forEach(n):n(e),this}}ce.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);m.reduceDescriptors(ce.prototype,({value:i},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>i,set(s){this[t]=s}}});m.freezeMethods(ce);function zt(i,e){const t=this||ot,s=e||t,r=ce.from(s.headers);let n=s.data;return m.forEach(i,function(a){n=a.call(t,n,r.normalize(),e?e.status:void 0)}),r.normalize(),n}function Or(i){return!!(i&&i.__CANCEL__)}function Xe(i,e,t){D.call(this,i??"canceled",D.ERR_CANCELED,e,t),this.name="CanceledError"}m.inherits(Xe,D,{__CANCEL__:!0});function Ir(i,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?i(t):e(new D("Request failed with status code "+t.status,[D.ERR_BAD_REQUEST,D.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function ic(i){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return e&&e[1]||""}function oc(i,e){i=i||10;const t=new Array(i),s=new Array(i);let r=0,n=0,o;return e=e!==void 0?e:1e3,function(c){const h=Date.now(),d=s[n];o||(o=h),t[r]=c,s[r]=h;let g=n,f=0;for(;g!==r;)f+=t[g++],g=g%i;if(r=(r+1)%i,r===n&&(n=(n+1)%i),h-o<e)return;const C=d&&h-d;return C?Math.round(f*1e3/C):void 0}}function ac(i,e){let t=0,s=1e3/e,r,n;const o=(h,d=Date.now())=>{t=d,r=null,n&&(clearTimeout(n),n=null),i.apply(null,h)};return[(...h)=>{const d=Date.now(),g=d-t;g>=s?o(h,d):(r=h,n||(n=setTimeout(()=>{n=null,o(r)},s-g)))},()=>r&&o(r)]}const _t=(i,e,t=3)=>{let s=0;const r=oc(50,250);return ac(n=>{const o=n.loaded,a=n.lengthComputable?n.total:void 0,c=o-s,h=r(c),d=o<=a;s=o;const g={loaded:o,total:a,progress:a?o/a:void 0,bytes:c,rate:h||void 0,estimated:h&&a&&d?(a-o)/h:void 0,event:n,lengthComputable:a!=null,[e?"download":"upload"]:!0};i(g)},t)},Fs=(i,e)=>{const t=i!=null;return[s=>e[0]({lengthComputable:t,total:i,loaded:s}),e[1]]},Ds=i=>(...e)=>m.asap(()=>i(...e)),lc=oe.hasStandardBrowserEnv?((i,e)=>t=>(t=new URL(t,oe.origin),i.protocol===t.protocol&&i.host===t.host&&(e||i.port===t.port)))(new URL(oe.origin),oe.navigator&&/(msie|trident)/i.test(oe.navigator.userAgent)):()=>!0,cc=oe.hasStandardBrowserEnv?{write(i,e,t,s,r,n){const o=[i+"="+encodeURIComponent(e)];m.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),m.isString(s)&&o.push("path="+s),m.isString(r)&&o.push("domain="+r),n===!0&&o.push("secure"),document.cookie=o.join("; ")},read(i){const e=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(i){this.write(i,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function hc(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function dc(i,e){return e?i.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):i}function Br(i,e){return i&&!hc(e)?dc(i,e):e}const Ns=i=>i instanceof ce?{...i}:i;function Me(i,e){e=e||{};const t={};function s(h,d,g,f){return m.isPlainObject(h)&&m.isPlainObject(d)?m.merge.call({caseless:f},h,d):m.isPlainObject(d)?m.merge({},d):m.isArray(d)?d.slice():d}function r(h,d,g,f){if(m.isUndefined(d)){if(!m.isUndefined(h))return s(void 0,h,g,f)}else return s(h,d,g,f)}function n(h,d){if(!m.isUndefined(d))return s(void 0,d)}function o(h,d){if(m.isUndefined(d)){if(!m.isUndefined(h))return s(void 0,h)}else return s(void 0,d)}function a(h,d,g){if(g in e)return s(h,d);if(g in i)return s(void 0,h)}const c={url:n,method:n,data:n,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(h,d,g)=>r(Ns(h),Ns(d),g,!0)};return m.forEach(Object.keys(Object.assign({},i,e)),function(d){const g=c[d]||r,f=g(i[d],e[d],d);m.isUndefined(f)&&g!==a||(t[d]=f)}),t}const Lr=i=>{const e=Me({},i);let{data:t,withXSRFToken:s,xsrfHeaderName:r,xsrfCookieName:n,headers:o,auth:a}=e;e.headers=o=ce.from(o),e.url=Rr(Br(e.baseURL,e.url),i.params,i.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let c;if(m.isFormData(t)){if(oe.hasStandardBrowserEnv||oe.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((c=o.getContentType())!==!1){const[h,...d]=c?c.split(";").map(g=>g.trim()).filter(Boolean):[];o.setContentType([h||"multipart/form-data",...d].join("; "))}}if(oe.hasStandardBrowserEnv&&(s&&m.isFunction(s)&&(s=s(e)),s||s!==!1&&lc(e.url))){const h=r&&n&&cc.read(n);h&&o.set(r,h)}return e},uc=typeof XMLHttpRequest<"u",gc=uc&&function(i){return new Promise(function(t,s){const r=Lr(i);let n=r.data;const o=ce.from(r.headers).normalize();let{responseType:a,onUploadProgress:c,onDownloadProgress:h}=r,d,g,f,C,p;function _(){C&&C(),p&&p(),r.cancelToken&&r.cancelToken.unsubscribe(d),r.signal&&r.signal.removeEventListener("abort",d)}let v=new XMLHttpRequest;v.open(r.method.toUpperCase(),r.url,!0),v.timeout=r.timeout;function V(){if(!v)return;const Y=ce.from("getAllResponseHeaders"in v&&v.getAllResponseHeaders()),y={data:!a||a==="text"||a==="json"?v.responseText:v.response,status:v.status,statusText:v.statusText,headers:Y,config:i,request:v};Ir(function(I){t(I),_()},function(I){s(I),_()},y),v=null}"onloadend"in v?v.onloadend=V:v.onreadystatechange=function(){!v||v.readyState!==4||v.status===0&&!(v.responseURL&&v.responseURL.indexOf("file:")===0)||setTimeout(V)},v.onabort=function(){v&&(s(new D("Request aborted",D.ECONNABORTED,i,v)),v=null)},v.onerror=function(){s(new D("Network Error",D.ERR_NETWORK,i,v)),v=null},v.ontimeout=function(){let E=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const y=r.transitional||Tr;r.timeoutErrorMessage&&(E=r.timeoutErrorMessage),s(new D(E,y.clarifyTimeoutError?D.ETIMEDOUT:D.ECONNABORTED,i,v)),v=null},n===void 0&&o.setContentType(null),"setRequestHeader"in v&&m.forEach(o.toJSON(),function(E,y){v.setRequestHeader(y,E)}),m.isUndefined(r.withCredentials)||(v.withCredentials=!!r.withCredentials),a&&a!=="json"&&(v.responseType=r.responseType),h&&([f,p]=_t(h,!0),v.addEventListener("progress",f)),c&&v.upload&&([g,C]=_t(c),v.upload.addEventListener("progress",g),v.upload.addEventListener("loadend",C)),(r.cancelToken||r.signal)&&(d=Y=>{v&&(s(!Y||Y.type?new Xe(null,i,v):Y),v.abort(),v=null)},r.cancelToken&&r.cancelToken.subscribe(d),r.signal&&(r.signal.aborted?d():r.signal.addEventListener("abort",d)));const M=ic(r.url);if(M&&oe.protocols.indexOf(M)===-1){s(new D("Unsupported protocol "+M+":",D.ERR_BAD_REQUEST,i));return}v.send(n||null)})},fc=(i,e)=>{const{length:t}=i=i?i.filter(Boolean):[];if(e||t){let s=new AbortController,r;const n=function(h){if(!r){r=!0,a();const d=h instanceof Error?h:this.reason;s.abort(d instanceof D?d:new Xe(d instanceof Error?d.message:d))}};let o=e&&setTimeout(()=>{o=null,n(new D(`timeout ${e} of ms exceeded`,D.ETIMEDOUT))},e);const a=()=>{i&&(o&&clearTimeout(o),o=null,i.forEach(h=>{h.unsubscribe?h.unsubscribe(n):h.removeEventListener("abort",n)}),i=null)};i.forEach(h=>h.addEventListener("abort",n));const{signal:c}=s;return c.unsubscribe=()=>m.asap(a),c}},mc=function*(i,e){let t=i.byteLength;if(t<e){yield i;return}let s=0,r;for(;s<t;)r=s+e,yield i.slice(s,r),s=r},pc=async function*(i,e){for await(const t of Cc(i))yield*mc(t,e)},Cc=async function*(i){if(i[Symbol.asyncIterator]){yield*i;return}const e=i.getReader();try{for(;;){const{done:t,value:s}=await e.read();if(t)break;yield s}}finally{await e.cancel()}},Ws=(i,e,t,s)=>{const r=pc(i,e);let n=0,o,a=c=>{o||(o=!0,s&&s(c))};return new ReadableStream({async pull(c){try{const{done:h,value:d}=await r.next();if(h){a(),c.close();return}let g=d.byteLength;if(t){let f=n+=g;t(f)}c.enqueue(new Uint8Array(d))}catch(h){throw a(h),h}},cancel(c){return a(c),r.return()}},{highWaterMark:2})},Ot=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Mr=Ot&&typeof ReadableStream=="function",yc=Ot&&(typeof TextEncoder=="function"?(i=>e=>i.encode(e))(new TextEncoder):async i=>new Uint8Array(await new Response(i).arrayBuffer())),Fr=(i,...e)=>{try{return!!i(...e)}catch{return!1}},_c=Mr&&Fr(()=>{let i=!1;const e=new Request(oe.origin,{body:new ReadableStream,method:"POST",get duplex(){return i=!0,"half"}}).headers.has("Content-Type");return i&&!e}),Vs=64*1024,Kt=Mr&&Fr(()=>m.isReadableStream(new Response("").body)),Et={stream:Kt&&(i=>i.body)};Ot&&(i=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Et[e]&&(Et[e]=m.isFunction(i[e])?t=>t[e]():(t,s)=>{throw new D(`Response type '${e}' is not supported`,D.ERR_NOT_SUPPORT,s)})})})(new Response);const Ec=async i=>{if(i==null)return 0;if(m.isBlob(i))return i.size;if(m.isSpecCompliantForm(i))return(await new Request(oe.origin,{method:"POST",body:i}).arrayBuffer()).byteLength;if(m.isArrayBufferView(i)||m.isArrayBuffer(i))return i.byteLength;if(m.isURLSearchParams(i)&&(i=i+""),m.isString(i))return(await yc(i)).byteLength},vc=async(i,e)=>{const t=m.toFiniteNumber(i.getContentLength());return t??Ec(e)},wc=Ot&&(async i=>{let{url:e,method:t,data:s,signal:r,cancelToken:n,timeout:o,onDownloadProgress:a,onUploadProgress:c,responseType:h,headers:d,withCredentials:g="same-origin",fetchOptions:f}=Lr(i);h=h?(h+"").toLowerCase():"text";let C=fc([r,n&&n.toAbortSignal()],o),p;const _=C&&C.unsubscribe&&(()=>{C.unsubscribe()});let v;try{if(c&&_c&&t!=="get"&&t!=="head"&&(v=await vc(d,s))!==0){let y=new Request(e,{method:"POST",body:s,duplex:"half"}),x;if(m.isFormData(s)&&(x=y.headers.get("content-type"))&&d.setContentType(x),y.body){const[I,B]=Fs(v,_t(Ds(c)));s=Ws(y.body,Vs,I,B)}}m.isString(g)||(g=g?"include":"omit");const V="credentials"in Request.prototype;p=new Request(e,{...f,signal:C,method:t.toUpperCase(),headers:d.normalize().toJSON(),body:s,duplex:"half",credentials:V?g:void 0});let M=await fetch(p);const Y=Kt&&(h==="stream"||h==="response");if(Kt&&(a||Y&&_)){const y={};["status","statusText","headers"].forEach(j=>{y[j]=M[j]});const x=m.toFiniteNumber(M.headers.get("content-length")),[I,B]=a&&Fs(x,_t(Ds(a),!0))||[];M=new Response(Ws(M.body,Vs,I,()=>{B&&B(),_&&_()}),y)}h=h||"text";let E=await Et[m.findKey(Et,h)||"text"](M,i);return!Y&&_&&_(),await new Promise((y,x)=>{Ir(y,x,{data:E,headers:ce.from(M.headers),status:M.status,statusText:M.statusText,config:i,request:p})})}catch(V){throw _&&_(),V&&V.name==="TypeError"&&/fetch/i.test(V.message)?Object.assign(new D("Network Error",D.ERR_NETWORK,i,p),{cause:V.cause||V}):D.from(V,V&&V.code,i,p)}}),Qt={http:Dl,xhr:gc,fetch:wc};m.forEach(Qt,(i,e)=>{if(i){try{Object.defineProperty(i,"name",{value:e})}catch{}Object.defineProperty(i,"adapterName",{value:e})}});const zs=i=>`- ${i}`,bc=i=>m.isFunction(i)||i===null||i===!1,Dr={getAdapter:i=>{i=m.isArray(i)?i:[i];const{length:e}=i;let t,s;const r={};for(let n=0;n<e;n++){t=i[n];let o;if(s=t,!bc(t)&&(s=Qt[(o=String(t)).toLowerCase()],s===void 0))throw new D(`Unknown adapter '${o}'`);if(s)break;r[o||"#"+n]=s}if(!s){const n=Object.entries(r).map(([a,c])=>`adapter ${a} `+(c===!1?"is not supported by the environment":"is not available in the build"));let o=e?n.length>1?`since :
`+n.map(zs).join(`
`):" "+zs(n[0]):"as no adapter specified";throw new D("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return s},adapters:Qt};function jt(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new Xe(null,i)}function js(i){return jt(i),i.headers=ce.from(i.headers),i.data=zt.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),Dr.getAdapter(i.adapter||ot.adapter)(i).then(function(s){return jt(i),s.data=zt.call(i,i.transformResponse,s),s.headers=ce.from(s.headers),s},function(s){return Or(s)||(jt(i),s&&s.response&&(s.response.data=zt.call(i,i.transformResponse,s.response),s.response.headers=ce.from(s.response.headers))),Promise.reject(s)})}const Nr="1.7.9",It={};["object","boolean","number","function","string","symbol"].forEach((i,e)=>{It[i]=function(s){return typeof s===i||"a"+(e<1?"n ":" ")+i}});const Gs={};It.transitional=function(e,t,s){function r(n,o){return"[Axios v"+Nr+"] Transitional option '"+n+"'"+o+(s?". "+s:"")}return(n,o,a)=>{if(e===!1)throw new D(r(o," has been removed"+(t?" in "+t:"")),D.ERR_DEPRECATED);return t&&!Gs[o]&&(Gs[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(n,o,a):!0}};It.spelling=function(e){return(t,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function Sc(i,e,t){if(typeof i!="object")throw new D("options must be an object",D.ERR_BAD_OPTION_VALUE);const s=Object.keys(i);let r=s.length;for(;r-- >0;){const n=s[r],o=e[n];if(o){const a=i[n],c=a===void 0||o(a,n,i);if(c!==!0)throw new D("option "+n+" must be "+c,D.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new D("Unknown option "+n,D.ERR_BAD_OPTION)}}const ut={assertOptions:Sc,validators:It},Ee=ut.validators;class Ie{constructor(e){this.defaults=e,this.interceptors={request:new Ls,response:new Ls}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const n=r.stack?r.stack.replace(/^.+\n/,""):"";try{s.stack?n&&!String(s.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+n):s.stack=n}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Me(this.defaults,t);const{transitional:s,paramsSerializer:r,headers:n}=t;s!==void 0&&ut.assertOptions(s,{silentJSONParsing:Ee.transitional(Ee.boolean),forcedJSONParsing:Ee.transitional(Ee.boolean),clarifyTimeoutError:Ee.transitional(Ee.boolean)},!1),r!=null&&(m.isFunction(r)?t.paramsSerializer={serialize:r}:ut.assertOptions(r,{encode:Ee.function,serialize:Ee.function},!0)),ut.assertOptions(t,{baseUrl:Ee.spelling("baseURL"),withXsrfToken:Ee.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=n&&m.merge(n.common,n[t.method]);n&&m.forEach(["delete","get","head","post","put","patch","common"],p=>{delete n[p]}),t.headers=ce.concat(o,n);const a=[];let c=!0;this.interceptors.request.forEach(function(_){typeof _.runWhen=="function"&&_.runWhen(t)===!1||(c=c&&_.synchronous,a.unshift(_.fulfilled,_.rejected))});const h=[];this.interceptors.response.forEach(function(_){h.push(_.fulfilled,_.rejected)});let d,g=0,f;if(!c){const p=[js.bind(this),void 0];for(p.unshift.apply(p,a),p.push.apply(p,h),f=p.length,d=Promise.resolve(t);g<f;)d=d.then(p[g++],p[g++]);return d}f=a.length;let C=t;for(g=0;g<f;){const p=a[g++],_=a[g++];try{C=p(C)}catch(v){_.call(this,v);break}}try{d=js.call(this,C)}catch(p){return Promise.reject(p)}for(g=0,f=h.length;g<f;)d=d.then(h[g++],h[g++]);return d}getUri(e){e=Me(this.defaults,e);const t=Br(e.baseURL,e.url);return Rr(t,e.params,e.paramsSerializer)}}m.forEach(["delete","get","head","options"],function(e){Ie.prototype[e]=function(t,s){return this.request(Me(s||{},{method:e,url:t,data:(s||{}).data}))}});m.forEach(["post","put","patch"],function(e){function t(s){return function(n,o,a){return this.request(Me(a||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:n,data:o}))}}Ie.prototype[e]=t(),Ie.prototype[e+"Form"]=t(!0)});class ds{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(n){t=n});const s=this;this.promise.then(r=>{if(!s._listeners)return;let n=s._listeners.length;for(;n-- >0;)s._listeners[n](r);s._listeners=null}),this.promise.then=r=>{let n;const o=new Promise(a=>{s.subscribe(a),n=a}).then(r);return o.cancel=function(){s.unsubscribe(n)},o},e(function(n,o,a){s.reason||(s.reason=new Xe(n,o,a),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=s=>{e.abort(s)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new ds(function(r){e=r}),cancel:e}}}function xc(i){return function(t){return i.apply(null,t)}}function Ac(i){return m.isObject(i)&&i.isAxiosError===!0}const Zt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Zt).forEach(([i,e])=>{Zt[e]=i});function Wr(i){const e=new Ie(i),t=pr(Ie.prototype.request,e);return m.extend(t,Ie.prototype,e,{allOwnKeys:!0}),m.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return Wr(Me(i,r))},t}const q=Wr(ot);q.Axios=Ie;q.CanceledError=Xe;q.CancelToken=ds;q.isCancel=Or;q.VERSION=Nr;q.toFormData=kt;q.AxiosError=D;q.Cancel=q.CanceledError;q.all=function(e){return Promise.all(e)};q.spread=xc;q.isAxiosError=Ac;q.mergeConfig=Me;q.AxiosHeaders=ce;q.formToJSON=i=>kr(m.isHTMLForm(i)?new FormData(i):i);q.getAdapter=Dr.getAdapter;q.HttpStatusCode=Zt;q.default=q;const Pc=$s("app",{state:()=>({name:"app",locale:"zh",version:"1.0.0",user:{},token:"",config:{},menu:{},isMobile:!1,isLandscape:!1,isFullScreen:!1,isShowSidebar:!0,isShowHeader:!0,isShowFooter:!0}),actions:{async init(){const i=await Promise.all([this.getLocale(),this.getUserInfo(),this.getVersion(),this.getConfig()]),[e,t,s,r]=i;this.locale=e.data,this.user=t.data,this.version=s.data,this.config=r.data},async getLocale(){return"zh"},async getUserInfo(){return await q.get("/api/user")},async getVersion(){return await q.get("/api/version")},async getConfig(){return await q.get("/api/config")},async getUploadToken(){return await q.get("/api/upload/token")},async getUploadUrl(){return await q.get("/api/upload/url")},async getUploadFileInfo(i){return await q.get("/api/upload/file",i)},async getUploadFileList(i){return await q.get("/api/upload/list",i)}}}),Rc={class:"left"},Tc={class:"right"},kc={class:"stage"},Oc=ae({__name:"App",setup(i){const{locale:e}=Yr(),t=Pc(),{init:s,locale:r}=t;return s().then(()=>{e.value=r}),(n,o)=>{const a=Ka,c=qa,h=Wo;return N(),H(Be,null,[L("div",Rc,[R(a)]),L("div",Tc,[R(c)]),L("div",kc,[R(h)])],64)}}}),Ic=he(Oc,[["__scopeId","data-v-bc3e527b"]]),Bc="modulepreload",Lc=function(i,e){return new URL(i,e).href},Hs={},Ys=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),c=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(t.map(h=>{if(h=Lc(h,s),h in Hs)return;Hs[h]=!0;const d=h.endsWith(".css"),g=d?'[rel="stylesheet"]':"";if(!!s)for(let p=o.length-1;p>=0;p--){const _=o[p];if(_.href===h&&(!d||_.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${h}"]${g}`))return;const C=document.createElement("link");if(C.rel=d?"stylesheet":Bc,d||(C.as="script"),C.crossOrigin="",C.href=h,c&&C.setAttribute("nonce",c),document.head.appendChild(C),d)return new Promise((p,_)=>{C.addEventListener("load",p),C.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${h}`)))})}))}function n(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&n(a.reason);return e().catch(n)})},Vr=$r({legacy:!1,locale:"zh",messages:{}});async function Mc(){const i=Object.assign({"/src/locales/en.json":()=>Ys(()=>import("./en-BIHI7g3E.js"),[],import.meta.url),"/src/locales/zh.json":()=>Ys(()=>import("./zh-DkCPf_Nl.js"),[],import.meta.url)});for(const e in i){const t=e.match(/\/([A-Za-z0-9-_]+)\.json$/)[1];i[e]().then(s=>{Vr.global.setLocaleMessage(t,s.default)})}}Mc();const Bt=qr(Ic),Fc=Jr();Bt.use(on,{size:"small"});Bt.use(Fc);Bt.use(Vr);Bt.mount("#app");
