var Fr=Object.defineProperty;var Dr=(n,e,t)=>e in n?Fr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var u=(n,e,t)=>Dr(n,typeof e!="symbol"?e+"":e,t);import{x as oe,y as W,z as j,A as L,O as Te,P as R,C as J,L as Ve,aw as zs,ab as N,r as te,G as fe,H as F,Q as Oe,a4 as ze,u as w,c as nt,I as _t,J as Et,k as Wr,f as be,M as K,ax as Vr,ay as zr,at as Nr,az as Gr}from"./vue-lfwZ6J9M.js";import{E as Ce,g as jr,a as Hr,b as Ns,d as Gs,e as js,f as Yr,p as Hs,m as Ys,h as $s,i as qs,j as je,k as $r,l as qr,u as Xr,n as Ur,w as Kr,o as Jr,q as Qr,r as Zr}from"./element-D83ZfnbP.js";import{r as en}from"./lodash-7Fc9gIMR.js";import{m as tn,o as X,r as we,a as Me,c as sn}from"./mobx-aks1-jRs.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();const rn={class:"creator-menu__item"},nn={class:"text"},on={class:"icon"},an={key:0,class:"shortcut"},ln=oe({__name:"CreatorDropDownItem",props:{creator:{}},setup(n){return(e,t)=>{const s=Ce;return W(),j("div",rn,[L("div",nn,Te(e.creator.name),1),L("div",on,[R(s,{class:J(["iconfont",e.creator.icon])},null,8,["class"])]),e.creator.shortcut?(W(),j("div",an,Te(e.creator.shortcut),1)):Ve("",!0)])}}});class cn{constructor(){u(this,"el")}async init(e){this.el=e}}const ls=2,cs=2,hn=4,dn=4,un=4,hs=8;var ae=(n=>(n[n.path=0]="path",n[n.transformer=1]="transformer",n[n.cursor=2]="cursor",n[n.cursorPosition=3]="cursorPosition",n[n.selection=4]="selection",n[n.rotate=5]="rotate",n[n.indicator=6]="indicator",n[n.range=7]="range",n))(ae||{}),Q=(n=>(n[n.initialed=-1]="initialed",n[n.startCreating=0]="startCreating",n[n.creating=1]="creating",n[n.finished=2]="finished",n[n.editing=3]="editing",n))(Q||{}),O=(n=>(n.elementCreated="elementCreated",n.selectedChanged="selectedChanged",n.targetChanged="targetChanged",n.positionChanged="positionChanged",n.widthChanged="widthChanged",n.heightChanged="heightChanged",n.angleChanged="angleChanged",n.cornersChanged="cornersChanged",n.flipXChanged="flipXChanged",n.leanYAngleChanged="leanYAngleChanged",n.scaleChanged="scaleChanged",n.strokesChanged="strokesChanged",n.fillsChanged="fillsChanged",n.fontSizeChanged="fontSizeChanged",n.fontFamilyChanged="fontFamilyChanged",n.textAlignChanged="textAlignChanged",n.textBaselineChanged="textBaselineChanged",n.creatorChanged="creatorChanged",n.ratioLockedChanged="ratioLockedChanged",n.multiSelectedChanged="multiSelectedChanged",n.primarySelectedChanged="primarySelectedChanged",n.layerShiftMoveEnableChanged="layerShiftMoveEnableChanged",n.layerGoDownEnableChanged="layerGoDownEnableChanged",n))(O||{});class gn{constructor(e){u(this,"prev",null);u(this,"next",null);u(this,"value");this.value=e}get isHead(){return this.prev===null}get isTail(){return this.next===null}get isEmpty(){return this.value===null}insertAfter(e){const t=this.next;this.next=e,e.prev=this,e.next=t,t&&(t.prev=e)}insertBefore(e){const t=this.prev;this.prev=e,e.next=this,e.prev=t,t&&(t.next=e)}}const fn="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Ue=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)e+=fn[t[n]&63];return e};const Ke=new Worker(new URL(""+new URL("MathWorker-CmujXtXM.js",import.meta.url).href,import.meta.url),{type:"module"}),Fe=new Map;Ke.onmessage=n=>{const{id:e,result:t}=n.data;let s=Fe.get(e);s&&s(t),Fe.delete(e),s=null};class l{static multiply(e,t){const s=e.length,r=e[0].length;if(Array.isArray(t[0])){const i=t.length,o=t[0].length;if(r!==i)throw new Error("矩阵 A 的列数必须等于矩阵 B 的行数");const a=new Array(s);for(let c=0;c<s;c++)a[c]=new Array(o).fill(0);for(let c=0;c<s;c++)for(let h=0;h<o;h++)for(let d=0;d<r;d++)a[c][h]+=e[c][d]*t[d][h];return a}else{if(r!==t.length)throw new Error("矩阵 A 的列数必须等于向量的长度");const i=new Array(s).fill(0);for(let o=0;o<s;o++)for(let a=0;a<r;a++)i[o]+=e[o][a]*t[a];return i}}static calcTranslateMatrix(e,t){return[[1,0,e],[0,1,t],[0,0,1]]}static translate(e,t){return!t||t.x===0&&t.y===0?e:{x:e.x+t.x,y:e.y+t.y}}static batchTranslate(e,t){return e.map(s=>this.translate(s,t))}static asyncTranslate(e,t){return new Promise(s=>{const r=`${Date.now()}_${Ue(4)}`;Ke.postMessage({funcName:"translate",args:[e,t],id:r}),Fe.set(r,i=>{s(i)})})}static asyncBatchTranslate(e,t){return new Promise(s=>{const r=`${Date.now()}_${Ue(4)}`;Ke.postMessage({funcName:"batchTranslate",args:[e,t],id:r}),Fe.set(r,i=>{s(i)})})}static asyncNamedBatchTranslate(e,t){return new Promise(s=>{const r=`${Date.now()}_${Ue(4)}`;Ke.postMessage({funcName:"namedBatchTranslate",args:[e,t],id:r}),Fe.set(r,i=>{s(i)})})}static asyncMapNamedBatchTranslate(e,t){return new Promise(s=>{const r=`${Date.now()}_${Ue(4)}`;Ke.postMessage({funcName:"mapNamedBatchTranslate",args:[e,t],id:r}),Fe.set(r,i=>{s(i)})})}static rotate(e,t){if(t===0)return e;const s=l.calcRotateMatrix(t),r=l.multiply(s,[e.x,e.y,1]);return{x:r[0],y:r[1]}}static batchRotate(e,t){return e.map(s=>this.rotate(s,t))}static calcScaleMatrix(e,t){return[[e,0,0],[0,t,0],[0,0,1]]}static calcTransformMatrix(e,t,s,r={}){t=l.transWithCenter(t,r,e,!0),s=l.transWithCenter(s,r,e,!0);const i=s.x-e.x,o=s.y-e.y,a=t.x-e.x,c=t.y-e.y,h=i===0?1:a/i,d=o===0?1:c/o;return l.calcScaleMatrix(h,d)}static rotateWithCenter(e,t,s){if(t===0||!s)return e;e={x:e.x-s.x,y:e.y-s.y};const r=l.rotate(e,t);return{x:r.x+s.x,y:r.y+s.y}}static batchRotateWithCenter(e,t,s){return e.map(r=>l.rotateWithCenter(r,t,s))}static leanYWithCenter(e,t,s){return l.leanWithCenter(e,0,t,s)}static batchLeanYWithCenter(e,t,s){return e.map(r=>l.leanYWithCenter(r,t,s))}static leanXWithCenter(e,t,s){return l.leanWithCenter(e,t,0,s)}static batchLeanXWithCenter(e,t,s){return e.map(r=>l.leanXWithCenter(r,t,s))}static calcLeanMatrix(e,t){e=e||0,t=t||0;const s=Math.tan(l.angleToRadian(e));return[[1,-Math.tan(l.angleToRadian(t)),0],[s,1,0],[0,0,1]]}static calcRotateMatrix(e){e=e||0;const t=l.angleToRadian(e);return[[Math.cos(t),-Math.sin(t),0],[Math.sin(t),Math.cos(t),0],[0,0,1]]}static leanWithCenter(e,t,s,r){if(t===0&&s===0)return e;const i=l.calcLeanMatrix(t,s),o=l.multiply(i,[e.x-r.x,e.y-r.y,1]);return{x:o[0]+r.x,y:o[1]+r.y}}static batchLeanWithCenter(e,t,s,r){return e.map(i=>l.leanWithCenter(i,t,s,r))}static transWithCenter(e,t,s,r){let{angle:i=0,leanXAngle:o=0,leanYAngle:a=0}=t||{};if(i===0&&o===0&&a===0)return e;r&&(i=-i,o=-o,a=-a);let c;const h=l.calcLeanMatrix(o,a),d=l.calcRotateMatrix(i);r?c=l.multiply(h,d):c=l.multiply(d,h);let g=l.multiply(c,[e.x-s.x,e.y-s.y,1]);return{x:g[0]+s.x,y:g[1]+s.y}}static batchTransWithCenter(e,t,s,r){return e.map(i=>l.transWithCenter(i,t,s,r))}static rotateAndTranslate(e,t,s){return l.translate(l.rotate(e,t),s)}static translateArcPoint(e,t){let{start:s,controller:r,end:i,corner:o,value:a}=e;return[s,r,i,o]=l.batchTranslate([s,r,i,o],t),{start:s,controller:r,end:i,corner:o,value:a}}static translateArcPoints(e,t){return e.map(s=>l.translateArcPoint(s,t))}static batchTranslateArcPoints(e,t){return e.map((s,r)=>l.translateArcPoints(s,t))}static scale(e,t){if(t.sx===1&&t.sy===1)return e;const s=l.calcScaleMatrix(t.sx,t.sy),r=l.multiply(s,[e.x,e.y,1]);return{x:r[0],y:r[1]}}static scales(e,t){return e.map(s=>l.scale(s,t))}static scaleWithCenter(e,t,s){return t.sx===1&&t.sy===1?e:(e={x:e.x-s.x,y:e.y-s.y},e=l.scale(e,t),{x:e.x+s.x,y:e.y+s.y})}static batchScaleWithCenter(e,t,s){return e.map(r=>l.scaleWithCenter(r,t,s))}static angleToRadian(e){return e*(Math.PI/180)}static radianToAngle(e){return e*(180/Math.PI)}static isPointInPolygonByRayCasting(e,t){const s=[e.x,e.y],r=t.map(c=>[c.x,c.y]),[i,o]=s;let a=!1;for(let c=0,h=r.length-1;c<r.length;h=c++){const[d,g]=r[c],[f,C]=r[h];if(g>o!=C>o&&i<(f-d)*(o-g)/(C-g)+d&&(a=!a),g===o&&o===C&&i>=Math.min(d,f)&&i<=Math.max(d,f)&&o>=Math.min(g,C)&&o<=Math.max(g,C))return!0}return a}static isPolygonsOverlap(e,t){const s=e.map(f=>[f.x,f.y]),r=t.map(f=>[f.x,f.y]);function i(f){let C=[];for(let p=0;p<f.length;p++){let E=(p+1)%f.length,v=[f[E][0]-f[p][0],f[E][1]-f[p][1]];C.push(v)}return C}function o(f,C){return f[0]*C[0]+f[1]*C[1]}function a(f){return[-f[1],f[0]]}function c(f,C){let p=o(f,C[0]),E=p;for(let v=1;v<C.length;v++){let z=o(f,C[v]);p=Math.min(p,z),E=Math.max(E,z)}return[p,E]}function h(f,C){return f[0]<=C[1]&&C[0]<=f[1]}let d=i(s),g=i(r);for(let f of d.concat(g)){let C=a(f),p=c(C,s),E=c(C,r);if(!h(p,E))return!1}return!0}static calcPolygonCentroid(e){if(!e||e.length===0)throw new Error("顶点数组不能为空");let t=0,s=0;const r=e.length;for(let i=0;i<r;i++)t+=e[i].x,s+=e[i].y;return t/=r,s/=r,{x:t,y:s}}static calcCenter(e){const t=S.getBoxPoints(e);return l.calcPolygonCentroid(t)}static calcTargetPoint(e,t,s){const r=l.angleToRadian(s),i=e.x+t*Math.cos(r),o=e.y+t*Math.sin(r);return{x:i,y:o}}static calcAngle(e,t){const s=t.x-e.x,r=t.y-e.y;return Math.atan2(r,s)*(180/Math.PI)}static calcInternalAngle(e){return 180-l.calcTriangleAngle(e[0],e[3],e[2])}static calcLeanYAngle(e,t){return t?e-90:90-e}static calcLeanYAngleByPoints(e,t){return l.calcLeanYAngle(l.calcInternalAngle(e),t)}static calcUnLeanByPoints(e,t,s){if(t===0&&s===0)return e;const r=l.calcCenter(e);return l.batchLeanWithCenter(e,-t,-s,r)}static calcFlipXByPoints(e){const t=l.calcCenter(e);return l.isPointClockwiseOfLine(t,e[0],e[3])}static calcViewAngleByPoints(e){const t=l.calcAngle(e[2],e[1]);return l.mirrorAngle(t+90)}static calcActualAngleByPoints(e){const t=l.calcInternalAngle(e),s=l.calcLeanYAngle(t,l.calcFlipXByPoints(e)),r=l.calcViewAngleByPoints(e);return l.mirrorAngle(r-s)}static mirrorAngle(e){for(;e>180;)e-=360;for(;e<-180;)e+=360;return e}static normalizeAngle(e){return e<0&&(e=e+360),e}static calcSegmentLineCenterCrossPoint(e,t,s,r){const i=l.calcCenter([e,t]),o=l.calcAngle(e,t);return l.calcTargetPoint(i,r,s?o+90:o-90)}static calcProjectionOnSegment(e,t,s){const r=l.calcSegmentProportion(e,t,s),i=t.x+r*(s.x-t.x),o=t.y+r*(s.y-t.y);return{x:i,y:o}}static calcDistancePointToLine(e,t,s){const{x:r,y:i}=l.calcProjectionOnSegment(e,t,s);return Math.sqrt((e.x-r)*(e.x-r)+(e.y-i)*(e.y-i))}static calcSegmentProportion(e,t,s){const r=s.x-t.x,i=s.y-t.y,o=e.x-t.x,a=e.y-t.y,c=r*r+i*i;return(o*r+a*i)/c}static isProjectionOnSegment(e,t,s){const r=l.calcSegmentProportion(e,t,s);return r>=0&&r<=1}static calcLimitPointOnSegment(e,t,s){const r=l.calcSegmentProportion(e,t,s);if(r<0)return t;if(r>1)return s}static calcInnerLimitPointOnSegment(e,t,s,r){const i=l.calcSegmentProportion(e,t,s);if(i<0){const o=l.calcAngle(t,s);return l.calcTargetPoint(t,r,o)}else if(i>1){const o=l.calcAngle(s,t);return l.calcTargetPoint(s,r,o)}return e}static isPointClosestSegment(e,t,s,r){return l.isProjectionOnSegment(e,t,s)?l.calcDistancePointToLine(e,t,s)<r:!1}static isPointClosest(e,t,s){return l.calcDistance(e,t)<=s}static isPointClosestWhichPoint(e,t,s){for(let r=0;r<t.length;r++)if(l.isPointClosest(e,t[r],s))return r}static transformToAcuteAngle(e){return e>90&&(e=180-e),e}static calcDistance(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static isRectangle(e){if(e.length!==4)return!1;const t=[l.calcDistance(e[0],e[1]),l.calcDistance(e[1],e[2]),l.calcDistance(e[2],e[3]),l.calcDistance(e[3],e[0])];return new Set(t).size===2}static isSameSign(e,t){return e*t>=0}static precise(e,t=2){if(typeof e!="number"||typeof t!="number")throw new TypeError("Both arguments must be numbers");if(!isFinite(e))return e;const s=Math.pow(10,t),o=(Math.round(e*s)/s).toString().split(".");for(o.length===1&&o.push("");o[1].length<t;)o[1]+="0";return Number(o.join("."))}static batchPrecise(e,t){return e.map(s=>l.precise(s,t))}static precisePoint(e,t){return{x:l.precise(e.x,t),y:l.precise(e.y,t)}}static batchPrecisePoint(e,t){return e.map(s=>l.precisePoint(s,t))}static calcTriangleAngle(e,t,s){let r={x:t.x-e.x,y:t.y-e.y},i={x:s.x-t.x,y:s.y-t.y},o=r.x*i.x+r.y*i.y,a=Math.sqrt(r.x*r.x+r.y*r.y),c=Math.sqrt(i.x*i.x+i.y*i.y),h=o/(a*c),g=Math.acos(h)*(180/Math.PI);return isNaN(g)&&(g=0),g}static calcTriangleAngleWithClockwise(e,t,s){const r=l.calcTriangleAngle(e,t,s);return l.isPointClockwiseOfLine(t,e,s)?r:180-r}static calcTriangleAngle2(e,t,s){return Math.acos((Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))/(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2)))*(180/Math.PI)}static calcTriangleAngle3(e,t,s){return Math.acos((Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2))/(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)))*(180/Math.PI)}static calcVectorC(e,t){const s=e.x+t.x,r=e.y+t.y;return{x:s,y:r}}static calcVector(e,t){const s=t.x-e.x,r=t.y-e.y;return{x:s,y:r}}static translateVector(e,t){const s=e.x-t.x,r=e.y-t.y;return{x:s,y:r}}static calcTriangleSide1By2(e,t){const s=e*l.angleToRadian(e);return t/Math.tan(s)}static calcTriangleSide3By1(e,t){const s=e*l.angleToRadian(e);return t/Math.cos(s)}static calcTriangleSide3By2(e,t){const s=l.angleToRadian(e);return t/Math.sin(s)}static calcTriangleSide1By3(e,t){const s=l.angleToRadian(e);return t*Math.cos(s)}static calcTriangleSide2By3(e,t){const s=l.angleToRadian(e);return t*Math.sin(s)}static sortPointsClockwise(e){let t=l.calcCenter(e);return l.sortPointsClockwiseByCenter(e,t)}static sortPointsClockwiseByCenter(e,t){let s=e.map((i,o)=>{let a=Math.atan2(i.y-t.y,i.x-t.x);return{index:o,angle:a}});s.sort((i,o)=>i.angle-o.angle);let r=[];for(let i=0;i<s.length;i++)r.push(e[s[i].index]);return r}static calcPointToSegmentCenterAngle(e,t,s){const r=l.calcCenter([t,s]);return l.calcAngle(e,r)}static resignValue(e,t){return e>=0?Math.abs(t):-Math.abs(t)}static isPointClockwiseOfLine(e,t,s){return(e.x-t.x)*(s.y-t.y)-(e.y-t.y)*(s.x-t.x)<0}static getScaleFromMatrix(e){return{scaleX:e[0][0],scaleY:e[1][1]}}static calculateAngleBisectorIntersection(e){if(e.length!==4)throw new Error("必须提供四个顶点坐标");const t=l.calcBisectors(e),{width:s,height:r}=l.calcParallelogramVerticalSize(e),i=[];return s<r?(i.push(l.calcIntersectionOfLines(t[0],t[1])),i.push(l.calcIntersectionOfLines(t[2],t[3]))):(i.push(l.calcIntersectionOfLines(t[0],t[3])),i.push(l.calcIntersectionOfLines(t[1],t[2]))),i}static calcIntersectionOfLines(e,t){const s=e.point,r=e.direction,i=t.point,o=t.direction,a=r.x*o.y-r.y*o.x;if(Math.abs(a)<1e-6)return null;const c=i.x-s.x,h=i.y-s.y,d=(c*o.y-h*o.x)/a;return(c*r.y-h*r.x)/a,l.precisePoint({x:s.x+d*r.x,y:s.y+d*r.y},1)}static calcBisectors(e){const[t,s,r,i]=e;return e.map((o,a)=>{let c,h;switch(a){case 0:c={x:s.x-t.x,y:s.y-t.y},h={x:i.x-t.x,y:i.y-t.y};break;case 1:c={x:t.x-s.x,y:t.y-s.y},h={x:r.x-s.x,y:r.y-s.y};break;case 2:c={x:s.x-r.x,y:s.y-r.y},h={x:i.x-r.x,y:i.y-r.y};break;case 3:c={x:r.x-i.x,y:r.y-i.y},h={x:t.x-i.x,y:t.y-i.y};break;default:throw new Error("无效的顶点索引")}const d=Math.hypot(c.x,c.y),g=Math.hypot(h.x,h.y),f={x:c.x/d,y:c.y/d},C={x:h.x/g,y:h.y/g},p={x:f.x+C.x,y:f.y+C.y};return{point:o,direction:p}})}static calcCrossPointsOfParallelLines(e,t){const[s,r,i,o]=t,a={x:r.x-s.x,y:r.y-s.y},c={x:i.x-r.x,y:i.y-r.y},h={x:o.x-i.x,y:o.y-i.y},d={x:s.x-o.x,y:s.y-o.y},g={x:s.x-r.x,y:s.y-r.y},f=l.calcIntersectionOfLines({point:s,direction:a},{point:e,direction:d}),C=l.calcIntersectionOfLines({point:r,direction:c},{point:e,direction:a}),p=l.calcIntersectionOfLines({point:i,direction:h},{point:e,direction:c}),E=l.calcIntersectionOfLines({point:o,direction:d},{point:e,direction:g});return[f,C,p,E]}static calcTriangleArea(e,t,s){const r=l.calcDistance(e,t),i=l.calcDistance(t,s),o=l.calcDistance(s,e),a=(r+i+o)/2;return Math.sqrt(a*(a-r)*(a-i)*(a-o))}static calcParallelogramVerticalIntersectionPoints(e,t,s){const[r,i,o,a]=t;let c=l.calcProjectionOnSegment(e,a,r),h=l.calcProjectionOnSegment(e,r,i),d=l.calcProjectionOnSegment(e,i,o),g=l.calcProjectionOnSegment(e,o,a);return s&&(l.isProjectionOnSegment(c,a,r)||(c=l.calcInnerLimitPointOnSegment(c,a,r,.01)),l.isProjectionOnSegment(h,r,i)||(h=l.calcInnerLimitPointOnSegment(h,r,i,.01)),l.isProjectionOnSegment(d,i,o)||(d=l.calcInnerLimitPointOnSegment(d,i,o,.01)),l.isProjectionOnSegment(g,o,a)||(g=l.calcInnerLimitPointOnSegment(g,o,a,.01))),[c,h,d,g]}static calcParallelogramVerticalSize(e){const[t,s,r,i]=e,o=l.calcDistancePointToLine(t,s,r),a=l.calcDistancePointToLine(t,r,i);return{width:o,height:a}}static calcMirrorPointToLine(e,t,s){const r=l.calcProjectionOnSegment(e,t,s),i=l.calcDistance(e,r),o=l.calcAngle(t,s);return l.calcTargetPoint(r,i*2,o)}}var b=en();class S{static getMinX(e){return Math.min(...e.map(t=>t.x))}static getMinY(e){return Math.min(...e.map(t=>t.y))}static getBoxPoints(e){let t=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER;return e.forEach(o=>{t=Math.min(t,o.x),s=Math.min(s,o.y),r=Math.max(r,o.x),i=Math.max(i,o.y)}),[{x:t,y:s},{x:r,y:s},{x:r,y:i},{x:t,y:i}]}static getRect(e){let t=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER;return e.forEach(o=>{t=Math.min(t,o.x),s=Math.min(s,o.y),r=Math.max(r,o.x),i=Math.max(i,o.y)}),{x:t,y:s,width:r-t,height:i-s}}static getDateId(){return+new Date}static getRandomId(){return Ue(8)}static getEventPosition(e,t,s){return s=s||1,{x:(e.clientX-t.x)/s,y:(e.clientY-t.y)/s}}static getBoxVertices(e,t){return[{x:e.x-t.width/2,y:e.y-t.height/2},{x:e.x+t.width/2,y:e.y-t.height/2},{x:e.x+t.width/2,y:e.y+t.height/2},{x:e.x-t.width/2,y:e.y+t.height/2}]}static getRectVertices(e){return[{x:0,y:0},{x:e.width,y:0},{x:e.width,y:e.height},{x:0,y:e.height}]}static getLBRPoints(e,t){let[s,r,i]=S.getLBRPointIndexes(e,t);return s===r&&(s=S.getPrevIndexOfArray(e.length,s)),r===i&&(i=S.getNextIndexOfArray(e.length,i)),[e[s],e[r],e[i]]}static getLBRPointIndexes(e,t){let s,r,i;return t=t??!1,e.forEach((o,a)=>{t||((s===void 0||o.x<e[s].x)&&(s=a),(i===void 0||o.x>e[i].x)&&(i=a)),(r===void 0||o.y>e[r].y)&&(r=a)}),t&&(s=S.getPrevIndexOfArray(e.length,r),i=S.getNextIndexOfArray(e.length,r)),[s,r,i]}static get4BoxPoints(e,t,s){const r=[{x:e.x-t.width/2,y:e.y-t.height/2},{x:e.x+t.width/2,y:e.y-t.height/2},{x:e.x+t.width/2,y:e.y+t.height/2},{x:e.x-t.width/2,y:e.y+t.height/2}];return r.forEach(i=>{Object.assign(i,l.transWithCenter(i,s,e))}),r}static getPrevIndexOfArray(e,t,s=1){let r;for(;r=t-s,r<0&&(r=e+r),!(r>=0););return r}static getPrevOfArray(e,t,s=1){return e[S.getPrevIndexOfArray(e.length,t,s)]}static getNextIndexOfArray(e,t,s=1){let r;for(;r=t+s,r>=e&&(r=r-e),!(r<e););return r}static getNextOfArray(e,t,s=1){return e[S.getNextIndexOfArray(e.length,t,s)]}static calcRectangleSize(e){const t=l.precise(l.calcDistance(e[0],e[1])),s=l.precise(l.calcDistance(e[0],e[3]));return{width:t,height:s}}static calcLineSize(e){const t=l.precise(Math.abs(e[0].x-e[1].x)),s=l.precise(Math.abs(e[0].y-e[1].y));return{width:t,height:s}}static scalePoint(e,t){return{x:e.x*t,y:e.y*t}}static scalePoints(e,t){return t===1?e:e.map(s=>S.scalePoint(s,t))}static calcScale(e,t,s=0){const r=(e.width-s*2)/t.width,i=(e.height-s*2)/t.height;return Math.min(r,i)}static calcRectangleSizeInRect(e,t,s,r=0){const i=s.width-r*2,o=s.height-r*2;if(e>i||t>o){const a=l.precise(e/t,1),c=l.precise(s.width/s.height,2);a>c?(e=i,t=l.precise(e/a,1)):(t=o,e=l.precise(t*a,1))}return{width:e,height:t}}static calcCenterInnerRectPoints(e,t){const{width:s,height:r}=e,{width:i,height:o}=t;return[{x:i/2-s/2,y:o/2-r/2},{x:i/2+s/2,y:o/2-r/2},{x:i/2+s/2,y:o/2+r/2},{x:i/2-s/2,y:o/2+r/2}]}static scaleRect(e,t){const s={};return["x","y","width","height","left","top","right","bottom"].forEach(r=>{const i=e[r];b.isNumber(i)&&(s[r]=l.precise(i*t))}),s}static sortPointsByY(e){return e.sort((t,s)=>t.y-s.y)}static sortPointsByX(e){return e.sort((t,s)=>t.x-s.x)}static calcRotateBoxRect(e,t){const s=l.calcDistance(e[0],e[1]),r=l.calcDistancePointToLine(e[0],e[2],e[3]);return{x:t.x-s/2,y:t.y-r/2,width:s,height:r}}}class yt{constructor(){u(this,"id");this.id=`${S.getDateId()}`}run(){return Promise.resolve()}}class He extends yt{constructor(t,s){super();u(this,"element");u(this,"canvas");this.element=t,s&&(this.canvas=s.canvas)}destroy(){return this.element=null,this.canvas=null,Promise.resolve()}}var P=(n=>(n.moveable="moveable",n.hand="hand",n.rectangle="rectangle",n.line="line",n.image="image",n.polygon="polygon",n.arbitrary="arbitrary",n.pencil="pencil",n.text="text",n.group="group",n.ellipse="ellipse",n))(P||{}),se=(n=>(n.cursor="cursor",n.shapes="shapes",n.freedom="freedom",n))(se||{}),U=(n=>(n[n.inside=0]="inside",n[n.middle=1]="middle",n[n.outside=2]="outside",n))(U||{});const ds=[{type:0,name:"内描边"},{type:1,name:"平分线宽"},{type:2,name:"外描边"}],mn=[{type:1,name:"平分线宽"}];function pn(n){switch(n){case P.arbitrary:case P.rectangle:case P.ellipse:case P.image:return ds;case P.line:return mn;default:return ds}}const Cn=1,_n="#000000",En=1,yn="#999999",vn=.15,wn=1,bn=12,Sn="sans-serif",xn="center",An="middle",Pn=1,Rn=100,vt={type:Cn,width:wn,color:_n,colorOpacity:En},wt={color:yn,colorOpacity:vn},Je={strokes:[{...vt}],fills:[{...wt}],fontSize:bn,fontFamily:Sn,textAlign:xn,textBaseline:An},us=n=>{const e=b.cloneDeep(Je);return[P.line,P.arbitrary].includes(n)&&e.strokes.forEach(t=>{t.width=Pn}),[P.image,P.arbitrary].includes(n)&&e.fills.forEach(t=>{t.colorOpacity=0}),e};class gs{static hashToRgba(e,t){if(!/^#([0-9A-F]{3}){1,2}$/i.test(e))throw new Error("Invalid color format");let s=e.slice(1);s.length===3&&(s=s.split("").map(a=>a+a).join(""));const r=parseInt(s.substring(0,2),16),i=parseInt(s.substring(2,4),16),o=parseInt(s.substring(4,6),16);return`rgba(${r}, ${i}, ${o}, ${t})`}static getRandomColor(){const e="0123456789ABCDEF";let t="#";for(let s=0;s<6;s++)t+=e[Math.floor(Math.random()*16)];return t}}class ve{static joinFillColor(e){return e.color?`${gs.hashToRgba(e.color,e.colorOpacity)}`:""}static joinStrokeColor(e){return e.color?`${gs.hashToRgba(e.color,e.colorOpacity)}`:""}static joinFont(e){return`${e.fontSize}px ${e.fontFamily}`}}class pe{static calcIOPoint(e,t,s,r,i){const o=s/2,a=l.calcTriangleSide3By2(o,r);let c=l.calcAngle(e,t);c<0&&(c+=360);let h=o+c;return l.calcTargetPoint(e,a,i?h:h+180)}static getPolygonVertices(e,t,s){const r=l.sortPointsClockwise(e);return r.map((i,o)=>{const a=S.getPrevOfArray(r,o),c=S.getNextOfArray(r,o),h=l.calcTriangleAngle(a,i,c);return pe.calcIOPoint(i,c,h,t,s)})}static getPolygonInnerVertices(e,t){return pe.getPolygonVertices(e,t,!0)}static getPolygonOuterVertices(e,t){return pe.getPolygonVertices(e,t,!1)}static calcBentLineOuterVertices(e,t){const s=[];return s.push(...pe.calcBentLineClockWisePoints(e,t,!0)),s.push(...pe.calcBentLineClockWisePoints(e.reverse(),t,!0)),s}static calcBentLineClockWisePoints(e,t,s){const r=[];for(let i=0;i<e.length-1;i++){const o=e[i],a=e[i+1];let c=l.calcAngle(o,a);s?c=c+90:c=c-90,r.push(l.calcTargetPoint(o,t,c)),i===e.length-2&&r.push(l.calcTargetPoint(a,t,c))}return r}}class ye{static getArbitraryInnerVertices(e,t,s){return ye.getArbitraryVertices(e,t,!0,s)}static getArbitraryOuterVertices(e,t,s){return ye.getArbitraryVertices(e,t,!1,s)}static getArbitraryVertices(e,t,s,r){return e.length===1?e:e.length===2?pe.calcBentLineClockWisePoints(e,t,s):e.map((i,o)=>{const a=S.getPrevOfArray(e,o),c=S.getNextOfArray(e,o),h=l.isPointClockwiseOfLine(c,a,i);let d=l.calcTriangleAngle(a,i,c);h?d=180-d:d=180+d;const{isFold:g=!0}=r;if(!g&&[0,e.length-1].includes(o)){let f;return o===0?f=l.calcAngle(i,c)+(s?90:-90):f=l.calcAngle(i,a)+(s?-90:90),l.calcTargetPoint(i,t,f)}else return pe.calcIOPoint(i,c,d,t,s)})}}const T=class T{static convertPointsByStrokeType(e,t,s,r){if(!s)return e;const{flipX:i=!1,flipY:o=!1}=r,a=s/2;switch(t){case U.inside:return i!==o?ye.getArbitraryOuterVertices(e,a,r):ye.getArbitraryInnerVertices(e,a,r);case U.middle:return e;case U.outside:return i!==o?ye.getArbitraryInnerVertices(e,a,r):ye.getArbitraryOuterVertices(e,a,r)}}static async drawImgLike(e,t,s,r={}){return new Promise((i,o)=>{if(t instanceof ImageData&&(t=T.getCanvasByImageData(t).toDataURL()),typeof t=="string"){if(T.ImageCaches.has(t)){T.drawRotateImage(e,T.ImageCaches.get(t),s,r),i();return}const a=new Image;a.src=t,a.onload=()=>{T.ImageCaches.set(t,a),T.drawRotateImage(e,a,s,r),i()},a.onerror=()=>{o()}}else(t instanceof HTMLCanvasElement||t instanceof HTMLImageElement)&&T.drawRotateImage(e,t,s,r),i()})}static getTransformValues(e){let{angle:t=0,flipX:s=!1,leanY:r,actualAngle:i}=e;typeof i=="number"&&(t=i);let o=l.angleToRadian(t),a=1,c=1;return s&&(a=-1,o=-o,r=-r),{radian:o,scaleX:a,scaleY:c,leanY:r}}static transformCtx(e,t,s){const{x:r,y:i,width:o,height:a}=t,{radian:c,scaleX:h,scaleY:d,leanY:g}=s;e.translate(r+o/2,i+a/2),e.scale(h,d),e.rotate(c),e.transform(1,0,g,1,0,0)}static calcOffsetByRect(e){return{x:-(e.x+e.width/2),y:-(e.y+e.height/2)}}static translatePoints(e,t){const s=T.calcOffsetByRect(t);return e.map(r=>l.translate(r,s))}static translateArcPoints(e,t){const s=T.calcOffsetByRect(t);return l.translateArcPoints(e,s)}static drawClipArcPoints(e,t,s){t=T.transArcParamsWithScale(t)[0],t=T.translateArcPoints(t,s),e.beginPath(),T.drawBazierPoints(t,e),e.closePath(),e.clip()}static drawRotateImage(e,t,s,r={}){const{width:i,height:o}=s,a=e.getContext("2d");a.save(),T.transformCtx(a,s,this.getTransformValues(r)),r.clipArcPoints&&T.drawClipArcPoints(a,r.clipArcPoints,s),a.drawImage(t,-i/2,-o/2,i,o),a.restore()}static drawRotateImageData(e,t,s,r={}){const i=T.getCanvasByImageData(t);T.drawRotateImage(e,i,s,r)}static drawRotateText(e,t,s,r,i,o={}){const{angle:a=0}=o,c=e.getContext("2d");c.save(),c.translate(s.x,s.y),c.rotate(l.angleToRadian(a)),c.font=ve.joinFont(r),c.fillStyle=ve.joinFillColor(i),c.textAlign=r.textAlign,c.textBaseline=r.textBaseline,c.fillText(t,0,0),c.restore()}static drawRotateTextWithScale(e,t,s,r,i,o={}){T.scale!==1&&(s={x:s.x*T.scale,y:s.y*T.scale}),T.drawRotateText(e,t,s,r,i,o)}static transParamsWithScale(e,t){return T.scale===1?[e,t]:(e=S.scalePoints(e,T.scale),t&&(t={...t,width:t.width*T.scale}),[e,t])}static transArcParamsWithScale(e,t){return T.scale===1?[e,t]:(e=T.scaleArcPoints(e),t&&(t={...t,width:t.width*T.scale}),[e,t])}static transEllipseModelWithScale(e){return T.scale===1?e:{...e,rx:e.rx*T.scale,ry:e.ry*T.scale}}static drawPathWithScale(e,t,s,r,i,o={}){[t,i]=T.transParamsWithScale(t,i),r.colorOpacity&&T.drawInnerPathFill(e,t,r,i,o),i.width&&i.colorOpacity&&T.drawPathStroke(e,t,i,o)}static drawInnerPathFill(e,t,s,r,i={}){const{calcVertices:o=!0}=i;let a;o?a=ye.getArbitraryInnerVertices(t,r.width/2,i):a=t,T.drawPathFill(e,a,s)}static drawInnerPathFillWithScale(e,t,s,r,i={}){[t,r]=T.transParamsWithScale(t,r),s.colorOpacity&&T.drawInnerPathFill(e,t,s,r,i)}static scaleArcPoints(e){return T.scale===1||(e=e.map(t=>{const{start:s,controller:r,end:i,value:o,corner:a}=t,[c,h,d,g]=S.scalePoints([s,r,i,a],T.scale);return{start:c,controller:h,end:d,corner:g,value:o*T.scale}})),e}static drawInnerArcPathFillWithScale(e,t,s,r,i={}){s=T.scaleArcPoints(s),r.colorOpacity&&T.drawArcPathFill(e,s,t,r,i)}static drawPathStrokeWidthScale(e,t,s,r={}){[t,s]=T.transParamsWithScale(t,s),T.drawPathStroke(e,t,s,r)}static drawArcPathStrokeWidthScale(e,t,s,r,i={}){[t,r]=T.transArcParamsWithScale(t,r),T.drawArcPathStroke(e,t,s,r,i)}static drawPathStroke(e,t,s,r={}){const{isFold:i=!0,miterLimit:o}=r,a=e.getContext("2d");a.save(),o&&(a.miterLimit=o),a.strokeStyle=ve.joinStrokeColor(s),a.beginPath(),t.forEach((c,h)=>{h===0?a.moveTo(c.x,c.y):a.lineTo(c.x,c.y)}),i&&a.closePath(),s.width&&(a.lineWidth=s.width,a.stroke()),a.restore()}static calcStartOfArcPoints(e){let t=0,s;const[r,i,o]=e,a=e.map(d=>d.controller),{width:c,height:h}=l.calcParallelogramVerticalSize(a);return c>=h?(s=l.calcCenter([r.end,i.start]),t=1):(s=l.calcCenter([i.end,o.start]),t=2),{point:s,index:t}}static arcToBezierPoints(e,t){let{point:s,index:r}=T.calcStartOfArcPoints(e),i=0,o=e[r];for(;o;){const{start:a,controller:c,end:h,corner:d,value:g}=o;if(i===0&&t.moveTo(s.x,s.y),g){const f=l.calcDistance(a,d);t.arcTo(c.x,c.y,h.x,h.y,f)}else t.lineTo(c.x,c.y);if(o=S.getNextOfArray(e,r,1),r++,r>=e.length&&(r=0),i++,i>=e.length)break}}static drawBazierPoints(e,t){e.forEach((s,r)=>{const{start:i,controller:o,end:a,value:c}=s;r===0?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y),c?t.arcTo(o.x,o.y,a.x,a.y,c):t.lineTo(o.x,o.y)})}static drawArcPathStroke(e,t,s,r,i={}){const{isFold:o=!0}=i,a=e.getContext("2d");a.save(),T.transformCtx(a,s,T.getTransformValues(i)),a.miterLimit=0,a.lineCap="round",a.strokeStyle=ve.joinStrokeColor(r),a.beginPath(),t=T.translateArcPoints(t,s),T.drawBazierPoints(t,a),o&&a.closePath(),r.width&&(a.lineWidth=r.width,a.stroke()),a.restore()}static drawPathFill(e,t,s){const r=e.getContext("2d");r.save(),r.fillStyle=ve.joinFillColor(s),r.beginPath(),t.forEach((i,o)=>{o===0?r.moveTo(i.x,i.y):r.lineTo(i.x,i.y)}),r.closePath(),r.fill(),r.restore()}static drawArcPathFill(e,t,s,r,i={}){const o=e.getContext("2d");o.save(),T.transformCtx(o,s,T.getTransformValues(i)),o.fillStyle=ve.joinFillColor(r),o.beginPath(),t=T.translateArcPoints(t,s),T.drawBazierPoints(t,o),o.closePath(),o.fill(),o.restore()}static transformEllipse(e,t,s,r,i){return r&&i&&(T.transformCtx(e,r,T.getTransformValues(i)),t=T.translatePoints([t],r)[0]),s=T.transEllipseModelWithScale(s),{point:t,model:s}}static drawEllipseFill(e,t,s,r,i,o){const a=e.getContext("2d");a.save();const{point:{x:c,y:h},model:{rx:d,ry:g}}=T.transformEllipse(a,t,s,i,o);a.fillStyle=ve.joinFillColor(r),a.beginPath(),a.ellipse(c,h,d,g,0,0,Math.PI*2),a.closePath(),a.fill(),a.restore()}static drawEllipseStroke(e,t,s,r,i,o){const a=e.getContext("2d");a.save();const{point:{x:c,y:h},model:{rx:d,ry:g}}=T.transformEllipse(a,t,s,i,o);a.lineWidth=r.width,a.strokeStyle=ve.joinStrokeColor(r),a.beginPath(),a.ellipse(c,h,d,g,0,0,Math.PI*2),a.closePath(),a.stroke(),a.restore()}static drawEllipseStrokeWithScale(e,t,s,r,i,o){const[a,c]=T.transParamsWithScale([t],r);T.drawEllipseStroke(e,a[0],s,c,i,o)}static drawEllipseFillWithScale(e,t,s,r,i,o){const[a]=T.transParamsWithScale([t]);T.drawEllipseFill(e,a[0],s,r,i,o)}static drawLine(e,t,s){const r=e.getContext("2d");r.save(),r.beginPath(),r.lineWidth=s.width,r.strokeStyle=ve.joinStrokeColor(s),t.forEach((i,o)=>{o===0?r.moveTo(i.x,i.y):r.lineTo(i.x,i.y)}),r.closePath(),r.stroke(),r.restore()}static drawLineWidthScale(e,t,s){[t,s]=T.transParamsWithScale(t,s),T.drawLine(e,t,s)}static getImageDataFromBlob(e){return new Promise((t,s)=>{const r=new Image;r.onload=()=>{const i=document.createElement("canvas");i.width=r.width,i.height=r.height;const o=i.getContext("2d");o.drawImage(r,0,0);const a=o.getImageData(0,0,r.width,r.height);t(a)},r.onerror=s,r.src=URL.createObjectURL(e)})}static getImageDataFromImage(e){return new Promise((t,s)=>{const r=document.createElement("canvas");r.width=e.width,r.height=e.height;const i=r.getContext("2d");i?(i.drawImage(e,0,0),t(i.getImageData(0,0,e.width,e.height))):s(new Error("Failed to get 2d context from canvas"))})}static getCanvasByImageData(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const s=t.getContext("2d");return s&&s.putImageData(e,0,0),t}static getDataUrlFromImage(e){return new Promise((t,s)=>{const r=document.createElement("canvas");r.width=e.width,r.height=e.height;const i=r.getContext("2d");i?(i.drawImage(e,0,0),t(r.toDataURL())):s(new Error("Failed to get 2d context from canvas"))})}};u(T,"ImageCaches",new Map),u(T,"scale",1);let q=T;class Tn extends He{async run(){if(!this.canvas||!this.element)return;const{arcCoords:e,arcFillCoords:t,model:{styles:s},angle:r,flipX:i,leanY:o,actualAngle:a,rotateBoxCoords:c,center:h}=this.element,d={angle:r,flipX:i,leanY:o,actualAngle:a},g=x.batchCalcStageRelativeArcPoints(e),f=x.calcStageRelativePoints(c),C=x.calcStageRelativeArcPoints(t);let p=S.calcRotateBoxRect(f,h);p=S.scaleRect(p,this.element.shield.stageScale),s.fills.forEach(E=>{q.drawInnerArcPathFillWithScale(this.canvas,p,C,E,d)}),g.forEach((E,v)=>{q.drawArcPathStrokeWidthScale(this.canvas,E,p,s.strokes[v],d)})}}const kn={subs:!1,deepSubs:!1},Ut={angle:0,leanYAngle:0,internalAngle:90,actualAngle:0,viewAngle:0},Qe={corners:[0,0,0,0]},On={view:!0,leanY:!0,actual:!0,internal:!0},In={size:!0,position:!0,points:!0,rotation:!0,angles:!0,originals:!0,outline:!0,strokes:!0,corners:!0},Bn="#0c8ce9",Ln=1,Mn="#0c8ce9",Fn=.025,Dn=1,Wn="#0c8ce9",Vn=1,zn="#ffffff",Nn=1,Gn=1,ht=6,dt=12,jn=12,Hn=12,Yn="#0c8ce9",$n=1,qn=12,Xn="Arial",Un="center",Kn="middle",Jn=ht+Math.sqrt(Math.pow(dt/2,2)),Ot={strokes:[{type:U.middle,width:Dn,color:Bn,colorOpacity:Ln}],fills:[{color:Mn,colorOpacity:Fn}]},De={strokes:[{type:U.middle,width:Gn,color:Wn,colorOpacity:Vn}],fills:[{color:zn,colorOpacity:Nn}]},Wt={fontSize:qn,fontFamily:Xn,fills:[{color:Yn,colorOpacity:$n}],textAlign:Un,textBaseline:Kn},fs=Wt,ms=20,Vt=3;class Xs{constructor(e){u(this,"id");u(this,"isActive");u(this,"host");this.host=e,this.id=S.getRandomId(),this.isActive=!1}get angle(){return 0}get scale(){return 1/this.host.shield.stageScale}isCoordHitting(e){return!1}}class Kt extends Xs{constructor(t,s){super(t);u(this,"width");u(this,"height");u(this,"x");u(this,"y");u(this,"points");const{points:r=[],x:i=0,y:o=0,width:a=0,height:c=0}=s||{};this.points=r,this.x=i,this.y=o,this.width=a,this.height=c}isContainsCoord(t){return l.isPointInPolygonByRayCasting(t,this.points)}isCoordHitting(t){return this.isContainsCoord(t)}}class tt extends Kt{constructor(){super(...arguments);u(this,"width",dt);u(this,"height",dt)}get angle(){return this.host.viewAngle-90}refresh(){if(!this.host.rotationEnable)return;const t=this.host.shield.stageScale,{x:s,y:r}=x.calcElementRotatePoint(this.host);this.x=s,this.y=r,this.points=S.getBoxVertices({x:s,y:r},{width:this.width/t,height:this.height/t}).map(i=>l.rotateWithCenter(i,this.host.viewAngle,{x:s,y:r}))}isContainsCoord(t){return this.host.rotationEnable?l.isPointInPolygonByRayCasting(t,this.points):!1}}var Ie=(n=>(n[n.rect=0]="rect",n[n.circle=1]="circle",n))(Ie||{});class Ne extends Kt{get angle(){return l.calcAngle(this.host.centerCoord,{x:this.x,y:this.y})+90}}class Qn extends Xs{constructor(t,s){super(t);u(this,"start");u(this,"end");u(this,"index");const{start:r,end:i,index:o}=s||{};r&&(this.start=r),i&&(this.end=i),b.isNumber(o)&&(this.index=o)}get angle(){return l.calcAngle(this.start,this.end)}isClosest(t){return l.isPointClosestSegment(t,this.start,this.end,hn/this.host.shield.stageScale)}isCoordHitting(t){return this.isClosest(t)}}class Ze extends Qn{}const Zn=[.25,.5,1,2,3,4,5];var ot=(n=>(n[n.vertices=0]="vertices",n[n.border=1]="border",n))(ot||{}),de=(n=>(n[n.vertices=0]="vertices",n[n.border=1]="border",n[n.hand=2]="hand",n[n.cross=3]="cross",n[n.move=4]="move",n[n.rotation=5]="rotation",n))(de||{});const ei=100;class Us extends tt{get angle(){return l.calcAngle(this.host.centerCoord,{x:this.x,y:this.y})+45}}const xe={type:P.moveable,name:"移动",category:se.cursor,icon:"icon-verbise-arrow-cursor-2--mouse-select-cursor",shortcut:"ctrl+m"},zt={type:P.hand,name:"手型",category:se.cursor,icon:"icon-verbise-hand",shortcut:"ctrl+h"},Jt={type:P.rectangle,name:"矩形",category:se.shapes,icon:"icon-verbise-Rectangle"},ti={type:P.line,name:"直线",category:se.shapes,icon:"icon-verbise-line"},si={type:P.polygon,name:"多边形",category:se.shapes,icon:"icon-verbise-polygon"},ri={type:P.image,name:"图片",category:se.shapes,icon:"icon-verbise-Image"},Qt={type:P.arbitrary,name:"线条",category:se.freedom,icon:"icon-verbise-pen"},ni={type:P.pencil,name:"画笔",category:se.freedom,icon:"icon-verbise-pencil"},ii={type:P.ellipse,name:"椭圆",category:se.shapes,icon:"icon-verbise-eclipse"},Ks=[xe,zt],Js=[Jt,ti,ii,si,ri],Qs=[Qt,ni],oi=[xe,...Ks,Jt,...Js,Qt,...Qs];class Zs{static getCreatorByType(e){return oi.find(t=>t.type===e)}static isElement(e){return[P.image,P.text,P.arbitrary,P.rectangle,P.ellipse,P.polygon,P.line,P.text,P.pencil].includes(e)}}let Le=class{constructor(e,t,s){u(this,"model");u(this,"rotation");u(this,"shield");u(this,"node");u(this,"_originalTransformerCoords",[]);u(this,"_originalCoords",[]);u(this,"_originalRotateCoords",[]);u(this,"_originalBoxCoords",[]);u(this,"_originalRotateBoxCoords",[]);u(this,"_originalRotateOutlineCoords",[]);u(this,"_originalStrokeCoords",[]);u(this,"_originalUnLeanCoords",[]);u(this,"_originalUnLeanBoxCoords",[]);u(this,"_originalUnLeanStrokeCoords",[]);u(this,"_originalMaxBoxCoords",[]);u(this,"_originalMaxOutlineBoxCoords",[]);u(this,"_originalTransformMatrix",[]);u(this,"_originalTransformMoveCoord");u(this,"_originalCenterCoord");u(this,"_originalAngle",0);u(this,"_originalSize",{});u(this,"_transformMatrix",[]);u(this,"_transformLockCoord");u(this,"_transformLockIndex");u(this,"_unLeanCoords",[]);u(this,"_unLeanBoxCoords",[]);u(this,"_maxBoxCoords",[]);u(this,"_rotateCoords",[]);u(this,"_rotateBoxCoords",[]);u(this,"_maxOutlineBoxCoords",[]);u(this,"_rotateOutlineCoords",[]);u(this,"_strokeCoords",[]);u(this,"_unLeanStrokeCoords",[]);u(this,"_rect",{});u(this,"_transformers",[]);u(this,"_borderTransformers",[]);u(this,"_transformType");u(this,"_rotateControllers",[]);u(this,"_minParallelogramVerticalSize");u(this,"_minLeanSize");u(this,"_flipX",!1);u(this,"_innermostStrokeCoordIndex",0);u(this,"_isRangeElement",!1);u(this,"_status",Q.initialed);u(this,"_isSelected",!1);u(this,"_isVisible",!0);u(this,"_isEditing",!1);u(this,"_isLocked",!1);u(this,"_isMoving",!1);u(this,"_isTransforming",!1);u(this,"_isRotating",!1);u(this,"_isRotatingTarget",!1);u(this,"_isDragging",!1);u(this,"_isCornerMoving",!1);u(this,"_isProvisional",!1);u(this,"_isTarget",!1);u(this,"_isInRange",!1);u(this,"_isOnStage",!1);this.model=e,this.rotation=new tt(this),this.shield=t,this._isRangeElement=s??!1,this.model.boxCoords.length&&(this._flipX=l.calcFlipXByPoints(this.model.boxCoords)),tn(this,{_status:X,_isDragging:X,_isRotating:X,_isTransforming:X,_isRotatingTarget:X,_isProvisional:X,_isOnStage:X,_isEditing:X,_isMoving:X,_isSelected:X,_isVisible:X,_isLocked:X,_isTarget:X,_isInRange:X,_isCornerMoving:X})}get isRangeElement(){return this._isRangeElement}get id(){return this.model.id}get isElement(){return Zs.isElement(this.model.type)}get isGroup(){return this.model.type===P.group}get group(){return this.isGroupSubject?this.shield.store.getElementById(this.model.groupId):null}get ancestorGroup(){if(!this.isGroupSubject)return null;let e=this.group;for(;e&&e.isGroupSubject;)e=e.group;return e}get isGroupSubject(){return this.model.groupId!==void 0}get strokeCoords(){return this._strokeCoords}get unLeanStrokeCoords(){return this._unLeanStrokeCoords}get innermostStrokeCoordIndex(){return this._innermostStrokeCoordIndex}get innermostStrokeCoords(){return this._strokeCoords[this.innermostStrokeCoordIndex]}get flipX(){return!this.flipXEnable||!this.boxVerticesTransformEnable?!1:this._isTransforming?(this._flipX=l.calcFlipXByPoints(this.model.boxCoords),this._flipX):this._flipX}get flipY(){return!1}get flip(){return{flipX:this.flipX,flipY:this.flipY}}get flipXEnable(){return!0}get flipYEnable(){return!0}get widthModifyEnable(){return!0}get heightModifyEnable(){return!0}get rotationEnable(){return!0}get verticesRotationEnable(){return!0}get verticesTransformEnable(){return!1}get boxVerticesTransformEnable(){return!0}get borderTransformEnable(){return!0}get fillEnabled(){return!0}get strokeEnable(){return!0}get ratioLockedEnable(){return!0}get editingEnable(){return!0}get tfRefreshAfterEdChanged(){return!1}get shouldRatioLockResize(){return this.ratioLockedEnable&&(this.isRatioLocked||this.shield.event.isShift)}get originalCoords(){return this._originalCoords}get originalBoxCoords(){return this._originalBoxCoords}get width(){return this.model.width}get height(){return this.model.height}get minParallelogramVerticalSize(){return this._minParallelogramVerticalSize}get minLeanSize(){return this._minLeanSize}get angle(){return this.getAngle()}get corners(){return this.model.corners}get center(){return x.calcStageRelativePoint(this.centerCoord)}get centerCoord(){return this.calcCenterCoord()}get position(){return{x:this.model.x,y:this.model.y}}get strokes(){return this.model.styles.strokes}get fills(){return this.model.styles.fills}get textAlign(){return this.model.styles.textAlign}get textBaseline(){return this.model.styles.textBaseline}get fontSize(){return this.model.styles.fontSize}get fontFamily(){return this.model.styles.fontFamily}get status(){return this._status}set status(e){this._setStatus(e)}get isSelected(){return this._isSelected}set isSelected(e){this._setIsSelected(e)}get isVisible(){return this._isVisible}set isVisible(e){this._setIsVisible(e)}get isEditing(){return this._isEditing}set isEditing(e){this._setIsEditing(e)}get isLocked(){return this._isLocked}set isLocked(e){this._setIsLocked(e)}get isMoving(){return this._isMoving}set isMoving(e){this._setIsMoving(e)}get isTransforming(){return this._isTransforming}set isTransforming(e){this._setIsTransforming(e)}get isRotating(){return this._isRotating}set isRotating(e){this._setIsRotating(e)}get isRotatingTarget(){return this._isRotatingTarget}set isRotatingTarget(e){this._setIsRotatingTarget(e)}get isDragging(){return this._isDragging}set isDragging(e){this._setIsDragging(e)}get isCornerMoving(){return this._isCornerMoving}set isCornerMoving(e){this._setIsCornerMoving(e)}get isProvisional(){return this._isProvisional}set isProvisional(e){this._setIsRendered(e)}get isTarget(){return this._isTarget}set isTarget(e){this._setIsTarget(e)}get isInRange(){return this._isInRange}set isInRange(e){this._setIsInRange(e)}get isOnStage(){return this._isOnStage}set isOnStage(e){this._setIsOnStage(e)}get isRatioLocked(){return this.model.isRatioLocked}_setStatus(e){this._status=e}_setIsSelected(e){this._isSelected=e}_setIsVisible(e){this._isVisible=e}_setIsEditing(e){this._isEditing=e}_setIsLocked(e){this._isLocked=e}_setIsMoving(e){this._isMoving=e}_setIsTransforming(e){this._isTransforming=e}_setIsRotating(e){this._isRotating=e}_setIsRotatingTarget(e){this._isRotatingTarget=e}_setIsDragging(e){this._isDragging=e}_setIsRendered(e){this._isProvisional=e}_setIsTarget(e){this._isTarget=e}_setIsOnStage(e){this._isOnStage=e}_setIsInRange(e){this._isInRange=e}_setIsCornerMoving(e){this._isCornerMoving=e}get maxBoxCoords(){return this._maxBoxCoords}get maxOutlineBoxCoords(){return this._maxOutlineBoxCoords}get rotateCoords(){return this._rotateCoords}get rotateBoxCoords(){return this._rotateBoxCoords}get rotateOutlineCoords(){return this._rotateOutlineCoords}get transformers(){return this._transformers}get borderTransformers(){return this._borderTransformers}get transformerType(){return Ie.rect}get rect(){return this._rect}get activeCoordIndex(){return-1}get alignCoords(){return this._rotateCoords}get alignOutlineCoords(){return this._rotateOutlineCoords}get visualStrokeWidth(){return Math.max(...this.strokes.map(e=>e.width*this.shield.stageScale))}get visualFontSize(){return this.fontSize*this.shield.stageScale}get originalAngle(){return this._originalAngle}set originalAngle(e){this._originalAngle=e}get transformMatrix(){return this._transformMatrix}get transformLockIndex(){return this._transformLockIndex}get transformLockCoord(){return this._transformLockCoord}get originalTransformMoveCoord(){return this._originalTransformMoveCoord}get transformType(){return this._transformType}get viewAngle(){return this.model.viewAngle}get internalAngle(){return this.model.internalAngle}get leanYAngle(){return this.model.leanYAngle}get angles(){return{angle:this.model.angle,leanYAngle:this.model.leanYAngle,internalAngle:this.model.internalAngle,actualAngle:this.model.actualAngle,viewAngle:this.model.viewAngle}}get leanY(){return-Math.tan(l.angleToRadian(this.model.leanYAngle))}get actualAngle(){return this.model.actualAngle}get viewAngleCalcEnable(){return!0}get leanYAngleCalcEnable(){return!0}get leanYAngleModifyEnable(){return!0}get cornersModifyEnable(){return!1}get rotateControllers(){return this._rotateControllers}get controllers(){const e=[];return this.rotationEnable&&(this.shield.configure.rotationIconEnable&&e.push(this.rotation),e.push(...this._rotateControllers)),(this.verticesTransformEnable||this.boxVerticesTransformEnable)&&e.push(...this._transformers),this.borderTransformEnable&&e.push(...this._borderTransformers),e}get isTopmost(){return this.node.next===null}get isBottommost(){return this.node.prev===null}get isInMultiSelected(){const{selectedElementIds:e}=this.shield.store;return e.has(this.model.id)&&e.size>1}get shouldPropChangedEmit(){const e=this.isInMultiSelected;return!e||e&&!this.isGroupSubject}onPositionChanged(){this.refresh(),this.refreshOriginalProps(),this.emitPropChanged(O.positionChanged,[this.position])}onWidthChanged(){this.refresh(),this.refreshOriginalProps(),this.emitPropChanged(O.widthChanged,[this.width])}onHeightChanged(){this.refresh(),this.refreshOriginalProps(),this.emitPropChanged(O.heightChanged,[this.height])}onLayerChanged(){}onTranslateBefore(){this.refreshOriginalProps()}onTranslateAfter(){this.refreshOriginalProps()}onTranslating(){const{x:e,y:t}=x.calcPosition({type:this.model.type,coords:this.model.coords});this.model.x=e,this.model.y=t,this.refreshCorners(),this.refreshRotation(),this.refreshTransformers(),this.emitPropChanged(O.positionChanged,[this.position])}onRotateBefore(){this.refreshOriginalProps()}onRotateAfter(){this.refreshOriginalProps()}onRotating(){this.refresh({points:!0,rotation:!0,position:!0,angles:!0,outline:!0,strokes:!0,corners:!0}),this.emitPropChanged(O.angleChanged,[this.angle])}onTransformBefore(){this.refreshOriginalProps()}onTransformAfter(){this.refreshOriginalProps()}onTransforming(){this.refresh({points:!0,rotation:!0,size:!0,position:!0,angles:!0,outline:!0,strokes:!0,corners:!0},{angles:{view:!0,actual:!0}}),this.emitPropChanged(O.positionChanged,[this.position]),this.emitPropChanged(O.widthChanged,[this.width]),this.emitPropChanged(O.heightChanged,[this.height]),this.emitPropChanged(O.angleChanged,[this.angle]),this.emitPropChanged(O.flipXChanged,[this._flipX])}onAngleChanged(){this.refresh(null,{angles:{view:!0,actual:!0}}),this.emitPropChanged(O.angleChanged,[this.angle])}onLeanyAngleChanged(){this.refresh(null,{angles:{view:!0,actual:!0,internal:!0}}),this.emitPropChanged(O.leanYAngleChanged,[this.leanYAngle])}onCornerChanging(){this.refresh({corners:!0,strokes:!0}),this.emitPropChanged(O.cornersChanged,[this.corners])}onCornerChanged(){this.refresh({corners:!0,strokes:!0,originals:!0}),this.emitPropChanged(O.cornersChanged,[this.corners])}onStrokeTypeChanged(){this.refresh({strokes:!0,outline:!0,originals:!0}),this.emitPropChanged(O.strokesChanged,[this.strokes])}onStrokeWidthChanged(){this.refresh({strokes:!0,outline:!0,originals:!0}),this.emitPropChanged(O.strokesChanged,[this.strokes])}onStrokeColorChanged(){this.emitPropChanged(O.strokesChanged,[this.strokes])}onStrokeColorOpacityChanged(){this.emitPropChanged(O.strokesChanged,[this.strokes])}onStrokeAdded(){this.refresh({strokes:!0,outline:!0,originals:!0}),this.emitPropChanged(O.strokesChanged,[this.strokes])}onStrokeRemoved(){this.refresh({strokes:!0,outline:!0,originals:!0}),this.emitPropChanged(O.strokesChanged,[this.strokes])}onFillColorChanged(){this.emitPropChanged(O.fillsChanged,[this.fills])}onFillColorOpacityChanged(){this.emitPropChanged(O.fillsChanged,[this.fills])}onFillAdded(){this.emitPropChanged(O.fillsChanged,[this.fills])}onFillRemoved(){this.emitPropChanged(O.fillsChanged,[this.fills])}onTextAlignChanged(){this.emitPropChanged(O.textAlignChanged,[this.textAlign])}onTextBaselineChanged(){this.emitPropChanged(O.textBaselineChanged,[this.textBaseline])}onFontSizeChanged(){this.emitPropChanged(O.fontSizeChanged,[this.fontSize])}onFontFamilyChanged(){this.emitPropChanged(O.fontFamilyChanged,[this.fontFamily])}onRatioLockedChanged(){this.emitPropChanged(O.ratioLockedChanged,[this.isRatioLocked])}getAngle(){return this.model.angle}emitPropChanged(e,t){this.shouldPropChangedEmit&&this.shield.store.filterEmit(e,this,...t)}convertPointsByStrokeType(e,t){return q.convertPointsByStrokeType(e,t.type,t.width,{...this.flip,isFold:this.model.isFold})}calcRotateBoxCoords(){return this.model.boxCoords.map(e=>l.rotateWithCenter(e,this.model.angle,this.centerCoord))}calcMaxBoxCoords(){return S.getBoxPoints(this._rotateCoords)}calcMaxOutlineBoxCoords(){return S.getBoxPoints(this._rotateOutlineCoords.flat())}calcRotateCoords(){return this.model.coords.map(e=>l.rotateWithCenter(e,this.model.angle,this.centerCoord))}calcRotateOutlineCoords(){return this.model.styles.strokes.map(e=>x.calcOutlinePoints(this._rotateCoords,e.type,e.width,{...this.flip,isFold:this.model.isFold}))}calcCenterCoord(){return l.calcCenter(this.model.boxCoords)}getController4BoxCoords(e,t){return t=t||ht,S.get4BoxPoints(e,{width:t/this.shield.stageScale,height:t/this.shield.stageScale},{angle:this.model.actualAngle,leanYAngle:this.model.leanYAngle})}calcTransformersByCoords(e){return e.map((t,s)=>{const{x:r,y:i}=t,o=this.getController4BoxCoords(t);let a=this._transformers[s];return a?(a.points=o,a.x=r,a.y=i):a=new Ne(this,{points:o,x:r,y:i}),a})}calcBoxVerticesTransformers(){return this.calcTransformersByCoords(this._rotateBoxCoords)}calcVerticesTransformers(){return this.calcTransformersByCoords(this._rotateCoords)}calcTransformers(){if(this.verticesTransformEnable)return this.calcVerticesTransformers();if(this.boxVerticesTransformEnable)return this.calcBoxVerticesTransformers()}calcRotateControllers(){const e=this.centerCoord;return this._rotateBoxCoords.map((t,s)=>{const r=l.calcAngle(e,t),{x:i,y:o}=l.calcTargetPoint(t,Jn/this.shield.stageScale,r),a=this.getController4BoxCoords({x:i,y:o},dt);let c=this._rotateControllers[s];return c?(c.points=a,c.x=i,c.y=o):c=new Us(this,{x:i,y:o,points:a}),c})}calcBorderTransformers(){return this._rotateBoxCoords.map((t,s)=>{const r=S.getNextOfArray(this._rotateBoxCoords,s);let i=this._borderTransformers[s];return i?(i.start=t,i.end=r):i=new Ze(this,{start:t,end:r,index:s}),i})}calcUnLeanCoords(){return l.calcUnLeanByPoints(this.model.coords,0,this.model.leanYAngle)}calcUnLeanBoxCoords(){return l.calcUnLeanByPoints(this.model.boxCoords,0,this.model.leanYAngle)}calcStrokeCoords(){return this.model.styles.strokes.map(e=>this.convertPointsByStrokeType(this._rotateCoords,e))}calcInnermostStrokeCoordIndex(){let e=0,t=0;return this._strokeCoords.forEach((s,r)=>{const{width:i,type:o}=this.model.styles.strokes[r];o===U.middle&&t<i/2&&(t=i/2,e=r),o===U.inside&&t<i&&(t=i,e=r)}),e}calcUnLeanStrokeCoords(){return this.model.styles.strokes.map(e=>this.convertPointsByStrokeType(this._unLeanCoords,e))}calcInternalAngle(){return this._isRangeElement?90:l.calcInternalAngle(this.model.boxCoords)}calcLeanYAngle(){return!this.leanYAngleCalcEnable||this._isRangeElement?0:l.calcLeanYAngle(this.model.internalAngle,this.flipX)}calcViewAngle(){return this.viewAngleCalcEnable?l.calcViewAngleByPoints(this._rotateBoxCoords):this.model.angle}calcActualAngle(){return l.mirrorAngle(this.model.viewAngle-this.model.leanYAngle)}calcPrimitiveSize(){return S.calcRectangleSize(l.batchLeanWithCenter(this.model.boxCoords,-this.model.leanXAngle,-this.model.leanYAngle,this.centerCoord))}refreshAngles(e){e=e||On,e.view&&(this.model.viewAngle=this.calcViewAngle()),e.internal&&(this.model.internalAngle=this.calcInternalAngle()),e.leanY&&(this.model.leanYAngle=this.calcLeanYAngle()),e.actual&&(this.model.actualAngle=this.calcActualAngle())}refreshRotation(){this.rotationEnable&&(this.shield.configure.rotationIconEnable&&this.rotation.refresh(),this._rotateControllers=this.calcRotateControllers())}refreshPoints(){this._rotateCoords=this.calcRotateCoords(),this._rotateBoxCoords=this.calcRotateBoxCoords(),this._unLeanCoords=this.calcUnLeanCoords(),this._unLeanBoxCoords=this.calcUnLeanBoxCoords(),this._maxBoxCoords=this.calcMaxBoxCoords(),this.refreshTransformers()}isContainsCoord(e){return b.some(this._rotateOutlineCoords,t=>l.isPointInPolygonByRayCasting(e,t))}isPolygonOverlap(e){return b.some(this._rotateOutlineCoords,t=>l.isPolygonsOverlap(t,e))}isModelPolygonOverlap(e){return b.some(this._rotateOutlineCoords,t=>l.isPolygonsOverlap(t,e))}refreshOriginalElementProps(){this.refreshOriginalCoords(),this.refreshOriginalStrokes(),this._originalSize={width:this.model.width,height:this.model.height},this._originalTransformMatrix=[]}refreshOriginalCoords(){this._originalCoords=b.cloneDeep(this.model.coords),this._originalBoxCoords=b.cloneDeep(this.model.boxCoords),this._originalRotateCoords=b.cloneDeep(this._rotateCoords),this._originalRotateBoxCoords=b.cloneDeep(this._rotateBoxCoords),this._originalUnLeanCoords=b.cloneDeep(this._unLeanCoords),this._originalUnLeanBoxCoords=b.cloneDeep(this._unLeanBoxCoords),this._originalCenterCoord=b.cloneDeep(this.centerCoord),this._originalRotateOutlineCoords=b.cloneDeep(this._rotateOutlineCoords),this._originalMaxOutlineBoxCoords=b.cloneDeep(this._maxOutlineBoxCoords),this._originalMaxBoxCoords=b.cloneDeep(this._maxBoxCoords)}refreshOriginalStrokes(){this._originalStrokeCoords=b.cloneDeep(this._strokeCoords),this._originalUnLeanStrokeCoords=b.cloneDeep(this._unLeanStrokeCoords)}refreshOriginalTransformerCoords(){this._originalTransformerCoords=this.transformers.map(e=>{const{x:t,y:s}=e;return{x:t,y:s}})}refreshOriginalProps(){this.refreshOriginalTransformerCoords(),this.refreshOriginalElementProps()}refreshSize(){const{width:e,height:t}=x.calcSize(this.model);if(this.model.width=l.precise(e,1),this.model.height=l.precise(t,1),this._rotateBoxCoords&&this._rotateBoxCoords.length){const{width:s,height:r}=l.calcParallelogramVerticalSize(this._rotateBoxCoords);this._minParallelogramVerticalSize=Math.min(s,r),this._minLeanSize=Math.min(this.model.width,r)}}refreshPosition(){Object.assign(this.model,this.calcCenterCoord())}refreshTransformers(){this._transformers=this.calcTransformers(),this.borderTransformEnable&&(this._borderTransformers=this.calcBorderTransformers())}flipAngle(){let e;this.model.angle>0?e=this.model.angle-180:e=this.model.angle+180,this.model.angle=l.mirrorAngle(e)}batchCalcTransformPointsByCenter(e,t,s,r){return this.calcTransformPointsByCenter(e,t,s,r,this.angles)}calcTransformPointsByCenter(e,t,s,r,i){const o=x.calcMatrixPoint(r,t,s,i);return e.map(a=>(a=x.calcMatrixPoint(a,t,s,i),l.rotateWithCenter(a,-i.angle,o)))}transform(e){this.getActiveController()instanceof Ne?(this.transformByVertices(e),this._transformType=ot.vertices):this.getActiveController()instanceof Ze&&(this.transformByBorder(e),this._transformType=ot.border)}transformBy(e){const{lockCoord:t,lockIndex:s,transformType:r,originalMovingCoord:i,offset:o,groupAngle:a,groupLeanYAngle:c}=e,h={angle:a,leanYAngle:c},d=this.getTransformMatrix(t,i,o,h,!1);r===ot.border&&this._transBorderMatrix(d,s,!1),this._doTransformBy(d,t,h,i)}_doTransformBy(e,t,s,r){const i=x.calcMatrixPoints(this._originalRotateCoords,e,t,s),o=x.calcMatrixPoints(this._originalRotateBoxCoords,e,t,s);this._doTransformByPoints(i,o,t,e,r)}_doTransformByPoints(e,t,s,r,i){this.model.internalAngle=l.calcInternalAngle(t),this.model.leanYAngle=l.calcLeanYAngle(this.model.internalAngle,l.calcFlipXByPoints(t)),this.model.angle=l.mirrorAngle(l.calcActualAngleByPoints(t)),this.model.coords=l.batchPrecisePoint(x.calcCoordsByTransPoints(e,this.angles,s),1),this.model.boxCoords=l.batchPrecisePoint(x.calcCoordsByTransPoints(t,this.angles,s),1),i&&r&&this._tryFlipAngle(s,i,r)}transformByVertices(e){!this.verticesTransformEnable&&!this.boxVerticesTransformEnable||this.doVerticesTransform(e)}doVerticesTransform(e){const t=this._transformers.findIndex(s=>s.isActive);if(t!==-1){const s=S.getPrevIndexOfArray(this._transformers.length,t,2),r=this._originalTransformerCoords[s],i=this._originalTransformerCoords[t];this._originalTransformMoveCoord=i,this.transformByLockPoint(r,i,e,t)}}transformByLockPoint(e,t,s,r){const i=this.getTransformMatrix(e,t,s,this.angles);this._transformMatrix=i,this._transformLockCoord=e,this._transformLockIndex=r,this.model.coords=l.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,i,e,this._originalCenterCoord),1),this.model.boxCoords=l.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,i,e,this._originalCenterCoord),1),this._tryFlipAngle(e,t,i)}getTransformMatrix(e,t,s,r,i){typeof i>"u"&&(i=!0);const o={x:t.x+s.x,y:t.y+s.y},a=l.calcTransformMatrix(e,o,t,r);return i&&this.shouldRatioLockResize&&(a[1][1]=l.resignValue(a[1][1],a[0][0])),a}_tryFlipAngle(e,t,s){this._originalTransformMatrix.length||(this._originalTransformMatrix=l.calcTransformMatrix(e,t,t,this.angles));const r=this._doFlipAngle(s,this._originalTransformMatrix);return r&&(this._originalTransformMatrix=b.cloneDeep(s)),r}_doFlipAngle(e,t){t[0][0];const s=t[1][1];e[0][0];const r=e[1][1];return l.isSameSign(r,s)?!1:(this.flipAngle(),!0)}transformByBorder(e){this.borderTransformEnable&&this.doBorderTransform(e)}getBorderTransformLockCoord(e){const t=S.getPrevIndexOfArray(this._borderTransformers.length,e,2),s=S.getNextIndexOfArray(this._borderTransformers.length,e,3);return l.calcCenter([this._originalTransformerCoords[t],this._originalTransformerCoords[s]])}_transBorderMatrix(e,t,s){typeof s>"u"&&(s=!0);const r=s&&this.shouldRatioLockResize;return t===0||t===2?e[0][0]=r?l.resignValue(e[0][0],e[1][1]):1:(t===1||t===3)&&(e[1][1]=r?l.resignValue(e[1][1],e[0][0]):1),[1,3].includes(t)&&e[1][1]<0&&(e[1][1]=Math.abs(e[1][1])),[0,2].includes(t)&&e[0][0]<0&&(e[0][0]=Math.abs(e[0][0])),e}doBorderTransform(e){const t=this._borderTransformers.findIndex(s=>s.isActive);if(t!==-1){const s=this.getBorderTransformLockCoord(t),r=this._originalTransformerCoords[t];this._originalTransformMoveCoord=r;const i={x:r.x+e.x,y:r.y+e.y},o=l.calcTransformMatrix(s,i,r,this.angles);this._transBorderMatrix(o,t),this._transformMatrix=o,this._transformLockCoord=s,this._transformLockIndex=t,this.model.coords=l.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,o,s,this._originalCenterCoord),1),this.model.boxCoords=l.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,o,s,this._originalCenterCoord),1),this._tryFlipAngle(s,r,o)}}getTransformPointForSizeChange(){return this._originalTransformerCoords[2]}translateBy(e){this.model.coords=l.batchTranslate(this._originalCoords,e),this.model.boxCoords=l.batchTranslate(this._originalBoxCoords,e),this._rotateCoords=l.batchTranslate(this._originalRotateCoords,e),this._rotateBoxCoords=l.batchTranslate(this._originalRotateBoxCoords,e),this._unLeanCoords=l.batchTranslate(this._originalUnLeanCoords,e),this._unLeanBoxCoords=l.batchTranslate(this._originalUnLeanBoxCoords,e),this._unLeanStrokeCoords=this._originalUnLeanStrokeCoords.map(t=>l.batchTranslate(t,e)),this._strokeCoords=this._originalStrokeCoords.map(t=>l.batchTranslate(t,e)),this._maxBoxCoords=l.batchTranslate(this._originalMaxBoxCoords,e),this._maxOutlineBoxCoords=l.batchTranslate(this._originalMaxOutlineBoxCoords,e),this._rotateOutlineCoords=this._originalRotateOutlineCoords.map(t=>l.batchTranslate(t,e))}refresh(e,t){e=e||In,e!=null&&e.points&&this.refreshPoints(),e!=null&&e.size&&this.refreshSize(),e!=null&&e.position&&this.refreshPosition(),e!=null&&e.angles&&this.refreshAngles(t==null?void 0:t.angles),e!=null&&e.rotation&&this.refreshRotation(),e!=null&&e.corners&&this.refreshCorners(),e!=null&&e.strokes&&this.refreshStrokePoints(),e!=null&&e.outline&&this.refreshOutlinePoints(),e!=null&&e.originals&&this.refreshOriginalProps()}refreshOutlinePoints(){this._rotateOutlineCoords=this.calcRotateOutlineCoords(),this._maxOutlineBoxCoords=this.calcMaxOutlineBoxCoords()}setWidth(e){const t=l.calcScaleMatrix(e/this._originalSize.width,1);return t[1][1]=this.shouldRatioLockResize?l.resignValue(t[1][1],t[0][0]):1,this._setWH(t),t}setHeight(e){const t=l.calcScaleMatrix(1,e/this._originalSize.height);return t[0][0]=this.shouldRatioLockResize?l.resignValue(t[0][0],t[1][1]):1,this._setWH(t),t}scaleBy(e,t,s,r){const i=l.calcScaleMatrix(t,s);r?this._doTransformBy(i,e,r):(this.model.coords=l.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,i,e,this._originalCenterCoord),1),this.model.boxCoords=l.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,i,e,this._originalCenterCoord),1)),this.refresh({points:!0,size:!0,position:!0,rotation:!0,originals:!0,outline:!0,strokes:!0,corners:!0})}_setWH(e){this._transformMatrix=e,this._transformLockCoord=this._originalCenterCoord,this.model.coords=l.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateCoords,e,this._originalCenterCoord,this._originalCenterCoord),1),this.model.boxCoords=l.batchPrecisePoint(this.batchCalcTransformPointsByCenter(this._originalRotateBoxCoords,e,this._originalCenterCoord,this._originalCenterCoord),1)}setPosition(e,t,s){this.model.x=e,this.model.y=t,this.model.coords=l.batchPrecisePoint(l.batchTranslate(this.model.coords,s),1),this.model.boxCoords=l.batchPrecisePoint(l.batchTranslate(this.model.boxCoords,s),1)}setAngle(e){this.model.angle=e}setLeanYAngle(e){e=b.clamp(e,-89,89);const t=this.calcUnLeanCoords(),s=this.centerCoord;this.model.coords=l.batchPrecisePoint(l.batchLeanYWithCenter(t,e,s),1);const r=this.calcUnLeanBoxCoords();this.model.boxCoords=l.batchPrecisePoint(l.batchLeanYWithCenter(r,e,s),1),this.model.leanYAngle=e}leanYBy(e,t,s,r){let i=l.batchTransWithCenter(this._rotateCoords,{angle:s,leanYAngle:t},r,!0),o=l.batchTransWithCenter(this._rotateBoxCoords,{angle:s,leanYAngle:t},r,!0);i=l.batchTransWithCenter(i,{angle:s,leanYAngle:e},r),o=l.batchTransWithCenter(o,{angle:s,leanYAngle:e},r),this._doTransformByPoints(i,o,r)}refreshCorners(){}refreshStrokePoints(){this._strokeCoords=this.calcStrokeCoords(),this._unLeanStrokeCoords=this.calcUnLeanStrokeCoords(),this._innermostStrokeCoordIndex=this.calcInnermostStrokeCoordIndex()}setCorners(e,t){let s=b.cloneDeep(this.model.corners);b.isNumber(t)?s[t]=e:s.fill(e),s=x.fixCornersBasedOnMinSize(s,this._minParallelogramVerticalSize),this.model.corners=s}setStrokeType(e,t){this.model.styles.strokes[t].type=e}setStrokeColor(e,t){this.model.styles.strokes[t].color=e}setStrokeColorOpacity(e,t){this.model.styles.strokes[t].colorOpacity=b.clamp(e,0,1)}setStrokeWidth(e,t){switch(this.model.styles.strokes[t].type){case U.middle:e=b.clamp(e,0,this._minLeanSize);break;case U.inside:e=b.clamp(e,0,this._minLeanSize/2);break;case U.outside:e=b.clamp(e,0,this._minLeanSize*2);break}e=l.precise(e,1),this.model.styles.strokes[t].width=e}addStroke(e){this.model.styles.strokes.splice(e+1,0,{...vt})}removeStroke(e){this.model.styles.strokes.splice(e,1)}setFillColor(e,t){this.model.styles.fills[t].color=e}setFillColorOpacity(e,t){this.model.styles.fills[t].colorOpacity=b.clamp(e,0,1)}addFill(e){this.model.styles.fills.splice(e+1,0,{...wt})}removeFill(e){this.model.styles.fills.splice(e,1)}setFontSize(e){this.model.styles.fontSize=e}setFontFamily(e){this.model.styles.fontFamily=e}setTextAlign(e){this.model.styles.textAlign=e}setTextBaseline(e){this.model.styles.textBaseline=e}setRatioLocked(e){this.model.isRatioLocked=e,e?this.model.ratio=this.model.width/this.model.height:this.model.ratio=null}rotateBy(e,t){const s=l.rotateWithCenter(this._originalCenterCoord,e,t),r={x:s.x-this._originalCenterCoord.x,y:s.y-this._originalCenterCoord.y},i=this._originalCoords.map(a=>l.translate(a,r)),o=this._originalBoxCoords.map(a=>l.translate(a,r));this.model.coords=l.batchPrecisePoint(i,1),this.model.boxCoords=l.batchPrecisePoint(o,1),this.model.angle=l.mirrorAngle(l.normalizeAngle(this._originalAngle)+l.normalizeAngle(e)%360)}getActiveController(){return this.controllers.find(e=>e.isActive)}setControllersActive(e,t){e.forEach(s=>s.isActive=t)}getControllerByCoord(e){return this.controllers.find(t=>t.isCoordHitting(e))}refreshOriginalAngle(){this._originalAngle=this.model.angle}async toJson(){return JSON.parse(JSON.stringify({...this.model,...this.flip}))}fromJson(e){this.model=JSON.parse(JSON.stringify(e))}};class ut extends Kt{}class er extends Le{constructor(){super(...arguments);u(this,"_cornerControllers",[]);u(this,"_cornerCoords",[]);u(this,"_originalCornerCoords",[]);u(this,"_originalAllCornerEqual",!1);u(this,"_arcCoords",[]);u(this,"_arcFillCoords",[]);u(this,"_originalArcCoords",[]);u(this,"_originalArcFillCoords",[])}get cornersModifyEnable(){return!0}get cornerControllers(){return this._cornerControllers}get normalizeCorners(){return this._normalizeCorners()}get cornerCoords(){return this._cornerCoords}get visualCorners(){return this.normalizeCorners.map(t=>this._getCorner(t))}get editingEnable(){return!1}get controllers(){return[...super.controllers,...this.cornerControllers]}get isAllCornerEqual(){return b.uniq(this.model.corners).length===1}get arcCoords(){return this._arcCoords}get arcFillCoords(){return this._arcFillCoords}calcArcCoords(){return this.model.styles.strokes.map(t=>this._getArcVerticalCoords(t))}calcArcFillCoords(){const t=this.innermostStrokeCoordIndex;let s=this.model.styles.strokes[t],{width:r,type:i}=s;switch(i){case U.inside:{r=r*2;break}case U.middle:{r=r;break}case U.outside:{r=0;break}}return s={...s,type:U.inside,width:r},this._getArcVerticalCoords(s)}_getArcBoxCoords(t){const{type:s,width:r}=t;let i=this.calcUnLeanBoxCoords();const{width:o,height:a}=S.calcRectangleSize(i);let c=1,h=1;switch(s){case U.outside:{c=(o+r)/o,h=(a+r)/a;break}case U.inside:{c=(o-r)/o,h=(a-r)/a;break}}return[U.inside,U.outside].includes(s)&&(i=l.batchScaleWithCenter(i,{sx:c,sy:h},this.centerCoord)),i}_getArcCorner(t,s){let r=this.normalizeCorners;const{type:i,width:o}=s,{width:a,height:c}=l.calcParallelogramVerticalSize(t),h=Math.min(a,c);return r=r.map(d=>{if(d===0)return d;switch(i){case U.inside:return b.clamp(d-o/2,0,h/2);case U.outside:return b.clamp(d+o/2,0,h/2);default:return d}}),r}_getVerticalIntersection(t,s){return{coords:l.calcParallelogramVerticalIntersectionPoints(t,s,!0),indexes:[[0,1],[1,2],[2,3],[3,0]]}}_getCrossPointsOfParallelLines(t,s){return{coords:l.calcCrossPointsOfParallelLines(t,s),indexes:[[3,0],[0,1],[1,2],[2,3]]}}_getArcVerticalCoords(t){let s=this.calcUnLeanBoxCoords();s=this._getArcBoxCoords(t);const r=this._getArcCorner(s,t),i=[];return b.range(4).forEach(o=>{const a=s[o],c=r[o],h=this.calcUnLeanCornerCoordBy(a,o,c);let d=s[o],g,f;if(!c)g=s[o],f=s[o];else{const{coords:C,indexes:p}=this._getVerticalIntersection(h,s);g=C[p[o][0]],f=C[p[o][1]],g||(g=s[o]),f||(f=s[o])}i.push({start:g,controller:d,end:f,value:c,corner:h})}),i}calcUnLeanCornerCoord(t,s){const r=s?this.normalizeCorners[t]:this.visualCorners[t],i=l.leanWithCenter(this.model.boxCoords[t],this.model.leanXAngle,-this.model.leanYAngle,this.centerCoord);return this.calcUnLeanCornerCoordBy(i,t,r)}calcUnLeanCornerCoordBy(t,s,r){if(r===0)return t;let i,o;return[0,3].includes(s)?i=this.flipX?-r:r:i=this.flipX?r:-r,[0,1].includes(s)?o=r:o=-r,l.translate(t,{x:i,y:o})}calcCornerCoord(t,s){const r=this._rotateBoxCoords[t],i=this.visualCorners[t];let o=this.calcUnLeanCornerCoord(t,s);o=l.transWithCenter(o,this.angles,this.centerCoord);const{coords:a,indexes:c}=this._getCrossPointsOfParallelLines(o,this._rotateBoxCoords);let h=a[c[t][0]],d=a[c[t][1]];if(!h||!d)return r;let g=l.calcTriangleAngleWithClockwise(h,r,d);const f=this.flipX;f&&(g=180-g);const C=l.calcAngle(r,d)+(f?-g/2:g/2),p=this._getCornerTargetCoord(t,this._rotateBoxCoords),E=l.calcDistance(r,p)*2,v=i/this.minParallelogramVerticalSize,z=E*v;return l.calcTargetPoint(r,z,C)}refreshCornersController(t){if(this._cornerCoords.length===0)return;const{x:s,y:r}=this._cornerCoords[t],i=this.getController4BoxCoords(this._cornerCoords[t]);this._cornerControllers[t]?(this._cornerControllers[t].x=s,this._cornerControllers[t].y=r,this._cornerControllers[t].points=i):this._cornerControllers[t]=new ut(this,{x:s,y:r,points:i})}refreshCornerCoords(t){!this._rotateBoxCoords||!this._rotateBoxCoords.length||(this._cornerCoords[t]=this.calcCornerCoord(t))}refreshCornersCoords(t){t=t||[0,1,2,3],t.forEach(s=>{this.refreshCornerCoords(s)})}refreshCornersControllers(t){t=t||[0,1,2,3],t.forEach(s=>{this.refreshCornersController(s)})}_refreshCorners(){this.status===Q.finished&&(this.refreshCornersCoords(),this.refreshCornersControllers())}refreshCorners(){super.refreshCorners(),this.isInMultiSelected||this._refreshCorners()}refreshStrokePoints(){super.refreshStrokePoints(),this._arcCoords=this.calcArcCoords(),this._arcFillCoords=this.calcArcFillCoords()}_getCorner(t){return this._isCornerMoving?t:t===0?this.minParallelogramVerticalSize/2*.2:t}refreshOriginalElementProps(){super.refreshOriginalElementProps(),this._originalCornerCoords=b.cloneDeep(this._cornerCoords),this._originalAllCornerEqual=this.isAllCornerEqual}refreshOriginalStrokes(){super.refreshOriginalStrokes(),this._originalArcCoords=b.cloneDeep(this._arcCoords),this._originalArcFillCoords=b.cloneDeep(this._arcFillCoords)}_getCornerTargetCoord(t,s){let r,[i,o]=l.calculateAngleBisectorIntersection(s);const{width:a,height:c}=l.calcParallelogramVerticalSize(s);return a<=c?[0,1].includes(t)?r=i:r=o:[0,3].includes(t)?r=i:r=o,r}updateCornerByOffset(t){const s=this.getActiveController();if(s instanceof ut){const r=this.cornerControllers.indexOf(s);if(r!==-1){const i=this._getCornerTargetCoord(r,this._rotateBoxCoords),o=this._originalCornerCoords[r],a={x:t.x+o.x,y:t.y+o.y},c=this._rotateBoxCoords[r],h=l.calcProjectionOnSegment(a,i,c);let d=l.calcSegmentProportion(h,i,c);d=b.clamp(d,0,1),d=1-d;let g=d*(this.minParallelogramVerticalSize/2);this._originalAllCornerEqual?this.setCorners(g):this.setCorners(g,r)}}}_normalizeCorners(){const t=[...this.model.corners];return b.every(t,s=>s===0)?t:x.fixCornersBasedOnMinSize(t,this.minParallelogramVerticalSize)}_translateArc(t){this._arcCoords=l.batchTranslateArcPoints(this._originalArcCoords,t),this._arcFillCoords=l.translateArcPoints(this._originalArcFillCoords,t)}translateBy(t){this._translateArc(t),super.translateBy(t)}_setIsSelected(t){super._setIsSelected(t),t&&this._refreshCorners()}}class ai extends Le{constructor(){super(...arguments);u(this,"_outerCoords",[])}get editingEnable(){return!1}get flipXEnable(){return!1}get flipYEnable(){return!1}get verticesTransformEnable(){return!0}get boxVerticesTransformEnable(){return!1}get heightModifyEnable(){return!1}get rotationEnable(){return!1}get borderTransformEnable(){return!1}get fillEnabled(){return!1}get ratioLockedEnable(){return!1}get viewAngleCalcEnable(){return!1}get leanYAngleCalcEnable(){return!1}get leanYAngleModifyEnable(){return!1}get startRotateCoord(){return this._rotateCoords[0]}get endRotateCoord(){return this._rotateCoords[1]}get startCoord(){return this.model.coords[0]}get endCoord(){return this.model.coords[1]}get outerCoords(){return this._outerCoords}get transformerType(){return Ie.circle}get alignOutlineCoords(){return this._outerCoords}refreshBentOutline(){this._outerCoords=this.calcOuterCoords(),this._maxOutlineBoxCoords=S.getBoxPoints(this._outerCoords.flat())}refreshPoints(){super.refreshPoints(),this.refreshBentOutline()}calcOuterCoords(){return this.model.styles.strokes.map(t=>pe.calcBentLineOuterVertices(this._rotateCoords,t.width/2))}refreshOutlinePoints(){super.refreshOutlinePoints(),this.refreshBentOutline()}getAngle(){return x.fixAngle(l.calcAngle(this.startCoord,this.endCoord)+90)}isContainsCoord(t){return b.some(this.model.styles.strokes,s=>l.isPointClosestSegment(t,this.startRotateCoord,this.endRotateCoord,dn+s.width/2/this.shield.stageScale))}isPolygonOverlap(t){return b.some(this._outerCoords,s=>l.isPolygonsOverlap(s,t))}isModelPolygonOverlap(t){return b.some(this._outerCoords,s=>l.isPolygonsOverlap(s,t))}doVerticesTransform(t){const s=this._transformers.findIndex(r=>r.isActive);if(s!==-1){const r=this._originalTransformerCoords[S.getNextIndexOfArray(2,s,1)],i=this._originalTransformerCoords[s];this.transformByLockPoint(r,i,t,s)}}getTransformPointForSizeChange(){return this._originalTransformerCoords[1]}setWidth(t){const s=l.calcTargetPoint(this.startCoord,t,this.angle-90);return this.model.coords[1]=s,this.model.width=t,[[]]}setAngle(t){const s=l.calcCenter(this.model.coords),r=l.calcTargetPoint(s,this.width/2,t+90),i=l.calcTargetPoint(s,this.width/2,t-90);this.model.coords=[r,i]}}class li extends He{async run(){if(!this.canvas||!this.element)return;const{strokeCoords:e,model:{styles:t}}=this.element;x.batchCalcStageRelativePoints(e).forEach((r,i)=>{q.drawPathWithScale(this.canvas,r,t,t.fills[0],t.strokes[i])})}}class ps extends er{get fillEnabled(){return!1}async toJson(){const e=await super.toJson(),t=this.model.data,s=await q.getDataUrlFromImage(t);return e.data=s,e}}class ci extends He{async run(){if(!this.canvas||!this.element)return;const{arcCoords:e,arcFillCoords:t,model:{styles:s},angle:r,flipX:i,leanY:o,actualAngle:a,rotateBoxCoords:c,center:h}=this.element,d=x.batchCalcStageRelativeArcPoints(e),g=x.calcStageRelativePoints(c),f=x.calcStageRelativeArcPoints(t),C={angle:r,flipX:i,leanY:o,actualAngle:a};let p=S.calcRotateBoxRect(g,h);p=S.scaleRect(p,this.element.shield.stageScale),q.drawImgLike(this.canvas,this.element.model.data,p,{...C,clipArcPoints:f}),d.forEach((E,v)=>{q.drawArcPathStrokeWidthScale(this.canvas,E,p,s.strokes[v],C)})}}class hi extends He{async run(){if(!this.canvas||!this.element)return;let{innermostStrokeCoordIndex:e,strokeCoords:t,model:{styles:s,isFold:r}}=this.element;const i=x.batchCalcStageRelativePoints(t);r&&s.fills.forEach(o=>{q.drawInnerPathFillWithScale(this.canvas,i[e],o,s.strokes[e])}),i.forEach((o,a)=>{q.drawPathStrokeWidthScale(this.canvas,o,s.strokes[a],{isFold:r,miterLimit:Rn})})}}class di extends Le{constructor(t,s){super(t,s);u(this,"tailCoordIndex");u(this,"editingCoordIndex");u(this,"_outerWorldPaths",[]);u(this,"_originalOuterWorldPaths",[]);this.tailCoordIndex=-1}get transformerType(){return Ie.circle}get verticesTransformEnable(){return this.status!==Q.finished}get boxVerticesTransformEnable(){return this.status===Q.finished}get borderTransformEnable(){return this.status===Q.finished}get activeCoordIndex(){return[Q.startCreating,Q.creating,Q.initialed].includes(this.status)?this.model.coords.length>this.tailCoordIndex+1?this.tailCoordIndex+1:this.tailCoordIndex:-1}get outerWorldPaths(){return this._outerWorldPaths}get tfRefreshAfterEdChanged(){return!0}_setStatus(t){super._setStatus(t),t===Q.finished&&(this.tailCoordIndex=-1)}calcOuterWorldPaths(){return this._strokeCoords.map((t,s)=>x.calcArbitraryBorderRegions(t,this.model.styles.strokes[s],this.model.isFold))}refreshOutlinePoints(){this._outerWorldPaths=this.calcOuterWorldPaths(),super.refreshOutlinePoints()}refreshOriginalStrokes(){super.refreshOriginalStrokes(),this._originalOuterWorldPaths=b.cloneDeep(this._outerWorldPaths)}isContainsCoord(t){let s;return this.visualStrokeWidth<hs?s=this._strokeCoords.map(r=>x.calcArbitraryBorderRegions(r,{width:hs/this.shield.stageScale},this.model.isFold)):s=this._outerWorldPaths,b.some(s,r=>b.some(r,i=>l.isPointInPolygonByRayCasting(t,i)))}isPolygonOverlap(t){return b.some(this._outerWorldPaths,s=>b.some(s,r=>l.isPolygonsOverlap(r,t)))}isModelPolygonOverlap(t){return b.some(this._outerWorldPaths,s=>b.some(s,r=>l.isPolygonsOverlap(r,t)))}calcRotateOutlineCoords(){return this._outerWorldPaths.flat()}activeEditingCoord(t){this.editingCoordIndex=t}deActiveEditingCoord(){this.editingCoordIndex=-1}setControllersActive(t,s){super.setControllersActive(t,s),t.forEach(r=>{if(r instanceof Ne){const i=this._transformers.findIndex(o=>o.id===r.id);if(i===-1)return;s?this.activeEditingCoord(i):this.deActiveEditingCoord()}})}doVerticesTransform(t){this.status===Q.editing?this.doEditingTransform(t):super.doVerticesTransform(t)}doEditingTransform(t){if(this.editingCoordIndex!==-1){const s=b.cloneDeep(this._originalRotateCoords);s[this.editingCoordIndex]={x:s[this.editingCoordIndex].x+t.x,y:s[this.editingCoordIndex].y+t.y};const r=this._originalRotateBoxCoords[0];this.model.coords=l.batchPrecisePoint(x.calcCoordsByTransPoints(s,this.angles,r),1),this.model.boxCoords=l.batchPrecisePoint(l.batchLeanWithCenter(S.getBoxPoints(l.calcUnLeanByPoints(this.model.coords,0,this.model.leanYAngle)),0,this.model.leanYAngle,this.calcCenterCoord()),1)}}_translateOuterCoords(t){this._outerWorldPaths=this._originalOuterWorldPaths.map((s,r)=>s.map(i=>i.map(o=>l.translate(o,t))))}translateBy(t){this._translateOuterCoords(t),super.translateBy(t)}}class Zt extends Le{get subs(){return this.getSubs()}get deepSubs(){return this.getDeepSubs()}get strokeEnable(){return!1}get fillEnabled(){return!1}get editingEnable(){return!1}get alignOutlineCoords(){return[S.getBoxPoints(this.subs.map(e=>e.alignOutlineCoords.flat()).flat())]}addSub(e){this.model.subIds.push(e.id)}removeSub(e){const t=this.model.subIds.indexOf(e.id);t!==-1&&this.model.subIds.splice(t,1)}removeSubById(e){const t=this.model.subIds.indexOf(e);t!==-1&&this.model.subIds.splice(t,1)}hasSub(e){var t;return(t=this.model.subIds)==null?void 0:t.includes(e.id)}hasSubById(e){var t;return(t=this.model.subIds)==null?void 0:t.includes(e)}getSubs(){return this.shield.store.getElementsByIds(this.model.subIds)}getDeepSubs(){const e=[];return this._getDeepSubs(e,this.getSubs()),e}_getDeepSubs(e,t){return t.forEach(s=>{e.push(s),s.isGroup&&this._getDeepSubs(e,s.subs)}),e}getSubElementsByType(e){return this.getSubs().filter(t=>t.isElement&&t.model.type===e)}getAllSubElements(){return this.getSubs().filter(e=>e.isElement)}getAllSubElementGroups(){return this.getSubs().filter(e=>e.isGroup)}clearSubs(){this.model.subIds=[]}isContainsCoord(e){return this.deepSubs.some(t=>t.isContainsCoord(e))}isPolygonOverlap(e){return this.deepSubs.some(t=>t.isPolygonOverlap(e))}isModelPolygonOverlap(e){return this.deepSubs.some(t=>t.isModelPolygonOverlap(e))}_setIsSelected(e){super._setIsSelected(e),this.deepSubs.forEach(t=>{t.isSelected=e})}}class ui extends Le{get editingEnable(){return!1}}class gi extends He{async run(){if(!this.canvas||!this.element)return;const{innermostStrokeCoordIndex:e,unLeanStrokeCoords:t,model:{styles:s,styles:{strokes:r}},center:i,angle:o,flipX:a,leanY:c,actualAngle:h}=this.element,d={angle:o,flipX:a,leanY:c,actualAngle:h},g=x.batchCalcStageRelativePoints(t),f=g[e],C=S.getRect(f);s.fills.forEach(p=>{q.drawEllipseFillWithScale(this.canvas,i,{rx:C.width/2,ry:C.height/2},p,C,d)}),g.forEach((p,E)=>{const v=S.getRect(p);q.drawEllipseStrokeWithScale(this.canvas,i,{rx:v.width/2,ry:v.height/2},r[E],v,d)})}}class fi extends Le{get editingEnable(){return!1}}class Nt{static createImageFromImageData(e){const t=q.getCanvasByImageData(e),s=new Image;return s.src=t.toDataURL(),s}static waitForImageLoad(e){return new Promise((t,s)=>{e.onload=()=>{t(e)},e.onerror=()=>{s(new Error("Image load failed"))}})}static async createImageFromUrl(e){const t=new Image;return t.src=e,await this.waitForImageLoad(t),t}}var he=(n=>(n.isSelected="isSelected",n.isVisible="isVisible",n.isLocked="isLocked",n.isEditing="isEditing",n.isMoving="isMoving",n.isTransforming="isTransforming",n.isRotating="isRotating",n.isRotatingTarget="isRotatingTarget",n.isDragging="isDragging",n.isProvisional="isProvisional",n.isTarget="isTarget",n.isInRange="isInRange",n.isOnStage="isOnStage",n.status="status",n.isRatioLocked="isRatioLocked",n))(he||{}),Se=(n=>(n[n.added=0]="added",n[n.removed=1]="removed",n))(Se||{});class x{static createElementTask(e,t){let s;switch(e.model.type){case P.rectangle:s=new Tn(e,t);break;case P.image:{s=new ci(e,t);break}case P.line:{s=new li(e,t);break}case P.ellipse:{s=new gi(e,t);break}case P.arbitrary:s=new hi(e,t)}return s}static calcStageRelativePoints(e){return e.map(t=>x.calcStageRelativePoint(t))}static batchCalcStageRelativePoints(e){return e.map(t=>x.calcStageRelativePoints(t))}static calcStageRelativePoint(e){const{rect:{width:t,height:s},scale:r,worldCoord:{x:i,y:o}}=window.shield.stageCalcParams;return{x:e.x+t/2/r-i,y:e.y+s/2/r-o}}static calcWorldCoords(e){return e.map(t=>x.calcWorldCoord(t))}static calcWorldCoord(e){const{rect:{width:t,height:s},scale:r,worldCoord:{x:i,y:o}}=window.shield.stageCalcParams;return{x:e.x-t/2/r+i,y:e.y-s/2/r+o}}static calcCreatorPoints(e,t){switch(t){case P.rectangle:case P.image:case P.arbitrary:case P.text:case P.ellipse:case P.group:return S.getBoxPoints(e);default:return e}}static createElement(e,t){const{type:s}=e;switch(s){case P.rectangle:return new er(e,t);case P.line:return new ai(e,t);case P.ellipse:return new fi(e,t);case P.image:return new ps(e,t);case P.arbitrary:return new di(e,t);case P.text:return new ui(e,t);case P.group:return new Zt(e,t);case P.image:return new ps(e,t);default:return new Le(e,t)}}static getTopAElementByCoord(e,t){for(let s=e.length-1;s>=0;s--){const r=e[s];if(r.isContainsCoord(t))return r}}static calcElementRotatePoint(e){const{centerCoord:t,rotation:{angle:s,scale:r},model:{height:i}}=e;return l.calcTargetPoint(t,i/2+jn*r,s)}static calcPosition(e){switch(e.type){case P.rectangle:case P.image:case P.line:case P.ellipse:case P.arbitrary:case P.text:case P.group:return l.calcCenter(e.coords)}}static calcSize(e){const{coords:t,boxCoords:s,type:r}=e;switch(r){case P.rectangle:case P.text:case P.group:case P.image:case P.ellipse:case P.arbitrary:return S.calcRectangleSize(s);case P.line:return{width:l.precise(l.calcDistance(t[0],t[1]),2),height:0}}}static fixAngle(e){return e>180&&(e=e-360),e}static calcOutlinePoints(e,t,s,r){if(s&&t!==U.inside){let i=s/2;t===U.outside&&(i=s);const{flipX:o,flipY:a}=r;return o!==a?ye.getArbitraryInnerVertices(e,i,r):ye.getArbitraryOuterVertices(e,i,r)}return e}static calcNoFoldArbitraryBorderRegions(e,t){const{width:s}=t,r=[];return e.forEach((i,o)=>{if(o<e.length-1){const a=e[o+1];if(r.push(pe.calcBentLineOuterVertices([i,a],s/2)),o!==0){const c=e[o-1];r.push(x.calc3PArbitraryBorderRegions(c,i,a,t))}}}),r}static calcFoldArbitraryBorderRegions(e,t){const{width:s}=t,r=[];return e.forEach((i,o)=>{const a=S.getPrevOfArray(e,o),c=S.getNextOfArray(e,o);r.push(pe.calcBentLineOuterVertices([i,c],s/2)),r.push(x.calc3PArbitraryBorderRegions(a,i,c,t))}),r}static calcArbitraryBorderRegions(e,t,s){return s?x.calcFoldArbitraryBorderRegions(e,t):x.calcNoFoldArbitraryBorderRegions(e,t)}static calc3PArbitraryBorderRegions(e,t,s,r){const{width:i}=r,o=l.isPointClockwiseOfLine(s,e,t),c=(180-l.calcTriangleAngle(e,t,s))/2,h=l.calcAngle(e,t),d=l.calcTriangleSide3By2(c,i/2),g=l.calcTargetPoint(t,d,h+(o?-c:c)),f=[];return f.push(t),f.push(l.calcTargetPoint(t,i/2,h-90)),f.push(g),f.push(l.calcTargetPoint(t,i/2,l.calcAngle(s,t)+90)),f}static calcCoordsByTransPoints(e,t,s){const r=l.calcCenter(e.map(o=>l.transWithCenter(o,t,s,!0))),i=l.transWithCenter(r,t,s);return e.map(o=>l.rotateWithCenter(o,-t.angle,i))}static calcCoordsByRotatePoints(e,t,s){let r=l.calcCenter(e.map(o=>l.rotateWithCenter(o,-t,s)));const i=l.rotateWithCenter(r,t,s);return e.map(o=>l.rotateWithCenter(o,-t,i))}static normalizeMatrixPoint(e,t,s,r){e=l.transWithCenter(e,r,s,!0);const[i,o]=l.multiply(t,[e.x-s.x,e.y-s.y,1]);return{x:i+s.x,y:o+s.y}}static calcMatrixPoint(e,t,s,r){const i=x.normalizeMatrixPoint(e,t,s,r);return l.transWithCenter(i,r,s)}static calcMatrixPoints(e,t,s,r){return e.map(i=>x.calcMatrixPoint(i,t,s,r))}static isSameAncestorGroup(e){return e.length<=1?!0:x.getAncestorGroup(e)!==null}static getAncestorGroup(e){if(e.length===0)return null;const t=x.getNoParentElements(e);return t.length>1?null:t[0]}static getNoParentElements(e){return e.filter(t=>!t.isGroupSubject)}static createEmptyGroupObject(){return{...x.createEmptyObject(),type:P.group}}static createEmptyObject(){return{id:`${S.getDateId()}`,subIds:[],coords:[],boxCoords:[],width:0,height:0,styles:{strokes:[]},x:0,y:0,...Ut,...Qe}}static fixCornersBasedOnMinSize(e,t){return b.range(4).forEach(s=>{e[s]!==0&&(e[s]=b.clamp(e[s],0,t/2))}),e}static convertElementsJson(e){const t=e,s=new Map,r=[],i=S.getDateId();return t.forEach((o,a)=>{s.set(o.id,o),r.push(i+a)}),t.forEach((o,a)=>{x.reBindGroup(o,s,`${r[a]}`),x.divateCoords(o,40)}),t}static reBindGroup(e,t,s){const{subIds:r,groupId:i,id:o}=e;if(e.id=s,t.set(s,e),t.delete(o),r&&r.forEach(a=>{const c=t.get(a);c&&(c.groupId=s)}),i){const a=t.get(i);if(a){const c=a.subIds.indexOf(o);if(c===-1)return;a.subIds.splice(c,1,s)}}}static divateCoords(e,t){const{coords:s,boxCoords:r}=e;return e.x+=t,e.y+=t,e.coords=l.batchTranslate(s,{x:t,y:t}),e.boxCoords=l.batchTranslate(r,{x:t,y:t}),e}static async convertElementModel(e){const{type:t,data:s}=e;switch(t){case P.image:e.data=await Nt.createImageFromUrl(s)}return e}static calcStageRelativeArcPoint(e){let{start:t,end:s,controller:r,corner:i,value:o}=e;return[t,s,r,i]=x.calcStageRelativePoints([t,s,r,i]),{start:t,end:s,controller:r,corner:i,value:o}}static calcStageRelativeArcPoints(e){return e.map(t=>x.calcStageRelativeArcPoint(t))}static batchCalcStageRelativeArcPoints(e){return e.map(t=>x.calcStageRelativeArcPoints(t))}}var it={exports:{}},Cs;function mi(){if(Cs)return it.exports;Cs=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(_,A,I){return Function.prototype.apply.call(_,A,I)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(_){return Object.getOwnPropertyNames(_).concat(Object.getOwnPropertySymbols(_))}:t=function(_){return Object.getOwnPropertyNames(_)};function s(y){console&&console.warn&&console.warn(y)}var r=Number.isNaN||function(_){return _!==_};function i(){i.init.call(this)}it.exports=i,it.exports.once=z,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var o=10;function a(y){if(typeof y!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof y)}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(y){if(typeof y!="number"||y<0||r(y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+y+".");o=y}}),i.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(_){if(typeof _!="number"||_<0||r(_))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+_+".");return this._maxListeners=_,this};function c(y){return y._maxListeners===void 0?i.defaultMaxListeners:y._maxListeners}i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(_){for(var A=[],I=1;I<arguments.length;I++)A.push(arguments[I]);var B=_==="error",G=this._events;if(G!==void 0)B=B&&G.error===void 0;else if(!B)return!1;if(B){var V;if(A.length>0&&(V=A[0]),V instanceof Error)throw V;var re=new Error("Unhandled error."+(V?" ("+V.message+")":""));throw re.context=V,re}var Pe=G[_];if(Pe===void 0)return!1;if(typeof Pe=="function")e(Pe,this,A);else for(var as=Pe.length,Mr=p(Pe,as),I=0;I<as;++I)e(Mr[I],this,A);return!0};function h(y,_,A,I){var B,G,V;if(a(A),G=y._events,G===void 0?(G=y._events=Object.create(null),y._eventsCount=0):(G.newListener!==void 0&&(y.emit("newListener",_,A.listener?A.listener:A),G=y._events),V=G[_]),V===void 0)V=G[_]=A,++y._eventsCount;else if(typeof V=="function"?V=G[_]=I?[A,V]:[V,A]:I?V.unshift(A):V.push(A),B=c(y),B>0&&V.length>B&&!V.warned){V.warned=!0;var re=new Error("Possible EventEmitter memory leak detected. "+V.length+" "+String(_)+" listeners added. Use emitter.setMaxListeners() to increase limit");re.name="MaxListenersExceededWarning",re.emitter=y,re.type=_,re.count=V.length,s(re)}return y}i.prototype.addListener=function(_,A){return h(this,_,A,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(_,A){return h(this,_,A,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(y,_,A){var I={fired:!1,wrapFn:void 0,target:y,type:_,listener:A},B=d.bind(I);return B.listener=A,I.wrapFn=B,B}i.prototype.once=function(_,A){return a(A),this.on(_,g(this,_,A)),this},i.prototype.prependOnceListener=function(_,A){return a(A),this.prependListener(_,g(this,_,A)),this},i.prototype.removeListener=function(_,A){var I,B,G,V,re;if(a(A),B=this._events,B===void 0)return this;if(I=B[_],I===void 0)return this;if(I===A||I.listener===A)--this._eventsCount===0?this._events=Object.create(null):(delete B[_],B.removeListener&&this.emit("removeListener",_,I.listener||A));else if(typeof I!="function"){for(G=-1,V=I.length-1;V>=0;V--)if(I[V]===A||I[V].listener===A){re=I[V].listener,G=V;break}if(G<0)return this;G===0?I.shift():E(I,G),I.length===1&&(B[_]=I[0]),B.removeListener!==void 0&&this.emit("removeListener",_,re||A)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(_){var A,I,B;if(I=this._events,I===void 0)return this;if(I.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):I[_]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete I[_]),this;if(arguments.length===0){var G=Object.keys(I),V;for(B=0;B<G.length;++B)V=G[B],V!=="removeListener"&&this.removeAllListeners(V);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(A=I[_],typeof A=="function")this.removeListener(_,A);else if(A!==void 0)for(B=A.length-1;B>=0;B--)this.removeListener(_,A[B]);return this};function f(y,_,A){var I=y._events;if(I===void 0)return[];var B=I[_];return B===void 0?[]:typeof B=="function"?A?[B.listener||B]:[B]:A?v(B):p(B,B.length)}i.prototype.listeners=function(_){return f(this,_,!0)},i.prototype.rawListeners=function(_){return f(this,_,!1)},i.listenerCount=function(y,_){return typeof y.listenerCount=="function"?y.listenerCount(_):C.call(y,_)},i.prototype.listenerCount=C;function C(y){var _=this._events;if(_!==void 0){var A=_[y];if(typeof A=="function")return 1;if(A!==void 0)return A.length}return 0}i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function p(y,_){for(var A=new Array(_),I=0;I<_;++I)A[I]=y[I];return A}function E(y,_){for(;_+1<y.length;_++)y[_]=y[_+1];y.pop()}function v(y){for(var _=new Array(y.length),A=0;A<_.length;++A)_[A]=y[A].listener||y[A];return _}function z(y,_){return new Promise(function(A,I){function B(V){y.removeListener(_,G),I(V)}function G(){typeof y.removeListener=="function"&&y.removeListener("error",B),A([].slice.call(arguments))}Y(y,_,G,{once:!0}),_!=="error"&&M(y,B,{once:!0})})}function M(y,_,A){typeof y.on=="function"&&Y(y,"error",_,A)}function Y(y,_,A,I){if(typeof y.on=="function")I.once?y.once(_,A):y.on(_,A);else if(typeof y.addEventListener=="function")y.addEventListener(_,function B(G){I.once&&y.removeEventListener(_,B),A(G)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof y)}return it.exports}var es=mi();class pi extends es.EventEmitter{constructor(t){super();u(this,"nodes");u(this,"_head");u(this,"_tail");u(this,"_eqFunc",(t,s)=>t===s);this.nodes=new Set,this._head=null,this._tail=null,this._eqFunc=t}get head(){return this._head}get tail(){return this._tail}get length(){return this.nodes.size}insert(t){this._tail?this.insertAfter(t,this._tail):(this._tail=t,this.nodes.add(t)),this._head||(this._head=t)}prepend(t){this._head?this.insertBefore(t,this._head):(this._head=t,this.nodes.add(t)),this._tail||(this._tail=t)}remove(t,s){this.nodes.delete(t);const r=t.prev,i=t.next;r&&(r.next=i),i&&(i.prev=r),t.prev=null,t.next=null,this._eqFunc(t,this._tail)&&(this._tail=r),this._eqFunc(t,this._head)&&(this._head=i)}removeBy(t,s){let r=[];return Array.from(this.nodes).forEach(i=>{t(i)&&(this.remove(i,s),r.push(i))}),r}insertBefore(t,s){s&&(s.insertBefore(t),this.nodes.add(t),t.isHead&&(this._head=t))}insertAfter(t,s){s&&(s.insertAfter(t),this.nodes.add(t),t.isTail&&(this._tail=t))}forEach(t){this.forEachBreak(t,()=>!1)}forEachBreak(t,s){let r=0,i=this._head;for(;i;){if(s&&s(i,r))return;t(i,r),i=i.next,r++}}forEachRevert(t){this.forEachBreakRevert(t,()=>!1)}forEachBreakRevert(t,s){let r=this.length-1,i=this._tail;for(;i;){if(s&&s(i,r))return;t(i,r),i=i.prev,r--}}getIndex(t){let s=-1,r=this._head;for(;r;){if(s++,this._eqFunc(r,t))return s;r=r.next}return s}filter(t){const s=[];return this.forEach(r=>{t(r)&&s.push(r)}),s}}const _s=(n,e)=>n.value&&e.value&&n.value.id===e.value.id;class It extends pi{constructor(){super(_s)}_addElementObserve(e){Object.keys(he).forEach(t=>{we(()=>e.value[t],()=>{this.emit(t,e.value,e.value[t])})})}insert(e,t=!0){Me(()=>{this._addElementObserve(e),super.insert(e),t&&this.emit(Se.added,e)})}insertBefore(e,t,s=!0){Me(()=>{this._addElementObserve(e),super.insertBefore(e,t),s&&this.emit(Se.added,e)})}insertAfter(e,t,s=!0){Me(()=>{this._addElementObserve(e),super.insertAfter(e,t),s&&this.emit(Se.added,e)})}prepend(e,t=!0){Me(()=>{this._addElementObserve(e),super.prepend(e),t&&this.emit(Se.added,e)})}remove(e,t=!0){Me(()=>{super.remove(e),t&&this.emit(Se.removed,e)})}removeBy(e,t=!0){let s=[];return Me(()=>{s=super.removeBy(e,t)}),s}static isConsecutive(e){if(e.length<2)return!0;let t=e[0],s=1;for(;t.next&&_s(t.next,e[s]);)if(t=t.next,s++,s===e.length)break;return s===e.length}}class Ci{static deepPlanObjectAssign(e,...t){return t.forEach(s=>{for(const r in s)s.hasOwnProperty(r)&&(b.isPlainObject(s[r])?(e[r]===void 0&&(e[r]={}),this.deepPlanObjectAssign(e[r],s[r])):e[r]=s[r])}),e}static isAllEqualWith(e,t,s){return e.every(r=>s(r,t))}}class _i{constructor(e){u(this,"shield");u(this,"_elementList",new It);u(this,"_currentCreatingElementId");u(this,"_elementsMap",new Map);u(this,"_provisionalElements",[]);u(this,"_selectedElements",[]);u(this,"_targetElements",[]);u(this,"_rangeElements",[]);u(this,"_visibleElements",[]);u(this,"_stageElements",[]);u(this,"_editingElements",[]);u(this,"_rotatingTargetElements",[]);u(this,"_provisionalElementIds",X.set(new Set));u(this,"_selectedElementIds",X.set(new Set));u(this,"_targetElementIds",X.set(new Set));u(this,"_visibleElementIds",X.set(new Set));u(this,"_rangeElementIds",X.set(new Set));u(this,"_stageElementIds",X.set(new Set));u(this,"_editingElementIds",X.set(new Set));u(this,"_rotatingTargetElementIds",X.set(new Set));u(this,"_rotatingCenter");u(this,"_rotatingCenterCoord");u(this,"_rotatingOriginalAngle");u(this,"_isMultiSelected",!1);u(this,"_noParentElements",[]);u(this,"_selectedAncestorElement");u(this,"_primarySelectedElement");this.shield=e,this._reactionElementAdded(),this._reactionElementRemoved(),this._reactionElementsPropsChanged(),this._reactionElementsSelectionChanged()}get selectedElementIds(){return this._selectedElementIds}get creatingElements(){const e=this._elementsMap.get(this._currentCreatingElementId);return e?[e]:[]}get isProvisionalEmpty(){return this._provisionalElementIds.size===0}get provisionalElements(){return this._provisionalElements}get selectedElements(){return this._selectedElements}get targetElements(){return this._targetElements}get stageElements(){return this._stageElements}get rangeElements(){return this._rangeElements}get visibleElements(){return this._visibleElements}get selectedAncestorElement(){return this._selectedAncestorElement}get primarySelectedElement(){return this._primarySelectedElement}get rotatingTargetElements(){return this._rotatingTargetElements}get editingElements(){return this._editingElements}get isSelectedEmpty(){return this._selectedElementIds.size===0}get isVisibleEmpty(){return this._visibleElementIds.size===0}get isEmpty(){return this._elementList.length===0}get isEditingEmpty(){return this._editingElementIds.size===0}get isTargetEmpty(){return this._targetElementIds.size===0}get isRangeEmpty(){return this._rangeElementIds.size===0}get isStageEmpty(){return this._stageElementIds.size===0}get isRotatingTargetEmpty(){return this._rotatingTargetElementIds.size===0}get noParentElements(){return this._noParentElements}get isMultiSelected(){return this._isMultiSelected}_reactionElementAdded(){this._elementList.on(Se.added,e=>{const t=e.value;Object.keys(he).forEach(s=>{this._reactionElementPropsChanged(he[s],t,t[s])})})}_reactionElementRemoved(){this._elementList.on(Se.removed,e=>{const{id:t}=e.value;this._elementsMap.delete(t),this._selectedElementIds.delete(t),this._targetElementIds.delete(t),this._provisionalElementIds.delete(t),this._rotatingTargetElementIds.delete(t),this._editingElementIds.delete(t),this._rangeElementIds.delete(t),this._visibleElementIds.delete(t),this._stageElementIds.delete(t)})}_reactionElementsPropsChanged(){Object.keys(he).forEach(e=>{this._elementList.on(e,(t,s)=>{this._reactionElementPropsChanged(e,t,s)})})}_reactionElementsSelectionChanged(){we(()=>Array.from(this._selectedElementIds),()=>{this._reactionSelectedElementsChanged(),this.shield.selection.refresh()}),we(()=>Array.from(this._targetElementIds),()=>this._reactionTargetElementsChanged()),we(()=>Array.from(this._provisionalElementIds),()=>this._reactionProvisionalElementsChanged()),we(()=>Array.from(this._rotatingTargetElementIds),()=>this._reactionRotatingTargetElementsChanged()),we(()=>Array.from(this._editingElementIds),()=>this._reactionEditingElementsChanged()),we(()=>Array.from(this._rangeElementIds),()=>this._reactRangeElementsChanged()),we(()=>Array.from(this._visibleElementIds),()=>this._reactionVisibleElementsChanged()),we(()=>Array.from(this._stageElementIds),()=>this._reactionStageElementsChanged())}_reactionSelectedElementsChanged(){this._selectedElements=this._filterList(this._selectedElementIds),this._noParentElements=x.getNoParentElements(this._selectedElements),this._isMultiSelected=this._noParentElements.length>1,this._selectedAncestorElement=x.getAncestorGroup(this._selectedElements),this._primarySelectedElement=this._selectedAncestorElement&&!this._selectedAncestorElement.isProvisional?this._selectedAncestorElement:null,this.shield.emit(O.selectedChanged,this._selectedElements),this.shield.emit(O.multiSelectedChanged,this._isMultiSelected),this.shield.emit(O.primarySelectedChanged,this._primarySelectedElement),this._emitElementsLayerChanged()}_emitElementsLayerChanged(){this._selectedElements.length&&(It.isConsecutive(this._selectedElements.map(e=>e.node))?(this.shield.emit(O.layerShiftMoveEnableChanged,!this._selectedElements[this._selectedElements.length-1].isTopmost),this.shield.emit(O.layerGoDownEnableChanged,!this._selectedElements[0].isBottommost)):(this.shield.emit(O.layerShiftMoveEnableChanged,!0),this.shield.emit(O.layerGoDownEnableChanged,!0)))}_reactionTargetElementsChanged(){this._targetElements=this._filterList(this._targetElementIds),this.shield.emit(O.targetChanged,this._targetElements)}_reactionStageElementsChanged(){this._stageElements=this._filterList(this._stageElementIds)}_reactionVisibleElementsChanged(){this._visibleElements=this._filterList(this._visibleElementIds)}_reactRangeElementsChanged(){this._rangeElements=this._filterList(this._rangeElementIds)}_reactionEditingElementsChanged(){this._editingElements=this._filterList(this._editingElementIds)}_reactionRotatingTargetElementsChanged(){this._rotatingTargetElements=this._filterList(this._rotatingTargetElementIds)}_reactionProvisionalElementsChanged(){this._provisionalElements=this._filterList(this._provisionalElementIds)}_filterList(e){return this._elementList.filter(t=>e.has(t.value.id)).map(t=>t.value)}_setAddDelete(e,t,s){s?e.add(t):e.delete(t)}_reactionElementPropsChanged(e,t,s){switch(e){case he.isSelected:{this._setAddDelete(this._selectedElementIds,t.id,s);break}case he.isProvisional:{this._setAddDelete(this._provisionalElementIds,t.id,s);break}case he.isTarget:{this._setAddDelete(this._targetElementIds,t.id,s);break}case he.isRotatingTarget:{this._setAddDelete(this._rotatingTargetElementIds,t.id,s);break}case he.isEditing:{this._setAddDelete(this._editingElementIds,t.id,s);break}case he.isInRange:{this._setAddDelete(this._rangeElementIds,t.id,s);break}case he.isVisible:{this._setAddDelete(this._visibleElementIds,t.id,s);break}case he.isOnStage:{this._setAddDelete(this._stageElementIds,t.id,s);break}}}filterEmit(e,t,...s){var r;t&&(t.id===((r=this.primarySelectedElement)==null?void 0:r.id)||t.id===this._currentCreatingElementId)&&this.shield.emit(e,t,...s)}async setElementsPosition(e,t){e.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){const{x:r,y:i}=s.model,{x:o,y:a}=t;if(r===o&&i===a)return;const c={x:o-r,y:a-i};s.setPosition(o,a,c),s.isGroup&&s.deepSubs.forEach(h=>{h.setPosition(h.model.x+c.x,h.model.y+c.y,c)})}})}async setElementsWidth(e,t){e.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){if(s.width===t)return;const r=s.setWidth(t);s.isGroup&&this.scaleSubs(s,r)}})}async setElementsHeight(e,t){e.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){if(s.height===t)return;const r=s.setHeight(t);s.isGroup&&this.scaleSubs(s,r)}})}scaleSubs(e,t){const{center:s,angle:r,leanYAngle:i}=e,{scaleX:o,scaleY:a}=l.getScaleFromMatrix(t);e.deepSubs.forEach(c=>{c.scaleBy(s,o,a,{angle:r,leanYAngle:i})})}async setElementsAngle(e,t){e.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){if(s.angle===t)return;this.rotateElements([s],t,s.angle,s.centerCoord)}})}async setElementsCorners(e,t,s){e.forEach(r=>{if(this.hasElement(r.id)&&!r.isGroupSubject){if(b.isEqual(r.corners,[t,t,t,t]))return;r.setCorners(t,s)}})}async setElementsLeanYAngle(e,t){e.forEach(s=>{if(this.hasElement(s.id)&&!s.isGroupSubject){if(s.leanYAngle===t)return;const r=s.leanYAngle;if(t=l.precise(t,1),s.setLeanYAngle(t),s.isGroup){const i=s.centerCoord;s.deepSubs.forEach(o=>{o.leanYBy(t,r,s.angle,i)})}}})}async setElementsStrokeType(e,t,s){e.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.strokes[s].type===t)return;r.setStrokeType(t,s)}})}async setElementsStrokeWidth(e,t,s){e.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.strokes[s].width===t)return;r.setStrokeWidth(t,s)}})}async setElementsStrokeColor(e,t,s){e.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.strokes[s].color===t)return;r.setStrokeColor(t,s)}})}async setElementsStrokeColorOpacity(e,t,s){e.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.strokes[s].colorOpacity===t)return;r.setStrokeColorOpacity(t,s)}})}async addElementsStroke(e,t){e.forEach(s=>{this.hasElement(s.id)&&s.addStroke(t)})}async removeElementsStroke(e,t){e.forEach(s=>{this.hasElement(s.id)&&s.removeStroke(t)})}async setElementsFillColor(e,t,s){e.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.fills[s].color===t)return;r.setFillColor(t,s)}})}async setElementsFillColorOpacity(e,t,s){e.forEach(r=>{if(this.hasElement(r.id)){if(r.model.styles.fills[s].colorOpacity===t)return;r.setFillColorOpacity(t,s)}})}async addElementsFill(e,t){e.forEach(s=>{this.hasElement(s.id)&&s.addFill(t)})}async removeElementsFill(e,t){e.forEach(s=>{this.hasElement(s.id)&&s.removeFill(t)})}async setElementsTextAlign(e,t){e.forEach(s=>{if(this.hasElement(s.id)){if(s.textAlign===t)return;s.setTextAlign(t)}})}async setElementsTextBaseline(e,t){e.forEach(s=>{if(this.hasElement(s.id)){if(s.textBaseline===t)return;s.setTextBaseline(t)}})}async setElementsFontSize(e,t){e.forEach(s=>{if(this.hasElement(s.id)){if(s.fontSize===t)return;s.setFontSize(t)}})}async setElementsFontFamily(e,t){e.forEach(s=>{if(this.hasElement(s.id)){if(s.fontFamily===t)return;s.setFontFamily(t)}})}async setElementsRatioLocked(e,t){e.forEach(s=>{if(this.hasElement(s.id)){if(s.isRatioLocked===t)return;s.setRatioLocked(t)}})}hasElement(e){return this._elementsMap.has(e)}getElementById(e){return this._elementsMap.get(e)}getElementsByIds(e){return e.map(t=>this.getElementById(t)).filter(t=>t!==void 0)}getIndexById(e){return this.hasElement(e)&&this._elementList.forEachBreak((t,s)=>{if(t.value.id===e)return s},t=>{if(t.value.id===e)return!0}),-1}addElement(e,t){const s=new gn(e);return e.node=s,t?this._elementList.insertAfter(s,t.node):this._elementList.insert(s),this._elementsMap.set(e.id,e),e}addElementByModel(e){const t=x.createElement(e,this.shield);return Object.assign(t,{status:Q.finished,isOnStage:!0,isSelected:!0}),this.addElement(t),t.refresh(),t}removeElement(e){if(this.hasElement(e)){let t=this._elementsMap.get(e);return this._elementList.removeBy(s=>s.value.id===e),this._elementsMap.delete(e),t=null,t}}updateElementById(e,t){if(this.hasElement(e)){const s=this._elementsMap.get(e);return Object.assign(s,t),s}}updateElements(e,t){return e.forEach(s=>this.updateElementById(s.id,t)),e}updateElementModel(e,t){if(this.hasElement(e)){const s=this._elementsMap.get(e),r=s.model.id;return Ci.deepPlanObjectAssign(s.model,t,{id:r}),s}}updateElementsModel(e,t){e.forEach(s=>{this.updateElementModel(s.id,t)})}createElementModel(e,t,s){const r=x.calcSize({coords:t,boxCoords:S.getBoxPoints(t),type:e}),i=x.calcPosition({type:e,coords:t});return{...x.createEmptyObject(),type:e,coords:t,boxCoords:S.getBoxPoints(t),data:s,width:r.width,height:r.height,name:`${Zs.getCreatorByType(e).name} ${+new Date}`,styles:us(e),isRatioLocked:!1,...i,...Ut,...Qe}}_setElementProvisionalCreating(e){this.updateElementById(e.id,{status:Q.creating,isOnStage:!1,isProvisional:!0,isSelected:!0})}_createProvisionalElement(e){const t=x.createElement(e,this.shield);return this._currentCreatingElementId=t.id,this.updateElementById(t.id,{status:Q.startCreating}),this.addElement(t),t}creatingElement(e){let t;const{category:s,type:r}=this.shield.currentCreator;switch(s){case se.shapes:{const i=this.createElementModel(r,x.calcCreatorPoints(e,r));this._currentCreatingElementId?(delete i.id,t=this.updateElementModel(this._currentCreatingElementId,i),t.model.boxCoords=S.getBoxPoints(t.model.coords),this._setElementProvisionalCreating(t)):t=this._createProvisionalElement(i)}}return this.selectElement(t),t.refresh(),t}creatingArbitraryElement(e,t){let s,r;return this._currentCreatingElementId?(s=this.getElementById(this._currentCreatingElementId),r=s.model,t?l.isPointClosest(e,r.coords[0],un/this.shield.stageScale)?s.tailCoordIndex>0&&(r.isFold=!0):(r.coords.splice(r.coords.length-1,1,e),s.tailCoordIndex=r.coords.length-1):s.tailCoordIndex+1===r.coords.length?r.coords.push(e):r.coords.splice(s.tailCoordIndex+1,1,e),s.model.boxCoords=S.getBoxPoints(s.model.coords),this._setElementProvisionalCreating(s)):(r=this.createElementModel(P.arbitrary,[e]),r.isFold=!1,s=this._createProvisionalElement(r),s.tailCoordIndex=0),this.selectElement(s),s.refresh({size:!0,points:!0,position:!0}),s}_finishArbitraryElement(e){const t=e.tailCoordIndex;e.tailCoordIndex=-1,t<e.model.coords.length-1&&(e.model.coords=e.model.coords.slice(0,t+1))}finishCreatingElement(){if(this._currentCreatingElementId){let e=this.getElementById(this._currentCreatingElementId);if(e){this._currentCreatingElementId=null;const{model:{type:t}}=e;switch(t){case P.arbitrary:{this._finishArbitraryElement(e);break}}return this.updateElementById(e.id,{status:Q.finished}),e.model.boxCoords=S.getBoxPoints(e.model.coords),e.refresh(),e}}}findElements(e){const t=[];return this._elementList.forEach(s=>{e(s.value)&&t.push(s.value)}),t}updateElementsTransform(e,t){e.forEach(s=>{s.transform(t),s.isGroup&&!s.isGroupSubject&&s.deepSubs.forEach(r=>{const{transformLockCoord:i,transformLockIndex:o,originalTransformMoveCoord:a,transformType:c,model:{angle:h,leanYAngle:d}}=s;r.transformBy({lockCoord:i,lockIndex:o,originalMovingCoord:a,offset:t,groupAngle:h,groupLeanYAngle:d,transformType:c})})})}updateElementsCorner(e,t){e.forEach(s=>{s.updateCornerByOffset(t)})}updateElementsTranslate(e,t){e.forEach(s=>{s.translateBy(t),this._updateElementStageStatusIfy(s)})}forEach(e){this._elementList.forEach((t,s)=>{e(t.value,s)})}refreshElementsOriginals(e,t){this._refreshElementsByFunc(e,s=>s.refreshOriginalProps(),t)}refreshElementsOriginalAngles(e,t){this._refreshElementsByFunc(e,s=>s.refreshOriginalAngle(),t)}_refreshElementsByFunc(e,t,s){s=Object.assign({},kn,s||{});let r=new Set;function i(o){r.has(o.id)||(r.add(o.id),t(o))}e.forEach(o=>{i(o),o.isGroup&&(s.deepSubs?o.deepSubs.forEach(i):s.subs&&o.subs.forEach(i))}),r.clear(),r=null}_updateElementStageStatusIfy(e){const t=e.isModelPolygonOverlap(this.shield.stageWordRectCoords);this.updateElementById(e.id,{isOnStage:t})}refreshStageElements(){this._elementList.forEach(({value:e})=>{this._updateElementStageStatusIfy(e),e.refresh({points:!0,rotation:!0,originals:!0,outline:!0,strokes:!0})})}refreshElements(e){e.forEach(t=>{t.refresh()})}isSelectedContainsTarget(){return this.isTargetEmpty?!1:b.every(Array.from(this._targetElementIds),e=>this._selectedElementIds.has(e))}refreshRotatingStates(e){this.refreshElementsRotationStates(this.rotatingTargetElements,e)}refreshElementsRotationStates(e,t){const{center:s,centerCoord:r,angle:i}=this.calcRotatingStatesByElements(t,e);this._rotatingCenter=s,this._rotatingCenterCoord=r,this._rotatingOriginalAngle=i}calcRotatingStatesByElements(e,t){const s=l.calcCenter(t.map(o=>o.centerCoord).flat()),r=x.calcStageRelativePoint(s),i=l.precise(l.calcAngle(r,e));return{center:r,centerCoord:s,angle:i}}clearRotatingStates(){this._rotatingCenter=null,this._rotatingCenterCoord=null,this._rotatingOriginalAngle=null}updateElementsRotation(e,t){const s=l.precise(l.calcAngle(this._rotatingCenter,t));this.rotateElements(e,s,this._rotatingOriginalAngle,this._rotatingCenterCoord)}rotateElements(e,t,s,r){e.forEach(i=>{t=l.mirrorAngle(i.originalAngle+t-s),t=l.precise(t,1),i.setAngle(t),this._updateElementStageStatusIfy(i),i.isGroup&&i.deepSubs.forEach(o=>{o.rotateBy(t-i.originalAngle,r),this._updateElementStageStatusIfy(o)})})}async createImageElementModel(e,t){const{colorSpace:s}=t,{width:r,height:i}=e,o=S.get4BoxPoints(this.shield.stageWorldCoord,{width:r,height:i}),a=l.calcCenter(o);return{...x.createEmptyObject(),coords:o,boxCoords:S.getBoxPoints(o),type:P.image,data:e,name:"image",width:r,height:i,length:0,styles:us(P.image),colorSpace:s,naturalWidth:r,naturalHeight:i,isRatioLocked:!0,...a,...Qe}}async insertImageElement(e){let t;e instanceof ImageData&&(t=e.colorSpace,e=Nt.createImageFromImageData(e),await Nt.waitForImageLoad(e));const s=await this.createImageElementModel(e,{colorSpace:t});return this.addElementByModel(s)}deleteSelects(){this.selectedElements.forEach(e=>{this.removeElement(e.id)})}selectElement(e){this.updateElementById(e.id,{isSelected:!0})}deSelectElement(e){this.updateElementById(e.id,{isSelected:!1})}selectElements(e){e.forEach(t=>{this.selectElement(t)})}deSelectElements(e){e.forEach(t=>{this.deSelectElement(t)})}toggleSelectElement(e){e.isSelected?this.deSelectElement(e):this.selectElement(e)}toggleSelectElements(e){e.forEach(t=>{this.toggleSelectElement(t)})}selectAll(){this._elementList.forEach(e=>{this.selectElement(e.value)})}deSelectAll(){this._elementList.forEach(e=>{this.deSelectElement(e.value)})}cancelTargetElements(){this.targetElements.forEach(e=>{this.updateElementById(e.id,{isTarget:!1})})}beginEditingElements(e){this._setElementsEditing(e,!0)}endEditingElements(e){this._setElementsEditing(e,!1)}getFinishedSelectedElements(e){return this.selectedElements.filter(t=>t.status===Q.finished&&(e?!t.isGroupSubject:!0))}getSelectedElements(e){return this.selectedElements.filter(t=>e?!t.isGroupSubject:!0)}_setElementsEditing(e,t){e.forEach(s=>{s.editingEnable&&(this.updateElementById(s.id,{isEditing:t,status:t?Q.editing:Q.finished}),s.tfRefreshAfterEdChanged&&(s.refreshTransformers(),s.refreshOriginalTransformerCoords()))})}isSelectedEqCreating(){const e=new Set(this.selectedElements.map(s=>s.id)),t=new Set(this.creatingElements.map(s=>s.id));return b.isEqual(e,t)}_bindElementsGroup(e){e.subs.forEach(t=>{this.updateElementModel(t.id,{groupId:e.id})})}_unbindElementsGroup(e){this.updateElementsModel(e.getSubs(),{groupId:void 0}),this.updateElementModel(e.id,{subIds:[]})}_createElementGroupObject(e){e=e.filter(c=>!c.isGroupSubject);const t=e.map(c=>c.id),s=S.getBoxPoints(e.map(c=>c.rotateBoxCoords).flat()),{width:r,height:i,x:o,y:a}=S.getRect(s);return{...x.createEmptyGroupObject(),subIds:t,coords:s,boxCoords:S.getBoxPoints(s),width:r,height:i,x:o+r/2,y:a+i/2}}_sortElementsByLevel(e){return e.sort((t,s)=>this.getIndexById(t.id)-this.getIndexById(s.id))}_rearrangeForwardElementNodes(e){let t=e;if(!It.isConsecutive(e.map(s=>s.node))){t=this._sortElementsByLevel(e);const s=t[t.length-1];this._removeNodesByElements(t.slice(0,t.length-1));for(let r=0;r<=t.length-2;r++)this._elementList.insertBefore(t[r].node,s.node,!1)}return t}createElementGroup(e){const t=this._rearrangeForwardElementNodes(e),s=new Zt(this._createElementGroupObject(t),this.shield);return this._bindElementsGroup(s),this.addElement(s,t[t.length-1]),this.updateElementById(s.id,{status:Q.finished,isOnStage:!0}),s.refresh(),s}removeElementGroup(e){this.hasElementGroup(e.id)&&(this._unbindElementsGroup(e),this.deSelectGroup(e),this.removeElement(e.id))}hasElementGroup(e){return this.hasElement(e)}selectToGroup(){const e=this.selectedElements;return e.length<2||x.isSameAncestorGroup(e)?null:this.createElementGroup(e)}cancelSelectedGroups(){let e=this.getSelectedAncestorElementGroups();return e.length===0?null:(e.forEach(t=>{this.removeElementGroup(t)}),e)}getSelectedElementGroups(){return this.selectedElements.filter(e=>e.model.type===P.group)}getSelectedAncestorElementGroups(){return x.getNoParentElements(this.getSelectedElementGroups())}selectGroup(e){this.updateElementById(e.id,{isSelected:!0})}deSelectGroup(e){this.updateElementById(e.id,{isSelected:!1})}deSelectGroups(e){e.forEach(t=>{this.deSelectGroup(t)})}async copySelectElements(){return Promise.all(this.selectedElements.map(async e=>await e.toJson()))}async pasteElements(e){const t=[],s=x.convertElementsJson(e);for(const r of s){await x.convertElementModel(r);const i=this.addElementByModel(r);t.push(i)}return t}_removeNodesByElements(e){const t=[];return e.forEach(s=>{const[r]=this._elementList.removeBy(i=>i.value.id===s.id,!1);t.push(r)}),t}_getPrevmostElement(e){let t=e.subs[0];return t&&t.isGroup&&(t=this._getPrevmostElement(t)),t}async setElementsGoDown(e){if(e.length===0)return;let s=e[0].node.prev;s!=null&&s.value.isGroup&&(s=this._getPrevmostElement(s.value).node);const r=this._removeNodesByElements(e);s?r.forEach(i=>{this._elementList.insertBefore(i,s,!1)}):r.reverse().forEach(i=>{this._elementList.prepend(i,!1)}),this._reactionStageElementsChanged(),this._emitElementsLayerChanged()}async setElementsShiftMove(e){if(e.length===0)return;let s=e[e.length-1].node.next;s!=null&&s.value.isGroupSubject&&(s=s.value.ancestorGroup.node);const r=this._removeNodesByElements(e);s?r.forEach(i=>{this._elementList.insertAfter(i,s,!1),s=i}):r.forEach(i=>{this._elementList.insert(i,!1)}),this._reactionStageElementsChanged(),this._emitElementsLayerChanged()}}class ts extends yt{constructor(t){super();u(this,"tasks");u(this,"running");this.tasks=t}isEmpty(){return this.tasks.length===0}add(t){this.running||t&&this.tasks.push(t)}addAll(t){t.forEach(s=>{this.add(s)})}prepend(t){this.running||t&&this.tasks.unshift(t)}async run(){for(this.running=!0;this.tasks.length>0;){let t=this.tasks.shift();if(t)try{await t.run()}catch(s){console.error(s)}finally{t.destroy&&await t.destroy(),t=null}}this.running=!1}}class Ae extends yt{constructor(t,s){super();u(this,"model");u(this,"canvas");this.model=t,s&&(this.canvas=s.canvas)}destroy(){return this.model=null,this.id=null,this.canvas=null,Promise.resolve()}}class Ei extends Ae{async run(){var r,i;if(!this.canvas||!this.model)return;const{width:e}=Ot.strokes[0],t={};let{points:s}=this.model;s=x.calcStageRelativePoints(s),[ae.selection,ae.path].includes(this.model.type)&&(t.fills=[{colorOpacity:0}]),q.drawPathWithScale(this.canvas,s,Object.assign({},{...Ot,...t}),{},{...Ot.strokes[0],width:e*this.model.scale},{isFold:typeof((r=this.model.element)==null?void 0:r.isFold)>"u"?!0:(i=this.model.element)==null?void 0:i.isFold})}}class Es extends Ae{async run(){var e;this.canvas&&((e=this.canvas.getContext("2d"))==null||e.clearRect(0,0,this.canvas.width,this.canvas.height))}}class yi extends Ae{async run(){if(!this.canvas||!this.model)return;const{width:e}=De.strokes[0];let{scale:t,point:s,leanYAngle:r,actualAngle:i}=this.model;s=x.calcStageRelativePoint(s),q.drawPathWithScale(this.canvas,S.get4BoxPoints(s,{width:ht*t,height:ht*t},{angle:i,leanYAngle:r}),De,De.fills[0],{...De.strokes[0],width:e*t},{calcVertices:!1})}}class gt{constructor(){u(this,"running");u(this,"queue");u(this,"stopped");this.running=!1,this.queue=[],this.stopped=!1}async add(e){this.stopped||(this.queue.push(e),this.running||(this.running=!0,await this.run()))}async run(){if(this.stopped)return;if(this.queue.length===0){this.running=!1;return}let e=this.queue.shift();if(e)try{await e.run()}catch(t){console.error("RenderQueue: error running task",e.id,t)}finally{e.destroy&&await e.destroy(),e=null}this.queue.length>0?requestAnimationFrame(()=>{this.run()}):this.running=!1}async destroy(){for(this.stopped=!0;this.queue.length>0;){let e=this.queue.shift();e&&(e.destroy&&await e.destroy(),e=null)}this.queue=null,this.running=!1}}class vi extends gt{}class ss{constructor(e){u(this,"drawer");u(this,"renderQueue");this.drawer=e,this.renderQueue=new gt}async renderCargo(e){await this.renderQueue.add(e)}get renderParams(){return{canvas:this.drawer.canvas}}clear(){throw new Error("Method not implemented.")}async redraw(e){throw new Error("Method not implemented.")}}const wi="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1735111770421'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1464'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M510.9%2064.7c-108.7%200-214%2040.4-295%20111.8L107.3%2068v299.4h299.4L295.4%20256.1c60.3-51.3%20134.9-80.6%20215.5-80.6%20184.8%200%20335.2%20150.3%20335.2%20335.2S695.7%20845.8%20510.9%20845.8%20175.7%20695.4%20175.7%20510.6H64.9c0%20245.8%20200.1%20445.9%20445.9%20445.9s445.9-200.1%20445.9-445.9-200-445.9-445.8-445.9z'%20fill='%231296db'%20p-id='1465'%3e%3c/path%3e%3c/svg%3e";class bi extends Ae{get svg(){return wi}async run(){if(!this.canvas||!this.model)return;let{point:e,width:t,height:s,scale:r}=this.model;e=x.calcStageRelativePoint(e),await q.drawImgLike(this.canvas,this.svg,{x:(e.x-t*r/2)/r,y:(e.y-s*r/2)/r,width:t,height:s},{angle:this.model.angle})}}class Si extends Ae{async run(){if(!this.canvas||!this.model)return;let{text:e,point:t}=this.model;t=x.calcStageRelativePoint(t),q.drawRotateTextWithScale(this.canvas,e,t,Wt,Wt.fills[0],{angle:this.model.angle})}}class xi extends Ae{async run(){if(!this.canvas||!this.model)return;let{text:e,point:t}=this.model;await q.drawRotateTextWithScale(this.canvas,e,t,fs,fs.fills[0])}}class Bt extends Ae{async run(){if(!this.canvas||!this.model)return;let{point:e}=this.model;if(!e)return;let{radius:t}=this.model;const s={...De.strokes[0]},r={...De.fills[0]};t/=q.scale,e=x.calcStageRelativePoint(e),q.drawEllipseFillWithScale(this.canvas,e,{rx:t,ry:t},r),q.drawEllipseStrokeWithScale(this.canvas,e,{rx:t,ry:t},s)}}class Ai extends ss{constructor(){super(...arguments);u(this,"_lastCursorRendered",!1);u(this,"_lastSelectionRendered",!1)}async redraw(){let t=new ts([]),s=!1;const r=this.createMaskSelectionTasks();r.forEach(C=>{t.add(C)}),r.length&&(this._lastSelectionRendered=!0);const i=this.createMaskTransformerTasks();i.length&&t.addAll(i);const o=this.createControllerTasks();o.length&&t.addAll(o);const{store:{noParentElements:a},configure:{rotationIconEnable:c},selection:{rangeElement:h},cursor:d,isDrawerActive:g}=this.drawer.shield;if(a.length===1){const C=a[0];c&&C.rotationEnable&&C.status===Q.finished&&t.add(this.createMaskRotateTask(C.rotation)),t.add(this.createMaskIndicatorTask(C))}else a.length>1&&t.add(this.createMaskRotateTask(h.rotation));const f=d.getTask();f&&(t.add(f),this._lastCursorRendered=!0,s=!0),g&&(t.add(this.createMaskCursorPositionTask()),t.add(this.createMaskArbitraryCursorTask())),t.isEmpty()?(this._lastCursorRendered||this._lastSelectionRendered)&&!r.length&&!s?(t.add(new Es(null,this.renderParams)),await this.renderCargo(t),this._lastCursorRendered=!1,this._lastSelectionRendered=!1):t=null:(t.prepend(this.createMaskClearTask()),await this.renderCargo(t))}createMaskCursorPositionTask(){const{cursor:{value:t,worldValue:s},stageScale:r}=this.drawer.shield;if(!s)return;const i={point:{x:t.x+20/r,y:t.y+20/r},type:ae.cursorPosition,text:`${l.precise(s.x,1)},${l.precise(s.y,1)}`};return new xi(i,this.renderParams)}createMaskSelectionTasks(){const{selection:t,stageScale:s}=this.drawer.shield,r=[];return[...t.getModels(),t.selectionModel].forEach(o=>{if(o&&o.points.length>0){const a=new Ei({...o,scale:1/s},this.renderParams);r.push(a)}}),r}createMaskClearTask(){return new Es(null,this.renderParams)}createMaskTransformerTasks(){const{selection:{transformerModels:t}}=this.drawer.shield;return t.map(s=>{switch(s.element.transformerType){case Ie.circle:return new Bt(s,this.renderParams);case Ie.rect:return new yi(s,this.renderParams)}})}createControllerTasks(){const{store:{primarySelectedElement:t},selection:{rangeElement:s}}=this.drawer.shield,r=t||s;if(r){const{controllers:i=[]}=r;return i.map(o=>{if(!(o instanceof tt)&&!(o instanceof Ne)&&!(o instanceof Ze)){const a={point:{x:o.x,y:o.y},type:ae.transformer,radius:Vt};return new Bt(a,this.renderParams)}}).filter(o=>!!o)}return[]}createMaskRotateTask(t){const{x:s,y:r,points:i,angle:o,width:a,height:c,scale:h}=t,d={point:{x:s,y:r},points:i,angle:o,type:ae.rotate,width:a,height:c,scale:h};return new bi(d,this.renderParams)}createMaskIndicatorTask(t){const{stageScale:s}=this.drawer.shield;let r,i;switch(t.model.type){case P.line:{[r,i]=t.rotateCoords.sort((c,h)=>c.x-h.x);break}default:{if(t.model.angle%90===0&&t.model.leanYAngle===0){const{maxBoxCoords:c}=t;r=c[3],i=c[2]}else{const[c,h,d]=S.getLBRPoints(t.rotateBoxCoords,!0);let g=l.transformToAcuteAngle(l.calcAngle(h,c)+180),f=l.transformToAcuteAngle(l.calcAngle(h,d)+180);[r,i]=[g<f?c:d,h].sort((p,E)=>p.x-E.x)}break}}const o=l.calcAngle(r,i),a={point:l.calcSegmentLineCenterCrossPoint(r,i,!0,Hn/s),angle:o,type:ae.indicator,text:`${t.width} x ${t.height}`};return new Si(a,this.renderParams)}createMaskArbitraryCursorTask(){const{currentCreator:t,cursor:s}=this.drawer.shield;if(t.category===se.freedom){const r={point:s.value,type:ae.cursor,radius:Vt};return new Bt(r,this.renderParams)}}}class tr extends es.EventEmitter{constructor(){super(...arguments);u(this,"canvas");u(this,"renderer")}initCanvas(){return this.canvas=document.createElement("canvas"),this.canvas}updateCanvasSize(t){this.canvas.width=t.width,this.canvas.height=t.height}clearCanvas(){var t;(t=this.canvas.getContext("2d"))==null||t.clearRect(0,0,this.canvas.width,this.canvas.height)}async redraw(t){await this.renderer.redraw(t)}}class sr extends tr{constructor(t){super();u(this,"shield");this.shield=t}}class Pi extends sr{constructor(e){super(e),this.renderer=new Ai(this)}initCanvas(){return super.initCanvas(),this.canvas.id="mask",this.canvas.style.pointerEvents="none",this.canvas}}class rr extends He{async run(){var e;this.canvas&&((e=this.canvas.getContext("2d"))==null||e.clearRect(0,0,this.canvas.width,this.canvas.height))}}class Ri extends ss{constructor(){super(...arguments);u(this,"_latestElementRendered");u(this,"_latestClearRendered")}async redraw(){let t=new ts([]);const{creatingElements:s}=this.drawer.shield.store;s.length>0&&(s.forEach(r=>{const i=x.createElementTask(r,this.renderParams);i&&t.add(i)}),this._latestElementRendered=!0),this._latestClearRendered=t.isEmpty()&&this._latestElementRendered,!t.isEmpty()||this._latestClearRendered?(t.prepend(new rr(null,this.renderParams)),await this.renderCargo(t),this._latestClearRendered&&(this._latestClearRendered=!1)):t=null}}class Ti extends sr{constructor(e){super(e),this.renderer=new Ri(this)}initCanvas(){return super.initCanvas(),this.canvas.id="provisional",this.canvas.style.pointerEvents="none",this.canvas}}class ki{constructor(e){u(this,"shield");u(this,"rangeElement");u(this,"_selectionModel");u(this,"_transformerModels",[]);u(this,"_rangeCoords",null);this.shield=e,this.rangeElement=new Zt({...x.createEmptyGroupObject()},this.shield,!0)}get isEmpty(){const{isSelectedEmpty:e,isTargetEmpty:t,isRangeEmpty:s}=this.shield.store;return e&&t&&s}get isRange(){return this._rangeCoords!==null&&this._rangeCoords.length>0}get selectionModel(){return this._selectionModel}get transformerModels(){return this._transformerModels}get center(){return null}get internalAngle(){return 0}setRange(e){this._rangeCoords=e,this.refreshRangeElements(this._rangeCoords)}_getElementMaskModelProps(e,t){const{rotateCoords:s,rotateBoxCoords:r,model:{angle:i,isFold:o}}=e;return{points:t?r:s,angle:i,element:{isFold:o}}}_getElementsMaskModels(e,t){const s=[];return e.forEach(r=>{r&&(r.isGroupSubject||s.push({type:t,...this._getElementMaskModelProps(r)}))}),s}_getRangeElementsMaskModels(){return this._getElementsMaskModels(this.shield.store.rangeElements,ae.path)}_getTargetElementsMaskModels(){return this._getElementsMaskModels(this.shield.store.targetElements,ae.path)}_getSelectedElementsMaskModels(){const{store:e}=this.shield;return this._getElementsMaskModels([e.primarySelectedElement||e.creatingElements[0]],ae.path)}getModels(){const e=[];return this.isRange&&e.push(...this._getRangeElementsMaskModels()),e.push(...this._getTargetElementsMaskModels()),e.push(...this._getSelectedElementsMaskModels()),this.isRange&&e.push({points:this._rangeCoords,type:ae.range}),e}calcSelectionModel(){const e=this.shield.store.primarySelectedElement||this.rangeElement;if(e&&e.boxVerticesTransformEnable&&e.model.coords.length>0)return{type:ae.selection,points:e.rotateBoxCoords,angle:e.model.angle}}calcTransformerModels(){const{primarySelectedElement:e,creatingElements:t}=this.shield.store,s=e||t[0]||this.rangeElement;if(s&&s.model.coords.length>0){const{transformerType:r,angle:i,leanYAngle:o,actualAngle:a,transformers:c,verticesTransformEnable:h,flipX:d,flipY:g}=s;return this.calcTransformerModelsByPoints(c,{angle:i,leanYAngle:o,actualAngle:a,flipX:d,flipY:g},h?r:Ie.rect)}return[]}calcTransformerModelsByPoints(e,t,s){return e.map(r=>({point:r,type:ae.transformer,scale:1/this.shield.stageScale,element:{transformerType:s},radius:Vt,...t}))}clearSelects(){const{store:e}=this.shield;e.deSelectElements(e.selectedElements)}hitTargetElements(e){const{store:t}=this.shield,s=t.stageElements;for(let r=s.length-1;r>=0;r--){const i=s[r],o=i.isContainsCoord(e);if(t.updateElementById(i.id,{isTarget:o}),o){t.targetElements.forEach(a=>{a.id!==i.id&&t.updateElementById(a.id,{isTarget:!1})});break}}}selectTargets(){this.shield.store.updateElements(this.shield.store.targetElements,{isSelected:!0,isTarget:!1})}refreshRangeElements(e){if(e&&e.length){const{store:t}=this.shield;t.stageElements.forEach(s=>{t.updateElementById(s.id,{isInRange:s.isPolygonOverlap(e)})})}}selectRange(){if(this.isRange){const{store:e}=this.shield;e.updateElements(e.rangeElements,{isSelected:!0,isInRange:!1})}}getElementOnCoord(e){const t=this.shield.store.stageElements;for(let s=t.length-1;s>=0;s--){const r=t[s];if(r.isContainsCoord(e))return r}}refreshSelectionModel(){this._selectionModel=this.calcSelectionModel()}refreshTransformerModels(){this._transformerModels=this.calcTransformerModels()}refreshRangeElement(){const e=this.shield.store.selectedElements;if(e.length===0)Object.assign(this.rangeElement.model,x.createEmptyGroupObject());else{if(!this.rangeElement.isRotating&&!this.rangeElement.isTransforming){const t=S.getBoxPoints(e.map(s=>s.rotateCoords).flat());Object.assign(this.rangeElement.model,{coords:t,boxCoords:b.cloneDeep(t),...S.getRect(t),subIds:e.map(s=>s.id),...Ut})}this.rangeElement.isTransforming?this.rangeElement.refresh({points:!0,size:!0,rotation:!0,angles:!0,outline:!0,strokes:!0}):this.rangeElement.refresh()}}refresh(){this.refreshRangeElement(),this.refreshSelectionModel(),this.refreshTransformerModels()}tryActiveController(e){const t=this.shield.store.primarySelectedElement||this.rangeElement;if(t){const s=t.getControllerByCoord(e);if(t.setControllersActive(t.controllers.filter(r=>r.id!==(s==null?void 0:s.id)),!1),s)return t.setControllersActive([s],!0),s}}getActiveController(){const e=this.shield.store.primarySelectedElement||this.rangeElement;if(e)return e.getActiveController()}}const Oi="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1735892982581'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='15410'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M552.224%20179.712v664.576l68.704-68.704a36.576%2036.576%200%200%201%2051.712%2051.712l-130.24%20130.208a36.48%2036.48%200%200%201-26.72%2011.648h-0.064-0.032c-9.024%200-17.28-3.264-23.648-8.704l0.064%200.032a36.48%2036.48%200%200%201-4.576-3.872l-129.28-129.312a36.576%2036.576%200%200%201%2051.712-51.712l69.216%2069.216V179.232l-69.216%2069.216a36.576%2036.576%200%200%201-51.712-51.712l129.28-129.28c1.472-1.472%202.976-2.752%204.576-3.904a36.48%2036.48%200%200%201%2050.4%202.944l0.032%200.032%20130.24%20130.208a36.576%2036.576%200%200%201-51.712%2051.712l-68.704-68.704z'%20p-id='15411'%20fill='%232c2c2c'%3e%3c/path%3e%3c/svg%3e",Ii="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1735887761508'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='7589'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M641.264941%20791.853176l42.586353%2042.586353L512%201006.351059l-171.911529-171.91153%2042.586353-42.586353L481.882353%20891.060706v-227.20753h60.235294v227.20753l99.147294-99.20753zM481.882353%20132.939294v227.20753h60.235294V132.939294l99.147294%2099.147294%2042.586353-42.586353L512%2017.648941%20340.088471%20189.500235l42.586353%2042.586353L481.882353%20132.939294zM0%20481.882353v60.235294h1024V481.882353H0z'%20fill='%232c2c2c'%20p-id='7590'%3e%3c/path%3e%3c/svg%3e",Bi="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1737787540457'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1497'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M870.4%20204.8c-18.6368%200-36.1472%205.0176-51.2%2013.7728l0-64.9728c0-56.4736-45.9264-102.4-102.4-102.4-21.0944%200-40.6528%206.4-56.9856%2017.3568-14.0288-39.8848-52.0192-68.5568-96.6144-68.5568s-82.6368%2028.672-96.6144%2068.5568c-16.2816-10.9568-35.8912-17.3568-56.9856-17.3568-56.4736%200-102.4%2045.9264-102.4%20102.4l0%20377.4976-68.9152-119.4496c-13.3632-24.32-35.1744-41.6256-61.3888-48.7936-25.5488-6.9632-52.1216-3.2768-74.8544%2010.3424-46.4384%2027.8528-64.1536%2090.8288-39.424%20140.3904%201.536%203.1232%2034.2016%2070.0416%20136.192%20273.92%2048.0256%2096%20100.7104%20164.6592%20156.6208%20203.9808%2043.8784%2030.8736%2074.1888%2032.4608%2079.8208%2032.4608l256%200c43.5712%200%2084.0704-14.1824%20120.4224-42.0864%2034.1504-26.2656%2063.7952-64.256%2088.064-112.8448%2047.8208-95.6416%2073.1136-227.9424%2073.1136-382.6688l0-179.2c0-56.4736-45.9264-102.4-102.4-102.4zM921.6%20486.4c0%20146.7904-23.3984%20271.1552-67.6864%20359.7312-28.8768%2057.7536-80.5888%20126.6688-162.7136%20126.6688l-255.488%200c-1.9968-0.1536-23.552-2.56-56.064-26.88-32.4096-24.2688-82.176-75.3664-135.0656-181.248-103.7824-207.5648-135.68-272.9472-135.9872-273.5616-0.0512-0.1024-0.0512-0.1536-0.1024-0.2048-12.8512-25.7536-3.7376-59.4944%2019.9168-73.6768%2010.6496-6.4%2023.0912-8.0896%2035.072-4.864%2012.7488%203.4816%2023.4496%2012.0832%2030.0544%2024.1664%200.1024%200.1536%200.2048%200.3584%200.3072%200.512l79.9232%20138.496c16.3328%2029.8496%2034.7136%2042.3936%2054.6304%2037.3248%2019.968-5.0688%2030.0544-25.0368%2030.0544-59.2384l0-400.0256c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20332.8c0%2014.1312%2011.4688%2025.6%2025.6%2025.6s25.6-11.4688%2025.6-25.6l0-384c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20384c0%2014.1312%2011.4688%2025.6%2025.6%2025.6s25.6-11.4688%2025.6-25.6l0-332.8c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20384c0%2014.1312%2011.4688%2025.6%2025.6%2025.6s25.6-11.4688%2025.6-25.6l0-230.4c0-28.2112%2022.9888-51.2%2051.2-51.2s51.2%2022.9888%2051.2%2051.2l0%20179.2z'%20fill='%23000000'%20p-id='1498'%3e%3c/path%3e%3c/svg%3e",Li="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1736172747971'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='4849'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M512%200a36.571429%2036.571429%200%200%201%2036.571429%2036.571429v950.857142a36.571429%2036.571429%200%200%201-73.142858%200V36.571429A36.571429%2036.571429%200%200%201%20512%200z'%20fill='%23000000'%20p-id='4850'%3e%3c/path%3e%3cpath%20d='M0%20509.074286a36.571429%2036.571429%200%200%201%2036.571429-36.571429h950.857142a36.571429%2036.571429%200%200%201%200%2073.142857H36.571429a36.571429%2036.571429%200%200%201-36.571429-36.571428z'%20fill='%23000000'%20p-id='4851'%3e%3c/path%3e%3c/svg%3e",Mi="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1737790480190'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='8613'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M550.034286%20633.904762v154.331428l58.392381-56.661333%2050.95619%2052.46781-144.505905%20140.288-147.065904-140.01981%2050.419809-52.979809%2058.684953%2055.832381-0.024381-153.283048h73.142857z%20m234.008381-269.287619l140.288%20144.505905-140.01981%20147.065904-52.979809-50.419809%2055.832381-58.684953H633.904762v-73.142857h154.331428l-56.661333-58.368%2052.46781-50.95619z%20m-544.231619%200l52.467809%2050.95619-56.685714%2058.368H390.095238v73.142857H236.690286l55.832381%2058.684953-52.955429%2050.419809-140.019809-147.065904%20140.263619-144.505905zM514.876952%2099.669333l144.505905%20140.288-50.95619%2052.46781-58.368-56.661333L550.034286%20390.095238h-73.142857V236.81219l-58.660572%2055.832381-50.419809-52.979809%20147.065904-140.01981z'%20p-id='8614'%3e%3c/path%3e%3c/svg%3e",Fi="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1740288855242'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='38476'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M679.338667%20849.152a4.266667%204.266667%200%200%200%206.656%200l161.792-202.24a4.266667%204.266667%200%200%200-3.328-6.912H736v-32a320%20320%200%200%200-320-320H384V179.541333a4.266667%204.266667%200%200%200-6.912-3.328l-202.24%20161.792a4.266667%204.266667%200%200%200%200%206.656l202.24%20161.792A4.266667%204.266667%200%200%200%20384%20503.125333V394.666667h32a213.333333%20213.333333%200%200%201%20213.333333%20213.333333V640h-108.458666a4.266667%204.266667%200%200%200-3.328%206.912l161.792%20202.24z'%20fill='%23000000'%20p-id='38477'%3e%3c/path%3e%3cpath%20d='M685.994667%20849.152l-13.312-10.666667%2013.312%2010.666667z%20m-6.656%200l13.312-10.666667-13.312%2010.666667z%20m168.448-202.24l-13.312-10.666667%2013.312%2010.666667zM736%20640v17.066667h-17.066667V640h17.066667zM384%20288v17.066667h-17.066667v-17.066667H384z%20m-6.912-111.786667l10.666667%2013.312-10.666667-13.312z%20m-202.24%20161.792l10.666667%2013.312-10.666667-13.312z%20m0%206.656l-10.666667%2013.312%2010.666667-13.312z%20m202.24%20161.792l10.666667-13.312-10.666667%2013.312zM384%20394.666667h-17.066667v-17.066667H384v17.066667zM629.333333%20640h17.066667v17.066667h-17.066667V640z%20m-111.786666%206.912l-13.312%2010.666667%2013.312-10.666667z%20m181.76%20212.906667a21.333333%2021.333333%200%200%201-33.28%200l26.624-21.333334a12.8%2012.8%200%200%200-19.968%200l26.624%2021.333334z%20m161.792-202.24l-161.792%20202.24-26.624-21.333334%20161.792-202.24%2026.624%2021.333334z%20m-16.64-34.645334a21.333333%2021.333333%200%200%201%2016.64%2034.645334l-26.624-21.333334a12.8%2012.8%200%200%200%209.984%2020.821334v-34.133334z%20m-108.458667%200h108.458667v34.133334H736v-34.133334z%20m-17.066667%2017.066667v-32h34.133334V640h-34.133334z%20m0-32a302.933333%20302.933333%200%200%200-302.933333-302.933333v-34.133334a337.066667%20337.066667%200%200%201%20337.066667%20337.066667h-34.133334z%20m-302.933333-302.933333H384v-34.133334h32v34.133334zM401.066667%20179.541333V288h-34.133334V179.541333h34.133334z%20m-34.645334-16.64a21.333333%2021.333333%200%200%201%2034.645334%2016.64h-34.133334a12.8%2012.8%200%200%200%2020.778667%209.984l-21.333333-26.624zM164.181333%20324.693333l202.24-161.792%2021.333334%2026.624-202.24%20161.792-21.333334-26.624z%20m0%2033.28a21.333333%2021.333333%200%200%201%200-33.28l21.333334%2026.624a12.8%2012.8%200%200%200%200-19.968l-21.333334%2026.624z%20m202.24%20161.792L164.181333%20357.973333l21.333334-26.624%20202.24%20161.792-21.333334%2026.624z%20m34.645334-16.64a21.333333%2021.333333%200%200%201-34.645334%2016.64l21.333334-26.624a12.8%2012.8%200%200%200-20.821334%209.984h34.133334z%20m0-108.458666v108.458666h-34.133334V394.666667h34.133334z%20m-17.066667-17.066667h32v34.133333H384v-34.133333z%20m32%200a230.4%20230.4%200%200%201%20230.4%20230.4h-34.133333a196.266667%20196.266667%200%200%200-196.266667-196.266667v-34.133333z%20m230.4%20230.4V640h-34.133333v-32h34.133333z%20m-125.525333%2014.933333h108.458666v34.133334h-108.458666v-34.133334z%20m-16.64%2034.645334a21.333333%2021.333333%200%200%201%2016.64-34.645334v34.133334a12.8%2012.8%200%200%200%209.984-20.778667l-26.624%2021.333333z%20m161.792%20202.24l-161.792-202.24%2026.624-21.333334%20161.792%20202.24-26.624%2021.333334z'%20fill='%23FFFFFF'%20p-id='38478'%3e%3c/path%3e%3c/svg%3e";class qe extends Ae{constructor(t,s,r){super(t,r);u(this,"type",de.vertices);this.type=s}get img(){switch(this.type){case de.vertices:return Oi;case de.border:return Ii;case de.hand:return Bi;case de.cross:return Li;case de.move:return Mi;case de.rotation:return Fi}}async run(){if(!this.canvas||!this.model)return;let{point:{x:t,y:s},width:r,height:i,scale:o}=this.model;await q.drawImgLike(this.canvas,this.img,{x:(t-r*o/2)/o,y:(s-i*o/2)/o,width:r,height:i},{angle:this.model.angle})}}class Di{constructor(e){u(this,"value");u(this,"shield");this.shield=e,this.value=null}get worldValue(){return this.value?x.calcWorldCoord(this.value):null}get renderParams(){return{canvas:this.shield.mask.canvas}}clear(){this.value=null}transform(e){return this.shield.stageRect?(this.value=S.getEventPosition(e,this.shield.stageRect,this.shield.stageScale),this.value.x=Math.round(this.value.x),this.value.y=Math.round(this.value.y),this.value):{x:0,y:0}}setStyle(e){this.shield.canvas.style.cursor=e}updateStyle(e){this.shield.selection.getActiveController()||this.shield.isDrawerActive?this.setStyle("none"):this.shield.isHandActive?this.setStyle("grab"):this.setStyle("default")}getTask(){if(this.shield.isDrawerActive)return this.createMaskDrawingCursorTask();if(this.shield.isMoveableActive){const e=this.shield.selection.getActiveController();if(e instanceof Us)return this.createMaskRotationControllerCursorTask(e);if(e instanceof tt||e instanceof ut)return this.createMaskRotationCursorTask(e);if(e instanceof Ne)return this.createMaskTransformerCursorTask(e);if(e instanceof Ze)return this.createMaskBorderTransformerCursorTask(e)}}createMaskDrawingCursorTask(){if(this.value)return new qe(this._createTransformerCursorModel(),de.cross,this.renderParams)}createMaskRotationCursorTask(e){if(this.value)return new qe(this._createTransformerCursorModel({angle:e.angle}),de.move,this.renderParams)}createMaskRotationControllerCursorTask(e){if(this.value)return new qe(this._createTransformerCursorModel({angle:e.angle}),de.rotation,this.renderParams)}createMaskBorderTransformerCursorTask(e){if(this.value)return new qe(this._createTransformerCursorModel(e),de.border,this.renderParams)}createMaskTransformerCursorTask(e){if(this.value)return new qe(this._createTransformerCursorModel(e),de.vertices,this.renderParams)}_createTransformerCursorModel(e){return{point:this.value,type:ae.cursor,width:ms,height:ms,angle:(e==null?void 0:e.angle)||0,scale:1/this.shield.stageScale}}}class ee{static stopPP(e){e.stopPropagation(),e.preventDefault()}}var nr=function(){if(typeof Map<"u")return Map;function n(e,t){var s=-1;return e.some(function(r,i){return r[0]===t?(s=i,!0):!1}),s}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(t){var s=n(this.__entries__,t),r=this.__entries__[s];return r&&r[1]},e.prototype.set=function(t,s){var r=n(this.__entries__,t);~r?this.__entries__[r][1]=s:this.__entries__.push([t,s])},e.prototype.delete=function(t){var s=this.__entries__,r=n(s,t);~r&&s.splice(r,1)},e.prototype.has=function(t){return!!~n(this.__entries__,t)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,s){s===void 0&&(s=null);for(var r=0,i=this.__entries__;r<i.length;r++){var o=i[r];t.call(s,o[1],o[0])}},e}()}(),Gt=typeof window<"u"&&typeof document<"u"&&window.document===document,ft=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),Wi=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(ft):function(n){return setTimeout(function(){return n(Date.now())},1e3/60)}}(),Vi=2;function zi(n,e){var t=!1,s=!1,r=0;function i(){t&&(t=!1,n()),s&&a()}function o(){Wi(i)}function a(){var c=Date.now();if(t){if(c-r<Vi)return;s=!0}else t=!0,s=!1,setTimeout(o,e);r=c}return a}var Ni=20,Gi=["top","right","bottom","left","width","height","size","weight"],ji=typeof MutationObserver<"u",Hi=function(){function n(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=zi(this.refresh.bind(this),Ni)}return n.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},n.prototype.removeObserver=function(e){var t=this.observers_,s=t.indexOf(e);~s&&t.splice(s,1),!t.length&&this.connected_&&this.disconnect_()},n.prototype.refresh=function(){var e=this.updateObservers_();e&&this.refresh()},n.prototype.updateObservers_=function(){var e=this.observers_.filter(function(t){return t.gatherActive(),t.hasActive()});return e.forEach(function(t){return t.broadcastActive()}),e.length>0},n.prototype.connect_=function(){!Gt||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),ji?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},n.prototype.disconnect_=function(){!Gt||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},n.prototype.onTransitionEnd_=function(e){var t=e.propertyName,s=t===void 0?"":t,r=Gi.some(function(i){return!!~s.indexOf(i)});r&&this.refresh()},n.getInstance=function(){return this.instance_||(this.instance_=new n),this.instance_},n.instance_=null,n}(),ir=function(n,e){for(var t=0,s=Object.keys(e);t<s.length;t++){var r=s[t];Object.defineProperty(n,r,{value:e[r],enumerable:!1,writable:!1,configurable:!0})}return n},Ge=function(n){var e=n&&n.ownerDocument&&n.ownerDocument.defaultView;return e||ft},or=bt(0,0,0,0);function mt(n){return parseFloat(n)||0}function ys(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return e.reduce(function(s,r){var i=n["border-"+r+"-width"];return s+mt(i)},0)}function Yi(n){for(var e=["top","right","bottom","left"],t={},s=0,r=e;s<r.length;s++){var i=r[s],o=n["padding-"+i];t[i]=mt(o)}return t}function $i(n){var e=n.getBBox();return bt(0,0,e.width,e.height)}function qi(n){var e=n.clientWidth,t=n.clientHeight;if(!e&&!t)return or;var s=Ge(n).getComputedStyle(n),r=Yi(s),i=r.left+r.right,o=r.top+r.bottom,a=mt(s.width),c=mt(s.height);if(s.boxSizing==="border-box"&&(Math.round(a+i)!==e&&(a-=ys(s,"left","right")+i),Math.round(c+o)!==t&&(c-=ys(s,"top","bottom")+o)),!Ui(n)){var h=Math.round(a+i)-e,d=Math.round(c+o)-t;Math.abs(h)!==1&&(a-=h),Math.abs(d)!==1&&(c-=d)}return bt(r.left,r.top,a,c)}var Xi=function(){return typeof SVGGraphicsElement<"u"?function(n){return n instanceof Ge(n).SVGGraphicsElement}:function(n){return n instanceof Ge(n).SVGElement&&typeof n.getBBox=="function"}}();function Ui(n){return n===Ge(n).document.documentElement}function Ki(n){return Gt?Xi(n)?$i(n):qi(n):or}function Ji(n){var e=n.x,t=n.y,s=n.width,r=n.height,i=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,o=Object.create(i.prototype);return ir(o,{x:e,y:t,width:s,height:r,top:t,right:e+s,bottom:r+t,left:e}),o}function bt(n,e,t,s){return{x:n,y:e,width:t,height:s}}var Qi=function(){function n(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=bt(0,0,0,0),this.target=e}return n.prototype.isActive=function(){var e=Ki(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},n.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},n}(),Zi=function(){function n(e,t){var s=Ji(t);ir(this,{target:e,contentRect:s})}return n}(),eo=function(){function n(e,t,s){if(this.activeObservations_=[],this.observations_=new nr,typeof e!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=s}return n.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof Ge(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new Qi(e)),this.controller_.addObserver(this),this.controller_.refresh())}},n.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof Ge(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},n.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},n.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(t){t.isActive()&&e.activeObservations_.push(t)})},n.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map(function(s){return new Zi(s.target,s.broadcastRect())});this.callback_.call(e,t,e),this.clearActive()}},n.prototype.clearActive=function(){this.activeObservations_.splice(0)},n.prototype.hasActive=function(){return this.activeObservations_.length>0},n}(),ar=typeof WeakMap<"u"?new WeakMap:new nr,lr=function(){function n(e){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var t=Hi.getInstance(),s=new eo(e,t,this);ar.set(this,s)}return n}();["observe","unobserve","disconnect"].forEach(function(n){lr.prototype[n]=function(){var e;return(e=ar.get(this))[n].apply(e,arguments)}});var to=function(){return typeof ft.ResizeObserver<"u"?ft.ResizeObserver:lr}();const so=typeof window>"u",ro=function(n){for(const e of n){const t=e.target.__resizeListeners__||[];t.length&&t.forEach(s=>{s(e)})}};class no{static addListener(e,t){so||e&&(e.__resizeListeners__||(e.__resizeListeners__=[],e.__ro__=new to(ro),e.__ro__.observe(e)),e.__resizeListeners__.push(t))}static removeListener(e,t){!e||!e.__resizeListeners__||(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),e.__resizeListeners__.length||e.__ro__.disconnect())}}var me={},vs;function io(){if(vs)return me;vs=1,Object.defineProperty(me,"__esModule",{value:!0});for(var n=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),e={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},t={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:n?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},s={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},r=1;r<20;r++)s["f"+r]=111+r;function i(f,C,p){C&&!("byKey"in C)&&(p=C,C=null),Array.isArray(f)||(f=[f]);var E=f.map(function(M){return c(M,C)}),v=function(Y){return E.some(function(y){return h(y,Y)})},z=p==null?v:v(p);return z}function o(f,C){return i(f,C)}function a(f,C){return i(f,{byKey:!0},C)}function c(f,C){var p=C&&C.byKey,E={};f=f.replace("++","+add");var v=f.split("+"),z=v.length;for(var M in e)E[e[M]]=!1;var Y=!0,y=!1,_=void 0;try{for(var A=v[Symbol.iterator](),I;!(Y=(I=A.next()).done);Y=!0){var B=I.value,G=B.endsWith("?")&&B.length>1;G&&(B=B.slice(0,-1));var V=g(B),re=e[V];if(B.length>1&&!re&&!t[B]&&!s[V])throw new TypeError('Unknown modifier: "'+B+'"');(z===1||!re)&&(p?E.key=V:E.which=d(B)),re&&(E[re]=G?null:!0)}}catch(Pe){y=!0,_=Pe}finally{try{!Y&&A.return&&A.return()}finally{if(y)throw _}}return E}function h(f,C){for(var p in f){var E=f[p],v=void 0;if(E!=null&&(p==="key"&&C.key!=null?v=C.key.toLowerCase():p==="which"?v=E===91&&C.which===93?91:C.which:v=C[p],!(v==null&&E===!1)&&v!==E))return!1}return!0}function d(f){f=g(f);var C=s[f]||f.toUpperCase().charCodeAt(0);return C}function g(f){return f=f.toLowerCase(),f=t[f]||f,f}return me.default=i,me.isHotkey=i,me.isCodeHotkey=o,me.isKeyHotkey=a,me.parseHotkey=c,me.compareHotkey=h,me.toKeyCode=d,me.toKeyName=g,me}var oo=io();const ne=jr(oo);class ao extends yt{constructor(t){super();u(this,"func");this.func=t}async run(){await this.func()}async destroy(){}}class lo extends ao{}class We{static getImageDataFromClipboard(e){return new Promise((t,s)=>{var a;const r=(a=e.clipboardData)==null?void 0:a.items;if(!r)return console.warn("No clipboard data"),s();const i=Array.from(r).filter(c=>c.type.startsWith("image/"));if(!i.length)return console.warn("No image in clipboard"),s();const o=Promise.all(i.map(c=>{const h=c.getAsFile();if(!h){console.warn("No blob in clipboard"),s();return}return q.getImageDataFromBlob(h)}));t(o)})}static getImageDataFromFileTransfer(e){return new Promise((t,s)=>{var i;const r=(i=e.dataTransfer)==null?void 0:i.files;if(!r)return console.warn("No files in drag event"),s();We.parseImageFiles(Array.from(r),t,s)})}static getImageDataFromFiles(e){return new Promise((t,s)=>We.parseImageFiles(e,t,s))}static parseImageFiles(e,t,s){const r=Array.from(e).filter(o=>o.type.startsWith("image/"));if(!r.length)return console.warn("No image in files"),s();const i=Promise.all(r.map(o=>q.getImageDataFromBlob(o)));t(i)}}class co{static wait(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}}class ho extends es.EventEmitter{constructor(t){super();u(this,"shield");u(this,"_isCtrl");u(this,"_isCtrlWheel");u(this,"_isShift");u(this,"_isCtrlEvent");u(this,"_isCtrlPlusEvent");u(this,"_isCtrlReduceEvent");u(this,"_isCtrl0Event");u(this,"_isCtrlAEvent");u(this,"_isCtrlMEvent");u(this,"_isCtrlHEvent");u(this,"_isCtrlGEvent");u(this,"_isCtrlCEvent");u(this,"_isCtrlZEvent");u(this,"_isCtrlYEvent");u(this,"_isCtrlShiftGEvent");u(this,"_isShiftEvent");u(this,"_isShift1Event");u(this,"_isDeleteEvent");u(this,"_isEscEvent");this.shield=t}get isCtrl(){return this._isCtrl}get isOnlyCtrl(){return this._isCtrl&&!this._isShift}get isCtrlWheel(){return this._isCtrlWheel}get isShift(){return this._isShift}get isOnlyShift(){return this._isShift&&!this._isCtrl}init(){this._isCtrl=!1,this._isCtrlWheel=!1,this._isCtrlEvent=ne("ctrl"),this._isCtrlPlusEvent=ne("ctrl+="),this._isCtrlReduceEvent=ne("ctrl+-"),this._isCtrl0Event=ne("ctrl+0"),this._isShiftEvent=ne("shift"),this._isShift1Event=ne("shift+1"),this._isDeleteEvent=ne("backspace"),this._isCtrlAEvent=ne("ctrl+a"),this._isCtrlMEvent=ne("ctrl+m"),this._isCtrlHEvent=ne("ctrl+h"),this._isCtrlGEvent=ne("ctrl+g"),this._isCtrlCEvent=ne("ctrl+c"),this._isCtrlZEvent=ne("ctrl+z"),this._isCtrlYEvent=ne("ctrl+y"),this._isCtrlShiftGEvent=ne("ctrl+shift+g"),this._isEscEvent=ne("esc"),this.initEvents()}async initEvents(){Promise.all([this.initRenderResizeEvent(),this.initMouseEvents()])}_isInputEvent(t){return t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement}async initRenderResizeEvent(){no.addListener(this.shield.renderEl,t=>{this.emit("resize",t)})}_createImages(t){if(t&&t.length){let s=new vi;t.forEach((r,i)=>{s.add(new lo(async()=>{await new Promise(o=>{this.emit("pasteImage",r,async()=>{await co.wait(100),o(!0)})}),i===t.length-1&&(await s.destroy(),s=null)}))})}}async initMouseEvents(){this.shield.canvas.addEventListener("mousemove",t=>{this.emit("cursorMove",t)}),this.shield.canvas.addEventListener("mouseleave",t=>{this.emit("cursorLeave",t)}),this.shield.canvas.addEventListener("mousedown",t=>{this.emit("pressDown",t)}),this.shield.canvas.addEventListener("mouseup",t=>{this.emit("pressUp",t)}),this.shield.canvas.addEventListener("dblclick",t=>{this.emit("dblClick",t)}),this.shield.canvas.addEventListener("wheel",t=>{ee.stopPP(t),this._isCtrlWheel=this._isCtrl,this._isCtrlWheel?this.emit("wheelScale",-t.deltaY/2e3,t):this.emit("wheelMove",{x:t.deltaX,y:t.deltaY},t)}),this.shield.canvas.addEventListener("dragover",t=>{ee.stopPP(t)}),this.shield.canvas.addEventListener("drop",t=>{ee.stopPP(t),We.getImageDataFromFileTransfer(t).then(s=>{this._createImages(s)}).catch(s=>{s&&console.warn(s)})}),document.addEventListener("keydown",t=>{this._isCtrl=this._isCtrlEvent(t),this._isCtrlPlusEvent(t)&&(ee.stopPP(t),this.emit("scaleIncrease")),this._isCtrlReduceEvent(t)&&(ee.stopPP(t),this.emit("scaleReduce")),this._isCtrl0Event(t)&&(ee.stopPP(t),this.emit("scale100")),this._isShift1Event(t)?(ee.stopPP(t),this.emit("scaleAutoFit")):this._isShiftEvent(t)?this._isShift=!0:this._isShift=!1,this._isInputEvent(t)||(this._isDeleteEvent(t)&&(ee.stopPP(t),this.emit("deleteSelects")),this._isCtrlAEvent(t)&&(ee.stopPP(t),this.emit("selectAll")),this._isCtrlMEvent(t)&&(ee.stopPP(t),this.emit("selectMoveable")),this._isCtrlHEvent(t)&&(ee.stopPP(t),this.emit("selectHand")),this._isCtrlGEvent(t)&&(ee.stopPP(t),this.emit("selectGroup")),this._isCtrlCEvent(t)&&(ee.stopPP(t),this.emit("selectCopy",t)),this._isCtrlZEvent(t)&&(ee.stopPP(t),this.emit("undo")),this._isCtrlYEvent(t)&&(ee.stopPP(t),this.emit("redo")),this._isCtrlShiftGEvent(t)&&(ee.stopPP(t),this.emit("selectGroupCancel")),this._isEscEvent(t)&&(ee.stopPP(t),this.emit("cancel")))}),document.addEventListener("keyup",t=>{this._isCtrl=t.ctrlKey,this._isShift=t.shiftKey}),document.addEventListener("paste",t=>{We.getImageDataFromClipboard(t).then(s=>{this._createImages(s)}).catch(s=>{s&&console.warn(s);try{const r=JSON.parse(t.clipboardData.getData("text/plain"));r&&this.emit("pasteElements",r)}catch(r){r&&console.warn(r)}})})}async onImagesUpload(t){if(t.length){const s=await We.getImageDataFromFiles(t);this._createImages(s)}}}class uo extends ss{constructor(){super(...arguments);u(this,"_lastestStageElementsSize",0)}async redraw(t){const{stageElements:s}=this.drawer.store;if(t||s.length!==this._lastestStageElementsSize){this._lastestStageElementsSize=s.length;const r=new ts([]);r.add(new rr(null,this.renderParams)),s.forEach(i=>{const o=x.createElementTask(i,this.renderParams);o&&r.add(o)}),await this.renderCargo(r)}}}const ws={rotationIconEnable:!0};class go{constructor(){u(this,"_configs",ws);this.config(ws),sn({enforceActions:"never"})}get rotationIconEnable(){return this._configs.rotationIconEnable}config(e){Object.assign(this._configs,e)}}var H=(n=>(n[n.NONE=0]="NONE",n[n.MOVING=1]="MOVING",n[n.ROTATING=2]="ROTATING",n[n.TRANSFORMING=3]="TRANSFORMING",n[n.CORNER_MOVING=4]="CORNER_MOVING",n[n.EDITING=5]="EDITING",n))(H||{});class fo{constructor(e){u(this,"shield");this.shield=e}_getElementsCoordsRect(e){return S.getRect(e.map(t=>this._getElementAlignCoords(t)).flat())}_calcElementsAllWidth(e){let t=0;return e.forEach(s=>{const r=S.getRect(this._getElementAlignCoords(s));t+=r.width}),t}_calcElementsAllHeight(e){let t=0;return e.forEach(s=>{const r=S.getRect(this._getElementAlignCoords(s));t+=r.height}),t}_sortElementsByX(e){return b.sortBy(e,t=>S.getRect(this._getElementAlignCoords(t)).x)}_sortElementsByXW(e){return b.sortBy(e,t=>{const{x:s,width:r}=S.getRect(this._getElementAlignCoords(t));return s+r})}_sortElementsByY(e){return b.sortBy(e,t=>S.getRect(this._getElementAlignCoords(t)).y)}_sortElementsByYH(e){return b.sortBy(e,t=>{const{y:s,height:r}=S.getRect(this._getElementAlignCoords(t));return s+r})}_getElementAlignCoords(e){return this.shield.event.isShift?e.alignOutlineCoords.flat():e.alignCoords}_setElementPositionByOffset(e,t,s){const r={x:t,y:s};e.setPosition(e.model.x+t,e.model.y+s,r),e.isGroup&&!e.isGroupSubject&&e.deepSubs.forEach(i=>{i.setPosition(i.model.x+t,i.model.y+s,r)})}setElementsAlignLeft(e){e=x.getNoParentElements(e);const{x:t}=this._getElementsCoordsRect(e);e.forEach(s=>{const{x:r}=S.getRect(this._getElementAlignCoords(s)),i=t-r;i!==0&&this._setElementPositionByOffset(s,i,0)})}setElementsAlignRight(e){e=x.getNoParentElements(e);const{x:t,width:s}=this._getElementsCoordsRect(e);e.forEach(r=>{const{x:i,width:o}=S.getRect(this._getElementAlignCoords(r)),a=t+s-i-o;a!==0&&this._setElementPositionByOffset(r,a,0)})}setElementsAlignTop(e){e=x.getNoParentElements(e);const{y:t}=this._getElementsCoordsRect(e);e.forEach(s=>{const{y:r}=S.getRect(this._getElementAlignCoords(s)),i=t-r;i!==0&&this._setElementPositionByOffset(s,0,i)})}setElementsAlignBottom(e){e=x.getNoParentElements(e);const{y:t,height:s}=this._getElementsCoordsRect(e);e.forEach(r=>{const{y:i,height:o}=S.getRect(this._getElementAlignCoords(r)),a=t+s-i-o;a!==0&&this._setElementPositionByOffset(r,0,a)})}setElementsAlignCenter(e){e=x.getNoParentElements(e);const{x:t,width:s}=this._getElementsCoordsRect(e);e.forEach(r=>{const{x:i,width:o}=S.getRect(this._getElementAlignCoords(r)),a=t+s/2-(i+o/2);a!==0&&this._setElementPositionByOffset(r,a,0)})}setElementsAlignMiddle(e){e=x.getNoParentElements(e);const{y:t,height:s}=this._getElementsCoordsRect(e);e.forEach(r=>{const{y:i,height:o}=S.getRect(this._getElementAlignCoords(r)),a=t+s/2-(i+o/2);a!==0&&this._setElementPositionByOffset(r,0,a)})}setElementsAverageVertical(e){e=x.getNoParentElements(e),e=this._sortElementsByY(e);const{y:t,height:s}=this._getElementsCoordsRect(e),r=S.getRect(this._getElementAlignCoords(e[0]));let i=t+r.height;const o=this._calcElementsAllHeight(e),a=(s-o)/(e.length-1);e=this._sortElementsByYH(e.slice(1)),e.forEach((c,h)=>{if(h!==e.length-1){const{y:d,height:g}=S.getRect(this._getElementAlignCoords(c)),f=i+a-d;f!==0&&this._setElementPositionByOffset(c,0,f),i=d+f+g}})}setElementsAverageHorizontal(e){e=x.getNoParentElements(e),e=this._sortElementsByX(e);const{x:t,width:s}=this._getElementsCoordsRect(e),r=S.getRect(this._getElementAlignCoords(e[0]));let i=t+r.width;const o=this._calcElementsAllWidth(e),a=(s-o)/(e.length-1);e=this._sortElementsByXW(e.slice(1)),e.forEach((c,h)=>{if(h!==e.length-1){const{x:d,width:g}=S.getRect(this._getElementAlignCoords(c)),f=i+a-d;f!==0&&this._setElementPositionByOffset(c,f,0),i=d+f+g}})}}class mo{static copyValueToClipboard(e){let t=document.createElement("input");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t),t=null}}class po{constructor(e){u(this,"shield");u(this,"undoStack");u(this,"redoStack");this.shield=e,this.undoStack=[],this.redoStack=[]}redo(){if(this.redoStack.length>0){const e=this.redoStack.pop();this.undoStack.push(e),e.redo()}}undo(){if(this.undoStack.length>0){const e=this.undoStack.pop();this.redoStack.push(e),e.undo()}}}var cr=(n=>(n.ElementsAdded="elements_added",n.ElementsRemoved="elements_removed",n.ElementsUpdated="elements_updated",n))(cr||{});class Co{constructor(e,t){u(this,"payload");u(this,"store");this.payload=e,this.store=t}undo(){this.payload.data.forEach(e=>{const{id:t}=e;this.store.removeElement(t)})}redo(){this.payload.data.forEach(e=>{this.store.addElementByModel(e)})}}class _o extends tr{constructor(){super();u(this,"currentCreator");u(this,"cursor");u(this,"mask");u(this,"provisional");u(this,"configure");u(this,"store");u(this,"selection");u(this,"event");u(this,"align");u(this,"undo");u(this,"stageScale",1);u(this,"stageWorldCoord",{x:0,y:0});u(this,"stageRect");u(this,"renderEl");u(this,"elementsStatus",H.NONE);u(this,"_cursorMoveQueue",new gt);u(this,"_redrawQueue",new gt);u(this,"_redrawFlag",!1);u(this,"_pressDownPosition");u(this,"_pressDownStageWorldCoord");u(this,"_pressUpPosition");u(this,"_pressUpStageWorldCoord");u(this,"_pressMovePosition");u(this,"_pressMoveStageWorldCoord");u(this,"_isPressDown",!1);u(this,"_isStageMoving",!1);u(this,"_originalStageWorldCoord");this.configure=new go,this.event=new ho(this),this.store=new _i(this),this.cursor=new Di(this),this.provisional=new Ti(this),this.selection=new ki(this),this.align=new fo(this),this.mask=new Pi(this),this.undo=new po(this),this.renderer=new uo(this),this._requestAnimationRedraw(),window.shield=this}get stageRectPoints(){return S.getRectVertices(this.stageRect)}get stageWordRectCoords(){let{width:t,height:s}=this.stageRect;return t/=this.stageScale,s/=this.stageScale,S.getBoxVertices(this.stageWorldCoord,{width:t,height:s})}get isElementsBusy(){return[H.ROTATING,H.MOVING,H.TRANSFORMING,H.CORNER_MOVING].includes(this.elementsStatus)}get isStageMoving(){return this._isStageMoving}get isDrawerActive(){var t;return[se.shapes,se.freedom].includes((t=this.currentCreator)==null?void 0:t.category)}get isHandActive(){var t;return((t=this.currentCreator)==null?void 0:t.type)===P.hand}get isMoveableActive(){var t;return((t=this.currentCreator)==null?void 0:t.type)===P.moveable}get isArbitraryDrawing(){var t;return((t=this.currentCreator)==null?void 0:t.type)===P.arbitrary}get stageCalcParams(){return{rect:this.stageRect,worldCoord:this.stageWorldCoord,scale:this.stageScale}}get movingOffset(){return{x:Math.floor(this._pressMoveStageWorldCoord.x-this._pressDownStageWorldCoord.x),y:Math.floor(this._pressMoveStageWorldCoord.y-this._pressDownStageWorldCoord.y)}}_addRedrawTask(t,s){this._redrawQueue.add({run:async()=>{await Promise.all([this.redraw(s),this.mask.redraw(),this.provisional.redraw()]),t&&await t()}})}async _requestAnimationRedraw(){requestAnimationFrame(async()=>{this._addRedrawTask(()=>this._requestAnimationRedraw(),this._redrawFlag),this._redrawFlag=!1})}async setElementsPosition(t,s){await this.store.setElementsPosition(t,s),t.forEach(r=>r.onPositionChanged()),this.selection.refresh(),this._redrawFlag=!0}async setElementsWidth(t,s){await this.store.setElementsWidth(t,s),t.forEach(r=>r.onWidthChanged()),this.selection.refresh(),this._redrawFlag=!0}async setElementsHeight(t,s){await this.store.setElementsHeight(t,s),t.forEach(r=>r.onHeightChanged()),this.selection.refresh(),this._redrawFlag=!0}async setElementsLeanYAngle(t,s){await this.store.setElementsLeanYAngle(t,s),t.forEach(r=>r.onLeanyAngleChanged()),this.selection.refresh(),this._redrawFlag=!0}async setElementsAngle(t,s){await this.store.setElementsAngle(t,s),t.forEach(r=>r.onAngleChanged()),this.selection.refresh(),this._redrawFlag=!0}async setElementsCorners(t,s,r){await this.store.setElementsCorners(t,s,r),t.forEach(i=>i.onCornerChanged()),this._redrawFlag=!0}async setElementsStrokeType(t,s,r){await this.store.setElementsStrokeType(t,s,r),t.forEach(i=>i.onStrokeTypeChanged()),this._redrawFlag=!0}async setElementsStrokeWidth(t,s,r){await this.store.setElementsStrokeWidth(t,s,r),t.forEach(i=>i.onStrokeWidthChanged()),this._redrawFlag=!0}async setElementsStrokeColor(t,s,r){await this.store.setElementsStrokeColor(t,s,r),t.forEach(i=>i.onStrokeColorChanged()),this._redrawFlag=!0}async setElementsStrokeColorOpacity(t,s,r){await this.store.setElementsStrokeColorOpacity(t,s,r),t.forEach(i=>i.onStrokeColorOpacityChanged()),this._redrawFlag=!0}async addElementsStroke(t,s){await this.store.addElementsStroke(t,s),t.forEach(r=>r.onStrokeAdded()),this._redrawFlag=!0}async removeElementsStroke(t,s){await this.store.removeElementsStroke(t,s),t.forEach(r=>r.onStrokeRemoved()),this._redrawFlag=!0}async setElementsFillColor(t,s,r){await this.store.setElementsFillColor(t,s,r),t.forEach(i=>i.onFillColorChanged()),this._redrawFlag=!0}async setElementsFillColorOpacity(t,s,r){await this.store.setElementsFillColorOpacity(t,s,r),t.forEach(i=>i.onFillColorOpacityChanged()),this._redrawFlag=!0}async addElementsFill(t,s){await this.store.addElementsFill(t,s),t.forEach(r=>r.onFillAdded()),this._redrawFlag=!0}async removeElementsFill(t,s){await this.store.removeElementsFill(t,s),t.forEach(r=>r.onFillRemoved()),this._redrawFlag=!0}async setElementsTextAlign(t,s){await this.store.setElementsTextAlign(t,s),t.forEach(r=>r.onTextAlignChanged()),this._redrawFlag=!0}async setElementsTextBaseline(t,s){await this.store.setElementsTextBaseline(t,s),t.forEach(r=>r.onTextBaselineChanged()),this._redrawFlag=!0}async setElementsFontSize(t,s){await this.store.setElementsFontSize(t,s),t.forEach(r=>r.onFontSizeChanged()),this._redrawFlag=!0}async setElementsFontFamily(t,s){await this.store.setElementsFontFamily(t,s),t.forEach(r=>r.onFontFamilyChanged()),this._redrawFlag=!0}async setElementsRatioLocked(t,s){await this.store.setElementsRatioLocked(t,s),t.forEach(r=>r.onRatioLockedChanged())}async init(t){this.renderEl=t,await Promise.all([this.initCanvas(),this.event.init()]),this._addEventListeners()}_addCursorQueueTask(t){this._cursorMoveQueue.add({run:t})}_addEventListeners(){this.event.on("resize",this._refreshSize.bind(this)),this.event.on("cursorMove",t=>this._addCursorQueueTask(()=>this._handleCursorMove(t))),this.event.on("pressDown",t=>this._addCursorQueueTask(()=>this._handlePressDown(t))),this.event.on("pressUp",t=>this._addCursorQueueTask(()=>this._handlePressUp(t))),this.event.on("cursorLeave",this._handleCursorLeave.bind(this)),this.event.on("dblClick",this._handleDblClick.bind(this)),this.event.on("wheelScale",this._handleWheelScale.bind(this)),this.event.on("wheelMove",this._handleWheelMove.bind(this)),this.event.on("scaleReduce",this._handleScaleReduce.bind(this)),this.event.on("scaleIncrease",this._handleScaleIncrease.bind(this)),this.event.on("scaleAutoFit",this._handleScaleAutoFit.bind(this)),this.event.on("scale100",this._handleScale100.bind(this)),this.event.on("pasteImage",this._handleImagePasted.bind(this)),this.event.on("deleteSelects",this._handleSelectsDelete.bind(this)),this.event.on("selectAll",this._handleSelectAll.bind(this)),this.event.on("selectCopy",this._handleSelectCopy.bind(this)),this.event.on("pasteElements",this._handlePasteElements.bind(this)),this.event.on("cancel",this._handleCancel.bind(this)),this.event.on("selectMoveable",this._handleSelectMoveable.bind(this)),this.event.on("selectHand",this._handleSelectHand.bind(this)),this.event.on("selectGroup",this._handleSelectGroup.bind(this)),this.event.on("selectGroupCancel",this._handleSelectGroupCancel.bind(this)),this.event.on("undo",this._handleUndo.bind(this)),this.event.on("redo",this._handleRedo.bind(this))}initCanvas(){super.initCanvas();const t=this.mask.initCanvas(),s=this.provisional.initCanvas();return this.renderEl.insertBefore(t,this.renderEl.firstChild),this.renderEl.insertBefore(s,this.mask.canvas),this.canvas.id="shield",this.renderEl.insertBefore(this.canvas,this.provisional.canvas),this.canvas}async _handleCursorMove(t){if(this.cursor.transform(t),this.cursor.updateStyle(t),this.isMoveableActive&&!this.isElementsBusy&&this.selection.hitTargetElements(this.cursor.worldValue),this._isPressDown)if(this.calcPressMove(t),this.isArbitraryDrawing)this._updatingArbitraryElementOnMovement(t),this.selection.refreshTransformerModels();else if(this.isDrawerActive)this._creatingElementOnMovement(t),this.selection.refreshTransformerModels();else if(this.isMoveableActive){if(this.store.isSelectedEmpty)this._createRange();else if(this.checkCursorPressMovedALittle(t)){switch(this.elementsStatus){case H.ROTATING:{this._rotateElements();break}case H.MOVING:{this._dragElements();break}case H.TRANSFORMING:{this._transformElements();break}case H.CORNER_MOVING:{this._movingElementsCorner();break}}[H.ROTATING,H.TRANSFORMING,H.CORNER_MOVING].includes(this.elementsStatus)||this.store.isSelectedContainsTarget()&&(this.elementsStatus=H.MOVING,await this._dragElements())}}else this.isHandActive&&(this._isStageMoving=!0,this._dragStage(t));else this.isMoveableActive&&this._tryActiveController();this.isElementsBusy&&this.store.cancelTargetElements()}_tryActiveController(){return this.selection.tryActiveController(this.cursor.worldValue)}_dragStage(t){this._refreshStageWorldCoord(t),this.store.refreshStageElements(),this.selection.refresh()}_dragElements(){const{selectedElements:t}=this.store;this.store.updateElements(t,{isDragging:!0}),this.store.updateElementsTranslate(t,this.movingOffset),t.forEach(s=>s.onTranslating()),this.selection.refresh(),this._redrawFlag=!0}_movingElementsCorner(){const{selectedElements:t}=this.store;this.store.updateElements(t,{isCornerMoving:!0}),this.store.updateElementsCorner(t,this.movingOffset),t.forEach(s=>s.onCornerChanging()),this._redrawFlag=!0}_transformElements(){const{selectedElements:t}=this.store;this.store.updateElements(t,{isTransforming:!0}),this.store.isMultiSelected?(this.selection.rangeElement.isTransforming=!0,this.store.updateElementsTransform([this.selection.rangeElement],this.movingOffset)):this.store.updateElementsTransform(t,this.movingOffset),t.forEach(s=>s.onTransforming()),this.selection.refresh(),this._redrawFlag=!0}_rotateElements(){const{selectedElements:t,noParentElements:s}=this.store;this.store.updateElements(t,{isRotating:!0}),this.store.isMultiSelected?(this.selection.rangeElement.isRotating=!0,this.store.updateElementsRotation([this.selection.rangeElement],this._pressMovePosition)):this.store.updateElementsRotation(s,this._pressMovePosition),t.forEach(r=>r.onRotating()),this.selection.refresh(),this._redrawFlag=!0}_createRange(){const t=S.getBoxPoints([this._pressDownStageWorldCoord,this._pressMoveStageWorldCoord]);this.selection.setRange(t)}async _handleCursorLeave(){this.cursor.clear(),this.cursor.setStyle("default")}async _handlePressDown(t){if(this._isPressDown=!0,this.calcPressDown(t),this.isDrawerActive&&!this.store.isSelectedEqCreating())this._clearStageSelects();else if(this.isMoveableActive){const s=this._tryActiveController();if(s&&this._refreshElementsOriginals([...this.store.selectedElements,this.selection.rangeElement],{deepSubs:!0}),s instanceof tt)this.store.updateElementById(s.host.id,{isRotatingTarget:!0}),this.store.isMultiSelected?this.store.refreshElementsRotationStates([this.selection.rangeElement],this._pressDownPosition):this.store.refreshRotatingStates(this._pressDownPosition),this.elementsStatus=H.ROTATING;else if(s instanceof Ne||s instanceof Ze)this.elementsStatus=H.TRANSFORMING;else if(s instanceof ut)this.elementsStatus=H.CORNER_MOVING;else{const r=this.selection.getElementOnCoord(this.cursor.worldValue),i=this.store.isSelectedContainsTarget();t.ctrlKey?r&&this.store.toggleSelectElement(r):i||(this._clearStageSelects(),r&&this.store.selectElement(r))}}else this.isHandActive&&(this._originalStageWorldCoord=b.cloneDeep(this.stageWorldCoord))}_refreshElementsOriginals(t,s){this.store.refreshElementsOriginalAngles(t,s),this.store.refreshElementsOriginals(t,s)}_handleArbitraryPressUp(){const t=this.store.creatingArbitraryElement(this.cursor.worldValue,!0);t!=null&&t.model.isFold&&this.commitArbitraryDrawing()}_clearStageSelects(){this.selection.clearSelects(),this.selection.setRange([])}async _handlePressUp(t){if(this._isPressDown=!1,this.calcPressUp(t),this.isArbitraryDrawing)this._isPressDown=!0,this._handleArbitraryPressUp();else if(this.isDrawerActive)this.store.finishCreatingElement();else if(this.isMoveableActive)if(this.store.isSelectedEmpty)this.selection.selectRange(),this.selection.setRange(null);else if(this.checkCursorPressUpALittle(t)){switch(this.elementsStatus){case H.MOVING:{this._endElementsDrag();break}case H.ROTATING:{this._endElementsRotate();break}case H.TRANSFORMING:{this._endElementsTransform();break}case H.CORNER_MOVING:{this._endMoveingElementsCorner();break}}[H.ROTATING,H.TRANSFORMING,H.CORNER_MOVING,H.MOVING].includes(this.elementsStatus)&&(this.elementsStatus=H.NONE)}else!t.ctrlKey&&!t.shiftKey&&this._selectTopAElement(this.store.selectedElements);else this.isHandActive&&this._processHandCreatorMove(t);this.isArbitraryDrawing||await this._tryCreatedRedraw()}async _handleDblClick(t){this.isMoveableActive&&(this._selectTopAElement(this.store.stageElements),this.store.beginEditingElements(this.store.selectedElements),this.selection.refresh(),this.store.isEditingEmpty||(this.elementsStatus=H.EDITING))}async _tryCreatedRedraw(){await Promise.all([this.selection.refresh(),this._addRedrawTask(null,!0),this.tryEmitElementCreated()])}_endElementsDrag(){const{selectedElements:t}=this.store;this.store.updateElements(t,{isDragging:!1}),t.forEach(s=>{s.onTranslateAfter()}),this.store.isMultiSelected&&(this.selection.rangeElement.isDragging=!1)}_endElementsRotate(){const{selectedElements:t}=this.store;this.store.updateElements(t,{isRotatingTarget:!1,isRotating:!1}),t.forEach(s=>{s.onRotateAfter()}),this.store.isMultiSelected&&(this.selection.rangeElement.isRotating=!1),this.store.clearRotatingStates()}_endElementsTransform(){const{selectedElements:t}=this.store;this.store.updateElements(t,{isTransforming:!1}),t.forEach(s=>{s.onTransformAfter()}),this.store.isMultiSelected&&(this.selection.rangeElement.isTransforming=!1)}_endMoveingElementsCorner(){const{selectedElements:t}=this.store;this.store.updateElements(t,{isCornerMoving:!1}),t.forEach(s=>{s.onCornerChanged()})}_selectTopAElement(t){const s=x.getTopAElementByCoord(t,this.cursor.worldValue);this.store.deSelectElements(this.store.selectedElements.filter(r=>s&&s.isGroup?r.ancestorGroup!==s:r!==s)),s&&this.store.selectElement(s)}_processHandCreatorMove(t){this._refreshStageWorldCoord(t),this.store.refreshStageElements(),this.selection.refresh(),this._isStageMoving=!1}async tryEmitElementCreated(){const t=this.store.provisionalElements;if(t.length){this.store.updateElements(t,{isProvisional:!1,isOnStage:!0}),this.emit(O.elementCreated,t);const s=new Co({type:cr.ElementsAdded,data:await Promise.all(t.map(r=>r.toJson()))},this.store);this.undo.undoStack.push(s)}}calcPressDown(t){this._pressDownPosition=this.cursor.transform(t),this._pressDownStageWorldCoord=x.calcWorldCoord(this._pressDownPosition)}calcPressUp(t){this._pressUpPosition=this.cursor.transform(t),this._pressUpStageWorldCoord=x.calcWorldCoord(this._pressUpPosition)}calcPressMove(t){this._pressMovePosition=this.cursor.transform(t),this._pressMoveStageWorldCoord=x.calcWorldCoord(this._pressMovePosition)}checkCursorPressMovedALittle(t){return Math.abs(this._pressMoveStageWorldCoord.x-this._pressDownStageWorldCoord.x)>=ls||Math.abs(this._pressMoveStageWorldCoord.y-this._pressDownStageWorldCoord.y)>=cs}checkCursorPressUpALittle(t){return Math.abs(this._pressUpStageWorldCoord.x-this._pressDownStageWorldCoord.x)>=ls||Math.abs(this._pressUpStageWorldCoord.y-this._pressDownStageWorldCoord.y)>=cs}async _refreshSize(){const t=this.renderEl.getBoundingClientRect();this.stageRect=t,this._updateCanvasSize(t),this.store.refreshStageElements(),this.selection.refresh(),this._redrawFlag=!0}_updateCanvasSize(t){this.mask.updateCanvasSize(t),this.provisional.updateCanvasSize(t),this.updateCanvasSize(t)}async setCreator(t){this.currentCreator=t,this.emit(O.creatorChanged,t)}_creatingElementOnMovement(t){if(this.checkCursorPressMovedALittle(t))return this.store.creatingElement([this._pressDownStageWorldCoord,this._pressMoveStageWorldCoord])}_updatingArbitraryElementOnMovement(t){if(this.checkCursorPressMovedALittle(t))return this.store.creatingArbitraryElement(this._pressMoveStageWorldCoord,!1)}_refreshStageWorldCoord(t){const s=S.getEventPosition(t,this.stageRect,this.stageScale);this.stageWorldCoord={x:this._originalStageWorldCoord.x-(s.x-this._pressDownPosition.x),y:this._originalStageWorldCoord.y-(s.y-this._pressDownPosition.y)}}_checkScale(t){let s=b.clamp(this.stageScale+t,.02,5);return s=l.precise(s,2),this.stageScale===.02&&t>0&&(s=.1),s}async setScale(t){this.stageScale=t,q.scale=t,this.emit(O.scaleChanged,t),this.store.refreshStageElements(),this.selection.refresh(),this._redrawFlag=!0}_handleWheelScale(t,s){const r=S.getEventPosition(s,this.stageRect,this.stageScale),i=x.calcWorldCoord(r),o=this._checkScale(t),a=(s.clientX-this.stageRect.left)/o,c=(s.clientY-this.stageRect.top)/o,h=i.x-a,d=i.y-c,g=h+this.stageRect.width/2/o,f=d+this.stageRect.height/2/o;this.stageWorldCoord={x:g,y:f},this.setScale(o)}_handleWheelMove(t){this.stageWorldCoord.x+=t.x/2/this.stageScale,this.stageWorldCoord.y+=t.y/2/this.stageScale,this.store.refreshStageElements(),this.selection.refresh(),this._redrawFlag=!0}calcScaleAutoFitValueByBox(t){const{width:s,height:r}=S.calcRectangleSize(t);let i=l.precise(S.calcScale(this.stageRect,{width:s,height:r},ei*this.stageScale),2);return i=b.clamp(i,.02,1),i}calcScaleAutoFitValue(){const t=S.getBoxPoints(this.store.visibleElements.map(s=>s.maxOutlineBoxCoords).flat());return this.calcScaleAutoFitValueByBox(t)}calcElementAutoFitValue(t){return this.calcScaleAutoFitValueByBox(t.maxOutlineBoxCoords)}setScaleAutoFit(){if(this.store.isVisibleEmpty)this.stageWorldCoord={x:0,y:0},this.setScale(1);else{const t=l.calcCenter(this.store.visibleElements.map(s=>s.rotateOutlineCoords.flat()).flat());this.stageWorldCoord=t,this.store.refreshStageElements(),this.setScale(this.calcScaleAutoFitValue())}}setScaleReduce(){const t=this._checkScale(-.05);this.setScale(t)}setScaleIncrease(){const t=this._checkScale(.05);this.setScale(t)}setScale100(){this.setScale(1)}_handleScaleReduce(){this.setScaleReduce()}_handleScaleIncrease(){this.setScaleIncrease()}_handleScaleAutoFit(){this.setScaleAutoFit()}_handleScale100(){this.setScale100()}async _handleImagePasted(t,s){this._clearStageSelects();const r=await this.store.insertImageElement(t),i=this.calcElementAutoFitValue(r);this.stageScale>i&&await this.setScale(i),s&&s()}async uploadImages(t){t.length&&await this.event.onImagesUpload(t)}deleteSelectElements(){this.store.isSelectedEmpty||this.store.deleteSelects()}_handleSelectsDelete(){this.deleteSelectElements()}selectAll(){this.store.selectAll()}_handleSelectAll(){this.selectAll()}async _handleSelectCopy(){const t=await this.store.copySelectElements(),s=JSON.stringify(t);mo.copyValueToClipboard(s)}async _handlePasteElements(t){const s=!t||t.length===0;s||this._clearStageSelects(),await this.store.pasteElements(t),s||this.selection.refresh()}_handleCancel(){this.isArbitraryDrawing?this.commitArbitraryDrawing():this.store.isEditingEmpty||this.commitEditingDrawing()}_handleSelectMoveable(){this.currentCreator.type===zt.type&&(this.setCreator(xe),this.cursor.updateStyle())}_handleSelectHand(){this.currentCreator.type===xe.type&&(this.setCreator(zt),this.cursor.updateStyle())}_handleSelectGroup(){if(this.isElementsBusy)return;const t=this.store.selectToGroup();t&&this.store.selectGroup(t)}_handleSelectGroupCancel(){if(this.isElementsBusy)return;const t=this.store.cancelSelectedGroups();if(t){const s=t.map(r=>r.getAllSubElements()).flat();this.store.deSelectGroups(t),this.store.selectElements(s)}}_handleUndo(){this.undo.undo()}_handleRedo(){this.undo.redo()}setElementsAlignLeft(t){this.align.setElementsAlignLeft(t),t.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._redrawFlag=!0}setElementsAlignRight(t){this.align.setElementsAlignRight(t),t.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._redrawFlag=!0}setElementsAlignTop(t){this.align.setElementsAlignTop(t),t.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._redrawFlag=!0}setElementsAlignBottom(t){this.align.setElementsAlignBottom(t),t.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._redrawFlag=!0}setElementsAlignCenter(t){this.align.setElementsAlignCenter(t),t.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._redrawFlag=!0}setElementsAlignMiddle(t){this.align.setElementsAlignMiddle(t),t.forEach(s=>s.onPositionChanged()),this.selection.refresh(),this._redrawFlag=!0}setElementsAverageVertical(t){this.align.setElementsAverageVertical(t),t.forEach(s=>s.onPositionChanged()),this._redrawFlag=!0}setElementsAverageHorizontal(t){this.align.setElementsAverageHorizontal(t),t.forEach(s=>s.onPositionChanged()),this._redrawFlag=!0}async commitArbitraryDrawing(){this.isArbitraryDrawing&&(this._isPressDown=!1,this.store.finishCreatingElement(),await this._tryCreatedRedraw())}async commitEditingDrawing(){this.store.isEditingEmpty||(this.store.endEditingElements(this.store.editingElements),this.selection.refresh(),this.elementsStatus=H.NONE)}async setElementsGoDown(t){await this.store.setElementsGoDown(t),t.forEach(s=>s.onLayerChanged()),this._redrawFlag=!0}async setElementsShiftMove(t){await this.store.setElementsShiftMove(t),t.forEach(s=>s.onLayerChanged()),this._redrawFlag=!0}}const k=new _o,Eo=new cn;k.configure.config({rotationIconEnable:!0});const Z=200,bs={position:{x:0,y:0},width:0,height:0,angle:0,corners:[...Qe.corners],flipX:!1,leanYAngle:0,scale:1,strokes:[{...vt}],fills:[{...wt}],fontSize:Je.fontSize,fontFamily:Je.fontFamily,textAlign:Je.textAlign,textBaseline:Je.textBaseline,isRatioLocked:!1},ge=zs("stage",{state:()=>({currentCreator:xe,currentCursorCreator:xe,currentShapeCreator:Jt,currentArbitraryCreator:Qt,selectedElements:[],targetElements:[],isMultiSelected:!1,primarySelectedElement:null,layerShiftMoveEnable:!1,layerGoDownEnable:!1,...b.cloneDeep(bs)}),getters:{inputDisabled(){return!this.primarySelectedElement},alignEnable(){var n;return((n=this.selectedElements)==null?void 0:n.length)>=2},averageEnable(){var n;return((n=this.selectedElements)==null?void 0:n.length)>=3},arbitraryVisible(){var n;return((n=this.currentCreator)==null?void 0:n.type)===P.arbitrary}},actions:{async init(n){await Eo.init(n.containerEl),await k.init(n.shieldEl),this.setCreator(xe),k.on(O.elementCreated,this.onElementCreated),k.on(O.selectedChanged,this.onSelectedChanged),k.on(O.targetChanged,this.onTargetChanged),k.on(O.multiSelectedChanged,this.onMultiSelectedChanged.bind(this)),k.on(O.primarySelectedChanged,this.onPrimarySelectedChanged.bind(this)),k.on(O.positionChanged,b.throttle(this.onPositionChanged.bind(this),Z,{leading:!0,trailing:!0})),k.on(O.widthChanged,b.throttle(this.onWidthChanged.bind(this),Z,{leading:!0,trailing:!0})),k.on(O.heightChanged,b.throttle(this.onHeightChanged.bind(this),Z,{leading:!0,trailing:!0})),k.on(O.angleChanged,b.throttle(this.onAngleChanged.bind(this),Z,{leading:!0,trailing:!0})),k.on(O.cornersChanged,b.throttle(this.onCornersChanged.bind(this),Z,{leading:!0,trailing:!0})),k.on(O.flipXChanged,b.throttle(this.onFlipXChanged.bind(this),Z,{leading:!0,trailing:!0})),k.on(O.leanYAngleChanged,b.throttle(this.onLeanYAngleChanged.bind(this),Z,{leading:!0,trailing:!0})),k.on(O.scaleChanged,b.throttle(this.onScaleChanged.bind(this),Z,{leading:!0,trailing:!0})),k.on(O.strokesChanged,b.throttle(this.onStrokesChanged.bind(this),Z,{leading:!0,trailing:!0})),k.on(O.fillsChanged,b.throttle(this.onFillsChanged.bind(this),Z,{leading:!0,trailing:!0})),k.on(O.fontSizeChanged,b.throttle(this.onFontSizeChanged.bind(this),Z,{leading:!0,trailing:!0})),k.on(O.fontFamilyChanged,b.throttle(this.onFontFamilyChanged.bind(this),Z,{leading:!0,trailing:!0})),k.on(O.textAlignChanged,b.throttle(this.onTextAlignChanged.bind(this),Z,{leading:!0,trailing:!0})),k.on(O.textBaselineChanged,b.throttle(this.onTextBaselineChanged.bind(this),Z,{leading:!0,trailing:!0})),k.on(O.ratioLockedChanged,b.throttle(this.onRatioLockedChanged.bind(this),Z,{leading:!0,trailing:!0})),k.on(O.creatorChanged,b.throttle(this.onCreatorChanged.bind(this),Z,{leading:!0,trailing:!0})),k.on(O.layerShiftMoveEnableChanged,b.throttle(this.onLayerShiftMoveEnableChanged.bind(this),Z,{leading:!0,trailing:!0})),k.on(O.layerGoDownEnableChanged,b.throttle(this.onLayerGoDownEnableChanged.bind(this),Z,{leading:!0,trailing:!0}))},async setCreator(n){await k.setCreator(n)},onCreatorChanged(n){this.currentCreator=n,n.category===se.cursor&&(this.currentCursorCreator=n),n.category===se.shapes&&(this.currentShapeCreator=n),n.category===se.freedom&&(this.currentArbitraryCreator=n)},onMultiSelectedChanged(n){this.isMultiSelected=n},onPrimarySelectedChanged(n){this.primarySelectedElement=n},onElementCreated(n){this.setCreator(xe),n.length&&this.onElementChanged(n[0])},onSelectedChanged(n){if(this.selectedElements=n,this.selectedElements.length){const e=x.getAncestorGroup(this.selectedElements);if(!e){Object.assign(this,b.cloneDeep(bs));return}this.onElementChanged(e)}},onElementChanged(n){if(!n)return;const{position:e,width:t,height:s,angle:r,corners:i,flipX:o,leanYAngle:a,strokes:c,fills:h,fontSize:d,fontFamily:g,textAlign:f,textBaseline:C,isRatioLocked:p}=n;this.onPositionChanged(n,e),this.onWidthChanged(n,t),this.onHeightChanged(n,s),this.onAngleChanged(n,r),this.onCornersChanged(n,i),this.onFlipXChanged(n,o),this.onLeanYAngleChanged(n,a),this.onStrokesChanged(n,c),this.onFillsChanged(n,h),this.onFontSizeChanged(n,d),this.onFontFamilyChanged(n,g),this.onTextAlignChanged(n,f),this.onTextBaselineChanged(n,C),this.onRatioLockedChanged(n,p)},onTargetChanged(n){this.targetElements=n},onPositionChanged(n,e){e&&(this.position={x:e.x,y:e.y})},onWidthChanged(n,e){this.width=e},onHeightChanged(n,e){this.height=e},onAngleChanged(n,e){this.angle=e},onCornersChanged(n,e){this.corners=[...e]},onFlipXChanged(n,e){this.flipX=e},onLeanYAngleChanged(n,e){this.leanYAngle=e},onScaleChanged(n){this.scale=n},onStrokesChanged(n,e){this.strokes=b.cloneDeep(e)},onFillsChanged(n,e){this.fills=b.cloneDeep(e)},onFontSizeChanged(n,e){this.fontSize=e},onFontFamilyChanged(n,e){this.fontFamily=e},onTextAlignChanged(n,e){this.textAlign=e},onTextBaselineChanged(n,e){this.textBaseline=e},onRatioLockedChanged(n,e){this.isRatioLocked=e},onLayerShiftMoveEnableChanged(n){this.layerShiftMoveEnable=n},onLayerGoDownEnableChanged(n){this.layerGoDownEnable=n},setElementsPosition(n){k.setElementsPosition(N(this.selectedElements),n)},setElementsLeft(n){k.setElementsPosition(N(this.selectedElements),{x:n,y:this.position.y})},setElementsTop(n){k.setElementsPosition(N(this.selectedElements),{x:this.position.x,y:n})},setElementsWidth(n){k.setElementsWidth(N(this.selectedElements),n)},setElementsHeight(n){k.setElementsHeight(N(this.selectedElements),n)},setElementsAngle(n){k.setElementsAngle(N(this.selectedElements),n)},setElementsCorners(n,e){k.setElementsCorners(N(this.selectedElements),n,e)},setElementsLeanYAngle(n){k.setElementsLeanYAngle(N(this.selectedElements),n)},setElementsStrokeType(n,e){k.setElementsStrokeType(N(this.selectedElements),n,e)},setElementsStrokeWidth(n,e){k.setElementsStrokeWidth(N(this.selectedElements),n,e)},setElementsStrokeColor(n,e){k.setElementsStrokeColor(N(this.selectedElements),n,e)},setElementsStrokeColorOpacity(n,e){k.setElementsStrokeColorOpacity(N(this.selectedElements),n,e)},addElementsStroke(n){k.addElementsStroke(N(this.selectedElements),n)},removeElementsStroke(n){k.removeElementsStroke(N(this.selectedElements),n)},setElementsFillColor(n,e){k.setElementsFillColor(N(this.selectedElements),n,e)},setElementsFillColorOpacity(n,e){k.setElementsFillColorOpacity(N(this.selectedElements),n,e)},addElementsFill(n){k.addElementsFill(N(this.selectedElements),n)},removeElementsFill(n){k.removeElementsFill(N(this.selectedElements),n)},setElementsTextAlign(n){k.setElementsTextAlign(N(this.selectedElements),n)},setElementsTextBaseline(n){k.setElementsTextBaseline(N(this.selectedElements),n)},setElementsFontSize(n){k.setElementsFontSize(N(this.selectedElements),n)},setElementsFontFamily(n){k.setElementsFontFamily(N(this.selectedElements),n)},setScale(n){k.setScale(n)},setScaleAutoFit(){k.setScaleAutoFit()},setScaleIncrease(){k.setScaleIncrease()},setScaleReduce(){k.setScaleReduce()},setRatioLocked(n){k.setElementsRatioLocked(N(this.selectedElements),n)},setElementsAlignLeft(){this.alignEnable&&k.setElementsAlignLeft(N(this.selectedElements))},setElementsAlignCenter(){this.alignEnable&&k.setElementsAlignCenter(N(this.selectedElements))},setElementsAlignRight(){this.alignEnable&&k.setElementsAlignRight(N(this.selectedElements))},setElementsAlignTop(){this.alignEnable&&k.setElementsAlignTop(N(this.selectedElements))},setElementsAlignMiddle(){this.alignEnable&&k.setElementsAlignMiddle(N(this.selectedElements))},setElementsAlignBottom(){this.alignEnable&&k.setElementsAlignBottom(N(this.selectedElements))},setElementsAverageVertical(){this.averageEnable&&k.setElementsAverageVertical(N(this.selectedElements))},setElementsAverageHorizontal(){this.averageEnable&&k.setElementsAverageHorizontal(N(this.selectedElements))},setElementsGoDown(){this.layerGoDownEnable&&k.setElementsGoDown(N(this.selectedElements))},setElementsShiftMove(){this.layerShiftMoveEnable&&k.setElementsShiftMove(N(this.selectedElements))},uploadImages(n){n.length&&k.uploadImages(n)},commitArbitraryDrawing(){k.commitArbitraryDrawing()}}}),yo={class:"tool-dropdown"},vo=oe({__name:"CreatorDropdown",props:{creators:Array,currentCreator:Object,select:Function},setup(n){const e=ge(),t=te([]),s=b.debounce(async()=>{e.uploadImages(t.value),t.value=[]},500),r=i=>(t.value.push(i),s(),!1);return(i,o)=>{const a=Ce,c=ln,h=Hr,d=Ns,g=Gs,f=js;return W(),fe(f,null,{dropdown:F(()=>[R(g,null,{default:F(()=>[(W(!0),j(Oe,null,ze(n.creators,C=>(W(),fe(d,{key:C.type,class:J([{selected:C.type===n.currentCreator.type}]),onClick:p=>n.select(C)},{default:F(()=>[C.type===w(P).image?(W(),fe(h,{key:0,action:"",multiple:"",accept:"image/*","before-upload":r},{default:F(()=>[R(c,{creator:C},null,8,["creator"])]),_:2},1024)):(W(),fe(c,{key:1,creator:C},null,8,["creator"]))]),_:2},1032,["class","onClick"]))),128))]),_:1})]),default:F(()=>[L("div",yo,[R(a,{class:"icon-verbise-arrow_down iconfont"})])]),_:1})}}}),ce=(n,e)=>{const t=n.__vccOpts||n;for(const[s,r]of e)t[s]=r;return t},wo=ce(vo,[["__scopeId","data-v-1f27b774"]]),bo={class:"create-bar"},So=oe({__name:"CreatorBar",emits:["select"],setup(n,{emit:e}){const t=e,s=ge(),r=nt(()=>s.currentCreator),i=nt(()=>s.currentCursorCreator),o=nt(()=>s.currentShapeCreator),a=nt(()=>s.currentArbitraryCreator),c=h=>{t("select",h)};return(h,d)=>{const g=Ce,f=wo;return W(),j("div",bo,[L("div",{class:J(["tool-item",{selected:i.value.category===r.value.category}]),onClick:d[0]||(d[0]=C=>c(i.value))},[R(g,{class:J(["iconfont",i.value.icon])},null,8,["class"])],2),R(f,{creators:w(Ks),"current-creator":r.value,select:c},null,8,["creators","current-creator"]),L("div",{class:J(["tool-item",{selected:o.value.category===r.value.category}]),onClick:d[1]||(d[1]=C=>c(o.value))},[R(g,{class:J(["iconfont",o.value.icon])},null,8,["class"])],2),R(f,{creators:w(Js),"current-creator":r.value,select:c},null,8,["creators","current-creator"]),L("div",{class:J(["tool-item",{selected:a.value.category===r.value.category}]),onClick:d[2]||(d[2]=C=>c(a.value))},[R(g,{class:J(["iconfont",a.value.icon])},null,8,["class"])],2),R(f,{creators:w(Qs),"current-creator":r.value,select:c},null,8,["creators","current-creator"])])}}}),xo={class:"arbitrary-bar"},Ao={class:"tool-item"},Po=oe({__name:"ArbitraryBar",setup(n){const e=ge();return(t,s)=>{const r=Ce;return _t((W(),j("div",xo,[L("div",Ao,[R(r,{onClick:w(e).commitArbitraryDrawing},{default:F(()=>[R(w(Yr))]),_:1},8,["onClick"])])],512)),[[Et,w(e).arbitraryVisible]])}}}),Ro=ce(Po,[["__scopeId","data-v-dc2ef5a8"]]),To={class:"stage-shield"},ko=oe({__name:"shield",setup(n,{expose:e}){let t;return e({init:async()=>new Promise(r=>{t=r,t()})}),(r,i)=>(W(),j("div",To))}}),Oo=oe({__name:"container",setup(n){const e=ge(),t=te(null),s=te(),r=i=>{const{type:o}=i;o!==P.image&&e.setCreator(i)};return Wr(async()=>{s.value&&await s.value.init(),await e.init({containerEl:t.value,shieldEl:s.value.$el})}),(i,o)=>{const a=Ro,c=So;return W(),j("div",{class:"stage-container",ref_key:"stageRef",ref:t},[R(ko,{ref_key:"stageShieldRef",ref:s},null,512),R(a),R(c,{onSelect:r})],512)}}}),Io=ce(Oo,[["__scopeId","data-v-a64de043"]]),Bo={class:J(["layer-props right-props"])},Lo={class:"layer-props__row"},Mo=oe({__name:"LayerProps",setup(n){const e=ge();return(t,s)=>{const r=Ce;return W(),j("div",Bo,[s[0]||(s[0]=L("div",{class:"layer-props__title"},[L("span",{class:"layer-props__title-text"},"层级")],-1)),L("div",Lo,[R(r,{class:J(["iconfont","icon-verbise-layer-go-down",{disabled:!w(e).layerGoDownEnable}]),onClick:w(e).setElementsGoDown,title:"下移"},null,8,["class","onClick"]),R(r,{class:J(["iconfont","icon-verbise-layer-shift-move",{disabled:!w(e).layerShiftMoveEnable}]),onClick:w(e).setElementsShiftMove,title:"上移"},null,8,["class","onClick"])])])}}}),Fo=ce(Mo,[["__scopeId","data-v-a63d4953"]]),Do={class:"stroke-props right-props"},Wo={class:"stroke-props__title"},Vo={class:"stroke-props__row color"},zo={class:"stroke-props__row-item"},No={class:"stroke-props__row-item"},Go={class:"stroke-props__row"},jo={class:"stroke-props__row-item"},Ho={class:"stroke-props__row-item"},Yo=oe({__name:"StrokeProps",setup(n){const e=te(),t=ge(),s=te([{...vt}]);be(()=>t.strokes,o=>{s.value=o});const r=te([]);be(()=>{var o;return(o=t.primarySelectedElement)==null?void 0:o.model.type},o=>{r.value=pn(o)});const i=()=>{e.value.show()};return(o,a)=>{var p;const c=Ce,h=$s,d=qs,g=je,f=$r,C=qr;return _t((W(),j("div",Do,[L("div",Wo,[a[1]||(a[1]=L("span",{class:"stroke-props__title-text"},"描边",-1)),R(c,null,{default:F(()=>[R(w(Hs),{onClick:a[0]||(a[0]=E=>w(t).addElementsStroke(s.value.length-1))})]),_:1})]),(W(!0),j(Oe,null,ze(s.value,(E,v)=>{var z;return W(),j("div",{key:v},[L("div",Vo,[L("div",zo,[R(h,{modelValue:E.color,"onUpdate:modelValue":M=>E.color=M,onChange:M=>w(t).setElementsStrokeColor(M,v),ref_for:!0,ref_key:"colorPickerRef",ref:e,disabled:w(t).inputDisabled},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),R(d,{type:"info",onClick:i},{default:F(()=>[K(Te(E.color),1)]),_:2},1024)]),L("div",No,[R(g,{modelValue:E.colorOpacity,"onUpdate:modelValue":M=>E.colorOpacity=M,placeholder:"输入数字",type:"number",min:"0",max:"1",precision:"1",onChange:M=>w(t).setElementsStrokeColorOpacity(Number(M),v),disabled:w(t).inputDisabled},{prepend:F(()=>a[2]||(a[2]=[K("O")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"])]),R(c,null,{default:F(()=>[s.value.length>1?(W(),fe(w(Ys),{key:0,onClick:M=>w(t).removeElementsStroke(v)},null,8,["onClick"])):Ve("",!0)]),_:2},1024)]),L("div",Go,[L("div",jo,[R(C,{modelValue:E.type,"onUpdate:modelValue":M=>E.type=M,placeholder:"描边类型",size:"small",onChange:M=>w(t).setElementsStrokeType(M,v),disabled:w(t).inputDisabled},{default:F(()=>[(W(!0),j(Oe,null,ze(r.value,M=>(W(),fe(f,{key:M.type,label:M.name,value:M.type},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"])]),L("div",Ho,[R(g,{modelValue:E.width,"onUpdate:modelValue":M=>E.width=M,placeholder:"输入数字",type:"number",precision:"1",min:((z=w(t).primarySelectedElement)==null?void 0:z.model.type)===w(P).line?1:0,onChange:M=>w(t).setElementsStrokeWidth(Number(M),v),disabled:w(t).inputDisabled},{prepend:F(()=>a[3]||(a[3]=[K("S")])),append:F(()=>a[4]||(a[4]=[K("px")])),_:2},1032,["modelValue","onUpdate:modelValue","min","onChange","disabled"])])])])}),128))],512)),[[Et,(p=w(t).primarySelectedElement)==null?void 0:p.strokeEnable]])}}}),$o=ce(Yo,[["__scopeId","data-v-168aab7f"]]),qo={class:"fill-props right-props"},Xo={class:"fill-props__title"},Uo={class:"fill-props__row color"},Ko={class:"fill-props__row-item"},Jo={class:"fill-props__row-item"},Qo=oe({__name:"FillProps",setup(n){const e=te(),t=ge(),s=te([{...wt}]);be(()=>t.fills,i=>{s.value=i});const r=()=>{e.value.show()};return(i,o)=>{var g;const a=Ce,c=$s,h=qs,d=je;return _t((W(),j("div",qo,[L("div",Xo,[o[1]||(o[1]=L("span",{class:"fill-props__title-text"},"填充",-1)),R(a,null,{default:F(()=>[R(w(Hs),{onClick:o[0]||(o[0]=f=>w(t).addElementsFill(s.value.length-1))})]),_:1})]),(W(!0),j(Oe,null,ze(s.value,(f,C)=>(W(),j("div",{key:C},[L("div",Uo,[L("div",Ko,[R(c,{modelValue:f.color,"onUpdate:modelValue":p=>f.color=p,onChange:p=>w(t).setElementsFillColor(p,C),ref_for:!0,ref_key:"colorPickerRef",ref:e,disabled:w(t).inputDisabled},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),R(h,{type:"info",onClick:r},{default:F(()=>[K(Te(f.color),1)]),_:2},1024)]),L("div",Jo,[R(d,{modelValue:f.colorOpacity,"onUpdate:modelValue":p=>f.colorOpacity=p,placeholder:"输入数字",type:"number",min:"0",max:"1",precision:"1",onChange:p=>w(t).setElementsFillColorOpacity(Number(p),C),disabled:w(t).inputDisabled},{prepend:F(()=>o[2]||(o[2]=[K("O")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange","disabled"])]),R(a,null,{default:F(()=>[s.value.length>1?(W(),fe(w(Ys),{key:0,onClick:p=>w(t).removeElementsFill(C)},null,8,["onClick"])):Ve("",!0)]),_:2},1024)])]))),128))],512)),[[Et,(g=w(t).primarySelectedElement)==null?void 0:g.fillEnabled]])}}}),Zo=ce(Qo,[["__scopeId","data-v-fe653b46"]]),ea={class:"corners-props right-props"},ta={class:"corners-props__row"},sa={class:"corners-props__row-item"},ra={class:"corners-props__row"},na=oe({__name:"CornerProps",setup(n){const e=ge(),t=te(Qe.corners),s=te(0),r=te(!1);return be(()=>e.corners,i=>{t.value=i;const o=b.uniq(t.value);o.length===1?(r.value=!0,s.value=o[0]):(r.value=!1,s.value=0)}),(i,o)=>{var c,h;const a=je;return _t((W(),j("div",ea,[o[4]||(o[4]=L("div",{class:"corners-props__title"},[L("span",{class:"corners-props__title-text"},"圆角")],-1)),L("div",ta,[L("div",sa,[R(a,{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=d=>s.value=d),placeholder:"输入数字",disabled:w(e).inputDisabled||!r.value,type:"number",min:"0",max:((c=w(e).primarySelectedElement)==null?void 0:c.minParallelogramVerticalSize)/2,precision:"1",onChange:o[1]||(o[1]=d=>w(e).setElementsCorners(Number(d)))},{prepend:F(()=>o[2]||(o[2]=[K("C")])),append:F(()=>o[3]||(o[3]=[K("px")])),_:1},8,["modelValue","disabled","max"])])]),L("div",ra,[(W(!0),j(Oe,null,ze(t.value,(d,g)=>{var f;return W(),j("div",{class:"corners-props__row-item",key:g},[R(a,{modelValue:t.value[g],"onUpdate:modelValue":C=>t.value[g]=C,placeholder:"输入数字",disabled:w(e).inputDisabled,type:"number",min:"0",max:((f=w(e).primarySelectedElement)==null?void 0:f.minParallelogramVerticalSize)/2,precision:"1",onChange:C=>w(e).setElementsCorners(Number(C),g)},null,8,["modelValue","onUpdate:modelValue","disabled","max","onChange"])])}),128))])],512)),[[Et,(h=w(e).primarySelectedElement)==null?void 0:h.cornersModifyEnable]])}}}),ia=ce(na,[["__scopeId","data-v-84bd0b46"]]),oa={class:"angle-props right-props"},aa={class:"angle-props__title"},la={class:"angle-props__row"},ca={class:"angle-props__row-item"},ha={key:0,class:"angle-props__row-item"},da=oe({__name:"AngleProps",setup(n){const e=ge(),t=te(0),s=te(0);be(()=>e.angle,o=>{t.value=l.precise(o,1)}),be(()=>e.leanYAngle,o=>{s.value=l.precise(o,1)});function r(o){let a=Number(o);a>180&&(a=180-a),a<-180&&(a=-180-a),e.setElementsAngle(a)}function i(o){let a=Number(o);a=b.clamp(a,-89,89),e.setElementsLeanYAngle(a)}return(o,a)=>{var d;const c=Ce,h=je;return W(),j("div",oa,[L("div",aa,[a[2]||(a[2]=L("span",{class:"angle-props__title-text"},"角度",-1)),w(e).flipX?(W(),fe(c,{key:0,class:J(["iconfont","icon-verbise-flip-horizontal"])})):Ve("",!0)]),L("div",la,[L("div",ca,[R(h,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=g=>t.value=g),placeholder:"输入数字",disabled:w(e).inputDisabled,type:"number",min:"-180",max:"180",precision:"1",onChange:r},{prepend:F(()=>a[3]||(a[3]=[K("A")])),append:F(()=>a[4]||(a[4]=[K("°")])),_:1},8,["modelValue","disabled"])]),(d=w(e).primarySelectedElement)!=null&&d.leanYAngleModifyEnable?(W(),j("div",ha,[R(h,{modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=g=>s.value=g),placeholder:"输入数字",disabled:w(e).inputDisabled,type:"number",min:"-89",max:"89",precision:"1",onChange:i},{prepend:F(()=>a[5]||(a[5]=[K("LY")])),append:F(()=>a[6]||(a[6]=[K("°")])),_:1},8,["modelValue","disabled"])])):Ve("",!0)])])}}}),ua={class:"size-props right-props"},ga={class:"size-props__row"},fa={class:"angle-props__row-item"},ma={class:"angle-props__row-item"},pa=oe({__name:"SizeProps",setup(n){const e=ge(),t=te(0),s=te(0);return be(()=>e.width,r=>{t.value=l.precise(r,1)}),be(()=>e.height,r=>{s.value=l.precise(r,1)}),(r,i)=>{var c;const o=je,a=Ce;return W(),j("div",ua,[i[10]||(i[10]=L("div",{class:"size-props__title"},[L("span",{class:"size-props__title-text"},"尺寸")],-1)),L("div",ga,[L("div",fa,[R(o,{modelValue:t.value,"onUpdate:modelValue":i[0]||(i[0]=h=>t.value=h),placeholder:"输入数字",disabled:w(e).inputDisabled,min:"2",type:"number",precision:"1",onChange:i[1]||(i[1]=h=>w(e).setElementsWidth(Number(h)))},{prepend:F(()=>i[6]||(i[6]=[K("W")])),append:F(()=>i[7]||(i[7]=[K("px")])),_:1},8,["modelValue","disabled"])]),L("div",ma,[R(o,{modelValue:s.value,"onUpdate:modelValue":i[2]||(i[2]=h=>s.value=h),placeholder:"输入数字",disabled:w(e).inputDisabled||!((c=w(e).primarySelectedElement)!=null&&c.heightModifyEnable),min:"2",type:"number",precision:"1",onChange:i[3]||(i[3]=h=>w(e).setElementsHeight(Number(h)))},{prepend:F(()=>i[8]||(i[8]=[K("H")])),append:F(()=>i[9]||(i[9]=[K("px")])),_:1},8,["modelValue","disabled"])]),w(e).primarySelectedElement&&w(e).primarySelectedElement.ratioLockedEnable?(W(),fe(a,{key:0},{default:F(()=>[w(e).isRatioLocked?(W(),fe(w(Ur),{key:1,onClick:i[5]||(i[5]=h=>w(e).setRatioLocked(!1)),title:"解除宽高比锁定"})):(W(),fe(w(Xr),{key:0,onClick:i[4]||(i[4]=h=>w(e).setRatioLocked(!0)),title:"锁定宽高比"}))]),_:1})):Ve("",!0)])])}}}),Ca=ce(pa,[["__scopeId","data-v-48fc6838"]]),_a={class:"position-props right-props"},Ea={class:"position-props__row"},ya={class:"angle-props__row-item"},va={class:"angle-props__row-item"},wa=oe({__name:"PositionProps",setup(n){const e=ge(),t=te(0),s=te(0);return be(()=>e.position,r=>{r&&(t.value=l.precise(r.x),s.value=l.precise(r.y))}),(r,i)=>{const o=je;return W(),j("div",_a,[i[8]||(i[8]=L("div",{class:"position-props__title"},"坐标",-1)),L("div",Ea,[L("div",ya,[R(o,{modelValue:t.value,"onUpdate:modelValue":i[0]||(i[0]=a=>t.value=a),placeholder:"输入数字",disabled:w(e).inputDisabled,type:"number",precision:"1",onChange:i[1]||(i[1]=a=>w(e).setElementsPosition({x:Number(a),y:s.value}))},{prepend:F(()=>i[4]||(i[4]=[K("X")])),append:F(()=>i[5]||(i[5]=[K("px")])),_:1},8,["modelValue","disabled"])]),L("div",va,[R(o,{modelValue:s.value,"onUpdate:modelValue":i[2]||(i[2]=a=>s.value=a),placeholder:"输入数字",disabled:w(e).inputDisabled,type:"number",precision:"1",onChange:i[3]||(i[3]=a=>w(e).setElementsPosition({x:t.value,y:Number(a)}))},{prepend:F(()=>i[6]||(i[6]=[K("Y")])),append:F(()=>i[7]||(i[7]=[K("px")])),_:1},8,["modelValue","disabled"])])])])}}}),ba={class:J(["align-props right-props"])},Sa={class:"align-props__title"},xa={class:"align-props__row"},Aa=oe({__name:"AlignProps",setup(n){const e=ge();return(t,s)=>{const r=Ce;return W(),j("div",ba,[L("div",Sa,[s[0]||(s[0]=L("span",{class:"align-props__title-text"},"对齐",-1)),R(r,{title:"按住shift支持组件外轮廓对齐操作"},{default:F(()=>[R(w(Kr))]),_:1})]),L("div",xa,[R(r,{class:J(["iconfont","icon-verbise-align-left",{disabled:!w(e).alignEnable}]),onClick:w(e).setElementsAlignLeft},null,8,["class","onClick"]),R(r,{class:J(["iconfont","icon-verbise-align-horizontal-center",{disabled:!w(e).alignEnable}]),onClick:w(e).setElementsAlignCenter},null,8,["class","onClick"]),R(r,{class:J(["iconfont","icon-verbise-align-right",{disabled:!w(e).alignEnable}]),onClick:w(e).setElementsAlignRight},null,8,["class","onClick"]),R(r,{class:J(["iconfont","icon-verbise-align-top",{disabled:!w(e).alignEnable}]),onClick:w(e).setElementsAlignTop},null,8,["class","onClick"]),R(r,{class:J(["iconfont","icon-verbise-align-vertical-center",{disabled:!w(e).alignEnable}]),onClick:w(e).setElementsAlignMiddle},null,8,["class","onClick"]),R(r,{class:J(["iconfont","icon-verbise-align-bottom",{disabled:!w(e).alignEnable}]),onClick:w(e).setElementsAlignBottom},null,8,["class","onClick"]),R(r,{class:J(["iconfont","icon-verbise-average-h",{disabled:!w(e).averageEnable}]),onClick:w(e).setElementsAverageHorizontal},null,8,["class","onClick"]),R(r,{class:J(["iconfont","icon-verbise-average-v",{disabled:!w(e).averageEnable}]),onClick:w(e).setElementsAverageVertical},null,8,["class","onClick"])])])}}}),Pa=ce(Aa,[["__scopeId","data-v-f3535776"]]),Ra={class:"scale-setting"},Ta={class:"scale-setting__item factor"},ka={class:"el-dropdown-link"},Oa=oe({__name:"ScaleSetting",setup(n){const e=ge();return(t,s)=>{const r=Ce,i=Ns,o=Qr,a=Gs,c=js;return W(),j("div",Ra,[L("div",Ta,[R(c,{trigger:"click","popper-class":"scale-setting__dropdown","hide-on-click":!1},{dropdown:F(()=>[R(a,null,{default:F(()=>[R(i,{onClick:w(e).setScaleAutoFit},{default:F(()=>s[0]||(s[0]=[L("span",null,"自适应缩放",-1),L("span",null,"shift + 1",-1)])),_:1},8,["onClick"]),R(i,{onClick:w(e).setScaleReduce},{default:F(()=>s[1]||(s[1]=[L("span",null,"缩小",-1),L("span",null,"ctrl + -",-1)])),_:1},8,["onClick"]),R(i,{onClick:w(e).setScaleIncrease},{default:F(()=>s[2]||(s[2]=[L("span",null,"放大",-1),L("span",null,"ctrl + +",-1)])),_:1},8,["onClick"]),R(o,null,{default:F(()=>s[3]||(s[3]=[K("预置缩放")])),_:1}),(W(!0),j(Oe,null,ze(w(Zn),h=>(W(),fe(i,{key:h,onClick:d=>w(e).setScale(h)},{default:F(()=>[L("span",null,"缩放"+Te(w(l).precise(h*100,0)+"%"),1),L("span",null,Te(h===1?"ctrl + 0":""),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:F(()=>[L("span",ka,[K(Te(w(l).precise(w(e).scale*100,0)+"%")+" ",1),R(r,{class:"el-icon--right"},{default:F(()=>[R(w(Jr))]),_:1})])]),_:1})])])}}}),Ia=ce(Oa,[["__scopeId","data-v-ec040534"]]),Ba={},La={class:"props-right-panel"};function Ma(n,e){const t=Ia,s=Pa,r=wa,i=Ca,o=da,a=ia,c=Zo,h=$o,d=Fo;return W(),j("div",La,[R(t),R(s),R(r),R(i),R(o),R(a),R(c),R(h),R(d)])}const Fa=ce(Ba,[["render",Ma],["__scopeId","data-v-d0f46be5"]]),Da={},Wa={class:"right-bar"};function Va(n,e){const t=Fa;return W(),j("div",Wa,[R(t)])}const za=ce(Da,[["render",Va],["__scopeId","data-v-910cfe36"]]),Na={},Ga={class:"left-bar"};function ja(n,e){return W(),j("div",Ga)}const Ha=ce(Na,[["render",ja],["__scopeId","data-v-5cc81779"]]);function hr(n,e){return function(){return n.apply(e,arguments)}}const{toString:Ya}=Object.prototype,{getPrototypeOf:rs}=Object,St=(n=>e=>{const t=Ya.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),_e=n=>(n=n.toLowerCase(),e=>St(e)===n),xt=n=>e=>typeof e===n,{isArray:Ye}=Array,et=xt("undefined");function $a(n){return n!==null&&!et(n)&&n.constructor!==null&&!et(n.constructor)&&ue(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const dr=_e("ArrayBuffer");function qa(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&dr(n.buffer),e}const Xa=xt("string"),ue=xt("function"),ur=xt("number"),At=n=>n!==null&&typeof n=="object",Ua=n=>n===!0||n===!1,at=n=>{if(St(n)!=="object")return!1;const e=rs(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Ka=_e("Date"),Ja=_e("File"),Qa=_e("Blob"),Za=_e("FileList"),el=n=>At(n)&&ue(n.pipe),tl=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||ue(n.append)&&((e=St(n))==="formdata"||e==="object"&&ue(n.toString)&&n.toString()==="[object FormData]"))},sl=_e("URLSearchParams"),[rl,nl,il,ol]=["ReadableStream","Request","Response","Headers"].map(_e),al=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function st(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let s,r;if(typeof n!="object"&&(n=[n]),Ye(n))for(s=0,r=n.length;s<r;s++)e.call(null,n[s],s,n);else{const i=t?Object.getOwnPropertyNames(n):Object.keys(n),o=i.length;let a;for(s=0;s<o;s++)a=i[s],e.call(null,n[a],a,n)}}function gr(n,e){e=e.toLowerCase();const t=Object.keys(n);let s=t.length,r;for(;s-- >0;)if(r=t[s],e===r.toLowerCase())return r;return null}const Re=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,fr=n=>!et(n)&&n!==Re;function jt(){const{caseless:n}=fr(this)&&this||{},e={},t=(s,r)=>{const i=n&&gr(e,r)||r;at(e[i])&&at(s)?e[i]=jt(e[i],s):at(s)?e[i]=jt({},s):Ye(s)?e[i]=s.slice():e[i]=s};for(let s=0,r=arguments.length;s<r;s++)arguments[s]&&st(arguments[s],t);return e}const ll=(n,e,t,{allOwnKeys:s}={})=>(st(e,(r,i)=>{t&&ue(r)?n[i]=hr(r,t):n[i]=r},{allOwnKeys:s}),n),cl=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),hl=(n,e,t,s)=>{n.prototype=Object.create(e.prototype,s),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},dl=(n,e,t,s)=>{let r,i,o;const a={};if(e=e||{},n==null)return e;do{for(r=Object.getOwnPropertyNames(n),i=r.length;i-- >0;)o=r[i],(!s||s(o,n,e))&&!a[o]&&(e[o]=n[o],a[o]=!0);n=t!==!1&&rs(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},ul=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const s=n.indexOf(e,t);return s!==-1&&s===t},gl=n=>{if(!n)return null;if(Ye(n))return n;let e=n.length;if(!ur(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},fl=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&rs(Uint8Array)),ml=(n,e)=>{const s=(n&&n[Symbol.iterator]).call(n);let r;for(;(r=s.next())&&!r.done;){const i=r.value;e.call(n,i[0],i[1])}},pl=(n,e)=>{let t;const s=[];for(;(t=n.exec(e))!==null;)s.push(t);return s},Cl=_e("HTMLFormElement"),_l=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,r){return s.toUpperCase()+r}),Ss=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),El=_e("RegExp"),mr=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),s={};st(t,(r,i)=>{let o;(o=e(r,i,n))!==!1&&(s[i]=o||r)}),Object.defineProperties(n,s)},yl=n=>{mr(n,(e,t)=>{if(ue(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=n[t];if(ue(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},vl=(n,e)=>{const t={},s=r=>{r.forEach(i=>{t[i]=!0})};return Ye(n)?s(n):s(String(n).split(e)),t},wl=()=>{},bl=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e,Lt="abcdefghijklmnopqrstuvwxyz",xs="0123456789",pr={DIGIT:xs,ALPHA:Lt,ALPHA_DIGIT:Lt+Lt.toUpperCase()+xs},Sl=(n=16,e=pr.ALPHA_DIGIT)=>{let t="";const{length:s}=e;for(;n--;)t+=e[Math.random()*s|0];return t};function xl(n){return!!(n&&ue(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const Al=n=>{const e=new Array(10),t=(s,r)=>{if(At(s)){if(e.indexOf(s)>=0)return;if(!("toJSON"in s)){e[r]=s;const i=Ye(s)?[]:{};return st(s,(o,a)=>{const c=t(o,r+1);!et(c)&&(i[a]=c)}),e[r]=void 0,i}}return s};return t(n,0)},Pl=_e("AsyncFunction"),Rl=n=>n&&(At(n)||ue(n))&&ue(n.then)&&ue(n.catch),Cr=((n,e)=>n?setImmediate:e?((t,s)=>(Re.addEventListener("message",({source:r,data:i})=>{r===Re&&i===t&&s.length&&s.shift()()},!1),r=>{s.push(r),Re.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",ue(Re.postMessage)),Tl=typeof queueMicrotask<"u"?queueMicrotask.bind(Re):typeof process<"u"&&process.nextTick||Cr,m={isArray:Ye,isArrayBuffer:dr,isBuffer:$a,isFormData:tl,isArrayBufferView:qa,isString:Xa,isNumber:ur,isBoolean:Ua,isObject:At,isPlainObject:at,isReadableStream:rl,isRequest:nl,isResponse:il,isHeaders:ol,isUndefined:et,isDate:Ka,isFile:Ja,isBlob:Qa,isRegExp:El,isFunction:ue,isStream:el,isURLSearchParams:sl,isTypedArray:fl,isFileList:Za,forEach:st,merge:jt,extend:ll,trim:al,stripBOM:cl,inherits:hl,toFlatObject:dl,kindOf:St,kindOfTest:_e,endsWith:ul,toArray:gl,forEachEntry:ml,matchAll:pl,isHTMLForm:Cl,hasOwnProperty:Ss,hasOwnProp:Ss,reduceDescriptors:mr,freezeMethods:yl,toObjectSet:vl,toCamelCase:_l,noop:wl,toFiniteNumber:bl,findKey:gr,global:Re,isContextDefined:fr,ALPHABET:pr,generateString:Sl,isSpecCompliantForm:xl,toJSONObject:Al,isAsyncFn:Pl,isThenable:Rl,setImmediate:Cr,asap:Tl};function D(n,e,t,s,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),s&&(this.request=s),r&&(this.response=r,this.status=r.status?r.status:null)}m.inherits(D,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:m.toJSONObject(this.config),code:this.code,status:this.status}}});const _r=D.prototype,Er={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Er[n]={value:n}});Object.defineProperties(D,Er);Object.defineProperty(_r,"isAxiosError",{value:!0});D.from=(n,e,t,s,r,i)=>{const o=Object.create(_r);return m.toFlatObject(n,o,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),D.call(o,n.message,e,t,s,r),o.cause=n,o.name=n.name,i&&Object.assign(o,i),o};const kl=null;function Ht(n){return m.isPlainObject(n)||m.isArray(n)}function yr(n){return m.endsWith(n,"[]")?n.slice(0,-2):n}function As(n,e,t){return n?n.concat(e).map(function(r,i){return r=yr(r),!t&&i?"["+r+"]":r}).join(t?".":""):e}function Ol(n){return m.isArray(n)&&!n.some(Ht)}const Il=m.toFlatObject(m,{},null,function(e){return/^is[A-Z]/.test(e)});function Pt(n,e,t){if(!m.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=m.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(E,v){return!m.isUndefined(v[E])});const s=t.metaTokens,r=t.visitor||d,i=t.dots,o=t.indexes,c=(t.Blob||typeof Blob<"u"&&Blob)&&m.isSpecCompliantForm(e);if(!m.isFunction(r))throw new TypeError("visitor must be a function");function h(p){if(p===null)return"";if(m.isDate(p))return p.toISOString();if(!c&&m.isBlob(p))throw new D("Blob is not supported. Use a Buffer instead.");return m.isArrayBuffer(p)||m.isTypedArray(p)?c&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function d(p,E,v){let z=p;if(p&&!v&&typeof p=="object"){if(m.endsWith(E,"{}"))E=s?E:E.slice(0,-2),p=JSON.stringify(p);else if(m.isArray(p)&&Ol(p)||(m.isFileList(p)||m.endsWith(E,"[]"))&&(z=m.toArray(p)))return E=yr(E),z.forEach(function(Y,y){!(m.isUndefined(Y)||Y===null)&&e.append(o===!0?As([E],y,i):o===null?E:E+"[]",h(Y))}),!1}return Ht(p)?!0:(e.append(As(v,E,i),h(p)),!1)}const g=[],f=Object.assign(Il,{defaultVisitor:d,convertValue:h,isVisitable:Ht});function C(p,E){if(!m.isUndefined(p)){if(g.indexOf(p)!==-1)throw Error("Circular reference detected in "+E.join("."));g.push(p),m.forEach(p,function(z,M){(!(m.isUndefined(z)||z===null)&&r.call(e,z,m.isString(M)?M.trim():M,E,f))===!0&&C(z,E?E.concat(M):[M])}),g.pop()}}if(!m.isObject(n))throw new TypeError("data must be an object");return C(n),e}function Ps(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function ns(n,e){this._pairs=[],n&&Pt(n,this,e)}const vr=ns.prototype;vr.append=function(e,t){this._pairs.push([e,t])};vr.toString=function(e){const t=e?function(s){return e.call(this,s,Ps)}:Ps;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};function Bl(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function wr(n,e,t){if(!e)return n;const s=t&&t.encode||Bl;m.isFunction(t)&&(t={serialize:t});const r=t&&t.serialize;let i;if(r?i=r(e,t):i=m.isURLSearchParams(e)?e.toString():new ns(e,t).toString(s),i){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n}class Rs{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){m.forEach(this.handlers,function(s){s!==null&&e(s)})}}const br={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ll=typeof URLSearchParams<"u"?URLSearchParams:ns,Ml=typeof FormData<"u"?FormData:null,Fl=typeof Blob<"u"?Blob:null,Dl={isBrowser:!0,classes:{URLSearchParams:Ll,FormData:Ml,Blob:Fl},protocols:["http","https","file","blob","url","data"]},is=typeof window<"u"&&typeof document<"u",Yt=typeof navigator=="object"&&navigator||void 0,Wl=is&&(!Yt||["ReactNative","NativeScript","NS"].indexOf(Yt.product)<0),Vl=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",zl=is&&window.location.href||"http://localhost",Nl=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:is,hasStandardBrowserEnv:Wl,hasStandardBrowserWebWorkerEnv:Vl,navigator:Yt,origin:zl},Symbol.toStringTag,{value:"Module"})),ie={...Nl,...Dl};function Gl(n,e){return Pt(n,new ie.classes.URLSearchParams,Object.assign({visitor:function(t,s,r,i){return ie.isNode&&m.isBuffer(t)?(this.append(s,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function jl(n){return m.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Hl(n){const e={},t=Object.keys(n);let s;const r=t.length;let i;for(s=0;s<r;s++)i=t[s],e[i]=n[i];return e}function Sr(n){function e(t,s,r,i){let o=t[i++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),c=i>=t.length;return o=!o&&m.isArray(r)?r.length:o,c?(m.hasOwnProp(r,o)?r[o]=[r[o],s]:r[o]=s,!a):((!r[o]||!m.isObject(r[o]))&&(r[o]=[]),e(t,s,r[o],i)&&m.isArray(r[o])&&(r[o]=Hl(r[o])),!a)}if(m.isFormData(n)&&m.isFunction(n.entries)){const t={};return m.forEachEntry(n,(s,r)=>{e(jl(s),r,t,0)}),t}return null}function Yl(n,e,t){if(m.isString(n))try{return(e||JSON.parse)(n),m.trim(n)}catch(s){if(s.name!=="SyntaxError")throw s}return(0,JSON.stringify)(n)}const rt={transitional:br,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",r=s.indexOf("application/json")>-1,i=m.isObject(e);if(i&&m.isHTMLForm(e)&&(e=new FormData(e)),m.isFormData(e))return r?JSON.stringify(Sr(e)):e;if(m.isArrayBuffer(e)||m.isBuffer(e)||m.isStream(e)||m.isFile(e)||m.isBlob(e)||m.isReadableStream(e))return e;if(m.isArrayBufferView(e))return e.buffer;if(m.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(i){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Gl(e,this.formSerializer).toString();if((a=m.isFileList(e))||s.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Pt(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),Yl(e)):e}],transformResponse:[function(e){const t=this.transitional||rt.transitional,s=t&&t.forcedJSONParsing,r=this.responseType==="json";if(m.isResponse(e)||m.isReadableStream(e))return e;if(e&&m.isString(e)&&(s&&!this.responseType||r)){const o=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?D.from(a,D.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ie.classes.FormData,Blob:ie.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};m.forEach(["delete","get","head","post","put","patch"],n=>{rt.headers[n]={}});const $l=m.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ql=n=>{const e={};let t,s,r;return n&&n.split(`
`).forEach(function(o){r=o.indexOf(":"),t=o.substring(0,r).trim().toLowerCase(),s=o.substring(r+1).trim(),!(!t||e[t]&&$l[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},Ts=Symbol("internals");function Xe(n){return n&&String(n).trim().toLowerCase()}function lt(n){return n===!1||n==null?n:m.isArray(n)?n.map(lt):String(n)}function Xl(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(n);)e[s[1]]=s[2];return e}const Ul=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Mt(n,e,t,s,r){if(m.isFunction(s))return s.call(this,e,t);if(r&&(e=t),!!m.isString(e)){if(m.isString(s))return e.indexOf(s)!==-1;if(m.isRegExp(s))return s.test(e)}}function Kl(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function Jl(n,e){const t=m.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(n,s+t,{value:function(r,i,o){return this[s].call(this,e,r,i,o)},configurable:!0})})}class le{constructor(e){e&&this.set(e)}set(e,t,s){const r=this;function i(a,c,h){const d=Xe(c);if(!d)throw new Error("header name must be a non-empty string");const g=m.findKey(r,d);(!g||r[g]===void 0||h===!0||h===void 0&&r[g]!==!1)&&(r[g||c]=lt(a))}const o=(a,c)=>m.forEach(a,(h,d)=>i(h,d,c));if(m.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(m.isString(e)&&(e=e.trim())&&!Ul(e))o(ql(e),t);else if(m.isHeaders(e))for(const[a,c]of e.entries())i(c,a,s);else e!=null&&i(t,e,s);return this}get(e,t){if(e=Xe(e),e){const s=m.findKey(this,e);if(s){const r=this[s];if(!t)return r;if(t===!0)return Xl(r);if(m.isFunction(t))return t.call(this,r,s);if(m.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Xe(e),e){const s=m.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||Mt(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let r=!1;function i(o){if(o=Xe(o),o){const a=m.findKey(s,o);a&&(!t||Mt(s,s[a],a,t))&&(delete s[a],r=!0)}}return m.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let s=t.length,r=!1;for(;s--;){const i=t[s];(!e||Mt(this,this[i],i,e,!0))&&(delete this[i],r=!0)}return r}normalize(e){const t=this,s={};return m.forEach(this,(r,i)=>{const o=m.findKey(s,i);if(o){t[o]=lt(r),delete t[i];return}const a=e?Kl(i):String(i).trim();a!==i&&delete t[i],t[a]=lt(r),s[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return m.forEach(this,(s,r)=>{s!=null&&s!==!1&&(t[r]=e&&m.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(r=>s.set(r)),s}static accessor(e){const s=(this[Ts]=this[Ts]={accessors:{}}).accessors,r=this.prototype;function i(o){const a=Xe(o);s[a]||(Jl(r,o),s[a]=!0)}return m.isArray(e)?e.forEach(i):i(e),this}}le.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);m.reduceDescriptors(le.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(s){this[t]=s}}});m.freezeMethods(le);function Ft(n,e){const t=this||rt,s=e||t,r=le.from(s.headers);let i=s.data;return m.forEach(n,function(a){i=a.call(t,i,r.normalize(),e?e.status:void 0)}),r.normalize(),i}function xr(n){return!!(n&&n.__CANCEL__)}function $e(n,e,t){D.call(this,n??"canceled",D.ERR_CANCELED,e,t),this.name="CanceledError"}m.inherits($e,D,{__CANCEL__:!0});function Ar(n,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?n(t):e(new D("Request failed with status code "+t.status,[D.ERR_BAD_REQUEST,D.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Ql(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function Zl(n,e){n=n||10;const t=new Array(n),s=new Array(n);let r=0,i=0,o;return e=e!==void 0?e:1e3,function(c){const h=Date.now(),d=s[i];o||(o=h),t[r]=c,s[r]=h;let g=i,f=0;for(;g!==r;)f+=t[g++],g=g%n;if(r=(r+1)%n,r===i&&(i=(i+1)%n),h-o<e)return;const C=d&&h-d;return C?Math.round(f*1e3/C):void 0}}function ec(n,e){let t=0,s=1e3/e,r,i;const o=(h,d=Date.now())=>{t=d,r=null,i&&(clearTimeout(i),i=null),n.apply(null,h)};return[(...h)=>{const d=Date.now(),g=d-t;g>=s?o(h,d):(r=h,i||(i=setTimeout(()=>{i=null,o(r)},s-g)))},()=>r&&o(r)]}const pt=(n,e,t=3)=>{let s=0;const r=Zl(50,250);return ec(i=>{const o=i.loaded,a=i.lengthComputable?i.total:void 0,c=o-s,h=r(c),d=o<=a;s=o;const g={loaded:o,total:a,progress:a?o/a:void 0,bytes:c,rate:h||void 0,estimated:h&&a&&d?(a-o)/h:void 0,event:i,lengthComputable:a!=null,[e?"download":"upload"]:!0};n(g)},t)},ks=(n,e)=>{const t=n!=null;return[s=>e[0]({lengthComputable:t,total:n,loaded:s}),e[1]]},Os=n=>(...e)=>m.asap(()=>n(...e)),tc=ie.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,ie.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(ie.origin),ie.navigator&&/(msie|trident)/i.test(ie.navigator.userAgent)):()=>!0,sc=ie.hasStandardBrowserEnv?{write(n,e,t,s,r,i){const o=[n+"="+encodeURIComponent(e)];m.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),m.isString(s)&&o.push("path="+s),m.isString(r)&&o.push("domain="+r),i===!0&&o.push("secure"),document.cookie=o.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function rc(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function nc(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Pr(n,e){return n&&!rc(e)?nc(n,e):e}const Is=n=>n instanceof le?{...n}:n;function Be(n,e){e=e||{};const t={};function s(h,d,g,f){return m.isPlainObject(h)&&m.isPlainObject(d)?m.merge.call({caseless:f},h,d):m.isPlainObject(d)?m.merge({},d):m.isArray(d)?d.slice():d}function r(h,d,g,f){if(m.isUndefined(d)){if(!m.isUndefined(h))return s(void 0,h,g,f)}else return s(h,d,g,f)}function i(h,d){if(!m.isUndefined(d))return s(void 0,d)}function o(h,d){if(m.isUndefined(d)){if(!m.isUndefined(h))return s(void 0,h)}else return s(void 0,d)}function a(h,d,g){if(g in e)return s(h,d);if(g in n)return s(void 0,h)}const c={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(h,d,g)=>r(Is(h),Is(d),g,!0)};return m.forEach(Object.keys(Object.assign({},n,e)),function(d){const g=c[d]||r,f=g(n[d],e[d],d);m.isUndefined(f)&&g!==a||(t[d]=f)}),t}const Rr=n=>{const e=Be({},n);let{data:t,withXSRFToken:s,xsrfHeaderName:r,xsrfCookieName:i,headers:o,auth:a}=e;e.headers=o=le.from(o),e.url=wr(Pr(e.baseURL,e.url),n.params,n.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let c;if(m.isFormData(t)){if(ie.hasStandardBrowserEnv||ie.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((c=o.getContentType())!==!1){const[h,...d]=c?c.split(";").map(g=>g.trim()).filter(Boolean):[];o.setContentType([h||"multipart/form-data",...d].join("; "))}}if(ie.hasStandardBrowserEnv&&(s&&m.isFunction(s)&&(s=s(e)),s||s!==!1&&tc(e.url))){const h=r&&i&&sc.read(i);h&&o.set(r,h)}return e},ic=typeof XMLHttpRequest<"u",oc=ic&&function(n){return new Promise(function(t,s){const r=Rr(n);let i=r.data;const o=le.from(r.headers).normalize();let{responseType:a,onUploadProgress:c,onDownloadProgress:h}=r,d,g,f,C,p;function E(){C&&C(),p&&p(),r.cancelToken&&r.cancelToken.unsubscribe(d),r.signal&&r.signal.removeEventListener("abort",d)}let v=new XMLHttpRequest;v.open(r.method.toUpperCase(),r.url,!0),v.timeout=r.timeout;function z(){if(!v)return;const Y=le.from("getAllResponseHeaders"in v&&v.getAllResponseHeaders()),_={data:!a||a==="text"||a==="json"?v.responseText:v.response,status:v.status,statusText:v.statusText,headers:Y,config:n,request:v};Ar(function(I){t(I),E()},function(I){s(I),E()},_),v=null}"onloadend"in v?v.onloadend=z:v.onreadystatechange=function(){!v||v.readyState!==4||v.status===0&&!(v.responseURL&&v.responseURL.indexOf("file:")===0)||setTimeout(z)},v.onabort=function(){v&&(s(new D("Request aborted",D.ECONNABORTED,n,v)),v=null)},v.onerror=function(){s(new D("Network Error",D.ERR_NETWORK,n,v)),v=null},v.ontimeout=function(){let y=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const _=r.transitional||br;r.timeoutErrorMessage&&(y=r.timeoutErrorMessage),s(new D(y,_.clarifyTimeoutError?D.ETIMEDOUT:D.ECONNABORTED,n,v)),v=null},i===void 0&&o.setContentType(null),"setRequestHeader"in v&&m.forEach(o.toJSON(),function(y,_){v.setRequestHeader(_,y)}),m.isUndefined(r.withCredentials)||(v.withCredentials=!!r.withCredentials),a&&a!=="json"&&(v.responseType=r.responseType),h&&([f,p]=pt(h,!0),v.addEventListener("progress",f)),c&&v.upload&&([g,C]=pt(c),v.upload.addEventListener("progress",g),v.upload.addEventListener("loadend",C)),(r.cancelToken||r.signal)&&(d=Y=>{v&&(s(!Y||Y.type?new $e(null,n,v):Y),v.abort(),v=null)},r.cancelToken&&r.cancelToken.subscribe(d),r.signal&&(r.signal.aborted?d():r.signal.addEventListener("abort",d)));const M=Ql(r.url);if(M&&ie.protocols.indexOf(M)===-1){s(new D("Unsupported protocol "+M+":",D.ERR_BAD_REQUEST,n));return}v.send(i||null)})},ac=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let s=new AbortController,r;const i=function(h){if(!r){r=!0,a();const d=h instanceof Error?h:this.reason;s.abort(d instanceof D?d:new $e(d instanceof Error?d.message:d))}};let o=e&&setTimeout(()=>{o=null,i(new D(`timeout ${e} of ms exceeded`,D.ETIMEDOUT))},e);const a=()=>{n&&(o&&clearTimeout(o),o=null,n.forEach(h=>{h.unsubscribe?h.unsubscribe(i):h.removeEventListener("abort",i)}),n=null)};n.forEach(h=>h.addEventListener("abort",i));const{signal:c}=s;return c.unsubscribe=()=>m.asap(a),c}},lc=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let s=0,r;for(;s<t;)r=s+e,yield n.slice(s,r),s=r},cc=async function*(n,e){for await(const t of hc(n))yield*lc(t,e)},hc=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:s}=await e.read();if(t)break;yield s}}finally{await e.cancel()}},Bs=(n,e,t,s)=>{const r=cc(n,e);let i=0,o,a=c=>{o||(o=!0,s&&s(c))};return new ReadableStream({async pull(c){try{const{done:h,value:d}=await r.next();if(h){a(),c.close();return}let g=d.byteLength;if(t){let f=i+=g;t(f)}c.enqueue(new Uint8Array(d))}catch(h){throw a(h),h}},cancel(c){return a(c),r.return()}},{highWaterMark:2})},Rt=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Tr=Rt&&typeof ReadableStream=="function",dc=Rt&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),kr=(n,...e)=>{try{return!!n(...e)}catch{return!1}},uc=Tr&&kr(()=>{let n=!1;const e=new Request(ie.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),Ls=64*1024,$t=Tr&&kr(()=>m.isReadableStream(new Response("").body)),Ct={stream:$t&&(n=>n.body)};Rt&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Ct[e]&&(Ct[e]=m.isFunction(n[e])?t=>t[e]():(t,s)=>{throw new D(`Response type '${e}' is not supported`,D.ERR_NOT_SUPPORT,s)})})})(new Response);const gc=async n=>{if(n==null)return 0;if(m.isBlob(n))return n.size;if(m.isSpecCompliantForm(n))return(await new Request(ie.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(m.isArrayBufferView(n)||m.isArrayBuffer(n))return n.byteLength;if(m.isURLSearchParams(n)&&(n=n+""),m.isString(n))return(await dc(n)).byteLength},fc=async(n,e)=>{const t=m.toFiniteNumber(n.getContentLength());return t??gc(e)},mc=Rt&&(async n=>{let{url:e,method:t,data:s,signal:r,cancelToken:i,timeout:o,onDownloadProgress:a,onUploadProgress:c,responseType:h,headers:d,withCredentials:g="same-origin",fetchOptions:f}=Rr(n);h=h?(h+"").toLowerCase():"text";let C=ac([r,i&&i.toAbortSignal()],o),p;const E=C&&C.unsubscribe&&(()=>{C.unsubscribe()});let v;try{if(c&&uc&&t!=="get"&&t!=="head"&&(v=await fc(d,s))!==0){let _=new Request(e,{method:"POST",body:s,duplex:"half"}),A;if(m.isFormData(s)&&(A=_.headers.get("content-type"))&&d.setContentType(A),_.body){const[I,B]=ks(v,pt(Os(c)));s=Bs(_.body,Ls,I,B)}}m.isString(g)||(g=g?"include":"omit");const z="credentials"in Request.prototype;p=new Request(e,{...f,signal:C,method:t.toUpperCase(),headers:d.normalize().toJSON(),body:s,duplex:"half",credentials:z?g:void 0});let M=await fetch(p);const Y=$t&&(h==="stream"||h==="response");if($t&&(a||Y&&E)){const _={};["status","statusText","headers"].forEach(G=>{_[G]=M[G]});const A=m.toFiniteNumber(M.headers.get("content-length")),[I,B]=a&&ks(A,pt(Os(a),!0))||[];M=new Response(Bs(M.body,Ls,I,()=>{B&&B(),E&&E()}),_)}h=h||"text";let y=await Ct[m.findKey(Ct,h)||"text"](M,n);return!Y&&E&&E(),await new Promise((_,A)=>{Ar(_,A,{data:y,headers:le.from(M.headers),status:M.status,statusText:M.statusText,config:n,request:p})})}catch(z){throw E&&E(),z&&z.name==="TypeError"&&/fetch/i.test(z.message)?Object.assign(new D("Network Error",D.ERR_NETWORK,n,p),{cause:z.cause||z}):D.from(z,z&&z.code,n,p)}}),qt={http:kl,xhr:oc,fetch:mc};m.forEach(qt,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Ms=n=>`- ${n}`,pc=n=>m.isFunction(n)||n===null||n===!1,Or={getAdapter:n=>{n=m.isArray(n)?n:[n];const{length:e}=n;let t,s;const r={};for(let i=0;i<e;i++){t=n[i];let o;if(s=t,!pc(t)&&(s=qt[(o=String(t)).toLowerCase()],s===void 0))throw new D(`Unknown adapter '${o}'`);if(s)break;r[o||"#"+i]=s}if(!s){const i=Object.entries(r).map(([a,c])=>`adapter ${a} `+(c===!1?"is not supported by the environment":"is not available in the build"));let o=e?i.length>1?`since :
`+i.map(Ms).join(`
`):" "+Ms(i[0]):"as no adapter specified";throw new D("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return s},adapters:qt};function Dt(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new $e(null,n)}function Fs(n){return Dt(n),n.headers=le.from(n.headers),n.data=Ft.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Or.getAdapter(n.adapter||rt.adapter)(n).then(function(s){return Dt(n),s.data=Ft.call(n,n.transformResponse,s),s.headers=le.from(s.headers),s},function(s){return xr(s)||(Dt(n),s&&s.response&&(s.response.data=Ft.call(n,n.transformResponse,s.response),s.response.headers=le.from(s.response.headers))),Promise.reject(s)})}const Ir="1.7.9",Tt={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Tt[n]=function(s){return typeof s===n||"a"+(e<1?"n ":" ")+n}});const Ds={};Tt.transitional=function(e,t,s){function r(i,o){return"[Axios v"+Ir+"] Transitional option '"+i+"'"+o+(s?". "+s:"")}return(i,o,a)=>{if(e===!1)throw new D(r(o," has been removed"+(t?" in "+t:"")),D.ERR_DEPRECATED);return t&&!Ds[o]&&(Ds[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,o,a):!0}};Tt.spelling=function(e){return(t,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function Cc(n,e,t){if(typeof n!="object")throw new D("options must be an object",D.ERR_BAD_OPTION_VALUE);const s=Object.keys(n);let r=s.length;for(;r-- >0;){const i=s[r],o=e[i];if(o){const a=n[i],c=a===void 0||o(a,i,n);if(c!==!0)throw new D("option "+i+" must be "+c,D.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new D("Unknown option "+i,D.ERR_BAD_OPTION)}}const ct={assertOptions:Cc,validators:Tt},Ee=ct.validators;class ke{constructor(e){this.defaults=e,this.interceptors={request:new Rs,response:new Rs}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{s.stack?i&&!String(s.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+i):s.stack=i}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Be(this.defaults,t);const{transitional:s,paramsSerializer:r,headers:i}=t;s!==void 0&&ct.assertOptions(s,{silentJSONParsing:Ee.transitional(Ee.boolean),forcedJSONParsing:Ee.transitional(Ee.boolean),clarifyTimeoutError:Ee.transitional(Ee.boolean)},!1),r!=null&&(m.isFunction(r)?t.paramsSerializer={serialize:r}:ct.assertOptions(r,{encode:Ee.function,serialize:Ee.function},!0)),ct.assertOptions(t,{baseUrl:Ee.spelling("baseURL"),withXsrfToken:Ee.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&m.merge(i.common,i[t.method]);i&&m.forEach(["delete","get","head","post","put","patch","common"],p=>{delete i[p]}),t.headers=le.concat(o,i);const a=[];let c=!0;this.interceptors.request.forEach(function(E){typeof E.runWhen=="function"&&E.runWhen(t)===!1||(c=c&&E.synchronous,a.unshift(E.fulfilled,E.rejected))});const h=[];this.interceptors.response.forEach(function(E){h.push(E.fulfilled,E.rejected)});let d,g=0,f;if(!c){const p=[Fs.bind(this),void 0];for(p.unshift.apply(p,a),p.push.apply(p,h),f=p.length,d=Promise.resolve(t);g<f;)d=d.then(p[g++],p[g++]);return d}f=a.length;let C=t;for(g=0;g<f;){const p=a[g++],E=a[g++];try{C=p(C)}catch(v){E.call(this,v);break}}try{d=Fs.call(this,C)}catch(p){return Promise.reject(p)}for(g=0,f=h.length;g<f;)d=d.then(h[g++],h[g++]);return d}getUri(e){e=Be(this.defaults,e);const t=Pr(e.baseURL,e.url);return wr(t,e.params,e.paramsSerializer)}}m.forEach(["delete","get","head","options"],function(e){ke.prototype[e]=function(t,s){return this.request(Be(s||{},{method:e,url:t,data:(s||{}).data}))}});m.forEach(["post","put","patch"],function(e){function t(s){return function(i,o,a){return this.request(Be(a||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}ke.prototype[e]=t(),ke.prototype[e+"Form"]=t(!0)});class os{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const s=this;this.promise.then(r=>{if(!s._listeners)return;let i=s._listeners.length;for(;i-- >0;)s._listeners[i](r);s._listeners=null}),this.promise.then=r=>{let i;const o=new Promise(a=>{s.subscribe(a),i=a}).then(r);return o.cancel=function(){s.unsubscribe(i)},o},e(function(i,o,a){s.reason||(s.reason=new $e(i,o,a),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=s=>{e.abort(s)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new os(function(r){e=r}),cancel:e}}}function _c(n){return function(t){return n.apply(null,t)}}function Ec(n){return m.isObject(n)&&n.isAxiosError===!0}const Xt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Xt).forEach(([n,e])=>{Xt[e]=n});function Br(n){const e=new ke(n),t=hr(ke.prototype.request,e);return m.extend(t,ke.prototype,e,{allOwnKeys:!0}),m.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return Br(Be(n,r))},t}const $=Br(rt);$.Axios=ke;$.CanceledError=$e;$.CancelToken=os;$.isCancel=xr;$.VERSION=Ir;$.toFormData=Pt;$.AxiosError=D;$.Cancel=$.CanceledError;$.all=function(e){return Promise.all(e)};$.spread=_c;$.isAxiosError=Ec;$.mergeConfig=Be;$.AxiosHeaders=le;$.formToJSON=n=>Sr(m.isHTMLForm(n)?new FormData(n):n);$.getAdapter=Or.getAdapter;$.HttpStatusCode=Xt;$.default=$;const yc=zs("app",{state:()=>({name:"app",locale:"zh",version:"1.0.0",user:{},token:"",config:{},menu:{},isMobile:!1,isLandscape:!1,isFullScreen:!1,isShowSidebar:!0,isShowHeader:!0,isShowFooter:!0}),actions:{async init(){const n=await Promise.all([this.getLocale(),this.getUserInfo(),this.getVersion(),this.getConfig()]),[e,t,s,r]=n;this.locale=e.data,this.user=t.data,this.version=s.data,this.config=r.data},async getLocale(){return"zh"},async getUserInfo(){return await $.get("/api/user")},async getVersion(){return await $.get("/api/version")},async getConfig(){return await $.get("/api/config")},async getUploadToken(){return await $.get("/api/upload/token")},async getUploadUrl(){return await $.get("/api/upload/url")},async getUploadFileInfo(n){return await $.get("/api/upload/file",n)},async getUploadFileList(n){return await $.get("/api/upload/list",n)}}}),vc={class:"left"},wc={class:"right"},bc={class:"stage"},Sc=oe({__name:"App",setup(n){const{locale:e}=Vr(),t=yc(),{init:s,locale:r}=t;return s().then(()=>{e.value=r}),(i,o)=>{const a=Ha,c=za,h=Io;return W(),j(Oe,null,[L("div",vc,[R(a)]),L("div",wc,[R(c)]),L("div",bc,[R(h)])],64)}}}),xc=ce(Sc,[["__scopeId","data-v-bc3e527b"]]),Ac="modulepreload",Pc=function(n,e){return new URL(n,e).href},Ws={},Vs=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),c=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(t.map(h=>{if(h=Pc(h,s),h in Ws)return;Ws[h]=!0;const d=h.endsWith(".css"),g=d?'[rel="stylesheet"]':"";if(!!s)for(let p=o.length-1;p>=0;p--){const E=o[p];if(E.href===h&&(!d||E.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${h}"]${g}`))return;const C=document.createElement("link");if(C.rel=d?"stylesheet":Ac,d||(C.as="script"),C.crossOrigin="",C.href=h,c&&C.setAttribute("nonce",c),document.head.appendChild(C),d)return new Promise((p,E)=>{C.addEventListener("load",p),C.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${h}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},Lr=zr({legacy:!1,locale:"zh",messages:{}});async function Rc(){const n=Object.assign({"/src/locales/en.json":()=>Vs(()=>import("./en-BIHI7g3E.js"),[],import.meta.url),"/src/locales/zh.json":()=>Vs(()=>import("./zh-DkCPf_Nl.js"),[],import.meta.url)});for(const e in n){const t=e.match(/\/([A-Za-z0-9-_]+)\.json$/)[1];n[e]().then(s=>{Lr.global.setLocaleMessage(t,s.default)})}}Rc();const kt=Nr(xc),Tc=Gr();kt.use(Zr,{size:"small"});kt.use(Tc);kt.use(Lr);kt.mount("#app");
